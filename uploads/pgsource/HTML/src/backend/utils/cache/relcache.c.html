<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\cache\relcache.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\cache\relcache.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:55 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * relcache.c 
 *    POSTGRES relation descriptor cache code 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/cache/relcache.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
/* 
 * INTERFACE ROUTINES 
 *      RelationCacheInitialize         - initialize relcache (to empty) 
 *      RelationCacheInitializePhase2   - initialize shared-catalog entries 
 *      RelationCacheInitializePhase3   - finish initializing relcache 
 *      RelationIdGetRelation           - get a reldesc by relation id 
 *      RelationClose                   - close an open relation 
 * 
 * NOTES 
 *      The following code contains many undocumented hacks.  Please be 
 *      careful.... 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/file.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/multixact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/nbtree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/reloptions.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/index.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/partition.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_am.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_amproc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_attrdef.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_authid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_auth_members.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_constraint.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_database.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_opclass.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_partitioned_table.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_publication.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_rewrite.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_shseclabel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_statistic_ext.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_subscription.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_tablespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/schemapg.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/storage.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/policy.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/prep.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteDefine.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rowsecurity.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/smgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/inval.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/relmapper.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/resowner_private.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *      name of relcache init file(s), used to speed up backend startup 
 */ 
</span><a name="LN92"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>RELCACHE_INIT_FILENAME</span>  <span class='String'>"pg_internal.init"</span> 
 
<a name="LN94"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>RELCACHE_INIT_FILEMAGIC</span>     <span class='Number'>0x573266</span>    <span class='Comment_Single_Line'>/* version ID value */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      hardcoded tuple descriptors, contents generated by genbki.pl 
 */ 
</span><a name="LN99"></a><span class='Keyword'>static const </span>FormData_pg_attribute <span class='Declare_Var'>Desc_pg_class</span><span class='Delimiter'>[</span><a href="../../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span>Schema_pg_class<span class='Delimiter'>}; 
</span><a name="LN100"></a><span class='Keyword'>static const </span>FormData_pg_attribute <span class='Declare_Var'>Desc_pg_attribute</span><span class='Delimiter'>[</span><a href="../../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span>Schema_pg_attribute<span class='Delimiter'>}; 
</span><a name="LN101"></a><span class='Keyword'>static const </span>FormData_pg_attribute <span class='Declare_Var'>Desc_pg_proc</span><span class='Delimiter'>[</span><a href="../../../include/catalog/pg_proc.h.html#LN88"><span class='Ref_to_Const'>Natts_pg_proc</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span>Schema_pg_proc<span class='Delimiter'>}; 
</span><a name="LN102"></a><span class='Keyword'>static const </span>FormData_pg_attribute <span class='Declare_Var'>Desc_pg_type</span><span class='Delimiter'>[</span><a href="../../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span>Schema_pg_type<span class='Delimiter'>}; 
</span><a name="LN103"></a><span class='Keyword'>static const </span>FormData_pg_attribute <span class='Declare_Var'>Desc_pg_database</span><span class='Delimiter'>[</span><a href="../../../include/catalog/pg_database.h.html#LN62"><span class='Ref_to_Const'>Natts_pg_database</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span>Schema_pg_database<span class='Delimiter'>}; 
</span><a name="LN104"></a><span class='Keyword'>static const </span>FormData_pg_attribute <span class='Declare_Var'>Desc_pg_authid</span><span class='Delimiter'>[</span><a href="../../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span>Schema_pg_authid<span class='Delimiter'>}; 
</span><a name="LN105"></a><span class='Keyword'>static const </span>FormData_pg_attribute <span class='Declare_Var'>Desc_pg_auth_members</span><span class='Delimiter'>[</span><a href="../../../include/catalog/pg_auth_members.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_auth_members</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span>Schema_pg_auth_members<span class='Delimiter'>}; 
</span><a name="LN106"></a><span class='Keyword'>static const </span>FormData_pg_attribute <span class='Declare_Var'>Desc_pg_index</span><span class='Delimiter'>[</span><a href="../../../include/catalog/pg_index.h.html#LN72"><span class='Ref_to_Const'>Natts_pg_index</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span>Schema_pg_index<span class='Delimiter'>}; 
</span><a name="LN107"></a><span class='Keyword'>static const </span>FormData_pg_attribute <span class='Declare_Var'>Desc_pg_shseclabel</span><span class='Delimiter'>[</span><a href="../../../include/catalog/pg_shseclabel.h.html#LN40"><span class='Ref_to_Const'>Natts_pg_shseclabel</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span>Schema_pg_shseclabel<span class='Delimiter'>}; 
</span><a name="LN108"></a><span class='Keyword'>static const </span>FormData_pg_attribute <span class='Declare_Var'>Desc_pg_subscription</span><span class='Delimiter'>[</span><a href="../../../include/catalog/pg_subscription.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_subscription</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span>Schema_pg_subscription<span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      Hash tables that index the relation cache 
 * 
 *      We used to index the cache by both name and OID, but now there 
 *      is only an index by OID. 
 */ 
</span><a name="LN116"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>relidcacheent</span> 
<span class='Delimiter'>{ 
</span><a name="LN118"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>reloid</span><span class='Delimiter'>; 
</span><a name="LN119"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Member'>reldesc</span><span class='Delimiter'>; 
</span><a name="LN120"></a>} <span class='Declare_Typedef'>RelIdCacheEnt</span><span class='Delimiter'>; 
</span> 
<a name="LN122"></a><span class='Keyword'>static </span><a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Var'>RelationIdCache</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * This flag is false until we have prepared the critical relcache entries 
 * that are needed to do indexscans on the tables read by relcache building. 
 */ 
</span><a name="LN128"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>criticalRelcachesBuilt</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * This flag is false until we have prepared the critical relcache entries 
 * for shared catalogs (which are the tables needed for login). 
 */ 
</span><a name="LN134"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>criticalSharedRelcachesBuilt</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * This counter counts relcache inval events received since backend startup 
 * (but only for rels that are actually in cache).  Presently, we use it only 
 * to detect whether data about to be written by write_relcache_init_file() 
 * might already be obsolete. 
 */ 
</span><a name="LN142"></a><span class='Keyword'>static long </span><span class='Declare_Var'>relcacheInvalsReceived</span> <span class='Operator'>= </span><span class='Number'>0L</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * eoxact_list[] stores the OIDs of relations that (might) need AtEOXact 
 * cleanup work.  This list intentionally has limited size; if it overflows, 
 * we fall back to scanning the whole hashtable.  There is no value in a very 
 * large list because (1) at some point, a hash_seq_search scan is faster than 
 * retail lookups, and (2) the value of this is to reduce EOXact work for 
 * short transactions, which can't have dirtied all that many tables anyway. 
 * EOXactListAdd() does not bother to prevent duplicate list entries, so the 
 * cleanup processing must be idempotent. 
 */ 
</span><a name="LN154"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_EOXACT_LIST</span> <span class='Number'>32</span> 
<a name="LN155"></a><span class='Keyword'>static </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Var'>eoxact_list</span><span class='Delimiter'>[</span><a href="relcache.c.html#LN154"><span class='Ref_to_Const'>MAX_EOXACT_LIST</span></a><span class='Delimiter'>]; 
</span><a name="LN156"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>eoxact_list_len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN157"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>eoxact_list_overflowed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN159"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>EOXactListAdd</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN156"><span class='Ref_to_Global_Var'>eoxact_list_len</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN154"><span class='Ref_to_Const'>MAX_EOXACT_LIST</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>            <a href="relcache.c.html#LN155"><span class='Ref_to_Global_Var'>eoxact_list</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN156"><span class='Ref_to_Global_Var'>eoxact_list_len</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN159"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rd_id<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>else</span> <span class='Operator'>\ 
</span>            <a href="relcache.c.html#LN157"><span class='Ref_to_Global_Var'>eoxact_list_overflowed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* 
 * EOXactTupleDescArray stores TupleDescs that (might) need AtEOXact 
 * cleanup work.  The array expands as needed; there is no hashtable because 
 * we don't need to access individual items except at EOXact. 
 */ 
</span><a name="LN172"></a><span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Operator'>*</span><span class='Declare_Var'>EOXactTupleDescArray</span><span class='Delimiter'>; 
</span><a name="LN173"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>NextEOXactTupleDescNum</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN174"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>EOXactTupleDescArrayLen</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      macros to manipulate the lookup hashtable 
 */ 
</span><a name="LN179"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>RelationCacheInsert</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>RELATION</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>replace_allowed</span><span class='Parentheses'>)</span>  <span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span>hentry<span class='Delimiter'>; </span><span class='Keyword'>bool </span>found<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    hentry <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                                           <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Operator'>&</span><span class='Parentheses'>((</span><a href="relcache.c.html#LN179"><span class='Ref_to_Parameter'>RELATION</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rd_id<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                                           <a href="../../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span>found<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>found<span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* see comments in RelationBuildDesc and RelationBuildLocalRelation */ </span><span class='Operator'>\ 
</span>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> _old_rel <span class='Operator'>= </span>hentry<span class='Operator'>-&GT;</span>reldesc<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN179"><span class='Ref_to_Parameter'>replace_allowed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        hentry<span class='Operator'>-&GT;</span>reldesc <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN179"><span class='Ref_to_Parameter'>RELATION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN400"><span class='Ref_to_Macro'>RelationHasReferenceCountZero</span></a><span class='Parentheses'>(</span>_old_rel<span class='Parentheses'>))</span> <span class='Operator'>\ 
</span>            <a href="relcache.c.html#LN246"><span class='Ref_to_Proto'>RelationDestroyRelation</span></a><span class='Parentheses'>(</span>_old_rel<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> <span class='Operator'>\ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"leaking still-referenced relcache entry for \"%s\""</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span>_old_rel<span class='Parentheses'>))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Control'>else</span> <span class='Operator'>\ 
</span>        hentry<span class='Operator'>-&GT;</span>reldesc <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN179"><span class='Ref_to_Parameter'>RELATION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end RelationCacheInsert &raquo; </span> <span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN201"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>RelationIdCacheLookup</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>ID</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>RELATION</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span>hentry<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    hentry <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                                           <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN201"><span class='Ref_to_Parameter'>ID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                                           <a href="../../../include/utils/hsearch.h.html#LN104"><span class='Ref_to_EnumConst'>HASH_FIND</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>hentry<span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <a href="relcache.c.html#LN201"><span class='Ref_to_Parameter'>RELATION</span></a> <span class='Operator'>= </span>hentry<span class='Operator'>-&GT;</span>reldesc<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Control'>else</span> <span class='Operator'>\ 
</span>        <a href="relcache.c.html#LN201"><span class='Ref_to_Parameter'>RELATION</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN213"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>RelationCacheDelete</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>RELATION</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span>hentry<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    hentry <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                                           <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Operator'>&</span><span class='Parentheses'>((</span><a href="relcache.c.html#LN213"><span class='Ref_to_Parameter'>RELATION</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rd_id<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                                           <a href="../../../include/utils/hsearch.h.html#LN106"><span class='Ref_to_EnumConst'>HASH_REMOVE</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>hentry <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"failed to delete relcache entry for OID %u"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>             <span class='Parentheses'>(</span><a href="relcache.c.html#LN213"><span class='Ref_to_Parameter'>RELATION</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rd_id<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Special cache for opclass-related information 
 * 
 * Note: only default support procs get cached, ie, those with 
 * lefttype = righttype = opcintype. 
 */ 
</span><a name="LN231"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>opclasscacheent</span> 
<span class='Delimiter'>{ 
</span><a name="LN233"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>opclassoid</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* lookup key: OID of opclass */ 
</span><a name="LN234"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>valid</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* set TRUE after successful fill-in */ 
</span><a name="LN235"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Member'>numSupport</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* max # of support procs (from pg_am) */ 
</span><a name="LN236"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>opcfamily</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* OID of opclass's family */ 
</span><a name="LN237"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>opcintype</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* OID of opclass's declared input type */ 
</span><a name="LN238"></a>    <a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Operator'>*</span><span class='Declare_Member'>supportProcs</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* OIDs of support procedures */ 
</span><a name="LN239"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>OpClassCacheEnt</span><span class='Delimiter'>; 
</span> 
<a name="LN241"></a><span class='Keyword'>static </span><a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Var'>OpClassCache</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* non-export function prototypes */ 
</span> 
<a name="LN246"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RelationDestroyRelation</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>remember_tupdesc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN247"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RelationClearRelation</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>rebuild</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN249"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RelationReloadIndexInfo</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN250"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RelationFlushRelation</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN251"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RememberToFreeTupleDescAtEOX</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>td</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN252"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AtEOXact_cleanup</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN253"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AtEOSubXact_cleanup</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Delimiter'>, 
</span><a name="LN254"></a>                    <a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>mySubid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>parentSubid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN255"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>load_relcache_init_file</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>shared</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN256"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>write_relcache_init_file</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>shared</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN257"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>write_item</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>fp</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN259"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>formrdesc</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>relationName</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationReltype</span><span class='Delimiter'>, 
</span><a name="LN260"></a>          <span class='Keyword'>bool </span><span class='Declare_Parameter'>isshared</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>hasoids</span><span class='Delimiter'>, 
</span><a name="LN261"></a>          <span class='Keyword'>int </span><span class='Declare_Parameter'>natts</span><span class='Delimiter'>, </span><span class='Keyword'>const </span>FormData_pg_attribute <span class='Operator'>*</span><span class='Declare_Parameter'>attrs</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN263"></a><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>ScanPgRelation</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>targetRelId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>indexOK</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>force_non_historic</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN264"></a><span class='Keyword'>static </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Prototype'>AllocateRelationDesc</span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Parameter'>relp</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN265"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RelationParseRelOptions</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN266"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RelationBuildTupleDesc</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN267"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RelationBuildPartitionKey</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN268"></a><span class='Keyword'>static </span><a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Prototype'>copy_partition_key</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>fromkey</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN269"></a><span class='Keyword'>static </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Prototype'>RelationBuildDesc</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>targetRelId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>insertIt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN270"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RelationInitPhysicalAddr</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN271"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>load_critical_index</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>indexoid</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>heapoid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN272"></a><span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Prototype'>GetPgClassDescriptor</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN273"></a><span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Prototype'>GetPgIndexDescriptor</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN274"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AttrDefaultFetch</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN275"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CheckConstraintFetch</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN276"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>CheckConstraintCmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN277"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>insert_ordered_oid</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>list</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>datum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN278"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>InitIndexAmRoutine</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN279"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>IndexSupportInitialize</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indclass</span><span class='Delimiter'>, 
</span><a name="LN280"></a>                       <a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexSupport</span><span class='Delimiter'>, 
</span><a name="LN281"></a>                       <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opFamily</span><span class='Delimiter'>, 
</span><a name="LN282"></a>                       <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opcInType</span><span class='Delimiter'>, 
</span><a name="LN283"></a>                       <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>maxSupportNumber</span><span class='Delimiter'>, 
</span><a name="LN284"></a>                       <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>maxAttributeNumber</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN285"></a><span class='Keyword'>static </span><a href="relcache.c.html#LN231"><span class='Ref_to_Typedef'>OpClassCacheEnt</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>LookupOpclassInfo</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorClassOid</span><span class='Delimiter'>, 
</span><a name="LN286"></a>                  <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>numSupport</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN287"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RelationCacheInitFileRemoveInDir</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tblspcpath</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN288"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>unlink_initfile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>initfilename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN289"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>equalPartitionDescs</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Parameter'>partdesc1</span><span class='Delimiter'>, 
</span><a name="LN290"></a>                    <a href="../../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Parameter'>partdesc2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *      ScanPgRelation 
 * 
 *      This is used by RelationBuildDesc to find a pg_class 
 *      tuple matching targetRelId.  The caller must hold at least 
 *      AccessShareLock on the target relid to prevent concurrent-update 
 *      scenarios; it isn't guaranteed that all scans used to build the 
 *      relcache entry will use the same snapshot.  If, for example, 
 *      an attribute were to be added after scanning pg_class and before 
 *      scanning pg_attribute, relnatts wouldn't match. 
 * 
 *      NB: the returned tuple has been copied into palloc'd storage 
 *      and must eventually be freed with heap_freetuple. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN308"></a><span class='Declare_Function'>ScanPgRelation</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>targetRelId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>indexOK</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>force_non_historic</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN310"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pg_class_tuple</span><span class='Delimiter'>; 
</span><a name="LN311"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_class_desc</span><span class='Delimiter'>; 
</span><a name="LN312"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>pg_class_scan</span><span class='Delimiter'>; 
</span><a name="LN313"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN314"></a>    <a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If something goes wrong during backend startup, we might find ourselves 
     * trying to read pg_class before we've selected a database.  That ain't 
     * gonna work, so bail out with a useful error message.  If this happens, 
     * it probably means a relcache entry that needs to be nailed isn't. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"cannot read pg_class without having selected a database"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * form a scan key 
     */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN313"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN308"><span class='Ref_to_Parameter'>targetRelId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open pg_class and fetch a tuple.  Force heap scan if we haven't yet 
     * built the critical relcache entries (this includes initdb and startup 
     * without a pg_internal.init file).  The caller can also force a heap 
     * scan by setting indexOK == false. 
     */ 
</span>    <a href="relcache.c.html#LN311"><span class='Ref_To_Local'>pg_class_desc</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The caller might need a tuple that's newer than the one the historic 
     * snapshot; currently the only case requiring to do so is looking up the 
     * relfilenode of non mapped system relations during decoding. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN308"><span class='Ref_to_Parameter'>force_non_historic</span></a><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN314"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../../include/utils/snapmgr.h.html#LN69"><span class='Ref_to_Proto'>GetNonHistoricCatalogSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN314"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../../include/utils/snapmgr.h.html#LN68"><span class='Ref_to_Proto'>GetCatalogSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN312"><span class='Ref_To_Local'>pg_class_scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN311"><span class='Ref_To_Local'>pg_class_desc</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN111"><span class='Ref_to_Const'>ClassOidIndexId</span></a><span class='Delimiter'>, 
</span>                                       <a href="relcache.c.html#LN308"><span class='Ref_to_Parameter'>indexOK</span></a> <span class='Operator'>&& </span><a href="relcache.c.html#LN128"><span class='Ref_to_Global_Var'>criticalRelcachesBuilt</span></a><span class='Delimiter'>, 
</span>                                       <a href="relcache.c.html#LN314"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, 
</span>                                       <span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN313"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN310"><span class='Ref_To_Local'>pg_class_tuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN312"><span class='Ref_To_Local'>pg_class_scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must copy tuple before releasing buffer. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN310"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>))</span> 
        <a href="relcache.c.html#LN310"><span class='Ref_To_Local'>pg_class_tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN310"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* all done */ 
</span>    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN312"><span class='Ref_To_Local'>pg_class_scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN311"><span class='Ref_To_Local'>pg_class_desc</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN310"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ScanPgRelation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      AllocateRelationDesc 
 * 
 *      This is used to allocate memory for a new relation descriptor 
 *      and initialize the rd_rel field from the given pg_class tuple. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> 
<a name="LN378"></a><span class='Declare_Function'>AllocateRelationDesc</span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Parameter'>relp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN380"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN381"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN382"></a>    <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>relationForm</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Relcache entries must live in CacheMemoryContext */ 
</span>    <a href="relcache.c.html#LN381"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * allocate and zero space for new relation descriptor 
     */ 
</span>    <a href="relcache.c.html#LN380"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN82"><span class='Ref_to_Struct'>RelationData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make sure relation is marked as having no open file yet */ 
</span>    <a href="relcache.c.html#LN380"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN86"><span class='Ref_to_Member'>rd_smgr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the relation tuple form 
     * 
     * We only allocate space for the fixed fields, ie, CLASS_TUPLE_SIZE. The 
     * variable-length fields (relacl, reloptions) are NOT stored in the 
     * relcache --- there'd be little point in it, since we don't copy the 
     * tuple's nulls bitmap and hence wouldn't know if the values are valid. 
     * Bottom line is that relacl *cannot* be retrieved from the relcache. Get 
     * it from the syscache if you need it.  The same goes for the original 
     * form of reloptions (however, we do store the parsed form of reloptions 
     * in rd_options). 
     */ 
</span>    <a href="relcache.c.html#LN382"><span class='Ref_To_Local'>relationForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN86"><span class='Ref_to_Const'>CLASS_TUPLE_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN382"><span class='Ref_To_Local'>relationForm</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN378"><span class='Ref_to_Parameter'>relp</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_class.h.html#LN86"><span class='Ref_to_Const'>CLASS_TUPLE_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* initialize relation tuple form */ 
</span>    <a href="relcache.c.html#LN380"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN382"><span class='Ref_To_Local'>relationForm</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* and allocate attribute tuple form storage */ 
</span>    <a href="relcache.c.html#LN380"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a> <span class='Operator'>= </span><a href="../../access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN382"><span class='Ref_To_Local'>relationForm</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>, 
</span>                                               <a href="relcache.c.html#LN382"><span class='Ref_To_Local'>relationForm</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* which we mark as a reference-counted tupdesc */ 
</span>    <a href="relcache.c.html#LN380"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN381"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN380"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AllocateRelationDesc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationParseRelOptions 
 *      Convert pg_class.reloptions into pre-parsed rd_options 
 * 
 * tuple is the real pg_class tuple (not rd_rel!) for relation 
 * 
 * Note: rd_rel and (if an index) rd_amroutine must be valid already 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN434"></a><span class='Declare_Function'>RelationParseRelOptions</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN436"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN434"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fall out if relkind should not have options */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN434"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch reloptions from tuple; have to use a hardwired descriptor because 
     * we might not have any other for pg_class yet (consider executing this 
     * code for pg_class itself) 
     */ 
</span>    <a href="relcache.c.html#LN436"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../../include/access/reloptions.h.html#LN261"><span class='Ref_to_Proto'>extractRelOptions</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN434"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, 
</span>                                <a href="relcache.c.html#LN272"><span class='Ref_to_Proto'>GetPgClassDescriptor</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                <a href="relcache.c.html#LN434"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> <span class='Operator'>? 
</span>                                <a href="relcache.c.html#LN434"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN180"><span class='Ref_to_Member'>rd_amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN204"><span class='Ref_to_Member'>amoptions</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy parsed data into CacheMemoryContext.  To guard against the 
     * possibility of leaks in the reloptions code, we want to do the actual 
     * parsing in the caller's memory context and copy the results into 
     * CacheMemoryContext after the fact. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN436"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN434"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN436"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN434"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN436"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN436"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN436"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end RelationParseRelOptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      RelationBuildTupleDesc 
 * 
 *      Form the relation's tuple descriptor from information in 
 *      the pg_attribute, pg_attrdef & pg_constraint system catalogs. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN486"></a><span class='Declare_Function'>RelationBuildTupleDesc</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN488"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pg_attribute_tuple</span><span class='Delimiter'>; 
</span><a name="LN489"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_attribute_desc</span><span class='Delimiter'>; 
</span><a name="LN490"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>pg_attribute_scan</span><span class='Delimiter'>; 
</span><a name="LN491"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN492"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>need</span><span class='Delimiter'>; 
</span><a name="LN493"></a>    <a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>constr</span><span class='Delimiter'>; 
</span><a name="LN494"></a>    <a href="../../../include/access/tupdesc.h.html#LN21"><span class='Ref_to_Typedef'>AttrDefault</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attrdef</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN495"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndef</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy some fields from pg_class row to rd_att */ 
</span>    <a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* unnecessary, but... */ 
</span>    <a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN42"><span class='Ref_to_Member'>has_not_null</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Form a scan key that selects only user attributes (attnum &GT; 0). 
     * (Eliminating system attribute rows at the index level is lots faster 
     * than fetching them.) 
     */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN491"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../../include/catalog/pg_attribute.h.html#LN194"><span class='Ref_to_Const'>Anum_pg_attribute_attrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN491"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../../include/catalog/pg_attribute.h.html#LN199"><span class='Ref_to_Const'>Anum_pg_attribute_attnum</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT2GT<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open pg_attribute and begin a scan.  Force heap scan if we haven't yet 
     * built the critical relcache entries (this includes initdb and startup 
     * without a pg_internal.init file). 
     */ 
</span>    <a href="relcache.c.html#LN489"><span class='Ref_To_Local'>pg_attribute_desc</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN490"><span class='Ref_To_Local'>pg_attribute_scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN489"><span class='Ref_To_Local'>pg_attribute_desc</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/catalog/indexing.h.html#LN93"><span class='Ref_to_Const'>AttributeRelidNumIndexId</span></a><span class='Delimiter'>, 
</span>                                           <a href="relcache.c.html#LN128"><span class='Ref_to_Global_Var'>criticalRelcachesBuilt</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <span class='Number'>2</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN491"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * add attribute data to relation-&GT;rd_att 
     */ 
</span>    <a href="relcache.c.html#LN492"><span class='Ref_To_Local'>need</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN488"><span class='Ref_To_Local'>pg_attribute_tuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN490"><span class='Ref_To_Local'>pg_attribute_scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN539"></a>        <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attp</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN539"><span class='Ref_To_Local'>attp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN488"><span class='Ref_To_Local'>pg_attribute_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN539"><span class='Ref_To_Local'>attp</span></a><span class='Operator'>-&GT;</span>attnum <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN539"><span class='Ref_To_Local'>attp</span></a><span class='Operator'>-&GT;</span>attnum <span class='Operator'>&GT; </span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid attribute number %d for %s"</span><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN539"><span class='Ref_To_Local'>attp</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN539"><span class='Ref_To_Local'>attp</span></a><span class='Operator'>-&GT;</span>attnum <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>               <a href="relcache.c.html#LN539"><span class='Ref_To_Local'>attp</span></a><span class='Delimiter'>, 
</span>               <a href="../../../include/catalog/pg_attribute.h.html#LN178"><span class='Ref_to_Const'>ATTRIBUTE_FIXED_PART_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update constraint/default info */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN539"><span class='Ref_To_Local'>attp</span></a><span class='Operator'>-&GT;</span>attnotnull<span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN42"><span class='Ref_to_Member'>has_not_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN539"><span class='Ref_To_Local'>attp</span></a><span class='Operator'>-&GT;</span>atthasdef<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN494"><span class='Ref_To_Local'>attrdef</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="relcache.c.html#LN494"><span class='Ref_To_Local'>attrdef</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN21"><span class='Ref_to_Typedef'>AttrDefault</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                           <a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>* 
</span>                                           <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN21"><span class='Ref_to_Typedef'>AttrDefault</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN494"><span class='Ref_To_Local'>attrdef</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN495"><span class='Ref_To_Local'>ndef</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN23"><span class='Ref_to_Member'>adnum</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN539"><span class='Ref_To_Local'>attp</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN494"><span class='Ref_To_Local'>attrdef</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN495"><span class='Ref_To_Local'>ndef</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN24"><span class='Ref_to_Member'>adbin</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN495"><span class='Ref_To_Local'>ndef</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="relcache.c.html#LN492"><span class='Ref_To_Local'>need</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN492"><span class='Ref_To_Local'>need</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(pg_a... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * end the scan and close the attribute relation 
     */ 
</span>    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN490"><span class='Ref_To_Local'>pg_attribute_scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN489"><span class='Ref_To_Local'>pg_attribute_desc</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN492"><span class='Ref_To_Local'>need</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"catalog is missing %d attribute(s) for relid %u"</span><span class='Delimiter'>, 
</span>             <a href="relcache.c.html#LN492"><span class='Ref_To_Local'>need</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The attcacheoff values we read from pg_attribute should all be -1 
     * ("unknown").  Verify this if assert checking is on.  They will be 
     * computed when and if needed during tuple access. 
     */ 
</span><span class='Directive'>#ifdef</span> USE_ASSERT_CHECKING 
    <span class='Delimiter'>{ 
</span><a name="LN589"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN589"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN589"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; </span><a href="relcache.c.html#LN589"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN589"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * However, we can easily set the attcacheoff value for the first 
     * attribute: it must be zero.  This eliminates the need for special cases 
     * for attnum=1 that used to exist in fastgetattr() and index_getattr(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up constraint/default info 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN42"><span class='Ref_to_Member'>has_not_null</span></a> <span class='Operator'>|| </span><a href="relcache.c.html#LN495"><span class='Ref_To_Local'>ndef</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relchecks<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN495"><span class='Ref_To_Local'>ndef</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>           <span class='Comment_Single_Line'>/* DEFAULTs */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN495"><span class='Ref_To_Local'>ndef</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Parentheses'>) 
</span>                <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN38"><span class='Ref_to_Member'>defval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN21"><span class='Ref_to_Typedef'>AttrDefault</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN494"><span class='Ref_To_Local'>attrdef</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN495"><span class='Ref_To_Local'>ndef</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN21"><span class='Ref_to_Typedef'>AttrDefault</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN38"><span class='Ref_to_Member'>defval</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN494"><span class='Ref_To_Local'>attrdef</span></a><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN40"><span class='Ref_to_Member'>num_defval</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN495"><span class='Ref_To_Local'>ndef</span></a><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN274"><span class='Ref_to_Proto'>AttrDefaultFetch</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN40"><span class='Ref_to_Member'>num_defval</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relchecks <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* CHECKs */ 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN41"><span class='Ref_to_Member'>num_check</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relchecks<span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN39"><span class='Ref_to_Member'>check</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN27"><span class='Ref_to_Typedef'>ConstrCheck</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                    <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN41"><span class='Ref_to_Member'>num_check</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN27"><span class='Ref_to_Typedef'>ConstrCheck</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN275"><span class='Ref_to_Proto'>CheckConstraintFetch</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN41"><span class='Ref_to_Member'>num_check</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if constr-&GT;has_not_null|... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN493"><span class='Ref_To_Local'>constr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN486"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end RelationBuildTupleDesc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      RelationBuildRuleLock 
 * 
 *      Form the relation's rewrite rules from information in 
 *      the pg_rewrite system catalog. 
 * 
 * Note: The rule parsetrees are potentially very complex node structures. 
 * To allow these trees to be freed when the relcache entry is flushed, 
 * we make a private memory context to hold the RuleLock information for 
 * each relcache entry that has associated rules.  The context is used 
 * just for rule info, not for any other subsidiary data of the relcache 
 * entry, because that keeps the update logic in RelationClearRelation() 
 * manageable.  The other subsidiary data structures are simple enough 
 * to be easy to free explicitly, anyway. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN658"></a><span class='Declare_Function'>RelationBuildRuleLock</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN660"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>rulescxt</span><span class='Delimiter'>; 
</span><a name="LN661"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN662"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>rewrite_tuple</span><span class='Delimiter'>; 
</span><a name="LN663"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rewrite_desc</span><span class='Delimiter'>; 
</span><a name="LN664"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>rewrite_tupdesc</span><span class='Delimiter'>; 
</span><a name="LN665"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>rewrite_scan</span><span class='Delimiter'>; 
</span><a name="LN666"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN667"></a>    <a href="../../../include/rewrite/prs2lock.h.html#LN39"><span class='Ref_to_Struct'>RuleLock</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rulelock</span><span class='Delimiter'>; 
</span><a name="LN668"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numlocks</span><span class='Delimiter'>; 
</span><a name="LN669"></a>    <a href="../../../include/rewrite/prs2lock.h.html#LN23"><span class='Ref_to_Struct'>RewriteRule</span></a> <span class='Operator'>**</span><span class='Declare_Local'>rules</span><span class='Delimiter'>; 
</span><a name="LN670"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxlocks</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make the private context.  Assume it'll not contain much data. 
     */ 
</span>    <a href="relcache.c.html#LN660"><span class='Ref_To_Local'>rulescxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN658"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN658"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN118"><span class='Ref_to_Member'>rd_rulescxt</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN660"><span class='Ref_To_Local'>rulescxt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * allocate an array to hold the rewrite rules (the array is extended if 
     * necessary) 
     */ 
</span>    <a href="relcache.c.html#LN670"><span class='Ref_To_Local'>maxlocks</span></a> <span class='Operator'>= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN669"><span class='Ref_To_Local'>rules</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/rewrite/prs2lock.h.html#LN23"><span class='Ref_to_Struct'>RewriteRule</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN660"><span class='Ref_To_Local'>rulescxt</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/rewrite/prs2lock.h.html#LN23"><span class='Ref_to_Struct'>RewriteRule</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN670"><span class='Ref_To_Local'>maxlocks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN668"><span class='Ref_To_Local'>numlocks</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * form a scan key 
     */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN666"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/catalog/pg_rewrite.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_rewrite_ev_class</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN658"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * open pg_rewrite and begin a scan 
     * 
     * Note: since we scan the rules using RewriteRelRulenameIndexId, we will 
     * be reading the rules in name order, except possibly during 
     * emergency-recovery operations (ie, IgnoreSystemIndexes). This in turn 
     * ensures that rules will be fired in name order. 
     */ 
</span>    <a href="relcache.c.html#LN663"><span class='Ref_To_Local'>rewrite_desc</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_rewrite.h.html#LN31"><span class='Ref_to_Const'>RewriteRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN664"><span class='Ref_To_Local'>rewrite_tupdesc</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN663"><span class='Ref_To_Local'>rewrite_desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN665"><span class='Ref_To_Local'>rewrite_scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN663"><span class='Ref_To_Local'>rewrite_desc</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/catalog/indexing.h.html#LN222"><span class='Ref_to_Const'>RewriteRelRulenameIndexId</span></a><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                      <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN666"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN662"><span class='Ref_To_Local'>rewrite_tuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN665"><span class='Ref_To_Local'>rewrite_scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN714"></a>        <a href="../../../include/catalog/pg_rewrite.h.html#LN52"><span class='Ref_to_Typedef'>Form_pg_rewrite</span></a> <span class='Declare_Local'>rewrite_form</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_rewrite.h.html#LN52"><span class='Ref_to_Typedef'>Form_pg_rewrite</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN662"><span class='Ref_To_Local'>rewrite_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN715"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN716"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>rule_datum</span><span class='Delimiter'>; 
</span><a name="LN717"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rule_str</span><span class='Delimiter'>; 
</span><a name="LN718"></a>        <a href="../../../include/rewrite/prs2lock.h.html#LN23"><span class='Ref_to_Struct'>RewriteRule</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rule</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN718"><span class='Ref_To_Local'>rule</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/rewrite/prs2lock.h.html#LN23"><span class='Ref_to_Struct'>RewriteRule</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN660"><span class='Ref_To_Local'>rulescxt</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/rewrite/prs2lock.h.html#LN23"><span class='Ref_to_Struct'>RewriteRule</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN718"><span class='Ref_To_Local'>rule</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN25"><span class='Ref_to_Member'>ruleId</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN662"><span class='Ref_To_Local'>rewrite_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN718"><span class='Ref_To_Local'>rule</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN26"><span class='Ref_to_Member'>event</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN714"><span class='Ref_To_Local'>rewrite_form</span></a><span class='Operator'>-&GT;</span>ev_type <span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN718"><span class='Ref_To_Local'>rule</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN29"><span class='Ref_to_Member'>enabled</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN714"><span class='Ref_To_Local'>rewrite_form</span></a><span class='Operator'>-&GT;</span>ev_enabled<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN718"><span class='Ref_To_Local'>rule</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN30"><span class='Ref_to_Member'>isInstead</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN714"><span class='Ref_To_Local'>rewrite_form</span></a><span class='Operator'>-&GT;</span>is_instead<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Must use heap_getattr to fetch ev_action and ev_qual.  Also, the 
         * rule strings are often large enough to be toasted.  To avoid 
         * leaking memory in the caller's context, do the detoasting here so 
         * we can free the detoasted version. 
         */ 
</span>        <a href="relcache.c.html#LN716"><span class='Ref_To_Local'>rule_datum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN662"><span class='Ref_To_Local'>rewrite_tuple</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/catalog/pg_rewrite.h.html#LN65"><span class='Ref_to_Const'>Anum_pg_rewrite_ev_action</span></a><span class='Delimiter'>, 
</span>                                  <a href="relcache.c.html#LN664"><span class='Ref_To_Local'>rewrite_tupdesc</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="relcache.c.html#LN715"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN715"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN717"><span class='Ref_To_Local'>rule_str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN716"><span class='Ref_To_Local'>rule_datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN661"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN660"><span class='Ref_To_Local'>rulescxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN718"><span class='Ref_To_Local'>rule</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN28"><span class='Ref_to_Member'>actions</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN717"><span class='Ref_To_Local'>rule_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN661"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN717"><span class='Ref_To_Local'>rule_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN716"><span class='Ref_To_Local'>rule_datum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN662"><span class='Ref_To_Local'>rewrite_tuple</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/catalog/pg_rewrite.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_rewrite_ev_qual</span></a><span class='Delimiter'>, 
</span>                                  <a href="relcache.c.html#LN664"><span class='Ref_To_Local'>rewrite_tupdesc</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="relcache.c.html#LN715"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN715"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN717"><span class='Ref_To_Local'>rule_str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN716"><span class='Ref_To_Local'>rule_datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN661"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN660"><span class='Ref_To_Local'>rulescxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN718"><span class='Ref_To_Local'>rule</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN27"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN717"><span class='Ref_To_Local'>rule_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN661"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN717"><span class='Ref_To_Local'>rule_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We want the rule's table references to be checked as though by the 
         * table owner, not the user referencing the rule.  Therefore, scan 
         * through the rule's actions and set the checkAsUser field on all 
         * rtable entries.  We have to look at the qual as well, in case it 
         * contains sublinks. 
         * 
         * The reason for doing this when the rule is loaded, rather than when 
         * it is stored, is that otherwise ALTER TABLE OWNER would have to 
         * grovel through stored rules to update checkAsUser fields. Scanning 
         * the rule tree during load is relatively cheap (compared to 
         * constructing it in the first place), so we do it here. 
         */ 
</span>        <a href="../../../include/rewrite/rewriteDefine.h.html#LN38"><span class='Ref_to_Proto'>setRuleCheckAsUser</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN718"><span class='Ref_To_Local'>rule</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN28"><span class='Ref_to_Member'>actions</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN658"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relowner<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/rewrite/rewriteDefine.h.html#LN38"><span class='Ref_to_Proto'>setRuleCheckAsUser</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN718"><span class='Ref_To_Local'>rule</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN27"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN658"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relowner<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN668"><span class='Ref_To_Local'>numlocks</span></a> <span class='Operator'>&GT;= </span><a href="relcache.c.html#LN670"><span class='Ref_To_Local'>maxlocks</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN670"><span class='Ref_To_Local'>maxlocks</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN669"><span class='Ref_To_Local'>rules</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/rewrite/prs2lock.h.html#LN23"><span class='Ref_to_Struct'>RewriteRule</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN669"><span class='Ref_To_Local'>rules</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/rewrite/prs2lock.h.html#LN23"><span class='Ref_to_Struct'>RewriteRule</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN670"><span class='Ref_To_Local'>maxlocks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="relcache.c.html#LN669"><span class='Ref_To_Local'>rules</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN668"><span class='Ref_To_Local'>numlocks</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="relcache.c.html#LN718"><span class='Ref_To_Local'>rule</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(rewr... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * end the scan and close the attribute relation 
     */ 
</span>    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN665"><span class='Ref_To_Local'>rewrite_scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN663"><span class='Ref_To_Local'>rewrite_desc</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * there might not be any rules (if relhasrules is out-of-date) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN668"><span class='Ref_To_Local'>numlocks</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN658"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN117"><span class='Ref_to_Member'>rd_rules</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN658"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN118"><span class='Ref_to_Member'>rd_rulescxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN660"><span class='Ref_To_Local'>rulescxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * form a RuleLock and insert into relation 
     */ 
</span>    <a href="relcache.c.html#LN667"><span class='Ref_To_Local'>rulelock</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/rewrite/prs2lock.h.html#LN39"><span class='Ref_to_Struct'>RuleLock</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN660"><span class='Ref_To_Local'>rulescxt</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/rewrite/prs2lock.h.html#LN39"><span class='Ref_to_Struct'>RuleLock</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN667"><span class='Ref_To_Local'>rulelock</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN41"><span class='Ref_to_Member'>numLocks</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN668"><span class='Ref_To_Local'>numlocks</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN667"><span class='Ref_To_Local'>rulelock</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN42"><span class='Ref_to_Member'>rules</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN669"><span class='Ref_To_Local'>rules</span></a><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN658"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN117"><span class='Ref_to_Member'>rd_rules</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN667"><span class='Ref_To_Local'>rulelock</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationBuildRuleLock &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationBuildPartitionKey 
 *      Build and attach to relcache partition key data of relation 
 * 
 * Partitioning key data is stored in CacheMemoryContext to ensure it survives 
 * as long as the relcache.  To avoid leaking memory in that context in case 
 * of an error partway through this function, we build the structure in the 
 * working context (which must be short-lived) and copy the completed 
 * structure into the cache memory. 
 * 
 * Also, since the structure being created here is sufficiently complex, we 
 * make a private child context of CacheMemoryContext for each relation that 
 * has associated partition key information.  That means no complicated logic 
 * to free individual elements whenever the relcache entry is flushed - just 
 * delete the context. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN826"></a><span class='Declare_Function'>RelationBuildPartitionKey</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN828"></a>    <a href="../../../include/catalog/pg_partitioned_table.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_partitioned_table</span></a> <span class='Declare_Local'>form</span><span class='Delimiter'>; 
</span><a name="LN829"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN830"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN831"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN832"></a>    <a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN833"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attrs</span><span class='Delimiter'>; 
</span><a name="LN834"></a>    <a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>opclass</span><span class='Delimiter'>; 
</span><a name="LN835"></a>    <a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>collation</span><span class='Delimiter'>; 
</span><a name="LN836"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>partexprs_item</span><span class='Delimiter'>; 
</span><a name="LN837"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN838"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>partkeycxt</span><span class='Delimiter'>, 
</span><a name="LN839"></a>                <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN829"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN74"><span class='Ref_to_EnumConst'>PARTRELID</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN826"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The following happens when we have created our pg_class entry but not 
     * the pg_partitioned_table entry yet. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN829"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN51"><span class='Ref_to_Struct'>PartitionKeyData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fixed-length attributes */ 
</span>    <a href="relcache.c.html#LN828"><span class='Ref_To_Local'>form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_partitioned_table.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_partitioned_table</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN829"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN828"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>partstrat<span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN828"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>partnatts<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can rely on the first variable-length attribute being mapped to the 
     * relevant field of the catalog's C struct, because all previous 
     * attributes are non-nullable and fixed-length. 
     */ 
</span>    <a href="relcache.c.html#LN833"><span class='Ref_To_Local'>attrs</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN828"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>partattrs<span class='Operator'>.</span>values<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* But use the hard way to retrieve further variable-length attributes */ 
</span>    <span class='Comment_Multi_Line'>/* Operator class */ 
</span>    <a href="relcache.c.html#LN837"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN74"><span class='Ref_to_EnumConst'>PARTRELID</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN829"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_partitioned_table.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_partitioned_table_partclass</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN830"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN830"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN834"><span class='Ref_To_Local'>opclass</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN837"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Collation */ 
</span>    <a href="relcache.c.html#LN837"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN74"><span class='Ref_to_EnumConst'>PARTRELID</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN829"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_partitioned_table.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_partitioned_table_partcollation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN830"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN830"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN835"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN837"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Expressions */ 
</span>    <a href="relcache.c.html#LN837"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN74"><span class='Ref_to_EnumConst'>PARTRELID</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN829"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_partitioned_table.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_partitioned_table_partexprs</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN830"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN830"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN883"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>exprString</span><span class='Delimiter'>; 
</span><a name="LN884"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN883"><span class='Ref_To_Local'>exprString</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN837"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN884"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN883"><span class='Ref_To_Local'>exprString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN883"><span class='Ref_To_Local'>exprString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Run the expressions through const-simplification since the planner 
         * will be comparing them to similarly-processed qual clause operands, 
         * and may fail to detect valid matches without this step.  We don't 
         * need to bother with canonicalize_qual() though, because partition 
         * expressions are not full-fledged qualification clauses. 
         */ 
</span>        <a href="relcache.c.html#LN884"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN80"><span class='Ref_to_Proto'>eval_const_expressions</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN884"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* May as well fix opfuncids too */ 
</span>        <a href="../../../include/nodes/nodeFuncs.h.html#LN45"><span class='Ref_to_Proto'>fix_opfuncids</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN884"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN57"><span class='Ref_to_Member'>partexprs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN884"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !isnull &raquo; </span> 
 
    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN60"><span class='Ref_to_Member'>partopfamily</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN61"><span class='Ref_to_Member'>partopcintype</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN62"><span class='Ref_to_Member'>partsupfunc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Gather type and collation info as well */ 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN69"><span class='Ref_to_Member'>parttypmod</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN70"><span class='Ref_to_Member'>parttyplen</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN71"><span class='Ref_to_Member'>parttypbyval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN72"><span class='Ref_to_Member'>parttypalign</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy partattrs and fill other per-attribute info */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN833"><span class='Ref_To_Local'>attrs</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN836"><span class='Ref_To_Local'>partexprs_item</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN57"><span class='Ref_to_Member'>partexprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN924"></a>        <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN925"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>opclasstup</span><span class='Delimiter'>; 
</span><a name="LN926"></a>        <a href="../../../include/catalog/pg_opclass.h.html#LN67"><span class='Ref_to_Typedef'>Form_pg_opclass</span></a> <span class='Declare_Local'>opclassform</span><span class='Delimiter'>; 
</span><a name="LN927"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcid</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Collect opfamily information */ 
</span>        <a href="relcache.c.html#LN925"><span class='Ref_To_Local'>opclasstup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN47"><span class='Ref_to_EnumConst'>CLAOID</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN834"><span class='Ref_To_Local'>opclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/c.h.html#LN485"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN925"><span class='Ref_To_Local'>opclasstup</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for opclass %u"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN834"><span class='Ref_To_Local'>opclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/c.h.html#LN485"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN926"><span class='Ref_To_Local'>opclassform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_opclass.h.html#LN67"><span class='Ref_to_Typedef'>Form_pg_opclass</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN925"><span class='Ref_To_Local'>opclasstup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN60"><span class='Ref_to_Member'>partopfamily</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="relcache.c.html#LN926"><span class='Ref_To_Local'>opclassform</span></a><span class='Operator'>-&GT;</span>opcfamily<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN61"><span class='Ref_to_Member'>partopcintype</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="relcache.c.html#LN926"><span class='Ref_To_Local'>opclassform</span></a><span class='Operator'>-&GT;</span>opcintype<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * A btree support function covers the cases of list and range methods 
         * currently supported. 
         */ 
</span>        <a href="relcache.c.html#LN927"><span class='Ref_To_Local'>funcid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN83"><span class='Ref_to_Proto'>get_opfamily_proc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN926"><span class='Ref_To_Local'>opclassform</span></a><span class='Operator'>-&GT;</span>opcfamily<span class='Delimiter'>, 
</span>                                   <a href="relcache.c.html#LN926"><span class='Ref_To_Local'>opclassform</span></a><span class='Operator'>-&GT;</span>opcintype<span class='Delimiter'>, 
</span>                                   <a href="relcache.c.html#LN926"><span class='Ref_To_Local'>opclassform</span></a><span class='Operator'>-&GT;</span>opcintype<span class='Delimiter'>, 
</span>                                   <a href="../../../include/access/nbtree.h.html#LN228"><span class='Ref_to_Const'>BTORDER_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN927"><span class='Ref_To_Local'>funcid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN62"><span class='Ref_to_Member'>partsupfunc</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Collation */ 
</span>        <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="relcache.c.html#LN835"><span class='Ref_To_Local'>collation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/c.h.html#LN485"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* Collect type information */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN924"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="relcache.c.html#LN826"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN924"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN69"><span class='Ref_to_Member'>parttypmod</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="relcache.c.html#LN826"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN924"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="relcache.c.html#LN826"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN924"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcollation<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN836"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN69"><span class='Ref_to_Member'>parttypmod</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN836"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN836"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                             <span class='Operator'>&</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN70"><span class='Ref_to_Member'>parttyplen</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                             <span class='Operator'>&</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN71"><span class='Ref_to_Member'>parttypbyval</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                             <span class='Operator'>&</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN72"><span class='Ref_to_Member'>parttypalign</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN831"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN925"><span class='Ref_To_Local'>opclasstup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;key-&GT;partnatts;... &raquo; </span> 
 
    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN829"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Success --- now copy to the cache memory */ 
</span>    <a href="relcache.c.html#LN838"><span class='Ref_To_Local'>partkeycxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN826"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN826"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN127"><span class='Ref_to_Member'>rd_partkeycxt</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN838"><span class='Ref_To_Local'>partkeycxt</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN839"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN826"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN127"><span class='Ref_to_Member'>rd_partkeycxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN826"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN128"><span class='Ref_to_Member'>rd_partkey</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN268"><span class='Ref_to_Proto'>copy_partition_key</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN832"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN839"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationBuildPartitionKey &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * copy_partition_key 
 * 
 * The copy is allocated in the current memory context. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> 
<a name="LN992"></a><span class='Declare_Function'>copy_partition_key</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>fromkey</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN994"></a>    <a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>newkey</span><span class='Delimiter'>; 
</span><a name="LN995"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN51"><span class='Ref_to_Struct'>PartitionKeyData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN57"><span class='Ref_to_Member'>partexprs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN57"><span class='Ref_to_Member'>partexprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN60"><span class='Ref_to_Member'>partopfamily</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN60"><span class='Ref_to_Member'>partopfamily</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN60"><span class='Ref_to_Member'>partopfamily</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN61"><span class='Ref_to_Member'>partopcintype</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN61"><span class='Ref_to_Member'>partopcintype</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN61"><span class='Ref_to_Member'>partopcintype</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN62"><span class='Ref_to_Member'>partsupfunc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN62"><span class='Ref_to_Member'>partsupfunc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN62"><span class='Ref_to_Member'>partsupfunc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN69"><span class='Ref_to_Member'>parttypmod</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN69"><span class='Ref_to_Member'>parttypmod</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN69"><span class='Ref_to_Member'>parttypmod</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN70"><span class='Ref_to_Member'>parttyplen</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN70"><span class='Ref_to_Member'>parttyplen</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN70"><span class='Ref_to_Member'>parttyplen</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN71"><span class='Ref_to_Member'>parttypbyval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN71"><span class='Ref_to_Member'>parttypbyval</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN71"><span class='Ref_to_Member'>parttypbyval</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN72"><span class='Ref_to_Member'>parttypalign</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN72"><span class='Ref_to_Member'>parttypalign</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN72"><span class='Ref_to_Member'>parttypalign</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN992"><span class='Ref_to_Parameter'>fromkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN995"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN994"><span class='Ref_To_Local'>newkey</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end copy_partition_key &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      equalRuleLocks 
 * 
 *      Determine whether two RuleLocks are equivalent 
 * 
 *      Probably this should be in the rules code someplace... 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1048"></a><span class='Declare_Function'>equalRuleLocks</span><span class='Parentheses'>(</span><a href="../../../include/rewrite/prs2lock.h.html#LN39"><span class='Ref_to_Struct'>RuleLock</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rlock1</span><span class='Delimiter'>, </span><a href="../../../include/rewrite/prs2lock.h.html#LN39"><span class='Ref_to_Struct'>RuleLock</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rlock2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1050"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * As of 7.3 we assume the rule ordering is repeatable, because 
     * RelationBuildRuleLock should read 'em in a consistent order.  So just 
     * compare corresponding slots. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1048"><span class='Ref_to_Parameter'>rlock1</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1048"><span class='Ref_to_Parameter'>rlock2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1048"><span class='Ref_to_Parameter'>rlock1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN41"><span class='Ref_to_Member'>numLocks</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN1048"><span class='Ref_to_Parameter'>rlock2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN41"><span class='Ref_to_Member'>numLocks</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1050"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN1050"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN1048"><span class='Ref_to_Parameter'>rlock1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN41"><span class='Ref_to_Member'>numLocks</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN1050"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1065"></a>            <a href="../../../include/rewrite/prs2lock.h.html#LN23"><span class='Ref_to_Struct'>RewriteRule</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rule1</span> <span class='Operator'>= </span><a href="relcache.c.html#LN1048"><span class='Ref_to_Parameter'>rlock1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN42"><span class='Ref_to_Member'>rules</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1050"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN1066"></a>            <a href="../../../include/rewrite/prs2lock.h.html#LN23"><span class='Ref_to_Struct'>RewriteRule</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rule2</span> <span class='Operator'>= </span><a href="relcache.c.html#LN1048"><span class='Ref_to_Parameter'>rlock2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN42"><span class='Ref_to_Member'>rules</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1050"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1065"><span class='Ref_To_Local'>rule1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN25"><span class='Ref_to_Member'>ruleId</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN1066"><span class='Ref_To_Local'>rule2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN25"><span class='Ref_to_Member'>ruleId</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1065"><span class='Ref_To_Local'>rule1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN26"><span class='Ref_to_Member'>event</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN1066"><span class='Ref_To_Local'>rule2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN26"><span class='Ref_to_Member'>event</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1065"><span class='Ref_To_Local'>rule1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN29"><span class='Ref_to_Member'>enabled</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN1066"><span class='Ref_To_Local'>rule2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN29"><span class='Ref_to_Member'>enabled</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1065"><span class='Ref_To_Local'>rule1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN30"><span class='Ref_to_Member'>isInstead</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN1066"><span class='Ref_To_Local'>rule2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN30"><span class='Ref_to_Member'>isInstead</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1065"><span class='Ref_To_Local'>rule1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN27"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1066"><span class='Ref_To_Local'>rule2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN27"><span class='Ref_to_Member'>qual</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1065"><span class='Ref_To_Local'>rule1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN28"><span class='Ref_to_Member'>actions</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1066"><span class='Ref_To_Local'>rule2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/prs2lock.h.html#LN28"><span class='Ref_to_Member'>actions</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rlock1!=NULL &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1048"><span class='Ref_to_Parameter'>rlock2</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end equalRuleLocks &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      equalPolicy 
 * 
 *      Determine whether two policies are equivalent 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1093"></a><span class='Declare_Function'>equalPolicy</span><span class='Parentheses'>(</span><a href="../../../include/rewrite/rowsecurity.h.html#LN19"><span class='Ref_to_Struct'>RowSecurityPolicy</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>policy1</span><span class='Delimiter'>, </span><a href="../../../include/rewrite/rowsecurity.h.html#LN19"><span class='Ref_to_Struct'>RowSecurityPolicy</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>policy2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1095"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1096"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>r1</span><span class='Delimiter'>, 
</span><a name="LN1097"></a>               <span class='Operator'>*</span><span class='Declare_Local'>r2</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy1</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN22"><span class='Ref_to_Member'>polcmd</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN22"><span class='Ref_to_Member'>polcmd</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN27"><span class='Ref_to_Member'>hassublinks</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN27"><span class='Ref_to_Member'>hassublinks</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN21"><span class='Ref_to_Member'>policy_name</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN21"><span class='Ref_to_Member'>policy_name</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN23"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN23"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN1096"><span class='Ref_To_Local'>r1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN23"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1097"><span class='Ref_To_Local'>r2</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN23"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1095"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN1095"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN23"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; </span><a href="relcache.c.html#LN1095"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1096"><span class='Ref_To_Local'>r1</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1095"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="relcache.c.html#LN1097"><span class='Ref_To_Local'>r2</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1095"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN25"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN25"><span class='Ref_to_Member'>qual</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN26"><span class='Ref_to_Member'>with_check_qual</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN26"><span class='Ref_to_Member'>with_check_qual</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if policy1!=NULL &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1093"><span class='Ref_to_Parameter'>policy2</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end equalPolicy &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      equalRSDesc 
 * 
 *      Determine whether two RowSecurityDesc's are equivalent 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1139"></a><span class='Declare_Function'>equalRSDesc</span><span class='Parentheses'>(</span><a href="../../../include/rewrite/rowsecurity.h.html#LN30"><span class='Ref_to_Struct'>RowSecurityDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rsdesc1</span><span class='Delimiter'>, </span><a href="../../../include/rewrite/rowsecurity.h.html#LN30"><span class='Ref_to_Struct'>RowSecurityDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rsdesc2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1141"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>, 
</span><a name="LN1142"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1139"><span class='Ref_to_Parameter'>rsdesc1</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="relcache.c.html#LN1139"><span class='Ref_to_Parameter'>rsdesc2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="relcache.c.html#LN1139"><span class='Ref_to_Parameter'>rsdesc1</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="relcache.c.html#LN1139"><span class='Ref_to_Parameter'>rsdesc2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="relcache.c.html#LN1139"><span class='Ref_to_Parameter'>rsdesc1</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="relcache.c.html#LN1139"><span class='Ref_to_Parameter'>rsdesc2</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1139"><span class='Ref_to_Parameter'>rsdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN33"><span class='Ref_to_Member'>policies</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1139"><span class='Ref_to_Parameter'>rsdesc2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN33"><span class='Ref_to_Member'>policies</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* RelationBuildRowSecurity should build policies in order */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1141"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1139"><span class='Ref_to_Parameter'>rsdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN33"><span class='Ref_to_Member'>policies</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1142"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1139"><span class='Ref_to_Parameter'>rsdesc2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN33"><span class='Ref_to_Member'>policies</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1157"></a>        <a href="../../../include/rewrite/rowsecurity.h.html#LN19"><span class='Ref_to_Struct'>RowSecurityPolicy</span></a> <span class='Operator'>*</span><span class='Declare_Local'>l</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/rewrite/rowsecurity.h.html#LN19"><span class='Ref_to_Struct'>RowSecurityPolicy</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1141"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1158"></a>        <a href="../../../include/rewrite/rowsecurity.h.html#LN19"><span class='Ref_to_Struct'>RowSecurityPolicy</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/rewrite/rowsecurity.h.html#LN19"><span class='Ref_to_Struct'>RowSecurityPolicy</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1142"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN1092"><span class='Ref_to_Func'>equalPolicy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1157"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1158"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end equalRSDesc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * equalPartitionDescs 
 *      Compare two partition descriptors for logical equality 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1172"></a><span class='Declare_Function'>equalPartitionDescs</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Parameter'>partdesc1</span><span class='Delimiter'>, 
</span><a name="LN1173"></a>                    <a href="../../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Parameter'>partdesc2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1175"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1172"><span class='Ref_to_Parameter'>partdesc1</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1173"><span class='Ref_to_Parameter'>partdesc2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1172"><span class='Ref_to_Parameter'>partdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN1173"><span class='Ref_to_Parameter'>partdesc2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN1172"><span class='Ref_to_Parameter'>key</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="relcache.c.html#LN1172"><span class='Ref_to_Parameter'>partdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Same oids? If the partitioning structure did not change, that is, 
         * no partitions were added or removed to the relation, the oids array 
         * should still match element-by-element. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN1175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN1172"><span class='Ref_to_Parameter'>partdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN1175"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1172"><span class='Ref_to_Parameter'>partdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN35"><span class='Ref_to_Member'>oids</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="relcache.c.html#LN1173"><span class='Ref_to_Parameter'>partdesc2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN35"><span class='Ref_to_Member'>oids</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now compare partition bound collections.  The logic to iterate over 
         * the collections is private to partition.c. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1172"><span class='Ref_to_Parameter'>partdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1173"><span class='Ref_to_Parameter'>partdesc2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/catalog/partition.h.html#LN73"><span class='Ref_to_Proto'>partition_bounds_equal</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1172"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1172"><span class='Ref_to_Parameter'>partdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a><span class='Delimiter'>, 
</span>                                        <a href="relcache.c.html#LN1173"><span class='Ref_to_Parameter'>partdesc2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1173"><span class='Ref_to_Parameter'>partdesc2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if partdesc1!=NULL &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1173"><span class='Ref_to_Parameter'>partdesc2</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end equalPartitionDescs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      RelationBuildDesc 
 * 
 *      Build a relation descriptor.  The caller must hold at least 
 *      AccessShareLock on the target relid. 
 * 
 *      The new descriptor is inserted into the hash table if insertIt is true. 
 * 
 *      Returns NULL if no pg_class row could be found for the given relid 
 *      (suggesting we are trying to access a just-deleted relation). 
 *      Any other error is reported via elog. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> 
<a name="LN1232"></a><span class='Declare_Function'>RelationBuildDesc</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>targetRelId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>insertIt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1234"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN1235"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN1236"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pg_class_tuple</span><span class='Delimiter'>; 
</span><a name="LN1237"></a>    <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>relp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * find the tuple in pg_class corresponding to the given relation id 
     */ 
</span>    <a href="relcache.c.html#LN1236"><span class='Ref_To_Local'>pg_class_tuple</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN263"><span class='Ref_to_Proto'>ScanPgRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1232"><span class='Ref_to_Parameter'>targetRelId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if no such tuple exists, return NULL 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1236"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get information from the pg_class_tuple 
     */ 
</span>    <a href="relcache.c.html#LN1235"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1236"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1237"><span class='Ref_To_Local'>relp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1236"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN1235"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN1232"><span class='Ref_to_Parameter'>targetRelId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * allocate storage for the relation descriptor, and copy pg_class_tuple 
     * to relation-&GT;rd_rel. 
     */ 
</span>    <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN264"><span class='Ref_to_Proto'>AllocateRelationDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1237"><span class='Ref_To_Local'>relp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize the relation's relation id (relation-&GT;rd_id) 
     */ 
</span>    <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="relcache.c.html#LN1235"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * normal relations are not nailed into the cache; nor can a pre-existing 
     * relation be new.  It could be temp though.  (Actually, it could be new 
     * too, but it's okay to forget that fact if forced to flush the entry.) 
     */ 
</span>    <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Operator'>: 
</span>            <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a> <span class='Operator'>= </span><a href="../../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/catalog/namespace.h.html#LN125"><span class='Ref_to_Proto'>isTempOrTempToastNamespace</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a> <span class='Operator'>= </span><a href="../../../include/storage/backendid.h.html#LN33"><span class='Ref_to_Macro'>BackendIdForTempRelations</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If it's a temp table, but not one of ours, we have to use 
                 * the slow, grotty method to figure out the owning backend. 
                 * 
                 * Note: it's possible that rd_backend gets set to MyBackendId 
                 * here, in case we are looking at a pg_class entry left over 
                 * from a crashed backend that coincidentally had the same 
                 * BackendId we're using.  We should *not* consider such a 
                 * table to be "ours"; this is why we need the separate 
                 * rd_islocaltemp flag.  The pg_class entry will get flushed 
                 * if/when we clean out the corresponding temp table namespace 
                 * in preparation for using it. 
                 */ 
</span>                <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/catalog/namespace.h.html#LN128"><span class='Ref_to_Proto'>GetTempNamespaceBackendId</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid relpersistence: %c"</span><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch relation-&GT;rd_rel-&GT;rel... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * initialize the tuple descriptor (relation-&GT;rd_att). 
     */ 
</span>    <a href="relcache.c.html#LN266"><span class='Ref_to_Proto'>RelationBuildTupleDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch rules and triggers that affect this relation 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasrules<span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN657"><span class='Ref_to_Func'>RelationBuildRuleLock</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN117"><span class='Ref_to_Member'>rd_rules</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN118"><span class='Ref_to_Member'>rd_rulescxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhastriggers<span class='Parentheses'>) 
</span>        <a href="../../../include/commands/trigger.h.html#LN125"><span class='Ref_to_Proto'>RelationBuildTriggers</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relrowsecurity<span class='Parentheses'>) 
</span>        <a href="../../../include/commands/policy.h.html#LN21"><span class='Ref_to_Proto'>RelationBuildRowSecurity</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN121"><span class='Ref_to_Member'>rd_rsdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* foreign key data is not loaded till asked for */ 
</span>    <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN124"><span class='Ref_to_Member'>rd_fkeylist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN125"><span class='Ref_to_Member'>rd_fkeyvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if a partitioned table, initialize key and partition descriptor info */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN267"><span class='Ref_to_Proto'>RelationBuildPartitionKey</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/catalog/partition.h.html#LN72"><span class='Ref_to_Proto'>RelationBuildPartitionDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN127"><span class='Ref_to_Member'>rd_partkeycxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN128"><span class='Ref_to_Member'>rd_partkey</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN130"><span class='Ref_to_Member'>rd_partdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN129"><span class='Ref_to_Member'>rd_pdcxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if it's an index, initialize index-related information 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relam<span class='Parentheses'>))</span> 
        <a href="../../../include/utils/relcache.h.html#LN67"><span class='Ref_to_Proto'>RelationInitIndexAccessInfo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* extract reloptions if any */ 
</span>    <a href="relcache.c.html#LN265"><span class='Ref_to_Proto'>RelationParseRelOptions</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1236"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize the relation lock manager information 
     */ 
</span>    <a href="../../../include/storage/lmgr.h.html#LN36"><span class='Ref_to_Proto'>RelationInitLockInfo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* see lmgr.c */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize physical addressing information for the relation 
     */ 
</span>    <a href="relcache.c.html#LN270"><span class='Ref_to_Proto'>RelationInitPhysicalAddr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make sure relation is marked as having no open file yet */ 
</span>    <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN86"><span class='Ref_to_Member'>rd_smgr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * now we can free the memory allocated for pg_class_tuple 
     */ 
</span>    <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1236"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert newly created relation into relcache hash table, if requested. 
     * 
     * There is one scenario in which we might find a hashtable entry already 
     * present, even though our caller failed to find it: if the relation is a 
     * system catalog or index that's used during relcache load, we might have 
     * recursively created the same relcache entry during the preceding steps. 
     * So allow RelationCacheInsert to delete any already-present relcache 
     * entry for the same OID.  The already-present entry should have refcount 
     * zero (else somebody forgot to close it); in the event that it doesn't, 
     * we'll elog a WARNING and leak the already-present entry. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1232"><span class='Ref_to_Parameter'>insertIt</span></a><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN179"><span class='Ref_to_Macro'>RelationCacheInsert</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* It's fully valid */ 
</span>    <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN1234"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationBuildDesc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Initialize the physical addressing info (RelFileNode) for a relcache entry 
 * 
 * Note: at the physical level, relations in the pg_global tablespace must 
 * be treated as shared, even if relisshared isn't set.  Hence we do not 
 * look at relisshared here. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1417"></a><span class='Declare_Function'>RelationInitPhysicalAddr</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltablespace<span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltablespace<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a> <span class='Operator'>= </span><a href="../init/globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_tablespace.h.html#LN63"><span class='Ref_to_Const'>GLOBALTABLESPACE_OID</span></a><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a> <span class='Operator'>= </span><a href="../init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relfilenode<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Even if we are using a decoding snapshot that doesn't represent the 
         * current state of the catalog we need to make sure the filenode 
         * points to the current file since the older file will be gone (or 
         * truncated). The new file will still contain older rows so lookups 
         * in them will work correctly. This wouldn't work correctly if 
         * rewrites were allowed to change the schema in an incompatible way, 
         * but those are prevented both on catalog tables and on user tables 
         * declared as additional catalog tables. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/snapmgr.h.html#LN105"><span class='Ref_to_Proto'>HistoricSnapshotActive</span></a><span class='Parentheses'>() 
</span>            <span class='Operator'>&& </span><a href="../../../include/utils/rel.h.html#LN559"><span class='Ref_to_Macro'>RelationIsAccessibleInLogicalDecoding</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>&& </span><a href="../../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1444"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>phys_tuple</span><span class='Delimiter'>; 
</span><a name="LN1445"></a>            <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>physrel</span><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN1444"><span class='Ref_To_Local'>phys_tuple</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN263"><span class='Ref_to_Proto'>ScanPgRelation</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/catalog/indexing.h.html#LN111"><span class='Ref_to_Const'>ClassOidIndexId</span></a><span class='Delimiter'>, 
</span>                                        <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1444"><span class='Ref_To_Local'>phys_tuple</span></a><span class='Parentheses'>))</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find pg_class entry for %u"</span><span class='Delimiter'>, 
</span>                     <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN1445"><span class='Ref_To_Local'>physrel</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1444"><span class='Ref_To_Local'>phys_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltablespace <span class='Operator'>= </span><a href="relcache.c.html#LN1445"><span class='Ref_To_Local'>physrel</span></a><span class='Operator'>-&GT;</span>reltablespace<span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relfilenode <span class='Operator'>= </span><a href="relcache.c.html#LN1445"><span class='Ref_To_Local'>physrel</span></a><span class='Operator'>-&GT;</span>relfilenode<span class='Delimiter'>; 
</span>            <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1444"><span class='Ref_To_Local'>phys_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relfilenode<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if relation-&GT;rd_rel-&GT;rel... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Consult the relation mapper */ 
</span>        <a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a> <span class='Operator'>= 
</span>            <a href="../../../include/utils/relmapper.h.html#LN37"><span class='Ref_to_Proto'>RelationMapOidToFilenode</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN115"><span class='Ref_to_Member'>rd_id</span></a><span class='Delimiter'>, 
</span>                                     <a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relisshared<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find relation mapping for relation \"%s\", OID %u"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN1417"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN115"><span class='Ref_to_Member'>rd_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end RelationInitPhysicalAddr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Fill in the IndexAmRoutine for an index relation. 
 * 
 * relation's rd_amhandler and rd_indexcxt must be valid already. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1480"></a><span class='Declare_Function'>InitIndexAmRoutine</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1482"></a>    <a href="../../../include/access/amapi.h.html#LN158"><span class='Ref_to_Struct'>IndexAmRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cached</span><span class='Delimiter'>, 
</span><a name="LN1483"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call the amhandler in current, short-lived memory context, just in case 
     * it leaks anything (it probably won't, but let's be paranoid). 
     */ 
</span>    <a href="relcache.c.html#LN1483"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="../../access/index/amapi.c.html#LN31"><span class='Ref_to_Func'>GetIndexAmRoutine</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1480"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN177"><span class='Ref_to_Member'>rd_amhandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OK, now transfer the data into relation's rd_indexcxt. */ 
</span>    <a href="relcache.c.html#LN1482"><span class='Ref_To_Local'>cached</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/amapi.h.html#LN158"><span class='Ref_to_Struct'>IndexAmRoutine</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1480"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN178"><span class='Ref_to_Member'>rd_indexcxt</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/amapi.h.html#LN158"><span class='Ref_to_Struct'>IndexAmRoutine</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN1482"><span class='Ref_To_Local'>cached</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1483"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/amapi.h.html#LN158"><span class='Ref_to_Struct'>IndexAmRoutine</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1480"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN180"><span class='Ref_to_Member'>rd_amroutine</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1482"><span class='Ref_To_Local'>cached</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1483"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end InitIndexAmRoutine &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Initialize index-access-method support data for an index relation 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1504"></a><span class='Declare_Function'>RelationInitIndexAccessInfo</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1506"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1507"></a>    <a href="../../../include/catalog/pg_am.h.html#LN45"><span class='Ref_to_Typedef'>Form_pg_am</span></a>  <span class='Declare_Local'>aform</span><span class='Delimiter'>; 
</span><a name="LN1508"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>indcollDatum</span><span class='Delimiter'>; 
</span><a name="LN1509"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>indclassDatum</span><span class='Delimiter'>; 
</span><a name="LN1510"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>indoptionDatum</span><span class='Delimiter'>; 
</span><a name="LN1511"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN1512"></a>    <a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>indcoll</span><span class='Delimiter'>; 
</span><a name="LN1513"></a>    <a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>indclass</span><span class='Delimiter'>; 
</span><a name="LN1514"></a>    <a href="../../../include/c.h.html#LN466"><span class='Ref_to_Typedef'>int2vector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>indoption</span><span class='Delimiter'>; 
</span><a name="LN1515"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>indexcxt</span><span class='Delimiter'>; 
</span><a name="LN1516"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1517"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span><span class='Delimiter'>; 
</span><a name="LN1518"></a>    <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Local'>amsupport</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make a copy of the pg_index entry for the index.  Since pg_index 
     * contains variable-length and possibly-null fields, we have to do this 
     * honestly rather than just treating it as a Form_pg_index struct. 
     */ 
</span>    <a href="relcache.c.html#LN1506"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1506"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for index %u"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1516"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1506"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1516"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1506"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up the index's access method, save the OID of its handler function 
     */ 
</span>    <a href="relcache.c.html#LN1506"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN35"><span class='Ref_to_EnumConst'>AMOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relam<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1506"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for access method %u"</span><span class='Delimiter'>, 
</span>             <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relam<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1507"><span class='Ref_To_Local'>aform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_am.h.html#LN45"><span class='Ref_to_Typedef'>Form_pg_am</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1506"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN177"><span class='Ref_to_Member'>rd_amhandler</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1507"><span class='Ref_To_Local'>aform</span></a><span class='Operator'>-&GT;</span>amhandler<span class='Delimiter'>; 
</span>    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1506"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN1517"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1517"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"relnatts disagrees with indnatts for index %u"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make the private context to hold index access info.  The reason we need 
     * a context, and not just a couple of pallocs, is so that we won't leak 
     * any subsidiary info attached to fmgr lookup records. 
     */ 
</span>    <a href="relcache.c.html#LN1515"><span class='Ref_To_Local'>indexcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN178"><span class='Ref_to_Member'>rd_indexcxt</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1515"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can fetch the index AM's API struct 
     */ 
</span>    <a href="relcache.c.html#LN278"><span class='Ref_to_Proto'>InitIndexAmRoutine</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate arrays to hold data 
     */ 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1515"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1517"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1515"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1517"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN1518"><span class='Ref_To_Local'>amsupport</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN180"><span class='Ref_to_Member'>rd_amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN168"><span class='Ref_to_Member'>amsupport</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1518"><span class='Ref_To_Local'>amsupport</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1578"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nsupport</span> <span class='Operator'>= </span><a href="relcache.c.html#LN1517"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><a href="relcache.c.html#LN1518"><span class='Ref_To_Local'>amsupport</span></a><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN183"><span class='Ref_to_Member'>rd_support</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1515"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1578"><span class='Ref_To_Local'>nsupport</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN184"><span class='Ref_to_Member'>rd_supportinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1515"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1578"><span class='Ref_To_Local'>nsupport</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN183"><span class='Ref_to_Member'>rd_support</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN184"><span class='Ref_to_Member'>rd_supportinfo</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN192"><span class='Ref_to_Member'>rd_indcollation</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1515"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1517"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN185"><span class='Ref_to_Member'>rd_indoption</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1515"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1517"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * indcollation cannot be referenced directly through the C struct, 
     * because it comes after the variable-width indkey field.  Must extract 
     * the datum the hard way... 
     */ 
</span>    <a href="relcache.c.html#LN1508"><span class='Ref_To_Local'>indcollDatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/catalog/pg_index.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_index_indcollation</span></a><span class='Delimiter'>, 
</span>                               <a href="relcache.c.html#LN273"><span class='Ref_to_Proto'>GetPgIndexDescriptor</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="relcache.c.html#LN1511"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN1511"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1512"><span class='Ref_To_Local'>indcoll</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1508"><span class='Ref_To_Local'>indcollDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN192"><span class='Ref_to_Member'>rd_indcollation</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1512"><span class='Ref_To_Local'>indcoll</span></a><span class='Operator'>-&GT;</span><a href="../../../include/c.h.html#LN485"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1517"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * indclass cannot be referenced directly through the C struct, because it 
     * comes after the variable-width indkey field.  Must extract the datum 
     * the hard way... 
     */ 
</span>    <a href="relcache.c.html#LN1509"><span class='Ref_To_Local'>indclassDatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/catalog/pg_index.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_index_indclass</span></a><span class='Delimiter'>, 
</span>                                <a href="relcache.c.html#LN273"><span class='Ref_to_Proto'>GetPgIndexDescriptor</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="relcache.c.html#LN1511"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN1511"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1513"><span class='Ref_To_Local'>indclass</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1509"><span class='Ref_To_Local'>indclassDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fill the support procedure OID array, as well as the info about 
     * opfamilies and opclass input types.  (aminfo and supportinfo are left 
     * as zeroes, and are filled on-the-fly when used) 
     */ 
</span>    <a href="relcache.c.html#LN279"><span class='Ref_to_Proto'>IndexSupportInitialize</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1513"><span class='Ref_To_Local'>indclass</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN183"><span class='Ref_to_Member'>rd_support</span></a><span class='Delimiter'>, 
</span>                           <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a><span class='Delimiter'>, 
</span>                           <a href="relcache.c.html#LN1518"><span class='Ref_To_Local'>amsupport</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1517"><span class='Ref_To_Local'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Similarly extract indoption and copy it to the cache entry 
     */ 
</span>    <a href="relcache.c.html#LN1510"><span class='Ref_To_Local'>indoptionDatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/catalog/pg_index.h.html#LN89"><span class='Ref_to_Const'>Anum_pg_index_indoption</span></a><span class='Delimiter'>, 
</span>                                 <a href="relcache.c.html#LN273"><span class='Ref_to_Proto'>GetPgIndexDescriptor</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="relcache.c.html#LN1511"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN1511"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1514"><span class='Ref_To_Local'>indoption</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN466"><span class='Ref_to_Typedef'>int2vector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1510"><span class='Ref_To_Local'>indoptionDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN185"><span class='Ref_to_Member'>rd_indoption</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1514"><span class='Ref_To_Local'>indoption</span></a><span class='Operator'>-&GT;</span><a href="../../../include/c.h.html#LN474"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1517"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * expressions, predicate, exclusion caches will be filled later 
     */ 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN186"><span class='Ref_to_Member'>rd_indexprs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN187"><span class='Ref_to_Member'>rd_indpred</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN188"><span class='Ref_to_Member'>rd_exclops</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN189"><span class='Ref_to_Member'>rd_exclprocs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN190"><span class='Ref_to_Member'>rd_exclstrats</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1504"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN191"><span class='Ref_to_Member'>rd_amcache</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationInitIndexAccessInfo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * IndexSupportInitialize 
 *      Initializes an index's cached opclass information, 
 *      given the index's pg_index.indclass entry. 
 * 
 * Data is returned into *indexSupport, *opFamily, and *opcInType, 
 * which are arrays allocated by the caller. 
 * 
 * The caller also passes maxSupportNumber and maxAttributeNumber, since these 
 * indicate the size of the arrays it has allocated --- but in practice these 
 * numbers must always match those obtainable from the system catalog entries 
 * for the index and access method. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1667"></a><span class='Declare_Function'>IndexSupportInitialize</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indclass</span><span class='Delimiter'>, 
</span><a name="LN1668"></a>                       <a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexSupport</span><span class='Delimiter'>, 
</span><a name="LN1669"></a>                       <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opFamily</span><span class='Delimiter'>, 
</span><a name="LN1670"></a>                       <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opcInType</span><span class='Delimiter'>, 
</span><a name="LN1671"></a>                       <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>maxSupportNumber</span><span class='Delimiter'>, 
</span><a name="LN1672"></a>                       <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>maxAttributeNumber</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1674"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attIndex</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1674"><span class='Ref_To_Local'>attIndex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN1674"><span class='Ref_To_Local'>attIndex</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN1672"><span class='Ref_to_Parameter'>maxAttributeNumber</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN1674"><span class='Ref_To_Local'>attIndex</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1678"></a>        <a href="relcache.c.html#LN231"><span class='Ref_to_Typedef'>OpClassCacheEnt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>opcentry</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1667"><span class='Ref_to_Parameter'>indclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/c.h.html#LN485"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1674"><span class='Ref_To_Local'>attIndex</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"bogus pg_index tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* look up the info for this opclass, using a cache */ 
</span>        <a href="relcache.c.html#LN1678"><span class='Ref_To_Local'>opcentry</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN285"><span class='Ref_to_Proto'>LookupOpclassInfo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1667"><span class='Ref_to_Parameter'>indclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/c.h.html#LN485"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1674"><span class='Ref_To_Local'>attIndex</span></a><span class='Delimiter'>], 
</span>                                     <a href="relcache.c.html#LN1671"><span class='Ref_to_Parameter'>maxSupportNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* copy cached data into relcache entry */ 
</span>        <a href="relcache.c.html#LN1669"><span class='Ref_to_Parameter'>opFamily</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1674"><span class='Ref_To_Local'>attIndex</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="relcache.c.html#LN1678"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN236"><span class='Ref_to_Member'>opcfamily</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1670"><span class='Ref_to_Parameter'>opcInType</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1674"><span class='Ref_To_Local'>attIndex</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="relcache.c.html#LN1678"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN237"><span class='Ref_to_Member'>opcintype</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1671"><span class='Ref_to_Parameter'>maxSupportNumber</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN1668"><span class='Ref_to_Parameter'>indexSupport</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1674"><span class='Ref_To_Local'>attIndex</span></a> <span class='Operator'>* </span><a href="relcache.c.html#LN1671"><span class='Ref_to_Parameter'>maxSupportNumber</span></a><span class='Delimiter'>], 
</span>                   <a href="relcache.c.html#LN1678"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN238"><span class='Ref_to_Member'>supportProcs</span></a><span class='Delimiter'>, 
</span>                   <a href="relcache.c.html#LN1671"><span class='Ref_to_Parameter'>maxSupportNumber</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end IndexSupportInitialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * LookupOpclassInfo 
 * 
 * This routine maintains a per-opclass cache of the information needed 
 * by IndexSupportInitialize().  This is more efficient than relying on 
 * the catalog cache, because we can load all the info about a particular 
 * opclass in a single indexscan of pg_amproc. 
 * 
 * The information from pg_am about expected range of support function 
 * numbers is passed in, rather than being looked up, mainly because the 
 * caller will have it already. 
 * 
 * Note there is no provision for flushing the cache.  This is OK at the 
 * moment because there is no way to ALTER any interesting properties of an 
 * existing opclass --- all you can do is drop it, which will result in 
 * a useless but harmless dead entry in the cache.  To support altering 
 * opclass membership (not the same as opfamily membership!), we'd need to 
 * be able to flush this cache as well as the contents of relcache entries 
 * for indexes. 
 */ 
</span><span class='Keyword'>static </span><a href="relcache.c.html#LN231"><span class='Ref_to_Typedef'>OpClassCacheEnt</span></a> <span class='Operator'>* 
</span><a name="LN1718"></a><span class='Declare_Function'>LookupOpclassInfo</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorClassOid</span><span class='Delimiter'>, 
</span><a name="LN1719"></a>                  <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>numSupport</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1721"></a>    <a href="relcache.c.html#LN231"><span class='Ref_to_Typedef'>OpClassCacheEnt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>opcentry</span><span class='Delimiter'>; 
</span><a name="LN1722"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN1723"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1724"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN1725"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN1726"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN1727"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>indexOK</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN241"><span class='Ref_to_Global_Var'>OpClassCache</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First time through: initialize the opclass cache */ 
</span><a name="LN1732"></a>        <a href="../../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN1732"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN1732"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1732"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1732"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN231"><span class='Ref_to_Typedef'>OpClassCacheEnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN241"><span class='Ref_to_Global_Var'>OpClassCache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"Operator class cache"</span><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="relcache.c.html#LN1732"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Also make sure CacheMemoryContext exists */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/catcache.h.html#LN168"><span class='Ref_to_Proto'>CreateCacheMemoryContext</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN231"><span class='Ref_to_Typedef'>OpClassCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN241"><span class='Ref_to_Global_Var'>OpClassCache</span></a><span class='Delimiter'>, 
</span>                                               <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="relcache.c.html#LN1718"><span class='Ref_to_Parameter'>operatorClassOid</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN1722"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN1722"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Need to allocate memory for new entry */ 
</span>        <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN234"><span class='Ref_to_Member'>valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* until known OK */ 
</span>        <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN235"><span class='Ref_to_Member'>numSupport</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1719"><span class='Ref_to_Parameter'>numSupport</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1719"><span class='Ref_to_Parameter'>numSupport</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN238"><span class='Ref_to_Member'>supportProcs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                       <a href="relcache.c.html#LN1719"><span class='Ref_to_Parameter'>numSupport</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN238"><span class='Ref_to_Member'>supportProcs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN1719"><span class='Ref_to_Parameter'>numSupport</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN235"><span class='Ref_to_Member'>numSupport</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When testing for cache-flush hazards, we intentionally disable the 
     * operator class cache and force reloading of the info on each call. This 
     * is helpful because we want to test the case where a cache flush occurs 
     * while we are loading the info, and it's very hard to provoke that if 
     * this happens only once per opclass per backend. 
     */ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>CLOBBER_CACHE_ALWAYS<span class='Parentheses'>) 
</span>    <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN234"><span class='Ref_to_Member'>valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN234"><span class='Ref_to_Member'>valid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Need to fill in new entry. 
     * 
     * To avoid infinite recursion during startup, force heap scans if we're 
     * looking up info for the opclasses used by the indexes we would like to 
     * reference here. 
     */ 
</span>    <a href="relcache.c.html#LN1727"><span class='Ref_To_Local'>indexOK</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN128"><span class='Ref_to_Global_Var'>criticalRelcachesBuilt</span></a> <span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="relcache.c.html#LN1718"><span class='Ref_to_Parameter'>operatorClassOid</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_opclass.h.html#LN144"><span class='Ref_to_Const'>OID_BTREE_OPS_OID</span></a> <span class='Operator'>&& 
</span>         <a href="relcache.c.html#LN1718"><span class='Ref_to_Parameter'>operatorClassOid</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_opclass.h.html#LN117"><span class='Ref_to_Const'>INT2_BTREE_OPS_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We have to fetch the pg_opclass row to determine its opfamily and 
     * opcintype, which are needed to look up related operators and functions. 
     * It'd be convenient to use the syscache here, but that probably doesn't 
     * work while bootstrapping. 
     */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN1725"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1718"><span class='Ref_to_Parameter'>operatorClassOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1723"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1724"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1723"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN199"><span class='Ref_to_Const'>OpclassOidIndexId</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1727"><span class='Ref_To_Local'>indexOK</span></a><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN1725"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1726"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1724"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1808"></a>        <a href="../../../include/catalog/pg_opclass.h.html#LN67"><span class='Ref_to_Typedef'>Form_pg_opclass</span></a> <span class='Declare_Local'>opclassform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_opclass.h.html#LN67"><span class='Ref_to_Typedef'>Form_pg_opclass</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1726"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN236"><span class='Ref_to_Member'>opcfamily</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1808"><span class='Ref_To_Local'>opclassform</span></a><span class='Operator'>-&GT;</span>opcfamily<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN237"><span class='Ref_to_Member'>opcintype</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1808"><span class='Ref_To_Local'>opclassform</span></a><span class='Operator'>-&GT;</span>opcintype<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for opclass %u"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN1718"><span class='Ref_to_Parameter'>operatorClassOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1724"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1723"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan pg_amproc to obtain support procs for the opclass.  We only fetch 
     * the default ones (those with lefttype = righttype = opcintype). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1719"><span class='Ref_to_Parameter'>numSupport</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN1725"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                    <a href="../../../include/catalog/pg_amproc.h.html#LN65"><span class='Ref_to_Const'>Anum_pg_amproc_amprocfamily</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN236"><span class='Ref_to_Member'>opcfamily</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN1725"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                    <a href="../../../include/catalog/pg_amproc.h.html#LN66"><span class='Ref_to_Const'>Anum_pg_amproc_amproclefttype</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN237"><span class='Ref_to_Member'>opcintype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN1725"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                    <a href="../../../include/catalog/pg_amproc.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_amproc_amprocrighttype</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN237"><span class='Ref_to_Member'>opcintype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1723"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_amproc.h.html#LN42"><span class='Ref_to_Const'>AccessMethodProcedureRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1724"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1723"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN81"><span class='Ref_to_Const'>AccessMethodProcedureIndexId</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1727"><span class='Ref_To_Local'>indexOK</span></a><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN1725"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1726"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1724"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1843"></a>            <a href="../../../include/catalog/pg_amproc.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_amproc</span></a> <span class='Declare_Local'>amprocform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_amproc.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_amproc</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1726"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1843"><span class='Ref_To_Local'>amprocform</span></a><span class='Operator'>-&GT;</span>amprocnum <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a><span class='Parentheses'>) </span><a href="relcache.c.html#LN1843"><span class='Ref_To_Local'>amprocform</span></a><span class='Operator'>-&GT;</span>amprocnum <span class='Operator'>&GT; </span><a href="relcache.c.html#LN1719"><span class='Ref_to_Parameter'>numSupport</span></a><span class='Parentheses'>)</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid amproc number %d for opclass %u"</span><span class='Delimiter'>, 
</span>                     <a href="relcache.c.html#LN1843"><span class='Ref_To_Local'>amprocform</span></a><span class='Operator'>-&GT;</span>amprocnum<span class='Delimiter'>, </span><a href="relcache.c.html#LN1718"><span class='Ref_to_Parameter'>operatorClassOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN238"><span class='Ref_to_Member'>supportProcs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1843"><span class='Ref_To_Local'>amprocform</span></a><span class='Operator'>-&GT;</span>amprocnum <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="relcache.c.html#LN1843"><span class='Ref_To_Local'>amprocform</span></a><span class='Operator'>-&GT;</span>amproc<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1724"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1723"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if numSupport&GT;0 &raquo; </span> 
 
    <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN234"><span class='Ref_to_Member'>valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="relcache.c.html#LN1721"><span class='Ref_To_Local'>opcentry</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end LookupOpclassInfo &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *      formrdesc 
 * 
 *      This is a special cut-down version of RelationBuildDesc(), 
 *      used while initializing the relcache. 
 *      The relation descriptor is built just from the supplied parameters, 
 *      without actually looking at any system table entries.  We cheat 
 *      quite a lot since we only need to work for a few basic system 
 *      catalogs. 
 * 
 * formrdesc is currently used for: pg_database, pg_authid, pg_auth_members, 
 * pg_shseclabel, pg_class, pg_attribute, pg_proc, and pg_type 
 * (see RelationCacheInitializePhase2/3). 
 * 
 * Note that these catalogs can't have constraints (except attnotnull), 
 * default values, rules, or triggers, since we don't cope with any of that. 
 * (Well, actually, this only matters for properties that need to be valid 
 * during bootstrap or before RelationCacheInitializePhase3 runs, and none of 
 * these properties matter then...) 
 * 
 * NOTE: we assume we are already switched into CacheMemoryContext. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1886"></a><span class='Declare_Function'>formrdesc</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>relationName</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationReltype</span><span class='Delimiter'>, 
</span><a name="LN1887"></a>          <span class='Keyword'>bool </span><span class='Declare_Parameter'>isshared</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>hasoids</span><span class='Delimiter'>, 
</span><a name="LN1888"></a>          <span class='Keyword'>int </span><span class='Declare_Parameter'>natts</span><span class='Delimiter'>, </span><span class='Keyword'>const </span>FormData_pg_attribute <span class='Operator'>*</span><span class='Declare_Parameter'>attrs</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1890"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN1891"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1892"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_not_null</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * allocate new relation desc, clear all fields of reldesc 
     */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN82"><span class='Ref_to_Struct'>RelationData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make sure relation is marked as having no open file yet */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN86"><span class='Ref_to_Member'>rd_smgr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize reference count: 1 because it is nailed in cache 
     */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * all entries built with this routine are nailed-in-cache; none are for 
     * new or temp relations. 
     */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a> <span class='Operator'>= </span><a href="../../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize relation tuple form 
     * 
     * The data we insert here is pretty incomplete/bogus, but it'll serve to 
     * get us launched.  RelationCacheInitializePhase3() will read the real 
     * data from pg_class and replace what we've done here.  Note in 
     * particular that relowner is left as zero; this cues 
     * RelationCacheInitializePhase3 that the real data isn't there yet. 
     */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN86"><span class='Ref_to_Const'>CLASS_TUPLE_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relname<span class='Delimiter'>, </span><a href="relcache.c.html#LN1886"><span class='Ref_to_Parameter'>relationName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnamespace <span class='Operator'>= </span><a href="../../../include/catalog/pg_namespace.h.html#LN70"><span class='Ref_to_Const'>PG_CATALOG_NAMESPACE</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype <span class='Operator'>= </span><a href="relcache.c.html#LN1886"><span class='Ref_to_Parameter'>relationReltype</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's important to distinguish between shared and non-shared relations, 
     * even at bootstrap time, to make sure we know where they are stored. 
     */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relisshared <span class='Operator'>= </span><a href="relcache.c.html#LN1887"><span class='Ref_to_Parameter'>isshared</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1887"><span class='Ref_to_Parameter'>isshared</span></a><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltablespace <span class='Operator'>= </span><a href="../../../include/catalog/pg_tablespace.h.html#LN63"><span class='Ref_to_Const'>GLOBALTABLESPACE_OID</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* formrdesc is used only for permanent relations */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>= </span><a href="../../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ... and they're always populated, too */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispopulated <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relreplident <span class='Operator'>= </span><a href="../../../include/catalog/pg_class.h.html#LN176"><span class='Ref_to_Const'>REPLICA_IDENTITY_NOTHING</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpages <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltuples <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relallvisible <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>= </span><a href="../../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids <span class='Operator'>= </span><a href="relcache.c.html#LN1887"><span class='Ref_to_Parameter'>hasoids</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><a href="relcache.c.html#LN1888"><span class='Ref_to_Parameter'>natts</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize attribute tuple form 
     * 
     * Unlike the case with the relation tuple, this data had better be right 
     * because it will never be replaced.  The data comes from 
     * src/include/catalog/ headers via genbki.pl. 
     */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a> <span class='Operator'>= </span><a href="../../access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1888"><span class='Ref_to_Parameter'>natts</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN1887"><span class='Ref_to_Parameter'>hasoids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* mark as refcounted */ 
</span> 
    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1886"><span class='Ref_to_Parameter'>relationReltype</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* unnecessary, but... */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize tuple desc info 
     */ 
</span>    <a href="relcache.c.html#LN1892"><span class='Ref_To_Local'>has_not_null</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1891"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN1891"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN1888"><span class='Ref_to_Parameter'>natts</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN1891"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1891"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>               <span class='Operator'>&</span><a href="relcache.c.html#LN1888"><span class='Ref_to_Parameter'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1891"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>               <a href="../../../include/catalog/pg_attribute.h.html#LN178"><span class='Ref_to_Const'>ATTRIBUTE_FIXED_PART_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1892"><span class='Ref_To_Local'>has_not_null</span></a> <span class='Operator'>|= </span><a href="relcache.c.html#LN1888"><span class='Ref_to_Parameter'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1891"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span>attnotnull<span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* make sure attcacheoff is valid */ 
</span>        <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN1891"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* initialize first attribute's attcacheoff, cf RelationBuildTupleDesc */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* mark not-null status */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN1892"><span class='Ref_To_Local'>has_not_null</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1987"></a>        <a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>constr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN1987"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN42"><span class='Ref_to_Member'>has_not_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1987"><span class='Ref_To_Local'>constr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize relation id from info in att array (my, this is ugly) 
     */ 
</span>    <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attrelid<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * All relations made with formrdesc are mapped.  This is necessarily so 
     * because there is no other way to know what filenode they currently 
     * have.  In bootstrap mode, add them to the initial relation mapper data, 
     * specifying that the initial filenode is the same as the OID. 
     */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relfilenode <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
        <a href="../../../include/utils/relmapper.h.html#LN41"><span class='Ref_to_Proto'>RelationMapUpdateMap</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="relcache.c.html#LN1887"><span class='Ref_to_Parameter'>isshared</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize the relation lock manager information 
     */ 
</span>    <a href="../../../include/storage/lmgr.h.html#LN36"><span class='Ref_to_Proto'>RelationInitLockInfo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* see lmgr.c */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize physical addressing information for the relation 
     */ 
</span>    <a href="relcache.c.html#LN270"><span class='Ref_to_Proto'>RelationInitPhysicalAddr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize the rel-has-index flag, using hardwired knowledge 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* In bootstrap mode, we have no indexes */ 
</span>        <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasindex <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Otherwise, all the rels formrdesc is used for have indexes */ 
</span>        <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasindex <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * add new reldesc to relcache 
     */ 
</span>    <a href="relcache.c.html#LN179"><span class='Ref_to_Macro'>RelationCacheInsert</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* It's fully valid */ 
</span>    <a href="relcache.c.html#LN1890"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end formrdesc &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *               Relation Descriptor Lookup Interface 
 * ---------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      RelationIdGetRelation 
 * 
 *      Lookup a reldesc by OID; make one if not already in cache. 
 * 
 *      Returns NULL if no pg_class row could be found for the given relid 
 *      (suggesting we are trying to access a just-deleted relation). 
 *      Any other error is reported via elog. 
 * 
 *      NB: caller should already have at least AccessShareLock on the 
 *      relation ID, else there are nasty race conditions. 
 * 
 *      NB: relation ref count is incremented, or set to 1 if new entry. 
 *      Caller should eventually decrement count.  (Usually, 
 *      that happens by calling RelationClose().) 
 */ 
</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> 
<a name="LN2066"></a><span class='Declare_Function'>RelationIdGetRelation</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2068"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rd</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make sure we're in an xact, even if this ends up being a cache hit */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * first try to find reldesc in the cache 
     */ 
</span>    <a href="relcache.c.html#LN201"><span class='Ref_to_Macro'>RelationIdCacheLookup</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2066"><span class='Ref_to_Parameter'>relationId</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN389"><span class='Ref_to_Macro'>RelationIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/rel.h.html#LN635"><span class='Ref_to_Proto'>RelationIncrementReferenceCount</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* revalidate cache entry if necessary */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Indexes only have a limited number of possible schema changes, 
             * and we don't want to use the full-blown procedure because it's 
             * a headache for indexes that reload itself depends on. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>                <a href="relcache.c.html#LN249"><span class='Ref_to_Proto'>RelationReloadIndexInfo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="relcache.c.html#LN247"><span class='Ref_to_Proto'>RelationClearRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * no reldesc in the cache, so have RelationBuildDesc() build one and add 
     * it. 
     */ 
</span>    <a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN269"><span class='Ref_to_Proto'>RelationBuildDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2066"><span class='Ref_to_Parameter'>relationId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN389"><span class='Ref_to_Macro'>RelationIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/rel.h.html#LN635"><span class='Ref_to_Proto'>RelationIncrementReferenceCount</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="relcache.c.html#LN2068"><span class='Ref_To_Local'>rd</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationIdGetRelation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *              cache invalidation support routines 
 * ---------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RelationIncrementReferenceCount 
 *      Increments relation reference count. 
 * 
 * Note: bootstrap mode has its own weird ideas about relation refcount 
 * behavior; we ought to fix it someday, but for now, just disable 
 * reference count ownership tracking in bootstrap mode. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2122"></a><span class='Declare_Function'>RelationIncrementReferenceCount</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/resowner_private.h.html#LN49"><span class='Ref_to_Proto'>ResourceOwnerEnlargeRelationRefs</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN2122"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
        <a href="../../../include/utils/resowner_private.h.html#LN50"><span class='Ref_to_Proto'>ResourceOwnerRememberRelationRef</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2122"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RelationDecrementReferenceCount 
 *      Decrements relation reference count. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2135"></a><span class='Declare_Function'>RelationDecrementReferenceCount</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN2135"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN2135"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>-= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
        <a href="../../../include/utils/resowner_private.h.html#LN52"><span class='Ref_to_Proto'>ResourceOwnerForgetRelationRef</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2135"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RelationClose - close an open relation 
 * 
 *  Actually, we just decrement the refcount. 
 * 
 *  NOTE: if compiled with -DRELCACHE_FORCE_RELEASE then relcache entries 
 *  will be freed as soon as their refcount goes to zero.  In combination 
 *  with aset.c's CLOBBER_FREED_MEMORY option, this provides a good test 
 *  to catch references to already-released relcache entries.  It slows 
 *  things down quite a bit, however. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2155"></a><span class='Declare_Function'>RelationClose</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Note: no locking manipulations needed */ 
</span>    <a href="../../../include/utils/rel.h.html#LN636"><span class='Ref_to_Proto'>RelationDecrementReferenceCount</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2155"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> RELCACHE_FORCE_RELEASE 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN400"><span class='Ref_to_Macro'>RelationHasReferenceCountZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2155"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="relcache.c.html#LN2155"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>== </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a> <span class='Operator'>&& 
</span>        <a href="relcache.c.html#LN2155"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>== </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Parentheses'>)</span> 
        <a href="relcache.c.html#LN247"><span class='Ref_to_Proto'>RelationClearRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2155"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RelationReloadIndexInfo - reload minimal information for an open index 
 * 
 *  This function is used only for indexes.  A relcache inval on an index 
 *  can mean that its pg_class or pg_index row changed.  There are only 
 *  very limited changes that are allowed to an existing index's schema, 
 *  so we can update the relcache entry without a complete rebuild; which 
 *  is fortunate because we can't rebuild an index entry that is "nailed" 
 *  and/or in active use.  We support full replacement of the pg_class row, 
 *  as well as updates of a few simple fields of the pg_index row. 
 * 
 *  We can't necessarily reread the catalog rows right away; we might be 
 *  in a failed transaction when we receive the SI notification.  If so, 
 *  RelationClearRelation just marks the entry as invalid by setting 
 *  rd_isvalid to false.  This routine is called to fix the entry when it 
 *  is next needed. 
 * 
 *  We assume that at the time we are called, we have at least AccessShareLock 
 *  on the target index.  (Note: in the calls from RelationClearRelation, 
 *  this is legitimate because we know the rel has positive refcount.) 
 * 
 *  If the target index is an index on pg_class or pg_index, we'd better have 
 *  previously gotten at least AccessShareLock on its underlying catalog, 
 *  else we are at risk of deadlock against someone trying to exclusive-lock 
 *  the heap and index in that order.  This is ensured in current usage by 
 *  only applying this to indexes being opened or having positive refcount. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2196"></a><span class='Declare_Function'>RelationReloadIndexInfo</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2198"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>indexOK</span><span class='Delimiter'>; 
</span><a name="LN2199"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pg_class_tuple</span><span class='Delimiter'>; 
</span><a name="LN2200"></a>    <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>relp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Should be called only for invalidated indexes */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> <span class='Operator'>&& 
</span>           <span class='Operator'>!</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ensure it's closed at smgr level */ 
</span>    <a href="../../../include/utils/rel.h.html#LN472"><span class='Ref_to_Macro'>RelationCloseSmgr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must free any AM cached data upon relcache flush */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN191"><span class='Ref_to_Member'>rd_amcache</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN191"><span class='Ref_to_Member'>rd_amcache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN191"><span class='Ref_to_Member'>rd_amcache</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a shared index, we might be called before backend startup has 
     * finished selecting a database, in which case we have no way to read 
     * pg_class yet.  However, a shared index can never have any significant 
     * schema updates, so it's okay to ignore the invalidation signal.  Just 
     * mark it valid and return without doing anything more. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relisshared <span class='Operator'>&& !</span><a href="relcache.c.html#LN128"><span class='Ref_to_Global_Var'>criticalRelcachesBuilt</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the pg_class row 
     * 
     * Don't try to use an indexscan of pg_class_oid_index to reload the info 
     * for pg_class_oid_index ... 
     */ 
</span>    <a href="relcache.c.html#LN2198"><span class='Ref_To_Local'>indexOK</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/catalog/indexing.h.html#LN111"><span class='Ref_to_Const'>ClassOidIndexId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN2199"><span class='Ref_To_Local'>pg_class_tuple</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN263"><span class='Ref_to_Proto'>ScanPgRelation</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN2198"><span class='Ref_To_Local'>indexOK</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2199"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find pg_class tuple for index %u"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN2200"><span class='Ref_To_Local'>relp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2199"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2200"><span class='Ref_To_Local'>relp</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_class.h.html#LN86"><span class='Ref_to_Const'>CLASS_TUPLE_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Reload reloptions in case they changed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN265"><span class='Ref_to_Proto'>RelationParseRelOptions</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2199"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* done with pg_class tuple */ 
</span>    <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2199"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* We must recalculate physical address in case it changed */ 
</span>    <a href="relcache.c.html#LN270"><span class='Ref_to_Proto'>RelationInitPhysicalAddr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For a non-system index, there are fields of the pg_index row that are 
     * allowed to change, so re-read that row and update the relcache entry. 
     * Most of the info derived from pg_index (such as support function lookup 
     * info) cannot change, and indeed the whole point of this routine is to 
     * update the relcache entry without clobbering that data; so wholesale 
     * replacement is not appropriate. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/catalog/catalog.h.html#LN29"><span class='Ref_to_Proto'>IsSystemRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2259"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2260"></a>        <a href="../../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a> <span class='Declare_Local'>index</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN2259"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2259"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for index %u"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2260"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2259"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Basically, let's just copy all the bool fields.  There are one or 
         * two of these that can't actually change in the current code, but 
         * it's not worth it to track exactly which ones they are.  None of 
         * the array fields are allowed to change, though. 
         */ 
</span>        <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indisunique <span class='Operator'>= </span><a href="relcache.c.html#LN2260"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indisunique<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indisprimary <span class='Operator'>= </span><a href="relcache.c.html#LN2260"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indisprimary<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indisexclusion <span class='Operator'>= </span><a href="relcache.c.html#LN2260"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indisexclusion<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indimmediate <span class='Operator'>= </span><a href="relcache.c.html#LN2260"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indimmediate<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indisclustered <span class='Operator'>= </span><a href="relcache.c.html#LN2260"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indisclustered<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indisvalid <span class='Operator'>= </span><a href="relcache.c.html#LN2260"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indisvalid<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indcheckxmin <span class='Operator'>= </span><a href="relcache.c.html#LN2260"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indcheckxmin<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indisready <span class='Operator'>= </span><a href="relcache.c.html#LN2260"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indisready<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indislive <span class='Operator'>= </span><a href="relcache.c.html#LN2260"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indislive<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Copy xmin too, as that is needed to make sense of indcheckxmin */ 
</span>        <a href="../../../include/access/htup_details.h.html#LN312"><span class='Ref_to_Macro'>HeapTupleHeaderSetXmin</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/access/htup_details.h.html#LN306"><span class='Ref_to_Macro'>HeapTupleHeaderGetXmin</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2259"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2259"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !IsSystemRelation(rel... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Okay, now it's valid again */ 
</span>    <a href="relcache.c.html#LN2196"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationReloadIndexInfo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationDestroyRelation 
 * 
 *  Physically delete a relation cache entry and all subsidiary data. 
 *  Caller must already have unhooked the entry from the hash table. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2303"></a><span class='Declare_Function'>RelationDestroyRelation</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>remember_tupdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN400"><span class='Ref_to_Macro'>RelationHasReferenceCountZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure smgr and lower levels close the relation's files, if they 
     * weren't closed already.  (This was probably done by caller, but let's 
     * just be real sure.) 
     */ 
</span>    <a href="../../../include/utils/rel.h.html#LN472"><span class='Ref_to_Macro'>RelationCloseSmgr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Free all the subsidiary data structures of the relcache entry, then the 
     * entry itself. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* can't use DecrTupleDescRefCount here */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>--</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we Rebuilt a relcache entry during a transaction then its 
         * possible we did that because the TupDesc changed as the result of 
         * an ALTER TABLE that ran at less than AccessExclusiveLock. It's 
         * possible someone copied that TupDesc, in which case the copy would 
         * point to free'd memory. So if we rebuild an entry we keep the 
         * TupDesc around until end of transaction, to be safe. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>remember_tupdesc</span></a><span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN251"><span class='Ref_to_Proto'>RememberToFreeTupleDescAtEOX</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/access/tupdesc.h.html#LN95"><span class='Ref_to_Proto'>FreeTupleDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/commands/trigger.h.html#LN129"><span class='Ref_to_Proto'>FreeTriggerDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN266"><span class='Ref_to_Proto'>list_free_deep</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN124"><span class='Ref_to_Member'>rd_fkeylist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN143"><span class='Ref_to_Member'>rd_indexattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN144"><span class='Ref_to_Member'>rd_keyattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN145"><span class='Ref_to_Member'>rd_pkattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN146"><span class='Ref_to_Member'>rd_idattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN148"><span class='Ref_to_Member'>rd_pubactions</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN148"><span class='Ref_to_Member'>rd_pubactions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN178"><span class='Ref_to_Member'>rd_indexcxt</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN178"><span class='Ref_to_Member'>rd_indexcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN118"><span class='Ref_to_Member'>rd_rulescxt</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN118"><span class='Ref_to_Member'>rd_rulescxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN121"><span class='Ref_to_Member'>rd_rsdesc</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN121"><span class='Ref_to_Member'>rd_rsdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/rewrite/rowsecurity.h.html#LN32"><span class='Ref_to_Member'>rscxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN127"><span class='Ref_to_Member'>rd_partkeycxt</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN127"><span class='Ref_to_Member'>rd_partkeycxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN129"><span class='Ref_to_Member'>rd_pdcxt</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN129"><span class='Ref_to_Member'>rd_pdcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN131"><span class='Ref_to_Member'>rd_partcheck</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN131"><span class='Ref_to_Member'>rd_partcheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN203"><span class='Ref_to_Member'>rd_fdwroutine</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN203"><span class='Ref_to_Member'>rd_fdwroutine</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2303"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationDestroyRelation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationClearRelation 
 * 
 *   Physically blow away a relation cache entry, or reset it and rebuild 
 *   it from scratch (that is, from catalog entries).  The latter path is 
 *   used when we are notified of a change to an open relation (one with 
 *   refcount &GT; 0). 
 * 
 *   NB: when rebuilding, we'd better hold some lock on the relation, 
 *   else the catalog data we need to read could be changing under us. 
 *   Also, a rel to be rebuilt had better have refcnt &GT; 0.  This is because 
 *   an sinval reset could happen while we're accessing the catalogs, and 
 *   the rel would get blown away underneath us by RelationCacheInvalidate 
 *   if it has zero refcnt. 
 * 
 *   The "rebuild" parameter is redundant in current usage because it has 
 *   to match the relation's refcnt status, but we keep it as a crosscheck 
 *   that we're doing what the caller expects. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2387"></a><span class='Declare_Function'>RelationClearRelation</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>rebuild</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * As per notes above, a rel to be rebuilt MUST have refcnt &GT; 0; while of 
     * course it would be an equally bad idea to blow away one with nonzero 
     * refcnt, since that would leave someone somewhere with a dangling 
     * pointer.  All callers are expected to have verified that this holds. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>rebuild</span></a> <span class='Operator'>? 
</span>           <span class='Operator'>!</span><a href="../../../include/utils/rel.h.html#LN400"><span class='Ref_to_Macro'>RelationHasReferenceCountZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>) </span><span class='Operator'>: 
</span>           <a href="../../../include/utils/rel.h.html#LN400"><span class='Ref_to_Macro'>RelationHasReferenceCountZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure smgr and lower levels close the relation's files, if they 
     * weren't closed already.  If the relation is not getting deleted, the 
     * next smgr access should reopen the files automatically.  This ensures 
     * that the low-level file access state is updated after, say, a vacuum 
     * truncation. 
     */ 
</span>    <a href="../../../include/utils/rel.h.html#LN472"><span class='Ref_to_Macro'>RelationCloseSmgr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Never, never ever blow away a nailed-in system relation, because we'd 
     * be unable to recover.  However, we must redo RelationInitPhysicalAddr 
     * in case it is a mapped relation whose mapping changed. 
     * 
     * If it's a nailed-but-not-mapped index, then we need to re-read the 
     * pg_class row to see if its relfilenode changed. We do that immediately 
     * if we're inside a valid transaction and the relation is open (not 
     * counting the nailed refcount).  Otherwise just mark the entry as 
     * possibly invalid, and it'll be fixed when next opened. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN270"><span class='Ref_to_Proto'>RelationInitPhysicalAddr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* needs to be revalidated */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="../../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
                <a href="relcache.c.html#LN249"><span class='Ref_to_Proto'>RelationReloadIndexInfo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Even non-system indexes should not be blown away if they are open and 
     * have valid index support information.  This avoids problems with active 
     * use of the index support information.  As with nailed indexes, we 
     * re-read the pg_class row to handle possible physical relocation of the 
     * index, and we check for pg_index updates too. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> <span class='Operator'>&& 
</span>        <a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN178"><span class='Ref_to_Member'>rd_indexcxt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* needs to be revalidated */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
            <a href="relcache.c.html#LN249"><span class='Ref_to_Proto'>RelationReloadIndexInfo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Mark it invalid until we've finished rebuild */ 
</span>    <a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're really done with the relcache entry, blow it away. But if 
     * someone is still using it, reconstruct the whole deal without moving 
     * the physical RelationData record (so that the someone's pointer is 
     * still valid). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>rebuild</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Remove it from the hash table */ 
</span>        <a href="relcache.c.html#LN213"><span class='Ref_to_Macro'>RelationCacheDelete</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And release storage */ 
</span>        <a href="relcache.c.html#LN246"><span class='Ref_to_Proto'>RelationDestroyRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we're not inside a valid transaction, we can't do any catalog 
         * access so it's not possible to rebuild yet.  Just exit, leaving 
         * rd_isvalid = false so that the rebuild will occur when the entry is 
         * next opened. 
         * 
         * Note: it's possible that we come here during subtransaction abort, 
         * and the reason for wanting to rebuild is that the rel is open in 
         * the outer transaction.  In that case it might seem unsafe to not 
         * rebuild immediately, since whatever code has the rel already open 
         * will keep on using the relcache entry as-is.  However, in such a 
         * case the outer transaction should be holding a lock that's 
         * sufficient to prevent any significant change in the rel's schema, 
         * so the existing entry contents should be good enough for its 
         * purposes; at worst we might be behind on statistics updates or the 
         * like.  (See also CheckTableNotInUse() and its callers.)  These same 
         * remarks also apply to the cases above where we exit without having 
         * done RelationReloadIndexInfo() yet. 
         */ 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !IsTransactionState() &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Our strategy for rebuilding an open relcache entry is to build a 
         * new entry from scratch, swap its contents with the old entry, and 
         * finally delete the new entry (along with any infrastructure swapped 
         * over from the old entry).  This is to avoid trouble in case an 
         * error causes us to lose control partway through.  The old entry 
         * will still be marked !rd_isvalid, so we'll try to rebuild it again 
         * on next access.  Meanwhile it's not any less valid than it was 
         * before, so any code that might expect to continue accessing it 
         * isn't hurt by the rebuild failure.  (Consider for example a 
         * subtransaction that ALTERs a table and then gets canceled partway 
         * through the cache entry rebuild.  The outer transaction should 
         * still see the not-modified cache entry as valid.)  The worst 
         * consequence of an error is leaking the necessarily-unreferenced new 
         * entry, and this shouldn't happen often enough for that to be a big 
         * problem. 
         * 
         * When rebuilding an open relcache entry, we must preserve ref count, 
         * rd_createSubid/rd_newRelfilenodeSubid, and rd_toastoid state.  Also 
         * attempt to preserve the pg_class entry (rd_rel), tupledesc, 
         * rewrite-rule, partition key, and partition descriptor substructures 
         * in place, because various places assume that these structures won't 
         * move while they are working with an open relcache entry.  (Note: 
         * the refcount mechanism for tupledescs might someday allow us to 
         * remove this hack for the tupledesc.) 
         * 
         * Note that this process does not touch CurrentResourceOwner; which 
         * is good because whatever ref counts the entry may have do not 
         * necessarily belong to that resource owner. 
         */ 
</span><a name="LN2521"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>newrel</span><span class='Delimiter'>; 
</span><a name="LN2522"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>save_relid</span> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2523"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>keep_tupdesc</span><span class='Delimiter'>; 
</span><a name="LN2524"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>keep_rules</span><span class='Delimiter'>; 
</span><a name="LN2525"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>keep_policies</span><span class='Delimiter'>; 
</span><a name="LN2526"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>keep_partkey</span><span class='Delimiter'>; 
</span><a name="LN2527"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>keep_partdesc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Build temporary entry, but don't link it into hashtable */ 
</span>        <a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN269"><span class='Ref_to_Proto'>RelationBuildDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2522"><span class='Ref_To_Local'>save_relid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We can validly get here, if we're using a historic snapshot in 
             * which a relation, accessed from outside logical decoding, is 
             * still invisible. In that case it's fine to just mark the 
             * relation as invalid and return - it'll fully get reloaded by 
             * the cache reset at the end of logical decoding (or at the next 
             * access).  During normal processing we don't want to ignore this 
             * case as it shouldn't happen there, as explained below. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/snapmgr.h.html#LN105"><span class='Ref_to_Proto'>HistoricSnapshotActive</span></a><span class='Parentheses'>())</span> 
                <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * This shouldn't happen as dropping a relation is intended to be 
             * impossible if still referenced (c.f. CheckTableNotInUse()). But 
             * if we get here anyway, we can't just delete the relcache entry, 
             * as it possibly could get accessed later (as e.g. the error 
             * might get trapped and handled via a subtransaction rollback). 
             */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"relation %u deleted while still in use"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN2522"><span class='Ref_To_Local'>save_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if newrel==NULL &raquo; </span> 
 
        <a href="relcache.c.html#LN2523"><span class='Ref_To_Local'>keep_tupdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN112"><span class='Ref_to_Proto'>equalTupleDescs</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2524"><span class='Ref_To_Local'>keep_rules</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1047"><span class='Ref_to_Func'>equalRuleLocks</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN117"><span class='Ref_to_Member'>rd_rules</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN117"><span class='Ref_to_Member'>rd_rules</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2525"><span class='Ref_To_Local'>keep_policies</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN1138"><span class='Ref_to_Func'>equalRSDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN121"><span class='Ref_to_Member'>rd_rsdesc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN121"><span class='Ref_to_Member'>rd_rsdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2526"><span class='Ref_To_Local'>keep_partkey</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN128"><span class='Ref_to_Member'>rd_partkey</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2527"><span class='Ref_To_Local'>keep_partdesc</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN289"><span class='Ref_to_Proto'>equalPartitionDescs</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN128"><span class='Ref_to_Member'>rd_partkey</span></a><span class='Delimiter'>, 
</span>                                            <a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN130"><span class='Ref_to_Member'>rd_partdesc</span></a><span class='Delimiter'>, 
</span>                                            <a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN130"><span class='Ref_to_Member'>rd_partdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Perform swapping of the relcache entry contents.  Within this 
         * process the old entry is momentarily invalid, so there *must* be no 
         * possibility of CHECK_FOR_INTERRUPTS within this sequence. Do it in 
         * all-in-line code for safety. 
         * 
         * Since the vast majority of fields should be swapped, our method is 
         * to swap the whole structures and then re-swap those few fields we 
         * didn't want swapped. 
         */ 
</span><a name="LN2573"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SWAPFIELD</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>fldtype</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>fldname</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            fldtype _tmp <span class='Operator'>= </span><a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Operator'>-&GT;</span>fldname<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Operator'>-&GT;</span>fldname <span class='Operator'>= </span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span>fldname<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span>fldname <span class='Operator'>= </span>_tmp<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
        <span class='Comment_Multi_Line'>/* swap all Relation struct fields */ 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2582"></a>            <a href="../../../include/utils/rel.h.html#LN82"><span class='Ref_to_Struct'>RelationData</span></a> <span class='Declare_Local'>tmpstruct</span><span class='Delimiter'>; 
</span> 
            memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN2582"><span class='Ref_To_Local'>tmpstruct</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN82"><span class='Ref_to_Struct'>RelationData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN82"><span class='Ref_to_Struct'>RelationData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN2582"><span class='Ref_To_Local'>tmpstruct</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN82"><span class='Ref_to_Struct'>RelationData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* rd_smgr must not be swapped, due to back-links from smgr level */ 
</span>        <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/storage/smgr.h.html#LN77"><span class='Ref_to_Typedef'>SMgrRelation</span></a><span class='Delimiter'>, </span>rd_smgr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* rd_refcnt must be preserved */ 
</span>        <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Delimiter'>, </span>rd_refcnt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* isnailed shouldn't change */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* creation sub-XIDs must be preserved */ 
</span>        <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a><span class='Delimiter'>, </span>rd_createSubid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a><span class='Delimiter'>, </span>rd_newRelfilenodeSubid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* un-swap rd_rel pointers, swap contents instead */ 
</span>        <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Delimiter'>, </span>rd_rel<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* ... but actually, we don't have to update newrel-&GT;rd_rel */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN2387"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_class.h.html#LN86"><span class='Ref_to_Const'>CLASS_TUPLE_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* preserve old tupledesc and rules if no logical change */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2523"><span class='Ref_To_Local'>keep_tupdesc</span></a><span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a><span class='Delimiter'>, </span>rd_att<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2524"><span class='Ref_To_Local'>keep_rules</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/rewrite/prs2lock.h.html#LN39"><span class='Ref_to_Struct'>RuleLock</span></a> <span class='Operator'>*</span><span class='Delimiter'>, </span>rd_rules<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a><span class='Delimiter'>, </span>rd_rulescxt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2525"><span class='Ref_To_Local'>keep_policies</span></a><span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/rewrite/rowsecurity.h.html#LN30"><span class='Ref_to_Struct'>RowSecurityDesc</span></a> <span class='Operator'>*</span><span class='Delimiter'>, </span>rd_rsdesc<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* toast OID override must be preserved */ 
</span>        <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Delimiter'>, </span>rd_toastoid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* pgstat_info must be preserved */ 
</span>        <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgstat.h.html#LN152"><span class='Ref_to_Struct'>PgStat_TableStatus</span></a> <span class='Operator'>*</span><span class='Delimiter'>, </span>pgstat_info<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* partition key must be preserved, if we have one */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2526"><span class='Ref_To_Local'>keep_partkey</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a><span class='Delimiter'>, </span>rd_partkey<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a><span class='Delimiter'>, </span>rd_partkeycxt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* preserve old partdesc if no logical change */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2527"><span class='Ref_To_Local'>keep_partdesc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a><span class='Delimiter'>, </span>rd_partdesc<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a><span class='Delimiter'>, </span>rd_pdcxt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
<span class='Keyword'>#undef </span><a href="relcache.c.html#LN2573"><span class='Ref_to_Macro'>SWAPFIELD</span></a> 
 
        <span class='Comment_Multi_Line'>/* And now we can throw away the temporary entry */ 
</span>        <a href="relcache.c.html#LN246"><span class='Ref_to_Proto'>RelationDestroyRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2521"><span class='Ref_To_Local'>newrel</span></a><span class='Delimiter'>, </span><span class='Operator'>!</span><a href="relcache.c.html#LN2523"><span class='Ref_To_Local'>keep_tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end RelationClearRelation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationFlushRelation 
 * 
 *   Rebuild the relation if it is open (refcount &GT; 0), else blow it away. 
 *   This is used when we receive a cache invalidation event for the rel. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2643"></a><span class='Declare_Function'>RelationFlushRelation</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2643"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>!= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a> <span class='Operator'>|| 
</span>        <a href="relcache.c.html#LN2643"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>!= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * New relcache entries are always rebuilt, not flushed; else we'd 
         * forget the "new" status of the relation, which is a useful 
         * optimization to have.  Ditto for the new-relfilenode status. 
         * 
         * The rel could have zero refcnt here, so temporarily increment the 
         * refcnt to ensure it's safe to rebuild it.  We can assume that the 
         * current transaction has some lock on the rel already. 
         */ 
</span>        <a href="../../../include/utils/rel.h.html#LN635"><span class='Ref_to_Proto'>RelationIncrementReferenceCount</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2643"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN247"><span class='Ref_to_Proto'>RelationClearRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2643"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/rel.h.html#LN636"><span class='Ref_to_Proto'>RelationDecrementReferenceCount</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2643"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Pre-existing rels can be dropped from the relcache if not open. 
         */ 
</span><a name="LN2666"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>rebuild</span> <span class='Operator'>= !</span><a href="../../../include/utils/rel.h.html#LN400"><span class='Ref_to_Macro'>RelationHasReferenceCountZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2643"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN247"><span class='Ref_to_Proto'>RelationClearRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2643"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2666"><span class='Ref_To_Local'>rebuild</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end RelationFlushRelation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationForgetRelation - unconditionally remove a relcache entry 
 * 
 *         External interface for destroying a relcache entry when we 
 *         drop the relation. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2679"></a><span class='Declare_Function'>RelationForgetRelation</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2681"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN201"><span class='Ref_to_Macro'>RelationIdCacheLookup</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2679"><span class='Ref_to_Parameter'>rid</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2681"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2681"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* not in cache, nothing to do */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/rel.h.html#LN400"><span class='Ref_to_Macro'>RelationHasReferenceCountZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2681"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"relation %u is still open"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN2679"><span class='Ref_to_Parameter'>rid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Unconditionally destroy the relcache entry */ 
</span>    <a href="relcache.c.html#LN247"><span class='Ref_to_Proto'>RelationClearRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2681"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      RelationCacheInvalidateEntry 
 * 
 *      This routine is invoked for SI cache flush messages. 
 * 
 * Any relcache entry matching the relid must be flushed.  (Note: caller has 
 * already determined that the relid belongs to our database or is a shared 
 * relation.) 
 * 
 * We used to skip local relations, on the grounds that they could 
 * not be targets of cross-backend SI update messages; but it seems 
 * safer to process them, so that our *own* SI update messages will 
 * have the same effects during CommandCounterIncrement for both 
 * local and nonlocal relations. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2711"></a><span class='Declare_Function'>RelationCacheInvalidateEntry</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2713"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN201"><span class='Ref_to_Macro'>RelationIdCacheLookup</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2711"><span class='Ref_to_Parameter'>relationId</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2713"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2713"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN142"><span class='Ref_to_Global_Var'>relcacheInvalsReceived</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN250"><span class='Ref_to_Proto'>RelationFlushRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2713"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RelationCacheInvalidate 
 *   Blow away cached relation descriptors that have zero reference counts, 
 *   and rebuild those with positive reference counts.  Also reset the smgr 
 *   relation cache and re-read relation mapping data. 
 * 
 *   This is currently used only to recover from SI message buffer overflow, 
 *   so we do not touch new-in-transaction relations; they cannot be targets 
 *   of cross-backend SI updates (and our own updates now go through a 
 *   separate linked list that isn't limited by the SI message buffer size). 
 *   Likewise, we need not discard new-relfilenode-in-transaction hints, 
 *   since any invalidation of those would be a local event. 
 * 
 *   We do this in two phases: the first pass deletes deletable items, and 
 *   the second one rebuilds the rebuildable items.  This is essential for 
 *   safety, because hash_seq_search only copes with concurrent deletion of 
 *   the element it is currently visiting.  If a second SI overflow were to 
 *   occur while we are walking the table, resulting in recursive entry to 
 *   this routine, we could crash because the inner invocation blows away 
 *   the entry next to be visited by the outer scan.  But this way is OK, 
 *   because (a) during the first pass we won't process any more SI messages, 
 *   so hash_seq_search will complete safely; (b) during the second pass we 
 *   only hold onto pointers to nondeletable entries. 
 * 
 *   The two-phase approach also makes it easy to update relfilenodes for 
 *   mapped relations before we do anything else, and to ensure that the 
 *   second pass processes nailed-in-cache items before other nondeletable 
 *   items.  This should ensure that system catalogs are up to date before 
 *   we attempt to use them to reload information about other open relations. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2755"></a><span class='Declare_Function'>RelationCacheInvalidate</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2757"></a>    <a href="../../../include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN2758"></a>    <a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>idhentry</span><span class='Delimiter'>; 
</span><a name="LN2759"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN2760"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rebuildFirstList</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2761"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rebuildList</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2762"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reload relation mapping data before starting to reconstruct cache. 
     */ 
</span>    <a href="../../../include/utils/relmapper.h.html#LN47"><span class='Ref_to_Proto'>RelationMapInvalidateAll</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Phase 1 */ 
</span>    <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN2757"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="relcache.c.html#LN2758"><span class='Ref_To_Local'>idhentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN2757"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN2758"><span class='Ref_To_Local'>idhentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN119"><span class='Ref_to_Member'>reldesc</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must close all smgr references to avoid leaving dangling ptrs */ 
</span>        <a href="../../../include/utils/rel.h.html#LN472"><span class='Ref_to_Macro'>RelationCloseSmgr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ignore new relations; no other backend will manipulate them before 
         * we commit.  Likewise, before replacing a relation's relfilenode, we 
         * shall have acquired AccessExclusiveLock and drained any applicable 
         * pending invalidations. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>!= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>!= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN142"><span class='Ref_to_Global_Var'>relcacheInvalsReceived</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN400"><span class='Ref_to_Macro'>RelationHasReferenceCountZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Delete this entry immediately */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN247"><span class='Ref_to_Proto'>RelationClearRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If it's a mapped relation, immediately update its rd_node in 
             * case its relfilenode changed.  We must do this during phase 1 
             * in case the relation is consulted during rebuild of other 
             * relcache entries in phase 2.  It's safe since consulting the 
             * map doesn't involve any access to relcache entries. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN453"><span class='Ref_to_Macro'>RelationIsMapped</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span> 
                <a href="relcache.c.html#LN270"><span class='Ref_to_Proto'>RelationInitPhysicalAddr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Add this entry to list of stuff to rebuild in second pass. 
             * pg_class goes to the front of rebuildFirstList while 
             * pg_class_oid_index goes to the back of rebuildFirstList, so 
             * they are done first and second respectively.  Other nailed 
             * relations go to the front of rebuildList, so they'll be done 
             * next in no particular order; and everything else goes to the 
             * back of rebuildList. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>)</span> 
                <a href="relcache.c.html#LN2760"><span class='Ref_To_Local'>rebuildFirstList</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2760"><span class='Ref_To_Local'>rebuildFirstList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/catalog/indexing.h.html#LN111"><span class='Ref_to_Const'>ClassOidIndexId</span></a><span class='Parentheses'>)</span> 
                <a href="relcache.c.html#LN2760"><span class='Ref_To_Local'>rebuildFirstList</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2760"><span class='Ref_To_Local'>rebuildFirstList</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a><span class='Parentheses'>) 
</span>                <a href="relcache.c.html#LN2761"><span class='Ref_To_Local'>rebuildList</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2761"><span class='Ref_To_Local'>rebuildList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="relcache.c.html#LN2761"><span class='Ref_To_Local'>rebuildList</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2761"><span class='Ref_To_Local'>rebuildList</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (idhentry=(RelIdCache... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now zap any remaining smgr cache entries.  This must happen before we 
     * start to rebuild entries, since that may involve catalog fetches which 
     * will re-open catalog files. 
     */ 
</span>    <a href="../../../include/storage/smgr.h.html#LN88"><span class='Ref_to_Proto'>smgrcloseall</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Phase 2: rebuild the items found to need rebuild in phase 1 */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2762"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2760"><span class='Ref_To_Local'>rebuildFirstList</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2762"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN247"><span class='Ref_to_Proto'>RelationClearRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2760"><span class='Ref_To_Local'>rebuildFirstList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2762"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2761"><span class='Ref_To_Local'>rebuildList</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2762"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN247"><span class='Ref_to_Proto'>RelationClearRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2759"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2761"><span class='Ref_To_Local'>rebuildList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationCacheInvalidate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationCloseSmgrByOid - close a relcache entry's smgr link 
 * 
 * Needed in some cases where we are changing a relation's physical mapping. 
 * The link will be automatically reopened on next use. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2858"></a><span class='Declare_Function'>RelationCloseSmgrByOid</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2860"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN201"><span class='Ref_to_Macro'>RelationIdCacheLookup</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2858"><span class='Ref_to_Parameter'>relationId</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2860"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2860"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* not in cache, nothing to do */ 
</span> 
    <a href="../../../include/utils/rel.h.html#LN472"><span class='Ref_to_Macro'>RelationCloseSmgr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2860"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN2871"></a><span class='Declare_Function'>RememberToFreeTupleDescAtEOX</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>td</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN172"><span class='Ref_to_Global_Var'>EOXactTupleDescArray</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2875"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN2875"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN172"><span class='Ref_to_Global_Var'>EOXactTupleDescArray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>16</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN174"><span class='Ref_to_Global_Var'>EOXactTupleDescArrayLen</span></a> <span class='Operator'>= </span><span class='Number'>16</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN173"><span class='Ref_to_Global_Var'>NextEOXactTupleDescNum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2875"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN173"><span class='Ref_to_Global_Var'>NextEOXactTupleDescNum</span></a> <span class='Operator'>&GT;= </span><a href="relcache.c.html#LN174"><span class='Ref_to_Global_Var'>EOXactTupleDescArrayLen</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2886"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>newlen</span> <span class='Operator'>= </span><a href="relcache.c.html#LN174"><span class='Ref_to_Global_Var'>EOXactTupleDescArrayLen</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN174"><span class='Ref_to_Global_Var'>EOXactTupleDescArrayLen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN172"><span class='Ref_to_Global_Var'>EOXactTupleDescArray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN172"><span class='Ref_to_Global_Var'>EOXactTupleDescArray</span></a><span class='Delimiter'>, 
</span>                                                 <a href="relcache.c.html#LN2886"><span class='Ref_To_Local'>newlen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN174"><span class='Ref_to_Global_Var'>EOXactTupleDescArrayLen</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN2886"><span class='Ref_To_Local'>newlen</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="relcache.c.html#LN172"><span class='Ref_to_Global_Var'>EOXactTupleDescArray</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN173"><span class='Ref_to_Global_Var'>NextEOXactTupleDescNum</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="relcache.c.html#LN2871"><span class='Ref_to_Parameter'>td</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RememberToFreeTupleDescAtEOX &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AtEOXact_RelationCache 
 * 
 *  Clean up the relcache at main-transaction commit or abort. 
 * 
 * Note: this must be called *before* processing invalidation messages. 
 * In the case of abort, we don't want to try to rebuild any invalidated 
 * cache entries (since we can't safely do database accesses).  Therefore 
 * we must reset refcnts before handling pending invalidations. 
 * 
 * As of PostgreSQL 8.1, relcache refcnts should get released by the 
 * ResourceOwner mechanism.  This routine just does a debugging 
 * cross-check that no pins remain.  However, we also need to do special 
 * cleanup when the current transaction created any relations or made use 
 * of forced index lists. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2915"></a><span class='Declare_Function'>AtEOXact_RelationCache</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2917"></a>    <a href="../../../include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN2918"></a>    <a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>idhentry</span><span class='Delimiter'>; 
</span><a name="LN2919"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unless the eoxact_list[] overflowed, we only need to examine the rels 
     * listed in it.  Otherwise fall back on a hash_seq_search scan. 
     * 
     * For simplicity, eoxact_list[] entries are not deleted till end of 
     * top-level transaction, even though we could remove them at 
     * subtransaction end in some cases, or remove relations from the list if 
     * they are cleared for other reasons.  Therefore we should expect the 
     * case that list entries are not found in the hashtable; if not, there's 
     * nothing to do for them. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN157"><span class='Ref_to_Global_Var'>eoxact_list_overflowed</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN2917"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="relcache.c.html#LN2918"><span class='Ref_To_Local'>idhentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN2917"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN252"><span class='Ref_to_Proto'>AtEOXact_cleanup</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2918"><span class='Ref_To_Local'>idhentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN119"><span class='Ref_to_Member'>reldesc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2915"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2919"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN2919"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN156"><span class='Ref_to_Global_Var'>eoxact_list_len</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN2919"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN2918"><span class='Ref_To_Local'>idhentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="relcache.c.html#LN155"><span class='Ref_to_Global_Var'>eoxact_list</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN2919"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                     <a href="../../../include/utils/hsearch.h.html#LN104"><span class='Ref_to_EnumConst'>HASH_FIND</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2918"><span class='Ref_To_Local'>idhentry</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="relcache.c.html#LN252"><span class='Ref_to_Proto'>AtEOXact_cleanup</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2918"><span class='Ref_To_Local'>idhentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN119"><span class='Ref_to_Member'>reldesc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN2915"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN174"><span class='Ref_to_Global_Var'>EOXactTupleDescArrayLen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN172"><span class='Ref_to_Global_Var'>EOXactTupleDescArray</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2919"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN2919"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN173"><span class='Ref_to_Global_Var'>NextEOXactTupleDescNum</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN2919"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="../../../include/access/tupdesc.h.html#LN95"><span class='Ref_to_Proto'>FreeTupleDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN172"><span class='Ref_to_Global_Var'>EOXactTupleDescArray</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN2919"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN172"><span class='Ref_to_Global_Var'>EOXactTupleDescArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN172"><span class='Ref_to_Global_Var'>EOXactTupleDescArray</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now we're out of the transaction and can clear the lists */ 
</span>    <a href="relcache.c.html#LN156"><span class='Ref_to_Global_Var'>eoxact_list_len</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN157"><span class='Ref_to_Global_Var'>eoxact_list_overflowed</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN173"><span class='Ref_to_Global_Var'>NextEOXactTupleDescNum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN174"><span class='Ref_to_Global_Var'>EOXactTupleDescArrayLen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AtEOXact_RelationCache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AtEOXact_cleanup 
 * 
 *  Clean up a single rel at main-transaction commit or abort 
 * 
 * NB: this processing must be idempotent, because EOXactListAdd() doesn't 
 * bother to prevent duplicate entries in eoxact_list[]. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2978"></a><span class='Declare_Function'>AtEOXact_cleanup</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * The relcache entry's ref count should be back to its normal 
     * not-in-a-transaction state: 0 unless it's nailed in cache. 
     * 
     * In bootstrap mode, this is NOT true, so don't check it --- the 
     * bootstrap code expects relations to stay open across start/commit 
     * transaction calls.  (That seems bogus, but it's not worth fixing.) 
     * 
     * Note: ideally this check would be applied to every relcache entry, not 
     * just those that have eoxact work to do.  But it's not worth forcing a 
     * scan of the whole relcache just for this.  (Moreover, doing so would 
     * mean that assert-enabled testing never tests the hash_search code path 
     * above, which seems a bad idea.) 
     */ 
</span><span class='Directive'>#ifdef</span> USE_ASSERT_CHECKING 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2997"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>expected_refcnt</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN2997"><span class='Ref_To_Local'>expected_refcnt</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN2997"><span class='Ref_To_Local'>expected_refcnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Is it a relation created in the current transaction? 
     * 
     * During commit, reset the flag to zero, since we are now out of the 
     * creating transaction.  During abort, simply delete the relcache entry 
     * --- it isn't interesting any longer.  (NOTE: if we have forgotten the 
     * new-ness of a new relation due to a forced cache flush, the entry will 
     * get deleted anyway by shared-cache-inval processing of the aborted 
     * pg_class insertion.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>!= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN400"><span class='Ref_to_Macro'>RelationHasReferenceCountZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN247"><span class='Ref_to_Proto'>RelationClearRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Hmm, somewhere there's a (leaked?) reference to the relation. 
             * We daren't remove the entry for fear of dereferencing a 
             * dangling pointer later.  Bleat, and mark it as not belonging to 
             * the current transaction.  Hopefully it'll get cleaned up 
             * eventually.  This must be just a WARNING to avoid 
             * error-during-error-recovery loops. 
             */ 
</span>            <a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"cannot remove relcache entry for \"%s\" because it has nonzero refcount"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if relation-&GT;rd_createSu... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Likewise, reset the hint about the relfilenode being new. 
     */ 
</span>    <a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Flush any temporary index list. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN135"><span class='Ref_to_Member'>rd_oidindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN136"><span class='Ref_to_Member'>rd_pkindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN137"><span class='Ref_to_Member'>rd_replidindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN2978"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end AtEOXact_cleanup &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AtEOSubXact_RelationCache 
 * 
 *  Clean up the relcache at sub-transaction commit or abort. 
 * 
 * Note: this must be called *before* processing invalidation messages. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3066"></a><span class='Declare_Function'>AtEOSubXact_RelationCache</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>mySubid</span><span class='Delimiter'>, 
</span><a name="LN3067"></a>                          <a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>parentSubid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3069"></a>    <a href="../../../include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN3070"></a>    <a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>idhentry</span><span class='Delimiter'>; 
</span><a name="LN3071"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unless the eoxact_list[] overflowed, we only need to examine the rels 
     * listed in it.  Otherwise fall back on a hash_seq_search scan.  Same 
     * logic as in AtEOXact_RelationCache. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN157"><span class='Ref_to_Global_Var'>eoxact_list_overflowed</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN3069"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="relcache.c.html#LN3070"><span class='Ref_To_Local'>idhentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN3069"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN253"><span class='Ref_to_Proto'>AtEOSubXact_cleanup</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3070"><span class='Ref_To_Local'>idhentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN119"><span class='Ref_to_Member'>reldesc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3066"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Delimiter'>, 
</span>                                <a href="relcache.c.html#LN3066"><span class='Ref_to_Parameter'>mySubid</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3067"><span class='Ref_to_Parameter'>parentSubid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3071"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN3071"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN156"><span class='Ref_to_Global_Var'>eoxact_list_len</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN3071"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN3070"><span class='Ref_To_Local'>idhentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="relcache.c.html#LN155"><span class='Ref_to_Global_Var'>eoxact_list</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN3071"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                     <a href="../../../include/utils/hsearch.h.html#LN104"><span class='Ref_to_EnumConst'>HASH_FIND</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3070"><span class='Ref_To_Local'>idhentry</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="relcache.c.html#LN253"><span class='Ref_to_Proto'>AtEOSubXact_cleanup</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3070"><span class='Ref_To_Local'>idhentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN119"><span class='Ref_to_Member'>reldesc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3066"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Delimiter'>, 
</span>                                    <a href="relcache.c.html#LN3066"><span class='Ref_to_Parameter'>mySubid</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3067"><span class='Ref_to_Parameter'>parentSubid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Don't reset the list; we still need more cleanup later */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AtEOSubXact_RelationCache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AtEOSubXact_cleanup 
 * 
 *  Clean up a single rel at subtransaction commit or abort 
 * 
 * NB: this processing must be idempotent, because EOXactListAdd() doesn't 
 * bother to prevent duplicate entries in eoxact_list[]. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3113"></a><span class='Declare_Function'>AtEOSubXact_cleanup</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Delimiter'>, 
</span><a name="LN3114"></a>                    <a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>mySubid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>parentSubid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Is it a relation created in the current subtransaction? 
     * 
     * During subcommit, mark it as belonging to the parent, instead. During 
     * subabort, simply delete the relcache entry. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN3114"><span class='Ref_to_Parameter'>mySubid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3114"><span class='Ref_to_Parameter'>parentSubid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN400"><span class='Ref_to_Macro'>RelationHasReferenceCountZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN247"><span class='Ref_to_Proto'>RelationClearRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Hmm, somewhere there's a (leaked?) reference to the relation. 
             * We daren't remove the entry for fear of dereferencing a 
             * dangling pointer later.  Bleat, and transfer it to the parent 
             * subtransaction so we can try again later.  This must be just a 
             * WARNING to avoid error-during-error-recovery loops. 
             */ 
</span>            <a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3114"><span class='Ref_to_Parameter'>parentSubid</span></a><span class='Delimiter'>; 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"cannot remove relcache entry for \"%s\" because it has nonzero refcount"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if relation-&GT;rd_createSu... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Likewise, update or drop any new-relfilenode-in-subtransaction hint. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN3114"><span class='Ref_to_Parameter'>mySubid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3114"><span class='Ref_to_Parameter'>parentSubid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Flush any temporary index list. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN135"><span class='Ref_to_Member'>rd_oidindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN136"><span class='Ref_to_Member'>rd_pkindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN137"><span class='Ref_to_Member'>rd_replidindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN3113"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end AtEOSubXact_cleanup &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *      RelationBuildLocalRelation 
 *          Build a relcache entry for an about-to-be-created relation, 
 *          and enter it into the relcache. 
 */ 
</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> 
<a name="LN3178"></a><span class='Declare_Function'>RelationBuildLocalRelation</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>relname</span><span class='Delimiter'>, 
</span><a name="LN3179"></a>                           <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relnamespace</span><span class='Delimiter'>, 
</span><a name="LN3180"></a>                           <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupDesc</span><span class='Delimiter'>, 
</span><a name="LN3181"></a>                           <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, 
</span><a name="LN3182"></a>                           <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relfilenode</span><span class='Delimiter'>, 
</span><a name="LN3183"></a>                           <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>reltablespace</span><span class='Delimiter'>, 
</span><a name="LN3184"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>shared_relation</span><span class='Delimiter'>, 
</span><a name="LN3185"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>mapped_relation</span><span class='Delimiter'>, 
</span><a name="LN3186"></a>                           <span class='Keyword'>char </span><span class='Declare_Parameter'>relpersistence</span><span class='Delimiter'>, 
</span><a name="LN3187"></a>                           <span class='Keyword'>char </span><span class='Declare_Parameter'>relkind</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3189"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN3190"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN3191"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span> <span class='Operator'>= </span><a href="relcache.c.html#LN3180"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN3192"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3193"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_not_null</span><span class='Delimiter'>; 
</span><a name="LN3194"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nailit</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3191"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * check for creation of a rel that must be nailed in cache. 
     * 
     * XXX this list had better match the relations specially handled in 
     * RelationCacheInitializePhase2/3. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3181"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_auth_members.h.html#LN28"><span class='Ref_to_Const'>AuthMemRelationId</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Operator'>: 
</span>            <a href="relcache.c.html#LN3194"><span class='Ref_To_Local'>nailit</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="relcache.c.html#LN3194"><span class='Ref_To_Local'>nailit</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * check that hardwired list of shared rels matches what's in the 
     * bootstrap .bki file.  If you get a failure here during initdb, you 
     * probably need to fix IsSharedRelation() to match whatever you've done 
     * to the set of shared relations. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3184"><span class='Ref_to_Parameter'>shared_relation</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/catalog.h.html#LN42"><span class='Ref_to_Proto'>IsSharedRelation</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3181"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"shared_relation flag for \"%s\" does not match IsSharedRelation(%u)"</span><span class='Delimiter'>, 
</span>             <a href="relcache.c.html#LN3178"><span class='Ref_to_Parameter'>relname</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3181"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Shared relations had better be mapped, too */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN3185"><span class='Ref_to_Parameter'>mapped_relation</span></a> <span class='Operator'>|| !</span><a href="relcache.c.html#LN3184"><span class='Ref_to_Parameter'>shared_relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * switch to the cache context to create the relcache entry. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/catcache.h.html#LN168"><span class='Ref_to_Proto'>CreateCacheMemoryContext</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN3190"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * allocate a new relation descriptor and fill in basic state fields. 
     */ 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN82"><span class='Ref_to_Struct'>RelationData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make sure relation is marked as having no open file yet */ 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN86"><span class='Ref_to_Member'>rd_smgr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* mark it nailed if appropriate */ 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3194"><span class='Ref_To_Local'>nailit</span></a><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3194"><span class='Ref_To_Local'>nailit</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* it's being created in this transaction */ 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>= </span><a href="../../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create a new tuple descriptor from the one passed in.  We do this 
     * partly to copy it into the cache context, and partly because the new 
     * relation can't have any defaults or constraints yet; they have to be 
     * added in later steps, because they require additions to multiple system 
     * catalogs.  We can copy attnotnull constraints here, however. 
     */ 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3180"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* mark as refcounted */ 
</span>    <a href="relcache.c.html#LN3193"><span class='Ref_To_Local'>has_not_null</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN3191"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attidentity <span class='Operator'>= </span><a href="relcache.c.html#LN3180"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attidentity<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attnotnull <span class='Operator'>= </span><a href="relcache.c.html#LN3180"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attnotnull<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN3193"><span class='Ref_To_Local'>has_not_null</span></a> <span class='Operator'>|= </span><a href="relcache.c.html#LN3180"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attnotnull<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3193"><span class='Ref_To_Local'>has_not_null</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3277"></a>        <a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>constr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN3277"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN42"><span class='Ref_to_Member'>has_not_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3277"><span class='Ref_To_Local'>constr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize relation tuple form (caller may add/override data later) 
     */ 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN86"><span class='Ref_to_Const'>CLASS_TUPLE_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relname<span class='Delimiter'>, </span><a href="relcache.c.html#LN3178"><span class='Ref_to_Parameter'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnamespace <span class='Operator'>= </span><a href="relcache.c.html#LN3179"><span class='Ref_to_Parameter'>relnamespace</span></a><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>= </span><a href="relcache.c.html#LN3187"><span class='Ref_to_Parameter'>relkind</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids <span class='Operator'>= </span><a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>= </span><a href="relcache.c.html#LN3191"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* needed when bootstrapping: */ 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relowner <span class='Operator'>= </span><a href="../../../include/catalog/pg_authid.h.html#LN101"><span class='Ref_to_Const'>BOOTSTRAP_SUPERUSERID</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up persistence and relcache fields dependent on it */ 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>= </span><a href="relcache.c.html#LN3186"><span class='Ref_to_Parameter'>relpersistence</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3186"><span class='Ref_to_Parameter'>relpersistence</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Operator'>: 
</span>            <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a> <span class='Operator'>= </span><a href="../../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/catalog/namespace.h.html#LN125"><span class='Ref_to_Proto'>isTempOrTempToastNamespace</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3179"><span class='Ref_to_Parameter'>relnamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a> <span class='Operator'>= </span><a href="../../../include/storage/backendid.h.html#LN33"><span class='Ref_to_Macro'>BackendIdForTempRelations</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid relpersistence: %c"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN3186"><span class='Ref_to_Parameter'>relpersistence</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* if it's a materialized view, it's not populated initially */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3187"><span class='Ref_to_Parameter'>relkind</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispopulated <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispopulated <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* system relations and non-table objects don't have one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/catalog/catalog.h.html#LN37"><span class='Ref_to_Proto'>IsSystemNamespace</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3179"><span class='Ref_to_Parameter'>relnamespace</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="relcache.c.html#LN3187"><span class='Ref_to_Parameter'>relkind</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>         <a href="relcache.c.html#LN3187"><span class='Ref_to_Parameter'>relkind</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>|| 
</span>         <a href="relcache.c.html#LN3187"><span class='Ref_to_Parameter'>relkind</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>))</span> 
        <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relreplident <span class='Operator'>= </span><a href="../../../include/catalog/pg_class.h.html#LN174"><span class='Ref_to_Const'>REPLICA_IDENTITY_DEFAULT</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relreplident <span class='Operator'>= </span><a href="../../../include/catalog/pg_class.h.html#LN176"><span class='Ref_to_Const'>REPLICA_IDENTITY_NOTHING</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert relation physical and logical identifiers (OIDs) into the right 
     * places.  For a mapped relation, we set relfilenode to zero and rely on 
     * RelationInitPhysicalAddr to consult the map. 
     */ 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relisshared <span class='Operator'>= </span><a href="relcache.c.html#LN3184"><span class='Ref_to_Parameter'>shared_relation</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="relcache.c.html#LN3181"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN3191"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN3192"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attrelid <span class='Operator'>= </span><a href="relcache.c.html#LN3181"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltablespace <span class='Operator'>= </span><a href="relcache.c.html#LN3183"><span class='Ref_to_Parameter'>reltablespace</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3185"><span class='Ref_to_Parameter'>mapped_relation</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relfilenode <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Add it to the active mapping information */ 
</span>        <a href="../../../include/utils/relmapper.h.html#LN41"><span class='Ref_to_Proto'>RelationMapUpdateMap</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3181"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3182"><span class='Ref_to_Parameter'>relfilenode</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3184"><span class='Ref_to_Parameter'>shared_relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relfilenode <span class='Operator'>= </span><a href="relcache.c.html#LN3182"><span class='Ref_to_Parameter'>relfilenode</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/lmgr.h.html#LN36"><span class='Ref_to_Proto'>RelationInitLockInfo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* see lmgr.c */ 
</span> 
    <a href="relcache.c.html#LN270"><span class='Ref_to_Proto'>RelationInitPhysicalAddr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Okay to insert into the relcache hash table. 
     * 
     * Ordinarily, there should certainly not be an existing hash entry for 
     * the same OID; but during bootstrap, when we create a "real" relcache 
     * entry for one of the bootstrap relations, we'll be overwriting the 
     * phony one created with formrdesc.  So allow that to happen for nailed 
     * rels. 
     */ 
</span>    <a href="relcache.c.html#LN179"><span class='Ref_to_Macro'>RelationCacheInsert</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3194"><span class='Ref_To_Local'>nailit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Flag relation as needing eoxact cleanup (to clear rd_createSubid). We 
     * can't do this before storing relid in it. 
     */ 
</span>    <a href="relcache.c.html#LN159"><span class='Ref_to_Macro'>EOXactListAdd</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * done building relcache entry. 
     */ 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3190"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* It's fully valid */ 
</span>    <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN91"><span class='Ref_to_Member'>rd_isvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Caller expects us to pin the returned entry. 
     */ 
</span>    <a href="../../../include/utils/rel.h.html#LN635"><span class='Ref_to_Proto'>RelationIncrementReferenceCount</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN3189"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationBuildLocalRelation &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * RelationSetNewRelfilenode 
 * 
 * Assign a new relfilenode (physical file name) to the relation. 
 * 
 * This allows a full rewrite of the relation to be done with transactional 
 * safety (since the filenode assignment can be rolled back).  Note however 
 * that there is no simple way to access the relation's old data for the 
 * remainder of the current transaction.  This limits the usefulness to cases 
 * such as TRUNCATE or rebuilding an index from scratch. 
 * 
 * Caller must already hold exclusive lock on the relation. 
 * 
 * The relation is marked with relfrozenxid = freezeXid (InvalidTransactionId 
 * must be passed for indexes and sequences).  This should be a lower bound on 
 * the XIDs that will be put into the new relation contents. 
 * 
 * The new filenode's persistence is set to the given value.  This is useful 
 * for the cases that are changing the relation's persistence; other callers 
 * need to pass the original relpersistence value. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3415"></a><span class='Declare_Function'>RelationSetNewRelfilenode</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>persistence</span><span class='Delimiter'>, 
</span><a name="LN3416"></a>                          <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>freezeXid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN406"><span class='Ref_to_Typedef'>MultiXactId</span></a> <span class='Declare_Parameter'>minmulti</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3418"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>newrelfilenode</span><span class='Delimiter'>; 
</span><a name="LN3419"></a>    <a href="../../../include/storage/relfilenode.h.html#LN71"><span class='Ref_to_Struct'>RelFileNodeBackend</span></a> <span class='Declare_Local'>newrnode</span><span class='Delimiter'>; 
</span><a name="LN3420"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_class</span><span class='Delimiter'>; 
</span><a name="LN3421"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN3422"></a>    <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>classform</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Indexes, sequences must have Invalid frozenxid; other rels must not */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>((</span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) </span><span class='Operator'>? 
</span>           <a href="relcache.c.html#LN3416"><span class='Ref_to_Parameter'>freezeXid</span></a> <span class='Operator'>== </span><a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a> <span class='Operator'>: 
</span>           <a href="../../../include/access/transam.h.html#LN41"><span class='Ref_to_Macro'>TransactionIdIsNormal</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3416"><span class='Ref_to_Parameter'>freezeXid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN41"><span class='Ref_to_Macro'>TransactionIdIsNormal</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3416"><span class='Ref_to_Parameter'>freezeXid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/multixact.h.html#LN26"><span class='Ref_to_Macro'>MultiXactIdIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3416"><span class='Ref_to_Parameter'>minmulti</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate a new relfilenode */ 
</span>    <a href="relcache.c.html#LN3418"><span class='Ref_To_Local'>newrelfilenode</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/catalog.h.html#LN47"><span class='Ref_to_Proto'>GetNewRelFileNode</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltablespace<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                       <a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>persistence</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get a writable copy of the pg_class tuple for the given relation. 
     */ 
</span>    <a href="relcache.c.html#LN3420"><span class='Ref_To_Local'>pg_class</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN3421"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3421"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for relation %u"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3422"><span class='Ref_To_Local'>classform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3421"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create storage for the main fork of the new relfilenode. 
     * 
     * NOTE: any conflict in relfilenode value will be caught here, if 
     * GetNewRelFileNode messes up for any reason. 
     */ 
</span>    <a href="relcache.c.html#LN3419"><span class='Ref_To_Local'>newrnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN73"><span class='Ref_to_Member'>node</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3419"><span class='Ref_To_Local'>newrnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN73"><span class='Ref_to_Member'>node</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3418"><span class='Ref_To_Local'>newrelfilenode</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3419"><span class='Ref_To_Local'>newrnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN74"><span class='Ref_to_Member'>backend</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/catalog/storage.h.html#LN20"><span class='Ref_to_Proto'>RelationCreateStorage</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3419"><span class='Ref_To_Local'>newrnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN73"><span class='Ref_to_Member'>node</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>persistence</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/smgr.h.html#LN89"><span class='Ref_to_Proto'>smgrclosenode</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3419"><span class='Ref_To_Local'>newrnode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Schedule unlinking of the old storage at transaction commit. 
     */ 
</span>    <a href="../../../include/catalog/storage.h.html#LN21"><span class='Ref_to_Proto'>RelationDropStorage</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now update the pg_class row.  However, if we're dealing with a mapped 
     * index, pg_class.relfilenode doesn't change; instead we have to send the 
     * update to the relation mapper. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN453"><span class='Ref_to_Macro'>RelationIsMapped</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/relmapper.h.html#LN41"><span class='Ref_to_Proto'>RelationMapUpdateMap</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="relcache.c.html#LN3418"><span class='Ref_To_Local'>newrelfilenode</span></a><span class='Delimiter'>, 
</span>                             <a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relisshared<span class='Delimiter'>, 
</span>                             <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN3422"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relfilenode <span class='Operator'>= </span><a href="relcache.c.html#LN3418"><span class='Ref_To_Local'>newrelfilenode</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* These changes are safe even for a mapped relation */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN3422"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relpages <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* it's empty until further notice */ 
</span>        <a href="relcache.c.html#LN3422"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>reltuples <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN3422"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relallvisible <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="relcache.c.html#LN3422"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relfrozenxid <span class='Operator'>= </span><a href="relcache.c.html#LN3416"><span class='Ref_to_Parameter'>freezeXid</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3422"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relminmxid <span class='Operator'>= </span><a href="relcache.c.html#LN3416"><span class='Ref_to_Parameter'>minmulti</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3422"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>= </span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>persistence</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3420"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN3421"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3421"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3421"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3420"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make the pg_class row change visible, as well as the relation map 
     * change if any.  This will cause the relcache entry to get updated, too. 
     */ 
</span>    <a href="../../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Mark the rel as having been given a new relfilenode in the current 
     * (sub) transaction.  This is a hint that can be used to optimize later 
     * operations on the rel in the same transaction. 
     */ 
</span>    <a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>= </span><a href="../../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Flag relation as needing eoxact cleanup (to remove the hint) */ 
</span>    <a href="relcache.c.html#LN159"><span class='Ref_to_Macro'>EOXactListAdd</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3415"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationSetNewRelfilenode &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *      RelationCacheInitialize 
 * 
 *      This initializes the relation descriptor cache.  At the time 
 *      that this is invoked, we can't do database access yet (mainly 
 *      because the transaction subsystem is not up); all we are doing 
 *      is making an empty cache hashtable.  This must be done before 
 *      starting the initialization transaction, because otherwise 
 *      AtEOXact_RelationCache would crash if that transaction aborts 
 *      before we can get the relcache set up. 
 */ 
</span> 
<a name="LN3524"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>INITRELCACHESIZE</span>        <span class='Number'>400</span> 
 
<span class='Keyword'>void 
</span><a name="LN3527"></a><span class='Declare_Function'>RelationCacheInitialize</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3529"></a>    <a href="../../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * make sure cache memory context exists 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/catcache.h.html#LN168"><span class='Ref_to_Proto'>CreateCacheMemoryContext</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create hashtable that indexes the relcache 
     */ 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN3529"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN3529"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3529"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3529"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"Relcache by OID"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN3524"><span class='Ref_to_Const'>INITRELCACHESIZE</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="relcache.c.html#LN3529"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * relation mapper needs to be initialized too 
     */ 
</span>    <a href="../../../include/utils/relmapper.h.html#LN57"><span class='Ref_to_Proto'>RelationMapInitialize</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationCacheInitialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      RelationCacheInitializePhase2 
 * 
 *      This is called to prepare for access to shared catalogs during startup. 
 *      We must at least set up nailed reldescs for pg_database, pg_authid, 
 *      pg_auth_members, and pg_shseclabel. Ideally we'd like to have reldescs 
 *      for their indexes, too.  We attempt to load this information from the 
 *      shared relcache init file.  If that's missing or broken, just make 
 *      phony entries for the catalogs themselves. 
 *      RelationCacheInitializePhase3 will clean up as needed. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3564"></a><span class='Declare_Function'>RelationCacheInitializePhase2</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3566"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * relation mapper needs initialized too 
     */ 
</span>    <a href="../../../include/utils/relmapper.h.html#LN58"><span class='Ref_to_Proto'>RelationMapInitializePhase2</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In bootstrap mode, the shared catalogs aren't there yet anyway, so do 
     * nothing. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * switch to cache memory context 
     */ 
</span>    <a href="relcache.c.html#LN3566"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Try to load the shared relcache cache file.  If unsuccessful, bootstrap 
     * the cache with pre-made descriptors for the critical shared catalogs. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN255"><span class='Ref_to_Proto'>load_relcache_init_file</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN259"><span class='Ref_to_Proto'>formrdesc</span></a><span class='Parentheses'>(</span><span class='String'>"pg_database"</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_database.h.html#LN29"><span class='Ref_to_Const'>DatabaseRelation_Rowtype_Id</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                  <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_database.h.html#LN62"><span class='Ref_to_Const'>Natts_pg_database</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN103"><span class='Ref_to_Global_Var'>Desc_pg_database</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN259"><span class='Ref_to_Proto'>formrdesc</span></a><span class='Parentheses'>(</span><span class='String'>"pg_authid"</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_authid.h.html#LN42"><span class='Ref_to_Const'>AuthIdRelation_Rowtype_Id</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                  <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN104"><span class='Ref_to_Global_Var'>Desc_pg_authid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN259"><span class='Ref_to_Proto'>formrdesc</span></a><span class='Parentheses'>(</span><span class='String'>"pg_auth_members"</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_auth_members.h.html#LN29"><span class='Ref_to_Const'>AuthMemRelation_Rowtype_Id</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                  <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_auth_members.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_auth_members</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN105"><span class='Ref_to_Global_Var'>Desc_pg_auth_members</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN259"><span class='Ref_to_Proto'>formrdesc</span></a><span class='Parentheses'>(</span><span class='String'>"pg_shseclabel"</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_shseclabel.h.html#LN21"><span class='Ref_to_Const'>SharedSecLabelRelation_Rowtype_Id</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                  <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_shseclabel.h.html#LN40"><span class='Ref_to_Const'>Natts_pg_shseclabel</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN107"><span class='Ref_to_Global_Var'>Desc_pg_shseclabel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN259"><span class='Ref_to_Proto'>formrdesc</span></a><span class='Parentheses'>(</span><span class='String'>"pg_subscription"</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_subscription.h.html#LN22"><span class='Ref_to_Const'>SubscriptionRelation_Rowtype_Id</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                  <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_subscription.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_subscription</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN108"><span class='Ref_to_Global_Var'>Desc_pg_subscription</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN3602"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUM_CRITICAL_SHARED_RELS</span>    <span class='Number'>5</span>   <span class='Comment_Single_Line'>/* fix if you change list above */ 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3566"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationCacheInitializePhase2 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      RelationCacheInitializePhase3 
 * 
 *      This is called as soon as the catcache and transaction system 
 *      are functional and we have determined MyDatabaseId.  At this point 
 *      we can actually read data from the database's system catalogs. 
 *      We first try to read pre-computed relcache entries from the local 
 *      relcache init file.  If that's missing or broken, make phony entries 
 *      for the minimum set of nailed-in-cache relations.  Then (unless 
 *      bootstrapping) make sure we have entries for the critical system 
 *      indexes.  Once we've done all this, we have enough infrastructure to 
 *      open any system catalog or use any catcache.  The last step is to 
 *      rewrite the cache files if needed. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3623"></a><span class='Declare_Function'>RelationCacheInitializePhase3</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3625"></a>    <a href="../../../include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN3626"></a>    <a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>idhentry</span><span class='Delimiter'>; 
</span><a name="LN3627"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN3628"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>needNewCacheFile</span> <span class='Operator'>= !</span><a href="relcache.c.html#LN134"><span class='Ref_to_Global_Var'>criticalSharedRelcachesBuilt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * relation mapper needs initialized too 
     */ 
</span>    <a href="../../../include/utils/relmapper.h.html#LN59"><span class='Ref_to_Proto'>RelationMapInitializePhase3</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * switch to cache memory context 
     */ 
</span>    <a href="relcache.c.html#LN3627"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Try to load the local relcache cache file.  If unsuccessful, bootstrap 
     * the cache with pre-made descriptors for the critical "nailed-in" system 
     * catalogs. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>() </span><span class='Operator'>|| 
</span>        <span class='Operator'>!</span><a href="relcache.c.html#LN255"><span class='Ref_to_Proto'>load_relcache_init_file</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN3628"><span class='Ref_To_Local'>needNewCacheFile</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN259"><span class='Ref_to_Proto'>formrdesc</span></a><span class='Parentheses'>(</span><span class='String'>"pg_class"</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_class.h.html#LN29"><span class='Ref_to_Const'>RelationRelation_Rowtype_Id</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                  <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN99"><span class='Ref_to_Global_Var'>Desc_pg_class</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN259"><span class='Ref_to_Proto'>formrdesc</span></a><span class='Parentheses'>(</span><span class='String'>"pg_attribute"</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_attribute.h.html#LN33"><span class='Ref_to_Const'>AttributeRelation_Rowtype_Id</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                  <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN100"><span class='Ref_to_Global_Var'>Desc_pg_attribute</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN259"><span class='Ref_to_Proto'>formrdesc</span></a><span class='Parentheses'>(</span><span class='String'>"pg_proc"</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_proc.h.html#LN33"><span class='Ref_to_Const'>ProcedureRelation_Rowtype_Id</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                  <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_proc.h.html#LN88"><span class='Ref_to_Const'>Natts_pg_proc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN101"><span class='Ref_to_Global_Var'>Desc_pg_proc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN259"><span class='Ref_to_Proto'>formrdesc</span></a><span class='Parentheses'>(</span><span class='String'>"pg_type"</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_type.h.html#LN34"><span class='Ref_to_Const'>TypeRelation_Rowtype_Id</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                  <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN102"><span class='Ref_to_Global_Var'>Desc_pg_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN3659"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUM_CRITICAL_LOCAL_RELS</span> <span class='Number'>4</span>       <span class='Comment_Single_Line'>/* fix if you change list above */ 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3627"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* In bootstrap mode, the faked-up formrdesc info is all we'll have */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we didn't get the critical system indexes loaded into relcache, do 
     * so now.  These are critical because the catcache and/or opclass cache 
     * depend on them for fetches done during relcache load.  Thus, we have an 
     * infinite-recursion problem.  We can break the recursion by doing 
     * heapscans instead of indexscans at certain key spots. To avoid hobbling 
     * performance, we only want to do that until we have the critical indexes 
     * loaded into relcache.  Thus, the flag criticalRelcachesBuilt is used to 
     * decide whether to do heapscan or indexscan at the key spots, and we set 
     * it true after we've loaded the critical indexes. 
     * 
     * The critical indexes are marked as "nailed in cache", partly to make it 
     * easy for load_relcache_init_file to count them, but mainly because we 
     * cannot flush and rebuild them once we've set criticalRelcachesBuilt to 
     * true.  (NOTE: perhaps it would be possible to reload them by 
     * temporarily setting criticalRelcachesBuilt to false again.  For now, 
     * though, we just nail 'em in.) 
     * 
     * RewriteRelRulenameIndexId and TriggerRelidNameIndexId are not critical 
     * in the same way as the others, because the critical catalogs don't 
     * (currently) have any rules or triggers, and so these indexes can be 
     * rebuilt without inducing recursion.  However they are used during 
     * relcache load when a rel does have rules or triggers, so we choose to 
     * nail them for performance reasons. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN128"><span class='Ref_to_Global_Var'>criticalRelcachesBuilt</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN111"><span class='Ref_to_Const'>ClassOidIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN93"><span class='Ref_to_Const'>AttributeRelidNumIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN163"><span class='Ref_to_Const'>IndexRelidIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_index.h.html#LN28"><span class='Ref_to_Const'>IndexRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN199"><span class='Ref_to_Const'>OpclassOidIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN81"><span class='Ref_to_Const'>AccessMethodProcedureIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_amproc.h.html#LN42"><span class='Ref_to_Const'>AccessMethodProcedureRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN222"><span class='Ref_to_Const'>RewriteRelRulenameIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_rewrite.h.html#LN31"><span class='Ref_to_Const'>RewriteRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN248"><span class='Ref_to_Const'>TriggerRelidNameIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN3710"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUM_CRITICAL_LOCAL_INDEXES</span>  <span class='Number'>7</span>   <span class='Comment_Single_Line'>/* fix if you change list above */ 
</span> 
        <a href="relcache.c.html#LN128"><span class='Ref_to_Global_Var'>criticalRelcachesBuilt</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !criticalRelcachesBui... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Process critical shared indexes too. 
     * 
     * DatabaseNameIndexId isn't critical for relcache loading, but rather for 
     * initial lookup of MyDatabaseId, without which we'll never find any 
     * non-shared catalogs at all.  Autovacuum calls InitPostgres with a 
     * database OID, so it instead depends on DatabaseOidIndexId.  We also 
     * need to nail up some indexes on pg_authid and pg_auth_members for use 
     * during client authentication.  SharedSecLabelObjectIndexId isn't 
     * critical for the core system, but authentication hooks might be 
     * interested in it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN134"><span class='Ref_to_Global_Var'>criticalSharedRelcachesBuilt</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN139"><span class='Ref_to_Const'>DatabaseNameIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN141"><span class='Ref_to_Const'>DatabaseOidIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN96"><span class='Ref_to_Const'>AuthIdRolnameIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN98"><span class='Ref_to_Const'>AuthIdOidIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN103"><span class='Ref_to_Const'>AuthMemMemRoleIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_auth_members.h.html#LN28"><span class='Ref_to_Const'>AuthMemRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN271"><span class='Ref_to_Proto'>load_critical_index</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/indexing.h.html#LN315"><span class='Ref_to_Const'>SharedSecLabelObjectIndexId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_shseclabel.h.html#LN20"><span class='Ref_to_Const'>SharedSecLabelRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN3742"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUM_CRITICAL_SHARED_INDEXES</span> <span class='Number'>6</span>   <span class='Comment_Single_Line'>/* fix if you change list above */ 
</span> 
        <a href="relcache.c.html#LN134"><span class='Ref_to_Global_Var'>criticalSharedRelcachesBuilt</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now, scan all the relcache entries and update anything that might be 
     * wrong in the results from formrdesc or the relcache cache file. If we 
     * faked up relcache entries using formrdesc, then read the real pg_class 
     * rows and replace the fake entries with them. Also, if any of the 
     * relcache entries have rules, triggers, or security policies, load that 
     * info the hard way since it isn't recorded in the cache file. 
     * 
     * Whenever we access the catalogs to read data, there is a possibility of 
     * a shared-inval cache flush causing relcache entries to be removed. 
     * Since hash_seq_search only guarantees to still work after the *current* 
     * entry is removed, it's unsafe to continue the hashtable scan afterward. 
     * We handle this by restarting the scan from scratch after each access. 
     * This is theoretically O(N^2), but the number of entries that actually 
     * need to be fixed is small enough that it doesn't matter. 
     */ 
</span>    <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN3625"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="relcache.c.html#LN3626"><span class='Ref_To_Local'>idhentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN3625"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3767"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span> <span class='Operator'>= </span><a href="relcache.c.html#LN3626"><span class='Ref_To_Local'>idhentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN119"><span class='Ref_to_Member'>reldesc</span></a><span class='Delimiter'>; 
</span><a name="LN3768"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>restart</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make sure *this* entry doesn't get flushed while we work with it. 
         */ 
</span>        <a href="../../../include/utils/rel.h.html#LN635"><span class='Ref_to_Proto'>RelationIncrementReferenceCount</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it's a faked-up entry, read the real pg_class tuple. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relowner <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3780"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN3781"></a>            <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>relp</span><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN3780"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3780"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>))</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, 
</span>                     <a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN3781"><span class='Ref_To_Local'>relp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3780"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Copy tuple to relation-&GT;rd_rel. (See notes in 
             * AllocateRelationDesc()) 
             */ 
</span>            memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN3781"><span class='Ref_To_Local'>relp</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_class.h.html#LN86"><span class='Ref_to_Const'>CLASS_TUPLE_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Update rd_options while we have the tuple */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN265"><span class='Ref_to_Proto'>RelationParseRelOptions</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3780"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Check the values in rd_att were set up correctly.  (We cannot 
             * just copy them over now: formrdesc must have set up the rd_att 
             * data correctly to start with, because it may already have been 
             * copied into one or more catcache entries.) 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN3781"><span class='Ref_To_Local'>relp</span></a><span class='Operator'>-&GT;</span>reltype<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN3781"><span class='Ref_To_Local'>relp</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3780"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* relowner had better be OK now, else we'll loop forever */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relowner <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid relowner in pg_class entry for \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN3768"><span class='Ref_To_Local'>restart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if relation-&GT;rd_rel-&GT;rel... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Fix data that isn't saved in relcache cache file. 
         * 
         * relhasrules or relhastriggers could possibly be wrong or out of 
         * date.  If we don't actually find any rules or triggers, clear the 
         * local copy of the flag so that we don't get into an infinite loop 
         * here.  We don't make any attempt to fix the pg_class entry, though. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasrules <span class='Operator'>&& </span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN117"><span class='Ref_to_Member'>rd_rules</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN657"><span class='Ref_to_Func'>RelationBuildRuleLock</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN117"><span class='Ref_to_Member'>rd_rules</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasrules <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN3768"><span class='Ref_To_Local'>restart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhastriggers <span class='Operator'>&& </span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/commands/trigger.h.html#LN125"><span class='Ref_to_Proto'>RelationBuildTriggers</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhastriggers <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN3768"><span class='Ref_To_Local'>restart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Re-load the row security policies if the relation has them, since 
         * they are not preserved in the cache.  Note that we can never NOT 
         * have a policy while relrowsecurity is true, 
         * RelationBuildRowSecurity will create a single default-deny policy 
         * if there is no policy defined in pg_policy. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relrowsecurity <span class='Operator'>&& </span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN121"><span class='Ref_to_Member'>rd_rsdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/commands/policy.h.html#LN21"><span class='Ref_to_Proto'>RelationBuildRowSecurity</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN121"><span class='Ref_to_Member'>rd_rsdesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN3768"><span class='Ref_To_Local'>restart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reload the partition key and descriptor for a partitioned table. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a> <span class='Operator'>&& 
</span>            <a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN128"><span class='Ref_to_Member'>rd_partkey</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN267"><span class='Ref_to_Proto'>RelationBuildPartitionKey</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN128"><span class='Ref_to_Member'>rd_partkey</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN3768"><span class='Ref_To_Local'>restart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a> <span class='Operator'>&& 
</span>            <a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN130"><span class='Ref_to_Member'>rd_partdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/catalog/partition.h.html#LN72"><span class='Ref_to_Proto'>RelationBuildPartitionDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN130"><span class='Ref_to_Member'>rd_partdesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN3768"><span class='Ref_To_Local'>restart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Release hold on the relation */ 
</span>        <a href="../../../include/utils/rel.h.html#LN636"><span class='Ref_to_Proto'>RelationDecrementReferenceCount</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3767"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now, restart the hashtable scan if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3768"><span class='Ref_To_Local'>restart</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/hsearch.h.html#LN136"><span class='Ref_to_Proto'>hash_seq_term</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN3625"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN3625"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (idhentry=(RelIdCache... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Lastly, write out new relcache cache files if needed.  We don't bother 
     * to distinguish cases where only one of the two needs an update. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3628"><span class='Ref_To_Local'>needNewCacheFile</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Force all the catcaches to finish initializing and thereby open the 
         * catalogs and indexes they use.  This will preload the relcache with 
         * entries for all the most important system catalogs and indexes, so 
         * that the init files will be most useful for future backends. 
         */ 
</span>        <a href="../../../include/utils/syscache.h.html#LN115"><span class='Ref_to_Proto'>InitCatalogCachePhase2</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* now write the files */ 
</span>        <a href="relcache.c.html#LN256"><span class='Ref_to_Proto'>write_relcache_init_file</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN256"><span class='Ref_to_Proto'>write_relcache_init_file</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end RelationCacheInitializePhase3 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Load one critical system index into the relcache 
 * 
 * indexoid is the OID of the target index, heapoid is the OID of the catalog 
 * it belongs to. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3918"></a><span class='Declare_Function'>load_critical_index</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>indexoid</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>heapoid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3920"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>ird</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must lock the underlying catalog before locking the index to avoid 
     * deadlock, since RelationBuildDesc might well need to read the catalog, 
     * and if anyone else is exclusive-locking this catalog and index they'll 
     * be doing it in that order. 
     */ 
</span>    <a href="../../../include/storage/lmgr.h.html#LN39"><span class='Ref_to_Proto'>LockRelationOid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3918"><span class='Ref_to_Parameter'>heapoid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/lmgr.h.html#LN39"><span class='Ref_to_Proto'>LockRelationOid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3918"><span class='Ref_to_Parameter'>indexoid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3920"><span class='Ref_To_Local'>ird</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN269"><span class='Ref_to_Proto'>RelationBuildDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3918"><span class='Ref_to_Parameter'>indexoid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3920"><span class='Ref_To_Local'>ird</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>, </span><span class='String'>"could not open critical system index %u"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN3918"><span class='Ref_to_Parameter'>indexoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3920"><span class='Ref_To_Local'>ird</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3920"><span class='Ref_To_Local'>ird</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/lmgr.h.html#LN42"><span class='Ref_to_Proto'>UnlockRelationOid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3918"><span class='Ref_to_Parameter'>indexoid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/lmgr.h.html#LN42"><span class='Ref_to_Proto'>UnlockRelationOid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3918"><span class='Ref_to_Parameter'>heapoid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end load_critical_index &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GetPgClassDescriptor -- get a predefined tuple descriptor for pg_class 
 * GetPgIndexDescriptor -- get a predefined tuple descriptor for pg_index 
 * 
 * We need this kluge because we have to be able to access non-fixed-width 
 * fields of pg_class and pg_index before we have the standard catalog caches 
 * available.  We use predefined data that's set up in just the same way as 
 * the bootstrapped reldescs used by formrdesc().  The resulting tupdesc is 
 * not 100% kosher: it does not have the correct rowtype OID in tdtypeid, nor 
 * does it have a TupleConstr field.  But it's good enough for the purpose of 
 * extracting fields. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> 
<a name="LN3952"></a><span class='Declare_Function'>BuildHardcodedDescriptor</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>natts</span><span class='Delimiter'>, </span><span class='Keyword'>const </span>FormData_pg_attribute <span class='Operator'>*</span><span class='Declare_Parameter'>attrs</span><span class='Delimiter'>, 
</span><a name="LN3953"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>hasoids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3955"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3956"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN3957"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN3956"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN3955"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3952"><span class='Ref_to_Parameter'>natts</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3953"><span class='Ref_to_Parameter'>hasoids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN3955"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* not right, but we don't care */ 
</span>    <a href="relcache.c.html#LN3955"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3957"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN3957"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN3952"><span class='Ref_to_Parameter'>natts</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN3957"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN3955"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN3957"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="relcache.c.html#LN3952"><span class='Ref_to_Parameter'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN3957"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="../../../include/catalog/pg_attribute.h.html#LN178"><span class='Ref_to_Const'>ATTRIBUTE_FIXED_PART_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* make sure attcacheoff is valid */ 
</span>        <a href="relcache.c.html#LN3955"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN3957"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* initialize first attribute's attcacheoff, cf RelationBuildTupleDesc */ 
</span>    <a href="relcache.c.html#LN3955"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Note: we don't bother to set up a TupleConstr entry */ 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN3956"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN3955"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BuildHardcodedDescriptor &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> 
<a name="LN3983"></a><span class='Declare_Function'>GetPgClassDescriptor</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3985"></a>    <span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Local'>pgclassdesc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Already done? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3985"><span class='Ref_To_Local'>pgclassdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN3985"><span class='Ref_To_Local'>pgclassdesc</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3951"><span class='Ref_to_Func'>BuildHardcodedDescriptor</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>, 
</span>                                               <a href="relcache.c.html#LN99"><span class='Ref_to_Global_Var'>Desc_pg_class</span></a><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN3985"><span class='Ref_To_Local'>pgclassdesc</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> 
<a name="LN3997"></a><span class='Declare_Function'>GetPgIndexDescriptor</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3999"></a>    <span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Local'>pgindexdesc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Already done? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN3999"><span class='Ref_To_Local'>pgindexdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN3999"><span class='Ref_To_Local'>pgindexdesc</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN3951"><span class='Ref_to_Func'>BuildHardcodedDescriptor</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_index.h.html#LN72"><span class='Ref_to_Const'>Natts_pg_index</span></a><span class='Delimiter'>, 
</span>                                               <a href="relcache.c.html#LN106"><span class='Ref_to_Global_Var'>Desc_pg_index</span></a><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN3999"><span class='Ref_To_Local'>pgindexdesc</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Load any default attribute value definitions for the relation. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4014"></a><span class='Declare_Function'>AttrDefaultFetch</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4016"></a>    <a href="../../../include/access/tupdesc.h.html#LN21"><span class='Ref_to_Typedef'>AttrDefault</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attrdef</span> <span class='Operator'>= </span><a href="relcache.c.html#LN4014"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN38"><span class='Ref_to_Member'>defval</span></a><span class='Delimiter'>; 
</span><a name="LN4017"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndef</span> <span class='Operator'>= </span><a href="relcache.c.html#LN4014"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN40"><span class='Ref_to_Member'>num_defval</span></a><span class='Delimiter'>; 
</span><a name="LN4018"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>adrel</span><span class='Delimiter'>; 
</span><a name="LN4019"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>adscan</span><span class='Delimiter'>; 
</span><a name="LN4020"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>; 
</span><a name="LN4021"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN4022"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN4023"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN4024"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN4025"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN4020"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/catalog/pg_attrdef.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_attrdef_adrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4014"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN4018"><span class='Ref_To_Local'>adrel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_attrdef.h.html#LN28"><span class='Ref_to_Const'>AttrDefaultRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4019"><span class='Ref_To_Local'>adscan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4018"><span class='Ref_To_Local'>adrel</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN86"><span class='Ref_to_Const'>AttrDefaultIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4020"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4024"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4021"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4019"><span class='Ref_To_Local'>adscan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4039"></a>        <a href="../../../include/catalog/pg_attrdef.h.html#LN46"><span class='Ref_to_Typedef'>Form_pg_attrdef</span></a> <span class='Declare_Local'>adform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_attrdef.h.html#LN46"><span class='Ref_to_Typedef'>Form_pg_attrdef</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4021"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4025"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN4025"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN4017"><span class='Ref_To_Local'>ndef</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN4025"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4039"><span class='Ref_To_Local'>adform</span></a><span class='Operator'>-&GT;</span>adnum <span class='Operator'>!= </span><a href="relcache.c.html#LN4016"><span class='Ref_To_Local'>attrdef</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN4025"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN23"><span class='Ref_to_Member'>adnum</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4016"><span class='Ref_To_Local'>attrdef</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN4025"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN24"><span class='Ref_to_Member'>adbin</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"multiple attrdef records found for attr %s of rel %s"</span><span class='Delimiter'>, 
</span>                <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4014"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN4039"><span class='Ref_To_Local'>adform</span></a><span class='Operator'>-&GT;</span>adnum <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4014"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="relcache.c.html#LN4024"><span class='Ref_To_Local'>found</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN4022"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4021"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, 
</span>                              <a href="../../../include/catalog/pg_attrdef.h.html#LN55"><span class='Ref_to_Const'>Anum_pg_attrdef_adbin</span></a><span class='Delimiter'>, 
</span>                              <a href="relcache.c.html#LN4018"><span class='Ref_To_Local'>adrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4023"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4023"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"null adbin for attr %s of rel %s"</span><span class='Delimiter'>, 
</span>                <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4014"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN4039"><span class='Ref_To_Local'>adform</span></a><span class='Operator'>-&GT;</span>adnum <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4014"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* detoast and convert to cstring in caller's context */ 
</span><a name="LN4062"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4022"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="relcache.c.html#LN4016"><span class='Ref_To_Local'>attrdef</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN4025"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN24"><span class='Ref_to_Member'>adbin</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4062"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4062"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;ndef;i++ &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4025"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="relcache.c.html#LN4017"><span class='Ref_To_Local'>ndef</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected attrdef record found for attr %d of rel %s"</span><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN4039"><span class='Ref_To_Local'>adform</span></a><span class='Operator'>-&GT;</span>adnum<span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4014"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(htup... &raquo; </span> 
 
    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4019"><span class='Ref_To_Local'>adscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4018"><span class='Ref_To_Local'>adrel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4024"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN4017"><span class='Ref_To_Local'>ndef</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"%d attrdef record(s) missing for rel %s"</span><span class='Delimiter'>, 
</span>             <a href="relcache.c.html#LN4017"><span class='Ref_To_Local'>ndef</span></a> <span class='Operator'>- </span><a href="relcache.c.html#LN4024"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4014"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AttrDefaultFetch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Load any check constraints for the relation. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4087"></a><span class='Declare_Function'>CheckConstraintFetch</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4089"></a>    <a href="../../../include/access/tupdesc.h.html#LN27"><span class='Ref_to_Typedef'>ConstrCheck</span></a> <span class='Operator'>*</span><span class='Declare_Local'>check</span> <span class='Operator'>= </span><a href="relcache.c.html#LN4087"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN39"><span class='Ref_to_Member'>check</span></a><span class='Delimiter'>; 
</span><a name="LN4090"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ncheck</span> <span class='Operator'>= </span><a href="relcache.c.html#LN4087"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN41"><span class='Ref_to_Member'>num_check</span></a><span class='Delimiter'>; 
</span><a name="LN4091"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>conrel</span><span class='Delimiter'>; 
</span><a name="LN4092"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>conscan</span><span class='Delimiter'>; 
</span><a name="LN4093"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4094"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN4095"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN4093"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4087"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN4091"><span class='Ref_To_Local'>conrel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4092"><span class='Ref_To_Local'>conscan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4091"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN4093"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4094"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4092"><span class='Ref_To_Local'>conscan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4108"></a>        <a href="../../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>conform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4094"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4109"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN4110"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN4111"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We want check constraints only */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4108"><span class='Ref_To_Local'>conform</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4095"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>&GT;= </span><a href="relcache.c.html#LN4090"><span class='Ref_To_Local'>ncheck</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected constraint record found for rel %s"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4087"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN4089"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN4095"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN31"><span class='Ref_to_Member'>ccvalid</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4108"><span class='Ref_To_Local'>conform</span></a><span class='Operator'>-&GT;</span>convalidated<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN4089"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN4095"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN32"><span class='Ref_to_Member'>ccnoinherit</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4108"><span class='Ref_To_Local'>conform</span></a><span class='Operator'>-&GT;</span>connoinherit<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN4089"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN4095"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN29"><span class='Ref_to_Member'>ccname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4108"><span class='Ref_To_Local'>conform</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Grab and test conbin is actually set */ 
</span>        <a href="relcache.c.html#LN4109"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4094"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, 
</span>                          <a href="../../../include/catalog/pg_constraint.h.html#LN175"><span class='Ref_to_Const'>Anum_pg_constraint_conbin</span></a><span class='Delimiter'>, 
</span>                          <a href="relcache.c.html#LN4091"><span class='Ref_To_Local'>conrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4110"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4110"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null conbin for rel %s"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4087"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* detoast and convert to cstring in caller's context */ 
</span>        <a href="relcache.c.html#LN4111"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4109"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN4089"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN4095"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/tupdesc.h.html#LN30"><span class='Ref_to_Member'>ccbin</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4111"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4111"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN4095"><span class='Ref_To_Local'>found</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(htup... &raquo; </span> 
 
    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4092"><span class='Ref_To_Local'>conscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4091"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4095"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN4090"><span class='Ref_To_Local'>ncheck</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"%d constraint record(s) missing for rel %s"</span><span class='Delimiter'>, 
</span>             <a href="relcache.c.html#LN4090"><span class='Ref_To_Local'>ncheck</span></a> <span class='Operator'>- </span><a href="relcache.c.html#LN4095"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4087"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sort the records so that CHECKs are applied in a deterministic order */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4090"><span class='Ref_To_Local'>ncheck</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4089"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4090"><span class='Ref_To_Local'>ncheck</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN27"><span class='Ref_to_Typedef'>ConstrCheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN276"><span class='Ref_to_Proto'>CheckConstraintCmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CheckConstraintFetch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * qsort comparator to sort ConstrCheck entries by name 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4158"></a><span class='Declare_Function'>CheckConstraintCmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4160"></a>    <span class='Keyword'>const </span><a href="../../../include/access/tupdesc.h.html#LN27"><span class='Ref_to_Typedef'>ConstrCheck</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ca</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/access/tupdesc.h.html#LN27"><span class='Ref_to_Typedef'>ConstrCheck</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4158"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN4161"></a>    <span class='Keyword'>const </span><a href="../../../include/access/tupdesc.h.html#LN27"><span class='Ref_to_Typedef'>ConstrCheck</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cb</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/access/tupdesc.h.html#LN27"><span class='Ref_to_Typedef'>ConstrCheck</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4158"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> strcmp<span class='Parentheses'>(</span><a href="relcache.c.html#LN4160"><span class='Ref_To_Local'>ca</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN29"><span class='Ref_to_Member'>ccname</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4161"><span class='Ref_To_Local'>cb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN29"><span class='Ref_to_Member'>ccname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RelationGetFKeyList -- get a list of foreign key info for the relation 
 * 
 * Returns a list of ForeignKeyCacheInfo structs, one per FK constraining 
 * the given relation.  This data is a direct copy of relevant fields from 
 * pg_constraint.  The list items are in no particular order. 
 * 
 * CAUTION: the returned list is part of the relcache's data, and could 
 * vanish in a relcache entry reset.  Callers must inspect or copy it 
 * before doing anything that might trigger a cache flush, such as 
 * system catalog accesses.  copyObject() can be used if desired. 
 * (We define it this way because current callers want to filter and 
 * modify the list entries anyway, so copying would be a waste of time.) 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4181"></a><span class='Declare_Function'>RelationGetFKeyList</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4183"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4184"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>conrel</span><span class='Delimiter'>; 
</span><a name="LN4185"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>conscan</span><span class='Delimiter'>; 
</span><a name="LN4186"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>; 
</span><a name="LN4187"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN4188"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>oldlist</span><span class='Delimiter'>; 
</span><a name="LN4189"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit if we already computed the list. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4181"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN125"><span class='Ref_to_Member'>rd_fkeyvalid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="relcache.c.html#LN4181"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN124"><span class='Ref_to_Member'>rd_fkeylist</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fast path: if it doesn't have any triggers, it can't have FKs */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN4181"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhastriggers<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We build the list we intend to return (in the caller's context) while 
     * doing the scan.  After successfully completing the scan, we copy that 
     * list into the relcache entry.  This avoids cache-context memory leakage 
     * if we get some sort of error partway through. 
     */ 
</span>    <a href="relcache.c.html#LN4183"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare to scan pg_constraint for entries having conrelid = this rel. */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN4186"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4181"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN4184"><span class='Ref_To_Local'>conrel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4185"><span class='Ref_To_Local'>conscan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4184"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4186"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4187"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4185"><span class='Ref_To_Local'>conscan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4219"></a>        <a href="../../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>constraint</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4187"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4220"></a>        <a href="../../../include/utils/rel.h.html#LN235"><span class='Ref_to_Struct'>ForeignKeyCacheInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>info</span><span class='Delimiter'>; 
</span><a name="LN4221"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>adatum</span><span class='Delimiter'>; 
</span><a name="LN4222"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN4223"></a>        <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arr</span><span class='Delimiter'>; 
</span><a name="LN4224"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nelem</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* consider only foreign keys */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4219"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../../include/catalog/pg_constraint.h.html#LN188"><span class='Ref_to_Const'>CONSTRAINT_FOREIGN</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN4220"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN235"><span class='Ref_to_Struct'>ForeignKeyCacheInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN4220"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN238"><span class='Ref_to_Member'>conrelid</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4219"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span>conrelid<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN4220"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN239"><span class='Ref_to_Member'>confrelid</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4219"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span>confrelid<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Extract data from conkey field */ 
</span>        <a href="relcache.c.html#LN4221"><span class='Ref_To_Local'>adatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4187"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_constraint.h.html#LN169"><span class='Ref_to_Const'>Anum_pg_constraint_conkey</span></a><span class='Delimiter'>, 
</span>                             <a href="relcache.c.html#LN4184"><span class='Ref_To_Local'>conrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4222"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4222"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null conkey for rel %s"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4181"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4221"><span class='Ref_To_Local'>adatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ensure not toasted */ 
</span>        <a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>&GT; </span><a href="../../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a> <span class='Operator'>|| 
</span>            <a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Parentheses'>)</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"conkey is not a 1-D smallint array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN4220"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN240"><span class='Ref_to_Member'>nkeys</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN4220"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN242"><span class='Ref_to_Member'>conkey</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Likewise for confkey */ 
</span>        <a href="relcache.c.html#LN4221"><span class='Ref_To_Local'>adatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4187"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_constraint.h.html#LN170"><span class='Ref_to_Const'>Anum_pg_constraint_confkey</span></a><span class='Delimiter'>, 
</span>                             <a href="relcache.c.html#LN4184"><span class='Ref_To_Local'>conrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4222"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4222"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null confkey for rel %s"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4181"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4221"><span class='Ref_To_Local'>adatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ensure not toasted */ 
</span>        <a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN4220"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN240"><span class='Ref_to_Member'>nkeys</span></a> <span class='Operator'>|| 
</span>            <a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Parentheses'>)</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"confkey is not a 1-D smallint array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN4220"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN243"><span class='Ref_to_Member'>confkey</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Likewise for conpfeqop */ 
</span>        <a href="relcache.c.html#LN4221"><span class='Ref_To_Local'>adatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4187"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_constraint.h.html#LN171"><span class='Ref_to_Const'>Anum_pg_constraint_conpfeqop</span></a><span class='Delimiter'>, 
</span>                             <a href="relcache.c.html#LN4184"><span class='Ref_To_Local'>conrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4222"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4222"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null conpfeqop for rel %s"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4181"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4221"><span class='Ref_To_Local'>adatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ensure not toasted */ 
</span>        <a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN4220"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN240"><span class='Ref_to_Member'>nkeys</span></a> <span class='Operator'>|| 
</span>            <a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Parentheses'>)</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"conpfeqop is not a 1-D OID array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN4220"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN244"><span class='Ref_to_Member'>conpfeqop</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4223"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN4224"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add FK's node to the result list */ 
</span>        <a href="relcache.c.html#LN4183"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4183"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4220"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(htup... &raquo; </span> 
 
    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4185"><span class='Ref_To_Local'>conscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4184"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now save a copy of the completed list in the relcache entry. */ 
</span>    <a href="relcache.c.html#LN4189"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4188"><span class='Ref_To_Local'>oldlist</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4181"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN124"><span class='Ref_to_Member'>rd_fkeylist</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4181"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN124"><span class='Ref_to_Member'>rd_fkeylist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4183"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4181"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN125"><span class='Ref_to_Member'>rd_fkeyvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4189"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't leak the old list, if there is one */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN266"><span class='Ref_to_Proto'>list_free_deep</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4188"><span class='Ref_To_Local'>oldlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN4183"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationGetFKeyList &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationGetIndexList -- get a list of OIDs of indexes on this relation 
 * 
 * The index list is created only if someone requests it.  We scan pg_index 
 * to find relevant indexes, and add the list to the relcache entry so that 
 * we won't have to compute it again.  Note that shared cache inval of a 
 * relcache entry will delete the old list and set rd_indexvalid to 0, 
 * so that we must recompute the index list on next request.  This handles 
 * creation or deletion of an index. 
 * 
 * Indexes that are marked not IndexIsLive are omitted from the returned list. 
 * Such indexes are expected to be dropped momentarily, and should not be 
 * touched at all by any caller of this function. 
 * 
 * The returned list is guaranteed to be sorted in order by OID.  This is 
 * needed by the executor, since for index types that we obtain exclusive 
 * locks on when updating the index, all backends must lock the indexes in 
 * the same order or we will get deadlocks (see ExecOpenIndices()).  Any 
 * consistent ordering would do, but ordering by OID is easy. 
 * 
 * Since shared cache inval causes the relcache's copy of the list to go away, 
 * we return a copy of the list palloc'd in the caller's context.  The caller 
 * may list_free() the returned list after scanning it. This is necessary 
 * since the caller will typically be doing syscache lookups on the relevant 
 * indexes, and syscache lookup could cause SI messages to be processed! 
 * 
 * We also update rd_oidindex, which this module treats as effectively part 
 * of the index list.  rd_oidindex is valid when rd_indexvalid isn't zero; 
 * it is the pg_class OID of a unique index on OID when the relation has one, 
 * and InvalidOid if there is no such index. 
 * 
 * In exactly the same way, we update rd_pkindex, which is the OID of the 
 * relation's primary key index if any, else InvalidOid; and rd_replidindex, 
 * which is the pg_class OID of an index to be used as the relation's 
 * replication identity index, or InvalidOid if there is no such index. 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4344"></a><span class='Declare_Function'>RelationGetIndexList</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4346"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>indrel</span><span class='Delimiter'>; 
</span><a name="LN4347"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>indscan</span><span class='Delimiter'>; 
</span><a name="LN4348"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>; 
</span><a name="LN4349"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN4350"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4351"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>oldlist</span><span class='Delimiter'>; 
</span><a name="LN4352"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>replident</span> <span class='Operator'>= </span><a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relreplident<span class='Delimiter'>; 
</span><a name="LN4353"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oidIndex</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN4354"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>pkeyIndex</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN4355"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>candidateIndex</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN4356"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit if we already computed the list. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We build the list we intend to return (in the caller's context) while 
     * doing the scan.  After successfully completing the scan, we copy that 
     * list into the relcache entry.  This avoids cache-context memory leakage 
     * if we get some sort of error partway through. 
     */ 
</span>    <a href="relcache.c.html#LN4350"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4353"><span class='Ref_To_Local'>oidIndex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare to scan pg_index for entries having indrelid = this rel. */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN4348"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/catalog/pg_index.h.html#LN74"><span class='Ref_to_Const'>Anum_pg_index_indrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN4346"><span class='Ref_To_Local'>indrel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_index.h.html#LN28"><span class='Ref_to_Const'>IndexRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4347"><span class='Ref_To_Local'>indscan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4346"><span class='Ref_To_Local'>indrel</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN161"><span class='Ref_to_Const'>IndexIndrelidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4348"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4349"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4347"><span class='Ref_To_Local'>indscan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4383"></a>        <a href="../../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a> <span class='Declare_Local'>index</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4349"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4384"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>indclassDatum</span><span class='Delimiter'>; 
</span><a name="LN4385"></a>        <a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>indclass</span><span class='Delimiter'>; 
</span><a name="LN4386"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ignore any indexes that are currently being dropped.  This will 
         * prevent them from being searched, inserted into, or considered in 
         * HOT-safety decisions.  It's unsafe to touch such an index at all 
         * since its catalog entries could disappear at any instant. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/catalog/pg_index.h.html#LN108"><span class='Ref_to_Macro'>IndexIsLive</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add index's OID to result list in the proper order */ 
</span>        <a href="relcache.c.html#LN4350"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN277"><span class='Ref_to_Proto'>insert_ordered_oid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4350"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indexrelid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * indclass cannot be referenced directly through the C struct, 
         * because it comes after the variable-width indkey field.  Must 
         * extract the datum the hard way... 
         */ 
</span>        <a href="relcache.c.html#LN4384"><span class='Ref_To_Local'>indclassDatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4349"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/catalog/pg_index.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_index_indclass</span></a><span class='Delimiter'>, 
</span>                                     <a href="relcache.c.html#LN273"><span class='Ref_to_Proto'>GetPgIndexDescriptor</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="relcache.c.html#LN4386"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN4386"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN4385"><span class='Ref_To_Local'>indclass</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4384"><span class='Ref_To_Local'>indclassDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Invalid, non-unique, non-immediate or predicate indexes aren't 
         * interesting for either oid indexes or replication identity indexes, 
         * so don't check them. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/catalog/pg_index.h.html#LN106"><span class='Ref_to_Macro'>IndexIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Parentheses'>) </span><span class='Operator'>|| !</span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indisunique <span class='Operator'>|| 
</span>            <span class='Operator'>!</span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indimmediate <span class='Operator'>|| 
</span>            <span class='Operator'>!</span><a href="../../access/common/heaptuple.c.html#LN295"><span class='Ref_to_Func'>heap_attisnull</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4349"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_index.h.html#LN91"><span class='Ref_to_Const'>Anum_pg_index_indpred</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check to see if is a usable btree index on OID */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indnatts <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>            <a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a> <span class='Operator'>&& 
</span>            <a href="relcache.c.html#LN4385"><span class='Ref_To_Local'>indclass</span></a><span class='Operator'>-&GT;</span><a href="../../../include/c.h.html#LN485"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_opclass.h.html#LN144"><span class='Ref_to_Const'>OID_BTREE_OPS_OID</span></a><span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN4353"><span class='Ref_To_Local'>oidIndex</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indexrelid<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* remember primary key index if any */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indisprimary<span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN4354"><span class='Ref_To_Local'>pkeyIndex</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indexrelid<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* remember explicitly chosen replica index */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indisreplident<span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN4355"><span class='Ref_To_Local'>candidateIndex</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4383"><span class='Ref_To_Local'>index</span></a><span class='Operator'>-&GT;</span>indexrelid<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(htup... &raquo; </span> 
 
    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4347"><span class='Ref_To_Local'>indscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4346"><span class='Ref_To_Local'>indrel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now save a copy of the completed list in the relcache entry. */ 
</span>    <a href="relcache.c.html#LN4356"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4351"><span class='Ref_To_Local'>oldlist</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4350"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN135"><span class='Ref_to_Member'>rd_oidindex</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4353"><span class='Ref_To_Local'>oidIndex</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN136"><span class='Ref_to_Member'>rd_pkindex</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4354"><span class='Ref_To_Local'>pkeyIndex</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4352"><span class='Ref_To_Local'>replident</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN174"><span class='Ref_to_Const'>REPLICA_IDENTITY_DEFAULT</span></a> <span class='Operator'>&& </span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4354"><span class='Ref_To_Local'>pkeyIndex</span></a><span class='Parentheses'>))</span> 
        <a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN137"><span class='Ref_to_Member'>rd_replidindex</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4354"><span class='Ref_To_Local'>pkeyIndex</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4352"><span class='Ref_To_Local'>replident</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN184"><span class='Ref_to_Const'>REPLICA_IDENTITY_INDEX</span></a> <span class='Operator'>&& </span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4355"><span class='Ref_To_Local'>candidateIndex</span></a><span class='Parentheses'>))</span> 
        <a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN137"><span class='Ref_to_Member'>rd_replidindex</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4355"><span class='Ref_To_Local'>candidateIndex</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN137"><span class='Ref_to_Member'>rd_replidindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4344"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4356"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't leak the old list, if there is one */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4351"><span class='Ref_To_Local'>oldlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN4350"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationGetIndexList &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationGetStatExtList 
 *      get a list of OIDs of statistics objects on this relation 
 * 
 * The statistics list is created only if someone requests it, in a way 
 * similar to RelationGetIndexList().  We scan pg_statistic_ext to find 
 * relevant statistics, and add the list to the relcache entry so that we 
 * won't have to compute it again.  Note that shared cache inval of a 
 * relcache entry will delete the old list and set rd_statvalid to 0, 
 * so that we must recompute the statistics list on next request.  This 
 * handles creation or deletion of a statistics object. 
 * 
 * The returned list is guaranteed to be sorted in order by OID, although 
 * this is not currently needed. 
 * 
 * Since shared cache inval causes the relcache's copy of the list to go away, 
 * we return a copy of the list palloc'd in the caller's context.  The caller 
 * may list_free() the returned list after scanning it. This is necessary 
 * since the caller will typically be doing syscache lookups on the relevant 
 * statistics, and syscache lookup could cause SI messages to be processed! 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4484"></a><span class='Declare_Function'>RelationGetStatExtList</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4486"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>indrel</span><span class='Delimiter'>; 
</span><a name="LN4487"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>indscan</span><span class='Delimiter'>; 
</span><a name="LN4488"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>; 
</span><a name="LN4489"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN4490"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4491"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>oldlist</span><span class='Delimiter'>; 
</span><a name="LN4492"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit if we already computed the list. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4484"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN94"><span class='Ref_to_Member'>rd_statvalid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4484"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN140"><span class='Ref_to_Member'>rd_statlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We build the list we intend to return (in the caller's context) while 
     * doing the scan.  After successfully completing the scan, we copy that 
     * list into the relcache entry.  This avoids cache-context memory leakage 
     * if we get some sort of error partway through. 
     */ 
</span>    <a href="relcache.c.html#LN4490"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare to scan pg_statistic_ext for entries having stxrelid = this 
     * rel. 
     */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN4488"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/catalog/pg_statistic_ext.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_statistic_ext_stxrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4484"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN4486"><span class='Ref_To_Local'>indrel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_statistic_ext.h.html#LN28"><span class='Ref_to_Const'>StatisticExtRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4487"><span class='Ref_To_Local'>indscan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4486"><span class='Ref_To_Local'>indrel</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN189"><span class='Ref_to_Const'>StatisticExtRelidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4488"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4489"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4487"><span class='Ref_To_Local'>indscan</span></a><span class='Parentheses'>)))</span> 
        <a href="relcache.c.html#LN4490"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN277"><span class='Ref_to_Proto'>insert_ordered_oid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4490"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4489"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4487"><span class='Ref_To_Local'>indscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4486"><span class='Ref_To_Local'>indrel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now save a copy of the completed list in the relcache entry. */ 
</span>    <a href="relcache.c.html#LN4492"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4491"><span class='Ref_To_Local'>oldlist</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4484"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN140"><span class='Ref_to_Member'>rd_statlist</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4484"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN140"><span class='Ref_to_Member'>rd_statlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4490"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN4484"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN94"><span class='Ref_to_Member'>rd_statvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4492"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't leak the old list, if there is one */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4491"><span class='Ref_To_Local'>oldlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN4490"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationGetStatExtList &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * insert_ordered_oid 
 *      Insert a new Oid into a sorted list of Oids, preserving ordering 
 * 
 * Building the ordered list this way is O(N^2), but with a pretty small 
 * constant, so for the number of entries we expect it will probably be 
 * faster than trying to apply qsort().  Most tables don't have very many 
 * indexes... 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4550"></a><span class='Declare_Function'>insert_ordered_oid</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>list</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>datum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4552"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>prev</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Does the datum belong at the front? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4550"><span class='Ref_to_Parameter'>list</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| </span><a href="relcache.c.html#LN4550"><span class='Ref_to_Parameter'>datum</span></a> <span class='Operator'>&LT; </span><a href="../../../include/nodes/pg_list.h.html#LN112"><span class='Ref_to_Macro'>linitial_oid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4550"><span class='Ref_to_Parameter'>list</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN217"><span class='Ref_to_Proto'>lcons_oid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4550"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4550"><span class='Ref_to_Parameter'>list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* No, so find the entry it belongs after */ 
</span>    <a href="relcache.c.html#LN4552"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4550"><span class='Ref_to_Parameter'>list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4561"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>curr</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4552"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4561"><span class='Ref_To_Local'>curr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="relcache.c.html#LN4550"><span class='Ref_to_Parameter'>datum</span></a> <span class='Operator'>&LT; </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4561"><span class='Ref_To_Local'>curr</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* it belongs after 'prev', before 'curr' */ 
</span> 
        <a href="relcache.c.html#LN4552"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4561"><span class='Ref_To_Local'>curr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Insert datum into list after 'prev' */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN213"><span class='Ref_to_Proto'>lappend_cell_oid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4550"><span class='Ref_to_Parameter'>list</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4552"><span class='Ref_To_Local'>prev</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4550"><span class='Ref_to_Parameter'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="relcache.c.html#LN4550"><span class='Ref_to_Parameter'>list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end insert_ordered_oid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationSetIndexList -- externally force the index list contents 
 * 
 * This is used to temporarily override what we think the set of valid 
 * indexes is (including the presence or absence of an OID index). 
 * The forcing will be valid only until transaction commit or abort. 
 * 
 * This should only be applied to nailed relations, because in a non-nailed 
 * relation the hacked index list could be lost at any time due to SI 
 * messages.  In practice it is only used on pg_class (see REINDEX). 
 * 
 * It is up to the caller to make sure the given list is correctly ordered. 
 * 
 * We deliberately do not change rd_indexattr here: even when operating 
 * with a temporary partial index list, HOT-update decisions must be made 
 * correctly with respect to the full index set.  It is up to the caller 
 * to ensure that a correct rd_indexattr set has been cached before first 
 * calling RelationSetIndexList; else a subsequent inquiry might cause a 
 * wrong rd_indexattr set to get computed and cached.  Likewise, we do not 
 * touch rd_keyattr, rd_pkattr or rd_idattr. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4595"></a><span class='Declare_Function'>RelationSetIndexList</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexIds</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oidIndex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4597"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Copy the list into the cache context (could fail for lack of mem) */ 
</span>    <a href="relcache.c.html#LN4597"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>indexIds</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>indexIds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4597"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Okay to replace old list */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>indexIds</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN135"><span class='Ref_to_Member'>rd_oidindex</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>oidIndex</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For the moment, assume the target rel hasn't got a pk or replica index. 
     * We'll load them on demand in the API that wraps access to them. 
     */ 
</span>    <a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN136"><span class='Ref_to_Member'>rd_pkindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN137"><span class='Ref_to_Member'>rd_replidindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* mark list as forced */ 
</span>    <span class='Comment_Multi_Line'>/* Flag relation as needing eoxact cleanup (to reset the list) */ 
</span>    <a href="relcache.c.html#LN159"><span class='Ref_to_Macro'>EOXactListAdd</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4595"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationSetIndexList &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationGetOidIndex -- get the pg_class OID of the relation's OID index 
 * 
 * Returns InvalidOid if there is no such index. 
 */ 
</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN4626"></a><span class='Declare_Function'>RelationGetOidIndex</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4628"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ilist</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If relation doesn't have OIDs at all, caller is probably confused. (We 
     * could just silently return InvalidOid, but it seems better to throw an 
     * assertion.) 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN4626"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4626"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* RelationGetIndexList does the heavy lifting. */ 
</span>        <a href="relcache.c.html#LN4628"><span class='Ref_To_Local'>ilist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4626"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4628"><span class='Ref_To_Local'>ilist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN4626"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN4626"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN135"><span class='Ref_to_Member'>rd_oidindex</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationGetOidIndex &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationGetPrimaryKeyIndex -- get OID of the relation's primary key index 
 * 
 * Returns InvalidOid if there is no such index. 
 */ 
</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN4654"></a><span class='Declare_Function'>RelationGetPrimaryKeyIndex</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4656"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ilist</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4654"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* RelationGetIndexList does the heavy lifting. */ 
</span>        <a href="relcache.c.html#LN4656"><span class='Ref_To_Local'>ilist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4654"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4656"><span class='Ref_To_Local'>ilist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN4654"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN4654"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN136"><span class='Ref_to_Member'>rd_pkindex</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RelationGetReplicaIndex -- get OID of the relation's replica identity index 
 * 
 * Returns InvalidOid if there is no such index. 
 */ 
</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN4675"></a><span class='Declare_Function'>RelationGetReplicaIndex</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4677"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ilist</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4675"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* RelationGetIndexList does the heavy lifting. */ 
</span>        <a href="relcache.c.html#LN4677"><span class='Ref_To_Local'>ilist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4675"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4677"><span class='Ref_To_Local'>ilist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN4675"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN4675"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN137"><span class='Ref_to_Member'>rd_replidindex</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RelationGetIndexExpressions -- get the index expressions for an index 
 * 
 * We cache the result of transforming pg_index.indexprs into a node tree. 
 * If the rel is not an index or has no expressional columns, we return NIL. 
 * Otherwise, the returned tree is copied into the caller's memory context. 
 * (We don't want to return a pointer to the relcache copy, since it could 
 * disappear due to relcache invalidation.) 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4700"></a><span class='Declare_Function'>RelationGetIndexExpressions</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4702"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4703"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>exprsDatum</span><span class='Delimiter'>; 
</span><a name="LN4704"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN4705"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>exprsString</span><span class='Delimiter'>; 
</span><a name="LN4706"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit if we already computed the result. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4700"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN186"><span class='Ref_to_Member'>rd_indexprs</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4700"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN186"><span class='Ref_to_Member'>rd_indexprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit if there is nothing to do. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4700"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="../../access/common/heaptuple.c.html#LN295"><span class='Ref_to_Func'>heap_attisnull</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4700"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_index.h.html#LN90"><span class='Ref_to_Const'>Anum_pg_index_indexprs</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We build the tree we intend to return in the caller's context. After 
     * successfully completing the work, we copy it into the relcache entry. 
     * This avoids problems if we get some sort of error partway through. 
     */ 
</span>    <a href="relcache.c.html#LN4703"><span class='Ref_To_Local'>exprsDatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4700"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Delimiter'>, 
</span>                              <a href="../../../include/catalog/pg_index.h.html#LN90"><span class='Ref_to_Const'>Anum_pg_index_indexprs</span></a><span class='Delimiter'>, 
</span>                              <a href="relcache.c.html#LN273"><span class='Ref_to_Proto'>GetPgIndexDescriptor</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="relcache.c.html#LN4704"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN4704"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4705"><span class='Ref_To_Local'>exprsString</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4703"><span class='Ref_To_Local'>exprsDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4702"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4705"><span class='Ref_To_Local'>exprsString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4705"><span class='Ref_To_Local'>exprsString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Run the expressions through eval_const_expressions. This is not just an 
     * optimization, but is necessary, because the planner will be comparing 
     * them to similarly-processed qual clauses, and may fail to detect valid 
     * matches without this.  We don't bother with canonicalize_qual, however. 
     */ 
</span>    <a href="relcache.c.html#LN4702"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN80"><span class='Ref_to_Proto'>eval_const_expressions</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4702"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN4702"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/prep.h.html#LN35"><span class='Ref_to_Proto'>canonicalize_qual</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4702"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* May as well fix opfuncids too */ 
</span>    <a href="../../../include/nodes/nodeFuncs.h.html#LN45"><span class='Ref_to_Proto'>fix_opfuncids</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4702"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now save a copy of the completed tree in the relcache entry. */ 
</span>    <a href="relcache.c.html#LN4706"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4700"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN178"><span class='Ref_to_Member'>rd_indexcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4700"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN186"><span class='Ref_to_Member'>rd_indexprs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4702"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4706"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN4702"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationGetIndexExpressions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationGetIndexPredicate -- get the index predicate for an index 
 * 
 * We cache the result of transforming pg_index.indpred into an implicit-AND 
 * node tree (suitable for use in planning). 
 * If the rel is not an index or has no predicate, we return NIL. 
 * Otherwise, the returned tree is copied into the caller's memory context. 
 * (We don't want to return a pointer to the relcache copy, since it could 
 * disappear due to relcache invalidation.) 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4763"></a><span class='Declare_Function'>RelationGetIndexPredicate</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4765"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4766"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>predDatum</span><span class='Delimiter'>; 
</span><a name="LN4767"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN4768"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>predString</span><span class='Delimiter'>; 
</span><a name="LN4769"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit if we already computed the result. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4763"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN187"><span class='Ref_to_Member'>rd_indpred</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4763"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN187"><span class='Ref_to_Member'>rd_indpred</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit if there is nothing to do. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4763"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="../../access/common/heaptuple.c.html#LN295"><span class='Ref_to_Func'>heap_attisnull</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4763"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_index.h.html#LN91"><span class='Ref_to_Const'>Anum_pg_index_indpred</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We build the tree we intend to return in the caller's context. After 
     * successfully completing the work, we copy it into the relcache entry. 
     * This avoids problems if we get some sort of error partway through. 
     */ 
</span>    <a href="relcache.c.html#LN4766"><span class='Ref_To_Local'>predDatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4763"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Delimiter'>, 
</span>                             <a href="../../../include/catalog/pg_index.h.html#LN91"><span class='Ref_to_Const'>Anum_pg_index_indpred</span></a><span class='Delimiter'>, 
</span>                             <a href="relcache.c.html#LN273"><span class='Ref_to_Proto'>GetPgIndexDescriptor</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="relcache.c.html#LN4767"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN4767"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4768"><span class='Ref_To_Local'>predString</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4766"><span class='Ref_To_Local'>predDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4765"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4768"><span class='Ref_To_Local'>predString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4768"><span class='Ref_To_Local'>predString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Run the expression through const-simplification and canonicalization. 
     * This is not just an optimization, but is necessary, because the planner 
     * will be comparing it to similarly-processed qual clauses, and may fail 
     * to detect valid matches without this.  This must match the processing 
     * done to qual clauses in preprocess_expression()!  (We can skip the 
     * stuff involving subqueries, however, since we don't allow any in index 
     * predicates.) 
     */ 
</span>    <a href="relcache.c.html#LN4765"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/clauses.h.html#LN80"><span class='Ref_to_Proto'>eval_const_expressions</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4765"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN4765"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/prep.h.html#LN35"><span class='Ref_to_Proto'>canonicalize_qual</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4765"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Also convert to implicit-AND format */ 
</span>    <a href="relcache.c.html#LN4765"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/clauses.h.html#LN46"><span class='Ref_to_Proto'>make_ands_implicit</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4765"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* May as well fix opfuncids too */ 
</span>    <a href="../../../include/nodes/nodeFuncs.h.html#LN45"><span class='Ref_to_Proto'>fix_opfuncids</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4765"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now save a copy of the completed tree in the relcache entry. */ 
</span>    <a href="relcache.c.html#LN4769"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4763"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN178"><span class='Ref_to_Member'>rd_indexcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4763"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN187"><span class='Ref_to_Member'>rd_indpred</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4765"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4769"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN4765"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationGetIndexPredicate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationGetIndexAttrBitmap -- get a bitmap of index attribute numbers 
 * 
 * The result has a bit set for each attribute used anywhere in the index 
 * definitions of all the indexes on this relation.  (This includes not only 
 * simple index keys, but attributes used in expressions and partial-index 
 * predicates.) 
 * 
 * Depending on attrKind, a bitmap covering the attnums for all index columns, 
 * for all potential foreign key columns, or for all columns in the configured 
 * replica identity index is returned. 
 * 
 * Attribute numbers are offset by FirstLowInvalidHeapAttributeNumber so that 
 * we can include system attributes (e.g., OID) in the bitmap representation. 
 * 
 * Caller had better hold at least RowExclusiveLock on the target relation 
 * to ensure it is safe (deadlock-free) for us to take locks on the relation's 
 * indexes.  Note that since the introduction of CREATE INDEX CONCURRENTLY, 
 * that lock level doesn't guarantee a stable set of indexes, so we have to 
 * be prepared to retry here in case of a change in the set of indexes. 
 * 
 * The returned result is palloc'd in the caller's memory context and should 
 * be bms_free'd when not needed anymore. 
 */ 
</span><a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>* 
</span><a name="LN4846"></a><span class='Declare_Function'>RelationGetIndexAttrBitmap</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><a href="../../../include/utils/relcache.h.html#LN48"><span class='Ref_to_Enum'>IndexAttrBitmapKind</span></a> <span class='Declare_Parameter'>attrKind</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4848"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>indexattrs</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* indexed columns */ 
</span><a name="LN4849"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>uindexattrs</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* columns in unique indexes */ 
</span><a name="LN4850"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>pkindexattrs</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* columns in the primary index */ 
</span><a name="LN4851"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>idindexattrs</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* columns in the replica identity */ 
</span><a name="LN4852"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexoidlist</span><span class='Delimiter'>; 
</span><a name="LN4853"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newindexoidlist</span><span class='Delimiter'>; 
</span><a name="LN4854"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relpkindex</span><span class='Delimiter'>; 
</span><a name="LN4855"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relreplindex</span><span class='Delimiter'>; 
</span><a name="LN4856"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN4857"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit if we already computed the result. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN143"><span class='Ref_to_Member'>rd_indexattr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>attrKind</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/relcache.h.html#LN50"><span class='Ref_to_EnumConst'>INDEX_ATTR_BITMAP_ALL</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN143"><span class='Ref_to_Member'>rd_indexattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/relcache.h.html#LN51"><span class='Ref_to_EnumConst'>INDEX_ATTR_BITMAP_KEY</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN144"><span class='Ref_to_Member'>rd_keyattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/relcache.h.html#LN52"><span class='Ref_to_EnumConst'>INDEX_ATTR_BITMAP_PRIMARY_KEY</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN145"><span class='Ref_to_Member'>rd_pkattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/relcache.h.html#LN53"><span class='Ref_to_EnumConst'>INDEX_ATTR_BITMAP_IDENTITY_KEY</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN146"><span class='Ref_to_Member'>rd_idattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unknown attrKind %u"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>attrKind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Fast path if definitely no indexes */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/rel.h.html#LN410"><span class='Ref_to_Macro'>RelationGetForm</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>relhasindex<span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get cached list of index OIDs. If we have to start over, we do so here. 
     */ 
</span><a name="LN4884"></a><span class='Label'>restart</span><span class='Operator'>: 
</span>    <a href="relcache.c.html#LN4852"><span class='Ref_To_Local'>indexoidlist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fall out if no indexes (but relhasindex was set) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4852"><span class='Ref_To_Local'>indexoidlist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the rd_pkindex and rd_replidindex values computed by 
     * RelationGetIndexList before proceeding.  This is needed because a 
     * relcache flush could occur inside index_open below, resetting the 
     * fields managed by RelationGetIndexList.  We need to do the work with 
     * stable values of these fields. 
     */ 
</span>    <a href="relcache.c.html#LN4854"><span class='Ref_To_Local'>relpkindex</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN136"><span class='Ref_to_Member'>rd_pkindex</span></a><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4855"><span class='Ref_To_Local'>relreplindex</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN137"><span class='Ref_to_Member'>rd_replidindex</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For each index, add referenced attributes to indexattrs. 
     * 
     * Note: we consider all indexes returned by RelationGetIndexList, even if 
     * they are not indisready or indisvalid.  This is important because an 
     * index for which CREATE INDEX CONCURRENTLY has just started must be 
     * included in HOT-safety decisions (see README.HOT).  If a DROP INDEX 
     * CONCURRENTLY is far enough along that we should ignore the index, it 
     * won't be returned at all by RelationGetIndexList. 
     */ 
</span>    <a href="relcache.c.html#LN4848"><span class='Ref_To_Local'>indexattrs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4849"><span class='Ref_To_Local'>uindexattrs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4850"><span class='Ref_To_Local'>pkindexattrs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4851"><span class='Ref_To_Local'>idindexattrs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4856"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4852"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4917"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexOid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4856"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4918"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>indexDesc</span><span class='Delimiter'>; 
</span><a name="LN4919"></a>        <a href="../../../include/nodes/execnodes.h.html#LN130"><span class='Ref_to_Struct'>IndexInfo</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>indexInfo</span><span class='Delimiter'>; 
</span><a name="LN4920"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4921"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isKey</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* candidate key */ 
</span><a name="LN4922"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isPK</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* primary key */ 
</span><a name="LN4923"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isIDKey</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* replica identity index */ 
</span> 
        <a href="relcache.c.html#LN4918"><span class='Ref_To_Local'>indexDesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN129"><span class='Ref_to_Proto'>index_open</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4917"><span class='Ref_To_Local'>indexOid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Extract index key information from the index's pg_index row */ 
</span>        <a href="relcache.c.html#LN4919"><span class='Ref_To_Local'>indexInfo</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/index.h.html#LN81"><span class='Ref_to_Proto'>BuildIndexInfo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4918"><span class='Ref_To_Local'>indexDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Can this index be referenced by a foreign key? */ 
</span>        <a href="relcache.c.html#LN4921"><span class='Ref_To_Local'>isKey</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN4919"><span class='Ref_To_Local'>indexInfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN145"><span class='Ref_to_Member'>ii_Unique</span></a> <span class='Operator'>&& 
</span>            <a href="relcache.c.html#LN4919"><span class='Ref_To_Local'>indexInfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN135"><span class='Ref_to_Member'>ii_Expressions</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& 
</span>            <a href="relcache.c.html#LN4919"><span class='Ref_To_Local'>indexInfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN137"><span class='Ref_to_Member'>ii_Predicate</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Is this a primary key? */ 
</span>        <a href="relcache.c.html#LN4922"><span class='Ref_To_Local'>isPK</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN4917"><span class='Ref_To_Local'>indexOid</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN4854"><span class='Ref_To_Local'>relpkindex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Is this index the configured (or default) replica identity? */ 
</span>        <a href="relcache.c.html#LN4923"><span class='Ref_To_Local'>isIDKey</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN4917"><span class='Ref_To_Local'>indexOid</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN4855"><span class='Ref_To_Local'>relreplindex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Collect simple attribute references */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4920"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN4920"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN4919"><span class='Ref_To_Local'>indexInfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN133"><span class='Ref_to_Member'>ii_NumIndexAttrs</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN4920"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4944"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attrnum</span> <span class='Operator'>= </span><a href="relcache.c.html#LN4919"><span class='Ref_To_Local'>indexInfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN134"><span class='Ref_to_Member'>ii_KeyAttrNumbers</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN4920"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4944"><span class='Ref_To_Local'>attrnum</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="relcache.c.html#LN4848"><span class='Ref_To_Local'>indexattrs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4848"><span class='Ref_To_Local'>indexattrs</span></a><span class='Delimiter'>, 
</span>                               <a href="relcache.c.html#LN4944"><span class='Ref_To_Local'>attrnum</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4921"><span class='Ref_To_Local'>isKey</span></a><span class='Parentheses'>) 
</span>                    <a href="relcache.c.html#LN4849"><span class='Ref_To_Local'>uindexattrs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4849"><span class='Ref_To_Local'>uindexattrs</span></a><span class='Delimiter'>, 
</span>                               <a href="relcache.c.html#LN4944"><span class='Ref_To_Local'>attrnum</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4922"><span class='Ref_To_Local'>isPK</span></a><span class='Parentheses'>) 
</span>                    <a href="relcache.c.html#LN4850"><span class='Ref_To_Local'>pkindexattrs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4850"><span class='Ref_To_Local'>pkindexattrs</span></a><span class='Delimiter'>, 
</span>                               <a href="relcache.c.html#LN4944"><span class='Ref_To_Local'>attrnum</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4923"><span class='Ref_To_Local'>isIDKey</span></a><span class='Parentheses'>) 
</span>                    <a href="relcache.c.html#LN4851"><span class='Ref_To_Local'>idindexattrs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4851"><span class='Ref_To_Local'>idindexattrs</span></a><span class='Delimiter'>, 
</span>                               <a href="relcache.c.html#LN4944"><span class='Ref_To_Local'>attrnum</span></a> <span class='Operator'>- </span><a href="../../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;indexInfo-&GT;ii_N... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Collect all attributes used in expressions, too */ 
</span>        <a href="../../../include/optimizer/var.h.html#LN31"><span class='Ref_to_Proto'>pull_varattnos</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4919"><span class='Ref_To_Local'>indexInfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN135"><span class='Ref_to_Member'>ii_Expressions</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4848"><span class='Ref_To_Local'>indexattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Collect all attributes in the index predicate, too */ 
</span>        <a href="../../../include/optimizer/var.h.html#LN31"><span class='Ref_to_Proto'>pull_varattnos</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN4919"><span class='Ref_To_Local'>indexInfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN137"><span class='Ref_to_Member'>ii_Predicate</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN4848"><span class='Ref_To_Local'>indexattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4918"><span class='Ref_To_Local'>indexDesc</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * During one of the index_opens in the above loop, we might have received 
     * a relcache flush event on this relcache entry, which might have been 
     * signaling a change in the rel's index list.  If so, we'd better start 
     * over to ensure we deliver up-to-date attribute bitmaps. 
     */ 
</span>    <a href="relcache.c.html#LN4853"><span class='Ref_To_Local'>newindexoidlist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4852"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN4853"><span class='Ref_To_Local'>newindexoidlist</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="relcache.c.html#LN4854"><span class='Ref_To_Local'>relpkindex</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN136"><span class='Ref_to_Member'>rd_pkindex</span></a> <span class='Operator'>&& 
</span>        <a href="relcache.c.html#LN4855"><span class='Ref_To_Local'>relreplindex</span></a> <span class='Operator'>== </span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN137"><span class='Ref_to_Member'>rd_replidindex</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Still the same index set, so proceed */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4853"><span class='Ref_To_Local'>newindexoidlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4852"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Gotta do it over ... might as well not leak memory */ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4853"><span class='Ref_To_Local'>newindexoidlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4852"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4849"><span class='Ref_To_Local'>uindexattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4850"><span class='Ref_To_Local'>pkindexattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4851"><span class='Ref_To_Local'>idindexattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4848"><span class='Ref_To_Local'>indexattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="relcache.c.html#LN4884"><span class='Ref_to_Label'>restart</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Don't leak the old values of these bitmaps, if any */ 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN143"><span class='Ref_to_Member'>rd_indexattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN143"><span class='Ref_to_Member'>rd_indexattr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN144"><span class='Ref_to_Member'>rd_keyattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN144"><span class='Ref_to_Member'>rd_keyattr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN145"><span class='Ref_to_Member'>rd_pkattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN145"><span class='Ref_to_Member'>rd_pkattr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN146"><span class='Ref_to_Member'>rd_idattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN146"><span class='Ref_to_Member'>rd_idattr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now save copies of the bitmaps in the relcache entry.  We intentionally 
     * set rd_indexattr last, because that's the one that signals validity of 
     * the values; if we run out of memory before making that copy, we won't 
     * leave the relcache entry looking like the other ones are valid but 
     * empty. 
     */ 
</span>    <a href="relcache.c.html#LN4857"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN144"><span class='Ref_to_Member'>rd_keyattr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4849"><span class='Ref_To_Local'>uindexattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN145"><span class='Ref_to_Member'>rd_pkattr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4850"><span class='Ref_To_Local'>pkindexattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN146"><span class='Ref_to_Member'>rd_idattr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4851"><span class='Ref_To_Local'>idindexattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN143"><span class='Ref_to_Member'>rd_indexattr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4848"><span class='Ref_To_Local'>indexattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4857"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We return our original working copy for caller to play with */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>attrKind</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/relcache.h.html#LN50"><span class='Ref_to_EnumConst'>INDEX_ATTR_BITMAP_ALL</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="relcache.c.html#LN4848"><span class='Ref_To_Local'>indexattrs</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/relcache.h.html#LN51"><span class='Ref_to_EnumConst'>INDEX_ATTR_BITMAP_KEY</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="relcache.c.html#LN4849"><span class='Ref_To_Local'>uindexattrs</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/relcache.h.html#LN52"><span class='Ref_to_EnumConst'>INDEX_ATTR_BITMAP_PRIMARY_KEY</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN145"><span class='Ref_to_Member'>rd_pkattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/relcache.h.html#LN53"><span class='Ref_to_EnumConst'>INDEX_ATTR_BITMAP_IDENTITY_KEY</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="relcache.c.html#LN4851"><span class='Ref_To_Local'>idindexattrs</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unknown attrKind %u"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN4846"><span class='Ref_to_Parameter'>attrKind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end RelationGetIndexAttrBitmap &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationGetExclusionInfo -- get info about index's exclusion constraint 
 * 
 * This should be called only for an index that is known to have an 
 * associated exclusion constraint.  It returns arrays (palloc'd in caller's 
 * context) of the exclusion operator OIDs, their underlying functions' 
 * OIDs, and their strategy numbers in the index's opclasses.  We cache 
 * all this information since it requires a fair amount of work to get. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN5053"></a><span class='Declare_Function'>RelationGetExclusionInfo</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>indexRelation</span><span class='Delimiter'>, 
</span><a name="LN5054"></a>                         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>operators</span><span class='Delimiter'>, 
</span><a name="LN5055"></a>                         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>procs</span><span class='Delimiter'>, 
</span><a name="LN5056"></a>                         <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>strategies</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5058"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ncols</span> <span class='Operator'>= </span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; 
</span><a name="LN5059"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>ops</span><span class='Delimiter'>; 
</span><a name="LN5060"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>funcs</span><span class='Delimiter'>; 
</span><a name="LN5061"></a>    <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>strats</span><span class='Delimiter'>; 
</span><a name="LN5062"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>conrel</span><span class='Delimiter'>; 
</span><a name="LN5063"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>conscan</span><span class='Delimiter'>; 
</span><a name="LN5064"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN5065"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN5066"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN5067"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN5068"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate result space in caller context */ 
</span>    <span class='Operator'>*</span><a href="relcache.c.html#LN5054"><span class='Ref_to_Parameter'>operators</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5059"><span class='Ref_To_Local'>ops</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="relcache.c.html#LN5055"><span class='Ref_to_Parameter'>procs</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5060"><span class='Ref_To_Local'>funcs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="relcache.c.html#LN5056"><span class='Ref_to_Parameter'>strategies</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5061"><span class='Ref_To_Local'>strats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit if we have the data cached already */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN190"><span class='Ref_to_Member'>rd_exclstrats</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN5059"><span class='Ref_To_Local'>ops</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN188"><span class='Ref_to_Member'>rd_exclops</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN5060"><span class='Ref_To_Local'>funcs</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN189"><span class='Ref_to_Member'>rd_exclprocs</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN5061"><span class='Ref_To_Local'>strats</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN190"><span class='Ref_to_Member'>rd_exclstrats</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Search pg_constraint for the constraint associated with the index. To 
     * make this not too painfully slow, we use the index on conrelid; that 
     * will hold the parent relation's OID not the index's own OID. 
     */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5064"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indrelid<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN5062"><span class='Ref_To_Local'>conrel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN5063"><span class='Ref_To_Local'>conscan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5062"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5064"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN5066"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5065"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5063"><span class='Ref_To_Local'>conscan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5101"></a>        <a href="../../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>conform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5065"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5102"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN5103"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN5104"></a>        <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arr</span><span class='Delimiter'>; 
</span><a name="LN5105"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nelem</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We want the exclusion constraint owning the index */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5101"><span class='Ref_To_Local'>conform</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../../include/catalog/pg_constraint.h.html#LN192"><span class='Ref_to_Const'>CONSTRAINT_EXCLUSION</span></a> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN5101"><span class='Ref_To_Local'>conform</span></a><span class='Operator'>-&GT;</span>conindid <span class='Operator'>!= </span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* There should be only one */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5066"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected exclusion constraint record found for rel %s"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5066"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Extract the operator OIDS from conexclop */ 
</span>        <a href="relcache.c.html#LN5102"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5065"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, 
</span>                          <a href="../../../include/catalog/pg_constraint.h.html#LN174"><span class='Ref_to_Const'>Anum_pg_constraint_conexclop</span></a><span class='Delimiter'>, 
</span>                          <a href="relcache.c.html#LN5062"><span class='Ref_To_Local'>conrel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="relcache.c.html#LN5103"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5103"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null conexclop for rel %s"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN5104"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5102"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* ensure not toasted */ 
</span>        <a href="relcache.c.html#LN5105"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5104"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5104"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN5105"><span class='Ref_To_Local'>nelem</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a> <span class='Operator'>|| 
</span>            <a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5104"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5104"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Parentheses'>)</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"conexclop is not a 1-D Oid array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN5059"><span class='Ref_To_Local'>ops</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5104"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(htup... &raquo; </span> 
 
    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5063"><span class='Ref_To_Local'>conscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5062"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN5066"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"exclusion constraint record missing for rel %s"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We need the func OIDs and strategy numbers too */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN5060"><span class='Ref_To_Local'>funcs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5059"><span class='Ref_To_Local'>ops</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5061"><span class='Ref_To_Local'>strats</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN64"><span class='Ref_to_Proto'>get_op_opfamily_strategy</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5059"><span class='Ref_To_Local'>ops</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                             <a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* shouldn't fail, since it was checked at index creation */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5061"><span class='Ref_To_Local'>strats</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/access/stratnum.h.html#LN23"><span class='Ref_to_Const'>InvalidStrategy</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find strategy for operator %u in family %u"</span><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN5059"><span class='Ref_To_Local'>ops</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5068"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Save a copy of the results in the relcache entry. */ 
</span>    <a href="relcache.c.html#LN5067"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN178"><span class='Ref_to_Member'>rd_indexcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN188"><span class='Ref_to_Member'>rd_exclops</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN189"><span class='Ref_to_Member'>rd_exclprocs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN190"><span class='Ref_to_Member'>rd_exclstrats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN188"><span class='Ref_to_Member'>rd_exclops</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5059"><span class='Ref_To_Local'>ops</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN189"><span class='Ref_to_Member'>rd_exclprocs</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5060"><span class='Ref_To_Local'>funcs</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN5053"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN190"><span class='Ref_to_Member'>rd_exclstrats</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5061"><span class='Ref_To_Local'>strats</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="relcache.c.html#LN5058"><span class='Ref_To_Local'>ncols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5067"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationGetExclusionInfo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get publication actions for the given relation. 
 */ 
</span><span class='Control'>struct</span> <a href="../../../include/catalog/pg_publication.h.html#LN73"><span class='Ref_to_Struct'>PublicationActions</span></a> <span class='Operator'>* 
</span><a name="LN5171"></a><span class='Declare_Function'>GetRelationPublicationActions</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5173"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>puboids</span><span class='Delimiter'>; 
</span><a name="LN5174"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN5175"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN5176"></a>    <a href="../../../include/catalog/pg_publication.h.html#LN73"><span class='Ref_to_Struct'>PublicationActions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pubactions</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_publication.h.html#LN73"><span class='Ref_to_Struct'>PublicationActions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5171"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN148"><span class='Ref_to_Member'>rd_pubactions</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN5176"><span class='Ref_To_Local'>pubactions</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5171"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN148"><span class='Ref_to_Member'>rd_pubactions</span></a><span class='Delimiter'>, 
</span>                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_publication.h.html#LN73"><span class='Ref_to_Struct'>PublicationActions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch the publication membership info. */ 
</span>    <a href="relcache.c.html#LN5173"><span class='Ref_To_Local'>puboids</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_publication.h.html#LN90"><span class='Ref_to_Proto'>GetRelationPublications</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5171"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN5173"><span class='Ref_To_Local'>puboids</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN263"><span class='Ref_to_Proto'>list_concat_unique_oid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5173"><span class='Ref_To_Local'>puboids</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_publication.h.html#LN92"><span class='Ref_to_Proto'>GetAllTablesPublications</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5174"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5173"><span class='Ref_To_Local'>puboids</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5188"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>pubid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5174"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5189"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN5190"></a>        <a href="../../../include/catalog/pg_publication.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_publication</span></a> <span class='Declare_Local'>pubform</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN5189"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN78"><span class='Ref_to_EnumConst'>PUBLICATIONOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5188"><span class='Ref_To_Local'>pubid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5189"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for publication %u"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5188"><span class='Ref_To_Local'>pubid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN5190"><span class='Ref_To_Local'>pubform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_publication.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_publication</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5189"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN5176"><span class='Ref_To_Local'>pubactions</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/pg_publication.h.html#LN75"><span class='Ref_to_Member'>pubinsert</span></a> <span class='Operator'>|= </span><a href="relcache.c.html#LN5190"><span class='Ref_To_Local'>pubform</span></a><span class='Operator'>-&GT;</span>pubinsert<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5176"><span class='Ref_To_Local'>pubactions</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/pg_publication.h.html#LN76"><span class='Ref_to_Member'>pubupdate</span></a> <span class='Operator'>|= </span><a href="relcache.c.html#LN5190"><span class='Ref_To_Local'>pubform</span></a><span class='Operator'>-&GT;</span>pubupdate<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5176"><span class='Ref_To_Local'>pubactions</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/pg_publication.h.html#LN77"><span class='Ref_to_Member'>pubdelete</span></a> <span class='Operator'>|= </span><a href="relcache.c.html#LN5190"><span class='Ref_To_Local'>pubform</span></a><span class='Operator'>-&GT;</span>pubdelete<span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5189"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we know everything is replicated, there is no point to check for 
         * other publications. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5176"><span class='Ref_To_Local'>pubactions</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/pg_publication.h.html#LN75"><span class='Ref_to_Member'>pubinsert</span></a> <span class='Operator'>&& </span><a href="relcache.c.html#LN5176"><span class='Ref_To_Local'>pubactions</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/pg_publication.h.html#LN76"><span class='Ref_to_Member'>pubupdate</span></a> <span class='Operator'>&& 
</span>            <a href="relcache.c.html#LN5176"><span class='Ref_To_Local'>pubactions</span></a><span class='Operator'>-&GT;</span><a href="../../../include/catalog/pg_publication.h.html#LN77"><span class='Ref_to_Member'>pubdelete</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5171"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN148"><span class='Ref_to_Member'>rd_pubactions</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5171"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN148"><span class='Ref_to_Member'>rd_pubactions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5171"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN148"><span class='Ref_to_Member'>rd_pubactions</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now save copy of the actions in the relcache entry. */ 
</span>    <a href="relcache.c.html#LN5175"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN5171"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN148"><span class='Ref_to_Member'>rd_pubactions</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_publication.h.html#LN73"><span class='Ref_to_Struct'>PublicationActions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="relcache.c.html#LN5171"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN148"><span class='Ref_to_Member'>rd_pubactions</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5176"><span class='Ref_To_Local'>pubactions</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_publication.h.html#LN73"><span class='Ref_to_Struct'>PublicationActions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5175"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN5176"><span class='Ref_To_Local'>pubactions</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetRelationPublicationActions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Routines to support ereport() reports of relation-related errors 
 * 
 * These could have been put into elog.c, but it seems like a module layering 
 * violation to have elog.c calling relcache or syscache stuff --- and we 
 * definitely don't want elog.h including rel.h.  So we put them here. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * errtable --- stores schema_name and table_name of a table 
 * within the current errordata. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN5242"></a><span class='Declare_Function'>errtable</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../error/elog.c.html#LN1189"><span class='Ref_to_Func'>err_generic_string</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN64"><span class='Ref_to_Const'>PG_DIAG_SCHEMA_NAME</span></a><span class='Delimiter'>, 
</span>                       <a href="../../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5242"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="../error/elog.c.html#LN1189"><span class='Ref_to_Func'>err_generic_string</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN65"><span class='Ref_to_Const'>PG_DIAG_TABLE_NAME</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5242"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * errtablecol --- stores schema_name, table_name and column_name 
 * of a table column within the current errordata. 
 * 
 * The column is specified by attribute number --- for most callers, this is 
 * easier and less error-prone than getting the column name for themselves. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN5259"></a><span class='Declare_Function'>errtablecol</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5261"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>reldesc</span> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5259"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5262"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>colname</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use reldesc if it's a user attribute, else consult the catalogs */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5259"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="relcache.c.html#LN5259"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&LT;= </span><a href="relcache.c.html#LN5261"><span class='Ref_To_Local'>reldesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN5262"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5261"><span class='Ref_To_Local'>reldesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5259"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN5262"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN86"><span class='Ref_to_Proto'>get_relid_attribute_name</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5259"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5259"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/relcache.h.html#LN78"><span class='Ref_to_Proto'>errtablecolname</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5259"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5262"><span class='Ref_To_Local'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * errtablecolname --- stores schema_name, table_name and column_name 
 * of a table column within the current errordata, where the column name is 
 * given directly rather than extracted from the relation's catalog data. 
 * 
 * Don't use this directly unless errtablecol() is inconvenient for some 
 * reason.  This might possibly be needed during intermediate states in ALTER 
 * TABLE, for instance. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN5283"></a><span class='Declare_Function'>errtablecolname</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/relcache.h.html#LN76"><span class='Ref_to_Proto'>errtable</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5283"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../error/elog.c.html#LN1189"><span class='Ref_to_Func'>err_generic_string</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN66"><span class='Ref_to_Const'>PG_DIAG_COLUMN_NAME</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5283"><span class='Ref_to_Parameter'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * errtableconstraint --- stores schema_name, table_name and constraint_name 
 * of a table-related constraint within the current errordata. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN5296"></a><span class='Declare_Function'>errtableconstraint</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/relcache.h.html#LN76"><span class='Ref_to_Proto'>errtable</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5296"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../error/elog.c.html#LN1189"><span class='Ref_to_Func'>err_generic_string</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN68"><span class='Ref_to_Const'>PG_DIAG_CONSTRAINT_NAME</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5296"><span class='Ref_to_Parameter'>conname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *  load_relcache_init_file, write_relcache_init_file 
 * 
 *      In late 1992, we started regularly having databases with more than 
 *      a thousand classes in them.  With this number of classes, it became 
 *      critical to do indexed lookups on the system catalogs. 
 * 
 *      Bootstrapping these lookups is very hard.  We want to be able to 
 *      use an index on pg_attribute, for example, but in order to do so, 
 *      we must have read pg_attribute for the attributes in the index, 
 *      which implies that we need to use the index. 
 * 
 *      In order to get around the problem, we do the following: 
 * 
 *         +  When the database system is initialized (at initdb time), we 
 *            don't use indexes.  We do sequential scans. 
 * 
 *         +  When the backend is started up in normal mode, we load an image 
 *            of the appropriate relation descriptors, in internal format, 
 *            from an initialization file in the data/base/... directory. 
 * 
 *         +  If the initialization file isn't there, then we create the 
 *            relation descriptors using sequential scans and write 'em to 
 *            the initialization file for use by subsequent backends. 
 * 
 *      As of Postgres 9.0, there is one local initialization file in each 
 *      database, plus one shared initialization file for shared catalogs. 
 * 
 *      We could dispense with the initialization files and just build the 
 *      critical reldescs the hard way on every backend startup, but that 
 *      slows down backend startup noticeably. 
 * 
 *      We can in fact go further, and save more relcache entries than 
 *      just the ones that are absolutely critical; this allows us to speed 
 *      up backend startup by not having to build such entries the hard way. 
 *      Presently, all the catalog and index entries that are referred to 
 *      by catcaches are stored in the initialization files. 
 * 
 *      The same mechanism that detects when catcache and relcache entries 
 *      need to be invalidated (due to catalog updates) also arranges to 
 *      unlink the initialization files when the contents may be out of date. 
 *      The files will then be rebuilt during the next backend startup. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * load_relcache_init_file -- attempt to load cache from the shared 
 * or local cache init file 
 * 
 * If successful, return TRUE and set criticalRelcachesBuilt or 
 * criticalSharedRelcachesBuilt to true. 
 * If not successful, return FALSE. 
 * 
 * NOTE: we assume we are already switched into CacheMemoryContext. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN5360"></a><span class='Declare_Function'>load_relcache_init_file</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>shared</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5362"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>fp</span><span class='Delimiter'>; 
</span><a name="LN5363"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>initfilename</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN5364"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rels</span><span class='Delimiter'>; 
</span><a name="LN5365"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>relno</span><span class='Delimiter'>, 
</span><a name="LN5366"></a>                <span class='Declare_Local'>num_rels</span><span class='Delimiter'>, 
</span><a name="LN5367"></a>                <span class='Declare_Local'>max_rels</span><span class='Delimiter'>, 
</span><a name="LN5368"></a>                <span class='Declare_Local'>nailed_rels</span><span class='Delimiter'>, 
</span><a name="LN5369"></a>                <span class='Declare_Local'>nailed_indexes</span><span class='Delimiter'>, 
</span><a name="LN5370"></a>                <span class='Declare_Local'>magic</span><span class='Delimiter'>; 
</span><a name="LN5371"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5360"><span class='Ref_to_Parameter'>shared</span></a><span class='Parentheses'>) 
</span>        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5363"><span class='Ref_To_Local'>initfilename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5363"><span class='Ref_To_Local'>initfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"global/%s"</span><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN92"><span class='Ref_to_Const'>RELCACHE_INIT_FILENAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5363"><span class='Ref_To_Local'>initfilename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5363"><span class='Ref_To_Local'>initfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, 
</span>                 <a href="../init/globals.c.html#LN84"><span class='Ref_to_Global_Var'>DatabasePath</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN92"><span class='Ref_to_Const'>RELCACHE_INIT_FILENAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5363"><span class='Ref_To_Local'>initfilename</span></a><span class='Delimiter'>, </span><a href="../../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the index relcache entries from the file.  Note we will not enter 
     * any of them into the cache if the read fails partway through; this 
     * helps to guard against broken init files. 
     */ 
</span>    <a href="relcache.c.html#LN5367"><span class='Ref_To_Local'>max_rels</span></a> <span class='Operator'>= </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN5364"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5367"><span class='Ref_To_Local'>max_rels</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN5366"><span class='Ref_To_Local'>num_rels</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN5368"><span class='Ref_To_Local'>nailed_rels</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5369"><span class='Ref_To_Local'>nailed_indexes</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check for correct magic number (compatible version) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5370"><span class='Ref_To_Local'>magic</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5370"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5370"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5370"><span class='Ref_To_Local'>magic</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN94"><span class='Ref_to_Const'>RELCACHE_INIT_FILEMAGIC</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5365"><span class='Ref_To_Local'>relno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;; </span><a href="relcache.c.html#LN5365"><span class='Ref_To_Local'>relno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5402"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN5403"></a>        size_t      <span class='Declare_Local'>nread</span><span class='Delimiter'>; 
</span><a name="LN5404"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN5405"></a>        <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>relform</span><span class='Delimiter'>; 
</span><a name="LN5406"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_not_null</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* first read the relation descriptor length */ 
</span>        <a href="relcache.c.html#LN5403"><span class='Ref_To_Local'>nread</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5403"><span class='Ref_To_Local'>nread</span></a> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5403"><span class='Ref_To_Local'>nread</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* end of file */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* safety check for incompatible relcache layout */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN82"><span class='Ref_to_Struct'>RelationData</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* allocate another relcache header */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5366"><span class='Ref_To_Local'>num_rels</span></a> <span class='Operator'>&GT;= </span><a href="relcache.c.html#LN5367"><span class='Ref_To_Local'>max_rels</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN5367"><span class='Ref_To_Local'>max_rels</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN5364"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5364"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5367"><span class='Ref_To_Local'>max_rels</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5364"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5366"><span class='Ref_To_Local'>num_rels</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* then, read the Relation structure */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* next read the relation tuple form */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN5405"><span class='Ref_To_Local'>relform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="relcache.c.html#LN5405"><span class='Ref_To_Local'>relform</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5405"><span class='Ref_To_Local'>relform</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* initialize attribute tuple forms */ 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a> <span class='Operator'>= </span><a href="../../access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5405"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>, 
</span>                                              <a href="relcache.c.html#LN5405"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* mark as refcounted */ 
</span> 
        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5405"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* unnecessary, but... */ 
</span> 
        <span class='Comment_Multi_Line'>/* next read all the attribute tuple form data entries */ 
</span>        <a href="relcache.c.html#LN5406"><span class='Ref_To_Local'>has_not_null</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5371"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN5371"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN5405"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; </span><a href="relcache.c.html#LN5371"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_attribute.h.html#LN178"><span class='Ref_to_Const'>ATTRIBUTE_FIXED_PART_SIZE</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5371"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5406"><span class='Ref_To_Local'>has_not_null</span></a> <span class='Operator'>|= </span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5371"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attnotnull<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* next read the access method specific field */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* sanity check */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* mark not-null status */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5406"><span class='Ref_To_Local'>has_not_null</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5485"></a>            <a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>constr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5485"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN42"><span class='Ref_to_Member'>has_not_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5485"><span class='Ref_To_Local'>constr</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* If it's an index, there's more to do */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5494"></a>            <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>indexcxt</span><span class='Delimiter'>; 
</span><a name="LN5495"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>opfamily</span><span class='Delimiter'>; 
</span><a name="LN5496"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>opcintype</span><span class='Delimiter'>; 
</span><a name="LN5497"></a>            <a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Operator'>*</span><span class='Declare_Local'>support</span><span class='Delimiter'>; 
</span><a name="LN5498"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>nsupport</span><span class='Delimiter'>; 
</span><a name="LN5499"></a>            <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>indoption</span><span class='Delimiter'>; 
</span><a name="LN5500"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>indcollation</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Count nailed indexes to ensure we have 'em all */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a><span class='Parentheses'>) 
</span>                <a href="relcache.c.html#LN5369"><span class='Ref_To_Local'>nailed_indexes</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* next, read the pg_index tuple */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Fix up internal pointers in the tuple -- see heap_copytuple */ 
</span>            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup.h.html#LN71"><span class='Ref_to_Const'>HEAPTUPLESIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * prepare index info context --- parameters should match 
             * RelationInitIndexAccessInfo 
             */ 
</span>            <a href="relcache.c.html#LN5494"><span class='Ref_To_Local'>indexcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="../../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN178"><span class='Ref_to_Member'>rd_indexcxt</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5494"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Now we can fetch the index AM's API struct.  (We can't store 
             * that in the init file, since it contains function pointers that 
             * might vary across server executions.  Fortunately, it should be 
             * safe to call the amhandler even while bootstrapping indexes.) 
             */ 
</span>            <a href="relcache.c.html#LN278"><span class='Ref_to_Proto'>InitIndexAmRoutine</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* next, read the vector of opfamily OIDs */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5495"><span class='Ref_To_Local'>opfamily</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5494"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="relcache.c.html#LN5495"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5495"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* next, read the vector of opcintype OIDs */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5496"><span class='Ref_To_Local'>opcintype</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5494"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="relcache.c.html#LN5496"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5496"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* next, read the vector of support procedure OIDs */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN5497"><span class='Ref_To_Local'>support</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5494"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="relcache.c.html#LN5497"><span class='Ref_To_Local'>support</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN183"><span class='Ref_to_Member'>rd_support</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5497"><span class='Ref_To_Local'>support</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* next, read the vector of collation OIDs */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5500"><span class='Ref_To_Local'>indcollation</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5494"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="relcache.c.html#LN5500"><span class='Ref_To_Local'>indcollation</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN192"><span class='Ref_to_Member'>rd_indcollation</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5500"><span class='Ref_To_Local'>indcollation</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* finally, read the vector of indoption values */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5499"><span class='Ref_To_Local'>indoption</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5494"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="relcache.c.html#LN5499"><span class='Ref_To_Local'>indoption</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5402"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span> 
            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN185"><span class='Ref_to_Member'>rd_indoption</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5499"><span class='Ref_To_Local'>indoption</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* set up zeroed fmgr-info vector */ 
</span>            <a href="relcache.c.html#LN5498"><span class='Ref_To_Local'>nsupport</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN5405"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>* </span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN180"><span class='Ref_to_Member'>rd_amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN168"><span class='Ref_to_Member'>amsupport</span></a><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN184"><span class='Ref_to_Member'>rd_supportinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5494"><span class='Ref_To_Local'>indexcxt</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5498"><span class='Ref_To_Local'>nsupport</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel-&GT;rd_rel-&GT;relkind=... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Count nailed rels to ensure we have 'em all */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a><span class='Parentheses'>) 
</span>                <a href="relcache.c.html#LN5368"><span class='Ref_To_Local'>nailed_rels</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN178"><span class='Ref_to_Member'>rd_indexcxt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN180"><span class='Ref_to_Member'>rd_amroutine</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN183"><span class='Ref_to_Member'>rd_support</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN184"><span class='Ref_to_Member'>rd_supportinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN185"><span class='Ref_to_Member'>rd_indoption</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN192"><span class='Ref_to_Member'>rd_indcollation</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Rules and triggers are not saved (mainly because the internal 
         * format is complex and subject to change).  They must be rebuilt if 
         * needed by RelationCacheInitializePhase3.  This is not expected to 
         * be a big performance hit since few system catalogs have such. Ditto 
         * for RLS policy data, index expressions, predicates, exclusion info, 
         * and FDW info. 
         */ 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN117"><span class='Ref_to_Member'>rd_rules</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN118"><span class='Ref_to_Member'>rd_rulescxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN121"><span class='Ref_to_Member'>rd_rsdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN127"><span class='Ref_to_Member'>rd_partkeycxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN128"><span class='Ref_to_Member'>rd_partkey</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN129"><span class='Ref_to_Member'>rd_pdcxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN130"><span class='Ref_to_Member'>rd_partdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN131"><span class='Ref_to_Member'>rd_partcheck</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN186"><span class='Ref_to_Member'>rd_indexprs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN187"><span class='Ref_to_Member'>rd_indpred</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN188"><span class='Ref_to_Member'>rd_exclops</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN189"><span class='Ref_to_Member'>rd_exclprocs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN190"><span class='Ref_to_Member'>rd_exclstrats</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN203"><span class='Ref_to_Member'>rd_fdwroutine</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reset transient-state fields in the relcache entry 
         */ 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN86"><span class='Ref_to_Member'>rd_smgr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a><span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN92"><span class='Ref_to_Member'>rd_indexvalid</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN124"><span class='Ref_to_Member'>rd_fkeylist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN125"><span class='Ref_to_Member'>rd_fkeyvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN134"><span class='Ref_to_Member'>rd_indexlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN135"><span class='Ref_to_Member'>rd_oidindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN136"><span class='Ref_to_Member'>rd_pkindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN137"><span class='Ref_to_Member'>rd_replidindex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN143"><span class='Ref_to_Member'>rd_indexattr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN144"><span class='Ref_to_Member'>rd_keyattr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN145"><span class='Ref_to_Member'>rd_pkattr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN146"><span class='Ref_to_Member'>rd_idattr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN148"><span class='Ref_to_Member'>rd_pubactions</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN94"><span class='Ref_to_Member'>rd_statvalid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN140"><span class='Ref_to_Member'>rd_statlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN191"><span class='Ref_to_Member'>rd_amcache</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN217"><span class='Ref_to_Member'>pgstat_info</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN217"><span class='Ref_to_Member'>pgstat_info</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Recompute lock and physical addressing info.  This is needed in 
         * case the pg_internal.init file was copied from some other database 
         * by CREATE DATABASE. 
         */ 
</span>        <a href="../../../include/storage/lmgr.h.html#LN36"><span class='Ref_to_Proto'>RelationInitLockInfo</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN270"><span class='Ref_to_Proto'>RelationInitPhysicalAddr</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5404"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for relno=0;;relno++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We reached the end of the init file without apparent problem.  Did we 
     * get the right number of nailed items?  This is a useful crosscheck in 
     * case the set of critical rels or indexes changes.  However, that should 
     * not happen in a normally-running system, so let's bleat if it does. 
     * 
     * For the shared init file, we're called before client authentication is 
     * done, which means that elog(WARNING) will go only to the postmaster 
     * log, where it's easily missed.  To ensure that developers notice bad 
     * values of NUM_CRITICAL_SHARED_RELS/NUM_CRITICAL_SHARED_INDEXES, we put 
     * an Assert(false) there. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5360"><span class='Ref_to_Parameter'>shared</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5368"><span class='Ref_To_Local'>nailed_rels</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN3602"><span class='Ref_to_Const'>NUM_CRITICAL_SHARED_RELS</span></a> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN5369"><span class='Ref_To_Local'>nailed_indexes</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN3742"><span class='Ref_to_Const'>NUM_CRITICAL_SHARED_INDEXES</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"found %d nailed shared rels and %d nailed shared indexes in init file, but expected %d and %d respectively"</span><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN5368"><span class='Ref_To_Local'>nailed_rels</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5369"><span class='Ref_To_Local'>nailed_indexes</span></a><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN3602"><span class='Ref_to_Const'>NUM_CRITICAL_SHARED_RELS</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3742"><span class='Ref_to_Const'>NUM_CRITICAL_SHARED_INDEXES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Make sure we get developers' attention about this */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* In production builds, recover by bootstrapping the relcache */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5368"><span class='Ref_To_Local'>nailed_rels</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN3659"><span class='Ref_to_Const'>NUM_CRITICAL_LOCAL_RELS</span></a> <span class='Operator'>|| 
</span>            <a href="relcache.c.html#LN5369"><span class='Ref_To_Local'>nailed_indexes</span></a> <span class='Operator'>!= </span><a href="relcache.c.html#LN3710"><span class='Ref_to_Const'>NUM_CRITICAL_LOCAL_INDEXES</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"found %d nailed rels and %d nailed indexes in init file, but expected %d and %d respectively"</span><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN5368"><span class='Ref_To_Local'>nailed_rels</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5369"><span class='Ref_To_Local'>nailed_indexes</span></a><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN3659"><span class='Ref_to_Const'>NUM_CRITICAL_LOCAL_RELS</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN3710"><span class='Ref_to_Const'>NUM_CRITICAL_LOCAL_INDEXES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* We don't need an Assert() in this case */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="relcache.c.html#LN5730"><span class='Ref_to_Label'>read_failed</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, all appears well. 
     * 
     * Now insert all the new relcache entries into the cache. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5365"><span class='Ref_To_Local'>relno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN5365"><span class='Ref_To_Local'>relno</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN5366"><span class='Ref_To_Local'>num_rels</span></a><span class='Delimiter'>; </span><a href="relcache.c.html#LN5365"><span class='Ref_To_Local'>relno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="relcache.c.html#LN179"><span class='Ref_to_Macro'>RelationCacheInsert</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5364"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5365"><span class='Ref_To_Local'>relno</span></a><span class='Delimiter'>], </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5364"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5360"><span class='Ref_to_Parameter'>shared</span></a><span class='Parentheses'>) 
</span>        <a href="relcache.c.html#LN134"><span class='Ref_to_Global_Var'>criticalSharedRelcachesBuilt</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="relcache.c.html#LN128"><span class='Ref_to_Global_Var'>criticalRelcachesBuilt</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * init file is broken, so do it the hard way.  We don't bother trying to 
     * free the clutter we just allocated; it's not in the relcache so it 
     * won't hurt. 
     */ 
</span><a name="LN5730"></a><span class='Label'>read_failed</span><span class='Operator'>: 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5364"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5362"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end load_relcache_init_file &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write out a new initialization file with the current contents 
 * of the relcache (either shared rels or local rels, as indicated). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5742"></a><span class='Declare_Function'>write_relcache_init_file</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>shared</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5744"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>fp</span><span class='Delimiter'>; 
</span><a name="LN5745"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tempfilename</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN5746"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>finalfilename</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN5747"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>magic</span><span class='Delimiter'>; 
</span><a name="LN5748"></a>    <a href="../../../include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN5749"></a>    <a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>idhentry</span><span class='Delimiter'>; 
</span><a name="LN5750"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have already received any relcache inval events, there's no 
     * chance of succeeding so we may as well skip the whole thing. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN142"><span class='Ref_to_Global_Var'>relcacheInvalsReceived</span></a> <span class='Operator'>!= </span><span class='Number'>0L</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must write a temporary file and rename it into place. Otherwise, 
     * another backend starting at about the same time might crash trying to 
     * read the partially-complete file. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5742"><span class='Ref_to_Parameter'>shared</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5745"><span class='Ref_To_Local'>tempfilename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5745"><span class='Ref_To_Local'>tempfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"global/%s.%d"</span><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN92"><span class='Ref_to_Const'>RELCACHE_INIT_FILENAME</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5746"><span class='Ref_To_Local'>finalfilename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5746"><span class='Ref_To_Local'>finalfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"global/%s"</span><span class='Delimiter'>, 
</span>                 <a href="relcache.c.html#LN92"><span class='Ref_to_Const'>RELCACHE_INIT_FILENAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5745"><span class='Ref_To_Local'>tempfilename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5745"><span class='Ref_To_Local'>tempfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/%s.%d"</span><span class='Delimiter'>, 
</span>                 <a href="../init/globals.c.html#LN84"><span class='Ref_to_Global_Var'>DatabasePath</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN92"><span class='Ref_to_Const'>RELCACHE_INIT_FILENAME</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5746"><span class='Ref_To_Local'>finalfilename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5746"><span class='Ref_To_Local'>finalfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, 
</span>                 <a href="../init/globals.c.html#LN84"><span class='Ref_to_Global_Var'>DatabasePath</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN92"><span class='Ref_to_Const'>RELCACHE_INIT_FILENAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5745"><span class='Ref_To_Local'>tempfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* in case it exists w/wrong permissions */ 
</span> 
    <a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5745"><span class='Ref_To_Local'>tempfilename</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We used to consider this a fatal error, but we might as well 
         * continue with backend startup ... 
         */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not create relation-cache initialization file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="relcache.c.html#LN5745"><span class='Ref_To_Local'>tempfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Continuing anyway, but there's something wrong."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Write a magic number to serve as a file version identifier.  We can 
     * change the magic number whenever the relcache layout changes. 
     */ 
</span>    <a href="relcache.c.html#LN5747"><span class='Ref_To_Local'>magic</span></a> <span class='Operator'>= </span><a href="relcache.c.html#LN94"><span class='Ref_to_Const'>RELCACHE_INIT_FILEMAGIC</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5747"><span class='Ref_To_Local'>magic</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5747"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5747"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"could not write init file"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Write all the appropriate reldescs (in no particular order). 
     */ 
</span>    <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5748"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN122"><span class='Ref_to_Global_Var'>RelationIdCache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="relcache.c.html#LN5749"><span class='Ref_To_Local'>idhentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN116"><span class='Ref_to_Typedef'>RelIdCacheEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5748"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5811"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="relcache.c.html#LN5749"><span class='Ref_To_Local'>idhentry</span></a><span class='Operator'>-&GT;</span><a href="relcache.c.html#LN119"><span class='Ref_to_Member'>reldesc</span></a><span class='Delimiter'>; 
</span><a name="LN5812"></a>        <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>relform</span> <span class='Operator'>= </span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ignore if not correct group */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5812"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relisshared <span class='Operator'>!= </span><a href="relcache.c.html#LN5742"><span class='Ref_to_Parameter'>shared</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ignore if not supposed to be in init file.  We can allow any shared 
         * relation that's been loaded so far to be in the shared init file, 
         * but unshared relations must be ones that should be in the local 
         * file per RelationIdIsInInitFile.  (Note: if you want to change the 
         * criterion for rels to be kept in the init file, see also inval.c. 
         * The reason for filtering here is to be sure that we don't put 
         * anything into the local init file for which a relcache inval would 
         * not cause invalidation of that init file.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN5742"><span class='Ref_to_Parameter'>shared</span></a> <span class='Operator'>&& !</span><a href="../../../include/utils/relcache.h.html#LN126"><span class='Ref_to_Proto'>RelationIdIsInInitFile</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Nailed rels had better get stored. */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* first write the relcache entry proper */ 
</span>        <a href="relcache.c.html#LN257"><span class='Ref_to_Proto'>write_item</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN82"><span class='Ref_to_Struct'>RelationData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* next write the relation tuple form */ 
</span>        <a href="relcache.c.html#LN257"><span class='Ref_to_Proto'>write_item</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5812"><span class='Ref_To_Local'>relform</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_class.h.html#LN86"><span class='Ref_to_Const'>CLASS_TUPLE_SIZE</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* next, do all the attribute tuple form data entries */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5750"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="relcache.c.html#LN5750"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="relcache.c.html#LN5812"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; </span><a href="relcache.c.html#LN5750"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="relcache.c.html#LN257"><span class='Ref_to_Proto'>write_item</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="relcache.c.html#LN5750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="../../../include/catalog/pg_attribute.h.html#LN178"><span class='Ref_to_Const'>ATTRIBUTE_FIXED_PART_SIZE</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* next, do the access method specific field */ 
</span>        <a href="relcache.c.html#LN257"><span class='Ref_to_Proto'>write_item</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Delimiter'>, 
</span>                   <span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a> <span class='Operator'>? </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN155"><span class='Ref_to_Member'>rd_options</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If it's an index, there's more to do */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* write the pg_index tuple */ 
</span>            <span class='Comment_Multi_Line'>/* we assume this was created by heap_copytuple! */ 
</span>            <a href="relcache.c.html#LN257"><span class='Ref_to_Proto'>write_item</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Delimiter'>, 
</span>                       <a href="../../../include/access/htup.h.html#LN71"><span class='Ref_to_Const'>HEAPTUPLESIZE</span></a> <span class='Operator'>+ </span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN160"><span class='Ref_to_Member'>rd_indextuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* next, write the vector of opfamily OIDs */ 
</span>            <a href="relcache.c.html#LN257"><span class='Ref_to_Proto'>write_item</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5812"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* next, write the vector of opcintype OIDs */ 
</span>            <a href="relcache.c.html#LN257"><span class='Ref_to_Proto'>write_item</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5812"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* next, write the vector of support procedure OIDs */ 
</span>            <a href="relcache.c.html#LN257"><span class='Ref_to_Proto'>write_item</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN183"><span class='Ref_to_Member'>rd_support</span></a><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5812"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN180"><span class='Ref_to_Member'>rd_amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN168"><span class='Ref_to_Member'>amsupport</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* next, write the vector of collation OIDs */ 
</span>            <a href="relcache.c.html#LN257"><span class='Ref_to_Proto'>write_item</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN192"><span class='Ref_to_Member'>rd_indcollation</span></a><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5812"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* finally, write the vector of indoption values */ 
</span>            <a href="relcache.c.html#LN257"><span class='Ref_to_Proto'>write_item</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5811"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN185"><span class='Ref_to_Member'>rd_indoption</span></a><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5812"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel-&GT;rd_rel-&GT;relkind=... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (idhentry=(RelIdCache... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5744"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"could not write init file"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we have to check whether the data we've so painstakingly 
     * accumulated is already obsolete due to someone else's just-committed 
     * catalog changes.  If so, we just delete the temp file and leave it to 
     * the next backend to try again.  (Our own relcache entries will be 
     * updated by SI message processing, but we can't be sure whether what we 
     * wrote out was up-to-date.) 
     * 
     * This mustn't run concurrently with the code that unlinks an init file 
     * and sends SI messages, so grab a serialization lock for the duration. 
     */ 
</span>    <a href="../../../include/storage/lwlock.h.html#LN145"><span class='Ref_to_Proto'>LWLockAcquire</span></a><span class='Parentheses'>(</span>RelCacheInitLock<span class='Delimiter'>, </span><a href="../../../include/storage/lwlock.h.html#LN133"><span class='Ref_to_EnumConst'>LW_EXCLUSIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make sure we have seen all incoming SI messages */ 
</span>    <a href="../../../include/utils/inval.h.html#LN25"><span class='Ref_to_Proto'>AcceptInvalidationMessages</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have received any SI relcache invals since backend start, assume 
     * we may have written out-of-date data. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN142"><span class='Ref_to_Global_Var'>relcacheInvalsReceived</span></a> <span class='Operator'>== </span><span class='Number'>0L</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * OK, rename the temp file to its final name, deleting any 
         * previously-existing init file. 
         * 
         * Note: a failure here is possible under Cygwin, if some other 
         * backend is holding open an unlinked-but-not-yet-gone init file. So 
         * treat this as a noncritical failure; just remove the useless temp 
         * file on failure. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/dirmod.c.html#LN121"><span class='Ref_to_Macro'>rename</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5745"><span class='Ref_To_Local'>tempfilename</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5746"><span class='Ref_To_Local'>finalfilename</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5745"><span class='Ref_To_Local'>tempfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Delete the already-obsolete temp file */ 
</span>        <a href="../../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5745"><span class='Ref_To_Local'>tempfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/storage/lwlock.h.html#LN148"><span class='Ref_to_Proto'>LWLockRelease</span></a><span class='Parentheses'>(</span>RelCacheInitLock<span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end write_relcache_init_file &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* write a chunk of data preceded by its length */ 
</span><span class='Keyword'>static void 
</span><a name="LN5936"></a><span class='Declare_Function'>write_item</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>fp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="relcache.c.html#LN5936"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5936"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5936"><span class='Ref_to_Parameter'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN5936"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"could not write init file"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><a href="relcache.c.html#LN5936"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5936"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5936"><span class='Ref_to_Parameter'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="relcache.c.html#LN5936"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"could not write init file"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Determine whether a given relation (identified by OID) is one of the ones 
 * we should store in the local relcache init file. 
 * 
 * We must cache all nailed rels, and for efficiency we should cache every rel 
 * that supports a syscache.  The former set is almost but not quite a subset 
 * of the latter.  Currently, we must special-case TriggerRelidNameIndexId, 
 * which RelationCacheInitializePhase3 chooses to nail for efficiency reasons, 
 * but which does not support any syscache. 
 * 
 * Note: this function is currently never called for shared rels.  If it were, 
 * we'd probably also need a special case for DatabaseNameIndexId, which is 
 * critical but does not support a syscache. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN5959"></a><span class='Declare_Function'>RelationIdIsInInitFile</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5959"><span class='Ref_to_Parameter'>relationId</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/indexing.h.html#LN248"><span class='Ref_to_Const'>TriggerRelidNameIndexId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If this Assert fails, we don't need this special case anymore. */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/syscache.h.html#LN148"><span class='Ref_to_Proto'>RelationSupportsSysCache</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5959"><span class='Ref_to_Parameter'>relationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/syscache.h.html#LN148"><span class='Ref_to_Proto'>RelationSupportsSysCache</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5959"><span class='Ref_to_Parameter'>relationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Tells whether any index for the relation is unlogged. 
 * 
 * Note: There doesn't seem to be any way to have an unlogged index attached 
 * to a permanent table, but it seems best to keep this general so that it 
 * returns sensible results even when they seem obvious (like for an unlogged 
 * table) and to handle possible future unlogged indexes on permanent tables. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN5979"></a><span class='Declare_Function'>RelationHasUnloggedIndex</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5981"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexoidlist</span><span class='Delimiter'>; 
</span><a name="LN5982"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>indexoidscan</span><span class='Delimiter'>; 
</span><a name="LN5983"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="relcache.c.html#LN5981"><span class='Ref_To_Local'>indexoidlist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5979"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5982"><span class='Ref_To_Local'>indexoidscan</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN5981"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5989"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexoid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5982"><span class='Ref_To_Local'>indexoidscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5990"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN5991"></a>        <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>reltup</span><span class='Delimiter'>; 
</span> 
        <a href="relcache.c.html#LN5990"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5989"><span class='Ref_To_Local'>indexoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5990"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN5989"><span class='Ref_To_Local'>indexoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="relcache.c.html#LN5991"><span class='Ref_To_Local'>reltup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5990"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5991"><span class='Ref_To_Local'>reltup</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Parentheses'>) 
</span>            <a href="relcache.c.html#LN5983"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5990"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN5983"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN5981"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="relcache.c.html#LN5983"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationHasUnloggedIndex &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Invalidate (remove) the init file during commit of a transaction that 
 * changed one or more of the relation cache entries that are kept in the 
 * local init file. 
 * 
 * To be safe against concurrent inspection or rewriting of the init file, 
 * we must take RelCacheInitLock, then remove the old init file, then send 
 * the SI messages that include relcache inval for such relations, and then 
 * release RelCacheInitLock.  This serializes the whole affair against 
 * write_relcache_init_file, so that we can be sure that any other process 
 * that's concurrently trying to create a new init file won't move an 
 * already-stale version into place after we unlink.  Also, because we unlink 
 * before sending the SI messages, a backend that's currently starting cannot 
 * read the now-obsolete init file and then miss the SI messages that will 
 * force it to update its relcache entries.  (This works because the backend 
 * startup sequence gets into the sinval array before trying to load the init 
 * file.) 
 * 
 * We take the lock and do the unlink in RelationCacheInitFilePreInvalidate, 
 * then release the lock in RelationCacheInitFilePostInvalidate.  Caller must 
 * send any pending SI messages between those calls. 
 * 
 * Notice this deals only with the local init file, not the shared init file. 
 * The reason is that there can never be a "significant" change to the 
 * relcache entry of a shared relation; the most that could happen is 
 * updates of noncritical fields such as relpages/reltuples.  So, while 
 * it's worth updating the shared init file from time to time, it can never 
 * be invalid enough to make it necessary to remove it. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN6042"></a><span class='Declare_Function'>RelationCacheInitFilePreInvalidate</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6044"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>initfilename</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6044"><span class='Ref_To_Local'>initfilename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN6044"><span class='Ref_To_Local'>initfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, 
</span>             <a href="../init/globals.c.html#LN84"><span class='Ref_to_Global_Var'>DatabasePath</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN92"><span class='Ref_to_Const'>RELCACHE_INIT_FILENAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/lwlock.h.html#LN145"><span class='Ref_to_Proto'>LWLockAcquire</span></a><span class='Parentheses'>(</span>RelCacheInitLock<span class='Delimiter'>, </span><a href="../../../include/storage/lwlock.h.html#LN133"><span class='Ref_to_EnumConst'>LW_EXCLUSIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6044"><span class='Ref_To_Local'>initfilename</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The file might not be there if no backend has been started since 
         * the last removal.  But complain about failures other than ENOENT. 
         * Fortunately, it's not too late to abort the transaction if we can't 
         * get rid of the would-be-obsolete init file. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>!= </span>ENOENT<span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not remove cache file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                            <a href="relcache.c.html#LN6044"><span class='Ref_To_Local'>initfilename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end RelationCacheInitFilePreInvalidate &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN6068"></a><span class='Declare_Function'>RelationCacheInitFilePostInvalidate</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/storage/lwlock.h.html#LN148"><span class='Ref_to_Proto'>LWLockRelease</span></a><span class='Parentheses'>(</span>RelCacheInitLock<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remove the init files during postmaster startup. 
 * 
 * We used to keep the init files across restarts, but that is unsafe in PITR 
 * scenarios, and even in simple crash-recovery cases there are windows for 
 * the init files to become out-of-sync with the database.  So now we just 
 * remove them during startup and expect the first backend launch to rebuild 
 * them.  Of course, this has to happen in each database of the cluster. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN6083"></a><span class='Declare_Function'>RelationCacheInitFileRemove</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6085"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tblspcdir</span> <span class='Operator'>= </span><span class='String'>"pg_tblspc"</span><span class='Delimiter'>; 
</span><a name="LN6086"></a>    <a href="../../../port/dirent.c.html#LN24"><span class='Ref_to_Struct'>DIR</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>dir</span><span class='Delimiter'>; 
</span><a name="LN6087"></a>    <span class='Control'>struct</span> <a href="../../../include/port/win32_msvc/dirent.h.html#LN8"><span class='Ref_to_Struct'>dirent</span></a> <span class='Operator'>*</span><span class='Declare_Local'>de</span><span class='Delimiter'>; 
</span><a name="LN6088"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>path</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>+ </span><span class='Number'>10</span> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/catalog/catalog.h.html#LN25"><span class='Ref_to_Const'>TABLESPACE_VERSION_DIRECTORY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We zap the shared cache file too.  In theory it can't get out of sync 
     * enough to be a problem, but in data-corruption cases, who knows ... 
     */ 
</span>    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6088"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN6088"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"global/%s"</span><span class='Delimiter'>, 
</span>             <a href="relcache.c.html#LN92"><span class='Ref_to_Const'>RELCACHE_INIT_FILENAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="relcache.c.html#LN288"><span class='Ref_to_Proto'>unlink_initfile</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6088"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan everything in the default tablespace */ 
</span>    <a href="relcache.c.html#LN287"><span class='Ref_to_Proto'>RelationCacheInitFileRemoveInDir</span></a><span class='Parentheses'>(</span><span class='String'>"base"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan the tablespace link directory to find non-default tablespaces */ 
</span>    <a href="relcache.c.html#LN6086"><span class='Ref_To_Local'>dir</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN91"><span class='Ref_to_Proto'>AllocateDir</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6085"><span class='Ref_To_Local'>tblspcdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN6086"><span class='Ref_To_Local'>dir</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"could not open tablespace link directory \"%s\": %m"</span><span class='Delimiter'>, 
</span>             <a href="relcache.c.html#LN6085"><span class='Ref_To_Local'>tblspcdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="relcache.c.html#LN6087"><span class='Ref_To_Local'>de</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN92"><span class='Ref_to_Proto'>ReadDir</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6086"><span class='Ref_To_Local'>dir</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN6085"><span class='Ref_To_Local'>tblspcdir</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strspn<span class='Parentheses'>(</span><a href="relcache.c.html#LN6087"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><span class='String'>"0123456789"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>strlen<span class='Parentheses'>(</span><a href="relcache.c.html#LN6087"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Scan the tablespace dir for per-database dirs */ 
</span>            <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6088"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN6088"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/%s/%s"</span><span class='Delimiter'>, 
</span>                     <a href="relcache.c.html#LN6085"><span class='Ref_To_Local'>tblspcdir</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN6087"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/catalog.h.html#LN25"><span class='Ref_to_Const'>TABLESPACE_VERSION_DIRECTORY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN287"><span class='Ref_to_Proto'>RelationCacheInitFileRemoveInDir</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6088"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/storage/fd.h.html#LN93"><span class='Ref_to_Proto'>FreeDir</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6086"><span class='Ref_To_Local'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationCacheInitFileRemove &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Process one per-tablespace directory for RelationCacheInitFileRemove */ 
</span><span class='Keyword'>static void 
</span><a name="LN6126"></a><span class='Declare_Function'>RelationCacheInitFileRemoveInDir</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tblspcpath</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6128"></a>    <a href="../../../port/dirent.c.html#LN24"><span class='Ref_to_Struct'>DIR</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>dir</span><span class='Delimiter'>; 
</span><a name="LN6129"></a>    <span class='Control'>struct</span> <a href="../../../include/port/win32_msvc/dirent.h.html#LN8"><span class='Ref_to_Struct'>dirent</span></a> <span class='Operator'>*</span><span class='Declare_Local'>de</span><span class='Delimiter'>; 
</span><a name="LN6130"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>initfilename</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan the tablespace directory to find per-database directories */ 
</span>    <a href="relcache.c.html#LN6128"><span class='Ref_To_Local'>dir</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN91"><span class='Ref_to_Proto'>AllocateDir</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6126"><span class='Ref_to_Parameter'>tblspcpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="relcache.c.html#LN6128"><span class='Ref_To_Local'>dir</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"could not open tablespace directory \"%s\": %m"</span><span class='Delimiter'>, 
</span>             <a href="relcache.c.html#LN6126"><span class='Ref_to_Parameter'>tblspcpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="relcache.c.html#LN6129"><span class='Ref_To_Local'>de</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN92"><span class='Ref_to_Proto'>ReadDir</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6128"><span class='Ref_To_Local'>dir</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN6126"><span class='Ref_to_Parameter'>tblspcpath</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strspn<span class='Parentheses'>(</span><a href="relcache.c.html#LN6129"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><span class='String'>"0123456789"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>strlen<span class='Parentheses'>(</span><a href="relcache.c.html#LN6129"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Try to remove the init file in each database */ 
</span>            <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6130"><span class='Ref_To_Local'>initfilename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="relcache.c.html#LN6130"><span class='Ref_To_Local'>initfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/%s/%s"</span><span class='Delimiter'>, 
</span>                     <a href="relcache.c.html#LN6126"><span class='Ref_to_Parameter'>tblspcpath</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN6129"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><a href="relcache.c.html#LN92"><span class='Ref_to_Const'>RELCACHE_INIT_FILENAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="relcache.c.html#LN288"><span class='Ref_to_Proto'>unlink_initfile</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6130"><span class='Ref_To_Local'>initfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/storage/fd.h.html#LN93"><span class='Ref_to_Proto'>FreeDir</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6128"><span class='Ref_To_Local'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationCacheInitFileRemoveInDir &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN6156"></a><span class='Declare_Function'>unlink_initfile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>initfilename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="relcache.c.html#LN6156"><span class='Ref_to_Parameter'>initfilename</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* It might not be there, but log any error other than ENOENT */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>!= </span>ENOENT<span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"could not remove cache file \"%s\": %m"</span><span class='Delimiter'>, </span><a href="relcache.c.html#LN6156"><span class='Ref_to_Parameter'>initfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>