<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\cache\typcache.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\cache\typcache.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:56 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * typcache.c 
 *    POSTGRES type cache code 
 * 
 * The type cache exists to speed lookup of certain information about data 
 * types that is not directly available from a type's pg_type row.  For 
 * example, we use a type's default btree opclass, or the default hash 
 * opclass if no btree opclass exists, to determine which operators should 
 * be used for grouping and sorting the type (GROUP BY, ORDER BY ASC/DESC). 
 * 
 * Several seemingly-odd choices have been made to support use of the type 
 * cache by generic array and record handling routines, such as array_eq(), 
 * record_cmp(), and hash_array().  Because those routines are used as index 
 * support operations, they cannot leak memory.  To allow them to execute 
 * efficiently, all information that they would like to re-use across calls 
 * is kept in the type cache. 
 * 
 * Once created, a type cache entry lives as long as the backend does, so 
 * there is no need for a call to release a cache entry.  If the type is 
 * dropped, the cache entry simply becomes wasted storage.  This is not 
 * expected to happen often, and assuming that typcache entries are good 
 * permanently allows caching pointers to them in long-lived places. 
 * 
 * We have some provisions for updating cache entries if the stored data 
 * becomes obsolete.  Information dependent on opclasses is cleared if we 
 * detect updates to pg_opclass.  We also support clearing the tuple 
 * descriptor and operator/function parts of a rowtype's cache entry, 
 * since those may need to change as a consequence of ALTER TABLE. 
 * Domain constraint changes are also tracked properly. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/cache/typcache.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/hash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/nbtree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_am.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_constraint.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_enum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_range.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planner.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/catcache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/inval.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* The main type cache hashtable searched by lookup_type_cache */ 
</span><a name="LN71"></a><span class='Keyword'>static </span><a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Var'>TypeCacheHash</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* List of type cache entries for domain types */ 
</span><a name="LN74"></a><span class='Keyword'>static </span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Var'>firstDomainTypeEntry</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Private flag bits in the TypeCacheEntry.flags field */ 
</span><a name="LN77"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_CHECKED_BTREE_OPCLASS</span>       <span class='Number'>0x0001</span> 
<a name="LN78"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_CHECKED_HASH_OPCLASS</span>        <span class='Number'>0x0002</span> 
<a name="LN79"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_CHECKED_EQ_OPR</span>              <span class='Number'>0x0004</span> 
<a name="LN80"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_CHECKED_LT_OPR</span>              <span class='Number'>0x0008</span> 
<a name="LN81"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_CHECKED_GT_OPR</span>              <span class='Number'>0x0010</span> 
<a name="LN82"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_CHECKED_CMP_PROC</span>            <span class='Number'>0x0020</span> 
<a name="LN83"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_CHECKED_HASH_PROC</span>           <span class='Number'>0x0040</span> 
<a name="LN84"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_CHECKED_ELEM_PROPERTIES</span>     <span class='Number'>0x0080</span> 
<a name="LN85"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_HAVE_ELEM_EQUALITY</span>          <span class='Number'>0x0100</span> 
<a name="LN86"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_HAVE_ELEM_COMPARE</span>           <span class='Number'>0x0200</span> 
<a name="LN87"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_HAVE_ELEM_HASHING</span>           <span class='Number'>0x0400</span> 
<a name="LN88"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_CHECKED_FIELD_PROPERTIES</span>    <span class='Number'>0x0800</span> 
<a name="LN89"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_HAVE_FIELD_EQUALITY</span>         <span class='Number'>0x1000</span> 
<a name="LN90"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_HAVE_FIELD_COMPARE</span>          <span class='Number'>0x2000</span> 
<a name="LN91"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TCFLAGS_CHECKED_DOMAIN_CONSTRAINTS</span>  <span class='Number'>0x4000</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Data stored about a domain type's constraints.  Note that we do not create 
 * this struct for the common case of a constraint-less domain; we just set 
 * domainData to NULL to indicate that. 
 * 
 * Within a DomainConstraintCache, we store expression plan trees, but the 
 * check_exprstate fields of the DomainConstraintState nodes are just NULL. 
 * When needed, expression evaluation nodes are built by flat-copying the 
 * DomainConstraintState nodes and applying ExecInitExpr to check_expr. 
 * Such a node tree is not part of the DomainConstraintCache, but is 
 * considered to belong to a DomainConstraintRef. 
 */ 
</span><a name="LN105"></a><span class='Control'>struct</span> <span class='Declare_Struct'>DomainConstraintCache</span> 
<span class='Delimiter'>{ 
</span><a name="LN107"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>constraints</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* list of DomainConstraintState nodes */ 
</span><a name="LN108"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>dccContext</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* memory context holding all associated data */ 
</span><a name="LN109"></a>    <span class='Keyword'>long</span>        <span class='Declare_Member'>dccRefCount</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* number of references to this struct */ 
</span><span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* Private information to support comparisons of enum values */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN115"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>enum_oid</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* OID of one enum value */ 
</span><a name="LN116"></a>    <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Member'>sort_order</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* its sort position */ 
</span><a name="LN117"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>EnumItem</span><span class='Delimiter'>; 
</span> 
<a name="LN119"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>TypeCacheEnumData</span> 
<span class='Delimiter'>{ 
</span><a name="LN121"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>bitmap_base</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* OID corresponding to bit 0 of bitmapset */ 
</span><a name="LN122"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>sorted_values</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Set of OIDs known to be in order */ 
</span><a name="LN123"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>num_values</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* total number of values in enum */ 
</span><a name="LN124"></a>    <a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a>    <span class='Declare_Member'>enum_values</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>]; 
</span><a name="LN125"></a>} <span class='Declare_Typedef'>TypeCacheEnumData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * We use a separate table for storing the definitions of non-anonymous 
 * record types.  Once defined, a record type will be remembered for the 
 * life of the backend.  Subsequent uses of the "same" record type (where 
 * sameness means equalTupleDescs) will refer to the existing table entry. 
 * 
 * Stored record types are remembered in a linear array of TupleDescs, 
 * which can be indexed quickly with the assigned typmod.  There is also 
 * a hash table to speed searches for matching TupleDescs.  The hash key 
 * uses just the first N columns' type OIDs, and so we may have multiple 
 * entries with the same hash key. 
 */ 
</span><a name="LN139"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>REC_HASH_KEYS</span>   <span class='Number'>16</span>      <span class='Comment_Single_Line'>/* use this many columns in hash key */ 
</span> 
<a name="LN141"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>RecordCacheEntry</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* the hash lookup key MUST BE FIRST */ 
</span><a name="LN144"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>hashkey</span><span class='Delimiter'>[</span><a href="typcache.c.html#LN139"><span class='Ref_to_Const'>REC_HASH_KEYS</span></a><span class='Delimiter'>]; </span><span class='Comment_Single_Line'>/* column type IDs, zero-filled */ 
</span> 
    <span class='Comment_Multi_Line'>/* list of TupleDescs for record types with this hashkey */ 
</span><a name="LN147"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>tupdescs</span><span class='Delimiter'>; 
</span><a name="LN148"></a>} <span class='Declare_Typedef'>RecordCacheEntry</span><span class='Delimiter'>; 
</span> 
<a name="LN150"></a><span class='Keyword'>static </span><a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Var'>RecordCacheHash</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN152"></a><span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Operator'>*</span><span class='Declare_Var'>RecordCacheArray</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN153"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Var'>RecordCacheArrayLen</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* allocated length of array */ 
</span><a name="LN154"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Var'>NextRecordTypmod</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* number of entries used */ 
</span> 
<a name="LN156"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>load_typcache_tupdesc</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN157"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>load_rangetype_info</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN158"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>load_domaintype_info</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN159"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>dcs_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN160"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>decr_dcc_refcount</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN105"><span class='Ref_to_Struct'>DomainConstraintCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dcc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN161"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dccref_deletion_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN162"></a><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>prep_domain_constraints</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constraints</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>execctx</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN163"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>array_element_has_equality</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN164"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>array_element_has_compare</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN165"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>array_element_has_hashing</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN166"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>cache_array_element_properties</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN167"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>record_fields_have_equality</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN168"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>record_fields_have_compare</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN169"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>cache_record_field_properties</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN170"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TypeCacheRelCallback</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN171"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TypeCacheOpcCallback</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cacheid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashvalue</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN172"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TypeCacheConstrCallback</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cacheid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashvalue</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN173"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>load_enum_cache_data</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tcache</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN174"></a><span class='Keyword'>static </span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>find_enumitem</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN119"><span class='Ref_to_Struct'>TypeCacheEnumData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>enumdata</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN175"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>enum_oid_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>left</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>right</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * lookup_type_cache 
 * 
 * Fetch the type cache entry for the specified datatype, and make sure that 
 * all the fields requested by bits in 'flags' are valid. 
 * 
 * The result is never NULL --- we will ereport() if the passed type OID is 
 * invalid.  Note however that we may fail to find one or more of the 
 * values requested by 'flags'; the caller needs to check whether the fields 
 * are InvalidOid or not. 
 */ 
</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>* 
</span><a name="LN190"></a><span class='Declare_Function'>lookup_type_cache</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type_id</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>flags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN192"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span><a name="LN193"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN71"><span class='Ref_to_Global_Var'>TypeCacheHash</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First time through: initialize the hash table */ 
</span><a name="LN198"></a>        <a href="../../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typcache.c.html#LN198"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN198"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN198"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN198"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN71"><span class='Ref_to_Global_Var'>TypeCacheHash</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"Type information cache"</span><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="typcache.c.html#LN198"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Also set up callbacks for SI invalidations */ 
</span>        <a href="../../../include/utils/inval.h.html#LN59"><span class='Ref_to_Proto'>CacheRegisterRelcacheCallback</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN170"><span class='Ref_to_Proto'>TypeCacheRelCallback</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/inval.h.html#LN55"><span class='Ref_to_Proto'>CacheRegisterSyscacheCallback</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN47"><span class='Ref_to_EnumConst'>CLAOID</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN171"><span class='Ref_to_Proto'>TypeCacheOpcCallback</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/inval.h.html#LN55"><span class='Ref_to_Proto'>CacheRegisterSyscacheCallback</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN52"><span class='Ref_to_EnumConst'>CONSTROID</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN172"><span class='Ref_to_Proto'>TypeCacheConstrCallback</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/inval.h.html#LN55"><span class='Ref_to_Proto'>CacheRegisterSyscacheCallback</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN172"><span class='Ref_to_Proto'>TypeCacheConstrCallback</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Also make sure CacheMemoryContext exists */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/catcache.h.html#LN168"><span class='Ref_to_Proto'>CreateCacheMemoryContext</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if TypeCacheHash==NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Try to look up an existing entry */ 
</span>    <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN71"><span class='Ref_to_Global_Var'>TypeCacheHash</span></a><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/hsearch.h.html#LN104"><span class='Ref_to_EnumConst'>HASH_FIND</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we didn't find one, we want to make one.  But first look up the 
         * pg_type row, just to make sure we don't make a cache entry for an 
         * invalid type OID.  If the type OID is not valid, present a 
         * user-facing error, since some code paths such as domain_in() allow 
         * this function to be reached with a user-supplied OID. 
         */ 
</span><a name="LN230"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN231"></a>        <a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typtup</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN230"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>type_id</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN230"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>type_id</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN231"><span class='Ref_To_Local'>typtup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN230"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typcache.c.html#LN231"><span class='Ref_To_Local'>typtup</span></a><span class='Operator'>-&GT;</span>typisdefined<span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" is only a shell"</span><span class='Delimiter'>, 
</span>                            <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN231"><span class='Ref_To_Local'>typtup</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now make the typcache entry */ 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN71"><span class='Ref_to_Global_Var'>TypeCacheHash</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typcache.c.html#LN193"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typcache.c.html#LN193"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* it wasn't there a moment ago */ 
</span> 
        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN34"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN231"><span class='Ref_To_Local'>typtup</span></a><span class='Operator'>-&GT;</span>typlen<span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN35"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN231"><span class='Ref_To_Local'>typtup</span></a><span class='Operator'>-&GT;</span>typbyval<span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN36"><span class='Ref_to_Member'>typalign</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN231"><span class='Ref_To_Local'>typtup</span></a><span class='Operator'>-&GT;</span>typalign<span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN37"><span class='Ref_to_Member'>typstorage</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN231"><span class='Ref_To_Local'>typtup</span></a><span class='Operator'>-&GT;</span>typstorage<span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN38"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN231"><span class='Ref_To_Local'>typtup</span></a><span class='Operator'>-&GT;</span>typtype<span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN39"><span class='Ref_to_Member'>typrelid</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN231"><span class='Ref_To_Local'>typtup</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If it's a domain, immediately thread it into the domain cache list */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN38"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN105"><span class='Ref_to_Member'>nextDomain</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN74"><span class='Ref_to_Global_Var'>firstDomainTypeEntry</span></a><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN74"><span class='Ref_to_Global_Var'>firstDomainTypeEntry</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN230"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if typentry==NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Look up opclasses if we haven't already and any dependent info is 
     * requested. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN109"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR</span></a> <span class='Operator'>| </span><a href="../../../include/utils/typcache.h.html#LN110"><span class='Ref_to_Const'>TYPECACHE_LT_OPR</span></a> <span class='Operator'>| </span><a href="../../../include/utils/typcache.h.html#LN111"><span class='Ref_to_Const'>TYPECACHE_GT_OPR</span></a> <span class='Operator'>| 
</span>                  <a href="../../../include/utils/typcache.h.html#LN112"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC</span></a> <span class='Operator'>| 
</span>                  <a href="../../../include/utils/typcache.h.html#LN114"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR_FINFO</span></a> <span class='Operator'>| </span><a href="../../../include/utils/typcache.h.html#LN115"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC_FINFO</span></a> <span class='Operator'>| 
</span>                  <a href="../../../include/utils/typcache.h.html#LN118"><span class='Ref_to_Const'>TYPECACHE_BTREE_OPFAMILY</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN77"><span class='Ref_to_Const'>TCFLAGS_CHECKED_BTREE_OPCLASS</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN280"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opclass</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN280"><span class='Ref_To_Local'>opclass</span></a> <span class='Operator'>= </span><a href="../../../include/commands/defrem.h.html#LN44"><span class='Ref_to_Proto'>GetDefaultOpClass</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN280"><span class='Ref_To_Local'>opclass</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN96"><span class='Ref_to_Proto'>get_opclass_family</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN280"><span class='Ref_To_Local'>opclass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN50"><span class='Ref_to_Member'>btree_opintype</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN97"><span class='Ref_to_Proto'>get_opclass_input_type</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN280"><span class='Ref_To_Local'>opclass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN50"><span class='Ref_to_Member'>btree_opintype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reset information derived from btree opclass.  Note in particular 
         * that we'll redetermine the eq_opr even if we previously found one; 
         * this matters in case a btree opclass has been added to a type that 
         * previously had only a hash opclass. 
         */ 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>&= ~</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN79"><span class='Ref_to_Const'>TCFLAGS_CHECKED_EQ_OPR</span></a> <span class='Operator'>| 
</span>                             <a href="typcache.c.html#LN80"><span class='Ref_to_Const'>TCFLAGS_CHECKED_LT_OPR</span></a> <span class='Operator'>| 
</span>                             <a href="typcache.c.html#LN81"><span class='Ref_to_Const'>TCFLAGS_CHECKED_GT_OPR</span></a> <span class='Operator'>| 
</span>                             <a href="typcache.c.html#LN82"><span class='Ref_to_Const'>TCFLAGS_CHECKED_CMP_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN77"><span class='Ref_to_Const'>TCFLAGS_CHECKED_BTREE_OPCLASS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (flags&(TYPECACHE_EQ_... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we need to look up equality operator, and there's no btree opclass, 
     * force lookup of hash opclass. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN109"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR</span></a> <span class='Operator'>| </span><a href="../../../include/utils/typcache.h.html#LN114"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR_FINFO</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN79"><span class='Ref_to_Const'>TCFLAGS_CHECKED_EQ_OPR</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
        <a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>|= </span><a href="../../../include/utils/typcache.h.html#LN119"><span class='Ref_to_Const'>TYPECACHE_HASH_OPFAMILY</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN113"><span class='Ref_to_Const'>TYPECACHE_HASH_PROC</span></a> <span class='Operator'>| </span><a href="../../../include/utils/typcache.h.html#LN116"><span class='Ref_to_Const'>TYPECACHE_HASH_PROC_FINFO</span></a> <span class='Operator'>| 
</span>                  <a href="../../../include/utils/typcache.h.html#LN119"><span class='Ref_to_Const'>TYPECACHE_HASH_OPFAMILY</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN78"><span class='Ref_to_Const'>TCFLAGS_CHECKED_HASH_OPCLASS</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN319"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opclass</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN319"><span class='Ref_To_Local'>opclass</span></a> <span class='Operator'>= </span><a href="../../../include/commands/defrem.h.html#LN44"><span class='Ref_to_Proto'>GetDefaultOpClass</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_am.h.html#LN72"><span class='Ref_to_Const'>HASH_AM_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN319"><span class='Ref_To_Local'>opclass</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN51"><span class='Ref_to_Member'>hash_opf</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN96"><span class='Ref_to_Proto'>get_opclass_family</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN319"><span class='Ref_To_Local'>opclass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN52"><span class='Ref_to_Member'>hash_opintype</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN97"><span class='Ref_to_Proto'>get_opclass_input_type</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN319"><span class='Ref_To_Local'>opclass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN51"><span class='Ref_to_Member'>hash_opf</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN52"><span class='Ref_to_Member'>hash_opintype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reset information derived from hash opclass.  We do *not* reset the 
         * eq_opr; if we already found one from the btree opclass, that 
         * decision is still good. 
         */ 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>&= ~</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN83"><span class='Ref_to_Const'>TCFLAGS_CHECKED_HASH_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN78"><span class='Ref_to_Const'>TCFLAGS_CHECKED_HASH_OPCLASS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (flags&(TYPECACHE_HAS... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Look for requested operators and functions, if we haven't already. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN109"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR</span></a> <span class='Operator'>| </span><a href="../../../include/utils/typcache.h.html#LN114"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR_FINFO</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN79"><span class='Ref_to_Const'>TCFLAGS_CHECKED_EQ_OPR</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN347"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eq_opr</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="typcache.c.html#LN347"><span class='Ref_To_Local'>eq_opr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a><span class='Delimiter'>, 
</span>                                         <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN50"><span class='Ref_to_Member'>btree_opintype</span></a><span class='Delimiter'>, 
</span>                                         <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN50"><span class='Ref_to_Member'>btree_opintype</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN347"><span class='Ref_To_Local'>eq_opr</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN51"><span class='Ref_to_Member'>hash_opf</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="typcache.c.html#LN347"><span class='Ref_To_Local'>eq_opr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN51"><span class='Ref_to_Member'>hash_opf</span></a><span class='Delimiter'>, 
</span>                                         <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN52"><span class='Ref_to_Member'>hash_opintype</span></a><span class='Delimiter'>, 
</span>                                         <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN52"><span class='Ref_to_Member'>hash_opintype</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/access/hash.h.html#LN289"><span class='Ref_to_Const'>HTEqualStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the proposed equality operator is array_eq or record_eq, check 
         * to see if the element type or column types support equality. If 
         * not, array_eq or record_eq would fail at runtime, so we don't want 
         * to report that the type has equality. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN347"><span class='Ref_To_Local'>eq_opr</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN775"><span class='Ref_to_Const'>ARRAY_EQ_OP</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="typcache.c.html#LN163"><span class='Ref_to_Proto'>array_element_has_equality</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN347"><span class='Ref_To_Local'>eq_opr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN347"><span class='Ref_To_Local'>eq_opr</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN1719"><span class='Ref_to_Const'>RECORD_EQ_OP</span></a> <span class='Operator'>&& 
</span>                 <span class='Operator'>!</span><a href="typcache.c.html#LN167"><span class='Ref_to_Proto'>record_fields_have_equality</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN347"><span class='Ref_To_Local'>eq_opr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Force update of eq_opr_finfo only if we're changing state */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a> <span class='Operator'>!= </span><a href="typcache.c.html#LN347"><span class='Ref_To_Local'>eq_opr</span></a><span class='Parentheses'>) 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN347"><span class='Ref_To_Local'>eq_opr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reset info about hash function whenever we pick up new info about 
         * equality operator.  This is so we can ensure that the hash function 
         * matches the operator. 
         */ 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>&= ~</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN83"><span class='Ref_to_Const'>TCFLAGS_CHECKED_HASH_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN79"><span class='Ref_to_Const'>TCFLAGS_CHECKED_EQ_OPR</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (flags&(TYPECACHE_EQ_... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/typcache.h.html#LN110"><span class='Ref_to_Const'>TYPECACHE_LT_OPR</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN80"><span class='Ref_to_Const'>TCFLAGS_CHECKED_LT_OPR</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN391"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>lt_opr</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="typcache.c.html#LN391"><span class='Ref_To_Local'>lt_opr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a><span class='Delimiter'>, 
</span>                                         <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN50"><span class='Ref_to_Member'>btree_opintype</span></a><span class='Delimiter'>, 
</span>                                         <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN50"><span class='Ref_to_Member'>btree_opintype</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* As above, make sure array_cmp or record_cmp will succeed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN391"><span class='Ref_To_Local'>lt_opr</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN780"><span class='Ref_to_Const'>ARRAY_LT_OP</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="typcache.c.html#LN164"><span class='Ref_to_Proto'>array_element_has_compare</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN391"><span class='Ref_To_Local'>lt_opr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN391"><span class='Ref_To_Local'>lt_opr</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN1724"><span class='Ref_to_Const'>RECORD_LT_OP</span></a> <span class='Operator'>&& 
</span>                 <span class='Operator'>!</span><a href="typcache.c.html#LN168"><span class='Ref_to_Proto'>record_fields_have_compare</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN391"><span class='Ref_To_Local'>lt_opr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN54"><span class='Ref_to_Member'>lt_opr</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN391"><span class='Ref_To_Local'>lt_opr</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN80"><span class='Ref_to_Const'>TCFLAGS_CHECKED_LT_OPR</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (flags&TYPECACHE_LT_O... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/typcache.h.html#LN111"><span class='Ref_to_Const'>TYPECACHE_GT_OPR</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN81"><span class='Ref_to_Const'>TCFLAGS_CHECKED_GT_OPR</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN413"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>gt_opr</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="typcache.c.html#LN413"><span class='Ref_To_Local'>gt_opr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a><span class='Delimiter'>, 
</span>                                         <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN50"><span class='Ref_to_Member'>btree_opintype</span></a><span class='Delimiter'>, 
</span>                                         <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN50"><span class='Ref_to_Member'>btree_opintype</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* As above, make sure array_cmp or record_cmp will succeed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN413"><span class='Ref_To_Local'>gt_opr</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN783"><span class='Ref_to_Const'>ARRAY_GT_OP</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="typcache.c.html#LN164"><span class='Ref_to_Proto'>array_element_has_compare</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN413"><span class='Ref_To_Local'>gt_opr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN413"><span class='Ref_To_Local'>gt_opr</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN1727"><span class='Ref_to_Const'>RECORD_GT_OP</span></a> <span class='Operator'>&& 
</span>                 <span class='Operator'>!</span><a href="typcache.c.html#LN168"><span class='Ref_to_Proto'>record_fields_have_compare</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN413"><span class='Ref_To_Local'>gt_opr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN55"><span class='Ref_to_Member'>gt_opr</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN413"><span class='Ref_To_Local'>gt_opr</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN81"><span class='Ref_to_Const'>TCFLAGS_CHECKED_GT_OPR</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (flags&TYPECACHE_GT_O... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN112"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC</span></a> <span class='Operator'>| </span><a href="../../../include/utils/typcache.h.html#LN115"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC_FINFO</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN82"><span class='Ref_to_Const'>TCFLAGS_CHECKED_CMP_PROC</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN435"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>cmp_proc</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="typcache.c.html#LN435"><span class='Ref_To_Local'>cmp_proc</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN83"><span class='Ref_to_Proto'>get_opfamily_proc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN49"><span class='Ref_to_Member'>btree_opf</span></a><span class='Delimiter'>, 
</span>                                         <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN50"><span class='Ref_to_Member'>btree_opintype</span></a><span class='Delimiter'>, 
</span>                                         <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN50"><span class='Ref_to_Member'>btree_opintype</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/access/nbtree.h.html#LN228"><span class='Ref_to_Const'>BTORDER_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* As above, make sure array_cmp or record_cmp will succeed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN435"><span class='Ref_To_Local'>cmp_proc</span></a> <span class='Operator'>== </span>F_BTARRAYCMP <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="typcache.c.html#LN164"><span class='Ref_to_Proto'>array_element_has_compare</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN435"><span class='Ref_To_Local'>cmp_proc</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN435"><span class='Ref_To_Local'>cmp_proc</span></a> <span class='Operator'>== </span>F_BTRECORDCMP <span class='Operator'>&& 
</span>                 <span class='Operator'>!</span><a href="typcache.c.html#LN168"><span class='Ref_to_Proto'>record_fields_have_compare</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN435"><span class='Ref_To_Local'>cmp_proc</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Force update of cmp_proc_finfo only if we're changing state */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN56"><span class='Ref_to_Member'>cmp_proc</span></a> <span class='Operator'>!= </span><a href="typcache.c.html#LN435"><span class='Ref_To_Local'>cmp_proc</span></a><span class='Parentheses'>) 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN56"><span class='Ref_to_Member'>cmp_proc</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN435"><span class='Ref_To_Local'>cmp_proc</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN82"><span class='Ref_to_Const'>TCFLAGS_CHECKED_CMP_PROC</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (flags&(TYPECACHE_CMP... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN113"><span class='Ref_to_Const'>TYPECACHE_HASH_PROC</span></a> <span class='Operator'>| </span><a href="../../../include/utils/typcache.h.html#LN116"><span class='Ref_to_Const'>TYPECACHE_HASH_PROC_FINFO</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN83"><span class='Ref_to_Const'>TCFLAGS_CHECKED_HASH_PROC</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN461"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>hash_proc</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We insist that the eq_opr, if one has been determined, match the 
         * hash opclass; else report there is no hash function. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN51"><span class='Ref_to_Member'>hash_opf</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>             <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a> <span class='Operator'>== </span><a href="../../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN51"><span class='Ref_to_Member'>hash_opf</span></a><span class='Delimiter'>, 
</span>                                                     <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN52"><span class='Ref_to_Member'>hash_opintype</span></a><span class='Delimiter'>, 
</span>                                                     <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN52"><span class='Ref_to_Member'>hash_opintype</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/access/hash.h.html#LN289"><span class='Ref_to_Const'>HTEqualStrategyNumber</span></a><span class='Parentheses'>)))</span> 
            <a href="typcache.c.html#LN461"><span class='Ref_To_Local'>hash_proc</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN83"><span class='Ref_to_Proto'>get_opfamily_proc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN51"><span class='Ref_to_Member'>hash_opf</span></a><span class='Delimiter'>, 
</span>                                          <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN52"><span class='Ref_to_Member'>hash_opintype</span></a><span class='Delimiter'>, 
</span>                                          <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN52"><span class='Ref_to_Member'>hash_opintype</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/access/hash.h.html#LN297"><span class='Ref_to_Const'>HASHPROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * As above, make sure hash_array will succeed.  We don't currently 
         * support hashing for composite types, but when we do, we'll need 
         * more logic here to check that case too. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN461"><span class='Ref_To_Local'>hash_proc</span></a> <span class='Operator'>== </span>F_HASH_ARRAY <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="typcache.c.html#LN165"><span class='Ref_to_Proto'>array_element_has_hashing</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN461"><span class='Ref_To_Local'>hash_proc</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Force update of hash_proc_finfo only if we're changing state */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN57"><span class='Ref_to_Member'>hash_proc</span></a> <span class='Operator'>!= </span><a href="typcache.c.html#LN461"><span class='Ref_To_Local'>hash_proc</span></a><span class='Parentheses'>) 
</span>            <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN68"><span class='Ref_to_Member'>hash_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN57"><span class='Ref_to_Member'>hash_proc</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN461"><span class='Ref_To_Local'>hash_proc</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN83"><span class='Ref_to_Const'>TCFLAGS_CHECKED_HASH_PROC</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (flags&(TYPECACHE_HAS... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set up fmgr lookup info as requested 
     * 
     * Note: we tell fmgr the finfo structures live in CacheMemoryContext, 
     * which is not quite right (they're really in the hash table's private 
     * memory context) but this will do for our purposes. 
     * 
     * Note: the code above avoids invalidating the finfo structs unless the 
     * referenced operator/function OID actually changes.  This is to prevent 
     * unnecessary leakage of any subsidiary data attached to an finfo, since 
     * that would cause session-lifespan memory leaks. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/typcache.h.html#LN114"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR_FINFO</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN511"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>eq_opr_func</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN511"><span class='Ref_To_Local'>eq_opr_func</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN511"><span class='Ref_To_Local'>eq_opr_func</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN511"><span class='Ref_To_Local'>eq_opr_func</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN66"><span class='Ref_to_Member'>eq_opr_finfo</span></a><span class='Delimiter'>, 
</span>                          <a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/typcache.h.html#LN115"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC_FINFO</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN56"><span class='Ref_to_Member'>cmp_proc</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN56"><span class='Ref_to_Member'>cmp_proc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Delimiter'>, 
</span>                      <a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/typcache.h.html#LN116"><span class='Ref_to_Const'>TYPECACHE_HASH_PROC_FINFO</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN68"><span class='Ref_to_Member'>hash_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN57"><span class='Ref_to_Member'>hash_proc</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN57"><span class='Ref_to_Member'>hash_proc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN68"><span class='Ref_to_Member'>hash_proc_finfo</span></a><span class='Delimiter'>, 
</span>                      <a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a composite type (row type), get tupdesc if requested 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/typcache.h.html#LN117"><span class='Ref_to_Const'>TYPECACHE_TUPDESC</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN38"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="typcache.c.html#LN156"><span class='Ref_to_Proto'>load_typcache_tupdesc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If requested, get information about a range type 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/typcache.h.html#LN120"><span class='Ref_to_Const'>TYPECACHE_RANGE_INFO</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN83"><span class='Ref_to_Member'>rngelemtype</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN38"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN724"><span class='Ref_to_Const'>TYPTYPE_RANGE</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="typcache.c.html#LN157"><span class='Ref_to_Proto'>load_rangetype_info</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If requested, get information about a domain type 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN190"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/typcache.h.html#LN121"><span class='Ref_to_Const'>TYPECACHE_DOMAIN_INFO</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN91"><span class='Ref_to_Const'>TCFLAGS_CHECKED_DOMAIN_CONSTRAINTS</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN38"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="typcache.c.html#LN158"><span class='Ref_to_Proto'>load_domaintype_info</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="typcache.c.html#LN192"><span class='Ref_To_Local'>typentry</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end lookup_type_cache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * load_typcache_tupdesc --- helper routine to set up composite type's tupDesc 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN570"></a><span class='Declare_Function'>load_typcache_tupdesc</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN572"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN570"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN39"><span class='Ref_to_Member'>typrelid</span></a><span class='Parentheses'>))</span>        <span class='Comment_Single_Line'>/* should not happen */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid typrelid for composite type %u"</span><span class='Delimiter'>, 
</span>             <a href="typcache.c.html#LN570"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN572"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN570"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN39"><span class='Ref_to_Member'>typrelid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN572"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype <span class='Operator'>== </span><a href="typcache.c.html#LN570"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Link to the tupdesc and increment its refcount (we assert it's a 
     * refcounted descriptor).  We don't use IncrTupleDescRefCount() for this, 
     * because the reference mustn't be entered in the current resource owner; 
     * it can outlive the current query. 
     */ 
</span>    <a href="typcache.c.html#LN570"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN572"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN570"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN570"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN572"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end load_typcache_tupdesc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * load_rangetype_info --- helper routine to set up range type information 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN598"></a><span class='Declare_Function'>load_rangetype_info</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN600"></a>    <a href="../../../include/catalog/pg_range.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_range</span></a> <span class='Declare_Local'>pg_range</span><span class='Delimiter'>; 
</span><a name="LN601"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN602"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>subtypeOid</span><span class='Delimiter'>; 
</span><a name="LN603"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opclassOid</span><span class='Delimiter'>; 
</span><a name="LN604"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>canonicalOid</span><span class='Delimiter'>; 
</span><a name="LN605"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>subdiffOid</span><span class='Delimiter'>; 
</span><a name="LN606"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfamilyOid</span><span class='Delimiter'>; 
</span><a name="LN607"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opcintype</span><span class='Delimiter'>; 
</span><a name="LN608"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>cmpFnOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get information from pg_range */ 
</span>    <a href="typcache.c.html#LN601"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN81"><span class='Ref_to_EnumConst'>RANGETYPE</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN598"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* should not fail, since we already checked typtype ... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN601"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for range type %u"</span><span class='Delimiter'>, 
</span>             <a href="typcache.c.html#LN598"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN600"><span class='Ref_To_Local'>pg_range</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_range.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_range</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN601"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typcache.c.html#LN602"><span class='Ref_To_Local'>subtypeOid</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN600"><span class='Ref_To_Local'>pg_range</span></a><span class='Operator'>-&GT;</span>rngsubtype<span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN598"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN84"><span class='Ref_to_Member'>rng_collation</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN600"><span class='Ref_To_Local'>pg_range</span></a><span class='Operator'>-&GT;</span>rngcollation<span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN603"><span class='Ref_To_Local'>opclassOid</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN600"><span class='Ref_To_Local'>pg_range</span></a><span class='Operator'>-&GT;</span>rngsubopc<span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN604"><span class='Ref_To_Local'>canonicalOid</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN600"><span class='Ref_To_Local'>pg_range</span></a><span class='Operator'>-&GT;</span>rngcanonical<span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN605"><span class='Ref_To_Local'>subdiffOid</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN600"><span class='Ref_To_Local'>pg_range</span></a><span class='Operator'>-&GT;</span>rngsubdiff<span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN601"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get opclass properties and look up the comparison function */ 
</span>    <a href="typcache.c.html#LN606"><span class='Ref_To_Local'>opfamilyOid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN96"><span class='Ref_to_Proto'>get_opclass_family</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN603"><span class='Ref_To_Local'>opclassOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN607"><span class='Ref_To_Local'>opcintype</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN97"><span class='Ref_to_Proto'>get_opclass_input_type</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN603"><span class='Ref_To_Local'>opclassOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typcache.c.html#LN608"><span class='Ref_To_Local'>cmpFnOid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN83"><span class='Ref_to_Proto'>get_opfamily_proc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN606"><span class='Ref_To_Local'>opfamilyOid</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN607"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN607"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/access/nbtree.h.html#LN228"><span class='Ref_to_Const'>BTORDER_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN539"><span class='Ref_to_Macro'>RegProcedureIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN608"><span class='Ref_To_Local'>cmpFnOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"missing support function %d(%u,%u) in opfamily %u"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/access/nbtree.h.html#LN228"><span class='Ref_to_Const'>BTORDER_PROC</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN607"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN607"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN606"><span class='Ref_To_Local'>opfamilyOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up cached fmgrinfo structs */ 
</span>    <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN608"><span class='Ref_To_Local'>cmpFnOid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typcache.c.html#LN598"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN85"><span class='Ref_to_Member'>rng_cmp_proc_finfo</span></a><span class='Delimiter'>, 
</span>                  <a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN604"><span class='Ref_To_Local'>canonicalOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN604"><span class='Ref_To_Local'>canonicalOid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typcache.c.html#LN598"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN86"><span class='Ref_to_Member'>rng_canonical_finfo</span></a><span class='Delimiter'>, 
</span>                      <a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN605"><span class='Ref_To_Local'>subdiffOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN605"><span class='Ref_To_Local'>subdiffOid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typcache.c.html#LN598"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Delimiter'>, 
</span>                      <a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Lastly, set up link to the element type --- this marks data valid */ 
</span>    <a href="typcache.c.html#LN598"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN83"><span class='Ref_to_Member'>rngelemtype</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN602"><span class='Ref_To_Local'>subtypeOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end load_rangetype_info &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * load_domaintype_info --- helper routine to set up domain constraint info 
 * 
 * Note: we assume we're called in a relatively short-lived context, so it's 
 * okay to leak data into the current context while scanning pg_constraint. 
 * We build the new DomainConstraintCache data in a context underneath 
 * CurrentMemoryContext, and reparent it under CacheMemoryContext when 
 * complete. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN661"></a><span class='Declare_Function'>load_domaintype_info</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN663"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeOid</span> <span class='Operator'>= </span><a href="typcache.c.html#LN661"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Delimiter'>; 
</span><a name="LN664"></a>    <a href="typcache.c.html#LN105"><span class='Ref_to_Struct'>DomainConstraintCache</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dcc</span><span class='Delimiter'>; 
</span><a name="LN665"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>notNull</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN666"></a>    <a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>**</span><span class='Declare_Local'>ccons</span><span class='Delimiter'>; 
</span><a name="LN667"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cconslen</span><span class='Delimiter'>; 
</span><a name="LN668"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>conRel</span><span class='Delimiter'>; 
</span><a name="LN669"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're here, any existing constraint info is stale, so release it. 
     * For safety, be sure to null the link before trying to delete the data. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN661"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN93"><span class='Ref_to_Member'>domainData</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN661"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN93"><span class='Ref_to_Member'>domainData</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN661"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN93"><span class='Ref_to_Member'>domainData</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN160"><span class='Ref_to_Proto'>decr_dcc_refcount</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We try to optimize the common case of no domain constraints, so don't 
     * create the dcc object and context until we find a constraint.  Likewise 
     * for the temp sorting array. 
     */ 
</span>    <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN666"><span class='Ref_To_Local'>ccons</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN667"><span class='Ref_To_Local'>cconslen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan pg_constraint for relevant constraints.  We want to find 
     * constraints for not just this domain, but any ancestor domains, so the 
     * outer loop crawls up the domain stack. 
     */ 
</span>    <a href="typcache.c.html#LN668"><span class='Ref_To_Local'>conRel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN700"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN701"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>conTup</span><span class='Delimiter'>; 
</span><a name="LN702"></a>        <a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typTup</span><span class='Delimiter'>; 
</span><a name="LN703"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nccons</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN704"></a>        <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN705"></a>        <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN700"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN663"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN700"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typcache.c.html#LN663"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN702"><span class='Ref_To_Local'>typTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN700"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN702"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>!= </span><a href="../../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Not a domain, so done */ 
</span>            <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN700"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Test for NOT NULL Constraint */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN702"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typnotnull<span class='Parentheses'>) 
</span>            <a href="typcache.c.html#LN665"><span class='Ref_To_Local'>notNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Look for CHECK Constraints on this domain */ 
</span>        <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typcache.c.html#LN704"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                    <a href="../../../include/catalog/pg_constraint.h.html#LN160"><span class='Ref_to_Const'>Anum_pg_constraint_contypid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN663"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN705"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN668"><span class='Ref_To_Local'>conRel</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN127"><span class='Ref_to_Const'>ConstraintTypidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typcache.c.html#LN704"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN701"><span class='Ref_To_Local'>conTup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN705"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN734"></a>            <a href="../../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>c</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN701"><span class='Ref_To_Local'>conTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN735"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN736"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN737"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>constring</span><span class='Delimiter'>; 
</span><a name="LN738"></a>            <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>check_expr</span><span class='Delimiter'>; 
</span><a name="LN739"></a>            <a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Ignore non-CHECK constraints (presently, shouldn't be any) */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN734"><span class='Ref_To_Local'>c</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Not expecting conbin to be NULL, but we'll test for it anyway */ 
</span>            <a href="typcache.c.html#LN735"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN701"><span class='Ref_To_Local'>conTup</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_constraint.h.html#LN175"><span class='Ref_to_Const'>Anum_pg_constraint_conbin</span></a><span class='Delimiter'>, 
</span>                              <a href="typcache.c.html#LN668"><span class='Ref_To_Local'>conRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typcache.c.html#LN736"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN736"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"domain \"%s\" constraint \"%s\" has NULL conbin"</span><span class='Delimiter'>, 
</span>                     <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN702"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN734"><span class='Ref_To_Local'>c</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Convert conbin to C string in caller context */ 
</span>            <a href="typcache.c.html#LN737"><span class='Ref_To_Local'>constring</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN735"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Create the DomainConstraintCache object and context if needed */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN758"></a>                <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>cxt</span><span class='Delimiter'>; 
</span> 
                <a href="typcache.c.html#LN758"><span class='Ref_To_Local'>cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                            <span class='String'>"Domain constraints"</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typcache.c.html#LN105"><span class='Ref_to_Struct'>DomainConstraintCache</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN758"><span class='Ref_To_Local'>cxt</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN105"><span class='Ref_to_Struct'>DomainConstraintCache</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN107"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN108"><span class='Ref_to_Member'>dccContext</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN758"><span class='Ref_To_Local'>cxt</span></a><span class='Delimiter'>; 
</span>                <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN109"><span class='Ref_to_Member'>dccRefCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Create node trees in DomainConstraintCache's context */ 
</span>            <a href="typcache.c.html#LN669"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN108"><span class='Ref_to_Member'>dccContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="typcache.c.html#LN738"><span class='Ref_To_Local'>check_expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN737"><span class='Ref_To_Local'>constring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ExecInitExpr will assume we've planned the expression */ 
</span>            <a href="typcache.c.html#LN738"><span class='Ref_To_Local'>check_expr</span></a> <span class='Operator'>= </span><a href="../../../include/optimizer/planner.h.html#LN53"><span class='Ref_to_Proto'>expression_planner</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN738"><span class='Ref_To_Local'>check_expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="typcache.c.html#LN739"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN739"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN786"><span class='Ref_to_Member'>constrainttype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/execnodes.h.html#LN780"><span class='Ref_to_EnumConst'>DOM_CONSTRAINT_CHECK</span></a><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN739"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN787"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN734"><span class='Ref_To_Local'>c</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN739"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN788"><span class='Ref_to_Member'>check_expr</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN738"><span class='Ref_To_Local'>check_expr</span></a><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN739"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN789"><span class='Ref_to_Member'>check_exprstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN669"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Accumulate constraints in an array, for sorting below */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN666"><span class='Ref_To_Local'>ccons</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="typcache.c.html#LN667"><span class='Ref_To_Local'>cconslen</span></a> <span class='Operator'>= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>                <a href="typcache.c.html#LN666"><span class='Ref_To_Local'>ccons</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN667"><span class='Ref_To_Local'>cconslen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN703"><span class='Ref_To_Local'>nccons</span></a> <span class='Operator'>&GT;= </span><a href="typcache.c.html#LN667"><span class='Ref_To_Local'>cconslen</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="typcache.c.html#LN667"><span class='Ref_To_Local'>cconslen</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <a href="typcache.c.html#LN666"><span class='Ref_To_Local'>ccons</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN666"><span class='Ref_To_Local'>ccons</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN667"><span class='Ref_To_Local'>cconslen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="typcache.c.html#LN666"><span class='Ref_To_Local'>ccons</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN703"><span class='Ref_To_Local'>nccons</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typcache.c.html#LN739"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(conT... &raquo; </span> 
 
        <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN705"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN703"><span class='Ref_To_Local'>nccons</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Sort the items for this domain, so that CHECKs are applied in a 
             * deterministic order. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN703"><span class='Ref_To_Local'>nccons</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN666"><span class='Ref_To_Local'>ccons</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN703"><span class='Ref_To_Local'>nccons</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="typcache.c.html#LN159"><span class='Ref_to_Proto'>dcs_cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Now attach them to the overall list.  Use lcons() here because 
             * constraints of parent domains should be applied earlier. 
             */ 
</span>            <a href="typcache.c.html#LN669"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN108"><span class='Ref_to_Member'>dccContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN703"><span class='Ref_To_Local'>nccons</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN107"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN666"><span class='Ref_To_Local'>ccons</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="typcache.c.html#LN703"><span class='Ref_To_Local'>nccons</span></a><span class='Delimiter'>], </span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN107"><span class='Ref_to_Member'>constraints</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN669"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* loop to next domain in stack */ 
</span>        <a href="typcache.c.html#LN663"><span class='Ref_To_Local'>typeOid</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN702"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typbasetype<span class='Delimiter'>; 
</span>        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN700"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN668"><span class='Ref_To_Local'>conRel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Only need to add one NOT NULL check regardless of how many domains in 
     * the stack request it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN665"><span class='Ref_To_Local'>notNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN836"></a>        <a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Create the DomainConstraintCache object and context if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN841"></a>            <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>cxt</span><span class='Delimiter'>; 
</span> 
            <a href="typcache.c.html#LN841"><span class='Ref_To_Local'>cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                        <span class='String'>"Domain constraints"</span><span class='Delimiter'>, 
</span>                                        <a href="../../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typcache.c.html#LN105"><span class='Ref_to_Struct'>DomainConstraintCache</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN841"><span class='Ref_To_Local'>cxt</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN105"><span class='Ref_to_Struct'>DomainConstraintCache</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN107"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN108"><span class='Ref_to_Member'>dccContext</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN841"><span class='Ref_To_Local'>cxt</span></a><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN109"><span class='Ref_to_Member'>dccRefCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Create node trees in DomainConstraintCache's context */ 
</span>        <a href="typcache.c.html#LN669"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN108"><span class='Ref_to_Member'>dccContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN836"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN836"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN786"><span class='Ref_to_Member'>constrainttype</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/execnodes.h.html#LN779"><span class='Ref_to_EnumConst'>DOM_CONSTRAINT_NOTNULL</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN836"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN787"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"NOT NULL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN836"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN788"><span class='Ref_to_Member'>check_expr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN836"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN789"><span class='Ref_to_Member'>check_exprstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* lcons to apply the nullness check FIRST */ 
</span>        <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN107"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN836"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN107"><span class='Ref_to_Member'>constraints</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN669"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if notNull &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we made a constraint object, move it into CacheMemoryContext and 
     * attach it to the typcache entry. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/memutils.h.html#LN78"><span class='Ref_to_Proto'>MemoryContextSetParent</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN108"><span class='Ref_to_Member'>dccContext</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN661"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN93"><span class='Ref_to_Member'>domainData</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN664"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN109"><span class='Ref_to_Member'>dccRefCount</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* count the typcache's reference */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Either way, the typcache entry's domain data is now valid. */ 
</span>    <a href="typcache.c.html#LN661"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN91"><span class='Ref_to_Const'>TCFLAGS_CHECKED_DOMAIN_CONSTRAINTS</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end load_domaintype_info &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * qsort comparator to sort DomainConstraintState pointers by name 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN888"></a><span class='Declare_Function'>dcs_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN890"></a>    <span class='Keyword'>const </span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>ca</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typcache.c.html#LN888"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN891"></a>    <span class='Keyword'>const </span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>cb</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typcache.c.html#LN888"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> strcmp<span class='Parentheses'>((</span><span class='Operator'>*</span><a href="typcache.c.html#LN890"><span class='Ref_To_Local'>ca</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>name<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="typcache.c.html#LN891"><span class='Ref_To_Local'>cb</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>name<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * decr_dcc_refcount --- decrement a DomainConstraintCache's refcount, 
 * and free it if no references remain 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN901"></a><span class='Declare_Function'>decr_dcc_refcount</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN105"><span class='Ref_to_Struct'>DomainConstraintCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dcc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN901"><span class='Ref_to_Parameter'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN109"><span class='Ref_to_Member'>dccRefCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>--</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN901"><span class='Ref_to_Parameter'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN109"><span class='Ref_to_Member'>dccRefCount</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN901"><span class='Ref_to_Parameter'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN108"><span class='Ref_to_Member'>dccContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Context reset/delete callback for a DomainConstraintRef 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN912"></a><span class='Declare_Function'>dccref_deletion_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN914"></a>    <a href="../../../include/utils/typcache.h.html#LN129"><span class='Ref_to_Struct'>DomainConstraintRef</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ref</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN129"><span class='Ref_to_Struct'>DomainConstraintRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typcache.c.html#LN912"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN915"></a>    <a href="typcache.c.html#LN105"><span class='Ref_to_Struct'>DomainConstraintCache</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dcc</span> <span class='Operator'>= </span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Paranoia --- be sure link is nulled before trying to release */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN915"><span class='Ref_To_Local'>dcc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN131"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN160"><span class='Ref_to_Proto'>decr_dcc_refcount</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN915"><span class='Ref_To_Local'>dcc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * prep_domain_constraints --- prepare domain constraints for execution 
 * 
 * The expression trees stored in the DomainConstraintCache's list are 
 * converted to executable expression state trees stored in execctx. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN933"></a><span class='Declare_Function'>prep_domain_constraints</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constraints</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>execctx</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN935"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN936"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN937"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="typcache.c.html#LN936"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN933"><span class='Ref_to_Parameter'>execctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN937"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN933"><span class='Ref_to_Parameter'>constraints</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN943"></a>        <a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN937"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN944"></a>        <a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newr</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN944"><span class='Ref_To_Local'>newr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN783"><span class='Ref_to_Struct'>DomainConstraintState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN944"><span class='Ref_To_Local'>newr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN786"><span class='Ref_to_Member'>constrainttype</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN943"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN786"><span class='Ref_to_Member'>constrainttype</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN944"><span class='Ref_To_Local'>newr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN787"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN943"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN787"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN944"><span class='Ref_To_Local'>newr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN788"><span class='Ref_to_Member'>check_expr</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN943"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN788"><span class='Ref_to_Member'>check_expr</span></a><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN944"><span class='Ref_To_Local'>newr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN789"><span class='Ref_to_Member'>check_exprstate</span></a> <span class='Operator'>= </span><a href="../../executor/execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN943"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN788"><span class='Ref_to_Member'>check_expr</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN935"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN935"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN944"><span class='Ref_To_Local'>newr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN936"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typcache.c.html#LN935"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end prep_domain_constraints &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * InitDomainConstraintRef --- initialize a DomainConstraintRef struct 
 * 
 * Caller must tell us the MemoryContext in which the DomainConstraintRef 
 * lives.  The ref will be cleaned up when that context is reset/deleted. 
 * 
 * Caller must also tell us whether it wants check_exprstate fields to be 
 * computed in the DomainConstraintState nodes attached to this ref. 
 * If it doesn't, we need not make a copy of the DomainConstraintState list. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN971"></a><span class='Declare_Function'>InitDomainConstraintRef</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type_id</span><span class='Delimiter'>, </span><a href="../../../include/utils/typcache.h.html#LN129"><span class='Ref_to_Struct'>DomainConstraintRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ref</span><span class='Delimiter'>, 
</span><a name="LN972"></a>                        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>refctx</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>need_exprstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Look up the typcache entry --- we assume it survives indefinitely */ 
</span>    <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN133"><span class='Ref_to_Member'>tcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN971"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/typcache.h.html#LN121"><span class='Ref_to_Const'>TYPECACHE_DOMAIN_INFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN134"><span class='Ref_to_Member'>need_exprstate</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN972"><span class='Ref_to_Parameter'>need_exprstate</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* For safety, establish the callback before acquiring a refcount */ 
</span>    <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN132"><span class='Ref_to_Member'>refctx</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN972"><span class='Ref_to_Parameter'>refctx</span></a><span class='Delimiter'>; 
</span>    <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN138"><span class='Ref_to_Member'>callback</span></a><span class='Operator'>.</span><a href="../../../include/utils/palloc.h.html#LN48"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN161"><span class='Ref_to_Proto'>dccref_deletion_callback</span></a><span class='Delimiter'>; 
</span>    <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN138"><span class='Ref_to_Member'>callback</span></a><span class='Operator'>.</span><a href="../../../include/utils/palloc.h.html#LN49"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Keyword'>ref</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN118"><span class='Ref_to_Proto'>MemoryContextRegisterResetCallback</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN972"><span class='Ref_to_Parameter'>refctx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN138"><span class='Ref_to_Member'>callback</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Acquire refcount if there are constraints, and set up exported list */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN133"><span class='Ref_to_Member'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN93"><span class='Ref_to_Member'>domainData</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a> <span class='Operator'>= </span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN133"><span class='Ref_to_Member'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN93"><span class='Ref_to_Member'>domainData</span></a><span class='Delimiter'>; 
</span>        <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN109"><span class='Ref_to_Member'>dccRefCount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN134"><span class='Ref_to_Member'>need_exprstate</span></a><span class='Parentheses'>) 
</span>            <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN131"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN162"><span class='Ref_to_Proto'>prep_domain_constraints</span></a><span class='Parentheses'>(</span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN107"><span class='Ref_to_Member'>constraints</span></a><span class='Delimiter'>, 
</span>                                                       <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN132"><span class='Ref_to_Member'>refctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN131"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN107"><span class='Ref_to_Member'>constraints</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN131"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end InitDomainConstraintRef &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * UpdateDomainConstraintRef --- recheck validity of domain constraint info 
 * 
 * If the domain's constraint set changed, ref-&GT;constraints is updated to 
 * point at a new list of cached constraints. 
 * 
 * In the normal case where nothing happened to the domain, this is cheap 
 * enough that it's reasonable (and expected) to check before *each* use 
 * of the constraint info. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1009"></a><span class='Declare_Function'>UpdateDomainConstraintRef</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN129"><span class='Ref_to_Struct'>DomainConstraintRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ref</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1011"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span> <span class='Operator'>= </span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN133"><span class='Ref_to_Member'>tcache</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make sure typcache entry's data is up to date */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN1011"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN91"><span class='Ref_to_Const'>TCFLAGS_CHECKED_DOMAIN_CONSTRAINTS</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN1011"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN38"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>)</span> 
        <a href="typcache.c.html#LN158"><span class='Ref_to_Proto'>load_domaintype_info</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1011"><span class='Ref_To_Local'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Transfer to ref object if there's new info, adjusting refcounts */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a> <span class='Operator'>!= </span><a href="typcache.c.html#LN1011"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN93"><span class='Ref_to_Member'>domainData</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Paranoia --- be sure link is nulled before trying to release */ 
</span><a name="LN1022"></a>        <a href="typcache.c.html#LN105"><span class='Ref_to_Struct'>DomainConstraintCache</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dcc</span> <span class='Operator'>= </span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1022"><span class='Ref_To_Local'>dcc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Note: we just leak the previous list of executable domain 
             * constraints.  Alternatively, we could keep those in a child 
             * context of ref-&GT;refctx and free that context at this point. 
             * However, in practice this code path will be taken so seldom 
             * that the extra bookkeeping for a child context doesn't seem 
             * worthwhile; we'll just allow a leak for the lifespan of refctx. 
             */ 
</span>            <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN131"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>            <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN160"><span class='Ref_to_Proto'>decr_dcc_refcount</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1022"><span class='Ref_To_Local'>dcc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="typcache.c.html#LN1022"><span class='Ref_To_Local'>dcc</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1011"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN93"><span class='Ref_to_Member'>domainData</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1022"><span class='Ref_To_Local'>dcc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN137"><span class='Ref_to_Member'>dcc</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1022"><span class='Ref_To_Local'>dcc</span></a><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN1022"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN109"><span class='Ref_to_Member'>dccRefCount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN134"><span class='Ref_to_Member'>need_exprstate</span></a><span class='Parentheses'>) 
</span>                <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN131"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN162"><span class='Ref_to_Proto'>prep_domain_constraints</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1022"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN107"><span class='Ref_to_Member'>constraints</span></a><span class='Delimiter'>, 
</span>                                                           <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN132"><span class='Ref_to_Member'>refctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Keyword'>ref</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN131"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1022"><span class='Ref_To_Local'>dcc</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN107"><span class='Ref_to_Member'>constraints</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ref-&GT;dcc!=typentry-&GT;d... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end UpdateDomainConstraintRef &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * DomainHasConstraints --- utility routine to check if a domain has constraints 
 * 
 * This is defined to return false, not fail, if type is not a domain. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1058"></a><span class='Declare_Function'>DomainHasConstraints</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type_id</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1060"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: a side effect is to cause the typcache's domain data to become 
     * valid.  This is fine since we'll likely need it soon if there is any. 
     */ 
</span>    <a href="typcache.c.html#LN1060"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1058"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/typcache.h.html#LN121"><span class='Ref_to_Const'>TYPECACHE_DOMAIN_INFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1060"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN93"><span class='Ref_to_Member'>domainData</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_element_has_equality and friends are helper routines to check 
 * whether we should believe that array_eq and related functions will work 
 * on the given array type or composite type. 
 * 
 * The logic above may call these repeatedly on the same type entry, so we 
 * make use of the typentry-&GT;flags field to cache the results once known. 
 * Also, we assume that we'll probably want all these facts about the type 
 * if we want any, so we cache them all using only one lookup of the 
 * component datatype(s). 
 */ 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN1085"></a><span class='Declare_Function'>array_element_has_equality</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN1085"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN84"><span class='Ref_to_Const'>TCFLAGS_CHECKED_ELEM_PROPERTIES</span></a><span class='Parentheses'>))</span> 
        <a href="typcache.c.html#LN166"><span class='Ref_to_Proto'>cache_array_element_properties</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1085"><span class='Ref_to_Parameter'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1085"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN85"><span class='Ref_to_Const'>TCFLAGS_HAVE_ELEM_EQUALITY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN1093"></a><span class='Declare_Function'>array_element_has_compare</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN1093"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN84"><span class='Ref_to_Const'>TCFLAGS_CHECKED_ELEM_PROPERTIES</span></a><span class='Parentheses'>))</span> 
        <a href="typcache.c.html#LN166"><span class='Ref_to_Proto'>cache_array_element_properties</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1093"><span class='Ref_to_Parameter'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1093"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN86"><span class='Ref_to_Const'>TCFLAGS_HAVE_ELEM_COMPARE</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN1101"></a><span class='Declare_Function'>array_element_has_hashing</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN1101"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN84"><span class='Ref_to_Const'>TCFLAGS_CHECKED_ELEM_PROPERTIES</span></a><span class='Parentheses'>))</span> 
        <a href="typcache.c.html#LN166"><span class='Ref_to_Proto'>cache_array_element_properties</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1101"><span class='Ref_to_Parameter'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1101"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN87"><span class='Ref_to_Const'>TCFLAGS_HAVE_ELEM_HASHING</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1109"></a><span class='Declare_Function'>cache_array_element_properties</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1111"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elem_type</span> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN160"><span class='Ref_to_Proto'>get_base_element_type</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1109"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1111"><span class='Ref_To_Local'>elem_type</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1115"></a>        <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>elementry</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN1115"><span class='Ref_To_Local'>elementry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1111"><span class='Ref_To_Local'>elem_type</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/utils/typcache.h.html#LN109"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR</span></a> <span class='Operator'>| 
</span>                                      <a href="../../../include/utils/typcache.h.html#LN112"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC</span></a> <span class='Operator'>| 
</span>                                      <a href="../../../include/utils/typcache.h.html#LN113"><span class='Ref_to_Const'>TYPECACHE_HASH_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1115"><span class='Ref_To_Local'>elementry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN1109"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN85"><span class='Ref_to_Const'>TCFLAGS_HAVE_ELEM_EQUALITY</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1115"><span class='Ref_To_Local'>elementry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN56"><span class='Ref_to_Member'>cmp_proc</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN1109"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN86"><span class='Ref_to_Const'>TCFLAGS_HAVE_ELEM_COMPARE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1115"><span class='Ref_To_Local'>elementry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN57"><span class='Ref_to_Member'>hash_proc</span></a><span class='Parentheses'>))</span> 
            <a href="typcache.c.html#LN1109"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN87"><span class='Ref_to_Const'>TCFLAGS_HAVE_ELEM_HASHING</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="typcache.c.html#LN1109"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN84"><span class='Ref_to_Const'>TCFLAGS_CHECKED_ELEM_PROPERTIES</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end cache_array_element_properties &raquo; </span> 
 
<span class='Keyword'>static bool 
</span><a name="LN1132"></a><span class='Declare_Function'>record_fields_have_equality</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN1132"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN88"><span class='Ref_to_Const'>TCFLAGS_CHECKED_FIELD_PROPERTIES</span></a><span class='Parentheses'>))</span> 
        <a href="typcache.c.html#LN169"><span class='Ref_to_Proto'>cache_record_field_properties</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1132"><span class='Ref_to_Parameter'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1132"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN89"><span class='Ref_to_Const'>TCFLAGS_HAVE_FIELD_EQUALITY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN1140"></a><span class='Declare_Function'>record_fields_have_compare</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN1140"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN88"><span class='Ref_to_Const'>TCFLAGS_CHECKED_FIELD_PROPERTIES</span></a><span class='Parentheses'>))</span> 
        <a href="typcache.c.html#LN169"><span class='Ref_to_Proto'>cache_record_field_properties</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1140"><span class='Ref_to_Parameter'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1140"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="typcache.c.html#LN90"><span class='Ref_to_Const'>TCFLAGS_HAVE_FIELD_COMPARE</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1148"></a><span class='Declare_Function'>cache_record_field_properties</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typentry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * For type RECORD, we can't really tell what will work, since we don't 
     * have access here to the specific anonymous type.  Just assume that 
     * everything will (we may get a failure at runtime ...) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1148"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>        <a href="typcache.c.html#LN1148"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><span class='Parentheses'>(</span><a href="typcache.c.html#LN89"><span class='Ref_to_Const'>TCFLAGS_HAVE_FIELD_EQUALITY</span></a> <span class='Operator'>| 
</span>                            <a href="typcache.c.html#LN90"><span class='Ref_to_Const'>TCFLAGS_HAVE_FIELD_COMPARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1148"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN38"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1160"></a>        <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1161"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>newflags</span><span class='Delimiter'>; 
</span><a name="LN1162"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fetch composite type's tupdesc if we don't have it already */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1148"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="typcache.c.html#LN156"><span class='Ref_to_Proto'>load_typcache_tupdesc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1148"><span class='Ref_to_Parameter'>typentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN1160"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1148"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must bump the refcount while we do additional catalog lookups */ 
</span>        <a href="../../../include/access/tupdesc.h.html#LN97"><span class='Ref_to_Proto'>IncrTupleDescRefCount</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1160"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Have each property if all non-dropped fields have the property */ 
</span>        <a href="typcache.c.html#LN1161"><span class='Ref_To_Local'>newflags</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typcache.c.html#LN89"><span class='Ref_to_Const'>TCFLAGS_HAVE_FIELD_EQUALITY</span></a> <span class='Operator'>| 
</span>                    <a href="typcache.c.html#LN90"><span class='Ref_to_Const'>TCFLAGS_HAVE_FIELD_COMPARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="typcache.c.html#LN1162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="typcache.c.html#LN1160"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="typcache.c.html#LN1162"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1177"></a>            <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fieldentry</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1160"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="typcache.c.html#LN1177"><span class='Ref_To_Local'>fieldentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1160"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/typcache.h.html#LN109"><span class='Ref_to_Const'>TYPECACHE_EQ_OPR</span></a> <span class='Operator'>| 
</span>                                           <a href="../../../include/utils/typcache.h.html#LN112"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1177"><span class='Ref_To_Local'>fieldentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN53"><span class='Ref_to_Member'>eq_opr</span></a><span class='Parentheses'>))</span> 
                <a href="typcache.c.html#LN1161"><span class='Ref_To_Local'>newflags</span></a> <span class='Operator'>&= ~</span><a href="typcache.c.html#LN89"><span class='Ref_to_Const'>TCFLAGS_HAVE_FIELD_EQUALITY</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1177"><span class='Ref_To_Local'>fieldentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN56"><span class='Ref_to_Member'>cmp_proc</span></a><span class='Parentheses'>))</span> 
                <a href="typcache.c.html#LN1161"><span class='Ref_To_Local'>newflags</span></a> <span class='Operator'>&= ~</span><a href="typcache.c.html#LN90"><span class='Ref_to_Const'>TCFLAGS_HAVE_FIELD_COMPARE</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* We can drop out of the loop once we disprove all bits */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1161"><span class='Ref_To_Local'>newflags</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="typcache.c.html#LN1148"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN1161"><span class='Ref_To_Local'>newflags</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/tupdesc.h.html#LN98"><span class='Ref_to_Proto'>DecrTupleDescRefCount</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1160"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if typentry-&GT;typtype==TY... &raquo; </span> 
    <a href="typcache.c.html#LN1148"><span class='Ref_to_Parameter'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="typcache.c.html#LN88"><span class='Ref_to_Const'>TCFLAGS_CHECKED_FIELD_PROPERTIES</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end cache_record_field_properties &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * lookup_rowtype_tupdesc_internal --- internal routine to lookup a rowtype 
 * 
 * Same API as lookup_rowtype_tupdesc_noerror, but the returned tupdesc 
 * hasn't had its refcount bumped. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> 
<a name="LN1209"></a><span class='Declare_Function'>lookup_rowtype_tupdesc_internal</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type_id</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>noError</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1209"><span class='Ref_to_Parameter'>type_id</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * It's a named composite type, so use the regular typcache. 
         */ 
</span><a name="LN1216"></a>        <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN1216"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1209"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/typcache.h.html#LN117"><span class='Ref_to_Const'>TYPECACHE_TUPDESC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1216"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& !</span><a href="typcache.c.html#LN1209"><span class='Ref_to_Parameter'>noError</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type %s is not composite"</span><span class='Delimiter'>, 
</span>                            <a href="../adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1209"><span class='Ref_to_Parameter'>type_id</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="typcache.c.html#LN1216"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * It's a transient record type, so look in our record-type table. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1209"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="typcache.c.html#LN1209"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&GT;= </span><a href="typcache.c.html#LN154"><span class='Ref_to_Global_Var'>NextRecordTypmod</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typcache.c.html#LN1209"><span class='Ref_to_Parameter'>noError</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record type has not been registered"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <a href="typcache.c.html#LN152"><span class='Ref_to_Global_Var'>RecordCacheArray</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1209"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end lookup_rowtype_tupdesc_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * lookup_rowtype_tupdesc 
 * 
 * Given a typeid/typmod that should describe a known composite type, 
 * return the tuple descriptor for the type.  Will ereport on failure. 
 * (Use ereport because this is reachable with user-specified OIDs, 
 * for example from record_in().) 
 * 
 * Note: on success, we increment the refcount of the returned TupleDesc, 
 * and log the reference in CurrentResourceOwner.  Caller should call 
 * ReleaseTupleDesc or DecrTupleDescRefCount when done using the tupdesc. 
 */ 
</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> 
<a name="LN1256"></a><span class='Declare_Function'>lookup_rowtype_tupdesc</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type_id</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1258"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span> 
    <a href="typcache.c.html#LN1258"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1208"><span class='Ref_to_Func'>lookup_rowtype_tupdesc_internal</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1256"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1256"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/tupdesc.h.html#LN97"><span class='Ref_to_Proto'>IncrTupleDescRefCount</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1258"><span class='Ref_To_Local'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="typcache.c.html#LN1258"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * lookup_rowtype_tupdesc_noerror 
 * 
 * As above, but if the type is not a known composite type and noError 
 * is true, returns NULL instead of ereport'ing.  (Note that if a bogus 
 * type_id is passed, you'll get an ereport anyway.) 
 */ 
</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> 
<a name="LN1273"></a><span class='Declare_Function'>lookup_rowtype_tupdesc_noerror</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type_id</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>noError</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1275"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span> 
    <a href="typcache.c.html#LN1275"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1208"><span class='Ref_to_Func'>lookup_rowtype_tupdesc_internal</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1273"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1273"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1273"><span class='Ref_to_Parameter'>noError</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1275"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/access/tupdesc.h.html#LN97"><span class='Ref_to_Proto'>IncrTupleDescRefCount</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1275"><span class='Ref_To_Local'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="typcache.c.html#LN1275"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * lookup_rowtype_tupdesc_copy 
 * 
 * Like lookup_rowtype_tupdesc(), but the returned TupleDesc has been 
 * copied into the CurrentMemoryContext and is not reference-counted. 
 */ 
</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> 
<a name="LN1290"></a><span class='Declare_Function'>lookup_rowtype_tupdesc_copy</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type_id</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1292"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
    <a href="typcache.c.html#LN1292"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1208"><span class='Ref_to_Func'>lookup_rowtype_tupdesc_internal</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1290"><span class='Ref_to_Parameter'>type_id</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1290"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/access/tupdesc.h.html#LN90"><span class='Ref_to_Proto'>CreateTupleDescCopyConstr</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1292"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * assign_record_type_typmod 
 * 
 * Given a tuple descriptor for a RECORD type, find or create a cache entry 
 * for the type, and set the tupdesc's tdtypmod field to a value that will 
 * identify this cache entry to lookup_rowtype_tupdesc. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1307"></a><span class='Declare_Function'>assign_record_type_typmod</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1309"></a>    <a href="typcache.c.html#LN141"><span class='Ref_to_Struct'>RecordCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>recentry</span><span class='Delimiter'>; 
</span><a name="LN1310"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>entDesc</span><span class='Delimiter'>; 
</span><a name="LN1311"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>hashkey</span><span class='Delimiter'>[</span><a href="typcache.c.html#LN139"><span class='Ref_to_Const'>REC_HASH_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN1312"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN1313"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1314"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN1315"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>newtypmod</span><span class='Delimiter'>; 
</span><a name="LN1316"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN1307"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN150"><span class='Ref_to_Global_Var'>RecordCacheHash</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First time through: initialize the hash table */ 
</span><a name="LN1323"></a>        <a href="../../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typcache.c.html#LN1323"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN1323"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN1323"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN139"><span class='Ref_to_Const'>REC_HASH_KEYS</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN1323"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN141"><span class='Ref_to_Struct'>RecordCacheEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN150"><span class='Ref_to_Global_Var'>RecordCacheHash</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"Record information cache"</span><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="typcache.c.html#LN1323"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Also make sure CacheMemoryContext exists */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/catcache.h.html#LN168"><span class='Ref_to_Proto'>CreateCacheMemoryContext</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Find or create a hashtable entry for this hash class */ 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1311"><span class='Ref_To_Local'>hashkey</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN1311"><span class='Ref_To_Local'>hashkey</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1313"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="typcache.c.html#LN1313"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="typcache.c.html#LN1307"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="typcache.c.html#LN1313"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1313"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="typcache.c.html#LN139"><span class='Ref_to_Const'>REC_HASH_KEYS</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN1311"><span class='Ref_To_Local'>hashkey</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1313"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typcache.c.html#LN1307"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1313"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="typcache.c.html#LN1309"><span class='Ref_To_Local'>recentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typcache.c.html#LN141"><span class='Ref_to_Struct'>RecordCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN150"><span class='Ref_to_Global_Var'>RecordCacheHash</span></a><span class='Delimiter'>, 
</span>                                                <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typcache.c.html#LN1311"><span class='Ref_To_Local'>hashkey</span></a><span class='Delimiter'>, 
</span>                                                <a href="../../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typcache.c.html#LN1312"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typcache.c.html#LN1312"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* New entry ... hash_search initialized only the hash key */ 
</span>        <a href="typcache.c.html#LN1309"><span class='Ref_To_Local'>recentry</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN147"><span class='Ref_to_Member'>tupdescs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Look for existing record cache entry */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1314"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1309"><span class='Ref_To_Local'>recentry</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN147"><span class='Ref_to_Member'>tupdescs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="typcache.c.html#LN1310"><span class='Ref_To_Local'>entDesc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1314"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN112"><span class='Ref_to_Proto'>equalTupleDescs</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1307"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1310"><span class='Ref_To_Local'>entDesc</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="typcache.c.html#LN1307"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1310"><span class='Ref_To_Local'>entDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Not present, so need to manufacture an entry */ 
</span>    <a href="typcache.c.html#LN1316"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN152"><span class='Ref_to_Global_Var'>RecordCacheArray</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="typcache.c.html#LN152"><span class='Ref_to_Global_Var'>RecordCacheArray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>64</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN153"><span class='Ref_to_Global_Var'>RecordCacheArrayLen</span></a> <span class='Operator'>= </span><span class='Number'>64</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN154"><span class='Ref_to_Global_Var'>NextRecordTypmod</span></a> <span class='Operator'>&GT;= </span><a href="typcache.c.html#LN153"><span class='Ref_to_Global_Var'>RecordCacheArrayLen</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1374"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>newlen</span> <span class='Operator'>= </span><a href="typcache.c.html#LN153"><span class='Ref_to_Global_Var'>RecordCacheArrayLen</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN152"><span class='Ref_to_Global_Var'>RecordCacheArray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN152"><span class='Ref_to_Global_Var'>RecordCacheArray</span></a><span class='Delimiter'>, 
</span>                                                  <a href="typcache.c.html#LN1374"><span class='Ref_To_Local'>newlen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN153"><span class='Ref_to_Global_Var'>RecordCacheArrayLen</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1374"><span class='Ref_To_Local'>newlen</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* if fail in subrs, no damage except possibly some wasted memory... */ 
</span>    <a href="typcache.c.html#LN1310"><span class='Ref_To_Local'>entDesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1307"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1309"><span class='Ref_To_Local'>recentry</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN147"><span class='Ref_to_Member'>tupdescs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1310"><span class='Ref_To_Local'>entDesc</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1309"><span class='Ref_To_Local'>recentry</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN147"><span class='Ref_to_Member'>tupdescs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* mark it as a reference-counted tupdesc */ 
</span>    <a href="typcache.c.html#LN1310"><span class='Ref_To_Local'>entDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* now it's safe to advance NextRecordTypmod */ 
</span>    <a href="typcache.c.html#LN1315"><span class='Ref_To_Local'>newtypmod</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN154"><span class='Ref_to_Global_Var'>NextRecordTypmod</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1310"><span class='Ref_To_Local'>entDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1315"><span class='Ref_To_Local'>newtypmod</span></a><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN152"><span class='Ref_to_Global_Var'>RecordCacheArray</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1315"><span class='Ref_To_Local'>newtypmod</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typcache.c.html#LN1310"><span class='Ref_To_Local'>entDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* report to caller as well */ 
</span>    <a href="typcache.c.html#LN1307"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1315"><span class='Ref_To_Local'>newtypmod</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1316"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end assign_record_type_typmod &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * TypeCacheRelCallback 
 *      Relcache inval callback function 
 * 
 * Delete the cached tuple descriptor (if any) for the given rel's composite 
 * type, or for all composite types if relid == InvalidOid.  Also reset 
 * whatever info we have cached about the composite type's comparability. 
 * 
 * This is called when a relcache invalidation event occurs for the given 
 * relid.  We must scan the whole typcache hash since we don't know the 
 * type OID corresponding to the relid.  We could do a direct search if this 
 * were a syscache-flush callback on pg_type, but then we would need all 
 * ALTER-TABLE-like commands that could modify a rowtype to issue syscache 
 * invals against the rel's pg_type OID.  The extra SI signaling could very 
 * well cost more than we'd save, since in most usages there are not very 
 * many entries in a backend's typcache.  The risk of bugs-of-omission seems 
 * high, too. 
 * 
 * Another possibility, with only localized impact, is to maintain a second 
 * hashtable that indexes composite-type typcache entries by their typrelid. 
 * But it's still not clear it's worth the trouble. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1420"></a><span class='Declare_Function'>TypeCacheRelCallback</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1422"></a>    <a href="../../../include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN1423"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* TypeCacheHash must exist, else this callback wouldn't be registered */ 
</span>    <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typcache.c.html#LN1422"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN71"><span class='Ref_to_Global_Var'>TypeCacheHash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN1423"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typcache.c.html#LN1422"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1423"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN38"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* skip non-composites */ 
</span> 
        <span class='Comment_Multi_Line'>/* Skip if no match, unless we're zapping all composite types */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1420"><span class='Ref_to_Parameter'>relid</span></a> <span class='Operator'>!= </span><a href="typcache.c.html#LN1423"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN39"><span class='Ref_to_Member'>typrelid</span></a> <span class='Operator'>&& </span><a href="typcache.c.html#LN1420"><span class='Ref_to_Parameter'>relid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Delete tupdesc if we have it */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1423"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Release our refcount, and free the tupdesc if none remain. 
             * (Can't use DecrTupleDescRefCount because this reference is not 
             * logged in current resource owner.) 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN1423"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>--</span><a href="typcache.c.html#LN1423"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN79"><span class='Ref_to_Member'>tdrefcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../../include/access/tupdesc.h.html#LN95"><span class='Ref_to_Proto'>FreeTupleDesc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1423"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN1423"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN75"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Reset equality/comparison/hashing validity information */ 
</span>        <a href="typcache.c.html#LN1423"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (typentry=(TypeCacheE... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end TypeCacheRelCallback &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * TypeCacheOpcCallback 
 *      Syscache inval callback function 
 * 
 * This is called when a syscache invalidation event occurs for any pg_opclass 
 * row.  In principle we could probably just invalidate data dependent on the 
 * particular opclass, but since updates on pg_opclass are rare in production 
 * it doesn't seem worth a lot of complication: we just mark all cached data 
 * invalid. 
 * 
 * Note that we don't bother watching for updates on pg_amop or pg_amproc. 
 * This should be safe because ALTER OPERATOR FAMILY ADD/DROP OPERATOR/FUNCTION 
 * is not allowed to be used to add/drop the primary operators and functions 
 * of an opclass, only cross-type members of a family; and the latter sorts 
 * of members are not going to get cached here. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1472"></a><span class='Declare_Function'>TypeCacheOpcCallback</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cacheid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashvalue</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1474"></a>    <a href="../../../include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN1475"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* TypeCacheHash must exist, else this callback wouldn't be registered */ 
</span>    <a href="../../../include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typcache.c.html#LN1474"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN71"><span class='Ref_to_Global_Var'>TypeCacheHash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="typcache.c.html#LN1475"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typcache.c.html#LN1474"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Reset equality/comparison/hashing validity information */ 
</span>        <a href="typcache.c.html#LN1475"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * TypeCacheConstrCallback 
 *      Syscache inval callback function 
 * 
 * This is called when a syscache invalidation event occurs for any 
 * pg_constraint or pg_type row.  We flush information about domain 
 * constraints when this happens. 
 * 
 * It's slightly annoying that we can't tell whether the inval event was for a 
 * domain constraint/type record or not; there's usually more update traffic 
 * for table constraints/types than domain constraints, so we'll do a lot of 
 * useless flushes.  Still, this is better than the old no-caching-at-all 
 * approach to domain constraints. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1501"></a><span class='Declare_Function'>TypeCacheConstrCallback</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cacheid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashvalue</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1503"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Because this is called very frequently, and typically very few of the 
     * typcache entries are for domains, we don't use hash_seq_search here. 
     * Instead we thread all the domain-type entries together so that we can 
     * visit them cheaply. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1503"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN74"><span class='Ref_to_Global_Var'>firstDomainTypeEntry</span></a><span class='Delimiter'>; 
</span>         <a href="typcache.c.html#LN1503"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>         <a href="typcache.c.html#LN1503"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1503"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN105"><span class='Ref_to_Member'>nextDomain</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Reset domain constraint validity information */ 
</span>        <a href="typcache.c.html#LN1503"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN96"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>&= ~</span><a href="typcache.c.html#LN91"><span class='Ref_to_Const'>TCFLAGS_CHECKED_DOMAIN_CONSTRAINTS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check if given OID is part of the subset that's sortable by comparisons 
 */ 
</span><span class='Keyword'>static inline bool 
</span><a name="LN1525"></a><span class='Declare_Function'>enum_known_sorted</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN119"><span class='Ref_to_Struct'>TypeCacheEnumData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>enumdata</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1527"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1525"><span class='Ref_to_Parameter'>arg</span></a> <span class='Operator'>&LT; </span><a href="typcache.c.html#LN1525"><span class='Ref_to_Parameter'>enumdata</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN121"><span class='Ref_to_Member'>bitmap_base</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1527"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1525"><span class='Ref_to_Parameter'>arg</span></a> <span class='Operator'>- </span><a href="typcache.c.html#LN1525"><span class='Ref_to_Parameter'>enumdata</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN121"><span class='Ref_to_Member'>bitmap_base</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1527"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span>INT_MAX<span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="typcache.c.html#LN1527"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1525"><span class='Ref_to_Parameter'>enumdata</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN122"><span class='Ref_to_Member'>sorted_values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * compare_values_of_enum 
 *      Compare two members of an enum type. 
 *      Return &LT;0, 0, or &GT;0 according as arg1 &LT;, =, or &GT; arg2. 
 * 
 * Note: currently, the enumData cache is refreshed only if we are asked 
 * to compare an enum value that is not already in the cache.  This is okay 
 * because there is no support for re-ordering existing values, so comparisons 
 * of previously cached values will return the right answer even if other 
 * values have been added since we last loaded the cache. 
 * 
 * Note: the enum logic has a special-case rule about even-numbered versus 
 * odd-numbered OIDs, but we take no account of that rule here; this 
 * routine shouldn't even get called when that rule applies. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1554"></a><span class='Declare_Function'>compare_values_of_enum</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tcache</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1556"></a>    <a href="typcache.c.html#LN119"><span class='Ref_to_Struct'>TypeCacheEnumData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>enumdata</span><span class='Delimiter'>; 
</span><a name="LN1557"></a>    <a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>item1</span><span class='Delimiter'>; 
</span><a name="LN1558"></a>    <a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>item2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Equal OIDs are certainly equal --- this case was probably handled by 
     * our caller, but we may as well check. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg1</span></a> <span class='Operator'>== </span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Load up the cache if first time through */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN102"><span class='Ref_to_Member'>enumData</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="typcache.c.html#LN173"><span class='Ref_to_Proto'>load_enum_cache_data</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>tcache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1556"><span class='Ref_To_Local'>enumdata</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN102"><span class='Ref_to_Member'>enumData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If both OIDs are known-sorted, we can just compare them directly. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1524"><span class='Ref_to_Func'>enum_known_sorted</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1556"><span class='Ref_To_Local'>enumdata</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="typcache.c.html#LN1524"><span class='Ref_to_Func'>enum_known_sorted</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1556"><span class='Ref_To_Local'>enumdata</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg1</span></a> <span class='Operator'>&LT; </span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Slow path: we have to identify their actual sort-order positions. 
     */ 
</span>    <a href="typcache.c.html#LN1557"><span class='Ref_To_Local'>item1</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN174"><span class='Ref_to_Proto'>find_enumitem</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1556"><span class='Ref_To_Local'>enumdata</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1558"><span class='Ref_To_Local'>item2</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN174"><span class='Ref_to_Proto'>find_enumitem</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1556"><span class='Ref_To_Local'>enumdata</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1557"><span class='Ref_To_Local'>item1</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="typcache.c.html#LN1558"><span class='Ref_To_Local'>item2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We couldn't find one or both values.  That means the enum has 
         * changed under us, so re-initialize the cache and try again. We 
         * don't bother retrying the known-sorted case in this path. 
         */ 
</span>        <a href="typcache.c.html#LN173"><span class='Ref_to_Proto'>load_enum_cache_data</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>tcache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN1556"><span class='Ref_To_Local'>enumdata</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN102"><span class='Ref_to_Member'>enumData</span></a><span class='Delimiter'>; 
</span> 
        <a href="typcache.c.html#LN1557"><span class='Ref_To_Local'>item1</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN174"><span class='Ref_to_Proto'>find_enumitem</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1556"><span class='Ref_To_Local'>enumdata</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN1558"><span class='Ref_To_Local'>item2</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN174"><span class='Ref_to_Proto'>find_enumitem</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1556"><span class='Ref_To_Local'>enumdata</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we still can't find the values, complain: we must have corrupt 
         * data. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1557"><span class='Ref_To_Local'>item1</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"enum value %u not found in cache for enum %s"</span><span class='Delimiter'>, 
</span>                 <a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="../adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1558"><span class='Ref_To_Local'>item2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"enum value %u not found in cache for enum %s"</span><span class='Delimiter'>, 
</span>                 <a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="../adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1554"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if item1==NULL||item2==N... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1557"><span class='Ref_To_Local'>item1</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN116"><span class='Ref_to_Member'>sort_order</span></a> <span class='Operator'>&LT; </span><a href="typcache.c.html#LN1558"><span class='Ref_To_Local'>item2</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN116"><span class='Ref_to_Member'>sort_order</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1557"><span class='Ref_To_Local'>item1</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN116"><span class='Ref_to_Member'>sort_order</span></a> <span class='Operator'>&GT; </span><a href="typcache.c.html#LN1558"><span class='Ref_To_Local'>item2</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN116"><span class='Ref_to_Member'>sort_order</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end compare_values_of_enum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Load (or re-load) the enumData member of the typcache entry. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1627"></a><span class='Declare_Function'>load_enum_cache_data</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tcache</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1629"></a>    <a href="typcache.c.html#LN119"><span class='Ref_to_Struct'>TypeCacheEnumData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>enumdata</span><span class='Delimiter'>; 
</span><a name="LN1630"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>enum_rel</span><span class='Delimiter'>; 
</span><a name="LN1631"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>enum_scan</span><span class='Delimiter'>; 
</span><a name="LN1632"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>enum_tuple</span><span class='Delimiter'>; 
</span><a name="LN1633"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>; 
</span><a name="LN1634"></a>    <a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>items</span><span class='Delimiter'>; 
</span><a name="LN1635"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numitems</span><span class='Delimiter'>; 
</span><a name="LN1636"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxitems</span><span class='Delimiter'>; 
</span><a name="LN1637"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>bitmap_base</span><span class='Delimiter'>; 
</span><a name="LN1638"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>bitmap</span><span class='Delimiter'>; 
</span><a name="LN1639"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1640"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bm_size</span><span class='Delimiter'>, 
</span><a name="LN1641"></a>                <span class='Declare_Local'>start_pos</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that this is actually an enum */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1627"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN38"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_type.h.html#LN722"><span class='Ref_to_Const'>TYPTYPE_ENUM</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not an enum"</span><span class='Delimiter'>, 
</span>                        <a href="../adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1627"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read all the information for members of the enum type.  We collect the 
     * info in working memory in the caller's context, and then transfer it to 
     * permanent memory in CacheMemoryContext.  This minimizes the risk of 
     * leaking memory from CacheMemoryContext in the event of an error partway 
     * through. 
     */ 
</span>    <a href="typcache.c.html#LN1636"><span class='Ref_To_Local'>maxitems</span></a> <span class='Operator'>= </span><span class='Number'>64</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="typcache.c.html#LN1636"><span class='Ref_To_Local'>maxitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan pg_enum for the members of the target enum type. */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typcache.c.html#LN1633"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/catalog/pg_enum.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_enum_enumtypid</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1627"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="typcache.c.html#LN1630"><span class='Ref_To_Local'>enum_rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_enum.h.html#LN31"><span class='Ref_to_Const'>EnumRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1631"><span class='Ref_To_Local'>enum_scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1630"><span class='Ref_To_Local'>enum_rel</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/catalog/indexing.h.html#LN156"><span class='Ref_to_Const'>EnumTypIdLabelIndexId</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                   <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typcache.c.html#LN1633"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1632"><span class='Ref_To_Local'>enum_tuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1631"><span class='Ref_To_Local'>enum_scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1675"></a>        <a href="../../../include/catalog/pg_enum.h.html#LN45"><span class='Ref_to_Typedef'>Form_pg_enum</span></a> <span class='Declare_Local'>en</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_enum.h.html#LN45"><span class='Ref_to_Typedef'>Form_pg_enum</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1632"><span class='Ref_To_Local'>enum_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a> <span class='Operator'>&GT;= </span><a href="typcache.c.html#LN1636"><span class='Ref_To_Local'>maxitems</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="typcache.c.html#LN1636"><span class='Ref_To_Local'>maxitems</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="typcache.c.html#LN1636"><span class='Ref_To_Local'>maxitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="typcache.c.html#LN115"><span class='Ref_to_Member'>enum_oid</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1632"><span class='Ref_To_Local'>enum_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="typcache.c.html#LN116"><span class='Ref_to_Member'>sort_order</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1675"><span class='Ref_To_Local'>en</span></a><span class='Operator'>-&GT;</span>enumsortorder<span class='Delimiter'>; 
</span>        <a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1631"><span class='Ref_To_Local'>enum_scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1630"><span class='Ref_To_Local'>enum_rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sort the items into OID order */ 
</span>    <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="typcache.c.html#LN175"><span class='Ref_to_Proto'>enum_oid_cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Here, we create a bitmap listing a subset of the enum's OIDs that are 
     * known to be in order and can thus be compared with just OID comparison. 
     * 
     * The point of this is that the enum's initial OIDs were certainly in 
     * order, so there is some subset that can be compared via OID comparison; 
     * and we'd rather not do binary searches unnecessarily. 
     * 
     * This is somewhat heuristic, and might identify a subset of OIDs that 
     * isn't exactly what the type started with.  That's okay as long as the 
     * subset is correctly sorted. 
     */ 
</span>    <a href="typcache.c.html#LN1637"><span class='Ref_To_Local'>bitmap_base</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1638"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1640"><span class='Ref_To_Local'>bm_size</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* only save sets of at least 2 OIDs */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1641"><span class='Ref_To_Local'>start_pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="typcache.c.html#LN1641"><span class='Ref_To_Local'>start_pos</span></a> <span class='Operator'>&LT; </span><a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="typcache.c.html#LN1641"><span class='Ref_To_Local'>start_pos</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Identify longest sorted subsequence starting at start_pos 
         */ 
</span><a name="LN1714"></a>        <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>this_bitmap</span> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN67"><span class='Ref_to_Proto'>bms_make_singleton</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1715"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>this_bm_size</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN1716"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>start_oid</span> <span class='Operator'>= </span><a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1641"><span class='Ref_To_Local'>start_pos</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="typcache.c.html#LN115"><span class='Ref_to_Member'>enum_oid</span></a><span class='Delimiter'>; 
</span><a name="LN1717"></a>        <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Local'>prev_order</span> <span class='Operator'>= </span><a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1641"><span class='Ref_To_Local'>start_pos</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="typcache.c.html#LN116"><span class='Ref_to_Member'>sort_order</span></a><span class='Delimiter'>; 
</span><a name="LN1718"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1718"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1641"><span class='Ref_To_Local'>start_pos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="typcache.c.html#LN1718"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a><span class='Delimiter'>; </span><a href="typcache.c.html#LN1718"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1722"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span> 
            <a href="typcache.c.html#LN1722"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1718"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="typcache.c.html#LN115"><span class='Ref_to_Member'>enum_oid</span></a> <span class='Operator'>- </span><a href="typcache.c.html#LN1716"><span class='Ref_To_Local'>start_oid</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* quit if bitmap would be too large; cutoff is arbitrary */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1722"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>&GT;= </span><span class='Number'>8192</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* include the item if it's in-order */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1718"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="typcache.c.html#LN116"><span class='Ref_to_Member'>sort_order</span></a> <span class='Operator'>&GT; </span><a href="typcache.c.html#LN1717"><span class='Ref_To_Local'>prev_order</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="typcache.c.html#LN1717"><span class='Ref_To_Local'>prev_order</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>[</span><a href="typcache.c.html#LN1718"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="typcache.c.html#LN116"><span class='Ref_to_Member'>sort_order</span></a><span class='Delimiter'>; 
</span>                <a href="typcache.c.html#LN1714"><span class='Ref_To_Local'>this_bitmap</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1714"><span class='Ref_To_Local'>this_bitmap</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="typcache.c.html#LN1722"><span class='Ref_To_Local'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="typcache.c.html#LN1715"><span class='Ref_To_Local'>this_bm_size</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Remember it if larger than previous best */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1715"><span class='Ref_To_Local'>this_bm_size</span></a> <span class='Operator'>&GT; </span><a href="typcache.c.html#LN1640"><span class='Ref_To_Local'>bm_size</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1638"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN1637"><span class='Ref_To_Local'>bitmap_base</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1716"><span class='Ref_To_Local'>start_oid</span></a><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN1638"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1714"><span class='Ref_To_Local'>this_bitmap</span></a><span class='Delimiter'>; 
</span>            <a href="typcache.c.html#LN1640"><span class='Ref_To_Local'>bm_size</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1715"><span class='Ref_To_Local'>this_bm_size</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1714"><span class='Ref_To_Local'>this_bitmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Done if it's not possible to find a longer sequence in the rest of 
         * the list.  In typical cases this will happen on the first 
         * iteration, which is why we create the bitmaps on the fly instead of 
         * doing a second pass over the list. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1640"><span class='Ref_To_Local'>bm_size</span></a> <span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a> <span class='Operator'>- </span><a href="typcache.c.html#LN1641"><span class='Ref_To_Local'>start_pos</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for start_pos=0;start_pos... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* OK, copy the data into CacheMemoryContext */ 
</span>    <a href="typcache.c.html#LN1639"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1629"><span class='Ref_To_Local'>enumdata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typcache.c.html#LN119"><span class='Ref_to_Struct'>TypeCacheEnumData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN119"><span class='Ref_to_Struct'>TypeCacheEnumData</span></a><span class='Delimiter'>, </span>enum_values<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>               <a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1629"><span class='Ref_To_Local'>enumdata</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN121"><span class='Ref_to_Member'>bitmap_base</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1637"><span class='Ref_To_Local'>bitmap_base</span></a><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1629"><span class='Ref_To_Local'>enumdata</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN122"><span class='Ref_to_Member'>sorted_values</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN65"><span class='Ref_to_Proto'>bms_copy</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1638"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1629"><span class='Ref_To_Local'>enumdata</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN123"><span class='Ref_to_Member'>num_values</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="typcache.c.html#LN1629"><span class='Ref_To_Local'>enumdata</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN124"><span class='Ref_to_Member'>enum_values</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1635"><span class='Ref_To_Local'>numitems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1639"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1634"><span class='Ref_To_Local'>items</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/bitmapset.h.html#LN68"><span class='Ref_to_Proto'>bms_free</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1638"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And link the finished cache struct into the typcache */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1627"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN102"><span class='Ref_to_Member'>enumData</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="typcache.c.html#LN1627"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN102"><span class='Ref_to_Member'>enumData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typcache.c.html#LN1627"><span class='Ref_to_Parameter'>tcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN102"><span class='Ref_to_Member'>enumData</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1629"><span class='Ref_To_Local'>enumdata</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end load_enum_cache_data &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Locate the EnumItem with the given OID, if present 
 */ 
</span><span class='Keyword'>static </span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a> <span class='Operator'>* 
</span><a name="LN1782"></a><span class='Declare_Function'>find_enumitem</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN119"><span class='Ref_to_Struct'>TypeCacheEnumData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>enumdata</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1784"></a>    <a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a>    <span class='Declare_Local'>srch</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* On some versions of Solaris, bsearch of zero items dumps core */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1782"><span class='Ref_to_Parameter'>enumdata</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN123"><span class='Ref_to_Member'>num_values</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="typcache.c.html#LN1784"><span class='Ref_To_Local'>srch</span></a><span class='Operator'>.</span><a href="typcache.c.html#LN115"><span class='Ref_to_Member'>enum_oid</span></a> <span class='Operator'>= </span><a href="typcache.c.html#LN1782"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> bsearch<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typcache.c.html#LN1784"><span class='Ref_To_Local'>srch</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1782"><span class='Ref_to_Parameter'>enumdata</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN124"><span class='Ref_to_Member'>enum_values</span></a><span class='Delimiter'>, </span><a href="typcache.c.html#LN1782"><span class='Ref_to_Parameter'>enumdata</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN123"><span class='Ref_to_Member'>num_values</span></a><span class='Delimiter'>, 
</span>                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="typcache.c.html#LN175"><span class='Ref_to_Proto'>enum_oid_cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * qsort comparison function for OID-ordered EnumItems 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1799"></a><span class='Declare_Function'>enum_oid_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>left</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>right</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1801"></a>    <span class='Keyword'>const </span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>l</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typcache.c.html#LN1799"><span class='Ref_to_Parameter'>left</span></a><span class='Delimiter'>; 
</span><a name="LN1802"></a>    <span class='Keyword'>const </span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="typcache.c.html#LN113"><span class='Ref_to_Typedef'>EnumItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typcache.c.html#LN1799"><span class='Ref_to_Parameter'>right</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1801"><span class='Ref_To_Local'>l</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN115"><span class='Ref_to_Member'>enum_oid</span></a> <span class='Operator'>&LT; </span><a href="typcache.c.html#LN1802"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN115"><span class='Ref_to_Member'>enum_oid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typcache.c.html#LN1801"><span class='Ref_To_Local'>l</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN115"><span class='Ref_to_Member'>enum_oid</span></a> <span class='Operator'>&GT; </span><a href="typcache.c.html#LN1802"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="typcache.c.html#LN115"><span class='Ref_to_Member'>enum_oid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>