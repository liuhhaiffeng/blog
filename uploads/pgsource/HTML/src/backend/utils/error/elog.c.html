<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\error\elog.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\error\elog.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:56 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * elog.c 
 *    error logging and reporting 
 * 
 * Because of the extremely high rate at which log messages can be generated, 
 * we need to be mindful of the performance cost of obtaining any information 
 * that may be logged.  Also, it's important to keep in mind that this code may 
 * get called from within an aborted transaction, in which case operations 
 * such as syscache lookups are unsafe. 
 * 
 * Some notes about recursion and errors during error processing: 
 * 
 * We need to be robust about recursive-error scenarios --- for example, 
 * if we run out of memory, it's important to be able to report that fact. 
 * There are a number of considerations that go into this. 
 * 
 * First, distinguish between re-entrant use and actual recursion.  It 
 * is possible for an error or warning message to be emitted while the 
 * parameters for an error message are being computed.  In this case 
 * errstart has been called for the outer message, and some field values 
 * may have already been saved, but we are not actually recursing.  We handle 
 * this by providing a (small) stack of ErrorData records.  The inner message 
 * can be computed and sent without disturbing the state of the outer message. 
 * (If the inner message is actually an error, this isn't very interesting 
 * because control won't come back to the outer message generator ... but 
 * if the inner message is only debug or log data, this is critical.) 
 * 
 * Second, actual recursion will occur if an error is reported by one of 
 * the elog.c routines or something they call.  By far the most probable 
 * scenario of this sort is "out of memory"; and it's also the nastiest 
 * to handle because we'd likely also run out of memory while trying to 
 * report this error!  Our escape hatch for this case is to reset the 
 * ErrorContext to empty before trying to process the inner error.  Since 
 * ErrorContext is guaranteed to have at least 8K of space in it (see mcxt.c), 
 * we should be able to process an "out of memory" message successfully. 
 * Since we lose the prior error state due to the reset, we won't be able 
 * to return to processing the original error, but we wouldn't have anyway. 
 * (NOTE: the escape hatch is not used for recursive situations where the 
 * inner message is of less than ERROR severity; in that case we just 
 * try to process it and return normally.  Usually this will work, but if 
 * it ends up in infinite recursion, we will PANIC due to error stack 
 * overflow.) 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/error/elog.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;time.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;signal.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Directive'>#ifdef</span> HAVE_SYSLOG 
<span class='Keyword'>#include </span><span class='String'>&LT;syslog.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/libpq.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"postmaster/postmaster.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"postmaster/syslogger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/ipc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/tcopprot.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/guc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/ps_status.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* In this module, access gettext() via err_gettext() */ 
</span><span class='Keyword'>#undef </span>_ 
<a name="LN83"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>_</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>) </span><a href="elog.c.html#LN168"><span class='Ref_to_Func'>err_gettext</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN83"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) 
</span> 
 
<span class='Comment_Multi_Line'>/* Global variables */ 
</span><a name="LN87"></a>ErrorContextCallback <span class='Operator'>*</span><span class='Declare_Var'>error_context_stack</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN89"></a><a href="../../../include/c.h.html#LN1087"><span class='Ref_to_Const'>sigjmp_buf</span></a> <span class='Operator'>*</span><span class='Declare_Var'>PG_exception_stack</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN91"></a><span class='Keyword'>extern bool </span><span class='Declare_Var'>redirection_done</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Hook for intercepting messages before they are sent to the server log. 
 * Note that the hook will not get called for messages that are suppressed 
 * by log_min_messages.  Also note that logging hooks implemented in preload 
 * libraries will miss any log messages that are generated before the 
 * library is loaded. 
 */ 
</span><a name="LN100"></a>emit_log_hook_type <span class='Declare_Var'>emit_log_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* GUC parameters */ 
</span><a name="LN103"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>Log_error_verbosity</span> <span class='Operator'>= </span>PGERROR_VERBOSE<span class='Delimiter'>; 
</span><a name="LN104"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>Log_line_prefix</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* format for extra log line info */ 
</span><a name="LN105"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>Log_destination</span> <span class='Operator'>= </span><a href="../../../include/utils/elog.h.html#LN394"><span class='Ref_to_Const'>LOG_DESTINATION_STDERR</span></a><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>Log_destination_string</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>syslog_sequence_numbers</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN108"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>syslog_split_messages</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_SYSLOG 
 
<span class='Comment_Multi_Line'>/* 
 * Max string length to send to syslog().  Note that this doesn't count the 
 * sequence-number prefix we add, and of course it doesn't count the prefix 
 * added by syslog itself.  Solaris and sysklogd truncate the final message 
 * at 1024 bytes, so this value leaves 124 bytes for those prefixes.  (Most 
 * other syslog implementations seem to have limits of 2KB or so.) 
 */ 
</span><span class='Directive'>#ifndef</span> <a href="elog.c.html#LN120"><span class='Ref_to_Const'>PG_SYSLOG_LIMIT</span></a> 
<a name="LN120"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_SYSLOG_LIMIT</span> <span class='Number'>900</span> 
<span class='Directive'>#endif</span> 
 
<a name="LN123"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>openlog_done</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN124"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>syslog_ident</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN125"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>syslog_facility</span> <span class='Operator'>= </span>LOG_LOCAL0<span class='Delimiter'>; 
</span> 
<a name="LN127"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>write_syslog</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>line</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN131"></a><span class='Keyword'>extern char </span><span class='Operator'>*</span><span class='Declare_Var'>event_source</span><span class='Delimiter'>; 
</span> 
<a name="LN133"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>write_eventlog</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>line</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* We provide a small stack of ErrorData records for re-entrant cases */ 
</span><a name="LN137"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ERRORDATA_STACK_SIZE</span>  <span class='Number'>5</span> 
 
<a name="LN139"></a><span class='Keyword'>static </span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Declare_Var'>errordata</span><span class='Delimiter'>[</span><a href="elog.c.html#LN137"><span class='Ref_to_Const'>ERRORDATA_STACK_SIZE</span></a><span class='Delimiter'>]; 
</span> 
<a name="LN141"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>errordata_stack_depth</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* index of topmost active frame */ 
</span> 
<a name="LN143"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>recursion_depth</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* to detect actual recursion */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Saved timeval and buffers for formatted timestamps that might be used by 
 * both log_line_prefix and csv logs. 
 */ 
</span><a name="LN149"></a><span class='Keyword'>static </span><span class='Control'>struct</span> timeval <span class='Declare_Var'>saved_timeval</span><span class='Delimiter'>; 
</span><a name="LN150"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>saved_timeval_set</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN152"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>FORMATTED_TS_LEN</span> <span class='Number'>128</span> 
<a name="LN153"></a><span class='Keyword'>static char </span><span class='Declare_Var'>formatted_start_time</span><span class='Delimiter'>[</span><a href="elog.c.html#LN152"><span class='Ref_to_Const'>FORMATTED_TS_LEN</span></a><span class='Delimiter'>]; 
</span><a name="LN154"></a><span class='Keyword'>static char </span><span class='Declare_Var'>formatted_log_time</span><span class='Delimiter'>[</span><a href="elog.c.html#LN152"><span class='Ref_to_Const'>FORMATTED_TS_LEN</span></a><span class='Delimiter'>]; 
</span> 
 
<span class='Comment_Multi_Line'>/* Macro for checking errordata_stack_depth is reasonable */ 
</span><a name="LN158"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CHECK_STACK_DEPTH</span><span class='Parentheses'>() </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"errstart was not called"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
 
<a name="LN168"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Function'>err_gettext</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) </span><a href="../../../include/c.h.html#LN633"><span class='Ref_to_Macro'>pg_attribute_format_arg</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="elog.c.html#LN1225"><span class='Ref_to_Func'>set_errdata_field</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN72"><span class='Ref_to_Struct'>MemoryContextData</span></a> <span class='Operator'>*</span>cxt<span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><a href="../../../interfaces/ecpg/preproc/pgc.l.html#LN941"><span class='Ref_to_Global_Var'>ptr</span></a><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><a href="elog.c.html#LN168"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="elog.c.html#LN2155"><span class='Ref_to_Func'>write_console</span></a><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span>line<span class='Delimiter'>, </span><span class='Keyword'>int </span><a href="../../replication/repl_scanner.l.html#LN155"><span class='Ref_to_Global_Var'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="elog.c.html#LN2226"><span class='Ref_to_Func'>setup_formatted_log_time</span></a><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="elog.c.html#LN2258"><span class='Ref_to_Func'>setup_formatted_start_time</span></a><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static const char </span><span class='Operator'>*</span><a href="elog.c.html#LN2280"><span class='Ref_to_Func'>process_log_prefix_padding</span></a><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span>p<span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span>padding<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="elog.c.html#LN2311"><span class='Ref_to_Func'>log_line_prefix</span></a><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span>edata<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="elog.c.html#LN2645"><span class='Ref_to_Func'>write_csvlog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span>edata<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="elog.c.html#LN2862"><span class='Ref_to_Func'>send_message_to_server_log</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span>edata<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="elog.c.html#LN3089"><span class='Ref_to_Func'>write_pipe_chunks</span></a><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span>data<span class='Delimiter'>, </span><span class='Keyword'>int </span><a href="../../replication/repl_scanner.l.html#LN155"><span class='Ref_to_Global_Var'>len</span></a><span class='Delimiter'>, </span><span class='Keyword'>int </span>dest<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="elog.c.html#LN3145"><span class='Ref_to_Func'>send_message_to_frontend</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span>edata<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static char </span><span class='Operator'>*</span><a href="elog.c.html#LN3335"><span class='Ref_to_Func'>expand_fmt_string</span></a><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span>fmt<span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span>edata<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static const char </span><span class='Operator'>*</span><a href="elog.c.html#LN3383"><span class='Ref_to_Func'>useful_strerror</span></a><span class='Parentheses'>(</span><span class='Keyword'>int </span>errnum<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static const char </span><span class='Operator'>*</span><a href="elog.c.html#LN3424"><span class='Ref_to_Func'>get_errno_symbol</span></a><span class='Parentheses'>(</span><span class='Keyword'>int </span>errnum<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static const char </span><span class='Operator'>*</span><a href="elog.c.html#LN3599"><span class='Ref_to_Func'>error_severity</span></a><span class='Parentheses'>(</span><span class='Keyword'>int </span><a href="../../commands/vacuumlazy.c.html#LN136"><span class='Ref_to_Global_Var'>elevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="elog.c.html#LN3650"><span class='Ref_to_Func'>append_with_tabs</span></a><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><a href="elog.c.html#LN168"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static bool </span><a href="elog.c.html#LN3715"><span class='Ref_to_Func'>is_log_level_output</span></a><span class='Parentheses'>(</span><span class='Keyword'>int </span><a href="../../commands/vacuumlazy.c.html#LN136"><span class='Ref_to_Global_Var'>elevel</span></a><span class='Delimiter'>, </span><span class='Keyword'>int </span>log_min_level<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * in_error_recursion_trouble --- are we at risk of infinite error recursion? 
 * 
 * This function exists to provide common control of various fallback steps 
 * that we take if we think we are facing infinite error recursion.  See the 
 * callers for details. 
 */ 
</span><span class='Keyword'>bool 
</span><a href="../../../include/utils/elog.h.html#LN402"><span class='Ref_to_Proto'>in_error_recursion_trouble</span></a><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Pull the plug if recurse more than once */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a> <span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end err_gettext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * One of those fallback steps is to stop trying to localize the error 
 * message, since there's a significant probability that that's exactly 
 * what's causing the recursion. 
 */ 
</span><span class='Keyword'>static inline const char </span><span class='Operator'>* 
</span><a name="LN207"></a><span class='Declare_Function'>err_gettext</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> ENABLE_NLS 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN402"><span class='Ref_to_Proto'>in_error_recursion_trouble</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span> <a href="elog.c.html#LN207"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../../include/c.h.html#LN124"><span class='Ref_to_Macro'>gettext</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN207"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Control'>return</span> <a href="elog.c.html#LN207"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errstart --- begin an error-reporting cycle 
 * 
 * Create a stack entry and store the given parameters in it.  Subsequently, 
 * errmsg() and perhaps other routines will be called to further populate 
 * the stack entry.  Finally, errfinish() will be called to actually process 
 * the error report. 
 * 
 * Returns TRUE in normal case.  Returns FALSE to short-circuit the error 
 * report (if it's a warning or lower and not to be reported anywhere). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN232"></a><span class='Declare_Function'>errstart</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lineno</span><span class='Delimiter'>, 
</span><a name="LN233"></a>         <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>domain</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN235"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span><span class='Delimiter'>; 
</span><a name="LN236"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>output_to_server</span><span class='Delimiter'>; 
</span><a name="LN237"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>output_to_client</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN238"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check some cases in which we want to promote an error into a more 
     * severe error.  None of this logic applies for non-error messages. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we are inside a critical section, all errors become PANIC 
         * errors.  See miscadmin.h. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN36"><span class='Ref_to_Global_Var'>CritSectionCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>= </span><a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check reasons for treating ERROR as FATAL: 
         * 
         * 1. we have no handler to pass the error to (implies we are in the 
         * postmaster or in backend startup). 
         * 
         * 2. ExitOnAnyError mode switch is set (initdb uses this). 
         * 
         * 3. the error occurred after proc_exit has begun to run.  (It's 
         * proc_exit's responsibility to see that this doesn't turn into 
         * infinite recursion!) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>== </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN89"><span class='Ref_to_Global_Var'>PG_exception_stack</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>                <a href="../init/globals.c.html#LN104"><span class='Ref_to_Global_Var'>ExitOnAnyError</span></a> <span class='Operator'>|| 
</span>                <a href="../../storage/ipc/ipc.c.html#LN39"><span class='Ref_to_Global_Var'>proc_exit_inprogress</span></a><span class='Parentheses'>) 
</span>                <a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>= </span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the error level is ERROR or more, errfinish is not going to 
         * return to caller; therefore, if there is any stacked error already 
         * in progress it will be lost.  This is more or less okay, except we 
         * do not want to have a FATAL or PANIC error downgraded because the 
         * reporting process was interrupted by a lower-grade error.  So check 
         * the stack and make sure we panic if panic is warranted. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN238"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="elog.c.html#LN238"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>; </span><a href="elog.c.html#LN238"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN238"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if elevel&GT;=ERROR &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now decide whether we need to process this report at all; if it's 
     * warning or less and not enabled for logging, just return FALSE without 
     * starting up any error logging machinery. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Determine whether message is enabled for server log output */ 
</span>    <a href="elog.c.html#LN236"><span class='Ref_To_Local'>output_to_server</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN3715"><span class='Ref_to_Func'>is_log_level_output</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, </span><a href="../misc/guc.c.html#LN450"><span class='Ref_to_Global_Var'>log_min_messages</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Determine whether message is enabled for client output */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a> <span class='Operator'>&& </span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/elog.h.html#LN27"><span class='Ref_to_Const'>LOG_SERVER_ONLY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * client_min_messages is honored only after we complete the 
         * authentication handshake.  This is required both for security 
         * reasons and because many clients can't handle NOTICE messages 
         * during authentication. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../postmaster/postmaster.c.html#LN347"><span class='Ref_to_Global_Var'>ClientAuthInProgress</span></a><span class='Parentheses'>) 
</span>            <a href="elog.c.html#LN237"><span class='Ref_To_Local'>output_to_client</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="elog.c.html#LN237"><span class='Ref_To_Local'>output_to_client</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>&GT;= </span><a href="../misc/guc.c.html#LN451"><span class='Ref_to_Global_Var'>client_min_messages</span></a> <span class='Operator'>|| 
</span>                                <a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>== </span><a href="../../../include/utils/elog.h.html#LN32"><span class='Ref_to_Const'>INFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Skip processing effort if non-error message will not be output */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>&LT; </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a> <span class='Operator'>&& !</span><a href="elog.c.html#LN236"><span class='Ref_To_Local'>output_to_server</span></a> <span class='Operator'>&& !</span><a href="elog.c.html#LN237"><span class='Ref_To_Local'>output_to_client</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need to do some actual work.  Make sure that memory context 
     * initialization has finished, else we can't do anything useful. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Oops, hard crash time; very little we can do safely here */ 
</span>        <a href="../../../bin/pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span><span class='String'>"error occurred at %s:%d before error message processing is available\n"</span><span class='Delimiter'>, 
</span>                     <a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>? </span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>: </span><span class='String'>"(unknown file)"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Okay, crank up a stack entry to store the info in. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++ &GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Oops, error during error processing.  Clear ErrorContext as 
         * discussed at top of file.  We will not return to the original 
         * error's reporter or handler, so we don't need it. 
         */ 
</span>        <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Infinite error recursion might be due to something broken in a 
         * context traceback routine.  Abandon them too.  We also abandon 
         * attempting to print the error statement (which, if long, could 
         * itself be the source of the recursive failure). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN402"><span class='Ref_to_Proto'>in_error_recursion_trouble</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <a href="elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="../../tcop/postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if recursion_depth++&GT;0&&... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>&GT;= </span><a href="elog.c.html#LN137"><span class='Ref_to_Const'>ERRORDATA_STACK_SIZE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Wups, stack not big enough.  We treat this as a PANIC condition 
         * because it suggests an infinite loop of errors during error 
         * recovery. 
         */ 
</span>        <a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* make room on stack */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"ERRORDATA_STACK_SIZE exceeded"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize data for this error frame */ 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN331"><span class='Ref_to_Member'>output_to_server</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN236"><span class='Ref_To_Local'>output_to_server</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN332"><span class='Ref_to_Member'>output_to_client</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN237"><span class='Ref_To_Local'>output_to_client</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN370"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>slash</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* keep only base name, useful especially for vpath builds */ 
</span>        <a href="elog.c.html#LN370"><span class='Ref_To_Local'>slash</span></a> <span class='Operator'>= </span>strrchr<span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><span class='String'>'/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN370"><span class='Ref_To_Local'>slash</span></a><span class='Parentheses'>) 
</span>            <a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN370"><span class='Ref_To_Local'>slash</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>lineno</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN233"><span class='Ref_to_Parameter'>funcname</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* the default text domain is the backend's */ 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN233"><span class='Ref_to_Parameter'>domain</span></a> <span class='Operator'>? </span><a href="elog.c.html#LN233"><span class='Ref_to_Parameter'>domain</span></a> <span class='Operator'>: </span><a href="../../../include/c.h.html#LN1009"><span class='Ref_to_Macro'>PG_TEXTDOMAIN</span></a><span class='Parentheses'>(</span><span class='String'>"postgres"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* initialize context_domain the same way (see set_errcontext_domain()) */ 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN340"><span class='Ref_to_Member'>context_domain</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Select default errcode based on elevel */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_INTERNAL_ERROR<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN232"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>== </span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_WARNING<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_SUCCESSFUL_COMPLETION<span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* errno is saved here so that error parameter eval can't change it */ 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN356"><span class='Ref_to_Member'>saved_errno</span></a> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Any allocations for this error state level should go into ErrorContext 
     */ 
</span>    <a href="elog.c.html#LN235"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end errstart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * errfinish --- end an error-reporting cycle 
 * 
 * Produce the appropriate error report(s) and pop the error stack. 
 * 
 * If elevel is ERROR or worse, control does not return to the caller. 
 * See elog.h for the error level definitions. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN412"></a><span class='Declare_Function'>errfinish</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>dummy</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN414"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN415"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>elevel</span><span class='Delimiter'>; 
</span><a name="LN416"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN417"></a>    ErrorContextCallback <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN415"><span class='Ref_To_Local'>elevel</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do processing in ErrorContext, which we hope has enough reserved space 
     * to report an error. 
     */ 
</span>    <a href="elog.c.html#LN416"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call any context callback functions.  Errors occurring in callback 
     * functions will be treated as recursive errors --- this ensures we will 
     * avoid infinite recursion (see errstart). 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN417"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>         <a href="elog.c.html#LN417"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>         <a href="elog.c.html#LN417"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN417"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span>previous<span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN417"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span>callback<span class='Parentheses'>) (</span><a href="elog.c.html#LN417"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If ERROR (not more nor less) we pass it off to the current handler. 
     * Printing it and popping the stack is the responsibility of the handler. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN415"><span class='Ref_To_Local'>elevel</span></a> <span class='Operator'>== </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We do some minimal cleanup before longjmp'ing so that handlers can 
         * execute in a reasonably sane state. 
         * 
         * Reset InterruptHoldoffCount in case we ereport'd from inside an 
         * interrupt holdoff section.  (We assume here that no handler will 
         * itself be inside a holdoff section.  If necessary, such a handler 
         * could save and restore InterruptHoldoffCount for itself, but this 
         * should make life easier for most.) 
         */ 
</span>        <a href="../init/globals.c.html#LN34"><span class='Ref_to_Global_Var'>InterruptHoldoffCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../init/globals.c.html#LN35"><span class='Ref_to_Global_Var'>QueryCancelHoldoffCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="../init/globals.c.html#LN36"><span class='Ref_to_Global_Var'>CritSectionCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* should be unnecessary, but... */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note that we leave CurrentMemoryContext set to ErrorContext. The 
         * handler should reset it to something else soon. 
         */ 
</span> 
        <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if elevel==ERROR &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we are doing FATAL or PANIC, abort any old-style COPY OUT in 
     * progress, so that we can report the message before dying.  (Without 
     * this, pq_putmessage will refuse to send the message at all, which is 
     * what we want for NOTICE messages, but not for fatal exits.) This hack 
     * is necessary because of poor design of old-style copy protocol.  Note 
     * we must do this even if client is fool enough to have set 
     * client_min_messages above FATAL, so don't look at output_to_client. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN415"><span class='Ref_To_Local'>elevel</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a> <span class='Operator'>&& </span><a href="../../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/libpq/libpq.h.html#LN46"><span class='Ref_to_Macro'>pq_endcopyout</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Emit the message to the right places */ 
</span>    <a href="../../../include/utils/elog.h.html#LN362"><span class='Ref_to_Proto'>EmitErrorReport</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now free up subsidiary data attached to stack entry, and release it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN414"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Exit error-handling context */ 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN416"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Perform error recovery action as specified by elevel. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN415"><span class='Ref_To_Local'>elevel</span></a> <span class='Operator'>== </span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For a FATAL error, we let proc_exit clean up and exit. 
         * 
         * If we just reported a startup failure, the client will disconnect 
         * on receiving it, so don't send any more to the client. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN89"><span class='Ref_to_Global_Var'>PG_exception_stack</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="../../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>            <a href="../../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>= </span><a href="../../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * fflush here is just to improve the odds that we get to see the 
         * error message, in case things are so hosed that proc_exit crashes. 
         * Any other code you might be tempted to add here should probably be 
         * in an on_proc_exit or on_shmem_exit callback instead. 
         */ 
</span>        fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Do normal process-exit cleanup, then return exit code 1 to indicate 
         * FATAL termination.  The postmaster may or may not consider this 
         * worthy of panic, depending on which subprocess returns it. 
         */ 
</span>        <a href="../../storage/ipc/ipc.c.html#LN97"><span class='Ref_to_Func'>proc_exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if elevel==FATAL &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN415"><span class='Ref_To_Local'>elevel</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Serious crash time. Postmaster will observe SIGABRT process exit 
         * status and kill the other backends too. 
         * 
         * XXX: what if we are *in* the postmaster?  abort() won't kill our 
         * children... 
         */ 
</span>        fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        abort<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for cancel/die interrupt first --- this is so that the user can 
     * stop a query emitting tons of notice or warning messages, even if it's 
     * in a loop that otherwise fails to check for interrupts. 
     */ 
</span>    <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end errfinish &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * errcode --- add SQLSTATE error code to the current error 
 * 
 * The code is expected to be represented as per MAKE_SQLSTATE(). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN574"></a><span class='Declare_Function'>errcode</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>sqlerrcode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN576"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN576"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN574"><span class='Ref_to_Parameter'>sqlerrcode</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errcode_for_file_access --- add SQLSTATE error code to the current error 
 * 
 * The SQLSTATE code is chosen based on the saved errno value.  We assume 
 * that the failing operation was some type of disk file access. 
 * 
 * NOTE: the primary error message string should generally include %m 
 * when this is used. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN597"></a><span class='Declare_Function'>errcode_for_file_access</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN599"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN599"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN356"><span class='Ref_to_Member'>saved_errno</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Permission-denied failures */ 
</span>        <span class='Control'>case</span> EPERM<span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* Not super-user */ 
</span>        <span class='Control'>case</span> EACCES<span class='Operator'>:</span>            <span class='Comment_Single_Line'>/* Permission denied */ 
</span><span class='Directive'>#ifdef</span> EROFS 
        <span class='Control'>case</span> EROFS<span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* Read only file system */ 
</span><span class='Directive'>#endif</span> 
            <a href="elog.c.html#LN599"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* File not found */ 
</span>        <span class='Control'>case</span> ENOENT<span class='Operator'>:</span>            <span class='Comment_Single_Line'>/* No such file or directory */ 
</span>            <a href="elog.c.html#LN599"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_UNDEFINED_FILE<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Duplicate file */ 
</span>        <span class='Control'>case</span> EEXIST<span class='Operator'>:</span>            <span class='Comment_Single_Line'>/* File exists */ 
</span>            <a href="elog.c.html#LN599"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_DUPLICATE_FILE<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Wrong object type or state */ 
</span>        <span class='Control'>case</span> ENOTDIR<span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* Not a directory */ 
</span>        <span class='Control'>case</span> EISDIR<span class='Operator'>:</span>            <span class='Comment_Single_Line'>/* Is a directory */ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>ENOTEMPTY<span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span>ENOTEMPTY <span class='Operator'>!= </span>EEXIST<span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* same code on AIX */ 
</span>        <span class='Control'>case</span> ENOTEMPTY<span class='Operator'>: </span><span class='Comment_Single_Line'>/* Directory not empty */ 
</span><span class='Directive'>#endif</span> 
            <a href="elog.c.html#LN599"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_WRONG_OBJECT_TYPE<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Insufficient resources */ 
</span>        <span class='Control'>case</span> ENOSPC<span class='Operator'>:</span>            <span class='Comment_Single_Line'>/* No space left on device */ 
</span>            <a href="elog.c.html#LN599"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_DISK_FULL<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> ENFILE<span class='Operator'>:</span>            <span class='Comment_Single_Line'>/* File table overflow */ 
</span>        <span class='Control'>case</span> EMFILE<span class='Operator'>:</span>            <span class='Comment_Single_Line'>/* Too many open files */ 
</span>            <a href="elog.c.html#LN599"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_INSUFFICIENT_RESOURCES<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Hardware failure */ 
</span>        <span class='Control'>case</span> EIO<span class='Operator'>:</span>               <span class='Comment_Single_Line'>/* I/O error */ 
</span>            <a href="elog.c.html#LN599"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_IO_ERROR<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* All else is classified as internal errors */ 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="elog.c.html#LN599"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_INTERNAL_ERROR<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch edata-&GT;saved_errno &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end errcode_for_file_access &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * errcode_for_socket_access --- add SQLSTATE error code to the current error 
 * 
 * The SQLSTATE code is chosen based on the saved errno value.  We assume 
 * that the failing operation was some type of socket access. 
 * 
 * NOTE: the primary error message string should generally include %m 
 * when this is used. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN668"></a><span class='Declare_Function'>errcode_for_socket_access</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN670"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN670"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN356"><span class='Ref_to_Member'>saved_errno</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Loss of connection */ 
</span>        <span class='Control'>case</span> EPIPE<span class='Operator'>: 
</span><span class='Directive'>#ifdef</span> <a href="../../../interfaces/libpq/win32.h.html#LN22"><span class='Ref_to_Const'>ECONNRESET</span></a> 
        <span class='Control'>case</span> <a href="../../../interfaces/libpq/win32.h.html#LN22"><span class='Ref_to_Const'>ECONNRESET</span></a><span class='Operator'>: 
</span><span class='Directive'>#endif</span> 
            <a href="elog.c.html#LN670"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_CONNECTION_FAILURE<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* All else is classified as internal errors */ 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="elog.c.html#LN670"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span>ERRCODE_INTERNAL_ERROR<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end errcode_for_socket_access &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * This macro handles expansion of a format string and associated parameters; 
 * it's common code for errmsg(), errdetail(), etc.  Must be called inside 
 * a routine that is declared like "const char *fmt, ..." and has an edata 
 * pointer set up.  The message is assigned to edata-&GT;targetfield, or 
 * appended to it if appendval is true.  The message is subject to translation 
 * if translateit is true. 
 * 
 * Note: we pstrdup the buffer rather than just transferring its storage 
 * to the edata field because the buffer might be considerably larger than 
 * really necessary. 
 */ 
</span><a name="LN707"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>EVALUATE_MESSAGE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>domain</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>targetfield</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>appendval</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>translateit</span><span class='Parentheses'>)</span>   <span class='Operator'>\ 
</span>    <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Keyword'>char</span>           <span class='Operator'>*</span>fmtbuf<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a>  <a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Internationalize the error format string */ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="elog.c.html#LN707"><span class='Ref_to_Parameter'>translateit</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="../../../include/utils/elog.h.html#LN402"><span class='Ref_to_Proto'>in_error_recursion_trouble</span></a><span class='Parentheses'>())</span> <span class='Operator'>\ 
</span>            fmt <span class='Operator'>= </span><a href="../../../include/c.h.html#LN125"><span class='Ref_to_Macro'>dgettext</span></a><span class='Parentheses'>((</span><a href="elog.c.html#LN707"><span class='Ref_to_Parameter'>domain</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span>fmt<span class='Parentheses'>)</span><span class='Delimiter'>;</span>                <span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Expand %m in format string */ </span><span class='Operator'>\ 
</span>        fmtbuf <span class='Operator'>= </span><a href="elog.c.html#LN3335"><span class='Ref_to_Func'>expand_fmt_string</span></a><span class='Parentheses'>(</span>fmt<span class='Delimiter'>, </span>edata<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="elog.c.html#LN707"><span class='Ref_to_Parameter'>appendval</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>edata<span class='Operator'>-&GT;</span>targetfield<span class='Parentheses'>)</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span>edata<span class='Operator'>-&GT;</span>targetfield<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Generate actual output --- have to use appendStringInfoVA */ </span><span class='Operator'>\ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            va_list     <a href="../../../pl/plperl/ppport.h.html#LN4358"><span class='Ref_to_Global_Var'>args</span></a><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Keyword'>int</span>         needed<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="../../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="../../../pl/plperl/ppport.h.html#LN4358"><span class='Ref_to_Global_Var'>args</span></a><span class='Delimiter'>, </span>fmt<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            needed <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN112"><span class='Ref_to_Func'>appendStringInfoVA</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span>fmtbuf<span class='Delimiter'>, </span><a href="../../../pl/plperl/ppport.h.html#LN4358"><span class='Ref_to_Global_Var'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="../../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="../../../pl/plperl/ppport.h.html#LN4358"><span class='Ref_to_Global_Var'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>needed <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN149"><span class='Ref_to_Proto'>enlargeStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span>needed<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Done with expanded fmt */ </span><span class='Operator'>\ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span>fmtbuf<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Save the completed message into the stack item */ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>edata<span class='Operator'>-&GT;</span>targetfield<span class='Parentheses'>) </span><span class='Operator'>\ 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span>edata<span class='Operator'>-&GT;</span>targetfield<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        edata<span class='Operator'>-&GT;</span>targetfield <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Operator'>.</span>data<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Operator'>.</span>data<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end EVALUATE_MESSAGE &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Same as above, except for pluralized error messages.  The calling routine 
 * must be declared like "const char *fmt_singular, const char *fmt_plural, 
 * unsigned long n, ...".  Translation is assumed always wanted. 
 */ 
</span><a name="LN747"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>EVALUATE_MESSAGE_PLURAL</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>domain</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>targetfield</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>appendval</span><span class='Parentheses'>)</span>  <span class='Operator'>\ 
</span>    <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Keyword'>const char</span>     <span class='Operator'>*</span>fmt<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Keyword'>char</span>           <span class='Operator'>*</span>fmtbuf<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a>  <a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Internationalize the error format string */ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/elog.h.html#LN402"><span class='Ref_to_Proto'>in_error_recursion_trouble</span></a><span class='Parentheses'>())</span> <span class='Operator'>\ 
</span>            fmt <span class='Operator'>= </span><a href="../../../include/c.h.html#LN127"><span class='Ref_to_Macro'>dngettext</span></a><span class='Parentheses'>((</span><a href="elog.c.html#LN747"><span class='Ref_to_Parameter'>domain</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span>fmt_singular<span class='Delimiter'>, </span>fmt_plural<span class='Delimiter'>, </span>n<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>else</span> <span class='Operator'>\ 
</span>            fmt <span class='Operator'>= </span><span class='Parentheses'>(</span>n <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>? </span>fmt_singular <span class='Operator'>: </span>fmt_plural<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Expand %m in format string */ </span><span class='Operator'>\ 
</span>        fmtbuf <span class='Operator'>= </span><a href="elog.c.html#LN3335"><span class='Ref_to_Func'>expand_fmt_string</span></a><span class='Parentheses'>(</span>fmt<span class='Delimiter'>, </span>edata<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="elog.c.html#LN747"><span class='Ref_to_Parameter'>appendval</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>edata<span class='Operator'>-&GT;</span>targetfield<span class='Parentheses'>)</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span>edata<span class='Operator'>-&GT;</span>targetfield<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Generate actual output --- have to use appendStringInfoVA */ </span><span class='Operator'>\ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            va_list     <a href="../../../pl/plperl/ppport.h.html#LN4358"><span class='Ref_to_Global_Var'>args</span></a><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Keyword'>int</span>         needed<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="../../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="../../../pl/plperl/ppport.h.html#LN4358"><span class='Ref_to_Global_Var'>args</span></a><span class='Delimiter'>, </span>n<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            needed <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN112"><span class='Ref_to_Func'>appendStringInfoVA</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span>fmtbuf<span class='Delimiter'>, </span><a href="../../../pl/plperl/ppport.h.html#LN4358"><span class='Ref_to_Global_Var'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="../../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="../../../pl/plperl/ppport.h.html#LN4358"><span class='Ref_to_Global_Var'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>needed <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN149"><span class='Ref_to_Proto'>enlargeStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span>needed<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Done with expanded fmt */ </span><span class='Operator'>\ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span>fmtbuf<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Save the completed message into the stack item */ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>edata<span class='Operator'>-&GT;</span>targetfield<span class='Parentheses'>) </span><span class='Operator'>\ 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span>edata<span class='Operator'>-&GT;</span>targetfield<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        edata<span class='Operator'>-&GT;</span>targetfield <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Operator'>.</span>data<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../bin/pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Operator'>.</span>data<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end EVALUATE_MESSAGE_PLURAL &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * errmsg --- add a primary error message text to the current error 
 * 
 * In addition to the usual %-escapes recognized by printf, "%m" in 
 * fmt is replaced by the error message for the caller's value of errno. 
 * 
 * Note: no newline is needed at the end of the fmt string, since 
 * ereport will provide one for the output methods that need it. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN796"></a><span class='Declare_Function'>errmsg</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN798"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN799"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN799"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN798"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN798"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN347"><span class='Ref_to_Member'>message_id</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN796"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN707"><span class='Ref_to_Macro'>EVALUATE_MESSAGE</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN798"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>message<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN799"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errmsg_internal --- add a primary error message text to the current error 
 * 
 * This is exactly like errmsg() except that strings passed to errmsg_internal 
 * are not translated, and are customarily left out of the 
 * internationalization message dictionary.  This should be used for "can't 
 * happen" cases that are probably not worth spending translation effort on. 
 * We also use this for certain cases where we *must* not try to translate 
 * the message because the translation would fail and result in infinite 
 * error recursion. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN826"></a><span class='Declare_Function'>errmsg_internal</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN828"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN829"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN829"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN828"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN828"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN347"><span class='Ref_to_Member'>message_id</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN826"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN707"><span class='Ref_to_Macro'>EVALUATE_MESSAGE</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN828"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>message<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN829"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errmsg_plural --- add a primary error message text to the current error, 
 * with support for pluralization of the message text 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN849"></a><span class='Declare_Function'>errmsg_plural</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt_singular</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt_plural</span><span class='Delimiter'>, 
</span><a name="LN850"></a>              <span class='Keyword'>unsigned long </span><span class='Declare_Parameter'>n</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN852"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN853"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN853"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN852"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN852"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN347"><span class='Ref_to_Member'>message_id</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN849"><span class='Ref_to_Parameter'>fmt_singular</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN747"><span class='Ref_to_Macro'>EVALUATE_MESSAGE_PLURAL</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN852"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>message<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN853"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errdetail --- add a detail error message text to the current error 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN872"></a><span class='Declare_Function'>errdetail</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN874"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN875"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN875"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN874"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN707"><span class='Ref_to_Macro'>EVALUATE_MESSAGE</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN874"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>detail<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN875"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errdetail_internal --- add a detail error message text to the current error 
 * 
 * This is exactly like errdetail() except that strings passed to 
 * errdetail_internal are not translated, and are customarily left out of the 
 * internationalization message dictionary.  This should be used for detail 
 * messages that seem not worth translating for one reason or another 
 * (typically, that they don't seem to be useful to average users). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN899"></a><span class='Declare_Function'>errdetail_internal</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN901"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN902"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN902"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN901"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN707"><span class='Ref_to_Macro'>EVALUATE_MESSAGE</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN901"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>detail<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN902"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errdetail_log --- add a detail_log error message text to the current error 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN920"></a><span class='Declare_Function'>errdetail_log</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN922"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN923"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN923"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN922"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN707"><span class='Ref_to_Macro'>EVALUATE_MESSAGE</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN922"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>detail_log<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN923"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * errdetail_log_plural --- add a detail_log error message text to the current error 
 * with support for pluralization of the message text 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN941"></a><span class='Declare_Function'>errdetail_log_plural</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt_singular</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt_plural</span><span class='Delimiter'>, 
</span><a name="LN942"></a>                     <span class='Keyword'>unsigned long </span><span class='Declare_Parameter'>n</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN944"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN945"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN945"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN944"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN747"><span class='Ref_to_Macro'>EVALUATE_MESSAGE_PLURAL</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN944"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>detail_log<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN945"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errdetail_plural --- add a detail error message text to the current error, 
 * with support for pluralization of the message text 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN964"></a><span class='Declare_Function'>errdetail_plural</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt_singular</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt_plural</span><span class='Delimiter'>, 
</span><a name="LN965"></a>                 <span class='Keyword'>unsigned long </span><span class='Declare_Parameter'>n</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN967"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN968"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN968"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN967"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN747"><span class='Ref_to_Macro'>EVALUATE_MESSAGE_PLURAL</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN967"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>detail<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN968"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errhint --- add a hint error message text to the current error 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN986"></a><span class='Declare_Function'>errhint</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN988"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN989"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN989"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN988"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN707"><span class='Ref_to_Macro'>EVALUATE_MESSAGE</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN988"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>hint<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN989"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errcontext_msg --- add a context error message text to the current error 
 * 
 * Unlike other cases, multiple calls are allowed to build up a stack of 
 * context information.  We assume earlier calls represent more-closely-nested 
 * states. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1011"></a><span class='Declare_Function'>errcontext_msg</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1013"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN1014"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN1014"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1013"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN707"><span class='Ref_to_Macro'>EVALUATE_MESSAGE</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1013"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN340"><span class='Ref_to_Member'>context_domain</span></a><span class='Delimiter'>, </span>context<span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1014"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * set_errcontext_domain --- set message domain to be used by errcontext() 
 * 
 * errcontext_msg() can be called from a different module than the original 
 * ereport(), so we cannot use the message domain passed in errstart() to 
 * translate it.  Instead, each errcontext_msg() call should be preceded by 
 * a set_errcontext_domain() call to specify the domain.  This is usually 
 * done transparently by the errcontext() macro. 
 * 
 * Although errcontext is primarily meant for use at call sites distant from 
 * the original ereport call, there are a few places that invoke errcontext 
 * within ereport.  The expansion of errcontext as a comma expression calling 
 * set_errcontext_domain then errcontext_msg is problematic in this case, 
 * because the intended comma expression becomes two arguments to errfinish, 
 * which the compiler is at liberty to evaluate in either order.  But in 
 * such a case, the set_errcontext_domain calls must be selecting the same 
 * TEXTDOMAIN value that the errstart call did, so order does not matter 
 * so long as errstart initializes context_domain along with domain. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1047"></a><span class='Declare_Function'>set_errcontext_domain</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>domain</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1049"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* the default text domain is the backend's */ 
</span>    <a href="elog.c.html#LN1049"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN340"><span class='Ref_to_Member'>context_domain</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1047"><span class='Ref_to_Parameter'>domain</span></a> <span class='Operator'>? </span><a href="elog.c.html#LN1047"><span class='Ref_to_Parameter'>domain</span></a> <span class='Operator'>: </span><a href="../../../include/c.h.html#LN1009"><span class='Ref_to_Macro'>PG_TEXTDOMAIN</span></a><span class='Parentheses'>(</span><span class='String'>"postgres"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errhidestmt --- optionally suppress STATEMENT: field of log entry 
 * 
 * This should be called if the message text already includes the statement. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1067"></a><span class='Declare_Function'>errhidestmt</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>hide_stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1069"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN1069"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN334"><span class='Ref_to_Member'>hide_stmt</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1067"><span class='Ref_to_Parameter'>hide_stmt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * errhidecontext --- optionally suppress CONTEXT: field of log entry 
 * 
 * This should only be used for verbose debugging messages where the repeated 
 * inclusion of context would bloat the log volume too much. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1086"></a><span class='Declare_Function'>errhidecontext</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>hide_ctx</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1088"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN1088"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN335"><span class='Ref_to_Member'>hide_ctx</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1086"><span class='Ref_to_Parameter'>hide_ctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * errfunction --- add reporting function name to the current error 
 * 
 * This is used when backwards compatibility demands that the function 
 * name appear in messages sent to old-protocol clients.  Note that the 
 * passed string is expected to be a non-freeable constant string. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1107"></a><span class='Declare_Function'>errfunction</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1109"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN1109"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1107"><span class='Ref_to_Parameter'>funcname</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN1109"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN333"><span class='Ref_to_Member'>show_funcname</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * errposition --- add cursor position to the current error 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1124"></a><span class='Declare_Function'>errposition</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>cursorpos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1126"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN1126"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1124"><span class='Ref_to_Parameter'>cursorpos</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * internalerrposition --- add internal cursor position to the current error 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1140"></a><span class='Declare_Function'>internalerrposition</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>cursorpos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1142"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN1142"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1140"><span class='Ref_to_Parameter'>cursorpos</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * internalerrquery --- add internal query text to the current error 
 * 
 * Can also pass NULL to drop the internal query text entry.  This case 
 * is intended for use in error callback subroutines that are editorializing 
 * on the layout of the error report. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1160"></a><span class='Declare_Function'>internalerrquery</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1162"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1162"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1162"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN1162"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1160"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1162"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1162"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1160"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * err_generic_string -- used to set individual ErrorData string fields 
 * identified by PG_DIAG_xxx codes. 
 * 
 * This intentionally only supports fields that don't use localized strings, 
 * so that there are no translation considerations. 
 * 
 * Most potential callers should not use this directly, but instead prefer 
 * higher-level abstractions, such as errtablecol() (see relcache.c). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1190"></a><span class='Declare_Function'>err_generic_string</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1192"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1190"><span class='Ref_to_Parameter'>field</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/postgres_ext.h.html#LN64"><span class='Ref_to_Const'>PG_DIAG_SCHEMA_NAME</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN1225"><span class='Ref_to_Func'>set_errdata_field</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1192"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="elog.c.html#LN1192"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1190"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/postgres_ext.h.html#LN65"><span class='Ref_to_Const'>PG_DIAG_TABLE_NAME</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN1225"><span class='Ref_to_Func'>set_errdata_field</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1192"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="elog.c.html#LN1192"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1190"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/postgres_ext.h.html#LN66"><span class='Ref_to_Const'>PG_DIAG_COLUMN_NAME</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN1225"><span class='Ref_to_Func'>set_errdata_field</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1192"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="elog.c.html#LN1192"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1190"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/postgres_ext.h.html#LN67"><span class='Ref_to_Const'>PG_DIAG_DATATYPE_NAME</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN1225"><span class='Ref_to_Func'>set_errdata_field</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1192"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="elog.c.html#LN1192"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1190"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/postgres_ext.h.html#LN68"><span class='Ref_to_Const'>PG_DIAG_CONSTRAINT_NAME</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN1225"><span class='Ref_to_Func'>set_errdata_field</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1192"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="elog.c.html#LN1192"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1190"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported ErrorData field id: %d"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN1190"><span class='Ref_to_Parameter'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch field &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* return value does not matter */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end err_generic_string &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_errdata_field --- set an ErrorData string field 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1226"></a><span class='Declare_Function'>set_errdata_field</span><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN72"><span class='Ref_to_Struct'>MemoryContextData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cxt</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN1226"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="elog.c.html#LN1226"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1226"><span class='Ref_to_Parameter'>cxt</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1226"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * geterrcode --- return the currently set SQLSTATE error code 
 * 
 * This is only intended for use in error callback subroutines, since there 
 * is no other place outside elog.c where the concept is meaningful. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1239"></a><span class='Declare_Function'>geterrcode</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1241"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="elog.c.html#LN1241"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * geterrposition --- return the currently set error position (0 if none) 
 * 
 * This is only intended for use in error callback subroutines, since there 
 * is no other place outside elog.c where the concept is meaningful. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1256"></a><span class='Declare_Function'>geterrposition</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1258"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="elog.c.html#LN1258"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * getinternalerrposition --- same for internal error position 
 * 
 * This is only intended for use in error callback subroutines, since there 
 * is no other place outside elog.c where the concept is meaningful. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1273"></a><span class='Declare_Function'>getinternalerrposition</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1275"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't bother incrementing recursion_depth */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="elog.c.html#LN1275"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * elog_start --- startup for old-style API 
 * 
 * All that we do here is stash the hidden filename/lineno/funcname 
 * arguments into a stack entry, along with the current value of errno. 
 * 
 * We need this to be separate from elog_finish because there's no other 
 * C89-compliant way to deal with inserting extra arguments into the elog 
 * call.  (When using C99's __VA_ARGS__, we could possibly merge this with 
 * elog_finish, but there doesn't seem to be a good way to save errno before 
 * evaluating the format arguments if we do that.) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1297"></a><span class='Declare_Function'>elog_start</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lineno</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1299"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make sure that memory context initialization has finished */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Oops, hard crash time; very little we can do safely here */ 
</span>        <a href="../../../bin/pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span><span class='String'>"error occurred at %s:%d before error message processing is available\n"</span><span class='Delimiter'>, 
</span>                     <a href="elog.c.html#LN1297"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>? </span><a href="elog.c.html#LN1297"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>: </span><span class='String'>"(unknown file)"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN1297"><span class='Ref_to_Parameter'>lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>&GT;= </span><a href="elog.c.html#LN137"><span class='Ref_to_Const'>ERRORDATA_STACK_SIZE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Wups, stack not big enough.  We treat this as a PANIC condition 
         * because it suggests an infinite loop of errors during error 
         * recovery.  Note that the message is intentionally not localized, 
         * else failure to convert it to client encoding could cause further 
         * recursion. 
         */ 
</span>        <a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* make room on stack */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"ERRORDATA_STACK_SIZE exceeded"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="elog.c.html#LN1299"><span class='Ref_To_Local'>edata</span></a> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1297"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1326"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>slash</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* keep only base name, useful especially for vpath builds */ 
</span>        <a href="elog.c.html#LN1326"><span class='Ref_To_Local'>slash</span></a> <span class='Operator'>= </span>strrchr<span class='Parentheses'>(</span><a href="elog.c.html#LN1297"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><span class='String'>'/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1326"><span class='Ref_To_Local'>slash</span></a><span class='Parentheses'>) 
</span>            <a href="elog.c.html#LN1297"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1326"><span class='Ref_To_Local'>slash</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="elog.c.html#LN1299"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1297"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN1299"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1297"><span class='Ref_to_Parameter'>lineno</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN1299"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1297"><span class='Ref_to_Parameter'>funcname</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* errno is saved now so that error parameter eval can't change it */ 
</span>    <a href="elog.c.html#LN1299"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN356"><span class='Ref_to_Member'>saved_errno</span></a> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use ErrorContext for any allocations done at this level. */ 
</span>    <a href="elog.c.html#LN1299"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end elog_start &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * elog_finish --- finish up for old-style API 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1347"></a><span class='Declare_Function'>elog_finish</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1349"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN1350"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do errstart() to see if we actually want to report the message. 
     */ 
</span>    <a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    errno <span class='Operator'>= </span><a href="elog.c.html#LN1349"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN356"><span class='Ref_to_Member'>saved_errno</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/elog.h.html#LN126"><span class='Ref_to_Proto'>errstart</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1347"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1349"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1349"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1349"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* nothing to do */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Format error message just like errmsg_internal(). 
     */ 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN1350"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1349"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN1349"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN347"><span class='Ref_to_Member'>message_id</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1347"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN707"><span class='Ref_to_Macro'>EVALUATE_MESSAGE</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1349"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>message<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1350"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And let errfinish() finish up. 
     */ 
</span>    <a href="../../../include/utils/elog.h.html#LN128"><span class='Ref_to_Proto'>errfinish</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end elog_finish &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Functions to allow construction of error message strings separately from 
 * the ereport() call itself. 
 * 
 * The expected calling convention is 
 * 
 *  pre_format_elog_string(errno, domain), var = format_elog_string(format,...) 
 * 
 * which can be hidden behind a macro such as GUC_check_errdetail().  We 
 * assume that any functions called in the arguments of format_elog_string() 
 * cannot result in re-entrant use of these functions --- otherwise the wrong 
 * text domain might be used, or the wrong errno substituted for %m.  This is 
 * okay for the current usage with GUC check hooks, but might need further 
 * effort someday. 
 * 
 * The result of format_elog_string() is stored in ErrorContext, and will 
 * therefore survive until FlushErrorState() is called. 
 */ 
</span><a name="LN1399"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>save_format_errnumber</span><span class='Delimiter'>; 
</span><a name="LN1400"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>save_format_domain</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>void 
</span><a name="LN1403"></a><span class='Declare_Function'>pre_format_elog_string</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>errnumber</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>domain</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Save errno before evaluation of argument functions can change it */ 
</span>    <a href="elog.c.html#LN1399"><span class='Ref_to_Global_Var'>save_format_errnumber</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1403"><span class='Ref_to_Parameter'>errnumber</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Save caller's text domain */ 
</span>    <a href="elog.c.html#LN1400"><span class='Ref_to_Global_Var'>save_format_domain</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1403"><span class='Ref_to_Parameter'>domain</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN1412"></a><span class='Declare_Function'>format_elog_string</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1414"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>   <span class='Declare_Local'>errdata</span><span class='Delimiter'>; 
</span><a name="LN1415"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span><span class='Delimiter'>; 
</span><a name="LN1416"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize a mostly-dummy error frame */ 
</span>    <a href="elog.c.html#LN1415"><span class='Ref_To_Local'>edata</span></a> <span class='Operator'>= &</span><a href="elog.c.html#LN1414"><span class='Ref_To_Local'>errdata</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1415"><span class='Ref_To_Local'>edata</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* the default text domain is the backend's */ 
</span>    <a href="elog.c.html#LN1415"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1400"><span class='Ref_to_Global_Var'>save_format_domain</span></a> <span class='Operator'>? </span><a href="elog.c.html#LN1400"><span class='Ref_to_Global_Var'>save_format_domain</span></a> <span class='Operator'>: </span><a href="../../../include/c.h.html#LN1009"><span class='Ref_to_Macro'>PG_TEXTDOMAIN</span></a><span class='Parentheses'>(</span><span class='String'>"postgres"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* set the errno to be used to interpret %m */ 
</span>    <a href="elog.c.html#LN1415"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN356"><span class='Ref_to_Member'>saved_errno</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1399"><span class='Ref_to_Global_Var'>save_format_errnumber</span></a><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN1416"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN1415"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN347"><span class='Ref_to_Member'>message_id</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1412"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN707"><span class='Ref_to_Macro'>EVALUATE_MESSAGE</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1415"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN339"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span>message<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1416"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="elog.c.html#LN1415"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end format_elog_string &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Actual output of the top-of-stack error message 
 * 
 * In the ereport(ERROR) case this is called from PostgresMain (or not at all, 
 * if the error is caught by somebody).  For all other severity levels this 
 * is called by errfinish. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1445"></a><span class='Declare_Function'>EmitErrorReport</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1447"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN1448"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN1448"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1447"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call hook before sending message to log.  The hook function is allowed 
     * to turn off edata-&GT;output_to_server, so we must recheck that afterward. 
     * Making any other change in the content of edata is not considered 
     * supported. 
     * 
     * Note: the reason why the hook can only turn off output_to_server, and 
     * not turn it on, is that it'd be unreliable: we will never get here at 
     * all if errstart() deems the message uninteresting.  A hook that could 
     * make decisions in that direction would have to hook into errstart(), 
     * where it would have much less information available.  emit_log_hook is 
     * intended for custom log filtering and custom log message transmission 
     * mechanisms. 
     * 
     * The log hook has access to both the translated and original English 
     * error message text, which is passed through to allow it to be used as a 
     * message identifier. Note that the original text is not available for 
     * detail, detail_log, hint and context text elements. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1447"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN331"><span class='Ref_to_Member'>output_to_server</span></a> <span class='Operator'>&& </span><a href="elog.c.html#LN100"><span class='Ref_to_Global_Var'>emit_log_hook</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN100"><span class='Ref_to_Global_Var'>emit_log_hook</span></a><span class='Parentheses'>) (</span><a href="elog.c.html#LN1447"><span class='Ref_To_Local'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Send to server log, if enabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1447"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN331"><span class='Ref_to_Member'>output_to_server</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2862"><span class='Ref_to_Func'>send_message_to_server_log</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1447"><span class='Ref_To_Local'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Send to client, if enabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1447"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN332"><span class='Ref_to_Member'>output_to_client</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN3145"><span class='Ref_to_Func'>send_message_to_frontend</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1447"><span class='Ref_To_Local'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1448"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EmitErrorReport &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * CopyErrorData --- obtain a copy of the topmost error stack entry 
 * 
 * This is only for use in error handler code.  The data is copied into the 
 * current memory context, so callers should always switch away from 
 * ErrorContext first; otherwise it will be lost when FlushErrorState is done. 
 */ 
</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>* 
</span><a name="LN1496"></a><span class='Declare_Function'>CopyErrorData</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1498"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span><a name="LN1499"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>newedata</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * we don't increment recursion_depth because out-of-memory here does not 
     * indicate a problem within the error subsystem. 
     */ 
</span>    <a href="elog.c.html#LN158"><span class='Ref_to_Macro'>CHECK_STACK_DEPTH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a> <span class='Operator'>!= </span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy the struct itself */ 
</span>    <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1498"><span class='Ref_To_Local'>edata</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make copies of separately-allocated fields */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use the calling context for string allocation */ 
</span>    <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="elog.c.html#LN1499"><span class='Ref_To_Local'>newedata</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyErrorData &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * FreeErrorData --- free the structure returned by CopyErrorData. 
 * 
 * Error handlers should use this in preference to assuming they know all 
 * the separately-allocated fields. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1550"></a><span class='Declare_Function'>FreeErrorData</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>edata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1550"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end FreeErrorData &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * FlushErrorState --- flush the error state after error recovery 
 * 
 * This should be called by an error handler after it's done processing 
 * the error; or as soon as it's done CopyErrorData, if it intends to 
 * do stuff that is likely to provoke another error.  You are not "out" of 
 * the error subsystem until you have done this. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1586"></a><span class='Declare_Function'>FlushErrorState</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Reset stack to empty.  The only case where it would be more than one 
     * deep is if we serviced an error that interrupted construction of 
     * another message.  We assume control escaped out of that message 
     * construction and won't ever go back. 
     */ 
</span>    <a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Delete all data in ErrorContext */ 
</span>    <a href="../../../include/utils/memutils.h.html#LN66"><span class='Ref_to_Macro'>MemoryContextResetAndDeleteChildren</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ThrowErrorData --- report an error described by an ErrorData structure 
 * 
 * This is somewhat like ReThrowError, but it allows elevels besides ERROR, 
 * and the boolean flags such as output_to_server are computed via the 
 * default rules rather than being copied from the given ErrorData. 
 * This is primarily used to re-report errors originally reported by 
 * background worker processes and then propagated (with or without 
 * modification) to the backend responsible for them. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1611"></a><span class='Declare_Function'>ThrowErrorData</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>edata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1613"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>newedata</span><span class='Delimiter'>; 
</span><a name="LN1614"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/elog.h.html#LN126"><span class='Ref_to_Proto'>errstart</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a><span class='Delimiter'>, 
</span>                  <a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* error is not to be reported at all */ 
</span> 
    <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN1614"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy the supplied fields to the error stack entry. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* assume message_id is not available */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1613"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1611"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1614"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process the error. */ 
</span>    <a href="../../../include/utils/elog.h.html#LN128"><span class='Ref_to_Proto'>errfinish</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ThrowErrorData &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ReThrowError --- re-throw a previously copied error 
 * 
 * A handler can do CopyErrorData/FlushErrorState to get out of the error 
 * subsystem, then do some processing, and finally ReThrowError to re-throw 
 * the original error.  This is slower than just PG_RE_THROW() but should 
 * be used if the "some processing" is likely to incur another error. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1669"></a><span class='Declare_Function'>ReThrowError</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>edata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1671"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>newedata</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="elog.c.html#LN1669"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>== </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Push the data back into the error context */ 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>&GT;= </span><a href="elog.c.html#LN137"><span class='Ref_to_Const'>ERRORDATA_STACK_SIZE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Wups, stack not big enough.  We treat this as a PANIC condition 
         * because it suggests an infinite loop of errors during error 
         * recovery. 
         */ 
</span>        <a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* make room on stack */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"ERRORDATA_STACK_SIZE exceeded"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span>    memcpy<span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1669"><span class='Ref_to_Parameter'>edata</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make copies of separately-allocated fields */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reset the assoc_context to be ErrorContext */ 
</span>    <a href="elog.c.html#LN1671"><span class='Ref_To_Local'>newedata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ReThrowError &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pg_re_throw --- out-of-line implementation of PG_RE_THROW() macro 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1728"></a><span class='Declare_Function'>pg_re_throw</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* If possible, throw the error to the next outer setjmp handler */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN89"><span class='Ref_to_Global_Var'>PG_exception_stack</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/c.h.html#LN1089"><span class='Ref_to_Const'>siglongjmp</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN89"><span class='Ref_to_Global_Var'>PG_exception_stack</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we get here, elog(ERROR) was thrown inside a PG_TRY block, which 
         * we have now exited only to discover that there is no outer setjmp 
         * handler to pass the error to.  Had the error been thrown outside 
         * the block to begin with, we'd have promoted the error to FATAL, so 
         * the correct behavior is to make it FATAL now; that is, emit it and 
         * then call proc_exit. 
         */ 
</span><a name="LN1743"></a>        <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="elog.c.html#LN1743"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>== </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN1743"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>= </span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * At least in principle, the increase in severity could have changed 
         * where-to-output decisions, so recalculate.  This should stay in 
         * sync with errstart(), which see for comments. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN99"><span class='Ref_to_Global_Var'>IsPostmasterEnvironment</span></a><span class='Parentheses'>) 
</span>            <a href="elog.c.html#LN1743"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN331"><span class='Ref_to_Member'>output_to_server</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN3715"><span class='Ref_to_Func'>is_log_level_output</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                                                          <a href="../misc/guc.c.html#LN450"><span class='Ref_to_Global_Var'>log_min_messages</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="elog.c.html#LN1743"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN331"><span class='Ref_to_Member'>output_to_server</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a> <span class='Operator'>&GT;= </span><a href="../misc/guc.c.html#LN450"><span class='Ref_to_Global_Var'>log_min_messages</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../postmaster/postmaster.c.html#LN347"><span class='Ref_to_Global_Var'>ClientAuthInProgress</span></a><span class='Parentheses'>) 
</span>                <a href="elog.c.html#LN1743"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN332"><span class='Ref_to_Member'>output_to_client</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="elog.c.html#LN1743"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN332"><span class='Ref_to_Member'>output_to_client</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a> <span class='Operator'>&GT;= </span><a href="../misc/guc.c.html#LN451"><span class='Ref_to_Global_Var'>client_min_messages</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We can use errfinish() for the rest, but we don't want it to call 
         * any error context routines a second time.  Since we know we are 
         * about to exit, it should be OK to just clear the context stack. 
         */ 
</span>        <a href="elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/elog.h.html#LN128"><span class='Ref_to_Proto'>errfinish</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Doesn't return ... */ 
</span>    <a href="assert.c.html#LN24"><span class='Ref_to_Func'>ExceptionalCondition</span></a><span class='Parentheses'>(</span><span class='String'>"pg_re_throw tried to return"</span><span class='Delimiter'>, </span><span class='String'>"FailedAssertion"</span><span class='Delimiter'>, 
</span>                         __FILE__<span class='Delimiter'>, </span>__LINE__<span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_re_throw &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * GetErrorContextStack - Return the context stack, for display/diags 
 * 
 * Returns a pstrdup'd string in the caller's context which includes the PG 
 * error call stack.  It is the caller's responsibility to ensure this string 
 * is pfree'd (or its context cleaned up) when done. 
 * 
 * This information is collected by traversing the error contexts and calling 
 * each context's callback function, each of which is expected to call 
 * errcontext() to return a string which can be presented to the user. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN1795"></a><span class='Declare_Function'>GetErrorContextStack</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1797"></a>    <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span><span class='Delimiter'>; 
</span><a name="LN1798"></a>    ErrorContextCallback <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Okay, crank up a stack entry to store the info in. 
     */ 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>&GT;= </span><a href="elog.c.html#LN137"><span class='Ref_to_Const'>ERRORDATA_STACK_SIZE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Wups, stack not big enough.  We treat this as a PANIC condition 
         * because it suggests an infinite loop of errors during error 
         * recovery. 
         */ 
</span>        <a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* make room on stack */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"ERRORDATA_STACK_SIZE exceeded"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Things look good so far, so initialize our error frame 
     */ 
</span>    <a href="elog.c.html#LN1797"><span class='Ref_To_Local'>edata</span></a> <span class='Operator'>= &</span><a href="elog.c.html#LN139"><span class='Ref_to_Global_Var'>errordata</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Delimiter'>]; 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1797"><span class='Ref_To_Local'>edata</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up assoc_context to be the caller's context, so any allocations 
     * done (which will include edata-&GT;context) will use their context. 
     */ 
</span>    <a href="elog.c.html#LN1797"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN359"><span class='Ref_to_Member'>assoc_context</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call any context callback functions to collect the context information 
     * into edata-&GT;context. 
     * 
     * Errors occurring in callback functions should go through the regular 
     * error handling code which should handle any recursive errors, though we 
     * double-check above, just in case. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1798"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>         <a href="elog.c.html#LN1798"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>         <a href="elog.c.html#LN1798"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1798"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span>previous<span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN1798"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span>callback<span class='Parentheses'>) (</span><a href="elog.c.html#LN1798"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clean ourselves off the stack, any allocations done should have been 
     * using edata-&GT;assoc_context, which we set up earlier to be the caller's 
     * context, so we're free to just remove our entry off the stack and 
     * decrement recursion depth and exit. 
     */ 
</span>    <a href="elog.c.html#LN141"><span class='Ref_to_Global_Var'>errordata_stack_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN143"><span class='Ref_to_Global_Var'>recursion_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return a pointer to the string the caller asked for, which should have 
     * been allocated in their context. 
     */ 
</span>    <span class='Control'>return</span> <a href="elog.c.html#LN1797"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetErrorContextStack &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Initialization of error output file 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1862"></a><span class='Declare_Function'>DebugFileOpen</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1864"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fd</span><span class='Delimiter'>, 
</span><a name="LN1865"></a>                <span class='Declare_Local'>istty</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN61"><span class='Ref_to_Global_Var'>OutputFileName</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * A debug-output file name was given. 
         * 
         * Make sure we can write the file, and find out if it's a tty. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="elog.c.html#LN1864"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN61"><span class='Ref_to_Global_Var'>OutputFileName</span></a><span class='Delimiter'>, </span>O_CREAT <span class='Operator'>| </span>O_APPEND <span class='Operator'>| </span>O_WRONLY<span class='Delimiter'>, 
</span>                       <span class='Number'>0666</span><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                  <a href="elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\": %m"</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN61"><span class='Ref_to_Global_Var'>OutputFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN1865"><span class='Ref_To_Local'>istty</span></a> <span class='Operator'>= </span>isatty<span class='Parentheses'>(</span><a href="elog.c.html#LN1864"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1864"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Redirect our stderr to the debug output file. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>freopen<span class='Parentheses'>(</span><a href="../init/globals.c.html#LN61"><span class='Ref_to_Global_Var'>OutputFileName</span></a><span class='Delimiter'>, </span><span class='String'>"a"</span><span class='Delimiter'>, </span>stderr<span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                     <a href="elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not reopen file \"%s\" as stderr: %m"</span><span class='Delimiter'>, 
</span>                            <a href="../init/globals.c.html#LN61"><span class='Ref_to_Global_Var'>OutputFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the file is a tty and we're running under the postmaster, try to 
         * send stdout there as well (if it isn't a tty then stderr will block 
         * out stdout, so we may as well let stdout go wherever it was going 
         * before). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1865"><span class='Ref_To_Local'>istty</span></a> <span class='Operator'>&& </span><a href="../init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>freopen<span class='Parentheses'>(</span><a href="../init/globals.c.html#LN61"><span class='Ref_to_Global_Var'>OutputFileName</span></a><span class='Delimiter'>, </span><span class='String'>"a"</span><span class='Delimiter'>, </span>stdout<span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not reopen file \"%s\" as stdout: %m"</span><span class='Delimiter'>, 
</span>                                <a href="../init/globals.c.html#LN61"><span class='Ref_to_Global_Var'>OutputFileName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if OutputFileName[0] &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end DebugFileOpen &raquo; </span> 
 
 
<span class='Directive'>#ifdef</span> HAVE_SYSLOG 
 
<span class='Comment_Multi_Line'>/* 
 * Set or update the parameters for syslog logging 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1913"></a><span class='Declare_Function'>set_syslog_parameters</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ident</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>facility</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * guc.c is likely to call us repeatedly with same parameters, so don't 
     * thrash the syslog connection unnecessarily.  Also, we do not re-open 
     * the connection until needed, since this routine will get called whether 
     * or not Log_destination actually mentions syslog. 
     * 
     * Note that we make our own copy of the ident string rather than relying 
     * on guc.c's.  This may be overly paranoid, but it ensures that we cannot 
     * accidentally free a string that syslog is still using. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN124"><span class='Ref_to_Global_Var'>syslog_ident</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="elog.c.html#LN124"><span class='Ref_to_Global_Var'>syslog_ident</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1913"><span class='Ref_to_Parameter'>ident</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="elog.c.html#LN125"><span class='Ref_to_Global_Var'>syslog_facility</span></a> <span class='Operator'>!= </span><a href="elog.c.html#LN1913"><span class='Ref_to_Parameter'>facility</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN123"><span class='Ref_to_Global_Var'>openlog_done</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            closelog<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN123"><span class='Ref_to_Global_Var'>openlog_done</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN124"><span class='Ref_to_Global_Var'>syslog_ident</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN124"><span class='Ref_to_Global_Var'>syslog_ident</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN124"><span class='Ref_to_Global_Var'>syslog_ident</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="elog.c.html#LN1913"><span class='Ref_to_Parameter'>ident</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* if the strdup fails, we will cope in write_syslog() */ 
</span>        <a href="elog.c.html#LN125"><span class='Ref_to_Global_Var'>syslog_facility</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1913"><span class='Ref_to_Parameter'>facility</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end set_syslog_parameters &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Write a message line to syslog 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1946"></a><span class='Declare_Function'>write_syslog</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>line</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1948"></a>    <span class='Keyword'>static unsigned long </span><span class='Declare_Local'>seq</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<a name="LN1950"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN1951"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>nlpos</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Open syslog connection if not done yet */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="elog.c.html#LN123"><span class='Ref_to_Global_Var'>openlog_done</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        openlog<span class='Parentheses'>(</span><a href="elog.c.html#LN124"><span class='Ref_to_Global_Var'>syslog_ident</span></a> <span class='Operator'>? </span><a href="elog.c.html#LN124"><span class='Ref_to_Global_Var'>syslog_ident</span></a> <span class='Operator'>: </span><span class='String'>"postgres"</span><span class='Delimiter'>, 
</span>                LOG_PID <span class='Operator'>| </span>LOG_NDELAY <span class='Operator'>| </span>LOG_NOWAIT<span class='Delimiter'>, 
</span>                <a href="elog.c.html#LN125"><span class='Ref_to_Global_Var'>syslog_facility</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN123"><span class='Ref_to_Global_Var'>openlog_done</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We add a sequence number to each log message to suppress "same" 
     * messages. 
     */ 
</span>    <a href="elog.c.html#LN1948"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Our problem here is that many syslog implementations don't handle long 
     * messages in an acceptable manner. While this function doesn't help that 
     * fact, it does work around by splitting up messages into smaller pieces. 
     * 
     * We divide into multiple syslog() calls if message is too long or if the 
     * message contains embedded newline(s). 
     */ 
</span>    <a href="elog.c.html#LN1950"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN1951"><span class='Ref_To_Local'>nlpos</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN108"><span class='Ref_to_Global_Var'>syslog_split_messages</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="elog.c.html#LN1950"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><a href="elog.c.html#LN120"><span class='Ref_to_Const'>PG_SYSLOG_LIMIT</span></a> <span class='Operator'>|| </span><a href="elog.c.html#LN1951"><span class='Ref_To_Local'>nlpos</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1980"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>chunk_nr</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1950"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1984"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="elog.c.html#LN120"><span class='Ref_to_Const'>PG_SYSLOG_LIMIT</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1985"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>buflen</span><span class='Delimiter'>; 
</span><a name="LN1986"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* if we start at a newline, move ahead one char */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="elog.c.html#LN1950"><span class='Ref_To_Local'>len</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* we need to recompute the next newline's position, too */ 
</span>                <a href="elog.c.html#LN1951"><span class='Ref_To_Local'>nlpos</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* copy one line, or as much as will fit, to buf */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1951"><span class='Ref_To_Local'>nlpos</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1951"><span class='Ref_To_Local'>nlpos</span></a> <span class='Operator'>- </span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1950"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN120"><span class='Ref_to_Const'>PG_SYSLOG_LIMIT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="elog.c.html#LN1984"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN1984"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* trim to multibyte letter boundary */ 
</span>            <a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN530"><span class='Ref_to_Proto'>pg_mbcliplen</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN1984"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN1984"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* already word boundary? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& 
</span>                <span class='Operator'>!</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* try to divide at word boundary */ 
</span>                <a href="elog.c.html#LN1986"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1986"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="elog.c.html#LN1984"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN1986"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                    <a href="elog.c.html#LN1986"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN1986"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* else couldn't divide word boundary */ 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN1986"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>                    <a href="elog.c.html#LN1984"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN1986"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="elog.c.html#LN1980"><span class='Ref_To_Local'>chunk_nr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN107"><span class='Ref_to_Global_Var'>syslog_sequence_numbers</span></a><span class='Parentheses'>) 
</span>                syslog<span class='Parentheses'>(</span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, </span><span class='String'>"[%lu-%d] %s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN1948"><span class='Ref_To_Local'>seq</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1980"><span class='Ref_To_Local'>chunk_nr</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1984"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                syslog<span class='Parentheses'>(</span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, </span><span class='String'>"[%d] %s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN1980"><span class='Ref_To_Local'>chunk_nr</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1984"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a> <span class='Operator'>+= </span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN1950"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>-= </span><a href="elog.c.html#LN1985"><span class='Ref_To_Local'>buflen</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while len&GT;0 &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if syslog_split_messages... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* message short enough */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN107"><span class='Ref_to_Global_Var'>syslog_sequence_numbers</span></a><span class='Parentheses'>) 
</span>            syslog<span class='Parentheses'>(</span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, </span><span class='String'>"[%lu] %s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN1948"><span class='Ref_To_Local'>seq</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            syslog<span class='Parentheses'>(</span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN1946"><span class='Ref_to_Parameter'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end write_syslog &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_SYSLOG */ 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Comment_Multi_Line'>/* 
 * Get the PostgreSQL equivalent of the Windows ANSI code page.  "ANSI" system 
 * interfaces (e.g. CreateFileA()) expect string arguments in this encoding. 
 * Every process in a given system will find the same value at all times. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2058"></a><span class='Declare_Function'>GetACPEncoding</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2060"></a>    <span class='Keyword'>static int</span>  <span class='Declare_Local'>encoding</span> <span class='Operator'>= -</span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2060"><span class='Ref_To_Local'>encoding</span></a> <span class='Operator'>== -</span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2060"><span class='Ref_To_Local'>encoding</span></a> <span class='Operator'>= </span><a href="../../../port/chklocale.c.html#LN273"><span class='Ref_to_Func'>pg_codepage_to_encoding</span></a><span class='Parentheses'>(</span>GetACP<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="elog.c.html#LN2060"><span class='Ref_To_Local'>encoding</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Write a message line to the windows event log 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2072"></a><span class='Declare_Function'>write_eventlog</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>line</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2074"></a>    WCHAR      <span class='Operator'>*</span><span class='Declare_Local'>utf16</span><span class='Delimiter'>; 
</span><a name="LN2075"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>eventlevel</span> <span class='Operator'>= </span>EVENTLOG_ERROR_TYPE<span class='Delimiter'>; 
</span><a name="LN2076"></a>    <span class='Keyword'>static </span>HANDLE <span class='Declare_Local'>evtHandle</span> <span class='Operator'>= </span>INVALID_HANDLE_VALUE<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2076"><span class='Ref_To_Local'>evtHandle</span></a> <span class='Operator'>== </span>INVALID_HANDLE_VALUE<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="elog.c.html#LN2076"><span class='Ref_To_Local'>evtHandle</span></a> <span class='Operator'>= </span>RegisterEventSource<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                         <a href="../../../bin/pgevent/pgevent.c.html#LN24"><span class='Ref_to_Global_Var'>event_source</span></a> <span class='Operator'>? </span><a href="../../../bin/pgevent/pgevent.c.html#LN24"><span class='Ref_to_Global_Var'>event_source</span></a> <span class='Operator'>: </span><a href="../../../include/pg_config_manual.h.html#LN188"><span class='Ref_to_Const'>DEFAULT_EVENT_SOURCE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2076"><span class='Ref_To_Local'>evtHandle</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="elog.c.html#LN2076"><span class='Ref_To_Local'>evtHandle</span></a> <span class='Operator'>= </span>INVALID_HANDLE_VALUE<span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2072"><span class='Ref_to_Parameter'>level</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN19"><span class='Ref_to_Const'>DEBUG5</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN21"><span class='Ref_to_Const'>DEBUG4</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN27"><span class='Ref_to_Const'>LOG_SERVER_ONLY</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN32"><span class='Ref_to_Const'>INFO</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN2075"><span class='Ref_To_Local'>eventlevel</span></a> <span class='Operator'>= </span>EVENTLOG_INFORMATION_TYPE<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN2075"><span class='Ref_To_Local'>eventlevel</span></a> <span class='Operator'>= </span>EVENTLOG_WARNING_TYPE<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Operator'>: 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="elog.c.html#LN2075"><span class='Ref_To_Local'>eventlevel</span></a> <span class='Operator'>= </span>EVENTLOG_ERROR_TYPE<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch level &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If message character encoding matches the encoding expected by 
     * ReportEventA(), call it to avoid the hazards of conversion.  Otherwise, 
     * try to convert the message to UTF16 and write it with ReportEventW(). 
     * Fall back on ReportEventA() if conversion failed. 
     * 
     * Also verify that we are not on our way into error recursion trouble due 
     * to error messages thrown deep inside pgwin32_message_to_UTF16(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/elog.h.html#LN402"><span class='Ref_to_Proto'>in_error_recursion_trouble</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>        <a href="../../../include/mb/pg_wchar.h.html#LN548"><span class='Ref_to_Proto'>GetMessageEncoding</span></a><span class='Parentheses'>() </span><span class='Operator'>!= </span><a href="elog.c.html#LN2057"><span class='Ref_to_Func'>GetACPEncoding</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <a href="elog.c.html#LN2074"><span class='Ref_To_Local'>utf16</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN619"><span class='Ref_to_Proto'>pgwin32_message_to_UTF16</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2072"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2072"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2074"><span class='Ref_To_Local'>utf16</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            ReportEventW<span class='Parentheses'>(</span><a href="elog.c.html#LN2076"><span class='Ref_To_Local'>evtHandle</span></a><span class='Delimiter'>, 
</span>                         <a href="elog.c.html#LN2075"><span class='Ref_To_Local'>eventlevel</span></a><span class='Delimiter'>, 
</span>                         <span class='Number'>0</span><span class='Delimiter'>, 
</span>                         <span class='Number'>0</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* All events are Id 0 */ 
</span>                         <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                         <span class='Number'>1</span><span class='Delimiter'>, 
</span>                         <span class='Number'>0</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span>LPCWSTR <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="elog.c.html#LN2074"><span class='Ref_To_Local'>utf16</span></a><span class='Delimiter'>, 
</span>                         <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* XXX Try ReportEventA() when ReportEventW() fails? */ 
</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2074"><span class='Ref_To_Local'>utf16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !in_error_recursion_t... &raquo; </span> 
    ReportEventA<span class='Parentheses'>(</span><a href="elog.c.html#LN2076"><span class='Ref_To_Local'>evtHandle</span></a><span class='Delimiter'>, 
</span>                 <a href="elog.c.html#LN2075"><span class='Ref_To_Local'>eventlevel</span></a><span class='Delimiter'>, 
</span>                 <span class='Number'>0</span><span class='Delimiter'>, 
</span>                 <span class='Number'>0</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* All events are Id 0 */ 
</span>                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                 <span class='Number'>1</span><span class='Delimiter'>, 
</span>                 <span class='Number'>0</span><span class='Delimiter'>, 
</span>                 <span class='Operator'>&</span><a href="elog.c.html#LN2072"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>, 
</span>                 <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end write_eventlog &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN2156"></a><span class='Declare_Function'>write_console</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>line</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2158"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
    <span class='Comment_Multi_Line'>/* 
     * Try to convert the message to UTF16 and write it with WriteConsoleW(). 
     * Fall back on write() if anything fails. 
     * 
     * In contrast to write_eventlog(), don't skip straight to write() based 
     * on the applicable encodings.  Unlike WriteConsoleW(), write() depends 
     * on the suitability of the console output code page.  Since we put 
     * stderr into binary mode in SubPostmasterMain(), write() skips the 
     * necessary translation anyway. 
     * 
     * WriteConsoleW() will fail if stderr is redirected, so just fall through 
     * to writing unconverted to the logfile in this case. 
     * 
     * Since we palloc the structure required for conversion, also fall 
     * through to writing unconverted if we have not yet set up 
     * CurrentMemoryContext. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/elog.h.html#LN402"><span class='Ref_to_Proto'>in_error_recursion_trouble</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../postmaster/postmaster.c.html#LN350"><span class='Ref_to_Global_Var'>redirection_done</span></a> <span class='Operator'>&& 
</span>        <a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2183"></a>        WCHAR      <span class='Operator'>*</span><span class='Declare_Local'>utf16</span><span class='Delimiter'>; 
</span><a name="LN2184"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>utf16len</span><span class='Delimiter'>; 
</span> 
        <a href="elog.c.html#LN2183"><span class='Ref_To_Local'>utf16</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN619"><span class='Ref_to_Proto'>pgwin32_message_to_UTF16</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2156"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2156"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="elog.c.html#LN2184"><span class='Ref_To_Local'>utf16len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2183"><span class='Ref_To_Local'>utf16</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2189"></a>            HANDLE      <span class='Declare_Local'>stdHandle</span><span class='Delimiter'>; 
</span><a name="LN2190"></a>            <span class='Keyword'>DWORD</span>       <span class='Declare_Local'>written</span><span class='Delimiter'>; 
</span> 
            <a href="elog.c.html#LN2189"><span class='Ref_To_Local'>stdHandle</span></a> <span class='Operator'>= </span>GetStdHandle<span class='Parentheses'>(</span>STD_ERROR_HANDLE<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>WriteConsoleW<span class='Parentheses'>(</span><a href="elog.c.html#LN2189"><span class='Ref_To_Local'>stdHandle</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2183"><span class='Ref_To_Local'>utf16</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2184"><span class='Ref_To_Local'>utf16len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="elog.c.html#LN2190"><span class='Ref_To_Local'>written</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2183"><span class='Ref_To_Local'>utf16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In case WriteConsoleW() failed, fall back to writing the 
             * message unconverted. 
             */ 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2183"><span class='Ref_To_Local'>utf16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !in_error_recursion_t... &raquo; </span> 
<span class='Directive'>#else</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Conversion on non-win32 platforms is not implemented yet. It requires 
     * non-throw version of pg_do_encoding_conversion(), that converts 
     * unconvertable characters to '?' without errors. 
     */ 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We ignore any error from write() here.  We have no useful way to report 
     * it ... certainly whining on stderr isn't likely to be productive. 
     */ 
</span>    <a href="elog.c.html#LN2158"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="../../../interfaces/libpq/win32.h.html#LN13"><span class='Ref_to_Macro'>write</span></a><span class='Parentheses'>(</span>fileno<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2156"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2156"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="elog.c.html#LN2158"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end write_console &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * setup formatted_log_time, for consistent times between CSV and regular logs 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2227"></a><span class='Declare_Function'>setup_formatted_log_time</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2229"></a>    <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>stamp_time</span><span class='Delimiter'>; 
</span><a name="LN2230"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>msbuf</span><span class='Delimiter'>[</span><span class='Number'>13</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="elog.c.html#LN150"><span class='Ref_to_Global_Var'>saved_timeval_set</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../port/gettimeofday.c.html#LN103"><span class='Ref_to_Func'>gettimeofday</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN149"><span class='Ref_to_Global_Var'>saved_timeval</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN150"><span class='Ref_to_Global_Var'>saved_timeval_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="elog.c.html#LN2229"><span class='Ref_To_Local'>stamp_time</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a><span class='Parentheses'>) </span><a href="elog.c.html#LN149"><span class='Ref_to_Global_Var'>saved_timeval</span></a><span class='Operator'>.</span>tv_sec<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: we expect that guc.c will ensure that log_timezone is set up (at 
     * least with a minimal GMT value) before Log_line_prefix can become 
     * nonempty or CSV mode can be selected. 
     */ 
</span>    <a href="../../../include/pgtime.h.html#LN67"><span class='Ref_to_Proto'>pg_strftime</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN154"><span class='Ref_to_Global_Var'>formatted_log_time</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN152"><span class='Ref_to_Const'>FORMATTED_TS_LEN</span></a><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* leave room for milliseconds... */ 
</span>                <span class='String'>"%Y-%m-%d %H:%M:%S     %Z"</span><span class='Delimiter'>, 
</span>                <a href="../../../include/pgtime.h.html#LN47"><span class='Ref_to_Proto'>pg_localtime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2229"><span class='Ref_To_Local'>stamp_time</span></a><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.c.html#LN30"><span class='Ref_to_Global_Var'>log_timezone</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 'paste' milliseconds into place... */ 
</span>    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2230"><span class='Ref_To_Local'>msbuf</span></a><span class='Delimiter'>, </span><span class='String'>".%03d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="elog.c.html#LN149"><span class='Ref_to_Global_Var'>saved_timeval</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="elog.c.html#LN154"><span class='Ref_to_Global_Var'>formatted_log_time</span></a> <span class='Operator'>+ </span><span class='Number'>19</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2230"><span class='Ref_To_Local'>msbuf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_formatted_log_time &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * setup formatted_start_time 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2259"></a><span class='Declare_Function'>setup_formatted_start_time</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2261"></a>    <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>stamp_time</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a><span class='Parentheses'>) </span><a href="../init/globals.c.html#LN39"><span class='Ref_to_Global_Var'>MyStartTime</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: we expect that guc.c will ensure that log_timezone is set up (at 
     * least with a minimal GMT value) before Log_line_prefix can become 
     * nonempty or CSV mode can be selected. 
     */ 
</span>    <a href="../../../include/pgtime.h.html#LN67"><span class='Ref_to_Proto'>pg_strftime</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN153"><span class='Ref_to_Global_Var'>formatted_start_time</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN152"><span class='Ref_to_Const'>FORMATTED_TS_LEN</span></a><span class='Delimiter'>, 
</span>                <span class='String'>"%Y-%m-%d %H:%M:%S %Z"</span><span class='Delimiter'>, 
</span>                <a href="../../../include/pgtime.h.html#LN47"><span class='Ref_to_Proto'>pg_localtime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2261"><span class='Ref_To_Local'>stamp_time</span></a><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.c.html#LN30"><span class='Ref_to_Global_Var'>log_timezone</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * process_log_prefix_padding --- helper function for processing the format 
 * string in log_line_prefix 
 * 
 * Note: This function returns NULL if it finds something which 
 * it deems invalid in the format string. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN2281"></a><span class='Declare_Function'>process_log_prefix_padding</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>p</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>ppadding</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2283"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>paddingsign</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN2284"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>padding</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN2281"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="elog.c.html#LN2281"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN2281"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span>         <span class='Comment_Single_Line'>/* Did the buf end in %- ? */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN2283"><span class='Ref_To_Local'>paddingsign</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* generate an int version of the numerical string */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN2281"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& *</span><a href="elog.c.html#LN2281"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2284"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN2284"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>* </span><span class='Number'>10</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN2281"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>++ - </span><span class='String'>'0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* format is invalid if it ends with the padding number */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN2281"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN2284"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>*= </span><a href="elog.c.html#LN2283"><span class='Ref_To_Local'>paddingsign</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="elog.c.html#LN2281"><span class='Ref_to_Parameter'>ppadding</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN2284"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="elog.c.html#LN2281"><span class='Ref_to_Parameter'>p</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end process_log_prefix_padding &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Format tag info for log lines; append to the provided buffer. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2312"></a><span class='Declare_Function'>log_line_prefix</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>edata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* static counter for line numbers */ 
</span><a name="LN2315"></a>    <span class='Keyword'>static long </span><span class='Declare_Local'>log_line_number</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* has counter been reset in current process? */ 
</span><a name="LN2318"></a>    <span class='Keyword'>static int</span>  <span class='Declare_Local'>log_my_pid</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2319"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>padding</span><span class='Delimiter'>; 
</span><a name="LN2320"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This is one of the few places where we'd rather not inherit a static 
     * variable's value from the postmaster.  But since we will, reset it when 
     * MyProcPid changes. MyStartTime also changes when MyProcPid does, so 
     * reset the formatted start timestamp too. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2318"><span class='Ref_To_Local'>log_my_pid</span></a> <span class='Operator'>!= </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="elog.c.html#LN2315"><span class='Ref_To_Local'>log_line_number</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN2318"><span class='Ref_To_Local'>log_my_pid</span></a> <span class='Operator'>= </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN153"><span class='Ref_to_Global_Var'>formatted_start_time</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="elog.c.html#LN2315"><span class='Ref_To_Local'>log_line_number</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN104"><span class='Ref_to_Global_Var'>Log_line_prefix</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* in case guc hasn't run yet */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN104"><span class='Ref_to_Global_Var'>Log_line_prefix</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'%'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* literal char, just copy */ 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* must be a '%', so skip to the next char */ 
</span>        <a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* format error - ignore it */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'%'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* string contains %% */ 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'%'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Process any formatting which may exist after the '%'.  Note that 
         * process_log_prefix_padding moves p past the padding number if it 
         * exists. 
         * 
         * Note: Since only '-', '0' to '9' are valid formatting characters we 
         * can do a quick check here to pre-check for formatting. If the char 
         * is not formatting then we can skip a useless function call. 
         * 
         * Further note: At least on some platforms, passing %*s rather than 
         * %s to appendStringInfo() is substantially slower, so many of the 
         * cases below avoid doing that unless non-zero padding is in fact 
         * specified. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&GT; </span><span class='String'>'9'</span><span class='Parentheses'>) 
</span>            <a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN2280"><span class='Ref_to_Func'>process_log_prefix_padding</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* process the option */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN2320"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'a'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2385"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>appname</span> <span class='Operator'>= </span><a href="../misc/guc.c.html#LN468"><span class='Ref_to_Global_Var'>application_name</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2385"><span class='Ref_To_Local'>appname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| *</span><a href="elog.c.html#LN2385"><span class='Ref_To_Local'>appname</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <a href="elog.c.html#LN2385"><span class='Ref_To_Local'>appname</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"[unknown]"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2385"><span class='Ref_To_Local'>appname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2385"><span class='Ref_To_Local'>appname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/lib/stringinfo.h.html#LN135"><span class='Ref_to_Proto'>appendStringInfoSpaces</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, 
</span>                                           <a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>: -</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'u'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2402"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>username</span> <span class='Operator'>= </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN136"><span class='Ref_to_Member'>user_name</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2402"><span class='Ref_To_Local'>username</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| *</span><a href="elog.c.html#LN2402"><span class='Ref_To_Local'>username</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <a href="elog.c.html#LN2402"><span class='Ref_To_Local'>username</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"[unknown]"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2402"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2402"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/lib/stringinfo.h.html#LN135"><span class='Ref_to_Proto'>appendStringInfoSpaces</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, 
</span>                                           <a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>: -</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2418"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>dbname</span> <span class='Operator'>= </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN135"><span class='Ref_to_Member'>database_name</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2418"><span class='Ref_To_Local'>dbname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| *</span><a href="elog.c.html#LN2418"><span class='Ref_To_Local'>dbname</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <a href="elog.c.html#LN2418"><span class='Ref_To_Local'>dbname</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"[unknown]"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2418"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2418"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/lib/stringinfo.h.html#LN135"><span class='Ref_to_Proto'>appendStringInfoSpaces</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, 
</span>                                           <a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>: -</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2434"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>strfbuf</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span> 
                    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2434"><span class='Ref_To_Local'>strfbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="elog.c.html#LN2434"><span class='Ref_To_Local'>strfbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"%lx.%x"</span><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="../init/globals.c.html#LN39"><span class='Ref_to_Global_Var'>MyStartTime</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2434"><span class='Ref_To_Local'>strfbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%lx.%x"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="../init/globals.c.html#LN39"><span class='Ref_to_Global_Var'>MyStartTime</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*d"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'l'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*ld"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2315"><span class='Ref_To_Local'>log_line_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%ld"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2315"><span class='Ref_To_Local'>log_line_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'m'</span><span class='Operator'>: 
</span>                <a href="elog.c.html#LN2226"><span class='Ref_to_Func'>setup_formatted_log_time</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN154"><span class='Ref_to_Global_Var'>formatted_log_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN154"><span class='Ref_to_Global_Var'>formatted_log_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2464"></a>                    <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>stamp_time</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a><span class='Parentheses'>) </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2465"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>strfbuf</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span> 
                    <a href="../../../include/pgtime.h.html#LN67"><span class='Ref_to_Proto'>pg_strftime</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2465"><span class='Ref_To_Local'>strfbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="elog.c.html#LN2465"><span class='Ref_To_Local'>strfbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <span class='String'>"%Y-%m-%d %H:%M:%S %Z"</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/pgtime.h.html#LN47"><span class='Ref_to_Proto'>pg_localtime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2464"><span class='Ref_To_Local'>stamp_time</span></a><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.c.html#LN30"><span class='Ref_to_Global_Var'>log_timezone</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2465"><span class='Ref_To_Local'>strfbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2465"><span class='Ref_To_Local'>strfbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2478"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>strfbuf</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="elog.c.html#LN150"><span class='Ref_to_Global_Var'>saved_timeval_set</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="../../../port/gettimeofday.c.html#LN103"><span class='Ref_to_Func'>gettimeofday</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN149"><span class='Ref_to_Global_Var'>saved_timeval</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="elog.c.html#LN150"><span class='Ref_to_Global_Var'>saved_timeval_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2478"><span class='Ref_To_Local'>strfbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="elog.c.html#LN2478"><span class='Ref_To_Local'>strfbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%ld.%03d"</span><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="elog.c.html#LN149"><span class='Ref_to_Global_Var'>saved_timeval</span></a><span class='Operator'>.</span>tv_sec<span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="elog.c.html#LN149"><span class='Ref_to_Global_Var'>saved_timeval</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2478"><span class='Ref_To_Local'>strfbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2478"><span class='Ref_To_Local'>strfbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN153"><span class='Ref_to_Global_Var'>formatted_start_time</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                    <a href="elog.c.html#LN2258"><span class='Ref_to_Func'>setup_formatted_start_time</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN153"><span class='Ref_to_Global_Var'>formatted_start_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN153"><span class='Ref_to_Global_Var'>formatted_start_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'i'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2507"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>psdisp</span><span class='Delimiter'>; 
</span><a name="LN2508"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>displen</span><span class='Delimiter'>; 
</span> 
                    <a href="elog.c.html#LN2507"><span class='Ref_To_Local'>psdisp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/ps_status.h.html#LN23"><span class='Ref_to_Proto'>get_ps_display</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2508"><span class='Ref_To_Local'>displen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2507"><span class='Ref_To_Local'>psdisp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2507"><span class='Ref_To_Local'>psdisp</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2508"><span class='Ref_To_Local'>displen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/lib/stringinfo.h.html#LN135"><span class='Ref_to_Proto'>appendStringInfoSpaces</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, 
</span>                                           <a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>: -</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'r'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a> <span class='Operator'>&& </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN122"><span class='Ref_to_Member'>remote_host</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a> <span class='Operator'>&& </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * This option is slightly special as the port 
                             * number may be appended onto the end. Here we 
                             * need to build 1 string which contains the 
                             * remote_host and optionally the remote_port (if 
                             * set) so we can properly align the string. 
                             */ 
</span> 
<a name="LN2536"></a>                            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>hostport</span><span class='Delimiter'>; 
</span> 
                            <a href="elog.c.html#LN2536"><span class='Ref_To_Local'>hostport</span></a> <span class='Operator'>= </span><a href="../../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s(%s)"</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN122"><span class='Ref_to_Member'>remote_host</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2536"><span class='Ref_To_Local'>hostport</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2536"><span class='Ref_To_Local'>hostport</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN122"><span class='Ref_to_Member'>remote_host</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if padding!=0 &raquo; </span> 
                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* padding is 0, so we don't need a temp buffer */ 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN122"><span class='Ref_to_Member'>remote_host</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a> <span class='Operator'>&& 
</span>                            <a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"(%s)"</span><span class='Delimiter'>, 
</span>                                             <a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if MyProcPort&&MyProcPor... &raquo; </span> 
                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/lib/stringinfo.h.html#LN135"><span class='Ref_to_Proto'>appendStringInfoSpaces</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, 
</span>                                           <a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>: -</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'h'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a> <span class='Operator'>&& </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN122"><span class='Ref_to_Member'>remote_host</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN122"><span class='Ref_to_Member'>remote_host</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN122"><span class='Ref_to_Member'>remote_host</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/lib/stringinfo.h.html#LN135"><span class='Ref_to_Proto'>appendStringInfoSpaces</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, 
</span>                                           <a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>: -</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'q'</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* in postmaster and friends, stop if %q is seen */ 
</span>                <span class='Comment_Multi_Line'>/* in a backend, just ignore */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'v'</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* keep VXID format in sync with lockfuncs.c */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN111"><span class='Ref_to_Member'>backendId</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN2584"></a>                        <span class='Keyword'>char</span>        <span class='Declare_Local'>strfbuf</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span> 
                        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2584"><span class='Ref_To_Local'>strfbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="elog.c.html#LN2584"><span class='Ref_To_Local'>strfbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"%d/%u"</span><span class='Delimiter'>, 
</span>                                 <a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN111"><span class='Ref_to_Member'>backendId</span></a><span class='Delimiter'>, </span><a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN104"><span class='Ref_to_Member'>lxid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2584"><span class='Ref_To_Local'>strfbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%d/%u"</span><span class='Delimiter'>, </span><a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN111"><span class='Ref_to_Member'>backendId</span></a><span class='Delimiter'>, </span><a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN104"><span class='Ref_to_Member'>lxid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/lib/stringinfo.h.html#LN135"><span class='Ref_to_Proto'>appendStringInfoSpaces</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, 
</span>                                           <a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>: -</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'x'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*u"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xact.h.html#LN332"><span class='Ref_to_Proto'>GetTopTransactionIdIfAny</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%u"</span><span class='Delimiter'>, </span><a href="../../../include/access/xact.h.html#LN332"><span class='Ref_to_Proto'>GetTopTransactionIdIfAny</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'e'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%*s"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2319"><span class='Ref_To_Local'>padding</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN401"><span class='Ref_to_Proto'>unpack_sql_state</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN401"><span class='Ref_to_Proto'>unpack_sql_state</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2312"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* format error - ignore it */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch *p &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for p=Log_line_prefix;*p!... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end log_line_prefix &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * append a CSV'd version of a string to a StringInfo 
 * We use the PostgreSQL defaults for CSV, i.e. quote = escape = '"' 
 * If it's NULL, append nothing. 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN2622"></a><span class='Declare_Function'>appendCSVLiteral</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2624"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="elog.c.html#LN2622"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>; 
</span><a name="LN2625"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* avoid confusing an empty string with NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2624"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2622"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="elog.c.html#LN2625"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="elog.c.html#LN2624"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2625"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2622"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2622"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2625"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2622"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Constructs the error message, depending on the Errordata it gets, in a CSV 
 * format which is described in doc/src/sgml/config.sgml. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2646"></a><span class='Declare_Function'>write_csvlog</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>edata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2648"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN2649"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>print_stmt</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* static counter for line numbers */ 
</span><a name="LN2652"></a>    <span class='Keyword'>static long </span><span class='Declare_Local'>log_line_number</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* has counter been reset in current process? */ 
</span><a name="LN2655"></a>    <span class='Keyword'>static int</span>  <span class='Declare_Local'>log_my_pid</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This is one of the few places where we'd rather not inherit a static 
     * variable's value from the postmaster.  But since we will, reset it when 
     * MyProcPid changes. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2655"><span class='Ref_To_Local'>log_my_pid</span></a> <span class='Operator'>!= </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="elog.c.html#LN2652"><span class='Ref_To_Local'>log_line_number</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN2655"><span class='Ref_To_Local'>log_my_pid</span></a> <span class='Operator'>= </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN153"><span class='Ref_to_Global_Var'>formatted_start_time</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="elog.c.html#LN2652"><span class='Ref_To_Local'>log_line_number</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * timestamp with milliseconds 
     * 
     * Check if the timestamp is already calculated for the syslog message, 
     * and use it if so.  Otherwise, get the current timestamp.  This is done 
     * to put same timestamp in both syslog and csvlog messages. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN154"><span class='Ref_to_Global_Var'>formatted_log_time</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2226"><span class='Ref_to_Func'>setup_formatted_log_time</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN154"><span class='Ref_to_Global_Var'>formatted_log_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* username */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN136"><span class='Ref_to_Member'>user_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* database name */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN135"><span class='Ref_to_Member'>database_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process id  */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remote host and port */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a> <span class='Operator'>&& </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN122"><span class='Ref_to_Member'>remote_host</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN122"><span class='Ref_to_Member'>remote_host</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a> <span class='Operator'>&& </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>':'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN127"><span class='Ref_to_Member'>remote_port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* session id */ 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%lx.%x"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="../init/globals.c.html#LN39"><span class='Ref_to_Global_Var'>MyStartTime</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Line number */ 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%ld"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2652"><span class='Ref_To_Local'>log_line_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* PS display */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2725"></a>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>msgbuf</span><span class='Delimiter'>; 
</span><a name="LN2726"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>psdisp</span><span class='Delimiter'>; 
</span><a name="LN2727"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>displen</span><span class='Delimiter'>; 
</span> 
        <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2725"><span class='Ref_To_Local'>msgbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="elog.c.html#LN2726"><span class='Ref_To_Local'>psdisp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/ps_status.h.html#LN23"><span class='Ref_to_Proto'>get_ps_display</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2727"><span class='Ref_To_Local'>displen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2725"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2726"><span class='Ref_To_Local'>psdisp</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2727"><span class='Ref_To_Local'>displen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2725"><span class='Ref_To_Local'>msgbuf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2725"><span class='Ref_To_Local'>msgbuf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* session start timestamp */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN153"><span class='Ref_to_Global_Var'>formatted_start_time</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2258"><span class='Ref_to_Func'>setup_formatted_start_time</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN153"><span class='Ref_to_Global_Var'>formatted_start_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Virtual transaction id */ 
</span>    <span class='Comment_Multi_Line'>/* keep VXID format in sync with lockfuncs.c */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN111"><span class='Ref_to_Member'>backendId</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%d/%u"</span><span class='Delimiter'>, </span><a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN111"><span class='Ref_to_Member'>backendId</span></a><span class='Delimiter'>, </span><a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN104"><span class='Ref_to_Member'>lxid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Transaction id */ 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%u"</span><span class='Delimiter'>, </span><a href="../../../include/access/xact.h.html#LN332"><span class='Ref_to_Proto'>GetTopTransactionIdIfAny</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Error severity */ 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="elog.c.html#LN3599"><span class='Ref_to_Func'>error_severity</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* SQL state code */ 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN401"><span class='Ref_to_Proto'>unpack_sql_state</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* errmessage */ 
</span>    <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* errdetail or errdetail_log */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* errhint */ 
</span>    <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* internal query */ 
</span>    <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if printed internal query, print internal pos too */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* errcontext */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN335"><span class='Ref_to_Member'>hide_ctx</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* user query --- only reported if not disabled by the caller */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3715"><span class='Ref_to_Func'>is_log_level_output</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Delimiter'>, </span><a href="../misc/guc.c.html#LN449"><span class='Ref_to_Global_Var'>log_min_error_statement</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="../../tcop/postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN334"><span class='Ref_to_Member'>hide_stmt</span></a><span class='Parentheses'>)</span> 
        <a href="elog.c.html#LN2649"><span class='Ref_To_Local'>print_stmt</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2649"><span class='Ref_To_Local'>print_stmt</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../tcop/postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2649"><span class='Ref_To_Local'>print_stmt</span></a> <span class='Operator'>&& </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* file error location */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN103"><span class='Ref_to_Global_Var'>Log_error_verbosity</span></a> <span class='Operator'>&GT;= </span>PGERROR_VERBOSE<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2807"></a>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>msgbuf</span><span class='Delimiter'>; 
</span> 
        <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2807"><span class='Ref_To_Local'>msgbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>&& </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2807"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><span class='String'>"%s, %s:%d"</span><span class='Delimiter'>, 
</span>                             <a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, 
</span>                             <a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2807"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><span class='String'>"%s:%d"</span><span class='Delimiter'>, 
</span>                             <a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2646"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2807"><span class='Ref_To_Local'>msgbuf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2807"><span class='Ref_To_Local'>msgbuf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* application name */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../misc/guc.c.html#LN468"><span class='Ref_to_Global_Var'>application_name</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN2621"><span class='Ref_to_Func'>appendCSVLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../misc/guc.c.html#LN468"><span class='Ref_to_Global_Var'>application_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If in the syslogger process, try to write messages direct to file */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../postmaster/syslogger.c.html#LN73"><span class='Ref_to_Global_Var'>am_syslogger</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/postmaster/syslogger.h.html#LN83"><span class='Ref_to_Proto'>write_syslogger_file</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN397"><span class='Ref_to_Const'>LOG_DESTINATION_CSVLOG</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="elog.c.html#LN3089"><span class='Ref_to_Func'>write_pipe_chunks</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN397"><span class='Ref_to_Const'>LOG_DESTINATION_CSVLOG</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2648"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end write_csvlog &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Unpack MAKE_SQLSTATE code. Note that this returns a pointer to a 
 * static buffer. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN2843"></a><span class='Declare_Function'>unpack_sql_state</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>sql_state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2845"></a>    <span class='Keyword'>static char </span><span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>12</span><span class='Delimiter'>]; 
</span><a name="LN2846"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2846"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="elog.c.html#LN2846"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>5</span><span class='Delimiter'>; </span><a href="elog.c.html#LN2846"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="elog.c.html#LN2845"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN2846"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/elog.h.html#LN59"><span class='Ref_to_Macro'>PGUNSIXBIT</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2843"><span class='Ref_to_Parameter'>sql_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN2843"><span class='Ref_to_Parameter'>sql_state</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>6</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="elog.c.html#LN2845"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN2846"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="elog.c.html#LN2845"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write error report to server's log 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2863"></a><span class='Declare_Function'>send_message_to_server_log</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>edata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2865"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN150"><span class='Ref_to_Global_Var'>saved_timeval_set</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN154"><span class='Ref_to_Global_Var'>formatted_log_time</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN2311"><span class='Ref_to_Func'>log_line_prefix</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%s:  "</span><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="elog.c.html#LN3599"><span class='Ref_to_Func'>error_severity</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN103"><span class='Ref_to_Global_Var'>Log_error_verbosity</span></a> <span class='Operator'>&GT;= </span>PGERROR_VERBOSE<span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%s: "</span><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN401"><span class='Ref_to_Proto'>unpack_sql_state</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN3650"><span class='Ref_to_Func'>append_with_tabs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="elog.c.html#LN3650"><span class='Ref_to_Func'>append_with_tabs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"missing error text"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>" at character %d"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>" at character %d"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN103"><span class='Ref_to_Global_Var'>Log_error_verbosity</span></a> <span class='Operator'>&GT;= </span>PGERROR_DEFAULT<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="elog.c.html#LN2311"><span class='Ref_to_Func'>log_line_prefix</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"DETAIL:  "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3650"><span class='Ref_to_Func'>append_with_tabs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN344"><span class='Ref_to_Member'>detail_log</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="elog.c.html#LN2311"><span class='Ref_to_Func'>log_line_prefix</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"DETAIL:  "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3650"><span class='Ref_to_Func'>append_with_tabs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="elog.c.html#LN2311"><span class='Ref_to_Func'>log_line_prefix</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"HINT:  "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3650"><span class='Ref_to_Func'>append_with_tabs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="elog.c.html#LN2311"><span class='Ref_to_Func'>log_line_prefix</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"QUERY:  "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3650"><span class='Ref_to_Func'>append_with_tabs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>&& !</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN335"><span class='Ref_to_Member'>hide_ctx</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="elog.c.html#LN2311"><span class='Ref_to_Func'>log_line_prefix</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"CONTEXT:  "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3650"><span class='Ref_to_Func'>append_with_tabs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN103"><span class='Ref_to_Global_Var'>Log_error_verbosity</span></a> <span class='Operator'>&GT;= </span>PGERROR_VERBOSE<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* assume no newlines in funcname or filename... */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>&& </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="elog.c.html#LN2311"><span class='Ref_to_Func'>log_line_prefix</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"LOCATION:  %s, %s:%d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, 
</span>                                 <a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="elog.c.html#LN2311"><span class='Ref_to_Func'>log_line_prefix</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"LOCATION:  %s:%d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if Log_error_verbosity&GT;=... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If the user wants the query that generated this error logged, do it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3715"><span class='Ref_to_Func'>is_log_level_output</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Delimiter'>, </span><a href="../misc/guc.c.html#LN449"><span class='Ref_to_Global_Var'>log_min_error_statement</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="../../tcop/postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN334"><span class='Ref_to_Member'>hide_stmt</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="elog.c.html#LN2311"><span class='Ref_to_Func'>log_line_prefix</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"STATEMENT:  "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN3650"><span class='Ref_to_Func'>append_with_tabs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../tcop/postgres.c.html#LN84"><span class='Ref_to_Global_Var'>debug_query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> HAVE_SYSLOG 
    <span class='Comment_Multi_Line'>/* Write to syslog, if enabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN105"><span class='Ref_to_Global_Var'>Log_destination</span></a> <span class='Operator'>& </span><a href="../../../include/utils/elog.h.html#LN395"><span class='Ref_to_Const'>LOG_DESTINATION_SYSLOG</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2965"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>syslog_level</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN19"><span class='Ref_to_Const'>DEBUG5</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN21"><span class='Ref_to_Const'>DEBUG4</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Operator'>: 
</span>                <a href="elog.c.html#LN2965"><span class='Ref_To_Local'>syslog_level</span></a> <span class='Operator'>= </span>LOG_DEBUG<span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN27"><span class='Ref_to_Const'>LOG_SERVER_ONLY</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN32"><span class='Ref_to_Const'>INFO</span></a><span class='Operator'>: 
</span>                <a href="elog.c.html#LN2965"><span class='Ref_To_Local'>syslog_level</span></a> <span class='Operator'>= </span>LOG_INFO<span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Operator'>: 
</span>                <a href="elog.c.html#LN2965"><span class='Ref_To_Local'>syslog_level</span></a> <span class='Operator'>= </span>LOG_NOTICE<span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Operator'>: 
</span>                <a href="elog.c.html#LN2965"><span class='Ref_To_Local'>syslog_level</span></a> <span class='Operator'>= </span>LOG_WARNING<span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Operator'>: 
</span>                <a href="elog.c.html#LN2965"><span class='Ref_To_Local'>syslog_level</span></a> <span class='Operator'>= </span>LOG_ERR<span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Operator'>: 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="elog.c.html#LN2965"><span class='Ref_To_Local'>syslog_level</span></a> <span class='Operator'>= </span>LOG_CRIT<span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch edata-&GT;elevel &raquo; </span> 
 
        <a href="elog.c.html#LN127"><span class='Ref_to_Proto'>write_syslog</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2965"><span class='Ref_To_Local'>syslog_level</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if Log_destination&LOG_D... &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_SYSLOG */ 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Comment_Multi_Line'>/* Write to eventlog, if enabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN105"><span class='Ref_to_Global_Var'>Log_destination</span></a> <span class='Operator'>& </span><a href="../../../include/utils/elog.h.html#LN396"><span class='Ref_to_Const'>LOG_DESTINATION_EVENTLOG</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="elog.c.html#LN133"><span class='Ref_to_Proto'>write_eventlog</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
    <span class='Comment_Multi_Line'>/* Write to stderr, if enabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="elog.c.html#LN105"><span class='Ref_to_Global_Var'>Log_destination</span></a> <span class='Operator'>& </span><a href="../../../include/utils/elog.h.html#LN394"><span class='Ref_to_Const'>LOG_DESTINATION_STDERR</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../../include/tcop/dest.h.html#LN88"><span class='Ref_to_EnumConst'>DestDebug</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Use the chunking protocol if we know the syslogger should be 
         * catching stderr output, and we are not ourselves the syslogger. 
         * Otherwise, just do a vanilla write to stderr. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../postmaster/postmaster.c.html#LN350"><span class='Ref_to_Global_Var'>redirection_done</span></a> <span class='Operator'>&& !</span><a href="../../postmaster/syslogger.c.html#LN73"><span class='Ref_to_Global_Var'>am_syslogger</span></a><span class='Parentheses'>) 
</span>            <a href="elog.c.html#LN3089"><span class='Ref_to_Func'>write_pipe_chunks</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN394"><span class='Ref_to_Const'>LOG_DESTINATION_STDERR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
        <span class='Comment_Multi_Line'>/* 
         * In a win32 service environment, there is no usable stderr. Capture 
         * anything going there and write it to the eventlog instead. 
         * 
         * If stderr redirection is active, it was OK to write to stderr above 
         * because that's really a pipe to the syslogger process. 
         */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/win32security.c.html#LN115"><span class='Ref_to_Func'>pgwin32_is_service</span></a><span class='Parentheses'>())</span> 
            <a href="elog.c.html#LN133"><span class='Ref_to_Proto'>write_eventlog</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>else</span> 
            <a href="elog.c.html#LN2155"><span class='Ref_to_Func'>write_console</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (Log_destination&LOG_... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* If in the syslogger process, try to write messages direct to file */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../postmaster/syslogger.c.html#LN73"><span class='Ref_to_Global_Var'>am_syslogger</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/postmaster/syslogger.h.html#LN83"><span class='Ref_to_Proto'>write_syslogger_file</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN394"><span class='Ref_to_Const'>LOG_DESTINATION_STDERR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Write to CSV log if enabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN105"><span class='Ref_to_Global_Var'>Log_destination</span></a> <span class='Operator'>& </span><a href="../../../include/utils/elog.h.html#LN397"><span class='Ref_to_Const'>LOG_DESTINATION_CSVLOG</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../postmaster/postmaster.c.html#LN350"><span class='Ref_to_Global_Var'>redirection_done</span></a> <span class='Operator'>|| </span><a href="../../postmaster/syslogger.c.html#LN73"><span class='Ref_to_Global_Var'>am_syslogger</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * send CSV data if it's safe to do so (syslogger doesn't need the 
             * pipe). First get back the space in the message buffer. 
             */ 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN2645"><span class='Ref_to_Func'>write_csvlog</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2863"><span class='Ref_to_Parameter'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * syslogger not up (yet), so just dump the message to stderr, 
             * unless we already did so above. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="elog.c.html#LN105"><span class='Ref_to_Global_Var'>Log_destination</span></a> <span class='Operator'>& </span><a href="../../../include/utils/elog.h.html#LN394"><span class='Ref_to_Const'>LOG_DESTINATION_STDERR</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <a href="../../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>!= </span><a href="../../../include/tcop/dest.h.html#LN88"><span class='Ref_to_EnumConst'>DestDebug</span></a><span class='Parentheses'>)</span> 
                <a href="elog.c.html#LN2155"><span class='Ref_to_Func'>write_console</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if Log_destination&LOG_D... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN2865"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end send_message_to_server_log &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Send data to the syslogger using the chunked protocol 
 * 
 * Note: when there are multiple backends writing into the syslogger pipe, 
 * it's critical that each write go into the pipe indivisibly, and not 
 * get interleaved with data from other processes.  Fortunately, the POSIX 
 * spec requires that writes to pipes be atomic so long as they are not 
 * more than PIPE_BUF bytes long.  So we divide long messages into chunks 
 * that are no more than that length, and send one chunk per write() call. 
 * The collector process knows how to reassemble the chunks. 
 * 
 * Because of the atomic write requirement, there are only two possible 
 * results from write() here: -1 for failure, or the requested number of 
 * bytes.  There is not really anything we can do about a failure; retry would 
 * probably be an infinite loop, and we can't even report the error usefully. 
 * (There is noplace else we could send it!)  So we might as well just ignore 
 * the result from write().  However, on some platforms you get a compiler 
 * warning from ignoring write()'s result, so do a little dance with casting 
 * rc to void to shut up the compiler. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3090"></a><span class='Declare_Function'>write_pipe_chunks</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3092"></a>    <a href="../../../include/postmaster/syslogger.h.html#LN53"><span class='Ref_to_Typedef'>PipeProtoChunk</span></a> <span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN3093"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fd</span> <span class='Operator'>= </span>fileno<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3094"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN55"><span class='Ref_to_Member'>proto</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN45"><span class='Ref_to_Member'>nuls</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN55"><span class='Ref_to_Member'>proto</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN45"><span class='Ref_to_Member'>nuls</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN55"><span class='Ref_to_Member'>proto</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN47"><span class='Ref_to_Member'>pid</span></a> <span class='Operator'>= </span><a href="../init/globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* write all but the last chunk */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><a href="../../../include/postmaster/syslogger.h.html#LN60"><span class='Ref_to_Const'>PIPE_MAX_PAYLOAD</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN55"><span class='Ref_to_Member'>proto</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN48"><span class='Ref_to_Member'>is_last</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>dest</span></a> <span class='Operator'>== </span><a href="../../../include/utils/elog.h.html#LN397"><span class='Ref_to_Const'>LOG_DESTINATION_CSVLOG</span></a> <span class='Operator'>? </span><span class='String'>'F'</span> <span class='Operator'>: </span><span class='String'>'f'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN55"><span class='Ref_to_Member'>proto</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postmaster/syslogger.h.html#LN60"><span class='Ref_to_Const'>PIPE_MAX_PAYLOAD</span></a><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN55"><span class='Ref_to_Member'>proto</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN50"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="../../../include/postmaster/syslogger.h.html#LN60"><span class='Ref_to_Const'>PIPE_MAX_PAYLOAD</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN3094"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="../../../interfaces/libpq/win32.h.html#LN13"><span class='Ref_to_Macro'>write</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3093"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="../../../include/postmaster/syslogger.h.html#LN59"><span class='Ref_to_Const'>PIPE_HEADER_SIZE</span></a> <span class='Operator'>+ </span><a href="../../../include/postmaster/syslogger.h.html#LN60"><span class='Ref_to_Const'>PIPE_MAX_PAYLOAD</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="elog.c.html#LN3094"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>+= </span><a href="../../../include/postmaster/syslogger.h.html#LN60"><span class='Ref_to_Const'>PIPE_MAX_PAYLOAD</span></a><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>-= </span><a href="../../../include/postmaster/syslogger.h.html#LN60"><span class='Ref_to_Const'>PIPE_MAX_PAYLOAD</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* write the last chunk */ 
</span>    <a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN55"><span class='Ref_to_Member'>proto</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN48"><span class='Ref_to_Member'>is_last</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>dest</span></a> <span class='Operator'>== </span><a href="../../../include/utils/elog.h.html#LN397"><span class='Ref_to_Const'>LOG_DESTINATION_CSVLOG</span></a> <span class='Operator'>? </span><span class='String'>'T'</span> <span class='Operator'>: </span><span class='String'>'t'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN55"><span class='Ref_to_Member'>proto</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN55"><span class='Ref_to_Member'>proto</span></a><span class='Operator'>.</span><a href="../../../include/postmaster/syslogger.h.html#LN50"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="elog.c.html#LN3094"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="../../../interfaces/libpq/win32.h.html#LN13"><span class='Ref_to_Macro'>write</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3093"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="elog.c.html#LN3092"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="../../../include/postmaster/syslogger.h.html#LN59"><span class='Ref_to_Const'>PIPE_HEADER_SIZE</span></a> <span class='Operator'>+ </span><a href="elog.c.html#LN3090"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="elog.c.html#LN3094"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end write_pipe_chunks &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Append a text string to the error report being built for the client. 
 * 
 * This is ordinarily identical to pq_sendstring(), but if we are in 
 * error recursion trouble we skip encoding conversion, because of the 
 * possibility that the problem is a failure in the encoding conversion 
 * subsystem itself.  Code elsewhere should ensure that the passed-in 
 * strings will be plain 7-bit ASCII, and thus not in need of conversion, 
 * in such cases.  (In particular, we disable localization of error messages 
 * to help ensure that's true.) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3134"></a><span class='Declare_Function'>err_sendstring</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN402"><span class='Ref_to_Proto'>in_error_recursion_trouble</span></a><span class='Parentheses'>())</span> 
        <a href="../../../include/libpq/pqformat.h.html#LN24"><span class='Ref_to_Proto'>pq_send_ascii_string</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3134"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3134"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/libpq/pqformat.h.html#LN23"><span class='Ref_to_Proto'>pq_sendstring</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3134"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3134"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Write error report to client 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3146"></a><span class='Declare_Function'>send_message_to_frontend</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>edata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3148"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>msgbuf</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 'N' (Notice) is for nonfatal conditions, 'E' is for errors */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN17"><span class='Ref_to_Proto'>pq_beginmessage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a> <span class='Operator'>&LT; </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>'N'</span> <span class='Operator'>: </span><span class='String'>'E'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* New style with separate fields */ 
</span><a name="LN3156"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>sev</span><span class='Delimiter'>; 
</span><a name="LN3157"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>tbuf</span><span class='Delimiter'>[</span><span class='Number'>12</span><span class='Delimiter'>]; 
</span><a name="LN3158"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ssval</span><span class='Delimiter'>; 
</span><a name="LN3159"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="elog.c.html#LN3156"><span class='Ref_To_Local'>sev</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN3599"><span class='Ref_to_Func'>error_severity</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN54"><span class='Ref_to_Const'>PG_DIAG_SEVERITY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="elog.c.html#LN3156"><span class='Ref_To_Local'>sev</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN55"><span class='Ref_to_Const'>PG_DIAG_SEVERITY_NONLOCALIZED</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3156"><span class='Ref_To_Local'>sev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* unpack MAKE_SQLSTATE code */ 
</span>        <a href="elog.c.html#LN3158"><span class='Ref_To_Local'>ssval</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3159"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="elog.c.html#LN3159"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>5</span><span class='Delimiter'>; </span><a href="elog.c.html#LN3159"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN3159"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/elog.h.html#LN59"><span class='Ref_to_Macro'>PGUNSIXBIT</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3158"><span class='Ref_To_Local'>ssval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3158"><span class='Ref_To_Local'>ssval</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>6</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Delimiter'>[</span><a href="elog.c.html#LN3159"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN56"><span class='Ref_to_Const'>PG_DIAG_SQLSTATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* M field is required per protocol, so always send something */ 
</span>        <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN57"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_PRIMARY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>) 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"missing error text"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN58"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_DETAIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* detail_log is intentionally not used here */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN59"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_HINT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN63"><span class='Ref_to_Const'>PG_DIAG_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN64"><span class='Ref_to_Const'>PG_DIAG_SCHEMA_NAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN65"><span class='Ref_to_Const'>PG_DIAG_TABLE_NAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN66"><span class='Ref_to_Const'>PG_DIAG_COLUMN_NAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN67"><span class='Ref_to_Const'>PG_DIAG_DATATYPE_NAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN68"><span class='Ref_to_Const'>PG_DIAG_CONSTRAINT_NAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN60"><span class='Ref_to_Const'>PG_DIAG_STATEMENT_POSITION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN61"><span class='Ref_to_Const'>PG_DIAG_INTERNAL_POSITION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN62"><span class='Ref_to_Const'>PG_DIAG_INTERNAL_QUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN355"><span class='Ref_to_Member'>internalquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN69"><span class='Ref_to_Const'>PG_DIAG_SOURCE_FILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN336"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN337"><span class='Ref_to_Member'>lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN70"><span class='Ref_to_Const'>PG_DIAG_SOURCE_LINE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3157"><span class='Ref_To_Local'>tbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN71"><span class='Ref_to_Const'>PG_DIAG_SOURCE_FUNCTION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* terminator */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if PG_PROTOCOL_MAJOR(Fro... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Old style --- gin up a backwards-compatible message */ 
</span><a name="LN3280"></a>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
        <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3280"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3280"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%s:  "</span><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="elog.c.html#LN3599"><span class='Ref_to_Func'>error_severity</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN330"><span class='Ref_to_Member'>elevel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN333"><span class='Ref_to_Member'>show_funcname</span></a> <span class='Operator'>&& </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3280"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%s: "</span><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN338"><span class='Ref_to_Member'>funcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3280"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3280"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"missing error text"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3280"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>" at character %d"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN353"><span class='Ref_to_Member'>cursorpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3280"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>" at character %d"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="elog.c.html#LN3146"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN354"><span class='Ref_to_Member'>internalpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3280"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="elog.c.html#LN3133"><span class='Ref_to_Func'>err_sendstring</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3280"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3280"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/libpq/pqformat.h.html#LN29"><span class='Ref_to_Proto'>pq_endmessage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3148"><span class='Ref_To_Local'>msgbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This flush is normally not necessary, since postgres.c will flush out 
     * waiting data when control returns to the main loop. But it seems best 
     * to leave it here, so that the client has some clue what happened if the 
     * backend dies before getting back to the main loop ... error/notice 
     * messages should not be a performance-critical path anyway, so an extra 
     * flush won't hurt much ... 
     */ 
</span>    <a href="../../../include/libpq/libpq.h.html#LN38"><span class='Ref_to_Macro'>pq_flush</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end send_message_to_frontend &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Support routines for formatting error messages. 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * expand_fmt_string --- process special format codes in a format string 
 * 
 * We must replace %m with the appropriate strerror string, since vsnprintf 
 * won't know what to do with it. 
 * 
 * The result is a palloc'd string. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN3336"></a><span class='Declare_Function'>expand_fmt_string</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>, </span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>edata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3338"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN3339"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3338"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3339"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN3336"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="elog.c.html#LN3339"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>; </span><a href="elog.c.html#LN3339"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3339"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'%'</span> <span class='Operator'>&& </span><a href="elog.c.html#LN3339"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="elog.c.html#LN3339"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN3339"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'m'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Replace %m by system error string.  If there are any %'s in 
                 * the string, we'd better double them so that vsnprintf won't 
                 * misinterpret. 
                 */ 
</span><a name="LN3355"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>cp2</span><span class='Delimiter'>; 
</span> 
                <a href="elog.c.html#LN3355"><span class='Ref_To_Local'>cp2</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN3383"><span class='Ref_to_Func'>useful_strerror</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3336"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN356"><span class='Ref_to_Member'>saved_errno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="elog.c.html#LN3355"><span class='Ref_To_Local'>cp2</span></a><span class='Delimiter'>; </span><a href="elog.c.html#LN3355"><span class='Ref_To_Local'>cp2</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="elog.c.html#LN3355"><span class='Ref_To_Local'>cp2</span></a> <span class='Operator'>== </span><span class='String'>'%'</span><span class='Parentheses'>) 
</span>                        <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3338"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'%'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3338"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="elog.c.html#LN3355"><span class='Ref_To_Local'>cp2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* copy % and next char --- this avoids trouble with %%m */ 
</span>                <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3338"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'%'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3338"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="elog.c.html#LN3339"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cp[0]=='%'&&cp[1]!='\... &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="elog.c.html#LN3338"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="elog.c.html#LN3339"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for cp=fmt;*cp;cp++ &raquo; </span> 
 
    <span class='Control'>return</span> <a href="elog.c.html#LN3338"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end expand_fmt_string &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * A slightly cleaned-up version of strerror() 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN3384"></a><span class='Declare_Function'>useful_strerror</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>errnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* this buffer is only used if strerror() and get_errno_symbol() fail */ 
</span><a name="LN3387"></a>    <span class='Keyword'>static char </span><span class='Declare_Local'>errorstr_buf</span><span class='Delimiter'>[</span><span class='Number'>48</span><span class='Delimiter'>]; 
</span><a name="LN3388"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Comment_Multi_Line'>/* Winsock error code range, per WinError.h */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3384"><span class='Ref_to_Parameter'>errnum</span></a> <span class='Operator'>&GT;= </span><span class='Number'>10000</span> <span class='Operator'>&& </span><a href="elog.c.html#LN3384"><span class='Ref_to_Parameter'>errnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>11999</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/port/win32.h.html#LN386"><span class='Ref_to_Proto'>pgwin32_socket_strerror</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3384"><span class='Ref_to_Parameter'>errnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <a href="elog.c.html#LN3388"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3384"><span class='Ref_to_Parameter'>errnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Some strerror()s return an empty string for out-of-range errno.  This 
     * is ANSI C spec compliant, but not exactly useful.  Also, we may get 
     * back strings of question marks if libc cannot transcode the message to 
     * the codeset specified by LC_CTYPE.  If we get nothing useful, first try 
     * get_errno_symbol(), and if that fails, print the numeric errno. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3388"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| *</span><a href="elog.c.html#LN3388"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| *</span><a href="elog.c.html#LN3388"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>== </span><span class='String'>'?'</span><span class='Parentheses'>) 
</span>        <a href="elog.c.html#LN3388"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN3424"><span class='Ref_to_Func'>get_errno_symbol</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3384"><span class='Ref_to_Parameter'>errnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3388"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3387"><span class='Ref_To_Local'>errorstr_buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="elog.c.html#LN3387"><span class='Ref_To_Local'>errorstr_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Comment_Multi_Line'>/*------ 
          translator: This string will be truncated at 47 
          characters expanded. */ 
</span>                 _<span class='Parentheses'>(</span><span class='String'>"operating system error %d"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="elog.c.html#LN3384"><span class='Ref_to_Parameter'>errnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="elog.c.html#LN3388"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="elog.c.html#LN3387"><span class='Ref_To_Local'>errorstr_buf</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="elog.c.html#LN3388"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end useful_strerror &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Returns a symbol (e.g. "ENOENT") for an errno code. 
 * Returns NULL if the code is unrecognized. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN3425"></a><span class='Declare_Function'>get_errno_symbol</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>errnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3425"><span class='Ref_to_Parameter'>errnum</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> E2BIG<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"E2BIG"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> EACCES<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EACCES"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/port/win32.h.html#LN310"><span class='Ref_to_Const'>EADDRINUSE</span></a> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN310"><span class='Ref_to_Const'>EADDRINUSE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EADDRINUSE"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/port/win32.h.html#LN312"><span class='Ref_to_Const'>EADDRNOTAVAIL</span></a> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN312"><span class='Ref_to_Const'>EADDRNOTAVAIL</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EADDRNOTAVAIL"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN288"><span class='Ref_to_Const'>EAFNOSUPPORT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EAFNOSUPPORT"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/port/win32.h.html#LN282"><span class='Ref_to_Const'>EAGAIN</span></a> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN282"><span class='Ref_to_Const'>EAGAIN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EAGAIN"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> EALREADY 
        <span class='Control'>case</span> EALREADY<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EALREADY"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> EBADF<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EBADF"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> EBADMSG 
        <span class='Control'>case</span> EBADMSG<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EBADMSG"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> EBUSY<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EBUSY"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ECHILD<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ECHILD"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/port/win32.h.html#LN292"><span class='Ref_to_Const'>ECONNABORTED</span></a> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN292"><span class='Ref_to_Const'>ECONNABORTED</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ECONNABORTED"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN304"><span class='Ref_to_Const'>ECONNREFUSED</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ECONNREFUSED"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../interfaces/libpq/win32.h.html#LN22"><span class='Ref_to_Const'>ECONNRESET</span></a> 
        <span class='Control'>case</span> <a href="../../../interfaces/libpq/win32.h.html#LN22"><span class='Ref_to_Const'>ECONNRESET</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ECONNRESET"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> EDEADLK<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EDEADLK"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> EDOM<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EDOM"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> EEXIST<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EEXIST"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> EFAULT<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EFAULT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> EFBIG<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EFBIG"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/port/win32.h.html#LN314"><span class='Ref_to_Const'>EHOSTUNREACH</span></a> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN314"><span class='Ref_to_Const'>EHOSTUNREACH</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EHOSTUNREACH"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN114"><span class='Ref_to_Const'>EIDRM</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EIDRM"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/libpq/win32.h.html#LN25"><span class='Ref_to_Const'>EINPROGRESS</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EINPROGRESS"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/libpq/win32.h.html#LN17"><span class='Ref_to_Const'>EINTR</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EINTR"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> EINVAL<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EINVAL"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> EIO<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EIO"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/port/win32.h.html#LN298"><span class='Ref_to_Const'>EISCONN</span></a> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN298"><span class='Ref_to_Const'>EISCONN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EISCONN"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> EISDIR<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EISDIR"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> ELOOP 
        <span class='Control'>case</span> ELOOP<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ELOOP"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> EMFILE<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EMFILE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> EMLINK<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EMLINK"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN286"><span class='Ref_to_Const'>EMSGSIZE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EMSGSIZE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ENAMETOOLONG<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENAMETOOLONG"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ENFILE<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENFILE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN300"><span class='Ref_to_Const'>ENOBUFS</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOBUFS"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ENODEV<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENODEV"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ENOENT<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOENT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ENOEXEC<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOEXEC"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ENOMEM<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOMEM"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ENOSPC<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOSPC"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ENOSYS<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOSYS"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/port/win32.h.html#LN316"><span class='Ref_to_Const'>ENOTCONN</span></a> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN316"><span class='Ref_to_Const'>ENOTCONN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOTCONN"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> ENOTDIR<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOTDIR"</span><span class='Delimiter'>; 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>ENOTEMPTY<span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span>ENOTEMPTY <span class='Operator'>!= </span>EEXIST<span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* same code on AIX */ 
</span>        <span class='Control'>case</span> ENOTEMPTY<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOTEMPTY"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/port/win32.h.html#LN306"><span class='Ref_to_Const'>ENOTSOCK</span></a> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN306"><span class='Ref_to_Const'>ENOTSOCK</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOTSOCK"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../../../timezone/private.h.html#LN34"><span class='Ref_to_Const'>ENOTSUP</span></a> 
        <span class='Control'>case</span> <a href="../../../timezone/private.h.html#LN34"><span class='Ref_to_Const'>ENOTSUP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOTSUP"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> ENOTTY<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENOTTY"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ENXIO<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ENXIO"</span><span class='Delimiter'>; 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span><a href="../../../include/port/win32.h.html#LN308"><span class='Ref_to_Const'>EOPNOTSUPP</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="../../../timezone/private.h.html#LN34"><span class='Ref_to_Const'>ENOTSUP</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="../../../include/port/win32.h.html#LN308"><span class='Ref_to_Const'>EOPNOTSUPP</span></a> <span class='Operator'>!= </span><a href="../../../timezone/private.h.html#LN34"><span class='Ref_to_Const'>ENOTSUP</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN308"><span class='Ref_to_Const'>EOPNOTSUPP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EOPNOTSUPP"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../../../timezone/private.h.html#LN37"><span class='Ref_to_Const'>EOVERFLOW</span></a> 
        <span class='Control'>case</span> <a href="../../../timezone/private.h.html#LN37"><span class='Ref_to_Const'>EOVERFLOW</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EOVERFLOW"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> EPERM<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EPERM"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> EPIPE<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EPIPE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/port/win32.h.html#LN302"><span class='Ref_to_Const'>EPROTONOSUPPORT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EPROTONOSUPPORT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> ERANGE<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ERANGE"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> EROFS 
        <span class='Control'>case</span> EROFS<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EROFS"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> ESRCH<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ESRCH"</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> ETIMEDOUT 
        <span class='Control'>case</span> ETIMEDOUT<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ETIMEDOUT"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> ETXTBSY 
        <span class='Control'>case</span> ETXTBSY<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"ETXTBSY"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span><a href="../../../interfaces/libpq/win32.h.html#LN19"><span class='Ref_to_Const'>EWOULDBLOCK</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="../../../include/port/win32.h.html#LN282"><span class='Ref_to_Const'>EAGAIN</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="../../../interfaces/libpq/win32.h.html#LN19"><span class='Ref_to_Const'>EWOULDBLOCK</span></a> <span class='Operator'>!= </span><a href="../../../include/port/win32.h.html#LN282"><span class='Ref_to_Const'>EAGAIN</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/libpq/win32.h.html#LN19"><span class='Ref_to_Const'>EWOULDBLOCK</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EWOULDBLOCK"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>case</span> EXDEV<span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EXDEV"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch errnum &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_errno_symbol &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * error_severity --- get string representing elevel 
 * 
 * The string is not localized here, but we mark the strings for translation 
 * so that callers can invoke _() on the result. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN3600"></a><span class='Declare_Function'>error_severity</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3602"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>prefix</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3600"><span class='Ref_to_Parameter'>elevel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN21"><span class='Ref_to_Const'>DEBUG4</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN19"><span class='Ref_to_Const'>DEBUG5</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN3602"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"DEBUG"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN27"><span class='Ref_to_Const'>LOG_SERVER_ONLY</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN3602"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"LOG"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN32"><span class='Ref_to_Const'>INFO</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN3602"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"INFO"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN3602"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"NOTICE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN3602"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"WARNING"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN3602"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"ERROR"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN3602"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"FATAL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Operator'>: 
</span>            <a href="elog.c.html#LN3602"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"PANIC"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="elog.c.html#LN3602"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><span class='String'>"???"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch elevel &raquo; </span> 
 
    <span class='Control'>return</span> <a href="elog.c.html#LN3602"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end error_severity &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  append_with_tabs 
 * 
 *  Append the string to the StringInfo buffer, inserting a tab after any 
 *  newline. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3651"></a><span class='Declare_Function'>append_with_tabs</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3653"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>ch</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="elog.c.html#LN3653"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>= *</span><a href="elog.c.html#LN3651"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3651"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3653"><span class='Ref_To_Local'>ch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3653"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3651"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'\t'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write errors to stderr (or by equal means when stderr is 
 * not available). Used before ereport/elog can be used 
 * safely (memory context, GUC load etc) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3670"></a><span class='Declare_Function'>write_stderr</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3672"></a>    va_list     <span class='Declare_Local'>ap</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN3675"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>errbuf</span><span class='Delimiter'>[</span><span class='Number'>2048</span><span class='Delimiter'>];</span>   <span class='Comment_Single_Line'>/* Arbitrary size? */ 
</span><span class='Directive'>#endif</span> 
 
    <a href="elog.c.html#LN3670"><span class='Ref_to_Parameter'>fmt</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><a href="elog.c.html#LN3670"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3672"><span class='Ref_To_Local'>ap</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3670"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifndef</span> <a href="../../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Comment_Multi_Line'>/* On Unix, we just fprintf to stderr */ 
</span>    <a href="../../../include/port.h.html#LN171"><span class='Ref_to_Macro'>vfprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><a href="elog.c.html#LN3670"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3672"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="../../../pl/plperl/plperl.h.html#LN59"><span class='Ref_to_Macro'>vsnprintf</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3675"><span class='Ref_To_Local'>errbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="elog.c.html#LN3675"><span class='Ref_To_Local'>errbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="elog.c.html#LN3670"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3672"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * On Win32, we print to stderr if running on a console, or write to 
     * eventlog if running as a service 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/win32security.c.html#LN115"><span class='Ref_to_Func'>pgwin32_is_service</span></a><span class='Parentheses'>())</span>   <span class='Comment_Single_Line'>/* Running as a service */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="elog.c.html#LN133"><span class='Ref_to_Proto'>write_eventlog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="elog.c.html#LN3675"><span class='Ref_To_Local'>errbuf</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="elog.c.html#LN3675"><span class='Ref_To_Local'>errbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Not running as service, write to stderr */ 
</span>        <a href="elog.c.html#LN2155"><span class='Ref_to_Func'>write_console</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3675"><span class='Ref_To_Local'>errbuf</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="elog.c.html#LN3675"><span class='Ref_To_Local'>errbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
    <a href="../../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="elog.c.html#LN3672"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end write_stderr &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * is_log_level_output -- is elevel logically &GT;= log_min_level? 
 * 
 * We use this for tests that should consider LOG to sort out-of-order, 
 * between ERROR and FATAL.  Generally this is the right thing for testing 
 * whether a message should go to the postmaster log, whereas a simple &GT;= 
 * test is correct for testing whether the message should go to the client. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3716"></a><span class='Declare_Function'>is_log_level_output</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>log_min_level</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3716"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>== </span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a> <span class='Operator'>|| </span><a href="elog.c.html#LN3716"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>== </span><a href="../../../include/utils/elog.h.html#LN27"><span class='Ref_to_Const'>LOG_SERVER_ONLY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3716"><span class='Ref_to_Parameter'>log_min_level</span></a> <span class='Operator'>== </span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a> <span class='Operator'>|| </span><a href="elog.c.html#LN3716"><span class='Ref_to_Parameter'>log_min_level</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3716"><span class='Ref_to_Parameter'>log_min_level</span></a> <span class='Operator'>== </span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* elevel != LOG */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3716"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Neither is LOG */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3716"><span class='Ref_to_Parameter'>elevel</span></a> <span class='Operator'>&GT;= </span><a href="elog.c.html#LN3716"><span class='Ref_to_Parameter'>log_min_level</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end is_log_level_output &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Adjust the level of a recovery-related message per trace_recovery_messages. 
 * 
 * The argument is the default log level of the message, eg, DEBUG2.  (This 
 * should only be applied to DEBUGn log messages, otherwise it's a no-op.) 
 * If the level is &GT;= trace_recovery_messages, we return LOG, causing the 
 * message to be logged unconditionally (for most settings of 
 * log_min_messages).  Otherwise, we return the argument unchanged. 
 * The message will then be shown based on the setting of log_min_messages. 
 * 
 * Intention is to keep this for at least the whole of the 9.0 production 
 * release, so we can more easily diagnose production problems in the field. 
 * It should go away eventually, though, because it's an ugly and 
 * hard-to-explain kluge. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3752"></a><span class='Declare_Function'>trace_recovery</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>trace_level</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="elog.c.html#LN3752"><span class='Ref_to_Parameter'>trace_level</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a> <span class='Operator'>&& 
</span>        <a href="elog.c.html#LN3752"><span class='Ref_to_Parameter'>trace_level</span></a> <span class='Operator'>&GT;= </span><a href="../misc/guc.c.html#LN454"><span class='Ref_to_Global_Var'>trace_recovery_messages</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="elog.c.html#LN3752"><span class='Ref_to_Parameter'>trace_level</span></a><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>