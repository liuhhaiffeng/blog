<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\init\postinit.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\init\postinit.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:57 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * postinit.c 
 *    postgres initialization utilities 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/init/postinit.c 
 * 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_authid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_database.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_db_role_setting.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_tablespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/auth.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/libpq-be.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"postmaster/autovacuum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"postmaster/postmaster.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/walsender.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/fd.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/ipc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/procarray.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/procsignal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/sinvaladt.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/smgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/tcopprot.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/guc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/pg_locale.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/portal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/ps_status.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/timeout.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<a name="LN64"></a><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>GetDatabaseTuple</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN65"></a><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>GetDatabaseTupleByOid</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>dboid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN66"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PerformAuthentication</span><span class='Parentheses'>(</span><a href="../../../include/libpq/libpq-be.h.html#LN115"><span class='Ref_to_Struct'>Port</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>port</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN67"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CheckMyDatabase</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>am_superuser</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN68"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>InitCommunication</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN69"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ShutdownPostgres</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>StatementTimeoutHandler</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN71"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>LockTimeoutHandler</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>IdleInTransactionSessionTimeoutHandler</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN73"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ThereIsAtLeastOneRole</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>process_startup_options</span><span class='Parentheses'>(</span><a href="../../../include/libpq/libpq-be.h.html#LN115"><span class='Ref_to_Struct'>Port</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>port</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>am_superuser</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN75"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>process_settings</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>databaseid</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/*** InitPostgres support ***/ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * GetDatabaseTuple -- fetch the pg_database row for a database 
 * 
 * This is used during backend startup when we don't yet have any access to 
 * system catalogs in general.  In the worst case, we can seqscan pg_database 
 * using nothing but the hard-wired descriptor that relcache.c creates for 
 * pg_database.  In more typical cases, relcache.c was able to load 
 * descriptors for both pg_database and its indexes from the shared relcache 
 * cache file, and so we can do an indexscan.  criticalSharedRelcachesBuilt 
 * tells whether we got the cached descriptors. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN93"></a><span class='Declare_Function'>GetDatabaseTuple</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN95"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN96"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN97"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN98"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * form a scan key 
     */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postinit.c.html#LN98"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../../include/catalog/pg_database.h.html#LN63"><span class='Ref_to_Const'>Anum_pg_database_datname</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_NAMEEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN93"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open pg_database and fetch a tuple.  Force heap scan if we haven't yet 
     * built the critical shared relcache entries (i.e., we're starting up 
     * without a shared relcache cache file). 
     */ 
</span>    <a href="postinit.c.html#LN96"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postinit.c.html#LN97"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN96"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN139"><span class='Ref_to_Const'>DatabaseNameIndexId</span></a><span class='Delimiter'>, 
</span>                              <a href="../cache/relcache.c.html#LN134"><span class='Ref_to_Global_Var'>criticalSharedRelcachesBuilt</span></a><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Number'>1</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN98"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postinit.c.html#LN95"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN97"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must copy tuple before releasing buffer */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN95"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="postinit.c.html#LN95"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN95"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* all done */ 
</span>    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN97"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN96"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postinit.c.html#LN95"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetDatabaseTuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GetDatabaseTupleByOid -- as above, but search by database OID 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN136"></a><span class='Declare_Function'>GetDatabaseTupleByOid</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>dboid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN138"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN139"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN140"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN141"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * form a scan key 
     */ 
</span>    <a href="../../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postinit.c.html#LN141"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN136"><span class='Ref_to_Parameter'>dboid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open pg_database and fetch a tuple.  Force heap scan if we haven't yet 
     * built the critical shared relcache entries (i.e., we're starting up 
     * without a shared relcache cache file). 
     */ 
</span>    <a href="postinit.c.html#LN139"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postinit.c.html#LN140"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN139"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/indexing.h.html#LN141"><span class='Ref_to_Const'>DatabaseOidIndexId</span></a><span class='Delimiter'>, 
</span>                              <a href="../cache/relcache.c.html#LN134"><span class='Ref_to_Global_Var'>criticalSharedRelcachesBuilt</span></a><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Number'>1</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN141"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postinit.c.html#LN138"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN140"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must copy tuple before releasing buffer */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN138"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="postinit.c.html#LN138"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN138"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* all done */ 
</span>    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN140"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN139"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postinit.c.html#LN138"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetDatabaseTupleByOid &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * PerformAuthentication -- authenticate a remote client 
 * 
 * returns: nothing.  Will not return at all if there's any failure. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN182"></a><span class='Declare_Function'>PerformAuthentication</span><span class='Parentheses'>(</span><a href="../../../include/libpq/libpq-be.h.html#LN115"><span class='Ref_to_Struct'>Port</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>port</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* This should be set already, but let's make sure */ 
</span>    <a href="../../postmaster/postmaster.c.html#LN347"><span class='Ref_to_Global_Var'>ClientAuthInProgress</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* limit visibility of log messages */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In EXEC_BACKEND case, we didn't inherit the contents of pg_hba.conf 
     * etcetera from the postmaster, and have to load them ourselves. 
     * 
     * FIXME: [fork/exec] Ugh.  Is there a way around this overhead? 
     */ 
</span><span class='Directive'>#ifdef</span> EXEC_BACKEND 
 
    <span class='Comment_Multi_Line'>/* 
     * load_hba() and load_ident() want to work within the PostmasterContext, 
     * so create that if it doesn't exist (which it won't).  We'll delete it 
     * again later, in PostgresMain. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN44"><span class='Ref_to_Global_Var'>PostmasterContext</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../mmgr/mcxt.c.html#LN44"><span class='Ref_to_Global_Var'>PostmasterContext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                  <span class='String'>"Postmaster"</span><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/libpq/hba.h.html#LN114"><span class='Ref_to_Proto'>load_hba</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * It makes no sense to continue if we fail to load the HBA file, 
         * since there is no way to connect to the database in this case. 
         */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not load pg_hba.conf"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/libpq/hba.h.html#LN115"><span class='Ref_to_Proto'>load_ident</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * It is ok to continue if we fail to load the IDENT file, although it 
         * means that you cannot log in using any of the authentication 
         * methods that need a user name mapping. load_ident() already logged 
         * the details of error to the log. 
         */ 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set up a timeout in case a buggy or malicious client fails to respond 
     * during authentication.  Since we're inside a transaction and might do 
     * database access, we have to use the statement_timeout infrastructure. 
     */ 
</span>    <a href="../../../include/utils/timeout.h.html#LN74"><span class='Ref_to_Proto'>enable_timeout_after</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timeout.h.html#LN28"><span class='Ref_to_EnumConst'>STATEMENT_TIMEOUT</span></a><span class='Delimiter'>, </span><a href="../../postmaster/postmaster.c.html#LN235"><span class='Ref_to_Global_Var'>AuthenticationTimeout</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now perform authentication exchange. 
     */ 
</span>    <a href="../../../include/libpq/auth.h.html#LN22"><span class='Ref_to_Proto'>ClientAuthentication</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* might not return, if failure */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Done with authentication.  Disable the timeout, and log if needed. 
     */ 
</span>    <a href="../../../include/utils/timeout.h.html#LN77"><span class='Ref_to_Proto'>disable_timeout</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timeout.h.html#LN28"><span class='Ref_to_EnumConst'>STATEMENT_TIMEOUT</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../postmaster/postmaster.c.html#LN238"><span class='Ref_to_Global_Var'>Log_connections</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_OPENSSL 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN180"><span class='Ref_to_Member'>ssl_in_use</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"replication connection authorized: user=%s SSL enabled (protocol=%s, cipher=%s, compression=%s)"</span><span class='Delimiter'>, 
</span>                                <a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN136"><span class='Ref_to_Member'>user_name</span></a><span class='Delimiter'>, </span>SSL_get_version<span class='Parentheses'>(</span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN189"><span class='Ref_to_Member'>ssl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span>SSL_get_cipher<span class='Parentheses'>(</span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN189"><span class='Ref_to_Member'>ssl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/port.h.html#LN418"><span class='Ref_to_Macro'>SSL_get_current_compression</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN189"><span class='Ref_to_Member'>ssl</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span>_<span class='Parentheses'>(</span><span class='String'>"on"</span><span class='Parentheses'>) </span><span class='Operator'>: </span>_<span class='Parentheses'>(</span><span class='String'>"off"</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"replication connection authorized: user=%s"</span><span class='Delimiter'>, 
</span>                                <a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN136"><span class='Ref_to_Member'>user_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_OPENSSL 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN180"><span class='Ref_to_Member'>ssl_in_use</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"connection authorized: user=%s database=%s SSL enabled (protocol=%s, cipher=%s, compression=%s)"</span><span class='Delimiter'>, 
</span>                                <a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN136"><span class='Ref_to_Member'>user_name</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN135"><span class='Ref_to_Member'>database_name</span></a><span class='Delimiter'>, </span>SSL_get_version<span class='Parentheses'>(</span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN189"><span class='Ref_to_Member'>ssl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span>SSL_get_cipher<span class='Parentheses'>(</span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN189"><span class='Ref_to_Member'>ssl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/port.h.html#LN418"><span class='Ref_to_Macro'>SSL_get_current_compression</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN189"><span class='Ref_to_Member'>ssl</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span>_<span class='Parentheses'>(</span><span class='String'>"on"</span><span class='Parentheses'>) </span><span class='Operator'>: </span>_<span class='Parentheses'>(</span><span class='String'>"off"</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"connection authorized: user=%s database=%s"</span><span class='Delimiter'>, 
</span>                                <a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN136"><span class='Ref_to_Member'>user_name</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN182"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN135"><span class='Ref_to_Member'>database_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if Log_connections &raquo; </span> 
 
    <a href="../../../include/utils/ps_status.h.html#LN21"><span class='Ref_to_Proto'>set_ps_display</span></a><span class='Parentheses'>(</span><span class='String'>"startup"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../postmaster/postmaster.c.html#LN347"><span class='Ref_to_Global_Var'>ClientAuthInProgress</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* client_min_messages is active now */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end PerformAuthentication &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * CheckMyDatabase -- fetch information from the pg_database entry for our DB 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN285"></a><span class='Declare_Function'>CheckMyDatabase</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>am_superuser</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN287"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN288"></a>    <a href="../../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a> <span class='Declare_Local'>dbform</span><span class='Delimiter'>; 
</span><a name="LN289"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>collate</span><span class='Delimiter'>; 
</span><a name="LN290"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ctype</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch our pg_database row normally, via syscache */ 
</span>    <a href="postinit.c.html#LN287"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN54"><span class='Ref_to_EnumConst'>DATABASEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN287"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for database %u"</span><span class='Delimiter'>, </span><a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postinit.c.html#LN288"><span class='Ref_To_Local'>dbform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN287"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This recheck is strictly paranoia */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postinit.c.html#LN285"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN288"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>datname<span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_DATABASE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"database \"%s\" has disappeared from pg_database"</span><span class='Delimiter'>, 
</span>                        <a href="postinit.c.html#LN285"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Database OID %u now seems to belong to \"%s\"."</span><span class='Delimiter'>, 
</span>                           <a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN288"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>datname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check permissions to connect to the database. 
     * 
     * These checks are not enforced when in standalone mode, so that there is 
     * a way to recover from disabling all access to all databases, for 
     * example "UPDATE pg_database SET datallowconn = false;". 
     * 
     * We do not enforce them for autovacuum worker processes either. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a> <span class='Operator'>&& !</span><a href="../../../include/postmaster/autovacuum.h.html#LN50"><span class='Ref_to_Proto'>IsAutoVacuumWorkerProcess</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Check that the database is currently allowing connections. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN288"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>datallowconn<span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"database \"%s\" is not currently accepting connections"</span><span class='Delimiter'>, 
</span>                    <a href="postinit.c.html#LN285"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check privilege to connect to the database.  (The am_superuser test 
         * is redundant, but since we have the flag, might as well check it 
         * and save a few cycles.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN285"><span class='Ref_to_Parameter'>am_superuser</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, </span><a href="miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                 <a href="../../../include/nodes/parsenodes.h.html#LN83"><span class='Ref_to_Const'>ACL_CONNECT</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for database \"%s\""</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN285"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"User does not have CONNECT privilege."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check connection limit for this database. 
         * 
         * There is a race condition here --- we create our PGPROC before 
         * checking for other PGPROCs.  If two backends did this at about the 
         * same time, they might both think they were over the limit, while 
         * ideally one should succeed and one fail.  Getting that to work 
         * exactly seems more trouble than it is worth, however; instead we 
         * just document that the connection limit is approximate. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postinit.c.html#LN288"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>datconnlimit <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="postinit.c.html#LN285"><span class='Ref_to_Parameter'>am_superuser</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/storage/procarray.h.html#LN111"><span class='Ref_to_Proto'>CountDBConnections</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="postinit.c.html#LN288"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>datconnlimit<span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_CONNECTIONS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"too many connections for database \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="postinit.c.html#LN285"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsUnderPostmaster&&!I... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * OK, we're golden.  Next to-do item is to save the encoding info out of 
     * the pg_database tuple. 
     */ 
</span>    <a href="../../../include/mb/pg_wchar.h.html#LN544"><span class='Ref_to_Proto'>SetDatabaseEncoding</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN288"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>encoding<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Record it as a GUC internal option, too */ 
</span>    <a href="../../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"server_encoding"</span><span class='Delimiter'>, </span><a href="../../../include/mb/pg_wchar.h.html#LN546"><span class='Ref_to_Proto'>GetDatabaseEncodingName</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                    <a href="../../../include/utils/guc.h.html#LN69"><span class='Ref_to_EnumConst'>PGC_INTERNAL</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN116"><span class='Ref_to_EnumConst'>PGC_S_OVERRIDE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* If we have no other source of client_encoding, use server encoding */ 
</span>    <a href="../../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"client_encoding"</span><span class='Delimiter'>, </span><a href="../../../include/mb/pg_wchar.h.html#LN546"><span class='Ref_to_Proto'>GetDatabaseEncodingName</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                    <a href="../../../include/utils/guc.h.html#LN73"><span class='Ref_to_EnumConst'>PGC_BACKEND</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN107"><span class='Ref_to_EnumConst'>PGC_S_DYNAMIC_DEFAULT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* assign locale variables */ 
</span>    <a href="postinit.c.html#LN289"><span class='Ref_To_Local'>collate</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN288"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>datcollate<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postinit.c.html#LN290"><span class='Ref_To_Local'>ctype</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN288"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>datctype<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/pg_locale.h.html#LN47"><span class='Ref_to_Proto'>pg_perm_setlocale</span></a><span class='Parentheses'>(</span>LC_COLLATE<span class='Delimiter'>, </span><a href="postinit.c.html#LN289"><span class='Ref_To_Local'>collate</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"database locale is incompatible with operating system"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The database was initialized with LC_COLLATE \"%s\", "</span> 
                       <span class='String'>" which is not recognized by setlocale()."</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN289"><span class='Ref_To_Local'>collate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Recreate the database with another locale or install the missing locale."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/pg_locale.h.html#LN47"><span class='Ref_to_Proto'>pg_perm_setlocale</span></a><span class='Parentheses'>(</span>LC_CTYPE<span class='Delimiter'>, </span><a href="postinit.c.html#LN290"><span class='Ref_To_Local'>ctype</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"database locale is incompatible with operating system"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The database was initialized with LC_CTYPE \"%s\", "</span> 
                       <span class='String'>" which is not recognized by setlocale()."</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN290"><span class='Ref_To_Local'>ctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Recreate the database with another locale or install the missing locale."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make the locale settings visible as GUC variables, too */ 
</span>    <a href="../../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"lc_collate"</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN289"><span class='Ref_To_Local'>collate</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN69"><span class='Ref_to_EnumConst'>PGC_INTERNAL</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN116"><span class='Ref_to_EnumConst'>PGC_S_OVERRIDE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><span class='String'>"lc_ctype"</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN290"><span class='Ref_To_Local'>ctype</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN69"><span class='Ref_to_EnumConst'>PGC_INTERNAL</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN116"><span class='Ref_to_EnumConst'>PGC_S_OVERRIDE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/pg_locale.h.html#LN48"><span class='Ref_to_Proto'>check_strxfrm_bug</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN287"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CheckMyDatabase &raquo; </span> 
 
 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 *      InitCommunication 
 * 
 *      This routine initializes stuff needed for ipc, locking, etc. 
 *      it should be called something more informative. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN408"></a><span class='Declare_Function'>InitCommunication</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * initialize shared memory and semaphores appropriately. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* postmaster already did this */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We're running a postgres bootstrap process or a standalone backend. 
         * Create private "shmem" and semaphores. 
         */ 
</span>        <a href="../../../include/storage/ipc.h.html#LN77"><span class='Ref_to_Proto'>CreateSharedMemoryAndSemaphores</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * pg_split_opts -- split a string of options and append it to an argv array 
 * 
 * The caller is responsible for ensuring the argv array is large enough.  The 
 * maximum possible number of arguments added by this routine is 
 * (strlen(optstr) + 1) / 2. 
 * 
 * Because some option values can contain spaces we allow escaping using 
 * backslashes, with \\ representing a literal backslash. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN435"></a><span class='Declare_Function'>pg_split_opts</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>argv</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>argcp</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>optstr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN437"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postinit.c.html#LN437"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>optstr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN443"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>last_was_escape</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="../../lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postinit.c.html#LN437"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* skip over leading space */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>optstr</span></a><span class='Parentheses'>))</span> 
            <a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>optstr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>optstr</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Parse a single option, stopping at the first space, unless it's 
         * escaped. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>optstr</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>optstr</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& !</span><a href="postinit.c.html#LN443"><span class='Ref_To_Local'>last_was_escape</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN443"><span class='Ref_To_Local'>last_was_escape</span></a> <span class='Operator'>&& *</span><a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>optstr</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                <a href="postinit.c.html#LN443"><span class='Ref_To_Local'>last_was_escape</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="postinit.c.html#LN443"><span class='Ref_To_Local'>last_was_escape</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postinit.c.html#LN437"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>optstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>optstr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* now store the option in the next argv[] position */ 
</span>        <a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="postinit.c.html#LN435"><span class='Ref_to_Parameter'>argcp</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN437"><span class='Ref_To_Local'>s</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *optstr &raquo; </span> 
 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN437"><span class='Ref_To_Local'>s</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_split_opts &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Initialize MaxBackends value from config options. 
 * 
 * This must be called after modules have had the chance to register background 
 * workers in shared_preload_libraries, and before shared memory size is 
 * determined. 
 * 
 * Note that in EXEC_BACKEND environment, the value is passed down from 
 * postmaster to subprocesses via BackendParameters in SubPostmasterMain; only 
 * postmaster itself and processes not under postmaster control should call 
 * this. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN494"></a><span class='Declare_Function'>InitializeMaxBackends</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="globals.c.html#LN126"><span class='Ref_to_Global_Var'>MaxBackends</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* the extra unit accounts for the autovacuum launcher */ 
</span>    <a href="globals.c.html#LN126"><span class='Ref_to_Global_Var'>MaxBackends</span></a> <span class='Operator'>= </span><a href="globals.c.html#LN123"><span class='Ref_to_Global_Var'>MaxConnections</span></a> <span class='Operator'>+ </span><a href="../../postmaster/autovacuum.c.html#LN112"><span class='Ref_to_Global_Var'>autovacuum_max_workers</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ 
</span>        <a href="globals.c.html#LN124"><span class='Ref_to_Global_Var'>max_worker_processes</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* internal error because the values were all checked previously */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="globals.c.html#LN126"><span class='Ref_to_Global_Var'>MaxBackends</span></a> <span class='Operator'>&GT; </span><a href="../../../include/postmaster/postmaster.h.html#LN74"><span class='Ref_to_Const'>MAX_BACKENDS</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"too many backends configured"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Early initialization of a backend (either standalone or under postmaster). 
 * This happens even before InitPostgres. 
 * 
 * This is separate from InitPostgres because it is also called by auxiliary 
 * processes, such as the background writer process, which may not call 
 * InitPostgres at all. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN516"></a><span class='Declare_Function'>BaseInit</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Attach to shared memory and semaphores, and initialize our 
     * input/output/debugging file descriptors. 
     */ 
</span>    <a href="postinit.c.html#LN68"><span class='Ref_to_Proto'>InitCommunication</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/elog.h.html#LN400"><span class='Ref_to_Proto'>DebugFileOpen</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Do local initialization of file, storage and buffer managers */ 
</span>    <a href="../../../include/storage/fd.h.html#LN103"><span class='Ref_to_Proto'>InitFileAccess</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/smgr.h.html#LN82"><span class='Ref_to_Proto'>smgrinit</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN182"><span class='Ref_to_Proto'>InitBufferPoolAccess</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* -------------------------------- 
 * InitPostgres 
 *      Initialize POSTGRES. 
 * 
 * The database can be specified by name, using the in_dbname parameter, or by 
 * OID, using the dboid parameter.  In the latter case, the actual database 
 * name can be returned to the caller in out_dbname.  If out_dbname isn't 
 * NULL, it must point to a buffer of size NAMEDATALEN. 
 * 
 * Similarly, the username can be passed by name, using the username parameter, 
 * or by OID using the useroid parameter. 
 * 
 * In bootstrap mode no parameters are used.  The autovacuum launcher process 
 * doesn't use any parameters either, because it only goes far enough to be 
 * able to read pg_database; it doesn't connect to any particular database. 
 * In walsender mode only username is used. 
 * 
 * As of PostgreSQL 8.2, we expect InitProcess() was already called, so we 
 * already have a PGPROC struct ... but it's not completely filled in yet. 
 * 
 * Note: 
 *      Be very careful with the order of calls in the InitPostgres function. 
 * -------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN557"></a><span class='Declare_Function'>InitPostgres</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>in_dbname</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>dboid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>username</span><span class='Delimiter'>, 
</span><a name="LN558"></a>             <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>useroid</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>out_dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN560"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>bootstrap</span> <span class='Operator'>= </span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN561"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>am_superuser</span><span class='Delimiter'>; 
</span><a name="LN562"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fullpath</span><span class='Delimiter'>; 
</span><a name="LN563"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>dbname</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span> 
    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Delimiter'>, </span><span class='String'>"InitPostgres"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add my PGPROC struct to the ProcArray. 
     * 
     * Once I have done this, I am visible to other backends! 
     */ 
</span>    <a href="../../../include/storage/proc.h.html#LN289"><span class='Ref_to_Proto'>InitProcessPhase2</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize my entry in the shared-invalidation manager's array of 
     * per-backend data. 
     * 
     * Sets up MyBackendId, a unique backend identifier. 
     */ 
</span>    <a href="globals.c.html#LN72"><span class='Ref_to_Global_Var'>MyBackendId</span></a> <span class='Operator'>= </span><a href="../../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/sinvaladt.h.html#LN32"><span class='Ref_to_Proto'>SharedInvalBackendInit</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="globals.c.html#LN72"><span class='Ref_to_Global_Var'>MyBackendId</span></a> <span class='Operator'>&GT; </span><a href="globals.c.html#LN126"><span class='Ref_to_Global_Var'>MaxBackends</span></a> <span class='Operator'>|| </span><a href="globals.c.html#LN72"><span class='Ref_to_Global_Var'>MyBackendId</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"bad backend ID: %d"</span><span class='Delimiter'>, </span><a href="globals.c.html#LN72"><span class='Ref_to_Global_Var'>MyBackendId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now that we have a BackendId, we can participate in ProcSignal */ 
</span>    <a href="../../../include/storage/procsignal.h.html#LN54"><span class='Ref_to_Proto'>ProcSignalInit</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN72"><span class='Ref_to_Global_Var'>MyBackendId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Also set up timeout handlers needed for backend operation.  We need 
     * these in every case except bootstrap. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/timeout.h.html#LN70"><span class='Ref_to_Proto'>RegisterTimeout</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timeout.h.html#LN26"><span class='Ref_to_EnumConst'>DEADLOCK_TIMEOUT</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/proc.h.html#LN303"><span class='Ref_to_Proto'>CheckDeadLockAlert</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/timeout.h.html#LN70"><span class='Ref_to_Proto'>RegisterTimeout</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timeout.h.html#LN28"><span class='Ref_to_EnumConst'>STATEMENT_TIMEOUT</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN70"><span class='Ref_to_Proto'>StatementTimeoutHandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/timeout.h.html#LN70"><span class='Ref_to_Proto'>RegisterTimeout</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timeout.h.html#LN27"><span class='Ref_to_EnumConst'>LOCK_TIMEOUT</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN71"><span class='Ref_to_Proto'>LockTimeoutHandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/timeout.h.html#LN70"><span class='Ref_to_Proto'>RegisterTimeout</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timeout.h.html#LN32"><span class='Ref_to_EnumConst'>IDLE_IN_TRANSACTION_SESSION_TIMEOUT</span></a><span class='Delimiter'>, 
</span>                        <a href="postinit.c.html#LN72"><span class='Ref_to_Proto'>IdleInTransactionSessionTimeoutHandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * bufmgr needs another initialization call too 
     */ 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN183"><span class='Ref_to_Proto'>InitBufferPoolBackend</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize local process's access to XLOG. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The postmaster already started the XLOG machinery, but we need to 
         * call InitXLOGAccess(), if the system isn't in hot-standby mode. 
         * This is handled by calling RecoveryInProgress and ignoring the 
         * result. 
         */ 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/access/xlog.h.html#LN242"><span class='Ref_to_Proto'>RecoveryInProgress</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We are either a bootstrap process or a standalone backend. Either 
         * way, start up the XLOG machinery, and register to have it closed 
         * down at exit. 
         */ 
</span>        <a href="../../../include/access/xlog.h.html#LN264"><span class='Ref_to_Proto'>StartupXLOG</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/ipc.h.html#LN69"><span class='Ref_to_Proto'>on_shmem_exit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/xlog.h.html#LN265"><span class='Ref_to_Proto'>ShutdownXLOG</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the relation cache and the system catalog caches.  Note that 
     * no catalog access happens here; we only set up the hashtable structure. 
     * We must do this before starting a transaction because transaction abort 
     * would try to touch these hashtables. 
     */ 
</span>    <a href="../../../include/utils/relcache.h.html#LN84"><span class='Ref_to_Proto'>RelationCacheInitialize</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/syscache.h.html#LN114"><span class='Ref_to_Proto'>InitCatalogCache</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../cache/plancache.c.html#LN114"><span class='Ref_to_Func'>InitPlanCache</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize portal manager */ 
</span>    <a href="../mmgr/portalmem.c.html#LN101"><span class='Ref_to_Func'>EnablePortalManager</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize stats collection --- must happen before first xact */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/pgstat.h.html#LN1165"><span class='Ref_to_Proto'>pgstat_initialize</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Load relcache entries for the shared system catalogs.  This must create 
     * at least entries for pg_database and catalogs used for authentication. 
     */ 
</span>    <a href="../../../include/utils/relcache.h.html#LN85"><span class='Ref_to_Proto'>RelationCacheInitializePhase2</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up process-exit callback to do pre-shutdown cleanup.  This is the 
     * first before_shmem_exit callback we register; thus, this will be the 
     * last thing we do before low-level modules like the buffer manager begin 
     * to close down.  We need to have this in place before we begin our first 
     * transaction --- if we fail during the initialization transaction, as is 
     * entirely possible, we need the AbortTransaction call to clean up. 
     */ 
</span>    <a href="../../../include/storage/ipc.h.html#LN70"><span class='Ref_to_Proto'>before_shmem_exit</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN69"><span class='Ref_to_Proto'>ShutdownPostgres</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* The autovacuum launcher is done here */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postmaster/autovacuum.h.html#LN49"><span class='Ref_to_Proto'>IsAutoVacuumLauncherProcess</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* report this backend in the PgBackendStatus array */ 
</span>        <a href="../../../include/pgstat.h.html#LN1166"><span class='Ref_to_Proto'>pgstat_bestart</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start a new transaction here before first access to db, and get a 
     * snapshot.  We don't have a use for the snapshot itself, but we're 
     * interested in the secondary effect that it sets RecentGlobalXmin. (This 
     * is critical for anything that reads heap pages, because HOT may decide 
     * to prune them even if the process doesn't attempt to modify any 
     * tuples.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* statement_timestamp must be set for timeouts to work correctly */ 
</span>        <a href="../../../include/access/xact.h.html#LN343"><span class='Ref_to_Proto'>SetCurrentStatementStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/xact.h.html#LN348"><span class='Ref_to_Proto'>StartTransactionCommand</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * transaction_isolation will have been set to the default by the 
         * above.  If the default is "serializable", and we are in hot 
         * standby, we will fail if we don't change it to something lower. 
         * Fortunately, "read committed" is plenty good enough. 
         */ 
</span>        <a href="../../access/transam/xact.c.html#LN73"><span class='Ref_to_Global_Var'>XactIsoLevel</span></a> <span class='Operator'>= </span><a href="../../../include/access/xact.h.html#LN28"><span class='Ref_to_Const'>XACT_READ_COMMITTED</span></a><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Perform client authentication if necessary, then figure out our 
     * postgres user ID, and see if we are a superuser. 
     * 
     * In standalone mode and in autovacuum worker processes, we use a fixed 
     * ID, otherwise we figure it out from the authenticated user name. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a> <span class='Operator'>|| </span><a href="../../../include/postmaster/autovacuum.h.html#LN50"><span class='Ref_to_Proto'>IsAutoVacuumWorkerProcess</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/miscadmin.h.html#LN320"><span class='Ref_to_Proto'>InitializeSessionUserIdStandalone</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/miscadmin.h.html#LN320"><span class='Ref_to_Proto'>InitializeSessionUserIdStandalone</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN73"><span class='Ref_to_Proto'>ThereIsAtLeastOneRole</span></a><span class='Parentheses'>())</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no roles are defined in this database system"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You should immediately run CREATE USER \"%s\" SUPERUSER;."</span><span class='Delimiter'>, 
</span>                             <a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>username</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>? </span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>username</span></a> <span class='Operator'>: </span><span class='String'>"postgres"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="globals.c.html#LN102"><span class='Ref_to_Global_Var'>IsBackgroundWorker</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>username</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& !</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN558"><span class='Ref_to_Parameter'>useroid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/miscadmin.h.html#LN320"><span class='Ref_to_Proto'>InitializeSessionUserIdStandalone</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/miscadmin.h.html#LN319"><span class='Ref_to_Proto'>InitializeSessionUserId</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>username</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN558"><span class='Ref_to_Parameter'>useroid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a> <span class='Operator'>= </span><a href="../misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* normal multiuser case */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postinit.c.html#LN66"><span class='Ref_to_Proto'>PerformAuthentication</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/miscadmin.h.html#LN319"><span class='Ref_to_Proto'>InitializeSessionUserId</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>username</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN558"><span class='Ref_to_Parameter'>useroid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a> <span class='Operator'>= </span><a href="../misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're trying to shut down, only superusers can connect, and new 
     * replication connections are not allowed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>!</span><a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a> <span class='Operator'>|| </span><a href="../../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN128"><span class='Ref_to_Member'>canAcceptConnections</span></a> <span class='Operator'>== </span><a href="../../../include/libpq/libpq-be.h.html#LN73"><span class='Ref_to_EnumConst'>CAC_WAITBACKUP</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"new replication connections are not allowed during database shutdown"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to connect during database shutdown"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Binary upgrades only allowed super-user connections 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="globals.c.html#LN101"><span class='Ref_to_Global_Var'>IsBinaryUpgrade</span></a> <span class='Operator'>&& !</span><a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to connect in binary upgrade mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The last few connections slots are reserved for superusers. Although 
     * replication connections currently require superuser privileges, we 
     * don't allow them to consume the reserved slots, which are intended for 
     * interactive use. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>!</span><a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a> <span class='Operator'>|| </span><a href="../../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="../../postmaster/postmaster.c.html#LN210"><span class='Ref_to_Global_Var'>ReservedBackends</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/storage/proc.h.html#LN296"><span class='Ref_to_Proto'>HaveNFreeProcs</span></a><span class='Parentheses'>(</span><a href="../../postmaster/postmaster.c.html#LN210"><span class='Ref_to_Global_Var'>ReservedBackends</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_CONNECTIONS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"remaining connection slots are reserved for non-replication superuser connections"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check replication permissions needed for walsender processes. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>()</span> <span class='Operator'>&& !</span><a href="miscinit.c.html#LN462"><span class='Ref_to_Func'>has_rolreplication</span></a><span class='Parentheses'>(</span><a href="miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser or replication role to start walsender"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If this is a plain walsender only supporting physical replication, we 
     * don't want to connect to any particular database. Just finish the 
     * backend startup by processing any options from the startup packet, and 
     * we're done. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../replication/walsender.c.html#LN113"><span class='Ref_to_Global_Var'>am_walsender</span></a> <span class='Operator'>&& !</span><a href="../../replication/walsender.c.html#LN116"><span class='Ref_to_Global_Var'>am_db_walsender</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* process any options passed in the startup packet */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="postinit.c.html#LN74"><span class='Ref_to_Proto'>process_startup_options</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Apply PostAuthDelay as soon as we've read all options */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../tcop/postgres.c.html#LN98"><span class='Ref_to_Global_Var'>PostAuthDelay</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><a href="../../tcop/postgres.c.html#LN98"><span class='Ref_to_Global_Var'>PostAuthDelay</span></a> <span class='Operator'>* </span><span class='Number'>1000000L</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* initialize client encoding */ 
</span>        <a href="../mb/mbutils.c.html#LN291"><span class='Ref_to_Func'>InitializeClientEncoding</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* report this backend in the PgBackendStatus array */ 
</span>        <a href="../../../include/pgstat.h.html#LN1166"><span class='Ref_to_Proto'>pgstat_bestart</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* close the transaction we started above */ 
</span>        <a href="../../../include/access/xact.h.html#LN349"><span class='Ref_to_Proto'>CommitTransactionCommand</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if am_walsender&&!am_db_... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set up the global variables holding database id and default tablespace. 
     * But note we won't actually try to touch the database just yet. 
     * 
     * We take a shortcut in the bootstrap case, otherwise we have to look up 
     * the db's entry in pg_database. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_database.h.html#LN79"><span class='Ref_to_Const'>TemplateDbOid</span></a><span class='Delimiter'>; 
</span>        <a href="globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_tablespace.h.html#LN62"><span class='Ref_to_Const'>DEFAULTTABLESPACE_OID</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>in_dbname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN838"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN839"></a>        <a href="../../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a> <span class='Declare_Local'>dbform</span><span class='Delimiter'>; 
</span> 
        <a href="postinit.c.html#LN838"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="postinit.c.html#LN64"><span class='Ref_to_Proto'>GetDatabaseTuple</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>in_dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN838"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_DATABASE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"database \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>in_dbname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="postinit.c.html#LN839"><span class='Ref_To_Local'>dbform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN838"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN838"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a> <span class='Operator'>= </span><a href="postinit.c.html#LN839"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>dattablespace<span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* take database name from the caller, just for paranoia */ 
</span>        <a href="../../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN563"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>in_dbname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postinit.c.html#LN563"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>dboid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* caller specified database by OID */ 
</span><a name="LN855"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN856"></a>        <a href="../../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a> <span class='Declare_Local'>dbform</span><span class='Delimiter'>; 
</span> 
        <a href="postinit.c.html#LN855"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="postinit.c.html#LN65"><span class='Ref_to_Proto'>GetDatabaseTupleByOid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>dboid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN855"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_DATABASE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"database %u does not exist"</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>dboid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="postinit.c.html#LN856"><span class='Ref_To_Local'>dbform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN855"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN855"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a> <span class='Operator'>= </span><a href="postinit.c.html#LN856"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>dattablespace<span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a> <span class='Operator'>== </span><a href="postinit.c.html#LN557"><span class='Ref_to_Parameter'>dboid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN563"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN856"><span class='Ref_To_Local'>dbform</span></a><span class='Operator'>-&GT;</span>datname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postinit.c.html#LN563"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* pass the database name back to the caller */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postinit.c.html#LN558"><span class='Ref_to_Parameter'>out_dbname</span></a><span class='Parentheses'>) 
</span>            <a href="../../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN558"><span class='Ref_to_Parameter'>out_dbname</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN563"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if OidIsValid(dboid) &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If this is a background worker not bound to any particular 
         * database, we're done now.  Everything that follows only makes sense 
         * if we are bound to a specific database.  We do need to close the 
         * transaction we started before returning. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/pgstat.h.html#LN1166"><span class='Ref_to_Proto'>pgstat_bestart</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/xact.h.html#LN349"><span class='Ref_to_Proto'>CommitTransactionCommand</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now, take a writer's lock on the database we are trying to connect to. 
     * If there is a concurrently running DROP DATABASE on that database, this 
     * will block us until it finishes (and has committed its update of 
     * pg_database). 
     * 
     * Note that the lock is not held long, only until the end of this startup 
     * transaction.  This is OK since we will advertise our use of the 
     * database in the ProcArray before dropping the lock (in fact, that's the 
     * next thing to do).  Anyone trying a DROP DATABASE after this point will 
     * see us in the array once they have the lock.  Ordering is important for 
     * this because we don't want to advertise ourselves as being in this 
     * database until we have the lock; otherwise we create what amounts to a 
     * deadlock with CountOtherDBBackends(). 
     * 
     * Note: use of RowExclusiveLock here is reasonable because we envision 
     * our session as being a concurrent writer of the database.  If we had a 
     * way of declaring a session as being guaranteed-read-only, we could use 
     * AccessShareLock for such sessions and thereby not conflict against 
     * CREATE DATABASE. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/storage/lmgr.h.html#LN93"><span class='Ref_to_Proto'>LockSharedObject</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Delimiter'>, </span><a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can mark our PGPROC entry with the database ID. 
     * 
     * We assume this is an atomic store so no lock is needed; though actually 
     * things would work fine even if it weren't atomic.  Anyone searching the 
     * ProcArray for this database's ID should hold the database lock, so they 
     * would not be executing concurrently with this store.  A process looking 
     * for another database's ID could in theory see a chance match if it read 
     * a partially-updated databaseId value; but as long as all such searches 
     * wait and retry, as in CountOtherDBBackends(), they will certainly see 
     * the correct value on their next try. 
     */ 
</span>    <a href="../../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN112"><span class='Ref_to_Member'>databaseId</span></a> <span class='Operator'>= </span><a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We established a catalog snapshot while reading pg_authid and/or 
     * pg_database; but until we have set up MyDatabaseId, we won't react to 
     * incoming sinval messages for unshared catalogs, so we won't realize it 
     * if the snapshot has been invalidated.  Assume it's no good anymore. 
     */ 
</span>    <a href="../../../include/utils/snapmgr.h.html#LN70"><span class='Ref_to_Proto'>InvalidateCatalogSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Recheck pg_database to make sure the target database hasn't gone away. 
     * If there was a concurrent DROP DATABASE, this ensures we will die 
     * cleanly without creating a mess. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN942"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="postinit.c.html#LN942"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="postinit.c.html#LN64"><span class='Ref_to_Proto'>GetDatabaseTuple</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN563"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN942"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>            <a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a> <span class='Operator'>!= </span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN942"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>            <a href="globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a> <span class='Operator'>!= </span><span class='Parentheses'>((</span><a href="../../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN942"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>dattablespace<span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_DATABASE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"database \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN563"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"It seems to have just been dropped or renamed."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we should be able to access the database directory safely. Verify 
     * it's there and looks reasonable. 
     */ 
</span>    <a href="postinit.c.html#LN562"><span class='Ref_To_Local'>fullpath</span></a> <span class='Operator'>= </span><a href="../../../include/common/relpath.h.html#LN50"><span class='Ref_to_Proto'>GetDatabasePath</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, </span><a href="globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>access<span class='Parentheses'>(</span><a href="postinit.c.html#LN562"><span class='Ref_To_Local'>fullpath</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32.h.html#LN432"><span class='Ref_to_Const'>F_OK</span></a><span class='Parentheses'>) </span><span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_DATABASE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"database \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                                <a href="postinit.c.html#LN563"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The database subdirectory \"%s\" is missing."</span><span class='Delimiter'>, 
</span>                              <a href="postinit.c.html#LN562"><span class='Ref_To_Local'>fullpath</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not access directory \"%s\": %m"</span><span class='Delimiter'>, 
</span>                                <a href="postinit.c.html#LN562"><span class='Ref_To_Local'>fullpath</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/miscadmin.h.html#LN464"><span class='Ref_to_Proto'>ValidatePgVersion</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN562"><span class='Ref_To_Local'>fullpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !bootstrap &raquo; </span> 
 
    <a href="miscinit.c.html#LN80"><span class='Ref_to_Func'>SetDatabasePath</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN562"><span class='Ref_To_Local'>fullpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's now possible to do real access to the system catalogs. 
     * 
     * Load relcache entries for the system catalogs.  This must create at 
     * least the minimum set of "nailed-in" cache entries. 
     */ 
</span>    <a href="../../../include/utils/relcache.h.html#LN86"><span class='Ref_to_Proto'>RelationCacheInitializePhase3</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up ACL framework (so CheckMyDatabase can check permissions) */ 
</span>    <a href="../../../include/utils/acl.h.html#LN245"><span class='Ref_to_Proto'>initialize_acl</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Re-read the pg_database row for our database, check permissions and set 
     * up database-specific GUC settings.  We can't do this until all the 
     * database-access infrastructure is up.  (Also, it wants to know if the 
     * user is a superuser, so the above stuff has to happen first.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>        <a href="postinit.c.html#LN67"><span class='Ref_to_Proto'>CheckMyDatabase</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN563"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now process any command-line switches and any additional GUC variable 
     * settings passed in the startup packet.   We couldn't do this before 
     * because we didn't know if client is a superuser. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="postinit.c.html#LN74"><span class='Ref_to_Proto'>process_startup_options</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN40"><span class='Ref_to_Global_Var'>MyProcPort</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN561"><span class='Ref_To_Local'>am_superuser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process pg_db_role_setting options */ 
</span>    <a href="postinit.c.html#LN75"><span class='Ref_to_Proto'>process_settings</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, </span><a href="../../../include/miscadmin.h.html#LN310"><span class='Ref_to_Proto'>GetSessionUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Apply PostAuthDelay as soon as we've read all options */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../tcop/postgres.c.html#LN98"><span class='Ref_to_Global_Var'>PostAuthDelay</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><a href="../../tcop/postgres.c.html#LN98"><span class='Ref_to_Global_Var'>PostAuthDelay</span></a> <span class='Operator'>* </span><span class='Number'>1000000L</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize various default states that can't be set up until we've 
     * selected the active user and gotten the right GUC settings. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* set default namespace search path */ 
</span>    <a href="../../../include/catalog/namespace.h.html#LN148"><span class='Ref_to_Proto'>InitializeSearchPath</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* initialize client encoding */ 
</span>    <a href="../mb/mbutils.c.html#LN291"><span class='Ref_to_Func'>InitializeClientEncoding</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* report this backend in the PgBackendStatus array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/pgstat.h.html#LN1166"><span class='Ref_to_Proto'>pgstat_bestart</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* close the transaction we started above */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postinit.c.html#LN560"><span class='Ref_To_Local'>bootstrap</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/access/xact.h.html#LN349"><span class='Ref_to_Proto'>CommitTransactionCommand</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end InitPostgres &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Process any command-line switches and any additional GUC variable 
 * settings passed in the startup packet. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1043"></a><span class='Declare_Function'>process_startup_options</span><span class='Parentheses'>(</span><a href="../../../include/libpq/libpq-be.h.html#LN115"><span class='Ref_to_Struct'>Port</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>port</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>am_superuser</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1045"></a>    <a href="../../../include/utils/guc.h.html#LN67"><span class='Ref_to_Typedef'>GucContext</span></a>  <span class='Declare_Local'>gucctx</span><span class='Delimiter'>; 
</span><a name="LN1046"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>gucopts</span><span class='Delimiter'>; 
</span> 
    <a href="postinit.c.html#LN1045"><span class='Ref_To_Local'>gucctx</span></a> <span class='Operator'>= </span><a href="postinit.c.html#LN1043"><span class='Ref_to_Parameter'>am_superuser</span></a> <span class='Operator'>? </span><a href="../../../include/utils/guc.h.html#LN72"><span class='Ref_to_EnumConst'>PGC_SU_BACKEND</span></a> <span class='Operator'>: </span><a href="../../../include/utils/guc.h.html#LN73"><span class='Ref_to_EnumConst'>PGC_BACKEND</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First process any command-line switches that were included in the 
     * startup packet, if we are in a regular backend. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postinit.c.html#LN1043"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN137"><span class='Ref_to_Member'>cmdline_options</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The maximum possible number of commandline arguments that could 
         * come from port-&GT;cmdline_options is (strlen + 1) / 2; see 
         * pg_split_opts(). 
         */ 
</span><a name="LN1061"></a>        <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>av</span><span class='Delimiter'>; 
</span><a name="LN1062"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>maxac</span><span class='Delimiter'>; 
</span><a name="LN1063"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ac</span><span class='Delimiter'>; 
</span> 
        <a href="postinit.c.html#LN1062"><span class='Ref_To_Local'>maxac</span></a> <span class='Operator'>= </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="postinit.c.html#LN1043"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN137"><span class='Ref_to_Member'>cmdline_options</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
        <a href="postinit.c.html#LN1061"><span class='Ref_To_Local'>av</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1062"><span class='Ref_To_Local'>maxac</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="postinit.c.html#LN1063"><span class='Ref_To_Local'>ac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="postinit.c.html#LN1061"><span class='Ref_To_Local'>av</span></a><span class='Delimiter'>[</span><a href="postinit.c.html#LN1063"><span class='Ref_To_Local'>ac</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"postgres"</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/miscadmin.h.html#LN420"><span class='Ref_to_Proto'>pg_split_opts</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1061"><span class='Ref_To_Local'>av</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postinit.c.html#LN1063"><span class='Ref_To_Local'>ac</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1043"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN137"><span class='Ref_to_Member'>cmdline_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postinit.c.html#LN1061"><span class='Ref_To_Local'>av</span></a><span class='Delimiter'>[</span><a href="postinit.c.html#LN1063"><span class='Ref_To_Local'>ac</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postinit.c.html#LN1063"><span class='Ref_To_Local'>ac</span></a> <span class='Operator'>&LT; </span><a href="postinit.c.html#LN1062"><span class='Ref_To_Local'>maxac</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/tcop/tcopprot.h.html#LN76"><span class='Ref_to_Proto'>process_postgres_switches</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1063"><span class='Ref_To_Local'>ac</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1061"><span class='Ref_To_Local'>av</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1045"><span class='Ref_To_Local'>gucctx</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if port-&GT;cmdline_options... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Process any additional GUC variable settings passed in startup packet. 
     * These are handled exactly like command-line variables. 
     */ 
</span>    <a href="postinit.c.html#LN1046"><span class='Ref_To_Local'>gucopts</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1043"><span class='Ref_to_Parameter'>port</span></a><span class='Operator'>-&GT;</span><a href="../../../include/libpq/libpq-be.h.html#LN138"><span class='Ref_to_Member'>guc_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="postinit.c.html#LN1046"><span class='Ref_To_Local'>gucopts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1088"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span><span class='Delimiter'>; 
</span><a name="LN1089"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span> 
        <a href="postinit.c.html#LN1088"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1046"><span class='Ref_To_Local'>gucopts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postinit.c.html#LN1046"><span class='Ref_To_Local'>gucopts</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1046"><span class='Ref_To_Local'>gucopts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1046"><span class='Ref_To_Local'>gucopts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postinit.c.html#LN1046"><span class='Ref_To_Local'>gucopts</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1046"><span class='Ref_To_Local'>gucopts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/guc.h.html#LN276"><span class='Ref_to_Proto'>SetConfigOption</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1088"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="postinit.c.html#LN1045"><span class='Ref_To_Local'>gucctx</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN115"><span class='Ref_to_EnumConst'>PGC_S_CLIENT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end process_startup_options &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Load GUC settings from pg_db_role_setting. 
 * 
 * We try specific settings for the database/role combination, as well as 
 * general for this database and for this user. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1108"></a><span class='Declare_Function'>process_settings</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>databaseid</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1110"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relsetting</span><span class='Delimiter'>; 
</span><a name="LN1111"></a>    <a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="postinit.c.html#LN1110"><span class='Ref_To_Local'>relsetting</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_db_role_setting.h.html#LN32"><span class='Ref_to_Const'>DbRoleSettingRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* read all the settings under the same snapshot for efficiency */ 
</span>    <a href="postinit.c.html#LN1111"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/snapmgr.h.html#LN68"><span class='Ref_to_Proto'>GetCatalogSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_db_role_setting.h.html#LN32"><span class='Ref_to_Const'>DbRoleSettingRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Later settings are ignored if set earlier. */ 
</span>    <a href="../../../include/catalog/pg_db_role_setting.h.html#LN65"><span class='Ref_to_Proto'>ApplySetting</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1111"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1108"><span class='Ref_to_Parameter'>databaseid</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1108"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1110"><span class='Ref_To_Local'>relsetting</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN114"><span class='Ref_to_EnumConst'>PGC_S_DATABASE_USER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/catalog/pg_db_role_setting.h.html#LN65"><span class='Ref_to_Proto'>ApplySetting</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1111"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1108"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1110"><span class='Ref_To_Local'>relsetting</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN113"><span class='Ref_to_EnumConst'>PGC_S_USER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/catalog/pg_db_role_setting.h.html#LN65"><span class='Ref_to_Proto'>ApplySetting</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1111"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1108"><span class='Ref_to_Parameter'>databaseid</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1110"><span class='Ref_To_Local'>relsetting</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN112"><span class='Ref_to_EnumConst'>PGC_S_DATABASE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/catalog/pg_db_role_setting.h.html#LN65"><span class='Ref_to_Proto'>ApplySetting</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1111"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1110"><span class='Ref_To_Local'>relsetting</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/guc.h.html#LN111"><span class='Ref_to_EnumConst'>PGC_S_GLOBAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1111"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1110"><span class='Ref_To_Local'>relsetting</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end process_settings &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Backend-shutdown callback.  Do cleanup that we want to be sure happens 
 * before all the supporting modules begin to nail their doors shut via 
 * their own callbacks. 
 * 
 * User-level cleanup, such as temp-relation removal and UNLISTEN, happens 
 * via separate callbacks that execute before this one.  We don't combine the 
 * callbacks because we still want this one to happen if the user-level 
 * cleanup fails. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1142"></a><span class='Declare_Function'>ShutdownPostgres</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Make sure we've killed any active transaction */ 
</span>    <a href="../../../include/access/xact.h.html#LN369"><span class='Ref_to_Proto'>AbortOutOfAnyTransaction</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * User locks are not released by transaction end, so be sure to release 
     * them explicitly. 
     */ 
</span>    <a href="../../../include/storage/lock.h.html#LN535"><span class='Ref_to_Proto'>LockReleaseAll</span></a><span class='Parentheses'>(</span><a href="../../../include/storage/lock.h.html#LN129"><span class='Ref_to_Const'>USER_LOCKMETHOD</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * STATEMENT_TIMEOUT handler: trigger a query-cancel interrupt. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1159"></a><span class='Declare_Function'>StatementTimeoutHandler</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1161"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sig</span> <span class='Operator'>= </span>SIGINT<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * During authentication the timeout is used to deal with 
     * authentication_timeout - we want to quit in response to such timeouts. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../postmaster/postmaster.c.html#LN347"><span class='Ref_to_Global_Var'>ClientAuthInProgress</span></a><span class='Parentheses'>) 
</span>        <a href="postinit.c.html#LN1161"><span class='Ref_To_Local'>sig</span></a> <span class='Operator'>= </span>SIGTERM<span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_SETSID 
    <span class='Comment_Multi_Line'>/* try to signal whole process group */ 
</span>    <a href="../../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><a href="globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1161"><span class='Ref_To_Local'>sig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <a href="../../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Delimiter'>, </span><a href="postinit.c.html#LN1161"><span class='Ref_To_Local'>sig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * LOCK_TIMEOUT handler: trigger a query-cancel interrupt. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1181"></a><span class='Declare_Function'>LockTimeoutHandler</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> HAVE_SETSID 
    <span class='Comment_Multi_Line'>/* try to signal whole process group */ 
</span>    <a href="../../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><a href="globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Delimiter'>, </span>SIGINT<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <a href="../../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN38"><span class='Ref_to_Global_Var'>MyProcPid</span></a><span class='Delimiter'>, </span>SIGINT<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1191"></a><span class='Declare_Function'>IdleInTransactionSessionTimeoutHandler</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="globals.c.html#LN32"><span class='Ref_to_Global_Var'>IdleInTransactionSessionTimeoutPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="globals.c.html#LN28"><span class='Ref_to_Global_Var'>InterruptPending</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/latch.h.html#LN151"><span class='Ref_to_Proto'>SetLatch</span></a><span class='Parentheses'>(</span><a href="globals.c.html#LN51"><span class='Ref_to_Global_Var'>MyLatch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Returns true if at least one role is defined in this database cluster. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1202"></a><span class='Declare_Function'>ThereIsAtLeastOneRole</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1204"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_authid_rel</span><span class='Delimiter'>; 
</span><a name="LN1205"></a>    <a href="../../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN1206"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="postinit.c.html#LN1204"><span class='Ref_To_Local'>pg_authid_rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postinit.c.html#LN1205"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN110"><span class='Ref_to_Proto'>heap_beginscan_catalog</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1204"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postinit.c.html#LN1206"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1205"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1205"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="postinit.c.html#LN1204"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postinit.c.html#LN1206"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>