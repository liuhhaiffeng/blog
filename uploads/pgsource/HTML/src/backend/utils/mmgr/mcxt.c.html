<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\mmgr\mcxt.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\mmgr\mcxt.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:58 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * mcxt.c 
 *    POSTGRES memory context management code. 
 * 
 * This module handles context management operations that are independent 
 * of the particular kind of context being operated on.  It calls 
 * context-type-specific operations via the function pointers in a 
 * context's MemoryContextMethods struct. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/mmgr/mcxt.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memdebug.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *    GLOBAL MEMORY                                                          * 
 *****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * CurrentMemoryContext 
 *      Default memory context for allocations. 
 */ 
</span><a name="LN36"></a><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>CurrentMemoryContext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Standard top-level contexts. For a description of the purpose of each 
 * of these contexts, refer to src/backend/utils/mmgr/README 
 */ 
</span><a name="LN42"></a><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>TopMemoryContext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN43"></a><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>ErrorContext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN44"></a><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>PostmasterContext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN45"></a><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>CacheMemoryContext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN46"></a><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>MessageContext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN47"></a><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>TopTransactionContext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN48"></a><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>CurTransactionContext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* This is a transient link to the active portal's memory context: */ 
</span><a name="LN51"></a><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>PortalContext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN53"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>MemoryContextCallResetCallbacks</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>MemoryContextStatsInternal</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, 
</span><a name="LN55"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>print</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>max_children</span><span class='Delimiter'>, 
</span><a name="LN56"></a>                           <a href="../../../include/nodes/memnodes.h.html#LN28"><span class='Ref_to_Struct'>MemoryContextCounters</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>totals</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * You should not do memory allocations within a critical section, because 
 * an out-of-memory error will be escalated to a PANIC. To enforce that 
 * rule, the allocation functions Assert that. 
 */ 
</span><a name="LN63"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>AssertNotInCriticalSection</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN36"><span class='Ref_to_Global_Var'>CritSectionCount</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="mcxt.c.html#LN63"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>allowInCritSection<span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *    EXPORTED ROUTINES                                                      * 
 *****************************************************************************/ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextInit 
 *      Start up the memory-context subsystem. 
 * 
 * This must be called before creating contexts or allocating memory in 
 * contexts.  TopMemoryContext and ErrorContext are initialized here; 
 * other contexts must be created afterwards. 
 * 
 * In normal multi-backend operation, this is called once during 
 * postmaster startup, and not at all by individual backend startup 
 * (since the backends inherit an already-initialized context subsystem 
 * by virtue of being forked off the postmaster).  But in an EXEC_BACKEND 
 * build, each process must do this for itself. 
 * 
 * In a standalone backend this must be called during backend startup. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN88"></a><span class='Declare_Function'>MemoryContextInit</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/c.h.html#LN677"><span class='Ref_to_Macro'>AssertState</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, initialize TopMemoryContext, which will hold the MemoryContext 
     * nodes for all other contexts.  (There is special-case code in 
     * MemoryContextCreate() to handle this call.) 
     */ 
</span>    <a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>((</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                             <span class='String'>"TopMemoryContext"</span><span class='Delimiter'>, 
</span>                                             <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Not having any other place to point CurrentMemoryContext, make it point 
     * to TopMemoryContext.  Caller should change this soon! 
     */ 
</span>    <a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize ErrorContext as an AllocSetContext with slow growth rate --- 
     * we don't really expect much to be allocated in it. More to the point, 
     * require it to contain at least 8K at all times. This is the only case 
     * where retained memory in a context is *essential* --- we want to be 
     * sure ErrorContext still has some memory even if we've run out 
     * elsewhere! Also, allow allocations in ErrorContext within a critical 
     * section. Otherwise a PANIC will cause an assertion failure in the error 
     * reporting code, before printing out the real cause of the failure. 
     * 
     * This should be the last step in this function, as elog.c assumes memory 
     * management works once ErrorContext is non-null. 
     */ 
</span>    <a href="mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                         <span class='String'>"ErrorContext"</span><span class='Delimiter'>, 
</span>                                         <span class='Number'>8</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>, 
</span>                                         <span class='Number'>8</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>, 
</span>                                         <span class='Number'>8</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/memutils.h.html#LN85"><span class='Ref_to_Proto'>MemoryContextAllowInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN43"><span class='Ref_to_Global_Var'>ErrorContext</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MemoryContextInit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextReset 
 *      Release all space allocated within a context and delete all its 
 *      descendant contexts (but not the named context itself). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN134"></a><span class='Declare_Function'>MemoryContextReset</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN134"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* save a function call in common case where there are no children */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN134"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN77"><span class='Ref_to_Proto'>MemoryContextDeleteChildren</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN134"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* save a function call if no pallocs since startup or last reset */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="mcxt.c.html#LN134"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN75"><span class='Ref_to_Proto'>MemoryContextResetOnly</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN134"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextResetOnly 
 *      Release all space allocated within a context. 
 *      Nothing is done to the context's descendant contexts. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN153"></a><span class='Declare_Function'>MemoryContextResetOnly</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN153"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Nothing to do if no pallocs since startup or last reset */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="mcxt.c.html#LN153"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="mcxt.c.html#LN53"><span class='Ref_to_Proto'>MemoryContextCallResetCallbacks</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN153"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN153"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN60"><span class='Ref_to_Member'>reset</span></a><span class='Parentheses'>) (</span><a href="mcxt.c.html#LN153"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="mcxt.c.html#LN153"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/memdebug.h.html#LN24"><span class='Ref_to_Macro'>VALGRIND_DESTROY_MEMPOOL</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN153"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/memdebug.h.html#LN23"><span class='Ref_to_Macro'>VALGRIND_CREATE_MEMPOOL</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN153"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextResetChildren 
 *      Release all space allocated within a context's descendants, 
 *      but don't delete the contexts themselves.  The named context 
 *      itself is not touched. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN175"></a><span class='Declare_Function'>MemoryContextResetChildren</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN177"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN175"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN177"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN175"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a><span class='Delimiter'>; </span><a href="mcxt.c.html#LN177"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="mcxt.c.html#LN177"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN177"><span class='Ref_To_Local'>child</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/memutils.h.html#LN76"><span class='Ref_to_Proto'>MemoryContextResetChildren</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN177"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/memutils.h.html#LN75"><span class='Ref_to_Proto'>MemoryContextResetOnly</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN177"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextDelete 
 *      Delete a context and its descendants, and release all space 
 *      allocated therein. 
 * 
 * The type-specific delete routine removes all subsidiary storage 
 * for the context, but we have to delete the context node itself, 
 * as well as recurse to get the children.  We must also delink the 
 * node from its parent, if it has one. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN199"></a><span class='Declare_Function'>MemoryContextDelete</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN199"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* We had better not be deleting TopMemoryContext ... */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="mcxt.c.html#LN199"><span class='Ref_to_Parameter'>context</span></a> <span class='Operator'>!= </span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* And not CurrentMemoryContext, either */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="mcxt.c.html#LN199"><span class='Ref_to_Parameter'>context</span></a> <span class='Operator'>!= </span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/memutils.h.html#LN77"><span class='Ref_to_Proto'>MemoryContextDeleteChildren</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN199"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's not entirely clear whether 'tis better to do this before or after 
     * delinking the context; but an error in a callback will likely result in 
     * leaking the whole context (if it's not a root context) if we do it 
     * after, so let's do it before. 
     */ 
</span>    <a href="mcxt.c.html#LN53"><span class='Ref_to_Proto'>MemoryContextCallResetCallbacks</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN199"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We delink the context from its parent before deleting it, so that if 
     * there's an error we won't have deleted/busted contexts still attached 
     * to the context tree.  Better a leak than a crash. 
     */ 
</span>    <a href="../../../include/utils/memutils.h.html#LN78"><span class='Ref_to_Proto'>MemoryContextSetParent</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN199"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN199"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN61"><span class='Ref_to_Member'>delete_context</span></a><span class='Parentheses'>) (</span><a href="mcxt.c.html#LN199"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/memdebug.h.html#LN24"><span class='Ref_to_Macro'>VALGRIND_DESTROY_MEMPOOL</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN199"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN199"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MemoryContextDelete &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextDeleteChildren 
 *      Delete all the descendants of the named context and release all 
 *      space allocated therein.  The named context itself is not touched. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN235"></a><span class='Declare_Function'>MemoryContextDeleteChildren</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN235"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * MemoryContextDelete will delink the child from me, so just iterate as 
     * long as there is a child. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN235"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN235"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextRegisterResetCallback 
 *      Register a function to be called before next context reset/delete. 
 *      Such callbacks will be called in reverse order of registration. 
 * 
 * The caller is responsible for allocating a MemoryContextCallback struct 
 * to hold the info about this callback request, and for filling in the 
 * "func" and "arg" fields in the struct to show what function to call with 
 * what argument.  Typically the callback struct should be allocated within 
 * the specified context, since that means it will automatically be freed 
 * when no longer needed. 
 * 
 * There is no API for deregistering a callback once registered.  If you 
 * want it to not do anything anymore, adjust the state pointed to by its 
 * "arg" to indicate that. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN264"></a><span class='Declare_Function'>MemoryContextRegisterResetCallback</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, 
</span><a name="LN265"></a>                                   <a href="../../../include/utils/palloc.h.html#LN46"><span class='Ref_to_Struct'>MemoryContextCallback</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cb</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN264"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Push onto head so this will be called before older registrants. */ 
</span>    <a href="mcxt.c.html#LN265"><span class='Ref_to_Parameter'>cb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/palloc.h.html#LN50"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN264"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN84"><span class='Ref_to_Member'>reset_cbs</span></a><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN264"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN84"><span class='Ref_to_Member'>reset_cbs</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN265"><span class='Ref_to_Parameter'>cb</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Mark the context as non-reset (it probably is already). */ 
</span>    <a href="mcxt.c.html#LN264"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextCallResetCallbacks 
 *      Internal function to call all registered callbacks for context. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN281"></a><span class='Declare_Function'>MemoryContextCallResetCallbacks</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN283"></a>    <a href="../../../include/utils/palloc.h.html#LN46"><span class='Ref_to_Struct'>MemoryContextCallback</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cb</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We pop each callback from the list before calling.  That way, if an 
     * error occurs inside the callback, we won't try to call it a second time 
     * in the likely event that we reset or delete the context later. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="mcxt.c.html#LN283"><span class='Ref_To_Local'>cb</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN281"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN84"><span class='Ref_to_Member'>reset_cbs</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="mcxt.c.html#LN281"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN84"><span class='Ref_to_Member'>reset_cbs</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN283"><span class='Ref_To_Local'>cb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/palloc.h.html#LN50"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN283"><span class='Ref_To_Local'>cb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/palloc.h.html#LN48"><span class='Ref_to_Member'>func</span></a><span class='Parentheses'>) (</span><a href="mcxt.c.html#LN283"><span class='Ref_To_Local'>cb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/palloc.h.html#LN49"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextSetParent 
 *      Change a context to belong to a new parent (or no parent). 
 * 
 * We provide this as an API function because it is sometimes useful to 
 * change a context's lifespan after creation.  For example, a context 
 * might be created underneath a transient context, filled with data, 
 * and then reparented underneath CacheMemoryContext to make it long-lived. 
 * In this way no special effort is needed to get rid of the context in case 
 * a failure occurs before its contents are completely set up. 
 * 
 * Callers often assume that this function cannot fail, so don't put any 
 * elog(ERROR) calls in it. 
 * 
 * A possible caller error is to reparent a context under itself, creating 
 * a loop in the context graph.  We assert here that context != new_parent, 
 * but checking for multi-level loops seems more trouble than it's worth. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN316"></a><span class='Declare_Function'>MemoryContextSetParent</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>new_parent</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a> <span class='Operator'>!= </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>new_parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fast path if it's got correct parent already */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>new_parent</span></a> <span class='Operator'>== </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN79"><span class='Ref_to_Member'>parent</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Delink from existing parent, if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN79"><span class='Ref_to_Member'>parent</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN328"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>parent</span> <span class='Operator'>= </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN79"><span class='Ref_to_Member'>parent</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN81"><span class='Ref_to_Member'>prevchild</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN81"><span class='Ref_to_Member'>prevchild</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="mcxt.c.html#LN328"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>== </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="mcxt.c.html#LN328"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN81"><span class='Ref_to_Member'>prevchild</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN81"><span class='Ref_to_Member'>prevchild</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* And relink */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>new_parent</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>new_parent</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN79"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>new_parent</span></a><span class='Delimiter'>; 
</span>        <a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN81"><span class='Ref_to_Member'>prevchild</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>new_parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>new_parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>new_parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN81"><span class='Ref_to_Member'>prevchild</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>; 
</span>        <a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>new_parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN79"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN81"><span class='Ref_to_Member'>prevchild</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="mcxt.c.html#LN316"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end MemoryContextSetParent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextAllowInCriticalSection 
 *      Allow/disallow allocations in this memory context within a critical 
 *      section. 
 * 
 * Normally, memory allocations are not allowed within a critical section, 
 * because a failure would lead to PANIC.  There are a few exceptions to 
 * that, like allocations related to debugging code that is not supposed to 
 * be enabled in production.  This function can be used to exempt specific 
 * memory contexts from the assertion in palloc(). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN373"></a><span class='Declare_Function'>MemoryContextAllowInCriticalSection</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>allow</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN373"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN373"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN77"><span class='Ref_to_Member'>allowInCritSection</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN373"><span class='Ref_to_Parameter'>allow</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GetMemoryChunkSpace 
 *      Given a currently-allocated chunk, determine the total space 
 *      it occupies (including all memory-allocation overhead). 
 * 
 * This is useful for measuring the total space occupied by a set of 
 * allocated chunks. 
 */ 
</span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> 
<a name="LN389"></a><span class='Declare_Function'>GetMemoryChunkSpace</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>pointer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN391"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>context</span> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN105"><span class='Ref_to_Func'>GetMemoryChunkContext</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN389"><span class='Ref_to_Parameter'>pointer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN391"><span class='Ref_To_Local'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN62"><span class='Ref_to_Member'>get_chunk_space</span></a><span class='Parentheses'>) (</span><a href="mcxt.c.html#LN391"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, 
</span>                                                <a href="mcxt.c.html#LN389"><span class='Ref_to_Parameter'>pointer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextGetParent 
 *      Get the parent context (if any) of the specified context 
 */ 
</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> 
<a name="LN402"></a><span class='Declare_Function'>MemoryContextGetParent</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN402"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN402"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN79"><span class='Ref_to_Member'>parent</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextIsEmpty 
 *      Is a memory context empty of any allocated space? 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN414"></a><span class='Declare_Function'>MemoryContextIsEmpty</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN414"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For now, we consider a memory context nonempty if it has any children; 
     * perhaps this should be changed later. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN414"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Otherwise use the type-specific inquiry */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN414"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN63"><span class='Ref_to_Member'>is_empty</span></a><span class='Parentheses'>) (</span><a href="mcxt.c.html#LN414"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextStats 
 *      Print statistics about the named context and all its descendants. 
 * 
 * This is just a debugging utility, so it's not very fancy.  However, we do 
 * make some effort to summarize when the output would otherwise be very long. 
 * The statistics are sent to stderr. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN437"></a><span class='Declare_Function'>MemoryContextStats</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* A hard-wired limit on the number of children is usually good enough */ 
</span>    <a href="../../../include/utils/memutils.h.html#LN84"><span class='Ref_to_Proto'>MemoryContextStatsDetail</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN437"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextStatsDetail 
 * 
 * Entry point for use if you want to vary the number of child contexts shown. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN449"></a><span class='Declare_Function'>MemoryContextStatsDetail</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>max_children</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN451"></a>    <a href="../../../include/nodes/memnodes.h.html#LN28"><span class='Ref_to_Struct'>MemoryContextCounters</span></a> <span class='Declare_Local'>grand_totals</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="mcxt.c.html#LN451"><span class='Ref_To_Local'>grand_totals</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="mcxt.c.html#LN451"><span class='Ref_To_Local'>grand_totals</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN54"><span class='Ref_to_Proto'>MemoryContextStatsInternal</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN449"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN449"><span class='Ref_to_Parameter'>max_children</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="mcxt.c.html#LN451"><span class='Ref_To_Local'>grand_totals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>    <span class='String'>"Grand total: %zu bytes in %zd blocks; %zu free (%zd chunks); %zu used\n"</span><span class='Delimiter'>, 
</span>            <a href="mcxt.c.html#LN451"><span class='Ref_To_Local'>grand_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN32"><span class='Ref_to_Member'>totalspace</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN451"><span class='Ref_To_Local'>grand_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN30"><span class='Ref_to_Member'>nblocks</span></a><span class='Delimiter'>, 
</span>            <a href="mcxt.c.html#LN451"><span class='Ref_To_Local'>grand_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN33"><span class='Ref_to_Member'>freespace</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN451"><span class='Ref_To_Local'>grand_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN31"><span class='Ref_to_Member'>freechunks</span></a><span class='Delimiter'>, 
</span>            <a href="mcxt.c.html#LN451"><span class='Ref_To_Local'>grand_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN32"><span class='Ref_to_Member'>totalspace</span></a> <span class='Operator'>- </span><a href="mcxt.c.html#LN451"><span class='Ref_To_Local'>grand_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN33"><span class='Ref_to_Member'>freespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextStatsInternal 
 *      One recursion level for MemoryContextStats 
 * 
 * Print this context if print is true, but in any case accumulate counts into 
 * *totals (if given). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN472"></a><span class='Declare_Function'>MemoryContextStatsInternal</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, 
</span><a name="LN473"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>print</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>max_children</span><span class='Delimiter'>, 
</span><a name="LN474"></a>                           <a href="../../../include/nodes/memnodes.h.html#LN28"><span class='Ref_to_Struct'>MemoryContextCounters</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>totals</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN476"></a>    <a href="../../../include/nodes/memnodes.h.html#LN28"><span class='Ref_to_Struct'>MemoryContextCounters</span></a> <span class='Declare_Local'>local_totals</span><span class='Delimiter'>; 
</span><a name="LN477"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span><a name="LN478"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ichild</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN472"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Examine the context itself */ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN472"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN64"><span class='Ref_to_Member'>stats</span></a><span class='Parentheses'>) (</span><a href="mcxt.c.html#LN472"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN472"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN473"><span class='Ref_to_Parameter'>print</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN474"><span class='Ref_to_Parameter'>totals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Examine children.  If there are more than max_children of them, we do 
     * not print the rest explicitly, but just summarize them. 
     */ 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN477"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN472"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN478"><span class='Ref_To_Local'>ichild</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>         <a href="mcxt.c.html#LN477"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>         <a href="mcxt.c.html#LN477"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN477"><span class='Ref_To_Local'>child</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN478"><span class='Ref_To_Local'>ichild</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN478"><span class='Ref_To_Local'>ichild</span></a> <span class='Operator'>&LT; </span><a href="mcxt.c.html#LN473"><span class='Ref_to_Parameter'>max_children</span></a><span class='Parentheses'>) 
</span>            <a href="mcxt.c.html#LN54"><span class='Ref_to_Proto'>MemoryContextStatsInternal</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN477"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN472"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                       <a href="mcxt.c.html#LN473"><span class='Ref_to_Parameter'>print</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN473"><span class='Ref_to_Parameter'>max_children</span></a><span class='Delimiter'>, 
</span>                                       <a href="mcxt.c.html#LN474"><span class='Ref_to_Parameter'>totals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="mcxt.c.html#LN54"><span class='Ref_to_Proto'>MemoryContextStatsInternal</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN477"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN472"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                       <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN473"><span class='Ref_to_Parameter'>max_children</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Deal with excess children */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN478"><span class='Ref_To_Local'>ichild</span></a> <span class='Operator'>&GT; </span><a href="mcxt.c.html#LN473"><span class='Ref_to_Parameter'>max_children</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN473"><span class='Ref_to_Parameter'>print</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN510"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN510"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="mcxt.c.html#LN510"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="mcxt.c.html#LN472"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>; </span><a href="mcxt.c.html#LN510"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="../../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"  "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    <span class='String'>"%d more child contexts containing %zu total in %zd blocks; %zu free (%zd chunks); %zu used\n"</span><span class='Delimiter'>, 
</span>                    <a href="mcxt.c.html#LN478"><span class='Ref_To_Local'>ichild</span></a> <span class='Operator'>- </span><a href="mcxt.c.html#LN473"><span class='Ref_to_Parameter'>max_children</span></a><span class='Delimiter'>, 
</span>                    <a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN32"><span class='Ref_to_Member'>totalspace</span></a><span class='Delimiter'>, 
</span>                    <a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN30"><span class='Ref_to_Member'>nblocks</span></a><span class='Delimiter'>, 
</span>                    <a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN33"><span class='Ref_to_Member'>freespace</span></a><span class='Delimiter'>, 
</span>                    <a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN31"><span class='Ref_to_Member'>freechunks</span></a><span class='Delimiter'>, 
</span>                    <a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN32"><span class='Ref_to_Member'>totalspace</span></a> <span class='Operator'>- </span><a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN33"><span class='Ref_to_Member'>freespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN474"><span class='Ref_to_Parameter'>totals</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="mcxt.c.html#LN474"><span class='Ref_to_Parameter'>totals</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN30"><span class='Ref_to_Member'>nblocks</span></a> <span class='Operator'>+= </span><a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN30"><span class='Ref_to_Member'>nblocks</span></a><span class='Delimiter'>; 
</span>            <a href="mcxt.c.html#LN474"><span class='Ref_to_Parameter'>totals</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN31"><span class='Ref_to_Member'>freechunks</span></a> <span class='Operator'>+= </span><a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN31"><span class='Ref_to_Member'>freechunks</span></a><span class='Delimiter'>; 
</span>            <a href="mcxt.c.html#LN474"><span class='Ref_to_Parameter'>totals</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN32"><span class='Ref_to_Member'>totalspace</span></a> <span class='Operator'>+= </span><a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN32"><span class='Ref_to_Member'>totalspace</span></a><span class='Delimiter'>; 
</span>            <a href="mcxt.c.html#LN474"><span class='Ref_to_Parameter'>totals</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN33"><span class='Ref_to_Member'>freespace</span></a> <span class='Operator'>+= </span><a href="mcxt.c.html#LN476"><span class='Ref_To_Local'>local_totals</span></a><span class='Operator'>.</span><a href="../../../include/nodes/memnodes.h.html#LN33"><span class='Ref_to_Member'>freespace</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ichild&GT;max_children &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end MemoryContextStatsInternal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextCheck 
 *      Check all chunks in the named context. 
 * 
 * This is just a debugging utility, so it's not fancy. 
 */ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/pg_config_manual.h.html#LN275"><span class='Ref_to_Const'>MEMORY_CONTEXT_CHECKING</span></a> 
<span class='Keyword'>void 
</span><a name="LN542"></a><span class='Declare_Function'>MemoryContextCheck</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN544"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN542"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN542"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN67"><span class='Ref_to_Member'>check</span></a><span class='Parentheses'>) (</span><a href="mcxt.c.html#LN542"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN544"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN542"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a><span class='Delimiter'>; </span><a href="mcxt.c.html#LN544"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="mcxt.c.html#LN544"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN544"><span class='Ref_To_Local'>child</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN89"><span class='Ref_to_Proto'>MemoryContextCheck</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN544"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextContains 
 *      Detect whether an allocated chunk of memory belongs to a given 
 *      context or not. 
 * 
 * Caution: this test is reliable as long as 'pointer' does point to 
 * a chunk of memory allocated from *some* context.  If 'pointer' points 
 * at memory obtained in some other way, there is a small chance of a 
 * false-positive result, since the bits right before it might look like 
 * a valid chunk header by chance. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN566"></a><span class='Declare_Function'>MemoryContextContains</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>pointer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN568"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>ptr_context</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * NB: Can't use GetMemoryChunkContext() here - that performs assertions 
     * that aren't acceptable here since we might be passed memory not 
     * allocated by any memory context. 
     * 
     * Try to detect bogus pointers handed to us, poorly though we can. 
     * Presumably, a pointer that isn't MAXALIGNED isn't pointing at an 
     * allocated chunk. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN566"><span class='Ref_to_Parameter'>pointer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="mcxt.c.html#LN566"><span class='Ref_to_Parameter'>pointer</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN566"><span class='Ref_to_Parameter'>pointer</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, it's probably safe to look at the context. 
     */ 
</span>    <a href="mcxt.c.html#LN568"><span class='Ref_To_Local'>ptr_context</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="mcxt.c.html#LN566"><span class='Ref_to_Parameter'>pointer</span></a><span class='Parentheses'>)</span> <span class='Operator'>- </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN568"><span class='Ref_To_Local'>ptr_context</span></a> <span class='Operator'>== </span><a href="mcxt.c.html#LN566"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MemoryContextContains &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*-------------------- 
 * MemoryContextCreate 
 *      Context-type-independent part of context creation. 
 * 
 * This is only intended to be called by context-type-specific 
 * context creation routines, not by the unwashed masses. 
 * 
 * The context creation procedure is a little bit tricky because 
 * we want to be sure that we don't leave the context tree invalid 
 * in case of failure (such as insufficient memory to allocate the 
 * context node itself).  The procedure goes like this: 
 *  1.  Context-type-specific routine first calls MemoryContextCreate(), 
 *      passing the appropriate tag/size/methods values (the methods 
 *      pointer will ordinarily point to statically allocated data). 
 *      The parent and name parameters usually come from the caller. 
 *  2.  MemoryContextCreate() attempts to allocate the context node, 
 *      plus space for the name.  If this fails we can ereport() with no 
 *      damage done. 
 *  3.  We fill in all of the type-independent MemoryContext fields. 
 *  4.  We call the type-specific init routine (using the methods pointer). 
 *      The init routine is required to make the node minimally valid 
 *      with zero chance of failure --- it can't allocate more memory, 
 *      for example. 
 *  5.  Now we have a minimally valid node that can behave correctly 
 *      when told to reset or delete itself.  We link the node to its 
 *      parent (if any), making the node part of the context tree. 
 *  6.  We return to the context-type-specific routine, which finishes 
 *      up type-specific initialization.  This routine can now do things 
 *      that might fail (like allocate more memory), so long as it's 
 *      sure the node is left in a state that delete will handle. 
 * 
 * This protocol doesn't prevent us from leaking memory if step 6 fails 
 * during creation of a top-level context, since there's no parent link 
 * in that case.  However, if you run out of memory while you're building 
 * a top-level context, you might as well go home anyway... 
 * 
 * Normally, the context node and the name are allocated from 
 * TopMemoryContext (NOT from the parent context, since the node must 
 * survive resets of its parent context!).  However, this routine is itself 
 * used to create TopMemoryContext!  If we see that TopMemoryContext is NULL, 
 * we assume we are creating TopMemoryContext and use malloc() to allocate 
 * the node. 
 * 
 * Note that the name field of a MemoryContext does not point to 
 * separately-allocated storage, so it should not be freed at context 
 * deletion. 
 *-------------------- 
 */ 
</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> 
<a name="LN639"></a><span class='Declare_Function'>MemoryContextCreate</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN25"><span class='Ref_to_Enum'>NodeTag</span></a> <span class='Declare_Parameter'>tag</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Delimiter'>, 
</span><a name="LN640"></a>                    <a href="../../../include/nodes/memnodes.h.html#LN53"><span class='Ref_to_Struct'>MemoryContextMethods</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>methods</span><span class='Delimiter'>, 
</span><a name="LN641"></a>                    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>parent</span><span class='Delimiter'>, 
</span><a name="LN642"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN644"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>node</span><span class='Delimiter'>; 
</span><a name="LN645"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>needed</span> <span class='Operator'>= </span><a href="mcxt.c.html#LN639"><span class='Ref_to_Parameter'>size</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="mcxt.c.html#LN642"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* creating new memory contexts is not allowed in a critical section */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN36"><span class='Ref_to_Global_Var'>CritSectionCount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get space for node and name */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Normal case: allocate the node in TopMemoryContext */ 
</span>        <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                  <a href="mcxt.c.html#LN645"><span class='Ref_To_Local'>needed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Special case for startup: use good ol' malloc */ 
</span>        <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a><span class='Parentheses'>) </span><a href="../../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN645"><span class='Ref_To_Local'>needed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize the node as best we can */ 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN639"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN74"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN639"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN640"><span class='Ref_to_Parameter'>methods</span></a><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN79"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* for the moment */ 
</span>    <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN81"><span class='Ref_to_Member'>prevchild</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN83"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="mcxt.c.html#LN639"><span class='Ref_to_Parameter'>size</span></a><span class='Delimiter'>; 
</span>    <a href="../../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN83"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN642"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Type-specific routine finishes any other essential initialization */ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN59"><span class='Ref_to_Member'>init</span></a><span class='Parentheses'>) (</span><a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OK to link node to parent (if any) */ 
</span>    <span class='Comment_Multi_Line'>/* Could use MemoryContextSetParent here, but doesn't seem worthwhile */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN641"><span class='Ref_to_Parameter'>parent</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN79"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN641"><span class='Ref_to_Parameter'>parent</span></a><span class='Delimiter'>; 
</span>        <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN82"><span class='Ref_to_Member'>nextchild</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN641"><span class='Ref_to_Parameter'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN641"><span class='Ref_to_Parameter'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="mcxt.c.html#LN641"><span class='Ref_to_Parameter'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN81"><span class='Ref_to_Member'>prevchild</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span>        <a href="mcxt.c.html#LN641"><span class='Ref_to_Parameter'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN80"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* inherit allowInCritSection flag from parent */ 
</span>        <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN77"><span class='Ref_to_Member'>allowInCritSection</span></a> <span class='Operator'>= </span><a href="mcxt.c.html#LN641"><span class='Ref_to_Parameter'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN77"><span class='Ref_to_Member'>allowInCritSection</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN23"><span class='Ref_to_Macro'>VALGRIND_CREATE_MEMPOOL</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return to type-specific creation routine to finish up */ 
</span>    <span class='Control'>return</span> <a href="mcxt.c.html#LN644"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MemoryContextCreate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextAlloc 
 *      Allocate space within the specified context. 
 * 
 * This could be turned into a macro, but we'd have to import 
 * nodes/memnodes.h into postgres.h which seems a bad idea. 
 */ 
</span><span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN706"></a><span class='Declare_Function'>MemoryContextAlloc</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN708"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN63"><span class='Ref_to_Macro'>AssertNotInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid memory alloc request size %zu"</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN708"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span>alloc<span class='Parentheses'>) (</span><a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN708"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failed on request of size %zu."</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN28"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_ALLOC</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN708"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN706"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN708"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MemoryContextAlloc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextAllocZero 
 *      Like MemoryContextAlloc, but clears allocated memory 
 * 
 *  We could just call MemoryContextAlloc then clear the memory, but this 
 *  is a very common combination, so we provide the combined operation. 
 */ 
</span><span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN741"></a><span class='Declare_Function'>MemoryContextAllocZero</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN743"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN63"><span class='Ref_to_Macro'>AssertNotInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid memory alloc request size %zu"</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN743"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span>alloc<span class='Parentheses'>) (</span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN743"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failed on request of size %zu."</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN28"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_ALLOC</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN743"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN889"><span class='Ref_to_Macro'>MemSetAligned</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN743"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN741"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN743"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MemoryContextAllocZero &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextAllocZeroAligned 
 *      MemoryContextAllocZero where length is suitable for MemSetLoop 
 * 
 *  This might seem overly specialized, but it's not because newNode() 
 *  is so often called with compile-time-constant sizes. 
 */ 
</span><span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN778"></a><span class='Declare_Function'>MemoryContextAllocZeroAligned</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN780"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN63"><span class='Ref_to_Macro'>AssertNotInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid memory alloc request size %zu"</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN780"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span>alloc<span class='Parentheses'>) (</span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN780"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failed on request of size %zu."</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN28"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_ALLOC</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN780"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN924"><span class='Ref_to_Macro'>MemSetLoop</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN780"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN778"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN780"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MemoryContextAllocZeroAligned &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextAllocExtended 
 *      Allocate space within the specified context using the given flags. 
 */ 
</span><span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN812"></a><span class='Declare_Function'>MemoryContextAllocExtended</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>flags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN814"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN63"><span class='Ref_to_Macro'>AssertNotInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/common/fe_memutils.h.html#LN15"><span class='Ref_to_Const'>MCXT_ALLOC_HUGE</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../../include/utils/memutils.h.html#LN45"><span class='Ref_to_Macro'>AllocHugeSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>        <span class='Parentheses'>((</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/common/fe_memutils.h.html#LN15"><span class='Ref_to_Const'>MCXT_ALLOC_HUGE</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid memory alloc request size %zu"</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN814"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span>alloc<span class='Parentheses'>) (</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN814"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/common/fe_memutils.h.html#LN17"><span class='Ref_to_Const'>MCXT_ALLOC_NO_OOM</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failed on request of size %zu."</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN28"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_ALLOC</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN814"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/common/fe_memutils.h.html#LN18"><span class='Ref_to_Const'>MCXT_ALLOC_ZERO</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/c.h.html#LN889"><span class='Ref_to_Macro'>MemSetAligned</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN814"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN812"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN814"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MemoryContextAllocExtended &raquo; </span> 
 
<span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN848"></a><span class='Declare_Function'>palloc</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* duplicates MemoryContextAlloc to avoid increased overhead */ 
</span><a name="LN851"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN63"><span class='Ref_to_Macro'>AssertNotInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN848"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid memory alloc request size %zu"</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN848"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN851"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span>alloc<span class='Parentheses'>) (</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN848"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN851"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failed on request of size %zu."</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN848"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN28"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_ALLOC</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN851"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN848"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN851"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end palloc &raquo; </span> 
 
<span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN877"></a><span class='Declare_Function'>palloc0</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* duplicates MemoryContextAllocZero to avoid increased overhead */ 
</span><a name="LN880"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN63"><span class='Ref_to_Macro'>AssertNotInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN877"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid memory alloc request size %zu"</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN877"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN880"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span>alloc<span class='Parentheses'>) (</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN877"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN880"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failed on request of size %zu."</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN877"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN28"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_ALLOC</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN880"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN877"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN889"><span class='Ref_to_Macro'>MemSetAligned</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN880"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN877"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN880"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end palloc0 &raquo; </span> 
 
<span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN908"></a><span class='Declare_Function'>palloc_extended</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>flags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* duplicates MemoryContextAllocExtended to avoid increased overhead */ 
</span><a name="LN911"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN63"><span class='Ref_to_Macro'>AssertNotInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/common/fe_memutils.h.html#LN15"><span class='Ref_to_Const'>MCXT_ALLOC_HUGE</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../../include/utils/memutils.h.html#LN45"><span class='Ref_to_Macro'>AllocHugeSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>        <span class='Parentheses'>((</span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/common/fe_memutils.h.html#LN15"><span class='Ref_to_Const'>MCXT_ALLOC_HUGE</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid memory alloc request size %zu"</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN911"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span>alloc<span class='Parentheses'>) (</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN911"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/common/fe_memutils.h.html#LN17"><span class='Ref_to_Const'>MCXT_ALLOC_NO_OOM</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failed on request of size %zu."</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN28"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_ALLOC</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN911"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/common/fe_memutils.h.html#LN18"><span class='Ref_to_Const'>MCXT_ALLOC_ZERO</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/c.h.html#LN889"><span class='Ref_to_Macro'>MemSetAligned</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN911"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN908"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN911"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end palloc_extended &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pfree 
 *      Release an allocated chunk. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN949"></a><span class='Declare_Function'>pfree</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>pointer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN951"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>context</span> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN105"><span class='Ref_to_Func'>GetMemoryChunkContext</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN949"><span class='Ref_to_Parameter'>pointer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN951"><span class='Ref_To_Local'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN57"><span class='Ref_to_Member'>free_p</span></a><span class='Parentheses'>) (</span><a href="mcxt.c.html#LN951"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN949"><span class='Ref_to_Parameter'>pointer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/memdebug.h.html#LN29"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_FREE</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN951"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN949"><span class='Ref_to_Parameter'>pointer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * repalloc 
 *      Adjust the size of a previously allocated chunk. 
 */ 
</span><span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN962"></a><span class='Declare_Function'>repalloc</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>pointer</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN964"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>context</span> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN105"><span class='Ref_to_Func'>GetMemoryChunkContext</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN962"><span class='Ref_to_Parameter'>pointer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN965"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN41"><span class='Ref_to_Macro'>AllocSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN962"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid memory alloc request size %zu"</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN962"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN63"><span class='Ref_to_Macro'>AssertNotInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN964"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* isReset must be false already */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="mcxt.c.html#LN964"><span class='Ref_To_Local'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN965"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN964"><span class='Ref_To_Local'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span>realloc<span class='Parentheses'>) (</span><a href="mcxt.c.html#LN964"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN962"><span class='Ref_to_Parameter'>pointer</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN962"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN965"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failed on request of size %zu."</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN962"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN30"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_CHANGE</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN964"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN962"><span class='Ref_to_Parameter'>pointer</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN965"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN962"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN965"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end repalloc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextAllocHuge 
 *      Allocate (possibly-expansive) space within the specified context. 
 * 
 * See considerations in comment at MaxAllocHugeSize. 
 */ 
</span><span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN997"></a><span class='Declare_Function'>MemoryContextAllocHuge</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN999"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/memnodes.h.html#LN96"><span class='Ref_to_Macro'>MemoryContextIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN63"><span class='Ref_to_Macro'>AssertNotInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN45"><span class='Ref_to_Macro'>AllocHugeSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid memory alloc request size %zu"</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN999"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span>alloc<span class='Parentheses'>) (</span><a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN999"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failed on request of size %zu."</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN28"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_ALLOC</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN999"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN997"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN999"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MemoryContextAllocHuge &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * repalloc_huge 
 *      Adjust the size of a previously allocated chunk, permitting a large 
 *      value.  The previous allocation need not have been "huge". 
 */ 
</span><span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN1030"></a><span class='Declare_Function'>repalloc_huge</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>pointer</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1032"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>context</span> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN105"><span class='Ref_to_Func'>GetMemoryChunkContext</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN1030"><span class='Ref_to_Parameter'>pointer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1033"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/memutils.h.html#LN45"><span class='Ref_to_Macro'>AllocHugeSizeIsValid</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN1030"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid memory alloc request size %zu"</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1030"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN63"><span class='Ref_to_Macro'>AssertNotInCriticalSection</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN1032"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* isReset must be false already */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="mcxt.c.html#LN1032"><span class='Ref_To_Local'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN76"><span class='Ref_to_Member'>isReset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN1033"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="mcxt.c.html#LN1032"><span class='Ref_To_Local'>context</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/memnodes.h.html#LN78"><span class='Ref_to_Member'>methods</span></a><span class='Operator'>-&GT;</span>realloc<span class='Parentheses'>) (</span><a href="mcxt.c.html#LN1032"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1030"><span class='Ref_to_Parameter'>pointer</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1030"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN1033"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/memutils.h.html#LN83"><span class='Ref_to_Proto'>MemoryContextStats</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failed on request of size %zu."</span><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1030"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/memdebug.h.html#LN30"><span class='Ref_to_Macro'>VALGRIND_MEMPOOL_CHANGE</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN1032"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1030"><span class='Ref_to_Parameter'>pointer</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1033"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1030"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN1033"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end repalloc_huge &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * MemoryContextStrdup 
 *      Like strdup(), but allocate from the specified context 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN1063"></a><span class='Declare_Function'>MemoryContextStrdup</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1065"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nstr</span><span class='Delimiter'>; 
</span><a name="LN1066"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>len</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="mcxt.c.html#LN1063"><span class='Ref_to_Parameter'>string</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN1065"><span class='Ref_To_Local'>nstr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN1063"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1066"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="mcxt.c.html#LN1065"><span class='Ref_To_Local'>nstr</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1063"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1066"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="mcxt.c.html#LN1065"><span class='Ref_To_Local'>nstr</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN1076"></a><span class='Declare_Function'>pstrdup</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>in</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1076"><span class='Ref_to_Parameter'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pnstrdup 
 *      Like pstrdup(), but append null byte to a 
 *      not-necessarily-null-terminated input string. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN1087"></a><span class='Declare_Function'>pnstrdup</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>in</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1089"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN1087"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="mcxt.c.html#LN1089"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1087"><span class='Ref_to_Parameter'>in</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1087"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="mcxt.c.html#LN1089"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>[</span><a href="mcxt.c.html#LN1087"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="mcxt.c.html#LN1089"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Make copy of string with all trailing newline characters removed. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN1100"></a><span class='Declare_Function'>pchomp</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>in</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1102"></a>    size_t      <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span> 
    <a href="mcxt.c.html#LN1102"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="mcxt.c.html#LN1100"><span class='Ref_to_Parameter'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="mcxt.c.html#LN1102"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="mcxt.c.html#LN1100"><span class='Ref_to_Parameter'>in</span></a><span class='Delimiter'>[</span><a href="mcxt.c.html#LN1102"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <a href="mcxt.c.html#LN1102"><span class='Ref_To_Local'>n</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/palloc.h.html#LN127"><span class='Ref_to_Proto'>pnstrdup</span></a><span class='Parentheses'>(</span><a href="mcxt.c.html#LN1100"><span class='Ref_to_Parameter'>in</span></a><span class='Delimiter'>, </span><a href="mcxt.c.html#LN1102"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>