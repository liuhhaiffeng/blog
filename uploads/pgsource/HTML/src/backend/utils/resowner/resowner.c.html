<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\resowner\resowner.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\resowner\resowner.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:58 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * resowner.c 
 *    POSTGRES resource owner management code. 
 * 
 * Query-lifespan resources are tracked by associating them with 
 * ResourceOwner objects.  This provides a simple mechanism for ensuring 
 * that such resources are freed at the right time. 
 * See utils/resowner/README for more info. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/resowner/resowner.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/hash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/predicate.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/resowner_private.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * All resource IDs managed by this code are required to fit into a Datum, 
 * which is fine since they are generally pointers or integers. 
 * 
 * Provide Datum conversion macros for a couple of things that are really 
 * just "int". 
 */ 
</span><a name="LN38"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>FileGetDatum</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>file</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN38"><span class='Ref_to_Parameter'>file</span></a><span class='Parentheses'>) 
</span><a name="LN39"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetFile</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>datum</span><span class='Parentheses'>) ((</span><a href="../../../include/storage/fd.h.html#LN50"><span class='Ref_to_Typedef'>File</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN39"><span class='Ref_to_Parameter'>datum</span></a><span class='Parentheses'>))</span> 
<a name="LN40"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>BufferGetDatum</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN40"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>) 
</span><a name="LN41"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetBuffer</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>datum</span><span class='Parentheses'>) ((</span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN41"><span class='Ref_to_Parameter'>datum</span></a><span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* 
 * ResourceArray is a common structure for storing all types of resource IDs. 
 * 
 * We manage small sets of resource IDs by keeping them in a simple array: 
 * itemsarr[k] holds an ID, for 0 &LT;= k &LT; nitems &LT;= maxitems = capacity. 
 * 
 * If a set grows large, we switch over to using open-addressing hashing. 
 * Then, itemsarr[] is a hash table of "capacity" slots, with each 
 * slot holding either an ID or "invalidval".  nitems is the number of valid 
 * items present; if it would exceed maxitems, we enlarge the array and 
 * re-hash.  In this mode, maxitems should be rather less than capacity so 
 * that we don't waste too much time searching for empty slots. 
 * 
 * In either mode, lastidx remembers the location of the last item inserted 
 * or returned by GetAny; this speeds up searches in ResourceArrayRemove. 
 */ 
</span><a name="LN59"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ResourceArray</span> 
<span class='Delimiter'>{ 
</span><a name="LN61"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>itemsarr</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* buffer for storing values */ 
</span><a name="LN62"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Member'>invalidval</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* value that is considered invalid */ 
</span><a name="LN63"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>capacity</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* allocated length of itemsarr[] */ 
</span><a name="LN64"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>nitems</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* how many items are stored in items array */ 
</span><a name="LN65"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>maxitems</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* current limit on nitems before enlarging */ 
</span><a name="LN66"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>lastidx</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* index of last item returned by GetAny */ 
</span><a name="LN67"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ResourceArray</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Initially allocated size of a ResourceArray.  Must be power of two since 
 * we'll use (arraysize - 1) as mask for hashing. 
 */ 
</span><a name="LN73"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>RESARRAY_INIT_SIZE</span> <span class='Number'>16</span> 
 
<span class='Comment_Multi_Line'>/* 
 * When to switch to hashing vs. simple array logic in a ResourceArray. 
 */ 
</span><a name="LN78"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>RESARRAY_MAX_ARRAY</span> <span class='Number'>64</span> 
<a name="LN79"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>RESARRAY_IS_ARRAY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>resarr</span><span class='Parentheses'>) ((</span><a href="resowner.c.html#LN79"><span class='Ref_to_Parameter'>resarr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>capacity <span class='Operator'>&LT;= </span><a href="resowner.c.html#LN78"><span class='Ref_to_Const'>RESARRAY_MAX_ARRAY</span></a><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * How many items may be stored in a resource array of given capacity. 
 * When this number is reached, we must resize. 
 */ 
</span><a name="LN85"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>RESARRAY_MAX_ITEMS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>capacity</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="resowner.c.html#LN85"><span class='Ref_to_Parameter'>capacity</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><a href="resowner.c.html#LN78"><span class='Ref_to_Const'>RESARRAY_MAX_ARRAY</span></a> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="resowner.c.html#LN85"><span class='Ref_to_Parameter'>capacity</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="resowner.c.html#LN85"><span class='Ref_to_Parameter'>capacity</span></a><span class='Parentheses'>)</span><span class='Operator'>/</span><span class='Number'>4</span> <span class='Operator'>* </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * To speed up bulk releasing or reassigning locks from a resource owner to 
 * its parent, each resource owner has a small cache of locks it owns. The 
 * lock manager has the same information in its local lock hash table, and 
 * we fall back on that if cache overflows, but traversing the hash table 
 * is slower when there are a lot of locks belonging to other resource owners. 
 * 
 * MAX_RESOWNER_LOCKS is the size of the per-resource owner cache. It's 
 * chosen based on some testing with pg_dump with a large schema. When the 
 * tests were done (on 9.2), resource owners in a pg_dump run contained up 
 * to 9 locks, regardless of the schema size, except for the top resource 
 * owner which contained much more (overflowing the cache). 15 seems like a 
 * nice round number that's somewhat higher than what pg_dump needs. Note that 
 * making this number larger is not free - the bigger the cache, the slower 
 * it is to release locks (in retail), when a resource owner holds many locks. 
 */ 
</span><a name="LN104"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_RESOWNER_LOCKS</span> <span class='Number'>15</span> 
 
<span class='Comment_Multi_Line'>/* 
 * ResourceOwner objects look like this 
 */ 
</span><a name="LN109"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ResourceOwnerData</span> 
<span class='Delimiter'>{ 
</span><a name="LN111"></a>    <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Member'>parent</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* NULL if no parent (toplevel owner) */ 
</span><a name="LN112"></a>    <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Member'>firstchild</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* head of linked list of children */ 
</span><a name="LN113"></a>    <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Member'>nextchild</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* next child of same parent */ 
</span><a name="LN114"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>name</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* name (just for debugging) */ 
</span> 
    <span class='Comment_Multi_Line'>/* We have built-in support for remembering: */ 
</span><a name="LN117"></a>    <a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Declare_Member'>bufferarr</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* owned buffers */ 
</span><a name="LN118"></a>    <a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Declare_Member'>catrefarr</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* catcache references */ 
</span><a name="LN119"></a>    <a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Declare_Member'>catlistrefarr</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* catcache-list pins */ 
</span><a name="LN120"></a>    <a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Declare_Member'>relrefarr</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* relcache references */ 
</span><a name="LN121"></a>    <a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Declare_Member'>planrefarr</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* plancache references */ 
</span><a name="LN122"></a>    <a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Declare_Member'>tupdescarr</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* tupdesc references */ 
</span><a name="LN123"></a>    <a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Declare_Member'>snapshotarr</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* snapshot references */ 
</span><a name="LN124"></a>    <a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Declare_Member'>filearr</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* open temporary files */ 
</span><a name="LN125"></a>    <a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Declare_Member'>dsmarr</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* dynamic shmem segments */ 
</span> 
    <span class='Comment_Multi_Line'>/* We can remember up to MAX_RESOWNER_LOCKS references to local locks. */ 
</span><a name="LN128"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nlocks</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* number of owned locks */ 
</span><a name="LN129"></a>    <a href="../../../include/storage/lock.h.html#LN401"><span class='Ref_to_Struct'>LOCALLOCK</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>locks</span><span class='Delimiter'>[</span><a href="resowner.c.html#LN104"><span class='Ref_to_Const'>MAX_RESOWNER_LOCKS</span></a><span class='Delimiter'>];</span>      <span class='Comment_Single_Line'>/* list of owned locks */ 
</span><a name="LN130"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ResourceOwnerData &raquo; </span>   <span class='Declare_Typedef'>ResourceOwnerData</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *    GLOBAL MEMORY                                                          * 
 *****************************************************************************/ 
</span> 
<a name="LN137"></a><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Var'>CurrentResourceOwner</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN138"></a><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Var'>CurTransactionResourceOwner</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN139"></a><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Var'>TopTransactionResourceOwner</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * List of add-on callbacks for resource releasing 
 */ 
</span><a name="LN144"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ResourceReleaseCallbackItem</span> 
<span class='Delimiter'>{ 
</span><a name="LN146"></a>    <span class='Control'>struct</span> <a href="resowner.c.html#LN144"><span class='Ref_to_Struct'>ResourceReleaseCallbackItem</span></a> <span class='Operator'>*</span><span class='Declare_Member'>next</span><span class='Delimiter'>; 
</span><a name="LN147"></a>    <a href="../../../include/utils/resowner.h.html#LN55"><span class='Ref_to_Typedef'>ResourceReleaseCallback</span></a> <span class='Declare_Member'>callback</span><span class='Delimiter'>; 
</span><a name="LN148"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>arg</span><span class='Delimiter'>; 
</span><a name="LN149"></a>} <span class='Declare_Typedef'>ResourceReleaseCallbackItem</span><span class='Delimiter'>; 
</span> 
<a name="LN151"></a><span class='Keyword'>static </span><a href="resowner.c.html#LN144"><span class='Ref_to_Struct'>ResourceReleaseCallbackItem</span></a> <span class='Operator'>*</span><span class='Declare_Var'>ResourceRelease_callbacks</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* Internal routines */ 
</span><a name="LN155"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ResourceArrayInit</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>invalidval</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN156"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ResourceArrayEnlarge</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN157"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ResourceArrayAdd</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN158"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ResourceArrayRemove</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN159"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ResourceArrayGetAny</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN160"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ResourceArrayFree</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN161"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ResourceOwnerReleaseInternal</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, 
</span><a name="LN162"></a>                             <a href="../../../include/utils/resowner.h.html#LN44"><span class='Ref_to_Typedef'>ResourceReleasePhase</span></a> <span class='Declare_Parameter'>phase</span><span class='Delimiter'>, 
</span><a name="LN163"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Delimiter'>, 
</span><a name="LN164"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN165"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PrintRelCacheLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN166"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PrintPlanCacheLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN167"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PrintTupleDescLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN168"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PrintSnapshotLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN169"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PrintFileLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/storage/fd.h.html#LN50"><span class='Ref_to_Typedef'>File</span></a> <span class='Declare_Parameter'>file</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN170"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PrintDSMLeakWarning</span><span class='Parentheses'>(</span><a href="../../storage/ipc/dsm.c.html#LN66"><span class='Ref_to_Struct'>dsm_segment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>seg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *    INTERNAL ROUTINES                                                      * 
 *****************************************************************************/ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Initialize a ResourceArray 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN182"></a><span class='Declare_Function'>ResourceArrayInit</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>invalidval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Assert it's empty */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN182"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN182"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN63"><span class='Ref_to_Member'>capacity</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN182"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN182"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN65"><span class='Ref_to_Member'>maxitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Remember the appropriate "invalid" value */ 
</span>    <a href="resowner.c.html#LN182"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN62"><span class='Ref_to_Member'>invalidval</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN182"><span class='Ref_to_Parameter'>invalidval</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* We don't allocate any storage until needed */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Make sure there is room for at least one more resource in an array. 
 * 
 * This is separate from actually inserting a resource because if we run out 
 * of memory, it's critical to do so *before* acquiring the resource. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN201"></a><span class='Declare_Function'>ResourceArrayEnlarge</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN203"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN204"></a>                <span class='Declare_Local'>oldcap</span><span class='Delimiter'>, 
</span><a name="LN205"></a>                <span class='Declare_Local'>newcap</span><span class='Delimiter'>; 
</span><a name="LN206"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>olditemsarr</span><span class='Delimiter'>; 
</span><a name="LN207"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>newitemsarr</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>&LT; </span><a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN65"><span class='Ref_to_Member'>maxitems</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* no work needed */ 
</span> 
    <a href="resowner.c.html#LN206"><span class='Ref_To_Local'>olditemsarr</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN204"><span class='Ref_To_Local'>oldcap</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN63"><span class='Ref_to_Member'>capacity</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Double the capacity of the array (capacity must stay a power of 2!) */ 
</span>    <a href="resowner.c.html#LN205"><span class='Ref_To_Local'>newcap</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="resowner.c.html#LN204"><span class='Ref_To_Local'>oldcap</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="resowner.c.html#LN204"><span class='Ref_To_Local'>oldcap</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>: </span><a href="resowner.c.html#LN73"><span class='Ref_to_Const'>RESARRAY_INIT_SIZE</span></a><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN207"><span class='Ref_To_Local'>newitemsarr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                               <a href="resowner.c.html#LN205"><span class='Ref_To_Local'>newcap</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="resowner.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="resowner.c.html#LN205"><span class='Ref_To_Local'>newcap</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="resowner.c.html#LN207"><span class='Ref_To_Local'>newitemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN62"><span class='Ref_to_Member'>invalidval</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We assume we can't fail below this point, so OK to scribble on resarr */ 
</span>    <a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN207"><span class='Ref_To_Local'>newitemsarr</span></a><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN63"><span class='Ref_to_Member'>capacity</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN205"><span class='Ref_To_Local'>newcap</span></a><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN65"><span class='Ref_to_Member'>maxitems</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN85"><span class='Ref_to_Macro'>RESARRAY_MAX_ITEMS</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN205"><span class='Ref_To_Local'>newcap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN206"><span class='Ref_To_Local'>olditemsarr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Transfer any pre-existing entries into the new array; they don't 
         * necessarily go where they were before, so this simple logic is the 
         * best way.  Note that if we were managing the set as a simple array, 
         * the entries after nitems are garbage, but that shouldn't matter 
         * because we won't get here unless nitems was equal to oldcap. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="resowner.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="resowner.c.html#LN204"><span class='Ref_To_Local'>oldcap</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN206"><span class='Ref_To_Local'>olditemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN62"><span class='Ref_to_Member'>invalidval</span></a><span class='Parentheses'>) 
</span>                <a href="resowner.c.html#LN157"><span class='Ref_to_Proto'>ResourceArrayAdd</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN206"><span class='Ref_To_Local'>olditemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* And release old array. */ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN206"><span class='Ref_To_Local'>olditemsarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>&LT; </span><a href="resowner.c.html#LN201"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN65"><span class='Ref_to_Member'>maxitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ResourceArrayEnlarge &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add a resource to ResourceArray 
 * 
 * Caller must have previously done ResourceArrayEnlarge() 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN256"></a><span class='Declare_Function'>ResourceArrayAdd</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN258"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>idx</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>!= </span><a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN62"><span class='Ref_to_Member'>invalidval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>&LT; </span><a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN65"><span class='Ref_to_Member'>maxitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN79"><span class='Ref_to_Macro'>RESARRAY_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Append to linear array. */ 
</span>        <a href="resowner.c.html#LN258"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Insert into first free slot at or after hash location. */ 
</span><a name="LN271"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>mask</span> <span class='Operator'>= </span><a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN63"><span class='Ref_to_Member'>capacity</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="resowner.c.html#LN258"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../access/hash/hashfunc.c.html#LN305"><span class='Ref_to_Func'>hash_any</span></a><span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)))</span> <span class='Operator'>& </span><a href="resowner.c.html#LN271"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN258"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN62"><span class='Ref_to_Member'>invalidval</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="resowner.c.html#LN258"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="resowner.c.html#LN258"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="resowner.c.html#LN271"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN66"><span class='Ref_to_Member'>lastidx</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN258"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN258"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN256"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ResourceArrayAdd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Remove a resource from ResourceArray 
 * 
 * Returns true on success, false if resource was not found. 
 * 
 * Note: if same resource ID appears more than once, one instance is removed. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN294"></a><span class='Declare_Function'>ResourceArrayRemove</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN296"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN297"></a>                <span class='Declare_Local'>idx</span><span class='Delimiter'>, 
</span><a name="LN298"></a>                <span class='Declare_Local'>lastidx</span> <span class='Operator'>= </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN66"><span class='Ref_to_Member'>lastidx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>!= </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN62"><span class='Ref_to_Member'>invalidval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Search through all items, but try lastidx first. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN79"><span class='Ref_to_Macro'>RESARRAY_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN298"><span class='Ref_To_Local'>lastidx</span></a> <span class='Operator'>&LT; </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>&& 
</span>            <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN298"><span class='Ref_To_Local'>lastidx</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN298"><span class='Ref_To_Local'>lastidx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>            <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Update lastidx to make reverse-order removals fast. */ 
</span>            <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN66"><span class='Ref_to_Member'>lastidx</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN296"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="resowner.c.html#LN296"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN296"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Update lastidx to make reverse-order removals fast. */ 
</span>                <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN66"><span class='Ref_to_Member'>lastidx</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if RESARRAY_IS_ARRAY(res... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN328"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>mask</span> <span class='Operator'>= </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN63"><span class='Ref_to_Member'>capacity</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN298"><span class='Ref_To_Local'>lastidx</span></a> <span class='Operator'>&LT; </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN63"><span class='Ref_to_Member'>capacity</span></a> <span class='Operator'>&& 
</span>            <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN298"><span class='Ref_To_Local'>lastidx</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN298"><span class='Ref_To_Local'>lastidx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN62"><span class='Ref_to_Member'>invalidval</span></a><span class='Delimiter'>; 
</span>            <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="resowner.c.html#LN297"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../access/hash/hashfunc.c.html#LN305"><span class='Ref_to_Func'>hash_any</span></a><span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)))</span> <span class='Operator'>& </span><a href="resowner.c.html#LN328"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN296"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="resowner.c.html#LN296"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN63"><span class='Ref_to_Member'>capacity</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN296"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN297"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN297"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN62"><span class='Ref_to_Member'>invalidval</span></a><span class='Delimiter'>; 
</span>                <a href="resowner.c.html#LN294"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="resowner.c.html#LN297"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="resowner.c.html#LN297"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="resowner.c.html#LN328"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ResourceArrayRemove &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get any convenient entry in a ResourceArray. 
 * 
 * "Convenient" is defined as "easy for ResourceArrayRemove to remove"; 
 * we help that along by setting lastidx to match.  This avoids O(N^2) cost 
 * when removing all ResourceArray items during ResourceOwner destruction. 
 * 
 * Returns true if we found an element, or false if the array is empty. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN363"></a><span class='Declare_Function'>ResourceArrayGetAny</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN79"><span class='Ref_to_Macro'>RESARRAY_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Linear array: just return the first element. */ 
</span>        <a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN66"><span class='Ref_to_Member'>lastidx</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Hash: search forward from wherever we were last. */ 
</span><a name="LN376"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>mask</span> <span class='Operator'>= </span><a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN63"><span class='Ref_to_Member'>capacity</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN66"><span class='Ref_to_Member'>lastidx</span></a> <span class='Operator'>&= </span><a href="resowner.c.html#LN376"><span class='Ref_To_Local'>mask</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN66"><span class='Ref_to_Member'>lastidx</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN62"><span class='Ref_to_Member'>invalidval</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN66"><span class='Ref_to_Member'>lastidx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN363"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN66"><span class='Ref_to_Member'>lastidx</span></a><span class='Delimiter'>]; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ResourceArrayGetAny &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Trash a ResourceArray (we don't care about its state after this) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN395"></a><span class='Declare_Function'>ResourceArrayFree</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN59"><span class='Ref_to_Struct'>ResourceArray</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resarr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN395"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN395"><span class='Ref_to_Parameter'>resarr</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN61"><span class='Ref_to_Member'>itemsarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *    EXPORTED ROUTINES                                                      * 
 *****************************************************************************/ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * ResourceOwnerCreate 
 *      Create an empty ResourceOwner. 
 * 
 * All ResourceOwner objects are kept in TopMemoryContext, since they should 
 * only be freed explicitly. 
 */ 
</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> 
<a name="LN415"></a><span class='Declare_Function'>ResourceOwnerCreate</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>parent</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN417"></a>    <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>owner</span><span class='Delimiter'>; 
</span> 
    <a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN109"><span class='Ref_to_Struct'>ResourceOwnerData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN415"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN415"><span class='Ref_to_Parameter'>parent</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN111"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN415"><span class='Ref_to_Parameter'>parent</span></a><span class='Delimiter'>; 
</span>        <a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN113"><span class='Ref_to_Member'>nextchild</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN415"><span class='Ref_to_Parameter'>parent</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN112"><span class='Ref_to_Member'>firstchild</span></a><span class='Delimiter'>; 
</span>        <a href="resowner.c.html#LN415"><span class='Ref_to_Parameter'>parent</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN112"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="resowner.c.html#LN155"><span class='Ref_to_Proto'>ResourceArrayInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN117"><span class='Ref_to_Member'>bufferarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="resowner.c.html#LN40"><span class='Ref_to_Macro'>BufferGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN155"><span class='Ref_to_Proto'>ResourceArrayInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN118"><span class='Ref_to_Member'>catrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN155"><span class='Ref_to_Proto'>ResourceArrayInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN119"><span class='Ref_to_Member'>catlistrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN155"><span class='Ref_to_Proto'>ResourceArrayInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN120"><span class='Ref_to_Member'>relrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN155"><span class='Ref_to_Proto'>ResourceArrayInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN121"><span class='Ref_to_Member'>planrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN155"><span class='Ref_to_Proto'>ResourceArrayInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN122"><span class='Ref_to_Member'>tupdescarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN155"><span class='Ref_to_Proto'>ResourceArrayInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN123"><span class='Ref_to_Member'>snapshotarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN155"><span class='Ref_to_Proto'>ResourceArrayInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN124"><span class='Ref_to_Member'>filearr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="resowner.c.html#LN38"><span class='Ref_to_Macro'>FileGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN155"><span class='Ref_to_Proto'>ResourceArrayInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN125"><span class='Ref_to_Member'>dsmarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="resowner.c.html#LN417"><span class='Ref_To_Local'>owner</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ResourceOwnerCreate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ResourceOwnerRelease 
 *      Release all resources owned by a ResourceOwner and its descendants, 
 *      but don't delete the owner objects themselves. 
 * 
 * Note that this executes just one phase of release, and so typically 
 * must be called three times.  We do it this way because (a) we want to 
 * do all the recursion separately for each phase, thereby preserving 
 * the needed order of operations; and (b) xact.c may have other operations 
 * to do between the phases. 
 * 
 * phase: release phase to execute 
 * isCommit: true for successful completion of a query or transaction, 
 *          false for unsuccessful 
 * isTopLevel: true if completing a main transaction, else false 
 * 
 * isCommit is passed because some modules may expect that their resources 
 * were all released already if the transaction or portal finished normally. 
 * If so it is reasonable to give a warning (NOT an error) should any 
 * unreleased resources be present.  When isCommit is false, such warnings 
 * are generally inappropriate. 
 * 
 * isTopLevel is passed when we are releasing TopTransactionResourceOwner 
 * at completion of a main transaction.  This generally means that *all* 
 * resources will be released, and so we can optimize things a bit. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN470"></a><span class='Declare_Function'>ResourceOwnerRelease</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, 
</span><a name="LN471"></a>                     <a href="../../../include/utils/resowner.h.html#LN44"><span class='Ref_to_Typedef'>ResourceReleasePhase</span></a> <span class='Declare_Parameter'>phase</span><span class='Delimiter'>, 
</span><a name="LN472"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Delimiter'>, 
</span><a name="LN473"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Rather than PG_TRY at every level of recursion, set it up once */ 
</span><a name="LN476"></a>    <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>save</span><span class='Delimiter'>; 
</span> 
    <a href="resowner.c.html#LN476"><span class='Ref_To_Local'>save</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="resowner.c.html#LN161"><span class='Ref_to_Proto'>ResourceOwnerReleaseInternal</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN470"><span class='Ref_to_Parameter'>owner</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN471"><span class='Ref_to_Parameter'>phase</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN472"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN473"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN476"><span class='Ref_To_Local'>save</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN476"><span class='Ref_To_Local'>save</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ResourceOwnerRelease &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN493"></a><span class='Declare_Function'>ResourceOwnerReleaseInternal</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, 
</span><a name="LN494"></a>                             <a href="../../../include/utils/resowner.h.html#LN44"><span class='Ref_to_Typedef'>ResourceReleasePhase</span></a> <span class='Declare_Parameter'>phase</span><span class='Delimiter'>, 
</span><a name="LN495"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Delimiter'>, 
</span><a name="LN496"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN498"></a>    <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span><a name="LN499"></a>    <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>save</span><span class='Delimiter'>; 
</span><a name="LN500"></a>    <a href="resowner.c.html#LN144"><span class='Ref_to_Struct'>ResourceReleaseCallbackItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span><a name="LN501"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>foundres</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Recurse to handle descendants */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN498"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN112"><span class='Ref_to_Member'>firstchild</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN498"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="resowner.c.html#LN498"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN498"><span class='Ref_To_Local'>child</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN113"><span class='Ref_to_Member'>nextchild</span></a><span class='Parentheses'>) 
</span>        <a href="resowner.c.html#LN161"><span class='Ref_to_Proto'>ResourceOwnerReleaseInternal</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN498"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN494"><span class='Ref_to_Parameter'>phase</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN496"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make CurrentResourceOwner point to me, so that ReleaseBuffer etc don't 
     * get confused.  We needn't PG_TRY here because the outermost level will 
     * fix it on error abort. 
     */ 
</span>    <a href="resowner.c.html#LN499"><span class='Ref_To_Local'>save</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN494"><span class='Ref_to_Parameter'>phase</span></a> <span class='Operator'>== </span><a href="../../../include/utils/resowner.h.html#LN46"><span class='Ref_to_EnumConst'>RESOURCE_RELEASE_BEFORE_LOCKS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Release buffer pins.  Note that ReleaseBuffer will remove the 
         * buffer entry from our array, so we just have to iterate till there 
         * are none. 
         * 
         * During a commit, there shouldn't be any remaining pins --- that 
         * would indicate failure to clean up the executor correctly --- so 
         * issue warnings.  In the abort case, just clean up quietly. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN159"><span class='Ref_to_Proto'>ResourceArrayGetAny</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN117"><span class='Ref_to_Member'>bufferarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN528"></a>            <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="resowner.c.html#LN41"><span class='Ref_to_Macro'>DatumGetBuffer</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/storage/bufmgr.h.html#LN185"><span class='Ref_to_Proto'>PrintBufferLeakWarning</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN528"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN528"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Ditto for relcache references */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN159"><span class='Ref_to_Proto'>ResourceArrayGetAny</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN120"><span class='Ref_to_Member'>relrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN538"></a>            <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>                <a href="resowner.c.html#LN165"><span class='Ref_to_Proto'>PrintRelCacheLeakWarning</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN538"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/relcache.h.html#LN34"><span class='Ref_to_Proto'>RelationClose</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN538"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Ditto for dynamic shared memory segments */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN159"><span class='Ref_to_Proto'>ResourceArrayGetAny</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN125"><span class='Ref_to_Member'>dsmarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN548"></a>            <a href="../../storage/ipc/dsm.c.html#LN66"><span class='Ref_to_Struct'>dsm_segment</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../storage/ipc/dsm.c.html#LN66"><span class='Ref_to_Struct'>dsm_segment</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>                <a href="resowner.c.html#LN170"><span class='Ref_to_Proto'>PrintDSMLeakWarning</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN548"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/dsm.h.html#LN40"><span class='Ref_to_Proto'>dsm_detach</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN548"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if phase==RESOURCE_RELEA... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN494"><span class='Ref_to_Parameter'>phase</span></a> <span class='Operator'>== </span><a href="../../../include/utils/resowner.h.html#LN47"><span class='Ref_to_EnumConst'>RESOURCE_RELEASE_LOCKS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN496"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * For a top-level xact we are going to release all locks (or at 
             * least all non-session locks), so just do a single lmgr call at 
             * the top of the recursion. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a> <span class='Operator'>== </span><a href="resowner.c.html#LN139"><span class='Ref_to_Global_Var'>TopTransactionResourceOwner</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/storage/proc.h.html#LN297"><span class='Ref_to_Proto'>ProcReleaseLocks</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/storage/predicate.h.html#LN56"><span class='Ref_to_Proto'>ReleasePredicateLocks</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Release locks retail.  Note that if we are committing a 
             * subtransaction, we do NOT release its locks yet, but transfer 
             * them to the parent. 
             */ 
</span><a name="LN577"></a>            <a href="../../../include/storage/lock.h.html#LN401"><span class='Ref_to_Struct'>LOCALLOCK</span></a> <span class='Operator'>**</span><span class='Declare_Local'>locks</span><span class='Delimiter'>; 
</span><a name="LN578"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>nlocks</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN111"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Pass the list of locks owned by this resource owner to the lock 
             * manager, unless it has overflowed. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a> <span class='Operator'>&GT; </span><a href="resowner.c.html#LN104"><span class='Ref_to_Const'>MAX_RESOWNER_LOCKS</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="resowner.c.html#LN577"><span class='Ref_To_Local'>locks</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="resowner.c.html#LN578"><span class='Ref_To_Local'>nlocks</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="resowner.c.html#LN577"><span class='Ref_To_Local'>locks</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN129"><span class='Ref_to_Member'>locks</span></a><span class='Delimiter'>; 
</span>                <a href="resowner.c.html#LN578"><span class='Ref_To_Local'>nlocks</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/storage/lock.h.html#LN538"><span class='Ref_to_Proto'>LockReassignCurrentOwner</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN577"><span class='Ref_To_Local'>locks</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN578"><span class='Ref_To_Local'>nlocks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/storage/lock.h.html#LN537"><span class='Ref_to_Proto'>LockReleaseCurrentOwner</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN577"><span class='Ref_To_Local'>locks</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN578"><span class='Ref_To_Local'>nlocks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if phase==RESOURCE_RELEA... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN494"><span class='Ref_to_Parameter'>phase</span></a> <span class='Operator'>== </span><a href="../../../include/utils/resowner.h.html#LN48"><span class='Ref_to_EnumConst'>RESOURCE_RELEASE_AFTER_LOCKS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Release catcache references.  Note that ReleaseCatCache will remove 
         * the catref entry from our array, so we just have to iterate till 
         * there are none. 
         * 
         * As with buffer pins, warn if any are left at commit time. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN159"><span class='Ref_to_Proto'>ResourceArrayGetAny</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN118"><span class='Ref_to_Member'>catrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN614"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/catcache.h.html#LN198"><span class='Ref_to_Proto'>PrintCatCacheLeakWarning</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN614"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/catcache.h.html#LN179"><span class='Ref_to_Proto'>ReleaseCatCache</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN614"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Ditto for catcache lists */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN159"><span class='Ref_to_Proto'>ResourceArrayGetAny</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN119"><span class='Ref_to_Member'>catlistrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN624"></a>            <a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/catcache.h.html#LN199"><span class='Ref_to_Proto'>PrintCatCacheListLeakWarning</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN624"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/catcache.h.html#LN188"><span class='Ref_to_Proto'>ReleaseCatCacheList</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN624"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Ditto for plancache references */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN159"><span class='Ref_to_Proto'>ResourceArrayGetAny</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN121"><span class='Ref_to_Member'>planrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN634"></a>            <a href="../../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>                <a href="resowner.c.html#LN166"><span class='Ref_to_Proto'>PrintPlanCacheLeakWarning</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN634"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/plancache.h.html#LN182"><span class='Ref_to_Proto'>ReleaseCachedPlan</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN634"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Ditto for tupdesc references */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN159"><span class='Ref_to_Proto'>ResourceArrayGetAny</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN122"><span class='Ref_to_Member'>tupdescarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN644"></a>            <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>                <a href="resowner.c.html#LN167"><span class='Ref_to_Proto'>PrintTupleDescLeakWarning</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN644"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/tupdesc.h.html#LN98"><span class='Ref_to_Proto'>DecrTupleDescRefCount</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN644"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Ditto for snapshot references */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN159"><span class='Ref_to_Proto'>ResourceArrayGetAny</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN123"><span class='Ref_to_Member'>snapshotarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN654"></a>            <a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>                <a href="resowner.c.html#LN168"><span class='Ref_to_Proto'>PrintSnapshotLeakWarning</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN654"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN654"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Ditto for temporary files */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN159"><span class='Ref_to_Proto'>ResourceArrayGetAny</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN493"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN124"><span class='Ref_to_Member'>filearr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN664"></a>            <a href="../../../include/storage/fd.h.html#LN50"><span class='Ref_to_Typedef'>File</span></a>        <span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="resowner.c.html#LN39"><span class='Ref_to_Macro'>DatumGetFile</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN501"><span class='Ref_To_Local'>foundres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>                <a href="resowner.c.html#LN169"><span class='Ref_to_Proto'>PrintFileLeakWarning</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN664"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/fd.h.html#LN69"><span class='Ref_to_Proto'>FileClose</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN664"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if phase==RESOURCE_RELEA... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Let add-on modules get a chance too */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN500"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN151"><span class='Ref_to_Global_Var'>ResourceRelease_callbacks</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN500"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN500"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN500"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN146"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="resowner.c.html#LN500"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN147"><span class='Ref_to_Member'>callback</span></a><span class='Parentheses'>) (</span><a href="resowner.c.html#LN494"><span class='Ref_to_Parameter'>phase</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN495"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN496"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN500"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN148"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN499"><span class='Ref_To_Local'>save</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ResourceOwnerReleaseInternal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ResourceOwnerDelete 
 *      Delete an owner object and its descendants. 
 * 
 * The caller must have already released all resources in the object tree. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN686"></a><span class='Declare_Function'>ResourceOwnerDelete</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* We had better not be deleting CurrentResourceOwner ... */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a> <span class='Operator'>!= </span><a href="resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And it better not own any resources, either */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN117"><span class='Ref_to_Member'>bufferarr</span></a><span class='Operator'>.</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN118"><span class='Ref_to_Member'>catrefarr</span></a><span class='Operator'>.</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN119"><span class='Ref_to_Member'>catlistrefarr</span></a><span class='Operator'>.</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN120"><span class='Ref_to_Member'>relrefarr</span></a><span class='Operator'>.</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN121"><span class='Ref_to_Member'>planrefarr</span></a><span class='Operator'>.</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN122"><span class='Ref_to_Member'>tupdescarr</span></a><span class='Operator'>.</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN123"><span class='Ref_to_Member'>snapshotarr</span></a><span class='Operator'>.</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN124"><span class='Ref_to_Member'>filearr</span></a><span class='Operator'>.</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN125"><span class='Ref_to_Member'>dsmarr</span></a><span class='Operator'>.</span><a href="resowner.c.html#LN64"><span class='Ref_to_Member'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a> <span class='Operator'>== </span><a href="resowner.c.html#LN104"><span class='Ref_to_Const'>MAX_RESOWNER_LOCKS</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Delete children.  The recursive call will delink the child from me, so 
     * just iterate as long as there is a child. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN112"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/resowner.h.html#LN72"><span class='Ref_to_Proto'>ResourceOwnerDelete</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN112"><span class='Ref_to_Member'>firstchild</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We delink the owner from its parent before deleting it, so that if 
     * there's an error we won't have deleted/busted owners still attached to 
     * the owner tree.  Better a leak than a crash. 
     */ 
</span>    <a href="../../../include/utils/resowner.h.html#LN74"><span class='Ref_to_Proto'>ResourceOwnerNewParent</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And free the object. */ 
</span>    <a href="resowner.c.html#LN160"><span class='Ref_to_Proto'>ResourceArrayFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN117"><span class='Ref_to_Member'>bufferarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN160"><span class='Ref_to_Proto'>ResourceArrayFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN118"><span class='Ref_to_Member'>catrefarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN160"><span class='Ref_to_Proto'>ResourceArrayFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN119"><span class='Ref_to_Member'>catlistrefarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN160"><span class='Ref_to_Proto'>ResourceArrayFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN120"><span class='Ref_to_Member'>relrefarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN160"><span class='Ref_to_Proto'>ResourceArrayFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN121"><span class='Ref_to_Member'>planrefarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN160"><span class='Ref_to_Proto'>ResourceArrayFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN122"><span class='Ref_to_Member'>tupdescarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN160"><span class='Ref_to_Proto'>ResourceArrayFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN123"><span class='Ref_to_Member'>snapshotarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN160"><span class='Ref_to_Proto'>ResourceArrayFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN124"><span class='Ref_to_Member'>filearr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN160"><span class='Ref_to_Proto'>ResourceArrayFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN125"><span class='Ref_to_Member'>dsmarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN686"><span class='Ref_to_Parameter'>owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ResourceOwnerDelete &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Fetch parent of a ResourceOwner (returns NULL if top-level owner) 
 */ 
</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> 
<a name="LN735"></a><span class='Declare_Function'>ResourceOwnerGetParent</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="resowner.c.html#LN735"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN111"><span class='Ref_to_Member'>parent</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Reassign a ResourceOwner to have a new parent 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN744"></a><span class='Declare_Function'>ResourceOwnerNewParent</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, 
</span><a name="LN745"></a>                       <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>newparent</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN747"></a>    <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>oldparent</span> <span class='Operator'>= </span><a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN111"><span class='Ref_to_Member'>parent</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN747"><span class='Ref_To_Local'>oldparent</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a> <span class='Operator'>== </span><a href="resowner.c.html#LN747"><span class='Ref_To_Local'>oldparent</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN112"><span class='Ref_to_Member'>firstchild</span></a><span class='Parentheses'>) 
</span>            <a href="resowner.c.html#LN747"><span class='Ref_To_Local'>oldparent</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN112"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN113"><span class='Ref_to_Member'>nextchild</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN755"></a>            <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN755"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN747"><span class='Ref_To_Local'>oldparent</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN112"><span class='Ref_to_Member'>firstchild</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN755"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN755"><span class='Ref_To_Local'>child</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN755"><span class='Ref_To_Local'>child</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN113"><span class='Ref_to_Member'>nextchild</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a> <span class='Operator'>== </span><a href="resowner.c.html#LN755"><span class='Ref_To_Local'>child</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN113"><span class='Ref_to_Member'>nextchild</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="resowner.c.html#LN755"><span class='Ref_To_Local'>child</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN113"><span class='Ref_to_Member'>nextchild</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN113"><span class='Ref_to_Member'>nextchild</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN745"><span class='Ref_to_Parameter'>newparent</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a> <span class='Operator'>!= </span><a href="resowner.c.html#LN745"><span class='Ref_to_Parameter'>newparent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN111"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN745"><span class='Ref_to_Parameter'>newparent</span></a><span class='Delimiter'>; 
</span>        <a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN113"><span class='Ref_to_Member'>nextchild</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN745"><span class='Ref_to_Parameter'>newparent</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN112"><span class='Ref_to_Member'>firstchild</span></a><span class='Delimiter'>; 
</span>        <a href="resowner.c.html#LN745"><span class='Ref_to_Parameter'>newparent</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN112"><span class='Ref_to_Member'>firstchild</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN111"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="resowner.c.html#LN744"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN113"><span class='Ref_to_Member'>nextchild</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ResourceOwnerNewParent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Register or deregister callback functions for resource cleanup 
 * 
 * These functions are intended for use by dynamically loaded modules. 
 * For built-in modules we generally just hardwire the appropriate calls. 
 * 
 * Note that the callback occurs post-commit or post-abort, so the callback 
 * functions can only do noncritical cleanup. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN792"></a><span class='Declare_Function'>RegisterResourceReleaseCallback</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN55"><span class='Ref_to_Typedef'>ResourceReleaseCallback</span></a> <span class='Declare_Parameter'>callback</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN794"></a>    <a href="resowner.c.html#LN144"><span class='Ref_to_Struct'>ResourceReleaseCallbackItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span> 
    <a href="resowner.c.html#LN794"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="resowner.c.html#LN144"><span class='Ref_to_Struct'>ResourceReleaseCallbackItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                           <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN144"><span class='Ref_to_Struct'>ResourceReleaseCallbackItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN794"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN147"><span class='Ref_to_Member'>callback</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN792"><span class='Ref_to_Parameter'>callback</span></a><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN794"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN148"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN792"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN794"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN146"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN151"><span class='Ref_to_Global_Var'>ResourceRelease_callbacks</span></a><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN151"><span class='Ref_to_Global_Var'>ResourceRelease_callbacks</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN794"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN806"></a><span class='Declare_Function'>UnregisterResourceReleaseCallback</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN55"><span class='Ref_to_Typedef'>ResourceReleaseCallback</span></a> <span class='Declare_Parameter'>callback</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN808"></a>    <a href="resowner.c.html#LN144"><span class='Ref_to_Struct'>ResourceReleaseCallbackItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span><a name="LN809"></a>    <a href="resowner.c.html#LN144"><span class='Ref_to_Struct'>ResourceReleaseCallbackItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prev</span><span class='Delimiter'>; 
</span> 
    <a href="resowner.c.html#LN809"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN808"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN151"><span class='Ref_to_Global_Var'>ResourceRelease_callbacks</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN808"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>; </span><a href="resowner.c.html#LN809"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN808"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN808"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN808"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN146"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN808"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN147"><span class='Ref_to_Member'>callback</span></a> <span class='Operator'>== </span><a href="resowner.c.html#LN806"><span class='Ref_to_Parameter'>callback</span></a> <span class='Operator'>&& </span><a href="resowner.c.html#LN808"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN148"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>== </span><a href="resowner.c.html#LN806"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN809"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>) 
</span>                <a href="resowner.c.html#LN809"><span class='Ref_To_Local'>prev</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN146"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN808"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN146"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="resowner.c.html#LN151"><span class='Ref_to_Global_Var'>ResourceRelease_callbacks</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN808"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN146"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN808"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end UnregisterResourceReleaseCallback &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Make sure there is room for at least one more entry in a ResourceOwner's 
 * buffer array. 
 * 
 * This is separate from actually inserting an entry because if we run out 
 * of memory, it's critical to do so *before* acquiring the resource. 
 * 
 * We allow the case owner == NULL because the bufmgr is sometimes invoked 
 * outside any transaction (for example, during WAL recovery). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN838"></a><span class='Declare_Function'>ResourceOwnerEnlargeBuffers</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN838"><span class='Ref_to_Parameter'>owner</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN156"><span class='Ref_to_Proto'>ResourceArrayEnlarge</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN838"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN117"><span class='Ref_to_Member'>bufferarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remember that a buffer pin is owned by a ResourceOwner 
 * 
 * Caller must have previously done ResourceOwnerEnlargeBuffers() 
 * 
 * We allow the case owner == NULL because the bufmgr is sometimes invoked 
 * outside any transaction (for example, during WAL recovery). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN854"></a><span class='Declare_Function'>ResourceOwnerRememberBuffer</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN854"><span class='Ref_to_Parameter'>owner</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="resowner.c.html#LN157"><span class='Ref_to_Proto'>ResourceArrayAdd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN854"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN117"><span class='Ref_to_Member'>bufferarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="resowner.c.html#LN40"><span class='Ref_to_Macro'>BufferGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN854"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Forget that a buffer pin is owned by a ResourceOwner 
 * 
 * We allow the case owner == NULL because the bufmgr is sometimes invoked 
 * outside any transaction (for example, during WAL recovery). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN868"></a><span class='Declare_Function'>ResourceOwnerForgetBuffer</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN868"><span class='Ref_to_Parameter'>owner</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="resowner.c.html#LN158"><span class='Ref_to_Proto'>ResourceArrayRemove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN868"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN117"><span class='Ref_to_Member'>bufferarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="resowner.c.html#LN40"><span class='Ref_to_Macro'>BufferGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN868"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"buffer %d is not owned by resource owner %s"</span><span class='Delimiter'>, 
</span>             <a href="resowner.c.html#LN868"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN868"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remember that a Local Lock is owned by a ResourceOwner 
 * 
 * This is different from the other Remember functions in that the list of 
 * locks is only a lossy cache. It can hold up to MAX_RESOWNER_LOCKS entries, 
 * and when it overflows, we stop tracking locks. The point of only remembering 
 * only up to MAX_RESOWNER_LOCKS entries is that if a lot of locks are held, 
 * ResourceOwnerForgetLock doesn't need to scan through a large array to find 
 * the entry. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN888"></a><span class='Declare_Function'>ResourceOwnerRememberLock</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/storage/lock.h.html#LN401"><span class='Ref_to_Struct'>LOCALLOCK</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>locallock</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN888"><span class='Ref_to_Parameter'>locallock</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN888"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a> <span class='Operator'>&GT; </span><a href="resowner.c.html#LN104"><span class='Ref_to_Const'>MAX_RESOWNER_LOCKS</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* we have already overflowed */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN888"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a> <span class='Operator'>&LT; </span><a href="resowner.c.html#LN104"><span class='Ref_to_Const'>MAX_RESOWNER_LOCKS</span></a><span class='Parentheses'>) 
</span>        <a href="resowner.c.html#LN888"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN129"><span class='Ref_to_Member'>locks</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN888"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="resowner.c.html#LN888"><span class='Ref_to_Parameter'>locallock</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* overflowed */ 
</span>    <span class='Delimiter'>} 
</span>    <a href="resowner.c.html#LN888"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Forget that a Local Lock is owned by a ResourceOwner 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN908"></a><span class='Declare_Function'>ResourceOwnerForgetLock</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/storage/lock.h.html#LN401"><span class='Ref_to_Struct'>LOCALLOCK</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>locallock</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN910"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a> <span class='Operator'>&GT; </span><a href="resowner.c.html#LN104"><span class='Ref_to_Const'>MAX_RESOWNER_LOCKS</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* we have overflowed */ 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN910"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="resowner.c.html#LN910"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="resowner.c.html#LN910"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>locallock</span></a> <span class='Operator'>== </span><a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN129"><span class='Ref_to_Member'>locks</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN910"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN129"><span class='Ref_to_Member'>locks</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN910"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN129"><span class='Ref_to_Member'>locks</span></a><span class='Delimiter'>[</span><a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>            <a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN128"><span class='Ref_to_Member'>nlocks</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"lock reference %p is not owned by resource owner %s"</span><span class='Delimiter'>, 
</span>         <a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>locallock</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN908"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ResourceOwnerForgetLock &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Make sure there is room for at least one more entry in a ResourceOwner's 
 * catcache reference array. 
 * 
 * This is separate from actually inserting an entry because if we run out 
 * of memory, it's critical to do so *before* acquiring the resource. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN937"></a><span class='Declare_Function'>ResourceOwnerEnlargeCatCacheRefs</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN156"><span class='Ref_to_Proto'>ResourceArrayEnlarge</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN937"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN118"><span class='Ref_to_Member'>catrefarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remember that a catcache reference is owned by a ResourceOwner 
 * 
 * Caller must have previously done ResourceOwnerEnlargeCatCacheRefs() 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN948"></a><span class='Declare_Function'>ResourceOwnerRememberCatCacheRef</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN157"><span class='Ref_to_Proto'>ResourceArrayAdd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN948"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN118"><span class='Ref_to_Member'>catrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN948"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Forget that a catcache reference is owned by a ResourceOwner 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN957"></a><span class='Declare_Function'>ResourceOwnerForgetCatCacheRef</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="resowner.c.html#LN158"><span class='Ref_to_Proto'>ResourceArrayRemove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN957"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN118"><span class='Ref_to_Member'>catrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN957"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"catcache reference %p is not owned by resource owner %s"</span><span class='Delimiter'>, 
</span>             <a href="resowner.c.html#LN957"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN957"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Make sure there is room for at least one more entry in a ResourceOwner's 
 * catcache-list reference array. 
 * 
 * This is separate from actually inserting an entry because if we run out 
 * of memory, it's critical to do so *before* acquiring the resource. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN972"></a><span class='Declare_Function'>ResourceOwnerEnlargeCatCacheListRefs</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN156"><span class='Ref_to_Proto'>ResourceArrayEnlarge</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN972"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN119"><span class='Ref_to_Member'>catlistrefarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remember that a catcache-list reference is owned by a ResourceOwner 
 * 
 * Caller must have previously done ResourceOwnerEnlargeCatCacheListRefs() 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN983"></a><span class='Declare_Function'>ResourceOwnerRememberCatCacheListRef</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN157"><span class='Ref_to_Proto'>ResourceArrayAdd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN983"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN119"><span class='Ref_to_Member'>catlistrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN983"><span class='Ref_to_Parameter'>list</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Forget that a catcache-list reference is owned by a ResourceOwner 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN992"></a><span class='Declare_Function'>ResourceOwnerForgetCatCacheListRef</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="resowner.c.html#LN158"><span class='Ref_to_Proto'>ResourceArrayRemove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN992"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN119"><span class='Ref_to_Member'>catlistrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN992"><span class='Ref_to_Parameter'>list</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"catcache list reference %p is not owned by resource owner %s"</span><span class='Delimiter'>, 
</span>             <a href="resowner.c.html#LN992"><span class='Ref_to_Parameter'>list</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN992"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Make sure there is room for at least one more entry in a ResourceOwner's 
 * relcache reference array. 
 * 
 * This is separate from actually inserting an entry because if we run out 
 * of memory, it's critical to do so *before* acquiring the resource. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1007"></a><span class='Declare_Function'>ResourceOwnerEnlargeRelationRefs</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN156"><span class='Ref_to_Proto'>ResourceArrayEnlarge</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1007"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN120"><span class='Ref_to_Member'>relrefarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remember that a relcache reference is owned by a ResourceOwner 
 * 
 * Caller must have previously done ResourceOwnerEnlargeRelationRefs() 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1018"></a><span class='Declare_Function'>ResourceOwnerRememberRelationRef</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN157"><span class='Ref_to_Proto'>ResourceArrayAdd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1018"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN120"><span class='Ref_to_Member'>relrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1018"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Forget that a relcache reference is owned by a ResourceOwner 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1027"></a><span class='Declare_Function'>ResourceOwnerForgetRelationRef</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="resowner.c.html#LN158"><span class='Ref_to_Proto'>ResourceArrayRemove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1027"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN120"><span class='Ref_to_Member'>relrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1027"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"relcache reference %s is not owned by resource owner %s"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1027"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="resowner.c.html#LN1027"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Debugging subroutine 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1038"></a><span class='Declare_Function'>PrintRelCacheLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"relcache reference leak: relation \"%s\" not closed"</span><span class='Delimiter'>, 
</span>         <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1038"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Make sure there is room for at least one more entry in a ResourceOwner's 
 * plancache reference array. 
 * 
 * This is separate from actually inserting an entry because if we run out 
 * of memory, it's critical to do so *before* acquiring the resource. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1052"></a><span class='Declare_Function'>ResourceOwnerEnlargePlanCacheRefs</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN156"><span class='Ref_to_Proto'>ResourceArrayEnlarge</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1052"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN121"><span class='Ref_to_Member'>planrefarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remember that a plancache reference is owned by a ResourceOwner 
 * 
 * Caller must have previously done ResourceOwnerEnlargePlanCacheRefs() 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1063"></a><span class='Declare_Function'>ResourceOwnerRememberPlanCacheRef</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN157"><span class='Ref_to_Proto'>ResourceArrayAdd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1063"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN121"><span class='Ref_to_Member'>planrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1063"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Forget that a plancache reference is owned by a ResourceOwner 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1072"></a><span class='Declare_Function'>ResourceOwnerForgetPlanCacheRef</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="resowner.c.html#LN158"><span class='Ref_to_Proto'>ResourceArrayRemove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1072"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN121"><span class='Ref_to_Member'>planrefarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1072"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"plancache reference %p is not owned by resource owner %s"</span><span class='Delimiter'>, 
</span>             <a href="resowner.c.html#LN1072"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN1072"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Debugging subroutine 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1083"></a><span class='Declare_Function'>PrintPlanCacheLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"plancache reference leak: plan %p not closed"</span><span class='Delimiter'>, </span><a href="resowner.c.html#LN1083"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Make sure there is room for at least one more entry in a ResourceOwner's 
 * tupdesc reference array. 
 * 
 * This is separate from actually inserting an entry because if we run out 
 * of memory, it's critical to do so *before* acquiring the resource. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1096"></a><span class='Declare_Function'>ResourceOwnerEnlargeTupleDescs</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN156"><span class='Ref_to_Proto'>ResourceArrayEnlarge</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1096"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN122"><span class='Ref_to_Member'>tupdescarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remember that a tupdesc reference is owned by a ResourceOwner 
 * 
 * Caller must have previously done ResourceOwnerEnlargeTupleDescs() 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1107"></a><span class='Declare_Function'>ResourceOwnerRememberTupleDesc</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN157"><span class='Ref_to_Proto'>ResourceArrayAdd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1107"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN122"><span class='Ref_to_Member'>tupdescarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1107"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Forget that a tupdesc reference is owned by a ResourceOwner 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1116"></a><span class='Declare_Function'>ResourceOwnerForgetTupleDesc</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="resowner.c.html#LN158"><span class='Ref_to_Proto'>ResourceArrayRemove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1116"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN122"><span class='Ref_to_Member'>tupdescarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1116"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"tupdesc reference %p is not owned by resource owner %s"</span><span class='Delimiter'>, 
</span>             <a href="resowner.c.html#LN1116"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN1116"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Debugging subroutine 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1127"></a><span class='Declare_Function'>PrintTupleDescLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>         <span class='String'>"TupleDesc reference leak: TupleDesc %p (%u,%d) still referenced"</span><span class='Delimiter'>, 
</span>         <a href="resowner.c.html#LN1127"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN1127"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN1127"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Make sure there is room for at least one more entry in a ResourceOwner's 
 * snapshot reference array. 
 * 
 * This is separate from actually inserting an entry because if we run out 
 * of memory, it's critical to do so *before* acquiring the resource. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1142"></a><span class='Declare_Function'>ResourceOwnerEnlargeSnapshots</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN156"><span class='Ref_to_Proto'>ResourceArrayEnlarge</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1142"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN123"><span class='Ref_to_Member'>snapshotarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remember that a snapshot reference is owned by a ResourceOwner 
 * 
 * Caller must have previously done ResourceOwnerEnlargeSnapshots() 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1153"></a><span class='Declare_Function'>ResourceOwnerRememberSnapshot</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN157"><span class='Ref_to_Proto'>ResourceArrayAdd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1153"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN123"><span class='Ref_to_Member'>snapshotarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1153"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Forget that a snapshot reference is owned by a ResourceOwner 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1162"></a><span class='Declare_Function'>ResourceOwnerForgetSnapshot</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="resowner.c.html#LN158"><span class='Ref_to_Proto'>ResourceArrayRemove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1162"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN123"><span class='Ref_to_Member'>snapshotarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1162"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"snapshot reference %p is not owned by resource owner %s"</span><span class='Delimiter'>, 
</span>             <a href="resowner.c.html#LN1162"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN1162"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Debugging subroutine 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1173"></a><span class='Declare_Function'>PrintSnapshotLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"Snapshot reference leak: Snapshot %p still referenced"</span><span class='Delimiter'>, 
</span>         <a href="resowner.c.html#LN1173"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Make sure there is room for at least one more entry in a ResourceOwner's 
 * files reference array. 
 * 
 * This is separate from actually inserting an entry because if we run out 
 * of memory, it's critical to do so *before* acquiring the resource. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1188"></a><span class='Declare_Function'>ResourceOwnerEnlargeFiles</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN156"><span class='Ref_to_Proto'>ResourceArrayEnlarge</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1188"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN124"><span class='Ref_to_Member'>filearr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remember that a temporary file is owned by a ResourceOwner 
 * 
 * Caller must have previously done ResourceOwnerEnlargeFiles() 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1199"></a><span class='Declare_Function'>ResourceOwnerRememberFile</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/storage/fd.h.html#LN50"><span class='Ref_to_Typedef'>File</span></a> <span class='Declare_Parameter'>file</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN157"><span class='Ref_to_Proto'>ResourceArrayAdd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1199"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN124"><span class='Ref_to_Member'>filearr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="resowner.c.html#LN38"><span class='Ref_to_Macro'>FileGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1199"><span class='Ref_to_Parameter'>file</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Forget that a temporary file is owned by a ResourceOwner 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1208"></a><span class='Declare_Function'>ResourceOwnerForgetFile</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../../include/storage/fd.h.html#LN50"><span class='Ref_to_Typedef'>File</span></a> <span class='Declare_Parameter'>file</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="resowner.c.html#LN158"><span class='Ref_to_Proto'>ResourceArrayRemove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1208"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN124"><span class='Ref_to_Member'>filearr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="resowner.c.html#LN38"><span class='Ref_to_Macro'>FileGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1208"><span class='Ref_to_Parameter'>file</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"temporary file %d is not owned by resource owner %s"</span><span class='Delimiter'>, 
</span>             <a href="resowner.c.html#LN1208"><span class='Ref_to_Parameter'>file</span></a><span class='Delimiter'>, </span><a href="resowner.c.html#LN1208"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Debugging subroutine 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1219"></a><span class='Declare_Function'>PrintFileLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/storage/fd.h.html#LN50"><span class='Ref_to_Typedef'>File</span></a> <span class='Declare_Parameter'>file</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"temporary file leak: File %d still referenced"</span><span class='Delimiter'>, 
</span>         <a href="resowner.c.html#LN1219"><span class='Ref_to_Parameter'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Make sure there is room for at least one more entry in a ResourceOwner's 
 * dynamic shmem segment reference array. 
 * 
 * This is separate from actually inserting an entry because if we run out 
 * of memory, it's critical to do so *before* acquiring the resource. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1233"></a><span class='Declare_Function'>ResourceOwnerEnlargeDSMs</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN156"><span class='Ref_to_Proto'>ResourceArrayEnlarge</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1233"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN125"><span class='Ref_to_Member'>dsmarr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remember that a dynamic shmem segment is owned by a ResourceOwner 
 * 
 * Caller must have previously done ResourceOwnerEnlargeDSMs() 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1244"></a><span class='Declare_Function'>ResourceOwnerRememberDSM</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../storage/ipc/dsm.c.html#LN66"><span class='Ref_to_Struct'>dsm_segment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>seg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="resowner.c.html#LN157"><span class='Ref_to_Proto'>ResourceArrayAdd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1244"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN125"><span class='Ref_to_Member'>dsmarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1244"><span class='Ref_to_Parameter'>seg</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Forget that a dynamic shmem segment is owned by a ResourceOwner 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1253"></a><span class='Declare_Function'>ResourceOwnerForgetDSM</span><span class='Parentheses'>(</span><a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><a href="../../storage/ipc/dsm.c.html#LN66"><span class='Ref_to_Struct'>dsm_segment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>seg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="resowner.c.html#LN158"><span class='Ref_to_Proto'>ResourceArrayRemove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="resowner.c.html#LN1253"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN125"><span class='Ref_to_Member'>dsmarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1253"><span class='Ref_to_Parameter'>seg</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"dynamic shared memory segment %u is not owned by resource owner %s"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/storage/dsm.h.html#LN52"><span class='Ref_to_Proto'>dsm_segment_handle</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1253"><span class='Ref_to_Parameter'>seg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="resowner.c.html#LN1253"><span class='Ref_to_Parameter'>owner</span></a><span class='Operator'>-&GT;</span><a href="resowner.c.html#LN114"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Debugging subroutine 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1264"></a><span class='Declare_Function'>PrintDSMLeakWarning</span><span class='Parentheses'>(</span><a href="../../storage/ipc/dsm.c.html#LN66"><span class='Ref_to_Struct'>dsm_segment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>seg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"dynamic shared memory leak: segment %u still referenced"</span><span class='Delimiter'>, 
</span>         <a href="../../../include/storage/dsm.h.html#LN52"><span class='Ref_to_Proto'>dsm_segment_handle</span></a><span class='Parentheses'>(</span><a href="resowner.c.html#LN1264"><span class='Ref_to_Parameter'>seg</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>