<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\sort\gen_qsort_tuple.pl</title>
<LINK REL=StyleSheet HREF="../../../../Perl_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\sort\gen_qsort_tuple.pl</b></p></td>
<td align='right'>
Wed Jun 14 08:25:58 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Operator'>#!/usr/</span>bin<span class='Operator'>/</span>perl <span class='Operator'>-</span>w 
 
<span class='Comment_Single_Line'># 
# gen_qsort_tuple.pl 
# 
# This script generates specialized versions of the quicksort algorithm for 
# tuple sorting.  The quicksort code is derived from the NetBSD code.  The 
# code generated by this script runs significantly faster than vanilla qsort 
# when used to sort tuples.  This speedup comes from a number of places. 
# The major effects are (1) inlining simple tuple comparators is much faster 
# than jumping through a function pointer and (2) swap and vecswap operations 
# specialized to the particular data type of interest (in this case, SortTuple) 
# are faster than the generic routines. 
# 
#   Modifications from vanilla NetBSD source: 
#     Add do ... while() macro fix 
#     Remove __inline, _DIAGASSERTs, __P 
#     Remove ill-considered "swap_cnt" switch to insertion sort, 
#     in favor of a simple check for presorted input. 
#     Take care to recurse on the smaller partition, to bound stack usage. 
# 
#     Instead of sorting arbitrary objects, we're always sorting SortTuples. 
#     Add CHECK_FOR_INTERRUPTS(). 
# 
# CAUTION: if you change this file, see also qsort.c and qsort_arg.c 
# 
</span> 
<span class='Control'>use</span> strict<span class='Delimiter'>; 
</span> 
<span class='Keyword'>my </span>$SUFFIX<span class='Delimiter'>; 
</span><span class='Keyword'>my </span>$EXTRAARGS<span class='Delimiter'>; 
</span><span class='Keyword'>my </span>$EXTRAPARAMS<span class='Delimiter'>; 
</span><span class='Keyword'>my </span>$CMPPARAMS<span class='Delimiter'>; 
</span> 
<a href="gen_qsort_tuple.pl.html#LN55"><span class='Ref_to_Func'>emit_qsort_boilerplate</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
$SUFFIX      <span class='Operator'>= </span><span class='String'>'tuple'</span><span class='Delimiter'>; 
</span>$EXTRAARGS   <span class='Operator'>= </span><span class='String'>', SortTupleComparator cmp_tuple, Tuplesortstate *state'</span><span class='Delimiter'>; 
</span>$EXTRAPARAMS <span class='Operator'>= </span><span class='String'>', cmp_tuple, state'</span><span class='Delimiter'>; 
</span>$CMPPARAMS   <span class='Operator'>= </span><span class='String'>', state'</span><span class='Delimiter'>; 
</span>emit_qsort_implementation<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
$SUFFIX      <span class='Operator'>= </span><span class='String'>'ssup'</span><span class='Delimiter'>; 
</span>$EXTRAARGS   <span class='Operator'>= </span><span class='String'>', SortSupport ssup'</span><span class='Delimiter'>; 
</span>$EXTRAPARAMS <span class='Operator'>= </span><span class='String'>', ssup'</span><span class='Delimiter'>; 
</span>$CMPPARAMS   <span class='Operator'>= </span><span class='String'>', ssup'</span><span class='Delimiter'>; 
</span><span class='Keyword'>print </span><span class='Operator'>&LT;&LT;</span><span class='String'>'EOM'</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'>#define cmp_ssup(a, b, ssup) \ 
</span>    ApplySortComparator<span class='Parentheses'>((</span>a<span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>datum1<span class='Delimiter'>, </span><span class='Parentheses'>(</span>a<span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>isnull1<span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                        <span class='Parentheses'>(</span>b<span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>datum1<span class='Delimiter'>, </span><span class='Parentheses'>(</span>b<span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>isnull1<span class='Delimiter'>, </span>ssup<span class='Parentheses'>)</span> 
 
EOM 
emit_qsort_implementation<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
<a name="LN55"></a><span class='Control'>sub</span> <span class='Declare_Function'>emit_qsort_boilerplate</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>print </span><span class='Operator'>&LT;&LT;</span><span class='String'>'EOM'</span><span class='Delimiter'>; 
</span><span class='Operator'>/* 
</span> <span class='Operator'>* </span>autogenerated by src<span class='Operator'>/backend/</span>utils<span class='Operator'>/sort/</span>gen_qsort_tuple<span class='Operator'>.</span>pl<span class='Delimiter'>, </span><span class='Control'>do</span> not edit<span class='Operator'>! 
</span> <span class='Operator'>* 
</span> <span class='Operator'>* </span>This file is included by tuplesort<span class='Operator'>.</span>c<span class='Delimiter'>, </span>rather than compiled separately<span class='Operator'>. 
</span> <span class='Operator'>*/ 
</span> 
<span class='Operator'>/*</span>  $NetBSD<span class='Operator'>: </span>qsort<span class='Operator'>.</span>c<span class='Delimiter'>,</span>v 1<span class='Operator'>.</span>13 2003<span class='Operator'>/08/</span>07 16<span class='Operator'>:</span>43<span class='Operator'>:</span>42 agc Exp $   <span class='Operator'>*/ 
</span> 
<span class='Operator'>/*- 
</span> <span class='Operator'>* </span>Copyright <span class='Parentheses'>(</span>c<span class='Parentheses'>) </span>1992<span class='Delimiter'>, </span>1993 
 <span class='Operator'>*</span>  The Regents of the University of California<span class='Operator'>.</span>  All rights reserved<span class='Operator'>. 
</span> <span class='Operator'>* 
</span> <span class='Operator'>* </span>Redistribution and <span class='Control'>use</span> in source and binary forms<span class='Delimiter'>, </span>with or without 
 <span class='Operator'>* </span>modification<span class='Delimiter'>, </span>are permitted provided that the following conditions 
 <span class='Operator'>* </span>are met<span class='Operator'>: 
</span> <span class='Operator'>* </span>1<span class='Operator'>. </span>Redistributions of source code must retain the above copyright 
 <span class='Operator'>*</span>    notice<span class='Delimiter'>, </span>this list of conditions and the following disclaimer<span class='Operator'>. 
</span> <span class='Operator'>* </span>2<span class='Operator'>. </span>Redistributions in binary form must reproduce the above copyright 
 <span class='Operator'>*</span>    notice<span class='Delimiter'>, </span>this list of conditions and the following disclaimer in the 
 <span class='Operator'>*</span>    documentation and<span class='Operator'>/</span>or other materials provided with the distribution<span class='Operator'>. 
</span> <span class='Operator'>* </span>3<span class='Operator'>. </span>Neither the <a href="../../../test/perl/PostgresNode.pm.html#LN216"><span class='Ref_to_Func'>name</span></a> of the University nor the names of its contributors 
 <span class='Operator'>*</span>    may be used to endorse or <a href="../../../test/perl/PostgresNode.pm.html#LN743"><span class='Ref_to_Func'>promote</span></a> products derived from this software 
 <span class='Operator'>*</span>    without specific prior written permission<span class='Operator'>. 
</span> <span class='Operator'>* 
</span> <span class='Operator'>* </span>THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS <span class='Operator'>``</span>AS IS<span class='String'>''</span> AND 
 <span class='Operator'>* </span>ANY EXPRESS OR IMPLIED WARRANTIES<span class='Delimiter'>, </span>INCLUDING<span class='Delimiter'>, </span>BUT NOT LIMITED TO<span class='Delimiter'>, </span>THE 
 <span class='Operator'>* </span>IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
 <span class='Operator'>* </span>ARE DISCLAIMED<span class='Operator'>.</span>  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE 
 <span class='Operator'>* </span>FOR ANY DIRECT<span class='Delimiter'>, </span>INDIRECT<span class='Delimiter'>, </span>INCIDENTAL<span class='Delimiter'>, </span>SPECIAL<span class='Delimiter'>, </span>EXEMPLARY<span class='Delimiter'>, </span>OR CONSEQUENTIAL 
 <span class='Operator'>* </span>DAMAGES <span class='Parentheses'>(</span>INCLUDING<span class='Delimiter'>, </span>BUT NOT LIMITED TO<span class='Delimiter'>, </span>PROCUREMENT OF SUBSTITUTE GOODS 
 <span class='Operator'>* </span>OR SERVICES<span class='Delimiter'>; </span>LOSS OF USE<span class='Delimiter'>, </span>DATA<span class='Delimiter'>, </span>OR PROFITS<span class='Delimiter'>; </span>OR BUSINESS INTERRUPTION<span class='Parentheses'>) 
</span> <span class='Operator'>* </span>HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY<span class='Delimiter'>, </span>WHETHER IN CONTRACT<span class='Delimiter'>, </span>STRICT 
 <span class='Operator'>* </span>LIABILITY<span class='Delimiter'>, </span>OR TORT <span class='Parentheses'>(</span>INCLUDING NEGLIGENCE OR OTHERWISE<span class='Parentheses'>) </span>ARISING IN ANY WAY 
 <span class='Operator'>* </span>OUT OF THE USE OF THIS SOFTWARE<span class='Delimiter'>, </span>EVEN IF ADVISED OF THE POSSIBILITY OF 
 <span class='Operator'>* </span>SUCH DAMAGE<span class='Operator'>. 
</span> <span class='Operator'>*/ 
</span> 
<span class='Operator'>/* 
</span> <span class='Operator'>* </span>Qsort routine based on J<span class='Operator'>. </span>L<span class='Operator'>. </span>Bentley and M<span class='Operator'>. </span>D<span class='Operator'>. </span>McIlroy<span class='Delimiter'>, 
</span> <span class='Operator'>* </span><span class='String'>"Engineering a sort function"</span><span class='Delimiter'>, 
</span> <span class='Operator'>* </span>Software<span class='Operator'>--</span>Practice and Experience 23 <span class='Parentheses'>(</span>1993<span class='Parentheses'>) </span>1249<span class='Operator'>-</span>1265<span class='Operator'>. 
</span> <span class='Operator'>* 
</span> <span class='Operator'>* </span>We have modified their original by adding a <a href="../../../tools/msvc/vcregress.pl.html#LN114"><span class='Ref_to_Func'>check</span></a> <span class='Control'>for</span> already<span class='Operator'>-</span>sorted input<span class='Delimiter'>, 
</span> <span class='Operator'>* </span>which seems to be a win per discussions on pgsql<span class='Operator'>-</span>hackers around 2006<span class='Operator'>-</span>03<span class='Operator'>-</span>21<span class='Operator'>. 
</span> <span class='Operator'>* 
</span> <span class='Operator'>* </span>Also<span class='Delimiter'>, </span>we recurse on the smaller partition and iterate on the larger one<span class='Delimiter'>, 
</span> <span class='Operator'>* </span>which ensures we cannot recurse more than <span class='Keyword'>log</span><span class='Parentheses'>(</span>N<span class='Parentheses'>) </span>levels <span class='Parentheses'>(</span>since the 
 <span class='Operator'>* </span>partition recursed to is surely <span class='Keyword'>no </span>more than half of the input<span class='Parentheses'>)</span><span class='Operator'>.</span>  Bentley 
 <span class='Operator'>* </span>and McIlroy explicitly rejected doing this on the grounds that it<span class='String'>'s "not 
</span> <span class='Operator'>* </span>worth the effort<span class='String'>", but we have seen crashes in the field due to stack 
</span> <span class='Operator'>* </span>overrun<span class='Delimiter'>, </span>so that judgment seems wrong<span class='Operator'>. 
</span> <span class='Operator'>*/ 
</span> 
static void 
swapfunc<span class='Parentheses'>(</span>SortTuple <span class='Operator'>*</span>a<span class='Delimiter'>, </span>SortTuple <span class='Operator'>*</span>b<span class='Delimiter'>, </span>size_t n<span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        SortTuple   t <span class='Operator'>= *</span>a<span class='Delimiter'>; 
</span>        <span class='Operator'>*</span>a<span class='Operator'>++ = *</span>b<span class='Delimiter'>; 
</span>        <span class='Operator'>*</span>b<span class='Operator'>++ = </span>t<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>--</span>n <span class='Operator'>&GT; </span>0<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Single_Line'>#define swap(a, b)                      \ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{</span>                                <span class='Operator'>\ 
</span>        SortTuple t <span class='Operator'>= *</span><span class='Parentheses'>(</span>a<span class='Parentheses'>)</span><span class='Delimiter'>;</span>             <span class='Operator'>\ 
</span>        <span class='Operator'>*</span><span class='Parentheses'>(</span>a<span class='Parentheses'>) </span><span class='Operator'>= *</span><span class='Parentheses'>(</span>b<span class='Parentheses'>)</span><span class='Delimiter'>;</span>                    <span class='Operator'>\ 
</span>        <span class='Operator'>*</span><span class='Parentheses'>(</span>b<span class='Parentheses'>) </span><span class='Operator'>= </span>t<span class='Delimiter'>;</span>                       <span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span>0<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'>#define vecswap(a, b, n) if ((n) &GT; 0) swapfunc(a, b, n) 
</span> 
EOM 
<span class='Delimiter'>} 
</span> 
<span class='Control'>sub</span> emit_qsort_implementation 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>print </span><span class='Operator'>&LT;&LT;</span>EOM<span class='Delimiter'>; 
</span>static SortTuple <span class='Operator'>* 
</span>med3_$SUFFIX<span class='Parentheses'>(</span>SortTuple <span class='Operator'>*</span>a<span class='Delimiter'>, </span>SortTuple <span class='Operator'>*</span>b<span class='Delimiter'>, </span>SortTuple <span class='Operator'>*</span>c$EXTRAARGS<span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> cmp_$SUFFIX<span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b$CMPPARAMS<span class='Parentheses'>) </span><span class='Operator'>&LT; </span>0 <span class='Operator'>? 
</span>        <span class='Parentheses'>(</span>cmp_$SUFFIX<span class='Parentheses'>(</span>b<span class='Delimiter'>, </span>c$CMPPARAMS<span class='Parentheses'>)</span> <span class='Operator'>&LT; </span>0 <span class='Operator'>? </span>b <span class='Operator'>: 
</span>            <span class='Parentheses'>(</span>cmp_$SUFFIX<span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>c$CMPPARAMS<span class='Parentheses'>) </span><span class='Operator'>&LT; </span>0 <span class='Operator'>? </span>c <span class='Operator'>: </span>a<span class='Parentheses'>))</span> 
        <span class='Operator'>: </span><span class='Parentheses'>(</span>cmp_$SUFFIX<span class='Parentheses'>(</span>b<span class='Delimiter'>, </span>c$CMPPARAMS<span class='Parentheses'>)</span> <span class='Operator'>&GT; </span>0 <span class='Operator'>? </span>b <span class='Operator'>: 
</span>            <span class='Parentheses'>(</span>cmp_$SUFFIX<span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>c$CMPPARAMS<span class='Parentheses'>) </span><span class='Operator'>&LT; </span>0 <span class='Operator'>? </span>a <span class='Operator'>: </span>c<span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
static void 
qsort_$SUFFIX<span class='Parentheses'>(</span>SortTuple <span class='Operator'>*</span>a<span class='Delimiter'>, </span>size_t n$EXTRAARGS<span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    SortTuple  <span class='Operator'>*</span>pa<span class='Delimiter'>, 
</span>               <span class='Operator'>*</span>pb<span class='Delimiter'>, 
</span>               <span class='Operator'>*</span>pc<span class='Delimiter'>, 
</span>               <span class='Operator'>*</span>pd<span class='Delimiter'>, 
</span>               <span class='Operator'>*</span>pl<span class='Delimiter'>, 
</span>               <span class='Operator'>*</span>pm<span class='Delimiter'>, 
</span>               <span class='Operator'>*</span>pn<span class='Delimiter'>; 
</span>    size_t      d1<span class='Delimiter'>, 
</span>                d2<span class='Delimiter'>; 
</span>    <span class='Keyword'>int</span>         r<span class='Delimiter'>, 
</span>                presorted<span class='Delimiter'>; 
</span> 
loop<span class='Operator'>: 
</span>    CHECK_FOR_INTERRUPTS<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>n <span class='Operator'>&LT; </span>7<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span>pm <span class='Operator'>= </span>a <span class='Operator'>+ </span>1<span class='Delimiter'>; </span>pm <span class='Operator'>&LT; </span>a <span class='Operator'>+ </span>n<span class='Delimiter'>; </span>pm<span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span>pl <span class='Operator'>= </span>pm<span class='Delimiter'>; </span>pl <span class='Operator'>&GT; </span>a <span class='Operator'>&& </span>cmp_$SUFFIX<span class='Parentheses'>(</span>pl <span class='Operator'>- </span>1<span class='Delimiter'>, </span>pl$CMPPARAMS<span class='Parentheses'>) </span><span class='Operator'>&GT; </span>0<span class='Delimiter'>; </span>pl<span class='Operator'>--</span><span class='Parentheses'>)</span> 
                swap<span class='Parentheses'>(</span>pl<span class='Delimiter'>, </span>pl <span class='Operator'>- </span>1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    presorted <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span>pm <span class='Operator'>= </span>a <span class='Operator'>+ </span>1<span class='Delimiter'>; </span>pm <span class='Operator'>&LT; </span>a <span class='Operator'>+ </span>n<span class='Delimiter'>; </span>pm<span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        CHECK_FOR_INTERRUPTS<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>cmp_$SUFFIX<span class='Parentheses'>(</span>pm <span class='Operator'>- </span>1<span class='Delimiter'>, </span>pm$CMPPARAMS<span class='Parentheses'>) </span><span class='Operator'>&GT; </span>0<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            presorted <span class='Operator'>= </span>0<span class='Delimiter'>; 
</span>            break<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>presorted<span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    pm <span class='Operator'>= </span>a <span class='Operator'>+ </span><span class='Parentheses'>(</span>n <span class='Operator'>/ </span>2<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>n <span class='Operator'>&GT; </span>7<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        pl <span class='Operator'>= </span>a<span class='Delimiter'>; 
</span>        pn <span class='Operator'>= </span>a <span class='Operator'>+ </span><span class='Parentheses'>(</span>n <span class='Operator'>- </span>1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>n <span class='Operator'>&GT; </span>40<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            size_t      d <span class='Operator'>= </span><span class='Parentheses'>(</span>n <span class='Operator'>/ </span>8<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            pl <span class='Operator'>= </span>med3_$SUFFIX<span class='Parentheses'>(</span>pl<span class='Delimiter'>, </span>pl <span class='Operator'>+ </span>d<span class='Delimiter'>, </span>pl <span class='Operator'>+ </span>2 <span class='Operator'>* </span>d$EXTRAPARAMS<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            pm <span class='Operator'>= </span>med3_$SUFFIX<span class='Parentheses'>(</span>pm <span class='Operator'>- </span>d<span class='Delimiter'>, </span>pm<span class='Delimiter'>, </span>pm <span class='Operator'>+ </span>d$EXTRAPARAMS<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            pn <span class='Operator'>= </span>med3_$SUFFIX<span class='Parentheses'>(</span>pn <span class='Operator'>- </span>2 <span class='Operator'>* </span>d<span class='Delimiter'>, </span>pn <span class='Operator'>- </span>d<span class='Delimiter'>, </span>pn$EXTRAPARAMS<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        pm <span class='Operator'>= </span>med3_$SUFFIX<span class='Parentheses'>(</span>pl<span class='Delimiter'>, </span>pm<span class='Delimiter'>, </span>pn$EXTRAPARAMS<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    swap<span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>pm<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    pa <span class='Operator'>= </span>pb <span class='Operator'>= </span>a <span class='Operator'>+ </span>1<span class='Delimiter'>; 
</span>    pc <span class='Operator'>= </span>pd <span class='Operator'>= </span>a <span class='Operator'>+ </span><span class='Parentheses'>(</span>n <span class='Operator'>- </span>1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span>pb <span class='Operator'>&LT;= </span>pc <span class='Operator'>&& </span><span class='Parentheses'>(</span>r <span class='Operator'>= </span>cmp_$SUFFIX<span class='Parentheses'>(</span>pb<span class='Delimiter'>, </span>a$CMPPARAMS<span class='Parentheses'>))</span> <span class='Operator'>&LT;= </span>0<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>r <span class='Operator'>== </span>0<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                swap<span class='Parentheses'>(</span>pa<span class='Delimiter'>, </span>pb<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                pa<span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            pb<span class='Operator'>++</span><span class='Delimiter'>; 
</span>            CHECK_FOR_INTERRUPTS<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span>pb <span class='Operator'>&LT;= </span>pc <span class='Operator'>&& </span><span class='Parentheses'>(</span>r <span class='Operator'>= </span>cmp_$SUFFIX<span class='Parentheses'>(</span>pc<span class='Delimiter'>, </span>a$CMPPARAMS<span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span>0<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>r <span class='Operator'>== </span>0<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                swap<span class='Parentheses'>(</span>pc<span class='Delimiter'>, </span>pd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                pd<span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            pc<span class='Operator'>--</span><span class='Delimiter'>; 
</span>            CHECK_FOR_INTERRUPTS<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>pb <span class='Operator'>&GT; </span>pc<span class='Parentheses'>) 
</span>            break<span class='Delimiter'>; 
</span>        swap<span class='Parentheses'>(</span>pb<span class='Delimiter'>, </span>pc<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        pb<span class='Operator'>++</span><span class='Delimiter'>; 
</span>        pc<span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    pn <span class='Operator'>= </span>a <span class='Operator'>+ </span>n<span class='Delimiter'>; 
</span>    d1 <span class='Operator'>= </span>Min<span class='Parentheses'>(</span>pa <span class='Operator'>- </span>a<span class='Delimiter'>, </span>pb <span class='Operator'>- </span>pa<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    vecswap<span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>pb <span class='Operator'>- </span>d1<span class='Delimiter'>, </span>d1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    d1 <span class='Operator'>= </span>Min<span class='Parentheses'>(</span>pd <span class='Operator'>- </span>pc<span class='Delimiter'>, </span>pn <span class='Operator'>- </span>pd <span class='Operator'>- </span>1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    vecswap<span class='Parentheses'>(</span>pb<span class='Delimiter'>, </span>pn <span class='Operator'>- </span>d1<span class='Delimiter'>, </span>d1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    d1 <span class='Operator'>= </span>pb <span class='Operator'>- </span>pa<span class='Delimiter'>; 
</span>    d2 <span class='Operator'>= </span>pd <span class='Operator'>- </span>pc<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>d1 <span class='Operator'>&LT;= </span>d2<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>/* </span>Recurse on left partition<span class='Delimiter'>, </span>then iterate on right partition <span class='Operator'>*/ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>d1 <span class='Operator'>&GT; </span>1<span class='Parentheses'>) 
</span>            qsort_$SUFFIX<span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>d1$EXTRAPARAMS<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>d2 <span class='Operator'>&GT; </span>1<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>/* </span>Iterate rather than recurse to save stack space <span class='Operator'>*/ 
</span>            <span class='Operator'>/* </span>qsort_$SUFFIX<span class='Parentheses'>(</span>pn <span class='Operator'>- </span>d2<span class='Delimiter'>, </span>d2$EXTRAPARAMS<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>*/ 
</span>            a <span class='Operator'>= </span>pn <span class='Operator'>- </span>d2<span class='Delimiter'>; 
</span>            n <span class='Operator'>= </span>d2<span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> loop<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>/* </span>Recurse on right partition<span class='Delimiter'>, </span>then iterate on left partition <span class='Operator'>*/ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>d2 <span class='Operator'>&GT; </span>1<span class='Parentheses'>) 
</span>            qsort_$SUFFIX<span class='Parentheses'>(</span>pn <span class='Operator'>- </span>d2<span class='Delimiter'>, </span>d2$EXTRAPARAMS<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>d1 <span class='Operator'>&GT; </span>1<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>/* </span>Iterate rather than recurse to save stack space <span class='Operator'>*/ 
</span>            <span class='Operator'>/* </span>qsort_$SUFFIX<span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>d1$EXTRAPARAMS<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>*/ 
</span>            n <span class='Operator'>= </span>d1<span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> loop<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
} 
</span>EOM 
<span class='Delimiter'>} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>