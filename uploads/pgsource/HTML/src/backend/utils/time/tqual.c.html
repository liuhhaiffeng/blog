<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\time\tqual.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\time\tqual.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:59 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * tqual.c 
 *    POSTGRES "time qualification" code, ie, tuple visibility rules. 
 * 
 * NOTE: all the HeapTupleSatisfies routines will update the tuple's 
 * "hint" status bits if we see that the inserting or deleting transaction 
 * has now committed or aborted (and it is safe to set the hint bits). 
 * If the hint bits are changed, MarkBufferDirtyHint is called on 
 * the passed-in buffer.  The caller must hold not only a pin, but at least 
 * shared buffer content lock on the buffer containing the tuple. 
 * 
 * NOTE: When using a non-MVCC snapshot, we must check 
 * TransactionIdIsInProgress (which looks in the PGXACT array) 
 * before TransactionIdDidCommit/TransactionIdDidAbort (which look in 
 * pg_xact).  Otherwise we have a race condition: we might decide that a 
 * just-committed transaction crashed, because none of the tests succeed. 
 * xact.c is careful to record commit/abort in pg_xact before it unsets 
 * MyPgXact-&GT;xid in the PGXACT array.  That fixes that problem, but it 
 * also means there is a window where TransactionIdIsInProgress and 
 * TransactionIdDidCommit will both return true.  If we check only 
 * TransactionIdDidCommit, we could consider a tuple committed when a 
 * later GetSnapshotData call will still think the originating transaction 
 * is in progress, which leads to application-level inconsistency.  The 
 * upshot is that we gotta check TransactionIdIsInProgress first in all 
 * code paths, except for a few cases where we are looking at 
 * subtransactions of our own main transaction and so there can't be any 
 * race condition. 
 * 
 * When using an MVCC snapshot, we rely on XidInMVCCSnapshot rather than 
 * TransactionIdIsInProgress, but the logic is otherwise the same: do not 
 * check pg_xact until after deciding that the xact is no longer in progress. 
 * 
 * 
 * Summary of visibility functions: 
 * 
 *   HeapTupleSatisfiesMVCC() 
 *        visible to supplied snapshot, excludes current command 
 *   HeapTupleSatisfiesUpdate() 
 *        visible to instant snapshot, with user-supplied command 
 *        counter and more complex result 
 *   HeapTupleSatisfiesSelf() 
 *        visible to instant snapshot and current command 
 *   HeapTupleSatisfiesDirty() 
 *        like HeapTupleSatisfiesSelf(), but includes open transactions 
 *   HeapTupleSatisfiesVacuum() 
 *        visible to any running transaction, used by VACUUM 
 *   HeapTupleSatisfiesToast() 
 *        visible unless part of interrupted vacuum, used for TOAST 
 *   HeapTupleSatisfiesAny() 
 *        all tuples are visible 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/time/tqual.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/multixact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/subtrans.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/procarray.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/combocid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* Static variables representing various special snapshot semantics */ 
</span><a name="LN78"></a><a href="../../../include/utils/snapshot.h.html#LN51"><span class='Ref_to_Struct'>SnapshotData</span></a> <span class='Declare_Var'>SnapshotSelfData</span> <span class='Operator'>= </span><span class='Delimiter'>{</span><a href="../../../include/utils/tqual.h.html#LN60"><span class='Ref_to_Proto'>HeapTupleSatisfiesSelf</span></a><span class='Delimiter'>}; 
</span><a name="LN79"></a><a href="../../../include/utils/snapshot.h.html#LN51"><span class='Ref_to_Struct'>SnapshotData</span></a> <span class='Declare_Var'>SnapshotAnyData</span> <span class='Operator'>= </span><span class='Delimiter'>{</span><a href="../../../include/utils/tqual.h.html#LN62"><span class='Ref_to_Proto'>HeapTupleSatisfiesAny</span></a><span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* local functions */ 
</span><a name="LN82"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>XidInMVCCSnapshot</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SetHintBits() 
 * 
 * Set commit/abort hint bits on a tuple, if appropriate at this time. 
 * 
 * It is only safe to set a transaction-committed hint bit if we know the 
 * transaction's commit record is guaranteed to be flushed to disk before the 
 * buffer, or if the table is temporary or unlogged and will be obliterated by 
 * a crash anyway.  We cannot change the LSN of the page here, because we may 
 * hold only a share lock on the buffer, so we can only use the LSN to 
 * interlock this if the buffer's LSN already is newer than the commit LSN; 
 * otherwise we have to just refrain from setting the hint bit until some 
 * future re-examination of the tuple. 
 * 
 * We can always set hint bits when marking a transaction aborted.  (Some 
 * code in heapam.c relies on that!) 
 * 
 * Also, if we are cleaning up HEAP_MOVED_IN or HEAP_MOVED_OFF entries, then 
 * we can always set the hint bits, since pre-9.0 VACUUM FULL always used 
 * synchronous commits and didn't move tuples that weren't previously 
 * hinted.  (This is not known by this subroutine, but is applied by its 
 * callers.)  Note: old-style VACUUM FULL is gone, but we have to keep this 
 * module's support for MOVED_OFF/MOVED_IN flag bits for as long as we 
 * support in-place update from pre-9.0 databases. 
 * 
 * Normal commits may be asynchronous, so for those we need to get the LSN 
 * of the transaction and then check whether this is flushed. 
 * 
 * The caller should pass xid as the XID of the transaction to check, or 
 * InvalidTransactionId if no check is needed. 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN116"></a><span class='Declare_Function'>SetHintBits</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, 
</span><a name="LN117"></a>            <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>infomask</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN117"><span class='Ref_to_Parameter'>xid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* NB: xid must be known committed here! */ 
</span><a name="LN122"></a>        <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>commitLSN</span> <span class='Operator'>= </span><a href="../../../include/access/transam.h.html#LN174"><span class='Ref_to_Proto'>TransactionIdGetCommitLSN</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN117"><span class='Ref_to_Parameter'>xid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN201"><span class='Ref_to_Proto'>BufferIsPermanent</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN116"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/access/xlog.h.html#LN227"><span class='Ref_to_Proto'>XLogNeedsFlush</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN122"><span class='Ref_To_Local'>commitLSN</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN202"><span class='Ref_to_Proto'>BufferGetLSNAtomic</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN116"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="tqual.c.html#LN122"><span class='Ref_To_Local'>commitLSN</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* not flushed and no LSN interlock, so don't set hint */ 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tqual.c.html#LN116"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>|= </span><a href="tqual.c.html#LN117"><span class='Ref_to_Parameter'>infomask</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN211"><span class='Ref_to_Proto'>MarkBufferDirtyHint</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN116"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SetHintBits &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * HeapTupleSetHintBits --- exported version of SetHintBits() 
 * 
 * This must be separate because of C99's brain-dead notions about how to 
 * implement inline functions. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN143"></a><span class='Declare_Function'>HeapTupleSetHintBits</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, 
</span><a name="LN144"></a>                     <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>infomask</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN143"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN143"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN144"><span class='Ref_to_Parameter'>infomask</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN144"><span class='Ref_to_Parameter'>xid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * HeapTupleSatisfiesSelf 
 *      True iff heap tuple is valid "for itself". 
 * 
 *  Here, we consider the effects of: 
 *      all committed transactions (as of the current instant) 
 *      previous commands of this transaction 
 *      changes made by the current command 
 * 
 * Note: 
 *      Assumes heap tuple is valid. 
 * 
 * The satisfaction of "itself" requires the following: 
 * 
 * ((Xmin == my-transaction &&              the row was updated by the current transaction, and 
 *      (Xmax is null                       it was not deleted 
 *       [|| Xmax != my-transaction)])          [or it was deleted by another transaction] 
 * || 
 * 
 * (Xmin is committed &&                    the row was modified by a committed transaction, and 
 *      (Xmax is null ||                    the row has not been deleted, or 
 *          (Xmax != my-transaction &&          the row was deleted by another transaction 
 *           Xmax is not committed)))           that has not been committed 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN175"></a><span class='Declare_Function'>HeapTupleSatisfiesSelf</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, </span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN177"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN317"><span class='Ref_to_Macro'>HeapTupleHeaderXminCommitted</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN322"><span class='Ref_to_Macro'>HeapTupleHeaderXminInvalid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN195"><span class='Ref_to_Const'>HEAP_MOVED_OFF</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN190"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN190"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN190"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN190"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN198"><span class='Ref_to_Const'>HEAP_MOVED_IN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN209"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN209"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN209"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN209"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* xid invalid */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span>    <span class='Comment_Single_Line'>/* not deleter */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN236"></a>                <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
                <a href="tqual.c.html#LN236"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN236"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* updating subtransaction must have aborted */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN236"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* deleting subtransaction must have aborted */ 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if TransactionIdIsCurren... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !HeapTupleHeaderXminC... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* by here, the inserting transaction has committed */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* xid invalid or aborted */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* updated by other */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN288"></a>        <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="tqual.c.html#LN288"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN288"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN288"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN288"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN288"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tuple-&GT;t_infomask&HEA... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>        <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* xmax transaction committed */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN175"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN177"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end HeapTupleSatisfiesSelf &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * HeapTupleSatisfiesAny 
 *      Dummy "satisfies" routine: any tuple satisfies SnapshotAny. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN345"></a><span class='Declare_Function'>HeapTupleSatisfiesAny</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, </span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * HeapTupleSatisfiesToast 
 *      True iff heap tuple is valid as a TOAST row. 
 * 
 * This is a simplified version that only checks for VACUUM moving conditions. 
 * It's appropriate for TOAST usage because TOAST really doesn't want to do 
 * its own time qual checks; if you can see the main table row that contains 
 * a TOAST reference, you should be able to see the TOASTed value.  However, 
 * vacuuming a TOAST table is independent of the main table, and in case such 
 * a vacuum fails partway through, we'd better do this much checking. 
 * 
 * Among other things, this means you can't do UPDATEs of rows in a TOAST 
 * table. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN365"></a><span class='Declare_Function'>HeapTupleSatisfiesToast</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, 
</span><a name="LN366"></a>                        <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN368"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="tqual.c.html#LN365"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqual.c.html#LN365"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN365"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN317"><span class='Ref_to_Macro'>HeapTupleHeaderXminCommitted</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN322"><span class='Ref_to_Macro'>HeapTupleHeaderXminInvalid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN195"><span class='Ref_to_Const'>HEAP_MOVED_OFF</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN381"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN381"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN381"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN381"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN366"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN366"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN198"><span class='Ref_to_Const'>HEAP_MOVED_IN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN400"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN400"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN400"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN400"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN366"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN366"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * An invalid Xmin can be left behind by a speculative insertion that 
         * is canceled by super-deleting the tuple.  This also applies to 
         * TOAST tuples created during speculative insertion. 
         */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN306"><span class='Ref_to_Macro'>HeapTupleHeaderGetXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN368"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !HeapTupleHeaderXminC... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* otherwise assume the tuple is valid for TOAST. */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end HeapTupleSatisfiesToast &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * HeapTupleSatisfiesUpdate 
 * 
 *  This function returns a more detailed result code than most of the 
 *  functions in this file, since UPDATE needs to know more than "is it 
 *  visible?".  It also allows for user-supplied CommandId rather than 
 *  relying on CurrentCommandId. 
 * 
 *  The possible return codes are: 
 * 
 *  HeapTupleInvisible: the tuple didn't exist at all when the scan started, 
 *  e.g. it was created by a later CommandId. 
 * 
 *  HeapTupleMayBeUpdated: The tuple is valid and visible, so it may be 
 *  updated. 
 * 
 *  HeapTupleSelfUpdated: The tuple was updated by the current transaction, 
 *  after the current scan started. 
 * 
 *  HeapTupleUpdated: The tuple was updated by a committed transaction. 
 * 
 *  HeapTupleBeingUpdated: The tuple is being updated by an in-progress 
 *  transaction other than the current transaction.  (Note: this includes 
 *  the case where the tuple is share-locked by a MultiXact, even if the 
 *  MultiXact includes the current transaction.  Callers that want to 
 *  distinguish that case must test for it themselves.) 
 */ 
</span><a href="../../../include/utils/snapshot.h.html#LN118"><span class='Ref_to_Typedef'>HTSU_Result</span></a> 
<a name="LN459"></a><span class='Declare_Function'>HeapTupleSatisfiesUpdate</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a> <span class='Declare_Parameter'>curcid</span><span class='Delimiter'>, 
</span><a name="LN460"></a>                         <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN462"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="tqual.c.html#LN459"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqual.c.html#LN459"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN459"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN317"><span class='Ref_to_Macro'>HeapTupleHeaderXminCommitted</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN322"><span class='Ref_to_Macro'>HeapTupleHeaderXminInvalid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN195"><span class='Ref_to_Const'>HEAP_MOVED_OFF</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN475"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN475"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN475"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN475"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN198"><span class='Ref_to_Const'>HEAP_MOVED_IN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN494"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN494"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN494"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN494"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN79"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="tqual.c.html#LN459"><span class='Ref_to_Parameter'>curcid</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* inserted after scan started */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* xid invalid */ 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN521"></a>                <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
                <a href="tqual.c.html#LN521"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Careful here: even though this tuple was created by our own 
                 * transaction, it might be locked by other transactions, if 
                 * the original version was key-share locked when we updated 
                 * it. 
                 */ 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/multixact.h.html#LN110"><span class='Ref_to_Proto'>MultiXactIdIsRunning</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN521"><span class='Ref_To_Local'>xmax</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN124"><span class='Ref_to_EnumConst'>HeapTupleBeingUpdated</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If the locker is gone, then there is nothing of interest 
                 * left in this Xmax; otherwise, report the tuple as 
                 * locked/updated. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN521"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN124"><span class='Ref_to_EnumConst'>HeapTupleBeingUpdated</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HEAP_XMAX_IS_LOCKED_O... &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN552"></a>                <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
                <a href="tqual.c.html#LN552"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN552"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* deleting subtransaction must have aborted */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN552"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/multixact.h.html#LN110"><span class='Ref_to_Proto'>MultiXactIdIsRunning</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <span class='Boolean'>false</span><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN124"><span class='Ref_to_EnumConst'>HeapTupleBeingUpdated</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN80"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="tqual.c.html#LN459"><span class='Ref_to_Parameter'>curcid</span></a><span class='Parentheses'>)</span> 
                        <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN122"><span class='Ref_to_EnumConst'>HeapTupleSelfUpdated</span></a><span class='Delimiter'>;</span>    <span class='Comment_Multi_Line'>/* updated after scan 
                                                         * started */ 
</span>                    <span class='Control'>else</span> 
                        <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>;</span>      <span class='Comment_Multi_Line'>/* updated before scan 
                                                         * started */ 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tuple-&GT;t_infomask&HEA... &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* deleting subtransaction must have aborted */ 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN80"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="tqual.c.html#LN459"><span class='Ref_to_Parameter'>curcid</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN122"><span class='Ref_to_EnumConst'>HeapTupleSelfUpdated</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* updated after scan started */ 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* updated before scan started */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if TransactionIdIsCurren... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !HeapTupleHeaderXminC... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* by here, the inserting transaction has committed */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* xid invalid or aborted */ 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN123"><span class='Ref_to_EnumConst'>HeapTupleUpdated</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* updated by other */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN619"></a>        <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN237"><span class='Ref_to_Macro'>HEAP_LOCKED_UPGRADED</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/multixact.h.html#LN110"><span class='Ref_to_Proto'>MultiXactIdIsRunning</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN124"><span class='Ref_to_EnumConst'>HeapTupleBeingUpdated</span></a><span class='Delimiter'>; 
</span> 
            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, </span><a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tqual.c.html#LN619"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN619"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/multixact.h.html#LN110"><span class='Ref_to_Proto'>MultiXactIdIsRunning</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN124"><span class='Ref_to_EnumConst'>HeapTupleBeingUpdated</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN619"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN619"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN80"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="tqual.c.html#LN459"><span class='Ref_to_Parameter'>curcid</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN122"><span class='Ref_to_EnumConst'>HeapTupleSelfUpdated</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* updated after scan started */ 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* updated before scan started */ 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/multixact.h.html#LN110"><span class='Ref_to_Proto'>MultiXactIdIsRunning</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN124"><span class='Ref_to_EnumConst'>HeapTupleBeingUpdated</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN619"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN123"><span class='Ref_to_EnumConst'>HeapTupleUpdated</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * By here, the update in the Xmax is either aborted or crashed, but 
         * what about the other members? 
         */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/multixact.h.html#LN110"><span class='Ref_to_Proto'>MultiXactIdIsRunning</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * There's no member, even just a locker, alive anymore, so we can 
             * mark the Xmax as invalid. 
             */ 
</span>            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* There are lockers running */ 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN124"><span class='Ref_to_EnumConst'>HeapTupleBeingUpdated</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tuple-&GT;t_infomask&HEA... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN124"><span class='Ref_to_EnumConst'>HeapTupleBeingUpdated</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN80"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="tqual.c.html#LN459"><span class='Ref_to_Parameter'>curcid</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN122"><span class='Ref_to_EnumConst'>HeapTupleSelfUpdated</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* updated after scan started */ 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* updated before scan started */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN124"><span class='Ref_to_EnumConst'>HeapTupleBeingUpdated</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>        <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* xmax transaction committed */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN460"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN462"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/snapshot.h.html#LN123"><span class='Ref_to_EnumConst'>HeapTupleUpdated</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* updated by other */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end HeapTupleSatisfiesUpdate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * HeapTupleSatisfiesDirty 
 *      True iff heap tuple is valid including effects of open transactions. 
 * 
 *  Here, we consider the effects of: 
 *      all committed and in-progress transactions (as of the current instant) 
 *      previous commands of this transaction 
 *      changes made by the current command 
 * 
 * This is essentially like HeapTupleSatisfiesSelf as far as effects of 
 * the current transaction and committed/aborted xacts are concerned. 
 * However, we also include the effects of other xacts still in progress. 
 * 
 * A special hack is that the passed-in snapshot struct is used as an 
 * output argument to return the xids of concurrent xacts that affected the 
 * tuple.  snapshot-&GT;xmin is set to the tuple's xmin if that is another 
 * transaction that's still in progress; or to InvalidTransactionId if the 
 * tuple's xmin is committed good, committed dead, or my own xact. 
 * Similarly for snapshot-&GT;xmax and the tuple's xmax.  If the tuple was 
 * inserted speculatively, meaning that the inserter might still back down 
 * on the insertion without aborting the whole transaction, the associated 
 * token is also returned in snapshot-&GT;speculativeToken. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN738"></a><span class='Declare_Function'>HeapTupleSatisfiesDirty</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, 
</span><a name="LN739"></a>                        <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN741"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN65"><span class='Ref_to_Member'>xmin</span></a> <span class='Operator'>= </span><a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN66"><span class='Ref_to_Member'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Delimiter'>; 
</span>    <a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN101"><span class='Ref_to_Member'>speculativeToken</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN317"><span class='Ref_to_Macro'>HeapTupleHeaderXminCommitted</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN322"><span class='Ref_to_Macro'>HeapTupleHeaderXminInvalid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN195"><span class='Ref_to_Const'>HEAP_MOVED_OFF</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN757"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN757"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN757"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN757"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN739"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN739"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN198"><span class='Ref_to_Const'>HEAP_MOVED_IN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN776"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN776"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN776"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN776"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN739"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN739"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* xid invalid */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span>    <span class='Comment_Single_Line'>/* not deleter */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN803"></a>                <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
                <a href="tqual.c.html#LN803"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN803"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* updating subtransaction must have aborted */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN803"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* deleting subtransaction must have aborted */ 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN739"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if TransactionIdIsCurren... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Return the speculative token to caller.  Caller can worry about 
             * xmax, since it requires a conclusively locked row version, and 
             * a concurrent update to this tuple is a conflict of its 
             * purposes. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN422"><span class='Ref_to_Macro'>HeapTupleHeaderIsSpeculative</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN101"><span class='Ref_to_Member'>speculativeToken</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/access/htup_details.h.html#LN427"><span class='Ref_to_Macro'>HeapTupleHeaderGetSpeculativeToken</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN101"><span class='Ref_to_Member'>speculativeToken</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN65"><span class='Ref_to_Member'>xmin</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* XXX shouldn't we fall through to look at xmax? */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* in insertion by other */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if TransactionIdIsInProg... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN739"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN739"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !HeapTupleHeaderXminC... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* by here, the inserting transaction has committed */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* xid invalid or aborted */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* updated by other */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN873"></a>        <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="tqual.c.html#LN873"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN873"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN873"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN873"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN66"><span class='Ref_to_Member'>xmax</span></a> <span class='Operator'>= </span><a href="tqual.c.html#LN873"><span class='Ref_To_Local'>xmax</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN873"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tuple-&GT;t_infomask&HEA... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
            <a href="tqual.c.html#LN738"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN66"><span class='Ref_to_Member'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>        <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN739"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* xmax transaction committed */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN739"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN739"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Delimiter'>, 
</span>                <a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN741"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* updated by other */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end HeapTupleSatisfiesDirty &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * HeapTupleSatisfiesMVCC 
 *      True iff heap tuple is valid for the given MVCC snapshot. 
 * 
 *  Here, we consider the effects of: 
 *      all transactions committed as of the time of the given snapshot 
 *      previous commands of this transaction 
 * 
 *  Does _not_ include: 
 *      transactions shown as in-progress by the snapshot 
 *      transactions started after the snapshot was taken 
 *      changes made by the current command 
 * 
 * Notice that here, we will not update the tuple status hint bits if the 
 * inserting/deleting transaction is still running according to our snapshot, 
 * even if in reality it's committed or aborted by now.  This is intentional. 
 * Checking the true transaction state would require access to high-traffic 
 * shared data structures, creating contention we'd rather do without, and it 
 * would not change the result of our visibility check anyway.  The hint bits 
 * will be updated by the first visitor that has a snapshot new enough to see 
 * the inserting/deleting transaction as done.  In the meantime, the cost of 
 * leaving the hint bits unset is basically that each HeapTupleSatisfiesMVCC 
 * call will need to run TransactionIdIsCurrentTransactionId in addition to 
 * XidInMVCCSnapshot (but it would have to do the latter anyway).  In the old 
 * coding where we tried to set the hint bits as soon as possible, we instead 
 * did TransactionIdIsInProgress in each call --- to no avail, as long as the 
 * inserting/deleting transaction was still running --- which was more cycles 
 * and more contention on the PGXACT array. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN962"></a><span class='Declare_Function'>HeapTupleSatisfiesMVCC</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, 
</span><a name="LN963"></a>                       <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN965"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN317"><span class='Ref_to_Macro'>HeapTupleHeaderXminCommitted</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN322"><span class='Ref_to_Macro'>HeapTupleHeaderXminInvalid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN195"><span class='Ref_to_Const'>HEAP_MOVED_OFF</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN978"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN978"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqual.c.html#LN82"><span class='Ref_to_Proto'>XidInMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN978"><span class='Ref_To_Local'>xvac</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN978"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN963"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN963"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN198"><span class='Ref_to_Const'>HEAP_MOVED_IN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN997"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN997"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN82"><span class='Ref_to_Proto'>XidInMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN997"><span class='Ref_To_Local'>xvac</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN997"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN963"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN963"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN79"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN95"><span class='Ref_to_Member'>curcid</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* inserted after scan started */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* xid invalid */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span>    <span class='Comment_Single_Line'>/* not deleter */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1027"></a>                <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
                <a href="tqual.c.html#LN1027"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1027"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* updating subtransaction must have aborted */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1027"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN80"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN95"><span class='Ref_to_Member'>curcid</span></a><span class='Parentheses'>)</span> 
                    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* updated after scan started */ 
</span>                <span class='Control'>else</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* updated before scan started */ 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* deleting subtransaction must have aborted */ 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN963"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN80"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN95"><span class='Ref_to_Member'>curcid</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* deleted after scan started */ 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* deleted before scan started */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if TransactionIdIsCurren... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN82"><span class='Ref_to_Proto'>XidInMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN963"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN963"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !HeapTupleHeaderXminC... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* xmin is committed, but maybe not according to our snapshot */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN328"><span class='Ref_to_Macro'>HeapTupleHeaderXminFrozen</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <a href="tqual.c.html#LN82"><span class='Ref_to_Proto'>XidInMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* treat as still in progress */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* by here, the inserting transaction has committed */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* xid invalid or aborted */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1087"></a>        <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* already checked above */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="tqual.c.html#LN1087"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1087"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1087"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN80"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN95"><span class='Ref_to_Member'>curcid</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* deleted after scan started */ 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* deleted before scan started */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN82"><span class='Ref_to_Proto'>XidInMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1087"><span class='Ref_To_Local'>xmax</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1087"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* updating transaction committed */ 
</span>        <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tuple-&GT;t_infomask&HEA... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN80"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN95"><span class='Ref_to_Member'>curcid</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* deleted after scan started */ 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* deleted before scan started */ 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN82"><span class='Ref_to_Proto'>XidInMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* it must have aborted or crashed */ 
</span>            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN963"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* xmax transaction committed */ 
</span>        <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN963"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !(tuple-&GT;t_infomask&H... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* xmax is committed, but maybe not according to our snapshot */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN82"><span class='Ref_to_Proto'>XidInMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tqual.c.html#LN962"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* treat as still in progress */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* xmax transaction committed */ 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end HeapTupleSatisfiesMVCC &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * HeapTupleSatisfiesVacuum 
 * 
 *  Determine the status of tuples for VACUUM purposes.  Here, what 
 *  we mainly want to know is if a tuple is potentially visible to *any* 
 *  running transaction.  If so, it can't be removed yet by VACUUM. 
 * 
 * OldestXmin is a cutoff XID (obtained from GetOldestXmin()).  Tuples 
 * deleted by XIDs &GT;= OldestXmin are deemed "recently dead"; they might 
 * still be visible to some open transaction, so we can't remove them, 
 * even if we see that the deleting transaction has committed. 
 */ 
</span><a href="../../../include/utils/tqual.h.html#LN48"><span class='Ref_to_Typedef'>HTSV_Result</span></a> 
<a name="LN1163"></a><span class='Declare_Function'>HeapTupleSatisfiesVacuum</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>OldestXmin</span><span class='Delimiter'>, 
</span><a name="LN1164"></a>                         <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1166"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="tqual.c.html#LN1163"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqual.c.html#LN1163"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1163"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Has inserting transaction committed? 
     * 
     * If the inserting transaction aborted, then the tuple was never visible 
     * to any other transaction, so we can delete it immediately. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN317"><span class='Ref_to_Macro'>HeapTupleHeaderXminCommitted</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN322"><span class='Ref_to_Macro'>HeapTupleHeaderXminInvalid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN50"><span class='Ref_to_EnumConst'>HEAPTUPLE_DEAD</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN195"><span class='Ref_to_Const'>HEAP_MOVED_OFF</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1184"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1184"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN54"><span class='Ref_to_EnumConst'>HEAPTUPLE_DELETE_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1184"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN54"><span class='Ref_to_EnumConst'>HEAPTUPLE_DELETE_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1184"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN50"><span class='Ref_to_EnumConst'>HEAPTUPLE_DEAD</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Used by pre-9.0 binary upgrades */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN198"><span class='Ref_to_Const'>HEAP_MOVED_IN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1202"></a>            <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xvac</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN408"><span class='Ref_to_Macro'>HeapTupleHeaderGetXvac</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1202"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN53"><span class='Ref_to_EnumConst'>HEAPTUPLE_INSERT_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1202"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN53"><span class='Ref_to_EnumConst'>HEAPTUPLE_INSERT_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1202"><span class='Ref_To_Local'>xvac</span></a><span class='Parentheses'>))</span> 
                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN50"><span class='Ref_to_EnumConst'>HEAPTUPLE_DEAD</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* xid invalid */ 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN53"><span class='Ref_to_EnumConst'>HEAPTUPLE_INSERT_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* only locked? run infomask-only check first, for performance */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <a href="../../../include/utils/tqual.h.html#LN81"><span class='Ref_to_Proto'>HeapTupleHeaderIsOnlyLocked</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN53"><span class='Ref_to_EnumConst'>HEAPTUPLE_INSERT_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* inserted and then deleted by same xact */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN358"><span class='Ref_to_Macro'>HeapTupleHeaderGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN54"><span class='Ref_to_EnumConst'>HEAPTUPLE_DELETE_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* deleting subtransaction must have aborted */ 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN53"><span class='Ref_to_EnumConst'>HEAPTUPLE_INSERT_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * It'd be possible to discern between INSERT/DELETE in progress 
             * here by looking at xmax - but that doesn't seem beneficial for 
             * the majority of callers and even detrimental for some. We'd 
             * rather have callers look at/wait for xmin than xmax. It's 
             * always correct to return INSERT_IN_PROGRESS because that's 
             * what's happening from the view of other backends. 
             */ 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN53"><span class='Ref_to_EnumConst'>HEAPTUPLE_INSERT_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN188"><span class='Ref_to_Const'>HEAP_XMIN_COMMITTED</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Not in Progress, Not Committed, so either Aborted or crashed 
             */ 
</span>            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN189"><span class='Ref_to_Const'>HEAP_XMIN_INVALID</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN50"><span class='Ref_to_EnumConst'>HEAPTUPLE_DEAD</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * At this point the xmin is known committed, but we might not have 
         * been able to set the hint bit yet; so we can no longer Assert that 
         * it's set. 
         */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !HeapTupleHeaderXminC... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Okay, the inserter committed, so it was good at some point.  Now what 
     * about the deleting transaction? 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN51"><span class='Ref_to_EnumConst'>HEAPTUPLE_LIVE</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * "Deleting" xact really only locked it, so the tuple is live in any 
         * case.  However, we should make sure that either XMAX_COMMITTED or 
         * XMAX_INVALID gets set once the xact is gone, to reduce the costs of 
         * examining the tuple for future xacts. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If it's a pre-pg_upgrade tuple, the multixact cannot 
                 * possibly be running; otherwise have to check. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN237"><span class='Ref_to_Macro'>HEAP_LOCKED_UPGRADED</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                    <a href="../../../include/access/multixact.h.html#LN110"><span class='Ref_to_Proto'>MultiXactIdIsRunning</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN51"><span class='Ref_to_EnumConst'>HEAPTUPLE_LIVE</span></a><span class='Delimiter'>; 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, </span><a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
                    <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN51"><span class='Ref_to_EnumConst'>HEAPTUPLE_LIVE</span></a><span class='Delimiter'>; 
</span>                <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !(tuple-&GT;t_infomask&H... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * We don't really care whether xmax did commit, abort or crash. We 
         * know that xmax did lock the tuple, but it did not and will never 
         * actually update it. 
         */ 
</span> 
        <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN51"><span class='Ref_to_EnumConst'>HEAPTUPLE_LIVE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HEAP_XMAX_IS_LOCKED_O... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1313"></a>        <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/multixact.h.html#LN110"><span class='Ref_to_Proto'>MultiXactIdIsRunning</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* already checked above */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="tqual.c.html#LN1313"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1313"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1313"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN54"><span class='Ref_to_EnumConst'>HEAPTUPLE_DELETE_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1313"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
                <span class='Comment_Multi_Line'>/* there are still lockers around -- can't return DEAD here */ 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN52"><span class='Ref_to_EnumConst'>HEAPTUPLE_RECENTLY_DEAD</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* updating transaction aborted */ 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN51"><span class='Ref_to_EnumConst'>HEAPTUPLE_LIVE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="tqual.c.html#LN1313"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1313"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* multi is not running -- updating xact cannot be */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1313"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1313"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/transam.h.html#LN168"><span class='Ref_to_Proto'>TransactionIdPrecedes</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1313"><span class='Ref_To_Local'>xmax</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1163"><span class='Ref_to_Parameter'>OldestXmin</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN52"><span class='Ref_to_EnumConst'>HEAPTUPLE_RECENTLY_DEAD</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN50"><span class='Ref_to_EnumConst'>HEAPTUPLE_DEAD</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Not in Progress, Not Committed, so either Aborted or crashed. 
         * Remove the Xmax. 
         */ 
</span>        <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, </span><a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN51"><span class='Ref_to_EnumConst'>HEAPTUPLE_LIVE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tuple-&GT;t_infomask&HEA... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN54"><span class='Ref_to_EnumConst'>HEAPTUPLE_DELETE_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Not in Progress, Not Committed, so either Aborted or crashed 
             */ 
</span>            <a href="tqual.c.html#LN115"><span class='Ref_to_Func'>SetHintBits</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1164"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN51"><span class='Ref_to_EnumConst'>HEAPTUPLE_LIVE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * At this point the xmax is known committed, but we might not have 
         * been able to set the hint bit yet; so we can no longer Assert that 
         * it's set. 
         */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !(tuple-&GT;t_infomask&H... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Deleter committed, but perhaps it was recent enough that some open 
     * transactions could still see the tuple. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/transam.h.html#LN168"><span class='Ref_to_Proto'>TransactionIdPrecedes</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tqual.c.html#LN1163"><span class='Ref_to_Parameter'>OldestXmin</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN52"><span class='Ref_to_EnumConst'>HEAPTUPLE_RECENTLY_DEAD</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Otherwise, it's dead and removable */ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/tqual.h.html#LN50"><span class='Ref_to_EnumConst'>HEAPTUPLE_DEAD</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end HeapTupleSatisfiesVacuum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * HeapTupleIsSurelyDead 
 * 
 *  Cheaply determine whether a tuple is surely dead to all onlookers. 
 *  We sometimes use this in lieu of HeapTupleSatisfiesVacuum when the 
 *  tuple has just been tested by another visibility routine (usually 
 *  HeapTupleSatisfiesMVCC) and, therefore, any hint bits that can be set 
 *  should already be set.  We assume that if no hint bits are set, the xmin 
 *  or xmax transaction is still running.  This is therefore faster than 
 *  HeapTupleSatisfiesVacuum, because we don't consult PGXACT nor CLOG. 
 *  It's okay to return FALSE when in doubt, but we must return TRUE only 
 *  if the tuple is removable. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1408"></a><span class='Declare_Function'>HeapTupleIsSurelyDead</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>OldestXmin</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1410"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="tqual.c.html#LN1408"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqual.c.html#LN1408"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1408"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the inserting transaction is marked invalid, then it aborted, and 
     * the tuple is definitely dead.  If it's marked neither committed nor 
     * invalid, then we assume it's still alive (since the presumption is that 
     * all relevant hint bits were just set moments ago). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN317"><span class='Ref_to_Macro'>HeapTupleHeaderXminCommitted</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1410"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../include/access/htup_details.h.html#LN322"><span class='Ref_to_Macro'>HeapTupleHeaderXminInvalid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1410"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>true </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the inserting transaction committed, but any deleting transaction 
     * aborted, the tuple is still alive. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1410"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the XMAX is just a lock, the tuple is still alive. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1410"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the Xmax is a MultiXact, it might be dead or alive, but we cannot 
     * know without checking pg_multixact. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1410"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If deleter isn't known to have committed, assume it's still running. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1410"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Deleter committed, so tuple is dead if the XID is old enough. */ 
</span>    <span class='Control'>return</span> <a href="../../../include/access/transam.h.html#LN168"><span class='Ref_to_Proto'>TransactionIdPrecedes</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1410"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tqual.c.html#LN1408"><span class='Ref_to_Parameter'>OldestXmin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end HeapTupleIsSurelyDead &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * XidInMVCCSnapshot 
 *      Is the given XID still-in-progress according to the snapshot? 
 * 
 * Note: GetSnapshotData never stores either top xid or subxids of our own 
 * backend into a snapshot, so these xids will not be reported as "running" 
 * by this function.  This is OK for current uses, because we always check 
 * TransactionIdIsCurrentTransactionId first, except for known-committed 
 * XIDs which could not be ours anyway. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1463"></a><span class='Declare_Function'>XidInMVCCSnapshot</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1465"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make a quick range check to eliminate most XIDs without looking at the 
     * xip arrays.  Note that this is OK even if we convert a subxact XID to 
     * its parent below, because a subxact with XID &LT; xmin has surely also got 
     * a parent with XID &LT; xmin, while one with XID &GT;= xmax must belong to a 
     * parent that was not yet committed at the time of this snapshot. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Any xid &LT; xmin is not in-progress */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN168"><span class='Ref_to_Proto'>TransactionIdPrecedes</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN65"><span class='Ref_to_Member'>xmin</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Any xid &GT;= xmax is in-progress */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN171"><span class='Ref_to_Proto'>TransactionIdFollowsOrEquals</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN66"><span class='Ref_to_Member'>xmax</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Snapshot information is stored slightly differently in snapshots taken 
     * during recovery. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN92"><span class='Ref_to_Member'>takenDuringRecovery</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If the snapshot contains full subxact data, the fastest way to 
         * check things is just to compare the given XID against both subxact 
         * XIDs and top-level XIDs.  If the snapshot overflowed, we have to 
         * use pg_subtrans to convert a subxact XID to its parent XID, but 
         * then we need only look at top-level XIDs not subxacts. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN90"><span class='Ref_to_Member'>suboverflowed</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* we have full data, so search subxip */ 
</span><a name="LN1498"></a>            <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1498"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqual.c.html#LN1498"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN89"><span class='Ref_to_Member'>subxcnt</span></a><span class='Delimiter'>; </span><a href="tqual.c.html#LN1498"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN42"><span class='Ref_to_Macro'>TransactionIdEquals</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN88"><span class='Ref_to_Member'>subxip</span></a><span class='Delimiter'>[</span><a href="tqual.c.html#LN1498"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* not there, fall through to search xip[] */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Snapshot overflowed, so convert xid to top-level.  This is safe 
             * because we eliminated too-old XIDs above. 
             */ 
</span>            <a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a> <span class='Operator'>= </span><a href="../../../include/access/subtrans.h.html#LN18"><span class='Ref_to_Proto'>SubTransGetTopmostTransaction</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If xid was indeed a subxact, we might now have an xid &LT; xmin, 
             * so recheck to avoid an array scan.  No point in rechecking 
             * xmax. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN168"><span class='Ref_to_Proto'>TransactionIdPrecedes</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN65"><span class='Ref_to_Member'>xmin</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1465"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqual.c.html#LN1465"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN77"><span class='Ref_to_Member'>xcnt</span></a><span class='Delimiter'>; </span><a href="tqual.c.html#LN1465"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN42"><span class='Ref_to_Macro'>TransactionIdEquals</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN76"><span class='Ref_to_Member'>xip</span></a><span class='Delimiter'>[</span><a href="tqual.c.html#LN1465"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !snapshot-&GT;takenDurin... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1533"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In recovery we store all xids in the subxact array because it is by 
         * far the bigger array, and we mostly don't know which xids are 
         * top-level and which are subxacts. The xip array is empty. 
         * 
         * We start by searching subtrans, if we overflowed. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN90"><span class='Ref_to_Member'>suboverflowed</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Snapshot overflowed, so convert xid to top-level.  This is safe 
             * because we eliminated too-old XIDs above. 
             */ 
</span>            <a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a> <span class='Operator'>= </span><a href="../../../include/access/subtrans.h.html#LN18"><span class='Ref_to_Proto'>SubTransGetTopmostTransaction</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If xid was indeed a subxact, we might now have an xid &LT; xmin, 
             * so recheck to avoid an array scan.  No point in rechecking 
             * xmax. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN168"><span class='Ref_to_Proto'>TransactionIdPrecedes</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN65"><span class='Ref_to_Member'>xmin</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We now have either a top-level xid higher than xmin or an 
         * indeterminate xid. We don't know whether it's top level or subxact 
         * but it doesn't matter. If it's present, the xid is visible. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1533"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqual.c.html#LN1533"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN89"><span class='Ref_to_Member'>subxcnt</span></a><span class='Delimiter'>; </span><a href="tqual.c.html#LN1533"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN42"><span class='Ref_to_Macro'>TransactionIdEquals</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1463"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN88"><span class='Ref_to_Member'>subxip</span></a><span class='Delimiter'>[</span><a href="tqual.c.html#LN1533"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end XidInMVCCSnapshot &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Is the tuple really only locked?  That is, is it not updated? 
 * 
 * It's easy to check just infomask bits if the locker is not a multi; but 
 * otherwise we need to verify that the updating transaction has not aborted. 
 * 
 * This function is here because it follows the same time qualification rules 
 * laid out at the top of this file. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1584"></a><span class='Declare_Function'>HeapTupleHeaderIsOnlyLocked</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1586"></a>    <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if there's no valid Xmax, then there's obviously no update either */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1584"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1584"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN181"><span class='Ref_to_Const'>HEAP_XMAX_LOCK_ONLY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* invalid xmax means no update */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1584"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if HEAP_XMAX_LOCK_ONLY is not set and not a multi, then this must 
     * necessarily have been updated 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1584"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ... but if it's a multi, then perhaps the updating Xid aborted. */ 
</span>    <a href="tqual.c.html#LN1586"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1584"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* not LOCKED_ONLY, so it has to have an xmax */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1586"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1586"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/procarray.h.html#LN89"><span class='Ref_to_Proto'>TransactionIdIsInProgress</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1586"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1586"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * not current, not in progress, not committed -- must have aborted or 
     * crashed 
     */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end HeapTupleHeaderIsOnlyLocked &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * check whether the transaction id 'xid' is in the pre-sorted array 'xip'. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1630"></a><span class='Declare_Function'>TransactionIdInArray</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>xip</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>num</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> bsearch<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqual.c.html#LN1630"><span class='Ref_to_Parameter'>xid</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1630"><span class='Ref_to_Parameter'>xip</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1630"><span class='Ref_to_Parameter'>num</span></a><span class='Delimiter'>, 
</span>                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/builtins.h.html#LN94"><span class='Ref_to_Proto'>xidComparator</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * See the comments for HeapTupleSatisfiesMVCC for the semantics this function 
 * obeys. 
 * 
 * Only usable on tuples from catalog tables! 
 * 
 * We don't need to support HEAP_MOVED_(IN|OFF) for now because we only support 
 * reading catalog pages which couldn't have been created in an older version. 
 * 
 * We don't set any hint bits in here as it seems unlikely to be beneficial as 
 * those should already be set by normal access and it seems to be too 
 * dangerous to do so as the semantics of doing so during timetravel are more 
 * complicated than when dealing "only" with the present. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1651"></a><span class='Declare_Function'>HeapTupleSatisfiesHistoricMVCC</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, 
</span><a name="LN1652"></a>                               <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1654"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span><a name="LN1655"></a>    <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmin</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN306"><span class='Ref_to_Macro'>HeapTupleHeaderGetXmin</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1656"></a>    <a href="../../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Local'>xmax</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* inserting transaction aborted */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN322"><span class='Ref_to_Macro'>HeapTupleHeaderXminInvalid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1655"><span class='Ref_To_Local'>xmin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* check if it's one of our txids, toplevel is also in there */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1629"><span class='Ref_to_Func'>TransactionIdInArray</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1655"><span class='Ref_To_Local'>xmin</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN88"><span class='Ref_to_Member'>subxip</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN89"><span class='Ref_to_Member'>subxcnt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1670"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>resolved</span><span class='Delimiter'>; 
</span><a name="LN1671"></a>        <a href="../../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Local'>cmin</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN384"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawCommandId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1672"></a>        <a href="../../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Local'>cmax</span> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN413"><span class='Ref_to_Const'>InvalidCommandId</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * another transaction might have (tried to) delete this tuple or 
         * cmin/cmax was stored in a combocid. So we need to lookup the actual 
         * values externally. 
         */ 
</span>        <a href="tqual.c.html#LN1670"><span class='Ref_To_Local'>resolved</span></a> <span class='Operator'>= </span><a href="../../../include/utils/tqual.h.html#LN88"><span class='Ref_to_Proto'>ResolveCminCmaxDuringDecoding</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/snapmgr.h.html#LN102"><span class='Ref_to_Proto'>HistoricSnapshotGetTupleCids</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, 
</span>                                                 <a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>htup</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1652"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Operator'>&</span><a href="tqual.c.html#LN1671"><span class='Ref_To_Local'>cmin</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqual.c.html#LN1672"><span class='Ref_To_Local'>cmax</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqual.c.html#LN1670"><span class='Ref_To_Local'>resolved</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not resolve cmin/cmax of catalog tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1671"><span class='Ref_To_Local'>cmin</span></a> <span class='Operator'>!= </span><a href="../../../include/c.h.html#LN413"><span class='Ref_to_Const'>InvalidCommandId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1671"><span class='Ref_To_Local'>cmin</span></a> <span class='Operator'>&GT;= </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN95"><span class='Ref_to_Member'>curcid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* inserted after scan started */ 
</span>        <span class='Comment_Multi_Line'>/* fall through */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if TransactionIdInArray(... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* committed before our xmin horizon. Do a normal visibility check. */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN168"><span class='Ref_to_Proto'>TransactionIdPrecedes</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1655"><span class='Ref_To_Local'>xmin</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN65"><span class='Ref_to_Member'>xmin</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN317"><span class='Ref_to_Macro'>HeapTupleHeaderXminCommitted</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                 <span class='Operator'>!</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1655"><span class='Ref_To_Local'>xmin</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check for hint bit first, consult clog afterwards */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN317"><span class='Ref_to_Macro'>HeapTupleHeaderXminCommitted</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1655"><span class='Ref_To_Local'>xmin</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* fall through */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* beyond our xmax horizon, i.e. invisible */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN171"><span class='Ref_to_Proto'>TransactionIdFollowsOrEquals</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1655"><span class='Ref_To_Local'>xmin</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN66"><span class='Ref_to_Member'>xmax</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* check if it's a committed transaction in [xmin, xmax) */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1629"><span class='Ref_to_Func'>TransactionIdInArray</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1655"><span class='Ref_To_Local'>xmin</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN76"><span class='Ref_to_Member'>xip</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN77"><span class='Ref_to_Member'>xcnt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* fall through */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * none of the above, i.e. between [xmin, xmax) but hasn't committed. I.e. 
     * invisible. 
     */ 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* at this point we know xmin is visible, go on to check xmax */ 
</span> 
    <span class='Comment_Multi_Line'>/* xid invalid or aborted */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* locked tuples are always visible */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN215"><span class='Ref_to_Macro'>HEAP_XMAX_IS_LOCKED_ONLY</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can see multis here if we're looking at user tables or if somebody 
     * SELECT ... FOR SHARE/UPDATE a system table. 
     */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tqual.c.html#LN1656"><span class='Ref_To_Local'>xmax</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup.h.html#LN85"><span class='Ref_to_Proto'>HeapTupleGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* check if it's one of our txids, toplevel is also in there */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1629"><span class='Ref_to_Func'>TransactionIdInArray</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1656"><span class='Ref_To_Local'>xmax</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN88"><span class='Ref_to_Member'>subxip</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN89"><span class='Ref_to_Member'>subxcnt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1745"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>resolved</span><span class='Delimiter'>; 
</span><a name="LN1746"></a>        <a href="../../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Local'>cmin</span><span class='Delimiter'>; 
</span><a name="LN1747"></a>        <a href="../../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Local'>cmax</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN384"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawCommandId</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Lookup actual cmin/cmax values */ 
</span>        <a href="tqual.c.html#LN1745"><span class='Ref_To_Local'>resolved</span></a> <span class='Operator'>= </span><a href="../../../include/utils/tqual.h.html#LN88"><span class='Ref_to_Proto'>ResolveCminCmaxDuringDecoding</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/snapmgr.h.html#LN102"><span class='Ref_to_Proto'>HistoricSnapshotGetTupleCids</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, 
</span>                                                 <a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>htup</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1652"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Operator'>&</span><a href="tqual.c.html#LN1746"><span class='Ref_To_Local'>cmin</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqual.c.html#LN1747"><span class='Ref_To_Local'>cmax</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqual.c.html#LN1745"><span class='Ref_To_Local'>resolved</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not resolve combocid to cmax"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1747"><span class='Ref_To_Local'>cmax</span></a> <span class='Operator'>!= </span><a href="../../../include/c.h.html#LN413"><span class='Ref_to_Const'>InvalidCommandId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1747"><span class='Ref_To_Local'>cmax</span></a> <span class='Operator'>&GT;= </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN95"><span class='Ref_to_Member'>curcid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* deleted after scan started */ 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* deleted before scan started */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if TransactionIdInArray(... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* below xmin horizon, normal transaction state is valid */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN168"><span class='Ref_to_Proto'>TransactionIdPrecedes</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1656"><span class='Ref_To_Local'>xmax</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN65"><span class='Ref_to_Member'>xmin</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a> <span class='Operator'>&& 
</span>                 <span class='Operator'>!</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1656"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check hint bit first */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1654"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check clog */ 
</span>        <span class='Control'>return</span> <span class='Operator'>!</span><a href="../../access/transam/transam.c.html#LN123"><span class='Ref_to_Func'>TransactionIdDidCommit</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1656"><span class='Ref_To_Local'>xmax</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* above xmax horizon, we cannot possibly see the deleting transaction */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN171"><span class='Ref_to_Proto'>TransactionIdFollowsOrEquals</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1656"><span class='Ref_To_Local'>xmax</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN66"><span class='Ref_to_Member'>xmax</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* xmax is between [xmin, xmax), check known committed array */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqual.c.html#LN1629"><span class='Ref_to_Func'>TransactionIdInArray</span></a><span class='Parentheses'>(</span><a href="tqual.c.html#LN1656"><span class='Ref_To_Local'>xmax</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN76"><span class='Ref_to_Member'>xip</span></a><span class='Delimiter'>, </span><a href="tqual.c.html#LN1651"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/snapshot.h.html#LN77"><span class='Ref_to_Member'>xcnt</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* xmax is between [xmin, xmax), but known not to have committed yet */ 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end HeapTupleSatisfiesHistoricMVCC &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>