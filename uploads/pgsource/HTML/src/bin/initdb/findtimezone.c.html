<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\initdb\findtimezone.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\initdb\findtimezone.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:59 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * findtimezone.c 
 *    Functions for determining the default timezone to use. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *    src/bin/initdb/findtimezone.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;time.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"pgtz.h"</span> 
 
<span class='Comment_Multi_Line'>/* Ideally this would be in a .h file, but it hardly seems worth the trouble */ 
</span><a name="LN21"></a><span class='Keyword'>extern const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>select_default_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>share_path</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Directive'>#ifndef</span> SYSTEMTZDIR 
<a name="LN25"></a><span class='Keyword'>static char </span><span class='Declare_Var'>tzdirpath</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Return full pathname of timezone data directory 
 * 
 * In this file, tzdirpath is assumed to be set up by select_default_timezone. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN35"></a><span class='Declare_Function'>pg_TZDIR</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifndef</span> SYSTEMTZDIR 
    <span class='Comment_Multi_Line'>/* normal case: timezone stuff is under our share dir */ 
</span>    <span class='Control'>return</span> <a href="findtimezone.c.html#LN25"><span class='Ref_to_Global_Var'>tzdirpath</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Comment_Multi_Line'>/* we're configured to use system's timezone database */ 
</span>    <span class='Control'>return</span> SYSTEMTZDIR<span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a timezone name, open() the timezone data file.  Return the 
 * file descriptor if successful, -1 if not. 
 * 
 * This is simpler than the backend function of the same name because 
 * we assume that the input string has the correct case already, so there 
 * is no need for case-folding.  (This is obviously true if we got the file 
 * name from the filesystem to start with.  The only other place it can come 
 * from is the environment variable TZ, and there seems no need to allow 
 * case variation in that; other programs aren't likely to.) 
 * 
 * If "canonname" is not NULL, then on success the canonical spelling of the 
 * given name is stored there (the buffer must be &GT; TZ_STRLEN_MAX bytes!). 
 * This is redundant but kept for compatibility with the backend code. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN63"></a><span class='Declare_Function'>pg_open_tzfile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>canonname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN65"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>fullname</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN63"><span class='Ref_to_Parameter'>canonname</span></a><span class='Parentheses'>) 
</span>        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN63"><span class='Ref_to_Parameter'>canonname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN63"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><a href="../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN65"><span class='Ref_To_Local'>fullname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN34"><span class='Ref_to_Func'>pg_TZDIR</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN65"><span class='Ref_To_Local'>fullname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN65"><span class='Ref_To_Local'>fullname</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN63"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* not gonna fit */ 
</span>    strcat<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN65"><span class='Ref_To_Local'>fullname</span></a><span class='Delimiter'>, </span><span class='String'>"/"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    strcat<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN65"><span class='Ref_To_Local'>fullname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN63"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN65"><span class='Ref_To_Local'>fullname</span></a><span class='Delimiter'>, </span>O_RDONLY <span class='Operator'>| </span><a href="../../include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Load a timezone definition. 
 * Does not verify that the timezone is acceptable! 
 * 
 * This corresponds to the backend's pg_tzset(), except that we only support 
 * one loaded timezone at a time. 
 */ 
</span><span class='Keyword'>static </span><a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>* 
</span><a name="LN89"></a><span class='Declare_Function'>pg_load_tz</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN91"></a>    <span class='Keyword'>static </span><a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN89"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* not going to fit */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * "GMT" is always sent to tzparse(); see comments for pg_tzset(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN89"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"GMT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../timezone/pgtz.h.html#LN72"><span class='Ref_to_Proto'>tzparse</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN89"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="findtimezone.c.html#LN91"><span class='Ref_To_Local'>tz</span></a><span class='Operator'>.</span><a href="../../timezone/pgtz.h.html#LN62"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* This really, really should not happen ... */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../timezone/pgtz.h.html#LN70"><span class='Ref_to_Proto'>tzload</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN89"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="findtimezone.c.html#LN91"><span class='Ref_To_Local'>tz</span></a><span class='Operator'>.</span><a href="../../timezone/pgtz.h.html#LN62"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN89"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>':'</span> <span class='Operator'>|| !</span><a href="../../timezone/pgtz.h.html#LN72"><span class='Ref_to_Proto'>tzparse</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN89"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="findtimezone.c.html#LN91"><span class='Ref_To_Local'>tz</span></a><span class='Operator'>.</span><a href="../../timezone/pgtz.h.html#LN62"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* unknown timezone */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN91"><span class='Ref_To_Local'>tz</span></a><span class='Operator'>.</span><a href="../../timezone/pgtz.h.html#LN61"><span class='Ref_to_Member'>TZname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN89"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Operator'>&</span><a href="findtimezone.c.html#LN91"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_load_tz &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * The following block of code attempts to determine which timezone in our 
 * timezone database is the best match for the active system timezone. 
 * 
 * On most systems, we rely on trying to match the observable behavior of 
 * the C library's localtime() function.  The database zone that matches 
 * furthest into the past is the one to use.  Often there will be several 
 * zones with identical rankings (since the Olson database assigns multiple 
 * names to many zones).  We break ties arbitrarily by preferring shorter, 
 * then alphabetically earlier zone names. 
 * 
 * Win32's native knowledge about timezones appears to be too incomplete 
 * and too different from the Olson database for the above matching strategy 
 * to be of any use. But there is just a limited number of timezones 
 * available, so we can rely on a handmade mapping table instead. 
 */ 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
<a name="LN140"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>T_DAY</span>   <span class='Parentheses'>((</span>time_t<span class='Parentheses'>) (</span><span class='Number'>60</span><span class='Operator'>*</span><span class='Number'>60</span><span class='Operator'>*</span><span class='Number'>24</span><span class='Parentheses'>))</span> 
<a name="LN141"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>T_WEEK</span>  <span class='Parentheses'>((</span>time_t<span class='Parentheses'>) (</span><span class='Number'>60</span><span class='Operator'>*</span><span class='Number'>60</span><span class='Operator'>*</span><span class='Number'>24</span><span class='Operator'>*</span><span class='Number'>7</span><span class='Parentheses'>))</span> 
<a name="LN142"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>T_MONTH</span> <span class='Parentheses'>((</span>time_t<span class='Parentheses'>) (</span><span class='Number'>60</span><span class='Operator'>*</span><span class='Number'>60</span><span class='Operator'>*</span><span class='Number'>24</span><span class='Operator'>*</span><span class='Number'>31</span><span class='Parentheses'>))</span> 
 
<a name="LN144"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_TEST_TIMES</span> <span class='Parentheses'>(</span><span class='Number'>52</span><span class='Operator'>*</span><span class='Number'>100</span><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* 100 years */ 
</span> 
<a name="LN146"></a><span class='Control'>struct</span> <span class='Declare_Struct'>tztry</span> 
<span class='Delimiter'>{ 
</span><a name="LN148"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>n_test_times</span><span class='Delimiter'>; 
</span><a name="LN149"></a>    time_t      <span class='Declare_Member'>test_times</span><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN144"><span class='Ref_to_Const'>MAX_TEST_TIMES</span></a><span class='Delimiter'>]; 
}; 
</span> 
<a name="LN152"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>scan_available_timezones</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzdir</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzdirsub</span><span class='Delimiter'>, 
</span><a name="LN153"></a>                         <span class='Control'>struct</span> <a href="findtimezone.c.html#LN146"><span class='Ref_to_Struct'>tztry</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tt</span><span class='Delimiter'>, 
</span><a name="LN154"></a>                         <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>bestscore</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>bestzonename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get GMT offset from a system struct tm 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN161"></a><span class='Declare_Function'>get_timezone_offset</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="findtimezone.c.html#LN161"><span class='Ref_to_Parameter'>tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_STRUCT_TM_TM_ZONE<span class='Parentheses'>) 
</span>    <span class='Control'>return</span> <a href="findtimezone.c.html#LN161"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span>tm_gmtoff<span class='Delimiter'>; 
</span><span class='Directive'>#elif</span> defined<span class='Parentheses'>(</span>HAVE_INT_TIMEZONE<span class='Parentheses'>) 
</span>    <span class='Control'>return</span> <span class='Operator'>-</span><a href="../../include/port.h.html#LN218"><span class='Ref_to_Const'>TIMEZONE_GLOBAL</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
#error No way to determine <a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Operator'>? </span>Can <span class='Keyword'>this </span>happen<span class='Operator'>? 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Convenience subroutine to convert y/m/d to time_t (NOT pg_time_t) 
 */ 
</span><span class='Keyword'>static </span>time_t 
<a name="LN176"></a><span class='Declare_Function'>build_time_t</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>year</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>month</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>day</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN178"></a>    <span class='Control'>struct</span> <a href="findtimezone.c.html#LN178"><span class='Ref_To_Local'>tm</span></a>   <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="findtimezone.c.html#LN178"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN178"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="findtimezone.c.html#LN178"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span>tm_mday <span class='Operator'>= </span><a href="findtimezone.c.html#LN176"><span class='Ref_to_Parameter'>day</span></a><span class='Delimiter'>; 
</span>    <a href="findtimezone.c.html#LN178"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span>tm_mon <span class='Operator'>= </span><a href="findtimezone.c.html#LN176"><span class='Ref_to_Parameter'>month</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="findtimezone.c.html#LN178"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span>tm_year <span class='Operator'>= </span><a href="findtimezone.c.html#LN176"><span class='Ref_to_Parameter'>year</span></a> <span class='Operator'>- </span><span class='Number'>1900</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> mktime<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="findtimezone.c.html#LN178"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Does a system tm value match one we computed ourselves? 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN192"></a><span class='Declare_Function'>compare_tm</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../timezone/localtime.c.html#LN110"><span class='Ref_to_Global_Var'>tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>p</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>-&GT;</span>tm_sec <span class='Operator'>!= </span><a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>|| 
</span>        <a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>-&GT;</span>tm_min <span class='Operator'>!= </span><a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>|| 
</span>        <a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>-&GT;</span>tm_hour <span class='Operator'>!= </span><a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>|| 
</span>        <a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>-&GT;</span>tm_mday <span class='Operator'>!= </span><a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>|| 
</span>        <a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>-&GT;</span>tm_mon <span class='Operator'>!= </span><a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>|| 
</span>        <a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>-&GT;</span>tm_year <span class='Operator'>!= </span><a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>|| 
</span>        <a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>-&GT;</span>tm_wday <span class='Operator'>!= </span><a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN32"><span class='Ref_to_Member'>tm_wday</span></a> <span class='Operator'>|| 
</span>        <a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>-&GT;</span>tm_yday <span class='Operator'>!= </span><a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN33"><span class='Ref_to_Member'>tm_yday</span></a> <span class='Operator'>|| 
</span>        <a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>-&GT;</span>tm_isdst <span class='Operator'>!= </span><a href="findtimezone.c.html#LN192"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * See how well a specific timezone setting matches the system behavior 
 * 
 * We score a timezone setting according to the number of test times it 
 * matches.  (The test times are ordered later-to-earlier, but this routine 
 * doesn't actually know that; it just scans until the first non-match.) 
 * 
 * We return -1 for a completely unusable setting; this is worse than the 
 * score of zero for a setting that works but matches not even the first 
 * test time. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN219"></a><span class='Declare_Function'>score_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzname</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="findtimezone.c.html#LN146"><span class='Ref_to_Struct'>tztry</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN221"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN222"></a>    <a href="../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>pgtt</span><span class='Delimiter'>; 
</span><a name="LN223"></a>    <span class='Control'>struct</span> <a href="../../timezone/localtime.c.html#LN110"><span class='Ref_to_Global_Var'>tm</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>systm</span><span class='Delimiter'>; 
</span><a name="LN224"></a>    <span class='Control'>struct</span> <a href="../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pgtm</span><span class='Delimiter'>; 
</span><a name="LN225"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>cbuf</span><span class='Delimiter'>[</span><a href="../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN226"></a>    <a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Load timezone definition */ 
</span>    <a href="findtimezone.c.html#LN226"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN88"><span class='Ref_to_Func'>pg_load_tz</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN219"><span class='Ref_to_Parameter'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="findtimezone.c.html#LN226"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* unrecognized zone name */ 
</span> 
    <span class='Comment_Multi_Line'>/* Reject if leap seconds involved */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/pgtime.h.html#LN63"><span class='Ref_to_Proto'>pg_tz_acceptable</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN226"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"Reject TZ \"%s\": uses leap seconds\n"</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN219"><span class='Ref_to_Parameter'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Check for match at all the test times */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="findtimezone.c.html#LN219"><span class='Ref_to_Parameter'>tt</span></a><span class='Operator'>-&GT;</span><a href="findtimezone.c.html#LN148"><span class='Ref_to_Member'>n_test_times</span></a><span class='Delimiter'>; </span><a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="findtimezone.c.html#LN222"><span class='Ref_To_Local'>pgtt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a><span class='Parentheses'>) (</span><a href="findtimezone.c.html#LN219"><span class='Ref_to_Parameter'>tt</span></a><span class='Operator'>-&GT;</span><a href="findtimezone.c.html#LN149"><span class='Ref_to_Member'>test_times</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a> <span class='Operator'>= </span><a href="../../include/pgtime.h.html#LN47"><span class='Ref_to_Proto'>pg_localtime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="findtimezone.c.html#LN222"><span class='Ref_To_Local'>pgtt</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN226"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* probably shouldn't happen */ 
</span>        <a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a> <span class='Operator'>= </span>localtime<span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN219"><span class='Ref_to_Parameter'>tt</span></a><span class='Operator'>-&GT;</span><a href="findtimezone.c.html#LN149"><span class='Ref_to_Member'>test_times</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"TZ \"%s\" scores %d: at %ld %04d-%02d-%02d %02d:%02d:%02d %s, system had no data\n"</span><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN219"><span class='Ref_to_Parameter'>tzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="findtimezone.c.html#LN222"><span class='Ref_To_Local'>pgtt</span></a><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>1900</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>? </span><span class='String'>"dst"</span> <span class='Operator'>: </span><span class='String'>"std"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <span class='Control'>return</span> <a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="findtimezone.c.html#LN191"><span class='Ref_to_Func'>compare_tm</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"TZ \"%s\" scores %d: at %ld %04d-%02d-%02d %02d:%02d:%02d %s versus %04d-%02d-%02d %02d:%02d:%02d %s\n"</span><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN219"><span class='Ref_to_Parameter'>tzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="findtimezone.c.html#LN222"><span class='Ref_To_Local'>pgtt</span></a><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>1900</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>? </span><span class='String'>"dst"</span> <span class='Operator'>: </span><span class='String'>"std"</span><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Operator'>-&GT;</span>tm_year <span class='Operator'>+ </span><span class='Number'>1900</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Operator'>-&GT;</span>tm_mon <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Operator'>-&GT;</span>tm_mday<span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Operator'>-&GT;</span>tm_hour<span class='Delimiter'>, </span><a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Operator'>-&GT;</span>tm_min<span class='Delimiter'>, </span><a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Operator'>-&GT;</span>tm_sec<span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Operator'>-&GT;</span>tm_isdst <span class='Operator'>? </span><span class='String'>"dst"</span> <span class='Operator'>: </span><span class='String'>"std"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <span class='Control'>return</span> <a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Operator'>-&GT;</span>tm_isdst <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Check match of zone names, too */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN36"><span class='Ref_to_Member'>tm_zone</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* probably shouldn't happen */ 
</span>            memset<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN225"><span class='Ref_To_Local'>cbuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN225"><span class='Ref_To_Local'>cbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../backend/utils/adt/pg_locale.c.html#LN753"><span class='Ref_to_Macro'>strftime</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN225"><span class='Ref_To_Local'>cbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN225"><span class='Ref_To_Local'>cbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"%Z"</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN223"><span class='Ref_To_Local'>systm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* zone abbr */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN225"><span class='Ref_To_Local'>cbuf</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN36"><span class='Ref_to_Member'>tm_zone</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"TZ \"%s\" scores %d: at %ld \"%s\" versus \"%s\"\n"</span><span class='Delimiter'>, 
</span>                        <a href="findtimezone.c.html#LN219"><span class='Ref_to_Parameter'>tzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="findtimezone.c.html#LN222"><span class='Ref_To_Local'>pgtt</span></a><span class='Delimiter'>, 
</span>                        <a href="findtimezone.c.html#LN224"><span class='Ref_To_Local'>pgtm</span></a><span class='Operator'>-&GT;</span><a href="../../include/pgtime.h.html#LN36"><span class='Ref_to_Member'>tm_zone</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN225"><span class='Ref_To_Local'>cbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
                <span class='Control'>return</span> <a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;tt-&GT;n_test_time... &raquo; </span> 
 
<span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"TZ \"%s\" gets max score %d\n"</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN219"><span class='Ref_to_Parameter'>tzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <a href="findtimezone.c.html#LN221"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end score_timezone &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Try to identify a timezone name (in our terminology) that best matches the 
 * observed behavior of the system timezone library.  We cannot assume that 
 * the system TZ environment setting (if indeed there is one) matches our 
 * terminology, so we ignore it and just look at what localtime() returns. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN309"></a><span class='Declare_Function'>identify_system_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN311"></a>    <span class='Keyword'>static char </span><span class='Declare_Local'>resultbuf</span><span class='Delimiter'>[</span><a href="../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN312"></a>    time_t      <span class='Declare_Local'>tnow</span><span class='Delimiter'>; 
</span><a name="LN313"></a>    time_t      <span class='Declare_Local'>t</span><span class='Delimiter'>; 
</span><a name="LN314"></a>    <span class='Control'>struct</span> <a href="findtimezone.c.html#LN146"><span class='Ref_to_Struct'>tztry</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>; 
</span><a name="LN315"></a>    <span class='Control'>struct</span> <a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN316"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>thisyear</span><span class='Delimiter'>; 
</span><a name="LN317"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bestscore</span><span class='Delimiter'>; 
</span><a name="LN318"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tmptzdir</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN319"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>std_ofs</span><span class='Delimiter'>; 
</span><a name="LN320"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>std_zone_name</span><span class='Delimiter'>[</span><a href="../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>], 
</span><a name="LN321"></a>                <span class='Declare_Local'>dst_zone_name</span><span class='Delimiter'>[</span><a href="../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN322"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>cbuf</span><span class='Delimiter'>[</span><a href="../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize OS timezone library */ 
</span>    tzset<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up the list of dates to be probed to see how well our timezone 
     * matches the system zone.  We first probe January and July of the 
     * current year; this serves to quickly eliminate the vast majority of the 
     * TZ database entries.  If those dates match, we probe every week for 100 
     * years backwards from the current July.  (Weekly resolution is good 
     * enough to identify DST transition rules, since everybody switches on 
     * Sundays.)  This is sufficient to cover most of the Unix time_t range, 
     * and we don't want to look further than that since many systems won't 
     * have sane TZ behavior further back anyway.  The further back the zone 
     * matches, the better we score it.  This may seem like a rather random 
     * way of doing things, but experience has shown that system-supplied 
     * timezone definitions are likely to have DST behavior that is right for 
     * the recent past and not so accurate further back. Scoring in this way 
     * allows us to recognize zones that have some commonality with the Olson 
     * database, without insisting on exact match. (Note: we probe Thursdays, 
     * not Sundays, to avoid triggering DST-transition bugs in localtime 
     * itself.) 
     */ 
</span>    <a href="findtimezone.c.html#LN312"><span class='Ref_To_Local'>tnow</span></a> <span class='Operator'>= </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a> <span class='Operator'>= </span>localtime<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="findtimezone.c.html#LN312"><span class='Ref_To_Local'>tnow</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* give up if localtime is broken... */ 
</span>    <a href="findtimezone.c.html#LN316"><span class='Ref_To_Local'>thisyear</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span>tm_year <span class='Operator'>+ </span><span class='Number'>1900</span><span class='Delimiter'>; 
</span> 
    <a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN175"><span class='Ref_to_Func'>build_time_t</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN316"><span class='Ref_To_Local'>thisyear</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>15</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Round back to GMT midnight Thursday.  This depends on the knowledge 
     * that the time_t origin is Thu Jan 01 1970.  (With a different origin 
     * we'd be probing some other day of the week, but it wouldn't matter 
     * anyway unless localtime() had DST-transition bugs.) 
     */ 
</span>    <a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>-= </span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>% </span><a href="findtimezone.c.html#LN141"><span class='Ref_to_Const'>T_WEEK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>.</span><a href="findtimezone.c.html#LN148"><span class='Ref_to_Member'>n_test_times</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>.</span><a href="findtimezone.c.html#LN149"><span class='Ref_to_Member'>test_times</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>.</span><a href="findtimezone.c.html#LN148"><span class='Ref_to_Member'>n_test_times</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>; 
</span> 
    <a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN175"><span class='Ref_to_Func'>build_time_t</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN316"><span class='Ref_To_Local'>thisyear</span></a><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Delimiter'>, </span><span class='Number'>15</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>-= </span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>% </span><a href="findtimezone.c.html#LN141"><span class='Ref_to_Const'>T_WEEK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>.</span><a href="findtimezone.c.html#LN149"><span class='Ref_to_Member'>test_times</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>.</span><a href="findtimezone.c.html#LN148"><span class='Ref_to_Member'>n_test_times</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>.</span><a href="findtimezone.c.html#LN148"><span class='Ref_to_Member'>n_test_times</span></a> <span class='Operator'>&LT; </span><a href="findtimezone.c.html#LN144"><span class='Ref_to_Const'>MAX_TEST_TIMES</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>-= </span><a href="findtimezone.c.html#LN141"><span class='Ref_to_Const'>T_WEEK</span></a><span class='Delimiter'>; 
</span>        <a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>.</span><a href="findtimezone.c.html#LN149"><span class='Ref_to_Member'>test_times</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>.</span><a href="findtimezone.c.html#LN148"><span class='Ref_to_Member'>n_test_times</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Search for the best-matching timezone file */ 
</span>    <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN318"><span class='Ref_To_Local'>tmptzdir</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN34"><span class='Ref_to_Func'>pg_TZDIR</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN318"><span class='Ref_To_Local'>tmptzdir</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="findtimezone.c.html#LN317"><span class='Ref_To_Local'>bestscore</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="findtimezone.c.html#LN152"><span class='Ref_to_Proto'>scan_available_timezones</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN318"><span class='Ref_To_Local'>tmptzdir</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN318"><span class='Ref_To_Local'>tmptzdir</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN318"><span class='Ref_To_Local'>tmptzdir</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="findtimezone.c.html#LN317"><span class='Ref_To_Local'>bestscore</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN317"><span class='Ref_To_Local'>bestscore</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Ignore Olson's rather silly "Factory" zone; use GMT instead */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>, </span><span class='String'>"Factory"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Couldn't find a match in the database, so next we try constructed zone 
     * names (like "PST8PDT"). 
     * 
     * First we need to determine the names of the local standard and daylight 
     * zones.  The idea here is to scan forward from today until we have seen 
     * both zones, if both are in use. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN320"><span class='Ref_To_Local'>std_zone_name</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN320"><span class='Ref_To_Local'>std_zone_name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN321"><span class='Ref_To_Local'>dst_zone_name</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN321"><span class='Ref_To_Local'>dst_zone_name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="findtimezone.c.html#LN319"><span class='Ref_To_Local'>std_ofs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="findtimezone.c.html#LN312"><span class='Ref_To_Local'>tnow</span></a> <span class='Operator'>= </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Round back to a GMT midnight so results don't depend on local time of 
     * day 
     */ 
</span>    <a href="findtimezone.c.html#LN312"><span class='Ref_To_Local'>tnow</span></a> <span class='Operator'>-= </span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN312"><span class='Ref_To_Local'>tnow</span></a> <span class='Operator'>% </span><a href="findtimezone.c.html#LN140"><span class='Ref_to_Const'>T_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We have to look a little further ahead than one year, in case today is 
     * just past a DST boundary that falls earlier in the year than the next 
     * similar boundary.  Arbitrarily scan up to 14 months. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN312"><span class='Ref_To_Local'>tnow</span></a><span class='Delimiter'>; </span><a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>&LT;= </span><a href="findtimezone.c.html#LN312"><span class='Ref_To_Local'>tnow</span></a> <span class='Operator'>+ </span><a href="findtimezone.c.html#LN142"><span class='Ref_to_Const'>T_MONTH</span></a> <span class='Operator'>* </span><span class='Number'>14</span><span class='Delimiter'>; </span><a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>+= </span><a href="findtimezone.c.html#LN142"><span class='Ref_to_Const'>T_MONTH</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a> <span class='Operator'>= </span>localtime<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="findtimezone.c.html#LN313"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span>tm_isdst <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span>tm_isdst <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="findtimezone.c.html#LN320"><span class='Ref_To_Local'>std_zone_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* found STD zone */ 
</span>            memset<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN322"><span class='Ref_To_Local'>cbuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN322"><span class='Ref_To_Local'>cbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../backend/utils/adt/pg_locale.c.html#LN753"><span class='Ref_to_Macro'>strftime</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN322"><span class='Ref_To_Local'>cbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN322"><span class='Ref_To_Local'>cbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"%Z"</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* zone abbr */ 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN320"><span class='Ref_To_Local'>std_zone_name</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN322"><span class='Ref_To_Local'>cbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="findtimezone.c.html#LN319"><span class='Ref_To_Local'>std_ofs</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN160"><span class='Ref_to_Func'>get_timezone_offset</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span>tm_isdst <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="findtimezone.c.html#LN321"><span class='Ref_To_Local'>dst_zone_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* found DST zone */ 
</span>            memset<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN322"><span class='Ref_To_Local'>cbuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN322"><span class='Ref_To_Local'>cbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../backend/utils/adt/pg_locale.c.html#LN753"><span class='Ref_to_Macro'>strftime</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN322"><span class='Ref_To_Local'>cbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN322"><span class='Ref_To_Local'>cbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"%Z"</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN315"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* zone abbr */ 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN321"><span class='Ref_To_Local'>dst_zone_name</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN322"><span class='Ref_To_Local'>cbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Done if found both */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN320"><span class='Ref_To_Local'>std_zone_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&& </span><a href="findtimezone.c.html#LN321"><span class='Ref_To_Local'>dst_zone_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for t=tnow;t&LT;=tnow+T_MONT... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* We should have found a STD zone name by now... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN320"><span class='Ref_To_Local'>std_zone_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not determine system time zone\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* go to GMT */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If we found DST then try STD&LT;ofs&GT;DST */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN321"><span class='Ref_To_Local'>dst_zone_name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s%d%s"</span><span class='Delimiter'>, 
</span>                 <a href="findtimezone.c.html#LN320"><span class='Ref_To_Local'>std_zone_name</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="findtimezone.c.html#LN319"><span class='Ref_To_Local'>std_ofs</span></a> <span class='Operator'>/ </span><span class='Number'>3600</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN321"><span class='Ref_To_Local'>dst_zone_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN218"><span class='Ref_to_Func'>score_timezone</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Try just the STD timezone (works for GMT at least) */ 
</span>    <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN320"><span class='Ref_To_Local'>std_zone_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN218"><span class='Ref_to_Func'>score_timezone</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Try STD&LT;ofs&GT; */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s%d"</span><span class='Delimiter'>, 
</span>             <a href="findtimezone.c.html#LN320"><span class='Ref_To_Local'>std_zone_name</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="findtimezone.c.html#LN319"><span class='Ref_To_Local'>std_ofs</span></a> <span class='Operator'>/ </span><span class='Number'>3600</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN218"><span class='Ref_to_Func'>score_timezone</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="findtimezone.c.html#LN314"><span class='Ref_To_Local'>tt</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Did not find the timezone.  Fallback to use a GMT zone.  Note that the 
     * Olson timezone database names the GMT-offset zones in POSIX style: plus 
     * is west of Greenwich.  It's unfortunate that this is opposite of SQL 
     * conventions.  Should we therefore change the names? Probably not... 
     */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"Etc/GMT%s%d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Operator'>-</span><a href="findtimezone.c.html#LN319"><span class='Ref_To_Local'>std_ofs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>"+"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="findtimezone.c.html#LN319"><span class='Ref_To_Local'>std_ofs</span></a> <span class='Operator'>/ </span><span class='Number'>3600</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not recognize system time zone, using \"%s\"\n"</span><span class='Delimiter'>, 
</span>            <a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>return</span> <a href="findtimezone.c.html#LN311"><span class='Ref_To_Local'>resultbuf</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end identify_system_timezone &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Recursively scan the timezone database looking for the best match to 
 * the system timezone behavior. 
 * 
 * tzdir points to a buffer of size MAXPGPATH.  On entry, it holds the 
 * pathname of a directory containing TZ files.  We internally modify it 
 * to hold pathnames of sub-directories and files, but must restore it 
 * to its original contents before exit. 
 * 
 * tzdirsub points to the part of tzdir that represents the subfile name 
 * (ie, tzdir + the original directory name length, plus one for the 
 * first added '/'). 
 * 
 * tt tells about the system timezone behavior we need to match. 
 * 
 * *bestscore and *bestzonename on entry hold the best score found so far 
 * and the name of the best zone.  We overwrite them if we find a better 
 * score.  bestzonename must be a buffer of length TZ_STRLEN_MAX + 1. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN508"></a><span class='Declare_Function'>scan_available_timezones</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzdir</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzdirsub</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="findtimezone.c.html#LN146"><span class='Ref_to_Struct'>tztry</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tt</span><span class='Delimiter'>, 
</span><a name="LN509"></a>                         <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>bestscore</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>bestzonename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN511"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tzdir_orig_len</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN512"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>names</span><span class='Delimiter'>; 
</span><a name="LN513"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>namep</span><span class='Delimiter'>; 
</span> 
    <a href="findtimezone.c.html#LN512"><span class='Ref_To_Local'>names</span></a> <span class='Operator'>= </span><a href="../../common/pgfnames.c.html#LN29"><span class='Ref_to_Func'>pgfnames</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="findtimezone.c.html#LN512"><span class='Ref_To_Local'>names</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN513"><span class='Ref_To_Local'>namep</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN512"><span class='Ref_To_Local'>names</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="findtimezone.c.html#LN513"><span class='Ref_To_Local'>namep</span></a><span class='Delimiter'>; </span><a href="findtimezone.c.html#LN513"><span class='Ref_To_Local'>namep</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN521"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span> <span class='Operator'>= *</span><a href="findtimezone.c.html#LN513"><span class='Ref_To_Local'>namep</span></a><span class='Delimiter'>; 
</span><a name="LN522"></a>        <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>statbuf</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore . and .., plus any other "hidden" files */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN521"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdir</span></a> <span class='Operator'>+ </span><a href="findtimezone.c.html#LN511"><span class='Ref_To_Local'>tzdir_orig_len</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>- </span><a href="findtimezone.c.html#LN511"><span class='Ref_To_Local'>tzdir_orig_len</span></a><span class='Delimiter'>, 
</span>                 <span class='String'>"/%s"</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN521"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdir</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="findtimezone.c.html#LN522"><span class='Ref_To_Local'>statbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not stat \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdir</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdir</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN511"><span class='Ref_To_Local'>tzdir_orig_len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN429"><span class='Ref_to_Macro'>S_ISDIR</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN522"><span class='Ref_To_Local'>statbuf</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Recurse into subdirectory */ 
</span>            <a href="findtimezone.c.html#LN152"><span class='Ref_to_Proto'>scan_available_timezones</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdir</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdirsub</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tt</span></a><span class='Delimiter'>, 
</span>                                     <a href="findtimezone.c.html#LN509"><span class='Ref_to_Parameter'>bestscore</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN509"><span class='Ref_to_Parameter'>bestzonename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Load and test this file */ 
</span><a name="LN550"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>score</span> <span class='Operator'>= </span><a href="findtimezone.c.html#LN218"><span class='Ref_to_Func'>score_timezone</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdirsub</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN550"><span class='Ref_To_Local'>score</span></a> <span class='Operator'>&GT; *</span><a href="findtimezone.c.html#LN509"><span class='Ref_to_Parameter'>bestscore</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="findtimezone.c.html#LN509"><span class='Ref_to_Parameter'>bestscore</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN550"><span class='Ref_To_Local'>score</span></a><span class='Delimiter'>; 
</span>                <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN509"><span class='Ref_to_Parameter'>bestzonename</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdirsub</span></a><span class='Delimiter'>, </span><a href="../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN550"><span class='Ref_To_Local'>score</span></a> <span class='Operator'>== *</span><a href="findtimezone.c.html#LN509"><span class='Ref_to_Parameter'>bestscore</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Consider how to break a tie */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdirsub</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT; </span>strlen<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN509"><span class='Ref_to_Parameter'>bestzonename</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                    <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdirsub</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span>strlen<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN509"><span class='Ref_to_Parameter'>bestzonename</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                     strcmp<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdirsub</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN509"><span class='Ref_to_Parameter'>bestzonename</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                    <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN509"><span class='Ref_to_Parameter'>bestzonename</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdirsub</span></a><span class='Delimiter'>, </span><a href="../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Restore tzdir */ 
</span>        <a href="findtimezone.c.html#LN508"><span class='Ref_to_Parameter'>tzdir</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN511"><span class='Ref_To_Local'>tzdir_orig_len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for namep=names;*namep;na... &raquo; </span> 
 
    <a href="../../include/port.h.html#LN66"><span class='Ref_to_Proto'>pgfnames_cleanup</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN512"><span class='Ref_To_Local'>names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end scan_available_timezones &raquo; </span> 
<span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
<span class='Keyword'>static const </span><span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN577"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>stdname</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Windows name of standard timezone */ 
</span><a name="LN578"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>dstname</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Windows name of daylight timezone */ 
</span><a name="LN579"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>pgtzname</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Name of pgsql timezone to map to */ 
</span><a name="LN580"></a><span class='Delimiter'>}</span>   <span class='Declare_Var'>win32_tzmap</span><span class='Delimiter'>[] </span><span class='Operator'>= 
</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * This list was built from the contents of the registry at 
     * HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Time 
     * Zones on Windows 10 and Windows 7. 
     * 
     * The zones have been matched to Olson timezones by looking at the cities 
     * listed in the win32 display name (in the comment here) in most cases. 
     */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Afghanistan Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Afghanistan Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Kabul"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+04:30) Kabul */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Alaskan Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Alaskan Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"US/Alaska"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-09:00) Alaska */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Aleutian Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Aleutian Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"US/Aleutan"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-10:00) Aleutian Islands */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Altai Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Altai Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Barnaul"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+07:00) Barnaul, Gorno-Altaysk */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Arab Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Arab Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Kuwait"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+03:00) Kuwait, Riyadh */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Arabian Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Arabian Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Muscat"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+04:00) Abu Dhabi, Muscat */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Arabic Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Arabic Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Baghdad"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+03:00) Baghdad */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Argentina Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Argentina Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Buenos_Aires"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-03:00) City of Buenos Aires */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Armenian Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Armenian Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Yerevan"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+04:00) Baku, Tbilisi, Yerevan */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Astrakhan Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Astrakhan Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Astrakhan"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+04:00) Astrakhan, Ulyanovsk */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Atlantic Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Atlantic Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Canada/Atlantic"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-04:00) Atlantic Time (Canada) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"AUS Central Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"AUS Central Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Australia/Darwin"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+09:30) Darwin */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Aus Central W. Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Aus Central W. Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Australia/Eucla"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+08:45) Eucla */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"AUS Eastern Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"AUS Eastern Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Australia/Canberra"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+10:00) Canberra, Melbourne, Sydney */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Azerbaijan Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Azerbaijan Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Baku"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+04:00) Baku */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Azores Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Azores Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Atlantic/Azores"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-01:00) Azores */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Bahia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Bahia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Salvador"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-03:00) Salvador */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Bangladesh Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Bangladesh Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Dhaka"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+06:00) Dhaka */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Bougainville Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Bougainville Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Bougainville"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+11:00) Bougainville Island */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Belarus Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Belarus Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Minsk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+03:00) Minsk */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Cabo Verde Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Cabo Verde Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Atlantic/Cape_Verde"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-01:00) Cabo Verde Is. */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Chatham Islands Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Chatham Islands Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Chatham"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+12:45) Chatham Islands */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Canada Central Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Canada Central Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Canada/Saskatchewan"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-06:00) Saskatchewan */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Cape Verde Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Cape Verde Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Atlantic/Cape_Verde"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-01:00) Cape Verde Is. */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Caucasus Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Caucasus Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Baku"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+04:00) Yerevan */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Cen. Australia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Cen. Australia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Australia/Adelaide"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+09:30) Adelaide */ 
</span>    <span class='Comment_Multi_Line'>/* Central America (other than Mexico) generally does not observe DST */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Central America Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Central America Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"CST6"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-06:00) Central America */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Central Asia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Central Asia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Dhaka"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+06:00) Astana */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Central Brazilian Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Central Brazilian Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Cuiaba"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-04:00) Cuiaba */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Central Europe Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Central Europe Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Belgrade"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC+01:00) Belgrade, Bratislava, Budapest, 
                                 * Ljubljana, Prague */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Central European Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Central European Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Sarajevo"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC+01:00) Sarajevo, Skopje, Warsaw, 
                                 * Zagreb */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Central Pacific Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Central Pacific Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Noumea"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+11:00) Solomon Is., New Caledonia */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Central Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Central Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"US/Central"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-06:00) Central Time (US & Canada) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Central Standard Time (Mexico)"</span><span class='Delimiter'>, </span><span class='String'>"Central Daylight Time (Mexico)"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Mexico_City"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC-06:00) Guadalajara, Mexico City, 
                                 * Monterrey */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"China Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"China Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Hong_Kong"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC+08:00) Beijing, Chongqing, Hong Kong, 
                                 * Urumqi */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Cuba Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Cuba Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Havana"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-05:00) Havana */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Dateline Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Dateline Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Etc/UTC+12"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-12:00) International Date Line West */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"E. Africa Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"E. Africa Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Africa/Nairobi"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+03:00) Nairobi */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"E. Australia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"E. Australia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Australia/Brisbane"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+10:00) Brisbane */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"E. Europe Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"E. Europe Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Bucharest"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) E. Europe */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"E. South America Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"E. South America Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Araguaina"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-03:00) Brasilia */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Eastern Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Eastern Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"US/Eastern"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-05:00) Eastern Time (US & Canada) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Eastern Standard Time (Mexico)"</span><span class='Delimiter'>, </span><span class='String'>"Eastern Daylight Time (Mexico)"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Mexico_City"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-05:00) Chetumal */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Easter Island Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Easter Island Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Easter"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-06:00) Easter Island */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Egypt Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Egypt Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Africa/Cairo"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Cairo */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Ekaterinburg Standard Time (RTZ 4)"</span><span class='Delimiter'>, </span><span class='String'>"Ekaterinburg Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Yekaterinburg"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+05:00) Ekaterinburg */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Fiji Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Fiji Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Fiji"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+12:00) Fiji */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"FLE Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"FLE Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Helsinki"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC+02:00) Helsinki, Kyiv, Riga, Sofia, 
                                 * Tallinn, Vilnius */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Georgian Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Georgian Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Tbilisi"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+04:00) Tbilisi */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"GMT Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"GMT Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/London"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC) Dublin, Edinburgh, Lisbon, London */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Greenland Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Greenland Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Godthab"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-03:00) Greenland */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Greenwich Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Greenwich Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Africa/Casablanca"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC) Monrovia, Reykjavik */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"GTB Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"GTB Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Athens"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Athens, Bucharest */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Haiti Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Haiti Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"US/Eastern"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-05:00) Haiti */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Hawaiian Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Hawaiian Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"US/Hawaii"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-10:00) Hawaii */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"India Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"India Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Calcutta"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC+05:30) Chennai, Kolkata, Mumbai, New 
                                 * Delhi */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Iran Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Iran Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Tehran"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+03:30) Tehran */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Jerusalem Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Jerusalem Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Jerusalem"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Jerusalem */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Jordan Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Jordan Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Amman"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Amman */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Kamchatka Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Kamchatka Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Kamchatka"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+12:00) Petropavlovsk-Kamchatsky - Old */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Korea Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Korea Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Seoul"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+09:00) Seoul */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Libya Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Libya Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Africa/Tripoli"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Tripoli */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Line Islands Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Line Islands Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Kiritimati"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+14:00) Kiritimati Island */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Lord Howe Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Lord Howe Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Australia/Lord_Howe"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+10:30) Lord Howe Island */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Magadan Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Magadan Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Magadan"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+10:00) Magadan */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Marquesas Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Marquesas Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Marquesas"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-09:30) Marquesas Islands */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Mauritius Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Mauritius Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Indian/Mauritius"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+04:00) Port Louis */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Mexico Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Mexico Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Mexico_City"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC-06:00) Guadalajara, Mexico City, 
                                 * Monterrey */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Mexico Standard Time 2"</span><span class='Delimiter'>, </span><span class='String'>"Mexico Daylight Time 2"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Chihuahua"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-07:00) Chihuahua, La Paz, Mazatlan */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Mid-Atlantic Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Mid-Atlantic Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Atlantic/South_Georgia"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-02:00) Mid-Atlantic - Old */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Middle East Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Middle East Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Beirut"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Beirut */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Montevideo Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Montevideo Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Montevideo"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-03:00) Montevideo */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Morocco Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Morocco Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Africa/Casablanca"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC) Casablanca */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Mountain Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Mountain Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"US/Mountain"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-07:00) Mountain Time (US & Canada) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Mountain Standard Time (Mexico)"</span><span class='Delimiter'>, </span><span class='String'>"Mountain Daylight Time (Mexico)"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Chihuahua"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-07:00) Chihuahua, La Paz, Mazatlan */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Myanmar Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Myanmar Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Rangoon"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+06:30) Yangon (Rangoon) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"N. Central Asia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"N. Central Asia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Novosibirsk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+06:00) Novosibirsk (RTZ 5) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Namibia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Namibia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Africa/Windhoek"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+01:00) Windhoek */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Nepal Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Nepal Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Katmandu"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+05:45) Kathmandu */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"New Zealand Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"New Zealand Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Auckland"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+12:00) Auckland, Wellington */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Newfoundland Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Newfoundland Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Canada/Newfoundland"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-03:30) Newfoundland */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Norfolk Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Norfolk Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Norfolk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+11:00) Norfolk Island */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"North Asia East Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"North Asia East Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Irkutsk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+08:00) Irkutsk, Ulaan Bataar */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"North Asia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"North Asia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Krasnoyarsk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+07:00) Krasnoyarsk */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"North Korea Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"North Korea Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Pyongyang"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+08:30) Pyongyang */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Pacific SA Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Pacific SA Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Santiago"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-03:00) Santiago */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Pacific Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Pacific Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"US/Pacific"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-08:00) Pacific Time (US & Canada) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Pacific Standard Time (Mexico)"</span><span class='Delimiter'>, </span><span class='String'>"Pacific Daylight Time (Mexico)"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Tijuana"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-08:00) Baja California */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Pakistan Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Pakistan Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Karachi"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+05:00) Islamabad, Karachi */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Paraguay Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Paraguay Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Asuncion"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-04:00) Asuncion */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Romance Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Romance Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Brussels"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC+01:00) Brussels, Copenhagen, Madrid, 
                                 * Paris */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 1 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 1 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Kaliningrad"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Kaliningrad (RTZ 1) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 2 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 2 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Moscow"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC+03:00) Moscow, St. Petersburg, 
                                 * Volgograd (RTZ 2) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 3 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 3 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Samara"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+04:00) Izhevsk, Samara (RTZ 3) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 4 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 4 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Yekaterinburg"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+05:00) Ekaterinburg (RTZ 4) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 5 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 5 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Novosibirsk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+06:00) Novosibirsk (RTZ 5) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 6 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 6 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Krasnoyarsk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+07:00) Krasnoyarsk (RTZ 6) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 7 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 7 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Irkutsk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+08:00) Irkutsk (RTZ 7) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 8 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 8 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Yakutsk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+09:00) Yakutsk (RTZ 8) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 9 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 9 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Vladivostok"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+10:00) Vladivostok, Magadan (RTZ 9) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 10 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 10 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Magadan"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+11:00) Chokurdakh (RTZ 10) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russia TZ 11 Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russia TZ 11 Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Anadyr"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC+12:00) Anadyr, 
                                 * Petropavlovsk-Kamchatsky (RTZ 11) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Russian Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Russian Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Moscow"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC+03:00) Moscow, St. Petersburg, 
                                 * Volgograd */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"SA Eastern Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"SA Eastern Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Buenos_Aires"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-03:00) Cayenne, Fortaleza */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"SA Pacific Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"SA Pacific Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Bogota"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-05:00) Bogota, Lima, Quito, Rio Branco */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"SA Western Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"SA Western Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Caracas"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC-04:00) Georgetown, La Paz, Manaus, San 
                                 * Juan */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Saint Pierre Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Saint Pierre Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Miquelon"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-03:00) Saint Pierre and Miquelon */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Samoa Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Samoa Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Samoa"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+13:00) Samoa */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"SE Asia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"SE Asia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Bangkok"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+07:00) Bangkok, Hanoi, Jakarta */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Malay Peninsula Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Malay Peninsula Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Kuala_Lumpur"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+08:00) Kuala Lumpur, Singapore */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Sakhalin Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Sakhalin Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Sakhalin"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+11:00) Sakhalin */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"South Africa Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"South Africa Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Africa/Harare"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Harare, Pretoria */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Sri Lanka Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Sri Lanka Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Colombo"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+05:30) Sri Jayawardenepura */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Syria Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Syria Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Damascus"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Damascus */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Taipei Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Taipei Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Taipei"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+08:00) Taipei */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Tasmania Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Tasmania Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Australia/Hobart"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+10:00) Hobart */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Tocantins Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Tocantins Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Araguaina"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-03:00) Araguaina */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Tokyo Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Tokyo Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Tokyo"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+09:00) Osaka, Sapporo, Tokyo */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Tonga Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Tonga Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Tongatapu"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+13:00) Nuku'alofa */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Tomsk Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Tomsk Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Tomsk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+07:00) Tomsk */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Transbaikal Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Transbaikal Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Chita"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+09:00) Chita */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Turkey Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Turkey Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Europe/Istanbul"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Istanbul */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Turks and Caicos Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Turks and Caicos Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Grand_Turk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-04:00) Turks and Caicos */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Ulaanbaatar Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Ulaanbaatar Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Ulaanbaatar"</span><span class='Delimiter'>, 
</span>    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+08:00) Ulaanbaatar */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"US Eastern Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"US Eastern Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"US/Eastern"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-05:00) Indiana (East) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"US Mountain Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"US Mountain Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"US/Arizona"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-07:00) Arizona */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Coordinated Universal Time"</span><span class='Delimiter'>, </span><span class='String'>"Coordinated Universal Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"UTC"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC) Coordinated Universal Time */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"UTC+12"</span><span class='Delimiter'>, </span><span class='String'>"UTC+12"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Etc/GMT+12"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+12:00) Coordinated Universal Time+12 */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"UTC-02"</span><span class='Delimiter'>, </span><span class='String'>"UTC-02"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Etc/GMT-02"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-02:00) Coordinated Universal Time-02 */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"UTC-08"</span><span class='Delimiter'>, </span><span class='String'>"UTC-08"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Etc/GMT-08"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-08:00) Coordinated Universal Time-08 */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"UTC-09"</span><span class='Delimiter'>, </span><span class='String'>"UTC-09"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Etc/GMT-09"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-09:00) Coordinated Universal Time-09 */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"UTC-11"</span><span class='Delimiter'>, </span><span class='String'>"UTC-11"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Etc/GMT-11"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-11:00) Coordinated Universal Time-11 */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Venezuela Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Venezuela Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"America/Caracas"</span><span class='Delimiter'>, 
</span>    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC-04:30) Caracas */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Vladivostok Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Vladivostok Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Vladivostok"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+10:00) Vladivostok (RTZ 9) */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"W. Australia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"W. Australia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Australia/Perth"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+08:00) Perth */ 
</span><span class='Directive'>#ifdef</span> NOT_USED 
    <span class='Comment_Multi_Line'>/* Could not find a match for this one (just a guess). Excluded for now. */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"W. Central Africa Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"W. Central Africa Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"WAT"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+01:00) West Central Africa */ 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>{ 
</span>        <span class='String'>"W. Europe Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"W. Europe Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"CET"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Multi_Line'>/* (UTC+01:00) Amsterdam, Berlin, Bern, Rome, 
                                 * Stockholm, Vienna */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"W. Mongolia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"W. Mongolia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Hovd"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+07:00) Hovd */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"West Asia Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"West Asia Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Karachi"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+05:00) Ashgabat, Tashkent */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"West Bank Gaza Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"West Bank Gaza Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Gaza"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+02:00) Gaza, Hebron */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"West Pacific Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"West Pacific Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Pacific/Guam"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+10:00) Guam, Port Moresby */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"Yakutsk Standard Time"</span><span class='Delimiter'>, </span><span class='String'>"Yakutsk Daylight Time"</span><span class='Delimiter'>, 
</span>        <span class='String'>"Asia/Yakutsk"</span> 
    <span class='Delimiter'>},</span>                          <span class='Comment_Single_Line'>/* (UTC+09:00) Yakutsk */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end win32_tzmap &raquo; </span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN1182"></a><span class='Declare_Function'>identify_system_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1184"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1185"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tzname</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span><a name="LN1186"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>localtzname</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span><a name="LN1187"></a>    time_t      <span class='Declare_Local'>t</span> <span class='Operator'>= </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1188"></a>    <span class='Control'>struct</span> <a href="findtimezone.c.html#LN1188"><span class='Ref_To_Local'>tm</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= </span>localtime<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="findtimezone.c.html#LN1187"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1189"></a>    HKEY        <span class='Declare_Local'>rootKey</span><span class='Delimiter'>; 
</span><a name="LN1190"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>idx</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="findtimezone.c.html#LN1188"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not identify system time zone: localtime() failed\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* go to GMT */ 
</span>    <span class='Delimiter'>} 
</span> 
    memset<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../backend/utils/adt/pg_locale.c.html#LN753"><span class='Ref_to_Macro'>strftime</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"%Z"</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN1188"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="findtimezone.c.html#LN580"><span class='Ref_to_Global_Var'>win32_tzmap</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="findtimezone.c.html#LN577"><span class='Ref_to_Member'>stdname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN580"><span class='Ref_to_Global_Var'>win32_tzmap</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="findtimezone.c.html#LN577"><span class='Ref_to_Member'>stdname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN580"><span class='Ref_to_Global_Var'>win32_tzmap</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="findtimezone.c.html#LN578"><span class='Ref_to_Member'>dstname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"TZ \"%s\" matches system time zone \"%s\"\n"</span><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN580"><span class='Ref_to_Global_Var'>win32_tzmap</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="findtimezone.c.html#LN579"><span class='Ref_to_Member'>pgtzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <span class='Control'>return</span> <a href="findtimezone.c.html#LN580"><span class='Ref_to_Global_Var'>win32_tzmap</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="findtimezone.c.html#LN579"><span class='Ref_to_Member'>pgtzname</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Localized Windows versions return localized names for the timezone. 
     * Scan the registry to find the English name, and then try matching 
     * against our table again. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1186"><span class='Ref_To_Local'>localtzname</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1186"><span class='Ref_To_Local'>localtzname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>RegOpenKeyEx<span class='Parentheses'>(</span>HKEY_LOCAL_MACHINE<span class='Delimiter'>, 
</span>               <span class='String'>"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Time Zones"</span><span class='Delimiter'>, 
</span>                     <span class='Number'>0</span><span class='Delimiter'>, 
</span>                     KEY_READ<span class='Delimiter'>, 
</span>                     <span class='Operator'>&</span><a href="findtimezone.c.html#LN1189"><span class='Ref_To_Local'>rootKey</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span>ERROR_SUCCESS<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not open registry key to identify system time zone: error code %lu\n"</span><span class='Delimiter'>, 
</span>                GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* go to GMT */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1190"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;; </span><a href="findtimezone.c.html#LN1190"><span class='Ref_To_Local'>idx</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1237"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>keyname</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span><a name="LN1238"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>zonename</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span><a name="LN1239"></a>        <span class='Keyword'>DWORD</span>       <span class='Declare_Local'>namesize</span><span class='Delimiter'>; 
</span><a name="LN1240"></a>        FILETIME    <span class='Declare_Local'>lastwrite</span><span class='Delimiter'>; 
</span><a name="LN1241"></a>        HKEY        <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN1242"></a>        <span class='Keyword'>LONG</span>        <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
        memset<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1237"><span class='Ref_To_Local'>keyname</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1237"><span class='Ref_To_Local'>keyname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="findtimezone.c.html#LN1239"><span class='Ref_To_Local'>namesize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1237"><span class='Ref_To_Local'>keyname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="findtimezone.c.html#LN1242"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>RegEnumKeyEx<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1189"><span class='Ref_To_Local'>rootKey</span></a><span class='Delimiter'>, 
</span>                              <a href="findtimezone.c.html#LN1190"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>, 
</span>                              <a href="findtimezone.c.html#LN1237"><span class='Ref_To_Local'>keyname</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="findtimezone.c.html#LN1239"><span class='Ref_To_Local'>namesize</span></a><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="findtimezone.c.html#LN1240"><span class='Ref_To_Local'>lastwrite</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span>ERROR_SUCCESS<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1242"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span>ERROR_NO_MORE_ITEMS<span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not enumerate registry subkeys to identify system time zone: %d\n"</span><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="findtimezone.c.html#LN1242"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="findtimezone.c.html#LN1242"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>RegOpenKeyEx<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1189"><span class='Ref_To_Local'>rootKey</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN1237"><span class='Ref_To_Local'>keyname</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span>KEY_READ<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="findtimezone.c.html#LN1241"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span>ERROR_SUCCESS<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not open registry subkey to identify system time zone: %d\n"</span><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="findtimezone.c.html#LN1242"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        memset<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1238"><span class='Ref_To_Local'>zonename</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1238"><span class='Ref_To_Local'>zonename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="findtimezone.c.html#LN1239"><span class='Ref_To_Local'>namesize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1238"><span class='Ref_To_Local'>zonename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="findtimezone.c.html#LN1242"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>RegQueryValueEx<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1241"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='String'>"Std"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="findtimezone.c.html#LN1238"><span class='Ref_To_Local'>zonename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="findtimezone.c.html#LN1239"><span class='Ref_To_Local'>namesize</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span>ERROR_SUCCESS<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not query value for key \"std\" to identify system time zone \"%s\": %d\n"</span><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN1237"><span class='Ref_To_Local'>keyname</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="findtimezone.c.html#LN1242"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            RegCloseKey<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1241"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* Proceed to look at the next timezone */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN1238"><span class='Ref_To_Local'>zonename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Matched zone */ 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1186"><span class='Ref_To_Local'>localtzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN1237"><span class='Ref_To_Local'>keyname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            RegCloseKey<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1241"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        memset<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1238"><span class='Ref_To_Local'>zonename</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1238"><span class='Ref_To_Local'>zonename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="findtimezone.c.html#LN1239"><span class='Ref_To_Local'>namesize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1238"><span class='Ref_To_Local'>zonename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="findtimezone.c.html#LN1242"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>RegQueryValueEx<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1241"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='String'>"Dlt"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="findtimezone.c.html#LN1238"><span class='Ref_To_Local'>zonename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="findtimezone.c.html#LN1239"><span class='Ref_To_Local'>namesize</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span>ERROR_SUCCESS<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not query value for key \"dlt\" to identify system time zone \"%s\": %d\n"</span><span class='Delimiter'>, 
</span>                    <a href="findtimezone.c.html#LN1237"><span class='Ref_To_Local'>keyname</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="findtimezone.c.html#LN1242"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            RegCloseKey<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1241"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* Proceed to look at the next timezone */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN1238"><span class='Ref_To_Local'>zonename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Matched DST zone */ 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1186"><span class='Ref_To_Local'>localtzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN1237"><span class='Ref_To_Local'>keyname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            RegCloseKey<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1241"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        RegCloseKey<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1241"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for idx=0;;idx++ &raquo; </span> 
 
    RegCloseKey<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1189"><span class='Ref_To_Local'>rootKey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1186"><span class='Ref_To_Local'>localtzname</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Found a localized name, so scan for that one too */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="findtimezone.c.html#LN580"><span class='Ref_to_Global_Var'>win32_tzmap</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="findtimezone.c.html#LN577"><span class='Ref_to_Member'>stdname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1186"><span class='Ref_To_Local'>localtzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN580"><span class='Ref_to_Global_Var'>win32_tzmap</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="findtimezone.c.html#LN577"><span class='Ref_to_Member'>stdname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                strcmp<span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1186"><span class='Ref_To_Local'>localtzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN580"><span class='Ref_to_Global_Var'>win32_tzmap</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="findtimezone.c.html#LN578"><span class='Ref_to_Member'>dstname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"TZ \"%s\" matches localized system time zone \"%s\" (\"%s\")\n"</span><span class='Delimiter'>, 
</span>                        <a href="findtimezone.c.html#LN580"><span class='Ref_to_Global_Var'>win32_tzmap</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="findtimezone.c.html#LN579"><span class='Ref_to_Member'>pgtzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN1186"><span class='Ref_To_Local'>localtzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
                <span class='Control'>return</span> <a href="findtimezone.c.html#LN580"><span class='Ref_to_Global_Var'>win32_tzmap</span></a><span class='Delimiter'>[</span><a href="findtimezone.c.html#LN1184"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="findtimezone.c.html#LN579"><span class='Ref_to_Member'>pgtzname</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> DEBUG_IDENTIFY_TIMEZONE 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not find a match for system time zone \"%s\"\n"</span><span class='Delimiter'>, 
</span>            <a href="findtimezone.c.html#LN1185"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* go to GMT */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end identify_system_timezone &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return true if the given zone name is valid and is an "acceptable" zone. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1345"></a><span class='Declare_Function'>validate_zone</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1347"></a>    <a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="findtimezone.c.html#LN1345"><span class='Ref_to_Parameter'>tzname</span></a> <span class='Operator'>|| !</span><a href="findtimezone.c.html#LN1345"><span class='Ref_to_Parameter'>tzname</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="findtimezone.c.html#LN1347"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN88"><span class='Ref_to_Func'>pg_load_tz</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1345"><span class='Ref_to_Parameter'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="findtimezone.c.html#LN1347"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/pgtime.h.html#LN63"><span class='Ref_to_Proto'>pg_tz_acceptable</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1347"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Identify a suitable default timezone setting based on the environment. 
 * 
 * The installation share_path must be passed in, as that is the default 
 * location for the timezone database directory. 
 * 
 * We first look to the TZ environment variable.  If not found or not 
 * recognized by our own code, we see if we can identify the timezone 
 * from the behavior of the system timezone library.  When all else fails, 
 * return NULL, indicating that we should default to GMT. 
 */ 
</span><span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN1374"></a><span class='Declare_Function'>select_default_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>share_path</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1376"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tzname</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize timezone directory path, if needed */ 
</span><span class='Directive'>#ifndef</span> SYSTEMTZDIR 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN25"><span class='Ref_to_Global_Var'>tzdirpath</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN25"><span class='Ref_to_Global_Var'>tzdirpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/timezone"</span><span class='Delimiter'>, </span><a href="findtimezone.c.html#LN1374"><span class='Ref_to_Parameter'>share_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* Check TZ environment variable */ 
</span>    <a href="findtimezone.c.html#LN1376"><span class='Ref_To_Local'>tzname</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"TZ"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1344"><span class='Ref_to_Func'>validate_zone</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1376"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="findtimezone.c.html#LN1376"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Nope, so try to identify the system timezone */ 
</span>    <a href="findtimezone.c.html#LN1376"><span class='Ref_To_Local'>tzname</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN308"><span class='Ref_to_Func'>identify_system_timezone</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1344"><span class='Ref_to_Func'>validate_zone</span></a><span class='Parentheses'>(</span><a href="findtimezone.c.html#LN1376"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="findtimezone.c.html#LN1376"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end select_default_timezone &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>