<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\initdb\initdb.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\initdb\initdb.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:59 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * initdb --- initialize a PostgreSQL installation 
 * 
 * initdb creates (initializes) a PostgreSQL database cluster (site, 
 * instance, installation, whatever).  A database cluster is a 
 * collection of PostgreSQL databases all managed by the same server. 
 * 
 * To create the database cluster, we create the directory that contains 
 * all its data, create the files that hold the global tables, create 
 * a few other control files for it, and create three databases: the 
 * template databases "template0" and "template1", and a default user 
 * database "postgres". 
 * 
 * The template databases are ordinary PostgreSQL databases.  template0 
 * is never supposed to change after initdb, whereas template1 can be 
 * changed to add site-local standard data.  Either one can be copied 
 * to produce a new database. 
 * 
 * For largely-historical reasons, the template1 database is the one built 
 * by the basic bootstrap process.  After it is complete, template0 and 
 * the default database, postgres, are made just by copying template1. 
 * 
 * To create template1, we run the postgres (backend) program in bootstrap 
 * mode and feed it data from the postgres.bki library file.  After this 
 * initial bootstrap phase, some additional stuff is created by normal 
 * SQL commands fed to a standalone backend.  Some of those commands are 
 * just embedded into this program (yeah, it's ugly), but larger chunks 
 * are taken from script files. 
 * 
 * 
 * Note: 
 *   The program has some memory leakage - it isn't worth cleaning it up. 
 * 
 * This is a C implementation of the previous shell script for setting up a 
 * PostgreSQL cluster location, and should be highly compatible with it. 
 * author of C translation: Andrew Dunstan     mailto:andrew@dunslane.net 
 * 
 * This code is released under the terms of the PostgreSQL License. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * src/bin/initdb/initdb.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;dirent.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;signal.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;time.h&GT;</span> 
 
<span class='Directive'>#ifdef</span> HAVE_SHM_OPEN 
<span class='Keyword'>#include </span><span class='String'>"sys/mman.h"</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_authid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_class.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/file_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/restricted_token.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/username.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"fe_utils/string_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"getaddrinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"getopt_long.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* Ideally this would be in a .h file, but it hardly seems worth the trouble */ 
</span><a name="LN76"></a><span class='Keyword'>extern const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>select_default_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>share_path</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN78"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>auth_methods_host</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='String'>"trust"</span><span class='Delimiter'>, </span><span class='String'>"reject"</span><span class='Delimiter'>, </span><span class='String'>"scram-sha-256"</span><span class='Delimiter'>, </span><span class='String'>"md5"</span><span class='Delimiter'>, </span><span class='String'>"password"</span><span class='Delimiter'>, </span><span class='String'>"ident"</span><span class='Delimiter'>, </span><span class='String'>"radius"</span><span class='Delimiter'>, 
</span><span class='Directive'>#ifdef</span> ENABLE_GSS 
    <span class='String'>"gss"</span><span class='Delimiter'>, 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/port/win32.h.html#LN30"><span class='Ref_to_Const'>ENABLE_SSPI</span></a> 
    <span class='String'>"sspi"</span><span class='Delimiter'>, 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> USE_PAM 
    <span class='String'>"pam"</span><span class='Delimiter'>, </span><span class='String'>"pam "</span><span class='Delimiter'>, 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> USE_BSD_AUTH 
    <span class='String'>"bsd"</span><span class='Delimiter'>, 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> USE_LDAP 
    <span class='String'>"ldap"</span><span class='Delimiter'>, 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN172"><span class='Ref_to_Const'>USE_SSL</span></a> 
    <span class='String'>"cert"</span><span class='Delimiter'>, 
</span><span class='Directive'>#endif</span> 
    <span class='Null_Value'>NULL 
</span><span class='Delimiter'>}; 
</span><a name="LN100"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>auth_methods_local</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='String'>"trust"</span><span class='Delimiter'>, </span><span class='String'>"reject"</span><span class='Delimiter'>, </span><span class='String'>"scram-sha-256"</span><span class='Delimiter'>, </span><span class='String'>"md5"</span><span class='Delimiter'>, </span><span class='String'>"password"</span><span class='Delimiter'>, </span><span class='String'>"peer"</span><span class='Delimiter'>, </span><span class='String'>"radius"</span><span class='Delimiter'>, 
</span><span class='Directive'>#ifdef</span> USE_PAM 
    <span class='String'>"pam"</span><span class='Delimiter'>, </span><span class='String'>"pam "</span><span class='Delimiter'>, 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> USE_BSD_AUTH 
    <span class='String'>"bsd"</span><span class='Delimiter'>, 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> USE_LDAP 
    <span class='String'>"ldap"</span><span class='Delimiter'>, 
</span><span class='Directive'>#endif</span> 
    <span class='Null_Value'>NULL 
</span><span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * these values are passed in by makefile defines 
 */ 
</span><a name="LN117"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>share_path</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* values to be obtained from arguments */ 
</span><a name="LN120"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>pg_data</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN121"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>encoding</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN122"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>locale</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN123"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>lc_collate</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN124"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>lc_ctype</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN125"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>lc_monetary</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN126"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>lc_numeric</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN127"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>lc_time</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN128"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>lc_messages</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN129"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>default_text_search_config</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN130"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>username</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN131"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>pwprompt</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN132"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>pwfilename</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN133"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>superuser_password</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN134"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>authmethodhost</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN135"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>authmethodlocal</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN136"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>debug</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN137"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>noclean</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN138"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>do_sync</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN139"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>sync_only</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN140"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>show_setting</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN141"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>data_checksums</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN142"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>xlog_dir</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* internal vars */ 
</span><a name="LN146"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>progname</span><span class='Delimiter'>; 
</span><a name="LN147"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>encodingid</span> <span class='Operator'>= </span><span class='String'>"0"</span><span class='Delimiter'>; 
</span><a name="LN148"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>bki_file</span><span class='Delimiter'>; 
</span><a name="LN149"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>desc_file</span><span class='Delimiter'>; 
</span><a name="LN150"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>shdesc_file</span><span class='Delimiter'>; 
</span><a name="LN151"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>hba_file</span><span class='Delimiter'>; 
</span><a name="LN152"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>ident_file</span><span class='Delimiter'>; 
</span><a name="LN153"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>conf_file</span><span class='Delimiter'>; 
</span><a name="LN154"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>conversion_file</span><span class='Delimiter'>; 
</span><a name="LN155"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>dictionary_file</span><span class='Delimiter'>; 
</span><a name="LN156"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>info_schema_file</span><span class='Delimiter'>; 
</span><a name="LN157"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>features_file</span><span class='Delimiter'>; 
</span><a name="LN158"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>system_views_file</span><span class='Delimiter'>; 
</span><a name="LN159"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>made_new_pgdata</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN160"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>found_existing_pgdata</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN161"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>made_new_xlogdir</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN162"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>found_existing_xlogdir</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN163"></a><span class='Keyword'>static char </span><span class='Declare_Var'>infoversion</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span><a name="LN164"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>caught_signal</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN165"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>output_failed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN166"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>output_errno</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN167"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>pgdata_native</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* defaults */ 
</span><a name="LN170"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>n_connections</span> <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span><a name="LN171"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>n_buffers</span> <span class='Operator'>= </span><span class='Number'>50</span><span class='Delimiter'>; 
</span><a name="LN172"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>dynamic_shared_memory_type</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Warning messages for authentication methods 
 */ 
</span><a name="LN177"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AUTHTRUST_WARNING</span> <span class='Operator'>\ 
</span><span class='String'>"# CAUTION: Configuring the system for local \"trust\" authentication\n"</span> <span class='Operator'>\ 
</span><span class='String'>"# allows any local user to connect as any PostgreSQL user, including\n"</span> <span class='Operator'>\ 
</span><span class='String'>"# the database superuser.  If you do not trust all your local users,\n"</span> <span class='Operator'>\ 
</span><span class='String'>"# use another authentication method.\n"</span> 
<a name="LN182"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>authwarning</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Centralized knowledge of switches to pass to backend 
 * 
 * Note: we run the backend with -F (fsync disabled) and then do a single 
 * pass of fsync'ing at the end.  This is faster than fsync'ing each step. 
 * 
 * Note: in the shell-script version, we also passed PGDATA as a -D switch, 
 * but here it is more convenient to pass it as an environment variable 
 * (no quoting to worry about). 
 */ 
</span><a name="LN194"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>boot_options</span> <span class='Operator'>= </span><span class='String'>"-F"</span><span class='Delimiter'>; 
</span><a name="LN195"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>backend_options</span> <span class='Operator'>= </span><span class='String'>"--single -F -O -j -c search_path=pg_catalog -c exit_on_error=true"</span><span class='Delimiter'>; 
</span> 
<a name="LN197"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>subdirs</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='String'>"global"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_wal/archive_status"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_commit_ts"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_dynshmem"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_notify"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_serial"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_snapshots"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_subtrans"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_twophase"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_multixact"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_multixact/members"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_multixact/offsets"</span><span class='Delimiter'>, 
</span>    <span class='String'>"base"</span><span class='Delimiter'>, 
</span>    <span class='String'>"base/1"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_replslot"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_tblspc"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_stat"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_stat_tmp"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_xact"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_logical"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_logical/snapshots"</span><span class='Delimiter'>, 
</span>    <span class='String'>"pg_logical/mappings"</span> 
<span class='Delimiter'>}; 
</span> 
 
<span class='Comment_Multi_Line'>/* path to 'initdb' binary directory */ 
</span><a name="LN224"></a><span class='Keyword'>static char </span><span class='Declare_Var'>bin_path</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN225"></a><span class='Keyword'>static char </span><span class='Declare_Var'>backend_exec</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
<a name="LN227"></a><span class='Keyword'>static char </span><span class='Operator'>**</span><span class='Declare_Prototype'>replace_token</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>lines</span><span class='Delimiter'>, 
</span><a name="LN228"></a>              <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>replacement</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifndef</span> HAVE_UNIX_SOCKETS 
<a name="LN231"></a><span class='Keyword'>static char </span><span class='Operator'>**</span><span class='Declare_Prototype'>filter_lines_with_token</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>lines</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN233"></a><span class='Keyword'>static char </span><span class='Operator'>**</span><span class='Declare_Prototype'>readfile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN234"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>writefile</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>lines</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN235"></a><span class='Keyword'>static </span>FILE <span class='Operator'>*</span><span class='Declare_Prototype'>popen_check</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>command</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>mode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN236"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exit_nicely</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN237"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>get_id</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN238"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>get_encoding_id</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>encoding_name</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN239"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_input</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN240"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>check_input</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN241"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>write_version_file</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extrapath</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN242"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_null_conf</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN243"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>test_config_settings</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN244"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setup_config</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN245"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>bootstrap_template1</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN246"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setup_auth</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN247"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_su_pwd</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN248"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setup_depend</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN249"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setup_sysviews</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN250"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setup_description</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN251"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setup_collation</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN252"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setup_conversion</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN253"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setup_dictionary</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN254"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setup_privileges</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN255"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_info_version</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN256"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setup_schema</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN257"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>load_plpgsql</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN258"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>vacuum_db</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN259"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>make_template0</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN260"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>make_postgres</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN261"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>trapsig</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>signum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN262"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>check_ok</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN263"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>escape_quotes</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN264"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>locale_date_order</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>locale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN265"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>check_locale_name</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>category</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>locale</span><span class='Delimiter'>, 
</span><a name="LN266"></a>                  <span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>canonname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN267"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>check_locale_encoding</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>locale</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>encoding</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN268"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setlocales</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN269"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>usage</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>progname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN270"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>setup_pgdata</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN271"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>setup_bin_paths</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>argv0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN272"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>setup_data_file_paths</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN273"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>setup_locale_encoding</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN274"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>setup_signals</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN275"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>setup_text_search</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN276"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>create_data_directory</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN277"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>create_xlog_or_symlink</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN278"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>warn_on_mount_point</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>error</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN279"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>initialize_data_directory</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * macros for running pipes to postgres 
 */ 
</span><a name="LN284"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_CMD_DECL</span>     <span class='Keyword'>char </span>cmd<span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; </span>FILE <span class='Operator'>*</span>cmdfd 
 
<a name="LN286"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_CMD_OPEN</span> <span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    cmdfd <span class='Operator'>= </span><a href="initdb.c.html#LN235"><span class='Ref_to_Proto'>popen_check</span></a><span class='Parentheses'>(</span>cmd<span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>cmdfd <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; </span><span class='Comment_Multi_Line'>/* message already printed by popen_check */ </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN293"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_CMD_CLOSE</span> <span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN214"><span class='Ref_to_Proto'>pclose_check</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>))</span> <span class='Operator'>\ 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; </span><span class='Comment_Multi_Line'>/* message already printed by pclose_check */ </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN299"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_CMD_PUTS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>line</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN299"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>, </span>cmdfd<span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span>fflush<span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <a href="initdb.c.html#LN165"><span class='Ref_to_Global_Var'>output_failed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN166"><span class='Ref_to_Global_Var'>output_errno</span></a> <span class='Operator'>= </span>errno<span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN305"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_CMD_PRINTF1</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>arg1</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>cmdfd<span class='Delimiter'>, </span><a href="initdb.c.html#LN305"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN305"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span>fflush<span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <a href="initdb.c.html#LN165"><span class='Ref_to_Global_Var'>output_failed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN166"><span class='Ref_to_Global_Var'>output_errno</span></a> <span class='Operator'>= </span>errno<span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN311"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_CMD_PRINTF2</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>arg2</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>cmdfd<span class='Delimiter'>, </span><a href="initdb.c.html#LN311"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN311"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN311"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span>fflush<span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <a href="initdb.c.html#LN165"><span class='Ref_to_Global_Var'>output_failed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN166"><span class='Ref_to_Global_Var'>output_errno</span></a> <span class='Operator'>= </span>errno<span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN317"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_CMD_PRINTF3</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>arg2</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>arg3</span><span class='Parentheses'>)</span>       <span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>cmdfd<span class='Delimiter'>, </span><a href="initdb.c.html#LN317"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN317"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN317"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN317"><span class='Ref_to_Parameter'>arg3</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span>fflush<span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <a href="initdb.c.html#LN165"><span class='Ref_to_Global_Var'>output_failed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN166"><span class='Ref_to_Global_Var'>output_errno</span></a> <span class='Operator'>= </span>errno<span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN324"></a><span class='Declare_Function'>escape_quotes</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN326"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../port/quotes.c.html#LN31"><span class='Ref_to_Func'>escape_single_quotes_ascii</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN324"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="initdb.c.html#LN326"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: out of memory\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="initdb.c.html#LN326"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * make a copy of the array of lines, with token replaced by replacement 
 * the first time it occurs on each line. 
 * 
 * This does most of what sed was used for in the shell script, but 
 * doesn't need any regexp stuff. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>** 
</span><a name="LN344"></a><span class='Declare_Function'>replace_token</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>lines</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>replacement</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN346"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numlines</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN347"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN348"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN349"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>toklen</span><span class='Delimiter'>, 
</span><a name="LN350"></a>                <span class='Declare_Local'>replen</span><span class='Delimiter'>, 
</span><a name="LN351"></a>                <span class='Declare_Local'>diff</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; </span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN346"><span class='Ref_To_Local'>numlines</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN348"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN346"><span class='Ref_To_Local'>numlines</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN349"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN350"><span class='Ref_To_Local'>replen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>replacement</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN351"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN350"><span class='Ref_To_Local'>replen</span></a> <span class='Operator'>- </span><a href="initdb.c.html#LN349"><span class='Ref_To_Local'>toklen</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="initdb.c.html#LN346"><span class='Ref_To_Local'>numlines</span></a><span class='Delimiter'>; </span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN364"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>where</span><span class='Delimiter'>; 
</span><a name="LN365"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>newline</span><span class='Delimiter'>; 
</span><a name="LN366"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>pre</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* just copy pointer if NULL or no change needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="initdb.c.html#LN364"><span class='Ref_To_Local'>where</span></a> <span class='Operator'>= </span>strstr<span class='Parentheses'>(</span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="initdb.c.html#LN348"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* if we get here a change is needed - set up new line */ 
</span> 
        <a href="initdb.c.html#LN365"><span class='Ref_To_Local'>newline</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="initdb.c.html#LN351"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="initdb.c.html#LN366"><span class='Ref_To_Local'>pre</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN364"><span class='Ref_To_Local'>where</span></a> <span class='Operator'>- </span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="initdb.c.html#LN365"><span class='Ref_To_Local'>newline</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="initdb.c.html#LN366"><span class='Ref_To_Local'>pre</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="initdb.c.html#LN365"><span class='Ref_To_Local'>newline</span></a> <span class='Operator'>+ </span><a href="initdb.c.html#LN366"><span class='Ref_To_Local'>pre</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>replacement</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN350"><span class='Ref_To_Local'>replen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN365"><span class='Ref_To_Local'>newline</span></a> <span class='Operator'>+ </span><a href="initdb.c.html#LN366"><span class='Ref_To_Local'>pre</span></a> <span class='Operator'>+ </span><a href="initdb.c.html#LN350"><span class='Ref_To_Local'>replen</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN344"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="initdb.c.html#LN366"><span class='Ref_To_Local'>pre</span></a> <span class='Operator'>+ </span><a href="initdb.c.html#LN349"><span class='Ref_To_Local'>toklen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="initdb.c.html#LN348"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="initdb.c.html#LN365"><span class='Ref_To_Local'>newline</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numlines;i++ &raquo; </span> 
 
    <span class='Control'>return</span> <a href="initdb.c.html#LN348"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end replace_token &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make a copy of lines without any that contain the token 
 * 
 * a sort of poor man's grep -v 
 */ 
</span><span class='Directive'>#ifndef</span> HAVE_UNIX_SOCKETS 
<span class='Keyword'>static char </span><span class='Operator'>** 
</span><a name="LN400"></a><span class='Declare_Function'>filter_lines_with_token</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>lines</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN402"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numlines</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN403"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN404"></a>                <span class='Declare_Local'>src</span><span class='Delimiter'>, 
</span><a name="LN405"></a>                <span class='Declare_Local'>dst</span><span class='Delimiter'>; 
</span><a name="LN406"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN403"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN400"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN403"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; </span><a href="initdb.c.html#LN403"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN402"><span class='Ref_To_Local'>numlines</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN406"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN402"><span class='Ref_To_Local'>numlines</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN404"><span class='Ref_To_Local'>src</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN405"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN404"><span class='Ref_To_Local'>src</span></a> <span class='Operator'>&LT; </span><a href="initdb.c.html#LN402"><span class='Ref_To_Local'>numlines</span></a><span class='Delimiter'>; </span><a href="initdb.c.html#LN404"><span class='Ref_To_Local'>src</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN400"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN404"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strstr<span class='Parentheses'>(</span><a href="initdb.c.html#LN400"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN404"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>], </span><a href="initdb.c.html#LN400"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <a href="initdb.c.html#LN406"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN405"><span class='Ref_To_Local'>dst</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="initdb.c.html#LN400"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN404"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="initdb.c.html#LN406"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end filter_lines_with_token &raquo; </span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * get the lines from a text file 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>** 
</span><a name="LN427"></a><span class='Declare_Function'>readfile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN429"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>infile</span><span class='Delimiter'>; 
</span><a name="LN430"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxlength</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>, 
</span><a name="LN431"></a>                <span class='Declare_Local'>linelen</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN432"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nlines</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN433"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span><a name="LN434"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN435"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN436"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN429"><span class='Ref_To_Local'>infile</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN427"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for reading: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN427"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* pass over the file twice - the first time to size the result */ 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN436"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span>fgetc<span class='Parentheses'>(</span><a href="initdb.c.html#LN429"><span class='Ref_To_Local'>infile</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span>EOF<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN431"><span class='Ref_To_Local'>linelen</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN436"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="initdb.c.html#LN432"><span class='Ref_To_Local'>nlines</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN431"><span class='Ref_To_Local'>linelen</span></a> <span class='Operator'>&GT; </span><a href="initdb.c.html#LN430"><span class='Ref_To_Local'>maxlength</span></a><span class='Parentheses'>) 
</span>                <a href="initdb.c.html#LN430"><span class='Ref_To_Local'>maxlength</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN431"><span class='Ref_To_Local'>linelen</span></a><span class='Delimiter'>; 
</span>            <a href="initdb.c.html#LN431"><span class='Ref_To_Local'>linelen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* handle last line without a terminating newline (yuck) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN431"><span class='Ref_To_Local'>linelen</span></a><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN432"><span class='Ref_To_Local'>nlines</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN431"><span class='Ref_To_Local'>linelen</span></a> <span class='Operator'>&GT; </span><a href="initdb.c.html#LN430"><span class='Ref_To_Local'>maxlength</span></a><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN430"><span class='Ref_To_Local'>maxlength</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN431"><span class='Ref_To_Local'>linelen</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up the result and the line buffer */ 
</span>    <a href="initdb.c.html#LN434"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>((</span><a href="initdb.c.html#LN432"><span class='Ref_To_Local'>nlines</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN435"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN430"><span class='Ref_To_Local'>maxlength</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* now reprocess the file and store the lines */ 
</span>    rewind<span class='Parentheses'>(</span><a href="initdb.c.html#LN429"><span class='Ref_To_Local'>infile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN433"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span>fgets<span class='Parentheses'>(</span><a href="initdb.c.html#LN435"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN430"><span class='Ref_To_Local'>maxlength</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN429"><span class='Ref_To_Local'>infile</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="initdb.c.html#LN433"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&LT; </span><a href="initdb.c.html#LN432"><span class='Ref_To_Local'>nlines</span></a><span class='Parentheses'>)</span> 
        <a href="initdb.c.html#LN434"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN433"><span class='Ref_To_Local'>n</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN435"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    fclose<span class='Parentheses'>(</span><a href="initdb.c.html#LN429"><span class='Ref_To_Local'>infile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN435"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN434"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN433"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="initdb.c.html#LN434"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end readfile &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * write an array of lines to a file 
 * 
 * This is only used to write text files.  Use fopen "w" not PG_BINARY_W 
 * so that the resulting configuration files are nicely editable on Windows. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN489"></a><span class='Declare_Function'>writefile</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>lines</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN491"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>out_file</span><span class='Delimiter'>; 
</span><a name="LN492"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN491"><span class='Ref_To_Local'>out_file</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN489"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for writing: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN489"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN492"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN489"><span class='Ref_to_Parameter'>lines</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN492"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN492"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN492"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN491"><span class='Ref_To_Local'>out_file</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not write file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN489"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN492"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="initdb.c.html#LN491"><span class='Ref_To_Local'>out_file</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not write file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN489"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end writefile &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Open a subcommand with suitable error messaging 
 */ 
</span><span class='Keyword'>static </span>FILE <span class='Operator'>* 
</span><a name="LN522"></a><span class='Declare_Function'>popen_check</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>command</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN524"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>cmdfd</span><span class='Delimiter'>; 
</span> 
    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN524"><span class='Ref_To_Local'>cmdfd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN313"><span class='Ref_to_Macro'>popen</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN522"><span class='Ref_to_Parameter'>command</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN522"><span class='Ref_to_Parameter'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN524"><span class='Ref_To_Local'>cmdfd</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not execute command \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN522"><span class='Ref_to_Parameter'>command</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="initdb.c.html#LN524"><span class='Ref_To_Local'>cmdfd</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * clean up any files we created on failure 
 * if we created the data directory remove it too 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN541"></a><span class='Declare_Function'>exit_nicely</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../pg_basebackup/pg_basebackup.c.html#LN81"><span class='Ref_to_Global_Var'>noclean</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN96"><span class='Ref_to_Global_Var'>made_new_pgdata</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: removing data directory \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../common/rmtree.c.html#LN34"><span class='Ref_to_Func'>rmtree</span></a><span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: failed to remove data directory\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN97"><span class='Ref_to_Global_Var'>found_existing_pgdata</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"%s: removing contents of data directory \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../common/rmtree.c.html#LN34"><span class='Ref_to_Func'>rmtree</span></a><span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: failed to remove contents of data directory\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN98"><span class='Ref_to_Global_Var'>made_new_xlogdir</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: removing WAL directory \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../common/rmtree.c.html#LN34"><span class='Ref_to_Func'>rmtree</span></a><span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: failed to remove WAL directory\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN99"><span class='Ref_to_Global_Var'>found_existing_xlogdir</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"%s: removing contents of WAL directory \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../common/rmtree.c.html#LN34"><span class='Ref_to_Func'>rmtree</span></a><span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: failed to remove contents of WAL directory\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* otherwise died during startup, do nothing! */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !noclean &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN96"><span class='Ref_to_Global_Var'>made_new_pgdata</span></a> <span class='Operator'>|| </span><a href="../pg_basebackup/pg_basebackup.c.html#LN97"><span class='Ref_to_Global_Var'>found_existing_pgdata</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>              _<span class='Parentheses'>(</span><span class='String'>"%s: data directory \"%s\" not removed at user's request\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN98"><span class='Ref_to_Global_Var'>made_new_xlogdir</span></a> <span class='Operator'>|| </span><a href="../pg_basebackup/pg_basebackup.c.html#LN99"><span class='Ref_to_Global_Var'>found_existing_xlogdir</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>               _<span class='Parentheses'>(</span><span class='String'>"%s: WAL directory \"%s\" not removed at user's request\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exit_nicely &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * find the current user 
 * 
 * on unix make sure it isn't root 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN604"></a><span class='Declare_Function'>get_id</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN606"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>username</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>geteuid<span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>         <span class='Comment_Single_Line'>/* 0 is root's uid */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: cannot be run as root\n"</span> 
                  <span class='String'>"Please log in (using, e.g., \"su\") as the "</span> 
                  <span class='String'>"(unprivileged) user that will\n"</span> 
                  <span class='String'>"own the server process.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <a href="initdb.c.html#LN606"><span class='Ref_To_Local'>username</span></a> <span class='Operator'>= </span><a href="../../include/common/username.h.html#LN12"><span class='Ref_to_Proto'>get_user_name_or_exit</span></a><span class='Parentheses'>(</span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN606"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_id &raquo; </span> 
 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN627"></a><span class='Declare_Function'>encodingid_to_string</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>enc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN629"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>[</span><span class='Number'>20</span><span class='Delimiter'>]; 
</span> 
    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN629"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN627"><span class='Ref_to_Parameter'>enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN629"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * get the encoding id for a given encoding name 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN639"></a><span class='Declare_Function'>get_encoding_id</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>encoding_name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN641"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>enc</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN639"><span class='Ref_to_Parameter'>encoding_name</span></a> <span class='Operator'>&& *</span><a href="initdb.c.html#LN639"><span class='Ref_to_Parameter'>encoding_name</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN641"><span class='Ref_To_Local'>enc</span></a> <span class='Operator'>= </span><a href="../../backend/utils/mb/encnames.c.html#LN499"><span class='Ref_to_Func'>pg_valid_server_encoding</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN639"><span class='Ref_to_Parameter'>encoding_name</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="initdb.c.html#LN626"><span class='Ref_to_Func'>encodingid_to_string</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN641"><span class='Ref_To_Local'>enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: \"%s\" is not a valid server encoding name\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN639"><span class='Ref_to_Parameter'>encoding_name</span></a> <span class='Operator'>? </span><a href="initdb.c.html#LN639"><span class='Ref_to_Parameter'>encoding_name</span></a> <span class='Operator'>: </span><span class='String'>"(null)"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Support for determining the best default text search configuration. 
 * We key this off the first part of LC_CTYPE (ie, the language name). 
 */ 
</span><a name="LN657"></a><span class='Control'>struct</span> <span class='Declare_Struct'>tsearch_config_match</span> 
<span class='Delimiter'>{ 
</span><a name="LN659"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>tsconfname</span><span class='Delimiter'>; 
</span><a name="LN660"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>langname</span><span class='Delimiter'>; 
}; 
</span> 
<a name="LN663"></a><span class='Keyword'>static const </span><span class='Control'>struct</span> <a href="initdb.c.html#LN657"><span class='Ref_to_Struct'>tsearch_config_match</span></a> <span class='Declare_Var'>tsearch_config_languages</span><span class='Delimiter'>[] </span><span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <span class='Delimiter'>{</span><span class='String'>"danish"</span><span class='Delimiter'>, </span><span class='String'>"da"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"danish"</span><span class='Delimiter'>, </span><span class='String'>"Danish"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"dutch"</span><span class='Delimiter'>, </span><span class='String'>"nl"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"dutch"</span><span class='Delimiter'>, </span><span class='String'>"Dutch"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"english"</span><span class='Delimiter'>, </span><span class='String'>"C"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"english"</span><span class='Delimiter'>, </span><span class='String'>"POSIX"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"english"</span><span class='Delimiter'>, </span><span class='String'>"en"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"english"</span><span class='Delimiter'>, </span><span class='String'>"English"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"finnish"</span><span class='Delimiter'>, </span><span class='String'>"fi"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"finnish"</span><span class='Delimiter'>, </span><span class='String'>"Finnish"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"french"</span><span class='Delimiter'>, </span><span class='String'>"fr"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"french"</span><span class='Delimiter'>, </span><span class='String'>"French"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"german"</span><span class='Delimiter'>, </span><span class='String'>"de"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"german"</span><span class='Delimiter'>, </span><span class='String'>"German"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"hungarian"</span><span class='Delimiter'>, </span><span class='String'>"hu"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"hungarian"</span><span class='Delimiter'>, </span><span class='String'>"Hungarian"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"italian"</span><span class='Delimiter'>, </span><span class='String'>"it"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"italian"</span><span class='Delimiter'>, </span><span class='String'>"Italian"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"norwegian"</span><span class='Delimiter'>, </span><span class='String'>"no"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"norwegian"</span><span class='Delimiter'>, </span><span class='String'>"Norwegian"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"portuguese"</span><span class='Delimiter'>, </span><span class='String'>"pt"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"portuguese"</span><span class='Delimiter'>, </span><span class='String'>"Portuguese"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"romanian"</span><span class='Delimiter'>, </span><span class='String'>"ro"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"russian"</span><span class='Delimiter'>, </span><span class='String'>"ru"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"russian"</span><span class='Delimiter'>, </span><span class='String'>"Russian"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"spanish"</span><span class='Delimiter'>, </span><span class='String'>"es"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"spanish"</span><span class='Delimiter'>, </span><span class='String'>"Spanish"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"swedish"</span><span class='Delimiter'>, </span><span class='String'>"sv"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"swedish"</span><span class='Delimiter'>, </span><span class='String'>"Swedish"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"turkish"</span><span class='Delimiter'>, </span><span class='String'>"tr"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"turkish"</span><span class='Delimiter'>, </span><span class='String'>"Turkish"</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>}</span>                <span class='Comment_Single_Line'>/* end marker */ 
</span><span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Look for a text search configuration matching lc_ctype, and return its 
 * name; return NULL if no match. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN704"></a><span class='Declare_Function'>find_matching_ts_config</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>lc_type</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN706"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN707"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>langname</span><span class='Delimiter'>, 
</span><a name="LN708"></a>               <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert lc_ctype to a language name by stripping everything after an 
     * underscore (usual case) or a hyphen (Windows "locale name"; see 
     * comments at IsoLocaleName()). 
     * 
     * XXX Should ' ' be a stop character?  This would select "norwegian" for 
     * the Windows locale "Norwegian (Nynorsk)_Norway.1252".  If we do so, we 
     * should also accept the "nn" and "nb" Unix locales. 
     * 
     * Just for paranoia, we also stop at '.' or '@'. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN704"><span class='Ref_to_Parameter'>lc_type</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN707"><span class='Ref_To_Local'>langname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN708"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN707"><span class='Ref_To_Local'>langname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN704"><span class='Ref_to_Parameter'>lc_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN708"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&& 
</span>               <span class='Operator'>*</span><a href="initdb.c.html#LN708"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>!= </span><span class='String'>'_'</span> <span class='Operator'>&& *</span><a href="initdb.c.html#LN708"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>!= </span><span class='String'>'-'</span> <span class='Operator'>&& *</span><a href="initdb.c.html#LN708"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>!= </span><span class='String'>'.'</span> <span class='Operator'>&& *</span><a href="initdb.c.html#LN708"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>!= </span><span class='String'>'@'</span><span class='Parentheses'>) 
</span>            <a href="initdb.c.html#LN708"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="initdb.c.html#LN708"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN706"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN663"><span class='Ref_to_Global_Var'>tsearch_config_languages</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN706"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="initdb.c.html#LN659"><span class='Ref_to_Member'>tsconfname</span></a><span class='Delimiter'>; </span><a href="initdb.c.html#LN706"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN663"><span class='Ref_to_Global_Var'>tsearch_config_languages</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN706"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="initdb.c.html#LN660"><span class='Ref_to_Member'>langname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN707"><span class='Ref_To_Local'>langname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN707"><span class='Ref_To_Local'>langname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="initdb.c.html#LN663"><span class='Ref_to_Global_Var'>tsearch_config_languages</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN706"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="initdb.c.html#LN659"><span class='Ref_to_Member'>tsconfname</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN707"><span class='Ref_To_Local'>langname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_matching_ts_config &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * set name of given input file variable under data directory 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN750"></a><span class='Declare_Function'>set_input</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Operator'>*</span><a href="initdb.c.html#LN750"><span class='Ref_to_Parameter'>dest</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s/%s"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN117"><span class='Ref_to_Global_Var'>share_path</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN750"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * check that given input file exists 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN759"></a><span class='Declare_Function'>check_input</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN761"></a>    <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>statbuf</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN759"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN761"><span class='Ref_To_Local'>statbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"%s: file \"%s\" does not exist\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN759"><span class='Ref_to_Parameter'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"This might mean you have a corrupted installation or identified\n"</span> 
                    <span class='String'>"the wrong directory with the invocation option -L.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                 _<span class='Parentheses'>(</span><span class='String'>"%s: could not access file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN759"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, 
</span>                    <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"This might mean you have a corrupted installation or identified\n"</span> 
                    <span class='String'>"the wrong directory with the invocation option -L.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stat(path,&statbuf)!=... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port/win32.h.html#LN430"><span class='Ref_to_Macro'>S_ISREG</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN761"><span class='Ref_To_Local'>statbuf</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: file \"%s\" is not a regular file\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN759"><span class='Ref_to_Parameter'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>        _<span class='Parentheses'>(</span><span class='String'>"This might mean you have a corrupted installation or identified\n"</span> 
          <span class='String'>"the wrong directory with the invocation option -L.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end check_input &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * write out the PG_VERSION file in the data dir, or its subdirectory 
 * if extrapath is not NULL 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN800"></a><span class='Declare_Function'>write_version_file</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extrapath</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN802"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>version_file</span><span class='Delimiter'>; 
</span><a name="LN803"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN800"><span class='Ref_to_Parameter'>extrapath</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN803"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s/PG_VERSION"</span><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="initdb.c.html#LN803"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s/%s/PG_VERSION"</span><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN800"><span class='Ref_to_Parameter'>extrapath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN802"><span class='Ref_To_Local'>version_file</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN803"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for writing: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN803"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN802"><span class='Ref_To_Local'>version_file</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span>PG_MAJORVERSION<span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        fclose<span class='Parentheses'>(</span><a href="initdb.c.html#LN802"><span class='Ref_To_Local'>version_file</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not write file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN803"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN803"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end write_version_file &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set up an empty config file so we can check config settings by launching 
 * a test backend 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN831"></a><span class='Declare_Function'>set_null_conf</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN833"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>conf_file</span><span class='Delimiter'>; 
</span><a name="LN834"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN834"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s/postgresql.conf"</span><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN833"><span class='Ref_To_Local'>conf_file</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN834"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN833"><span class='Ref_To_Local'>conf_file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for writing: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN834"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="initdb.c.html#LN833"><span class='Ref_To_Local'>conf_file</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not write file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN834"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN834"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_null_conf &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Determine which dynamic shared memory implementation should be used on 
 * this platform.  POSIX shared memory is preferable because the default 
 * allocation limits are much higher than the limits for System V on most 
 * systems that support both, but the fact that a platform has shm_open 
 * doesn't guarantee that that call will succeed when attempted.  So, we 
 * attempt to reproduce what the postmaster will do when allocating a POSIX 
 * segment in dsm_impl.c; if it doesn't work, we assume it won't work for 
 * the postmaster either, and configure the cluster for System V shared 
 * memory instead. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN865"></a><span class='Declare_Function'>choose_dsm_implementation</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> HAVE_SHM_OPEN 
<a name="LN868"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ntries</span> <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN868"><span class='Ref_To_Local'>ntries</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN872"></a>        <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>handle</span><span class='Delimiter'>; 
</span><a name="LN873"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>name</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span><a name="LN874"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>fd</span><span class='Delimiter'>; 
</span> 
        <a href="initdb.c.html#LN872"><span class='Ref_To_Local'>handle</span></a> <span class='Operator'>= </span><a href="../../port/random.c.html#LN20"><span class='Ref_to_Func'>random</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN873"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, </span><span class='String'>"/PostgreSQL.%u"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN872"><span class='Ref_To_Local'>handle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN874"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span>shm_open<span class='Parentheses'>(</span><a href="initdb.c.html#LN873"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span>O_CREAT <span class='Operator'>| </span>O_RDWR <span class='Operator'>| </span>O_EXCL<span class='Delimiter'>, </span><span class='Number'>0600</span><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN874"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            shm_unlink<span class='Parentheses'>(</span><a href="initdb.c.html#LN873"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='String'>"posix"</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>!= </span>EEXIST<span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Operator'>--</span><a href="initdb.c.html#LN868"><span class='Ref_To_Local'>ntries</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Control'>return</span> <span class='String'>"windows"</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Control'>return</span> <span class='String'>"sysv"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end choose_dsm_implementation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Determine platform-specific config settings 
 * 
 * Use reasonable values if kernel will let us, else scale back.  Probe 
 * for max_connections first since it is subject to more constraints than 
 * shared_buffers. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN905"></a><span class='Declare_Function'>test_config_settings</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * This macro defines the minimum shared_buffers we want for a given 
     * max_connections value. The arrays show the settings to try. 
     */ 
</span><a name="LN911"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>MIN_BUFS_FOR_CONNS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>nconns</span><span class='Parentheses'>)</span>  <span class='Parentheses'>((</span><a href="initdb.c.html#LN911"><span class='Ref_to_Parameter'>nconns</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>10</span><span class='Parentheses'>)</span> 
 
<a name="LN913"></a>    <span class='Keyword'>static const int </span><span class='Declare_Local'>trial_conns</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Number'>100</span><span class='Delimiter'>, </span><span class='Number'>50</span><span class='Delimiter'>, </span><span class='Number'>40</span><span class='Delimiter'>, </span><span class='Number'>30</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Delimiter'>, </span><span class='Number'>10</span> 
    <span class='Delimiter'>}; 
</span><a name="LN916"></a>    <span class='Keyword'>static const int </span><span class='Declare_Local'>trial_bufs</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Number'>16384</span><span class='Delimiter'>, </span><span class='Number'>8192</span><span class='Delimiter'>, </span><span class='Number'>4096</span><span class='Delimiter'>, </span><span class='Number'>3584</span><span class='Delimiter'>, </span><span class='Number'>3072</span><span class='Delimiter'>, </span><span class='Number'>2560</span><span class='Delimiter'>, </span><span class='Number'>2048</span><span class='Delimiter'>, </span><span class='Number'>1536</span><span class='Delimiter'>, 
</span>        <span class='Number'>1000</span><span class='Delimiter'>, </span><span class='Number'>900</span><span class='Delimiter'>, </span><span class='Number'>800</span><span class='Delimiter'>, </span><span class='Number'>700</span><span class='Delimiter'>, </span><span class='Number'>600</span><span class='Delimiter'>, </span><span class='Number'>500</span><span class='Delimiter'>, 
</span>        <span class='Number'>400</span><span class='Delimiter'>, </span><span class='Number'>300</span><span class='Delimiter'>, </span><span class='Number'>200</span><span class='Delimiter'>, </span><span class='Number'>100</span><span class='Delimiter'>, </span><span class='Number'>50</span> 
    <span class='Delimiter'>}; 
</span> 
<a name="LN922"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>cmd</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN923"></a>    <span class='Keyword'>const int</span>   <span class='Declare_Local'>connslen</span> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN913"><span class='Ref_To_Local'>trial_conns</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN924"></a>    <span class='Keyword'>const int</span>   <span class='Declare_Local'>bufslen</span> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN916"><span class='Ref_To_Local'>trial_bufs</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN925"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN926"></a>                <span class='Declare_Local'>status</span><span class='Delimiter'>, 
</span><a name="LN927"></a>                <span class='Declare_Local'>test_conns</span><span class='Delimiter'>, 
</span><a name="LN928"></a>                <span class='Declare_Local'>test_buffs</span><span class='Delimiter'>, 
</span><a name="LN929"></a>                <span class='Declare_Local'>ok_buffers</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"selecting default max_connections ... "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="initdb.c.html#LN923"><span class='Ref_To_Local'>connslen</span></a><span class='Delimiter'>; </span><a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN927"><span class='Ref_To_Local'>test_conns</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN913"><span class='Ref_To_Local'>trial_conns</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="initdb.c.html#LN928"><span class='Ref_To_Local'>test_buffs</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN911"><span class='Ref_to_Macro'>MIN_BUFS_FOR_CONNS</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN927"><span class='Ref_To_Local'>test_conns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN922"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN922"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"\"%s\" --boot -x0 %s "</span> 
                 <span class='String'>"-c max_connections=%d "</span> 
                 <span class='String'>"-c shared_buffers=%d "</span> 
                 <span class='String'>"-c dynamic_shared_memory_type=none "</span> 
                 <span class='String'>"&LT; \"%s\" &GT; \"%s\" 2&GT;&1"</span><span class='Delimiter'>, 
</span>                 <a href="initdb.c.html#LN225"><span class='Ref_to_Global_Var'>backend_exec</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN194"><span class='Ref_to_Global_Var'>boot_options</span></a><span class='Delimiter'>, 
</span>                 <a href="initdb.c.html#LN927"><span class='Ref_To_Local'>test_conns</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN928"><span class='Ref_To_Local'>test_buffs</span></a><span class='Delimiter'>, 
</span>                 <a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Delimiter'>, </span><a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN926"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN922"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN926"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="initdb.c.html#LN929"><span class='Ref_To_Local'>ok_buffers</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN928"><span class='Ref_To_Local'>test_buffs</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;connslen;i++ &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="initdb.c.html#LN923"><span class='Ref_To_Local'>connslen</span></a><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN923"><span class='Ref_To_Local'>connslen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN170"><span class='Ref_to_Global_Var'>n_connections</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN913"><span class='Ref_To_Local'>trial_conns</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%d\n"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN170"><span class='Ref_to_Global_Var'>n_connections</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"selecting default shared_buffers ... "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="initdb.c.html#LN924"><span class='Ref_To_Local'>bufslen</span></a><span class='Delimiter'>; </span><a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use same amount of memory, independent of BLCKSZ */ 
</span>        <a href="initdb.c.html#LN928"><span class='Ref_To_Local'>test_buffs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="initdb.c.html#LN916"><span class='Ref_To_Local'>trial_bufs</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN925"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>* </span><span class='Number'>8192</span><span class='Parentheses'>) </span><span class='Operator'>/ </span>BLCKSZ<span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN928"><span class='Ref_To_Local'>test_buffs</span></a> <span class='Operator'>&LT;= </span><a href="initdb.c.html#LN929"><span class='Ref_To_Local'>ok_buffers</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="initdb.c.html#LN928"><span class='Ref_To_Local'>test_buffs</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN929"><span class='Ref_To_Local'>ok_buffers</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN922"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN922"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"\"%s\" --boot -x0 %s "</span> 
                 <span class='String'>"-c max_connections=%d "</span> 
                 <span class='String'>"-c shared_buffers=%d "</span> 
                 <span class='String'>"-c dynamic_shared_memory_type=none "</span> 
                 <span class='String'>"&LT; \"%s\" &GT; \"%s\" 2&GT;&1"</span><span class='Delimiter'>, 
</span>                 <a href="initdb.c.html#LN225"><span class='Ref_to_Global_Var'>backend_exec</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN194"><span class='Ref_to_Global_Var'>boot_options</span></a><span class='Delimiter'>, 
</span>                 <a href="initdb.c.html#LN170"><span class='Ref_to_Global_Var'>n_connections</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN928"><span class='Ref_To_Local'>test_buffs</span></a><span class='Delimiter'>, 
</span>                 <a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Delimiter'>, </span><a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN926"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN922"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN926"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;bufslen;i++ &raquo; </span> 
    <a href="initdb.c.html#LN171"><span class='Ref_to_Global_Var'>n_buffers</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN928"><span class='Ref_To_Local'>test_buffs</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN171"><span class='Ref_to_Global_Var'>n_buffers</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>))</span> <span class='Operator'>% </span><span class='Number'>1024</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%dMB\n"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="initdb.c.html#LN171"><span class='Ref_to_Global_Var'>n_buffers</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%dkB\n"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN171"><span class='Ref_to_Global_Var'>n_buffers</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"selecting dynamic shared memory implementation ... "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../backend/storage/ipc/dsm_impl.c.html#LN111"><span class='Ref_to_Global_Var'>dynamic_shared_memory_type</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN864"><span class='Ref_to_Func'>choose_dsm_implementation</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><a href="../../backend/storage/ipc/dsm_impl.c.html#LN111"><span class='Ref_to_Global_Var'>dynamic_shared_memory_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end test_config_settings &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set up all the config files 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1005"></a><span class='Declare_Function'>setup_config</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1007"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>conflines</span><span class='Delimiter'>; 
</span><a name="LN1008"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>repltok</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN1009"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>path</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN1010"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>default_timezone</span><span class='Delimiter'>; 
</span><a name="LN1011"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>autoconflines</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span> 
    <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"creating configuration files ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* postgresql.conf */ 
</span> 
    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="../pg_ctl/pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN153"><span class='Ref_to_Global_Var'>conf_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"max_connections = %d"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN170"><span class='Ref_to_Global_Var'>n_connections</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#max_connections = 100"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN171"><span class='Ref_to_Global_Var'>n_buffers</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>))</span> <span class='Operator'>% </span><span class='Number'>1024</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"shared_buffers = %dMB"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><a href="initdb.c.html#LN171"><span class='Ref_to_Global_Var'>n_buffers</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"shared_buffers = %dkB"</span><span class='Delimiter'>, 
</span>                 <a href="initdb.c.html#LN171"><span class='Ref_to_Global_Var'>n_buffers</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#shared_buffers = 32MB"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"#unix_socket_directories = '%s'"</span><span class='Delimiter'>, 
</span>             <a href="../../include/pg_config_manual.h.html#LN183"><span class='Ref_to_Const'>DEFAULT_PGSOCKET_DIR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"#unix_socket_directories = ''"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#unix_socket_directories = '/tmp'"</span><span class='Delimiter'>, 
</span>                              <a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> DEF_PGPORT <span class='Operator'>!= </span><span class='Number'>5432</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"#port = %d"</span><span class='Delimiter'>, </span>DEF_PGPORT<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#port = 5432"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"lc_messages = '%s'"</span><span class='Delimiter'>, 
</span>             <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN128"><span class='Ref_to_Global_Var'>lc_messages</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#lc_messages = 'C'"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"lc_monetary = '%s'"</span><span class='Delimiter'>, 
</span>             <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN125"><span class='Ref_to_Global_Var'>lc_monetary</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#lc_monetary = 'C'"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"lc_numeric = '%s'"</span><span class='Delimiter'>, 
</span>             <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN126"><span class='Ref_to_Global_Var'>lc_numeric</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#lc_numeric = 'C'"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"lc_time = '%s'"</span><span class='Delimiter'>, 
</span>             <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN127"><span class='Ref_to_Global_Var'>lc_time</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#lc_time = 'C'"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN264"><span class='Ref_to_Proto'>locale_date_order</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN127"><span class='Ref_to_Global_Var'>lc_time</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/miscadmin.h.html#LN218"><span class='Ref_to_Const'>DATEORDER_YMD</span></a><span class='Operator'>: 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='String'>"datestyle = 'iso, ymd'"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Operator'>: 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='String'>"datestyle = 'iso, dmy'"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/miscadmin.h.html#LN220"><span class='Ref_to_Const'>DATEORDER_MDY</span></a><span class='Operator'>: 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='String'>"datestyle = 'iso, mdy'"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#datestyle = 'iso, mdy'"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"default_text_search_config = 'pg_catalog.%s'"</span><span class='Delimiter'>, 
</span>             <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN129"><span class='Ref_to_Global_Var'>default_text_search_config</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"#default_text_search_config = 'pg_catalog.simple'"</span><span class='Delimiter'>, 
</span>                              <a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1010"><span class='Ref_To_Local'>default_timezone</span></a> <span class='Operator'>= </span><a href="findtimezone.c.html#LN21"><span class='Ref_to_Proto'>select_default_timezone</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN117"><span class='Ref_to_Global_Var'>share_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1010"><span class='Ref_To_Local'>default_timezone</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"timezone = '%s'"</span><span class='Delimiter'>, 
</span>                 <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1010"><span class='Ref_To_Local'>default_timezone</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#timezone = 'GMT'"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"log_timezone = '%s'"</span><span class='Delimiter'>, 
</span>                 <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1010"><span class='Ref_To_Local'>default_timezone</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#log_timezone = 'GMT'"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"dynamic_shared_memory_type = %s"</span><span class='Delimiter'>, 
</span>             <a href="../../backend/storage/ipc/dsm_impl.c.html#LN111"><span class='Ref_to_Global_Var'>dynamic_shared_memory_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#dynamic_shared_memory_type = posix"</span><span class='Delimiter'>, 
</span>                              <a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> <a href="../../include/pg_config_manual.h.html#LN155"><span class='Ref_to_Const'>DEFAULT_BACKEND_FLUSH_AFTER</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"#backend_flush_after = %dkB"</span><span class='Delimiter'>, 
</span>             <a href="../../include/pg_config_manual.h.html#LN155"><span class='Ref_to_Const'>DEFAULT_BACKEND_FLUSH_AFTER</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#backend_flush_after = 0"</span><span class='Delimiter'>, 
</span>                              <a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <a href="../../include/pg_config_manual.h.html#LN156"><span class='Ref_to_Const'>DEFAULT_BGWRITER_FLUSH_AFTER</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"#bgwriter_flush_after = %dkB"</span><span class='Delimiter'>, 
</span>             <a href="../../include/pg_config_manual.h.html#LN156"><span class='Ref_to_Const'>DEFAULT_BGWRITER_FLUSH_AFTER</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#bgwriter_flush_after = 0"</span><span class='Delimiter'>, 
</span>                              <a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <a href="../../include/pg_config_manual.h.html#LN157"><span class='Ref_to_Const'>DEFAULT_CHECKPOINT_FLUSH_AFTER</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"#checkpoint_flush_after = %dkB"</span><span class='Delimiter'>, 
</span>             <a href="../../include/pg_config_manual.h.html#LN157"><span class='Ref_to_Const'>DEFAULT_CHECKPOINT_FLUSH_AFTER</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>/ </span><span class='Number'>1024</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"#checkpoint_flush_after = 0"</span><span class='Delimiter'>, 
</span>                              <a href="initdb.c.html#LN1008"><span class='Ref_To_Local'>repltok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifndef</span> <a href="../../include/pg_config_manual.h.html#LN145"><span class='Ref_to_Const'>USE_PREFETCH</span></a> 
    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"#effective_io_concurrency = 1"</span><span class='Delimiter'>, 
</span>                              <span class='String'>"#effective_io_concurrency = 0"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"#update_process_title = on"</span><span class='Delimiter'>, 
</span>                              <span class='String'>"#update_process_title = off"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN135"><span class='Ref_to_Global_Var'>authmethodlocal</span></a><span class='Delimiter'>, </span><span class='String'>"scram-sha-256"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN134"><span class='Ref_to_Global_Var'>authmethodhost</span></a><span class='Delimiter'>, </span><span class='String'>"scram-sha-256"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                                  <span class='String'>"#password_encryption = md5"</span><span class='Delimiter'>, 
</span>                                  <span class='String'>"password_encryption = scram-sha-256"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/postgresql.conf"</span><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN234"><span class='Ref_to_Proto'>writefile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>chmod<span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN424"><span class='Ref_to_Const'>S_IRUSR</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN425"><span class='Ref_to_Const'>S_IWUSR</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not change permissions of \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create the automatic configuration file to store the configuration 
     * parameters set by ALTER SYSTEM command. The parameters present in this 
     * file will override the value of parameters that exists before parse of 
     * this file. 
     */ 
</span>    <a href="initdb.c.html#LN1011"><span class='Ref_To_Local'>autoconflines</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><span class='String'>"# Do not edit this file manually!\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1011"><span class='Ref_To_Local'>autoconflines</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><span class='String'>"# It will be overwritten by the ALTER SYSTEM command.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1011"><span class='Ref_To_Local'>autoconflines</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><span class='String'>"%s/postgresql.auto.conf"</span><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN234"><span class='Ref_to_Proto'>writefile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1011"><span class='Ref_To_Local'>autoconflines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>chmod<span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN424"><span class='Ref_to_Const'>S_IRUSR</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN425"><span class='Ref_to_Const'>S_IWUSR</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not change permissions of \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
    <span class='Comment_Multi_Line'>/* pg_hba.conf */ 
</span> 
    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="../pg_ctl/pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN151"><span class='Ref_to_Global_Var'>hba_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifndef</span> HAVE_UNIX_SOCKETS 
    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN231"><span class='Ref_to_Proto'>filter_lines_with_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"@remove-line-for-nolocal@"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, </span><span class='String'>"@remove-line-for-nolocal@"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifdef</span> HAVE_IPV6 
 
    <span class='Comment_Multi_Line'>/* 
     * Probe to see if there is really any platform support for IPv6, and 
     * comment out the relevant pg_hba line if not.  This avoids runtime 
     * warnings if getaddrinfo doesn't actually cope with IPv6.  Particularly 
     * useful on Windows, where executables built on a machine with IPv6 may 
     * have to run on a machine without. 
     */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1193"></a>        <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>gai_result</span><span class='Delimiter'>; 
</span><a name="LN1194"></a>        <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Declare_Local'>hints</span><span class='Delimiter'>; 
</span><a name="LN1195"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>err</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
        <span class='Comment_Multi_Line'>/* need to call WSAStartup before calling getaddrinfo */ 
</span><a name="LN1199"></a>        WSADATA     <span class='Declare_Local'>wsaData</span><span class='Delimiter'>; 
</span> 
        <a href="initdb.c.html#LN1195"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span>WSAStartup<span class='Parentheses'>(</span>MAKEWORD<span class='Parentheses'>(</span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN1199"><span class='Ref_To_Local'>wsaData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <span class='Comment_Multi_Line'>/* for best results, this code should match parse_hba() */ 
</span>        <a href="initdb.c.html#LN1194"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN99"><span class='Ref_to_Member'>ai_flags</span></a> <span class='Operator'>= </span><a href="../../include/getaddrinfo.h.html#LN70"><span class='Ref_to_Const'>AI_NUMERICHOST</span></a><span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN1194"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a> <span class='Operator'>= </span>AF_UNSPEC<span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN1194"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN101"><span class='Ref_to_Member'>ai_socktype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN1194"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN102"><span class='Ref_to_Member'>ai_protocol</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN1194"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN103"><span class='Ref_to_Member'>ai_addrlen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN1194"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN105"><span class='Ref_to_Member'>ai_canonname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN1194"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="initdb.c.html#LN1194"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1195"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="../../port/getaddrinfo.c.html#LN135"><span class='Ref_to_Func'>getaddrinfo</span></a><span class='Parentheses'>(</span><span class='String'>"::1"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN1194"><span class='Ref_To_Local'>hints</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN1193"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                               <span class='String'>"host    all             all             ::1"</span><span class='Delimiter'>, 
</span>                             <span class='String'>"#host    all             all             ::1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                               <span class='String'>"host    replication     all             ::1"</span><span class='Delimiter'>, 
</span>                             <span class='String'>"#host    replication     all             ::1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* !HAVE_IPV6 */ 
</span>    <span class='Comment_Multi_Line'>/* If we didn't compile IPV6 support at all, always comment it out */ 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"host    all             all             ::1"</span><span class='Delimiter'>, 
</span>                              <span class='String'>"#host    all             all             ::1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"host    replication     all             ::1"</span><span class='Delimiter'>, 
</span>                              <span class='String'>"#host    replication     all             ::1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_IPV6 */ 
</span> 
    <span class='Comment_Multi_Line'>/* Replace default authentication methods */ 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"@authmethodhost@"</span><span class='Delimiter'>, 
</span>                              <a href="initdb.c.html#LN134"><span class='Ref_to_Global_Var'>authmethodhost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"@authmethodlocal@"</span><span class='Delimiter'>, 
</span>                              <a href="initdb.c.html#LN135"><span class='Ref_to_Global_Var'>authmethodlocal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"@authcomment@"</span><span class='Delimiter'>, 
</span>                              <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN135"><span class='Ref_to_Global_Var'>authmethodlocal</span></a><span class='Delimiter'>, </span><span class='String'>"trust"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN134"><span class='Ref_to_Global_Var'>authmethodhost</span></a><span class='Delimiter'>, </span><span class='String'>"trust"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><a href="initdb.c.html#LN177"><span class='Ref_to_Const'>AUTHTRUST_WARNING</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/pg_hba.conf"</span><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN234"><span class='Ref_to_Proto'>writefile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>chmod<span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN424"><span class='Ref_to_Const'>S_IRUSR</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN425"><span class='Ref_to_Const'>S_IWUSR</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not change permissions of \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* pg_ident.conf */ 
</span> 
    <a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a> <span class='Operator'>= </span><a href="../pg_ctl/pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN152"><span class='Ref_to_Global_Var'>ident_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/pg_ident.conf"</span><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN234"><span class='Ref_to_Proto'>writefile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>chmod<span class='Parentheses'>(</span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN424"><span class='Ref_to_Const'>S_IRUSR</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN425"><span class='Ref_to_Const'>S_IWUSR</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not change permissions of \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1009"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1007"><span class='Ref_To_Local'>conflines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../pg_upgrade/util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_config &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * run the BKI script in bootstrap mode to create template1 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1283"></a><span class='Declare_Function'>bootstrap_template1</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="initdb.c.html#LN284"><span class='Ref_to_Const'>PG_CMD_DECL</span></a><span class='Delimiter'>; 
</span><a name="LN1286"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1287"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>talkargs</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN1288"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>bki_lines</span><span class='Delimiter'>; 
</span><a name="LN1289"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>headerline</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN1290"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"running bootstrap script ... "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN1287"><span class='Ref_To_Local'>talkargs</span></a> <span class='Operator'>= </span><span class='String'>"-d 5"</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a> <span class='Operator'>= </span><a href="../pg_ctl/pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN148"><span class='Ref_to_Global_Var'>bki_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that bki file appears to be of the right version */ 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1289"><span class='Ref_To_Local'>headerline</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1289"><span class='Ref_To_Local'>headerline</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"# PostgreSQL %s\n"</span><span class='Delimiter'>, 
</span>             PG_MAJORVERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN1289"><span class='Ref_To_Local'>headerline</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: input file \"%s\" does not belong to PostgreSQL %s\n"</span> 
                  <span class='String'>"Check your installation or specify the correct path "</span> 
                  <span class='String'>"using the option -L.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN148"><span class='Ref_to_Global_Var'>bki_file</span></a><span class='Delimiter'>, </span>PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Substitute for various symbols used in the BKI file */ 
</span> 
    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1290"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Delimiter'>, </span><span class='String'>"NAMEDATALEN"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1290"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1290"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Delimiter'>, </span><span class='String'>"SIZEOF_POINTER"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1290"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Delimiter'>, </span><span class='String'>"ALIGNOF_POINTER"</span><span class='Delimiter'>, 
</span>                              <span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>4</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='String'>"i"</span> <span class='Operator'>: </span><span class='String'>"d"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Delimiter'>, </span><span class='String'>"FLOAT4PASSBYVAL"</span><span class='Delimiter'>, 
</span>                              FLOAT4PASSBYVAL <span class='Operator'>? </span><span class='String'>"true"</span> <span class='Operator'>: </span><span class='String'>"false"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Delimiter'>, </span><span class='String'>"FLOAT8PASSBYVAL"</span><span class='Delimiter'>, 
</span>                              FLOAT8PASSBYVAL <span class='Operator'>? </span><span class='String'>"true"</span> <span class='Operator'>: </span><span class='String'>"false"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Delimiter'>, </span><span class='String'>"POSTGRES"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN130"><span class='Ref_to_Global_Var'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Delimiter'>, </span><span class='String'>"ENCODING"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN147"><span class='Ref_to_Global_Var'>encodingid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Delimiter'>, </span><span class='String'>"LC_COLLATE"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN123"><span class='Ref_to_Global_Var'>lc_collate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Delimiter'>, </span><span class='String'>"LC_CTYPE"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pass correct LC_xxx environment to bootstrap. 
     * 
     * The shell script arranged to restore the LC settings afterwards, but 
     * there doesn't seem to be any compelling reason to do that. 
     */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span>cmd<span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>cmd<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"LC_COLLATE=%s"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN123"><span class='Ref_to_Global_Var'>lc_collate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span>cmd<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span>cmd<span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>cmd<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"LC_CTYPE=%s"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span>cmd<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"LC_ALL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Also ensure backend isn't confused by this environment var: */ 
</span>    <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGCLIENTENCODING"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span>cmd<span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>cmd<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"\"%s\" --boot -x1 %s %s %s"</span><span class='Delimiter'>, 
</span>             <a href="initdb.c.html#LN225"><span class='Ref_to_Global_Var'>backend_exec</span></a><span class='Delimiter'>, 
</span>             <a href="initdb.c.html#LN141"><span class='Ref_to_Global_Var'>data_checksums</span></a> <span class='Operator'>? </span><span class='String'>"-k"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>             <a href="initdb.c.html#LN194"><span class='Ref_to_Global_Var'>boot_options</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1287"><span class='Ref_To_Local'>talkargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN286"><span class='Ref_to_Const'>PG_CMD_OPEN</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1286"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN1286"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN1286"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1286"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1286"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="initdb.c.html#LN293"><span class='Ref_to_Const'>PG_CMD_CLOSE</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1288"><span class='Ref_To_Local'>bki_lines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../pg_upgrade/util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end bootstrap_template1 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set up the shadow password table 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1382"></a><span class='Declare_Function'>setup_auth</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1384"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1385"></a>    <span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Local'>pg_authid_setup</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The authid table shouldn't be readable except through views, to 
         * ensure passwords are not publicly visible. 
         */ 
</span>        <span class='String'>"REVOKE ALL on pg_authid FROM public;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='Null_Value'>NULL 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1384"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1385"><span class='Ref_To_Local'>pg_authid_setup</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN1384"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN1384"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1384"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN133"><span class='Ref_to_Global_Var'>superuser_password</span></a><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN311"><span class='Ref_to_Macro'>PG_CMD_PRINTF2</span></a><span class='Parentheses'>(</span><span class='String'>"ALTER USER \"%s\" WITH PASSWORD E'%s';\n\n"</span><span class='Delimiter'>, 
</span>                       <a href="initdb.c.html#LN130"><span class='Ref_to_Global_Var'>username</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN133"><span class='Ref_to_Global_Var'>superuser_password</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_auth &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get the superuser password if required 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1406"></a><span class='Declare_Function'>get_su_pwd</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1408"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>pwd1</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span><a name="LN1409"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>pwd2</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN131"><span class='Ref_to_Global_Var'>pwprompt</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Read password from terminal 
         */ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/sprompt.c.html#LN35"><span class='Ref_to_Func'>simple_prompt</span></a><span class='Parentheses'>(</span><span class='String'>"Enter new superuser password: "</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1408"><span class='Ref_To_Local'>pwd1</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1408"><span class='Ref_To_Local'>pwd1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/sprompt.c.html#LN35"><span class='Ref_to_Func'>simple_prompt</span></a><span class='Parentheses'>(</span><span class='String'>"Enter it again: "</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1409"><span class='Ref_To_Local'>pwd2</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1409"><span class='Ref_To_Local'>pwd2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN1408"><span class='Ref_To_Local'>pwd1</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1409"><span class='Ref_To_Local'>pwd2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Passwords didn't match.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Read password from file 
         * 
         * Ideally this should insist that the file not be world-readable. 
         * However, this option is mainly intended for use on Windows where 
         * file permissions may not exist at all, so we'll skip the paranoia 
         * for now. 
         */ 
</span><a name="LN1436"></a>        FILE       <span class='Operator'>*</span><span class='Declare_Local'>pwf</span> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN132"><span class='Ref_to_Global_Var'>pwfilename</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1437"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="initdb.c.html#LN1436"><span class='Ref_To_Local'>pwf</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for reading: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN132"><span class='Ref_to_Global_Var'>pwfilename</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>fgets<span class='Parentheses'>(</span><a href="initdb.c.html#LN1408"><span class='Ref_To_Local'>pwd1</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1408"><span class='Ref_To_Local'>pwd1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN1436"><span class='Ref_To_Local'>pwf</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>ferror<span class='Parentheses'>(</span><a href="initdb.c.html#LN1436"><span class='Ref_To_Local'>pwf</span></a><span class='Parentheses'>))</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not read password from file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN132"><span class='Ref_to_Global_Var'>pwfilename</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: password file \"%s\" is empty\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN132"><span class='Ref_to_Global_Var'>pwfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        fclose<span class='Parentheses'>(</span><a href="initdb.c.html#LN1436"><span class='Ref_To_Local'>pwf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="initdb.c.html#LN1437"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN1408"><span class='Ref_To_Local'>pwd1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1437"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="initdb.c.html#LN1408"><span class='Ref_To_Local'>pwd1</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN1437"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\r'</span> <span class='Operator'>|| </span><a href="initdb.c.html#LN1408"><span class='Ref_To_Local'>pwd1</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN1437"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>))</span> 
            <a href="initdb.c.html#LN1408"><span class='Ref_To_Local'>pwd1</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="initdb.c.html#LN1437"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="initdb.c.html#LN133"><span class='Ref_to_Global_Var'>superuser_password</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1408"><span class='Ref_To_Local'>pwd1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_su_pwd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set up pg_depend 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1469"></a><span class='Declare_Function'>setup_depend</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1471"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1472"></a>    <span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Local'>pg_depend_setup</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Make PIN entries in pg_depend for all objects made so far in the 
         * tables that the dependency code handles.  This is overkill (the 
         * system doesn't really depend on having every last weird datatype, 
         * for instance) but generating only the minimum required set of 
         * dependencies seems hard. 
         * 
         * Note that we deliberately do not pin the system views, which 
         * haven't been created yet.  Also, no conversions, databases, or 
         * tablespaces are pinned. 
         * 
         * First delete any already-made entries; PINs override all else, and 
         * must be the only entries for their objects. 
         */ 
</span>        <span class='String'>"DELETE FROM pg_depend;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"VACUUM pg_depend;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"DELETE FROM pg_shdepend;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"VACUUM pg_shdepend;\n\n"</span><span class='Delimiter'>, 
</span> 
        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_class;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_proc;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_type;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_cast;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_constraint;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_attrdef;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_language;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_operator;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_opclass;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_opfamily;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_am;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_amop;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_amproc;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_rewrite;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_trigger;\n\n"</span><span class='Delimiter'>, 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * restriction here to avoid pinning the public namespace 
         */ 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_namespace "</span> 
        <span class='String'>"    WHERE nspname LIKE 'pg%';\n\n"</span><span class='Delimiter'>, 
</span> 
        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_ts_parser;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_ts_dict;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_ts_template;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_ts_config;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_depend SELECT 0,0,0, tableoid,oid,0, 'p' "</span> 
        <span class='String'>" FROM pg_collation;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_shdepend SELECT 0,0,0,0, tableoid,oid, 'p' "</span> 
        <span class='String'>" FROM pg_authid;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='Null_Value'>NULL 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1471"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1472"><span class='Ref_To_Local'>pg_depend_setup</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN1471"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN1471"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1471"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_depend &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set up system views 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1553"></a><span class='Declare_Function'>setup_sysviews</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1555"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1556"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>sysviews_setup</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1556"><span class='Ref_To_Local'>sysviews_setup</span></a> <span class='Operator'>= </span><a href="../pg_ctl/pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN158"><span class='Ref_to_Global_Var'>system_views_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1555"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1556"><span class='Ref_To_Local'>sysviews_setup</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN1555"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN1555"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1555"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1555"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1556"><span class='Ref_To_Local'>sysviews_setup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * load description data 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1573"></a><span class='Declare_Function'>setup_description</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='String'>"CREATE TEMP TABLE tmp_pg_description ( "</span> 
                <span class='String'>"   objoid oid, "</span> 
                <span class='String'>"   classname name, "</span> 
                <span class='String'>"   objsubid int4, "</span> 
                <span class='String'>"   description text) WITHOUT OIDS;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN305"><span class='Ref_to_Macro'>PG_CMD_PRINTF1</span></a><span class='Parentheses'>(</span><span class='String'>"COPY tmp_pg_description FROM E'%s';\n\n"</span><span class='Delimiter'>, 
</span>                   <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN149"><span class='Ref_to_Global_Var'>desc_file</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='String'>"INSERT INTO pg_description "</span> 
                <span class='String'>" SELECT t.objoid, c.oid, t.objsubid, t.description "</span> 
                <span class='String'>"  FROM tmp_pg_description t, pg_class c "</span> 
                <span class='String'>"    WHERE c.relname = t.classname;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='String'>"CREATE TEMP TABLE tmp_pg_shdescription ( "</span> 
                <span class='String'>" objoid oid, "</span> 
                <span class='String'>" classname name, "</span> 
                <span class='String'>" description text) WITHOUT OIDS;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN305"><span class='Ref_to_Macro'>PG_CMD_PRINTF1</span></a><span class='Parentheses'>(</span><span class='String'>"COPY tmp_pg_shdescription FROM E'%s';\n\n"</span><span class='Delimiter'>, 
</span>                   <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN150"><span class='Ref_to_Global_Var'>shdesc_file</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='String'>"INSERT INTO pg_shdescription "</span> 
                <span class='String'>" SELECT t.objoid, c.oid, t.description "</span> 
                <span class='String'>"  FROM tmp_pg_shdescription t, pg_class c "</span> 
                <span class='String'>"   WHERE c.relname = t.classname;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create default descriptions for operator implementation functions */ 
</span>    <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='String'>"WITH funcdescs AS ( "</span> 
                <span class='String'>"SELECT p.oid as p_oid, oprname, "</span> 
              <span class='String'>"coalesce(obj_description(o.oid, 'pg_operator'),'') as opdesc "</span> 
                <span class='String'>"FROM pg_proc p JOIN pg_operator o ON oprcode = p.oid ) "</span> 
                <span class='String'>"INSERT INTO pg_description "</span> 
                <span class='String'>"  SELECT p_oid, 'pg_proc'::regclass, 0, "</span> 
                <span class='String'>"    'implementation of ' || oprname || ' operator' "</span> 
                <span class='String'>"  FROM funcdescs "</span> 
                <span class='String'>"  WHERE opdesc NOT LIKE 'deprecated%' AND "</span> 
                <span class='String'>"  NOT EXISTS (SELECT 1 FROM pg_description "</span> 
        <span class='String'>"    WHERE objoid = p_oid AND classoid = 'pg_proc'::regclass);\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Even though the tables are temp, drop them explicitly so they don't get 
     * copied into template0/postgres databases. 
     */ 
</span>    <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='String'>"DROP TABLE tmp_pg_description;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='String'>"DROP TABLE tmp_pg_shdescription;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_description &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * populate pg_collation 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1627"></a><span class='Declare_Function'>setup_collation</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='String'>"SELECT pg_import_system_collations(if_not_exists =&GT; false, schema =&GT; 'pg_catalog');\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add an SQL-standard name */ 
</span>    <a href="initdb.c.html#LN317"><span class='Ref_to_Macro'>PG_CMD_PRINTF3</span></a><span class='Parentheses'>(</span><span class='String'>"INSERT INTO pg_collation (collname, collnamespace, collowner, collprovider, collencoding, collcollate, collctype) VALUES ('ucs_basic', 'pg_catalog'::regnamespace, %u, '%c', %d, 'C', 'C');\n\n"</span><span class='Delimiter'>, </span><a href="../../include/catalog/pg_authid.h.html#LN101"><span class='Ref_to_Const'>BOOTSTRAP_SUPERUSERID</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN85"><span class='Ref_to_Const'>COLLPROVIDER_LIBC</span></a><span class='Delimiter'>, </span><a href="../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * load conversion functions 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1639"></a><span class='Declare_Function'>setup_conversion</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1641"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1642"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>conv_lines</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1642"><span class='Ref_To_Local'>conv_lines</span></a> <span class='Operator'>= </span><a href="../pg_ctl/pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN154"><span class='Ref_to_Global_Var'>conversion_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1641"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1642"><span class='Ref_To_Local'>conv_lines</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN1641"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN1641"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strstr<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1641"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><span class='String'>"DROP CONVERSION"</span><span class='Parentheses'>) </span><span class='Operator'>!= *</span><a href="initdb.c.html#LN1641"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span> 
            <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1641"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1641"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1642"><span class='Ref_To_Local'>conv_lines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * load extra dictionaries (Snowball stemmers) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1659"></a><span class='Declare_Function'>setup_dictionary</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1661"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1662"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>conv_lines</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1662"><span class='Ref_To_Local'>conv_lines</span></a> <span class='Operator'>= </span><a href="../pg_ctl/pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN155"><span class='Ref_to_Global_Var'>dictionary_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1661"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1662"><span class='Ref_To_Local'>conv_lines</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN1661"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN1661"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1661"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1661"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1662"><span class='Ref_To_Local'>conv_lines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Set up privileges 
 * 
 * We mark most system catalogs as world-readable.  We don't currently have 
 * to touch functions, languages, or databases, because their default 
 * permissions are OK. 
 * 
 * Some objects may require different permissions by default, so we 
 * make sure we don't overwrite privilege sets that have already been 
 * set (NOT NULL). 
 * 
 * Also populate pg_init_privs to save what the privileges are at init 
 * time.  This is used by pg_dump to allow users to change privileges 
 * on catalog objects and to have those privilege changes preserved 
 * across dump/reload and pg_upgrade. 
 * 
 * Note that pg_init_privs is only for per-database objects and therefore 
 * we don't include databases or tablespaces. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1694"></a><span class='Declare_Function'>setup_privileges</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1696"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1697"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>priv_lines</span><span class='Delimiter'>; 
</span><a name="LN1698"></a>    <span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Local'>privileges_setup</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='String'>"UPDATE pg_class "</span> 
        <span class='String'>"  SET relacl = (SELECT array_agg(a.acl) FROM "</span> 
        <span class='String'>" (SELECT E'=r/\"$POSTGRES_SUPERUSERNAME\"' as acl "</span> 
        <span class='String'>"  UNION SELECT unnest(pg_catalog.acldefault("</span> 
        <span class='String'>"    CASE WHEN relkind = "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) </span><span class='String'>" THEN 's' "</span> 
        <span class='String'>"         ELSE 'r' END::\"char\","</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN101"><span class='Ref_to_Const'>BOOTSTRAP_SUPERUSERID</span></a><span class='Parentheses'>) </span><span class='String'>"::oid))"</span> 
        <span class='String'>" ) as a) "</span> 
        <span class='String'>"  WHERE relkind IN ("</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> 
        <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> 
        <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) </span><span class='String'>")"</span> 
        <span class='String'>"  AND relacl IS NULL;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"GRANT USAGE ON SCHEMA pg_catalog TO PUBLIC;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"GRANT CREATE, USAGE ON SCHEMA public TO PUBLIC;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"REVOKE ALL ON pg_largeobject FROM PUBLIC;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_init_privs "</span> 
        <span class='String'>"  (objoid, classoid, objsubid, initprivs, privtype)"</span> 
        <span class='String'>"    SELECT"</span> 
        <span class='String'>"        oid,"</span> 
        <span class='String'>"        (SELECT oid FROM pg_class WHERE relname = 'pg_class'),"</span> 
        <span class='String'>"        0,"</span> 
        <span class='String'>"        relacl,"</span> 
        <span class='String'>"        'i'"</span> 
        <span class='String'>"    FROM"</span> 
        <span class='String'>"        pg_class"</span> 
        <span class='String'>"    WHERE"</span> 
        <span class='String'>"        relacl IS NOT NULL"</span> 
        <span class='String'>"        AND relkind IN ("</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> 
        <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> 
        <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) </span><span class='String'>");"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_init_privs "</span> 
        <span class='String'>"  (objoid, classoid, objsubid, initprivs, privtype)"</span> 
        <span class='String'>"    SELECT"</span> 
        <span class='String'>"        pg_class.oid,"</span> 
        <span class='String'>"        (SELECT oid FROM pg_class WHERE relname = 'pg_class'),"</span> 
        <span class='String'>"        pg_attribute.attnum,"</span> 
        <span class='String'>"        pg_attribute.attacl,"</span> 
        <span class='String'>"        'i'"</span> 
        <span class='String'>"    FROM"</span> 
        <span class='String'>"        pg_class"</span> 
        <span class='String'>"        JOIN pg_attribute ON (pg_class.oid = pg_attribute.attrelid)"</span> 
        <span class='String'>"    WHERE"</span> 
        <span class='String'>"        pg_attribute.attacl IS NOT NULL"</span> 
        <span class='String'>"        AND pg_class.relkind IN ("</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> 
        <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> 
        <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) </span><span class='String'>");"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_init_privs "</span> 
        <span class='String'>"  (objoid, classoid, objsubid, initprivs, privtype)"</span> 
        <span class='String'>"    SELECT"</span> 
        <span class='String'>"        oid,"</span> 
        <span class='String'>"        (SELECT oid FROM pg_class WHERE relname = 'pg_proc'),"</span> 
        <span class='String'>"        0,"</span> 
        <span class='String'>"        proacl,"</span> 
        <span class='String'>"        'i'"</span> 
        <span class='String'>"    FROM"</span> 
        <span class='String'>"        pg_proc"</span> 
        <span class='String'>"    WHERE"</span> 
        <span class='String'>"        proacl IS NOT NULL;"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_init_privs "</span> 
        <span class='String'>"  (objoid, classoid, objsubid, initprivs, privtype)"</span> 
        <span class='String'>"    SELECT"</span> 
        <span class='String'>"        oid,"</span> 
        <span class='String'>"        (SELECT oid FROM pg_class WHERE relname = 'pg_type'),"</span> 
        <span class='String'>"        0,"</span> 
        <span class='String'>"        typacl,"</span> 
        <span class='String'>"        'i'"</span> 
        <span class='String'>"    FROM"</span> 
        <span class='String'>"        pg_type"</span> 
        <span class='String'>"    WHERE"</span> 
        <span class='String'>"        typacl IS NOT NULL;"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_init_privs "</span> 
        <span class='String'>"  (objoid, classoid, objsubid, initprivs, privtype)"</span> 
        <span class='String'>"    SELECT"</span> 
        <span class='String'>"        oid,"</span> 
        <span class='String'>"        (SELECT oid FROM pg_class WHERE relname = 'pg_language'),"</span> 
        <span class='String'>"        0,"</span> 
        <span class='String'>"        lanacl,"</span> 
        <span class='String'>"        'i'"</span> 
        <span class='String'>"    FROM"</span> 
        <span class='String'>"        pg_language"</span> 
        <span class='String'>"    WHERE"</span> 
        <span class='String'>"        lanacl IS NOT NULL;"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_init_privs "</span> 
        <span class='String'>"  (objoid, classoid, objsubid, initprivs, privtype)"</span> 
        <span class='String'>"    SELECT"</span> 
        <span class='String'>"        oid,"</span> 
        <span class='String'>"        (SELECT oid FROM pg_class WHERE "</span> 
        <span class='String'>"         relname = 'pg_largeobject_metadata'),"</span> 
        <span class='String'>"        0,"</span> 
        <span class='String'>"        lomacl,"</span> 
        <span class='String'>"        'i'"</span> 
        <span class='String'>"    FROM"</span> 
        <span class='String'>"        pg_largeobject_metadata"</span> 
        <span class='String'>"    WHERE"</span> 
        <span class='String'>"        lomacl IS NOT NULL;"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_init_privs "</span> 
        <span class='String'>"  (objoid, classoid, objsubid, initprivs, privtype)"</span> 
        <span class='String'>"    SELECT"</span> 
        <span class='String'>"        oid,"</span> 
        <span class='String'>"        (SELECT oid FROM pg_class WHERE relname = 'pg_namespace'),"</span> 
        <span class='String'>"        0,"</span> 
        <span class='String'>"        nspacl,"</span> 
        <span class='String'>"        'i'"</span> 
        <span class='String'>"    FROM"</span> 
        <span class='String'>"        pg_namespace"</span> 
        <span class='String'>"    WHERE"</span> 
        <span class='String'>"        nspacl IS NOT NULL;"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_init_privs "</span> 
        <span class='String'>"  (objoid, classoid, objsubid, initprivs, privtype)"</span> 
        <span class='String'>"    SELECT"</span> 
        <span class='String'>"        oid,"</span> 
        <span class='String'>"        (SELECT oid FROM pg_class WHERE "</span> 
        <span class='String'>"         relname = 'pg_foreign_data_wrapper'),"</span> 
        <span class='String'>"        0,"</span> 
        <span class='String'>"        fdwacl,"</span> 
        <span class='String'>"        'i'"</span> 
        <span class='String'>"    FROM"</span> 
        <span class='String'>"        pg_foreign_data_wrapper"</span> 
        <span class='String'>"    WHERE"</span> 
        <span class='String'>"        fdwacl IS NOT NULL;"</span><span class='Delimiter'>, 
</span>        <span class='String'>"INSERT INTO pg_init_privs "</span> 
        <span class='String'>"  (objoid, classoid, objsubid, initprivs, privtype)"</span> 
        <span class='String'>"    SELECT"</span> 
        <span class='String'>"        oid,"</span> 
        <span class='String'>"        (SELECT oid FROM pg_class "</span> 
        <span class='String'>"         WHERE relname = 'pg_foreign_server'),"</span> 
        <span class='String'>"        0,"</span> 
        <span class='String'>"        srvacl,"</span> 
        <span class='String'>"        'i'"</span> 
        <span class='String'>"    FROM"</span> 
        <span class='String'>"        pg_foreign_server"</span> 
        <span class='String'>"    WHERE"</span> 
        <span class='String'>"        srvacl IS NOT NULL;"</span><span class='Delimiter'>, 
</span>        <span class='Null_Value'>NULL 
</span>    <span class='Delimiter'>}; 
</span> 
    <a href="initdb.c.html#LN1697"><span class='Ref_To_Local'>priv_lines</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN227"><span class='Ref_to_Proto'>replace_token</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1698"><span class='Ref_To_Local'>privileges_setup</span></a><span class='Delimiter'>, </span><span class='String'>"$POSTGRES_SUPERUSERNAME"</span><span class='Delimiter'>, 
</span>                               <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN130"><span class='Ref_to_Global_Var'>username</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1696"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1697"><span class='Ref_To_Local'>priv_lines</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN1696"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN1696"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1696"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_privileges &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * extract the strange version of version required for information schema 
 * (09.08.0007abc) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1845"></a><span class='Declare_Function'>set_info_version</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1847"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>letterversion</span><span class='Delimiter'>; 
</span><a name="LN1848"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>major</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN1849"></a>                <span class='Declare_Local'>minor</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN1850"></a>                <span class='Declare_Local'>micro</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1851"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span><a name="LN1852"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>vstr</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span>PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1853"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1853"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1852"><span class='Ref_To_Local'>vstr</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN1852"><span class='Ref_To_Local'>vstr</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1853"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>!= </span><a href="initdb.c.html#LN1852"><span class='Ref_To_Local'>vstr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1853"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&LT; </span><span class='String'>'0'</span> <span class='Operator'>|| *</span><a href="initdb.c.html#LN1853"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&GT; </span><span class='String'>'9'</span><span class='Parentheses'>))</span> 
        <a href="initdb.c.html#LN1853"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1847"><span class='Ref_To_Local'>letterversion</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1853"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN1848"><span class='Ref_To_Local'>major</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="initdb.c.html#LN1852"><span class='Ref_To_Local'>vstr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN1851"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1851"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN1849"><span class='Ref_To_Local'>minor</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="initdb.c.html#LN1851"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN1851"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1851"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN1850"><span class='Ref_To_Local'>micro</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="initdb.c.html#LN1851"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN1851"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN163"><span class='Ref_to_Global_Var'>infoversion</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN163"><span class='Ref_to_Global_Var'>infoversion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%02ld.%02ld.%04ld%s"</span><span class='Delimiter'>, 
</span>             <a href="initdb.c.html#LN1848"><span class='Ref_To_Local'>major</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1849"><span class='Ref_To_Local'>minor</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1850"><span class='Ref_To_Local'>micro</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN1847"><span class='Ref_To_Local'>letterversion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_info_version &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * load info schema and populate from features file 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1872"></a><span class='Declare_Function'>setup_schema</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1874"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1875"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>lines</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN1875"><span class='Ref_To_Local'>lines</span></a> <span class='Operator'>= </span><a href="../pg_ctl/pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN156"><span class='Ref_to_Global_Var'>info_schema_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1874"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1875"><span class='Ref_To_Local'>lines</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN1874"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN1874"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1874"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1874"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1875"><span class='Ref_To_Local'>lines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN305"><span class='Ref_to_Macro'>PG_CMD_PRINTF1</span></a><span class='Parentheses'>(</span><span class='String'>"UPDATE information_schema.sql_implementation_info "</span> 
                   <span class='String'>"  SET character_value = '%s' "</span> 
                   <span class='String'>"  WHERE implementation_info_name = 'DBMS VERSION';\n\n"</span><span class='Delimiter'>, 
</span>                   <a href="initdb.c.html#LN163"><span class='Ref_to_Global_Var'>infoversion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN305"><span class='Ref_to_Macro'>PG_CMD_PRINTF1</span></a><span class='Parentheses'>(</span><span class='String'>"COPY information_schema.sql_features "</span> 
                   <span class='String'>"  (feature_id, feature_name, sub_feature_id, "</span> 
                   <span class='String'>"  sub_feature_name, is_supported, comments) "</span> 
                   <span class='String'>" FROM E'%s';\n\n"</span><span class='Delimiter'>, 
</span>                   <a href="initdb.c.html#LN263"><span class='Ref_to_Proto'>escape_quotes</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN157"><span class='Ref_to_Global_Var'>features_file</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_schema &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * load PL/pgSQL server-side language 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1903"></a><span class='Declare_Function'>load_plpgsql</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='String'>"CREATE EXTENSION plpgsql;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * clean everything up in template1 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1912"></a><span class='Declare_Function'>vacuum_db</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Run analyze before VACUUM so the statistics are frozen. */ 
</span>    <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='String'>"ANALYZE;\n\nVACUUM FREEZE;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * copy template1 to template0 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1922"></a><span class='Declare_Function'>make_template0</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1924"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1925"></a>    <span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Local'>template0_setup</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='String'>"CREATE DATABASE template0 IS_TEMPLATE = true ALLOW_CONNECTIONS = false;\n\n"</span><span class='Delimiter'>, 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We use the OID of template0 to determine lastsysoid 
         */ 
</span>        <span class='String'>"UPDATE pg_database SET datlastsysoid = "</span> 
        <span class='String'>"    (SELECT oid FROM pg_database "</span> 
        <span class='String'>"    WHERE datname = 'template0');\n\n"</span><span class='Delimiter'>, 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Explicitly revoke public create-schema and create-temp-table 
         * privileges in template1 and template0; else the latter would be on 
         * by default 
         */ 
</span>        <span class='String'>"REVOKE CREATE,TEMPORARY ON DATABASE template1 FROM public;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"REVOKE CREATE,TEMPORARY ON DATABASE template0 FROM public;\n\n"</span><span class='Delimiter'>, 
</span> 
        <span class='String'>"COMMENT ON DATABASE template0 IS 'unmodifiable empty database';\n\n"</span><span class='Delimiter'>, 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Finally vacuum to clean up dead rows in pg_database 
         */ 
</span>        <span class='String'>"VACUUM pg_database;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='Null_Value'>NULL 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1924"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1925"><span class='Ref_To_Local'>template0_setup</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN1924"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>; </span><a href="initdb.c.html#LN1924"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1924"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_template0 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * copy template1 to postgres 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1960"></a><span class='Declare_Function'>make_postgres</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>cmdfd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1962"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN1963"></a>    <span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Local'>postgres_setup</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='String'>"CREATE DATABASE postgres;\n\n"</span><span class='Delimiter'>, 
</span>        <span class='String'>"COMMENT ON DATABASE postgres IS 'default administrative connection database';\n\n"</span><span class='Delimiter'>, 
</span>        <span class='Null_Value'>NULL 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN1962"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN1963"><span class='Ref_To_Local'>postgres_setup</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN1962"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>; </span><a href="initdb.c.html#LN1962"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN299"><span class='Ref_to_Macro'>PG_CMD_PUTS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN1962"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * signal handler in case we are interrupted. 
 * 
 * The Windows runtime docs at 
 * http://msdn.microsoft.com/library/en-us/vclib/html/_crt_signal.asp 
 * specifically forbid a number of things being done from a signal handler, 
 * including IO, memory allocation and system calls, and only allow jmpbuf 
 * if you are handling SIGFPE. 
 * 
 * I avoided doing the forbidden things by setting a flag instead of calling 
 * exit_nicely() directly. 
 * 
 * Also note the behaviour of Windows with SIGINT, which says this: 
 *   Note   SIGINT is not supported for any Win32 application, including 
 *   Windows 98/Me and Windows NT/2000/XP. When a CTRL+C interrupt occurs, 
 *   Win32 operating systems generate a new thread to specifically handle 
 *   that interrupt. This can cause a single-thread application such as UNIX, 
 *   to become multithreaded, resulting in unexpected behavior. 
 * 
 * I have no idea how to handle this. (Strange they call UNIX an application!) 
 * So this will need some testing on Windows. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1996"></a><span class='Declare_Function'>trapsig</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>signum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* handle systems that reset the handler, like Windows (grr) */ 
</span>    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN1996"><span class='Ref_to_Parameter'>signum</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN261"><span class='Ref_to_Proto'>trapsig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN164"><span class='Ref_to_Global_Var'>caught_signal</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * call exit_nicely() if we got a signal, or else output "ok". 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2007"></a><span class='Declare_Function'>check_ok</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN164"><span class='Ref_to_Global_Var'>caught_signal</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"caught signal\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN165"><span class='Ref_to_Global_Var'>output_failed</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"could not write to child process: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN166"><span class='Ref_to_Global_Var'>output_errno</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* all seems well */ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"ok\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end check_ok &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Hack to suppress a warning about %x from some versions of gcc */ 
</span><span class='Keyword'>static inline </span>size_t 
<a name="LN2032"></a><span class='Declare_Function'>my_strftime</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>max</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><span class='Control'>struct</span> <a href="initdb.c.html#LN2032"><span class='Ref_to_Parameter'>tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../backend/utils/adt/pg_locale.c.html#LN753"><span class='Ref_to_Macro'>strftime</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2032"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2032"><span class='Ref_to_Parameter'>max</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2032"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2032"><span class='Ref_to_Parameter'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Determine likely date order from locale 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2041"></a><span class='Declare_Function'>locale_date_order</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>locale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2043"></a>    <span class='Control'>struct</span> <a href="../../timezone/localtime.c.html#LN110"><span class='Ref_to_Global_Var'>tm</span></a>   <span class='Declare_Local'>testtime</span><span class='Delimiter'>; 
</span><a name="LN2044"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span><a name="LN2045"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>posD</span><span class='Delimiter'>; 
</span><a name="LN2046"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>posM</span><span class='Delimiter'>; 
</span><a name="LN2047"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>posY</span><span class='Delimiter'>; 
</span><a name="LN2048"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>save</span><span class='Delimiter'>; 
</span><a name="LN2049"></a>    size_t      <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2050"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN2050"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/miscadmin.h.html#LN220"><span class='Ref_to_Const'>DATEORDER_MDY</span></a><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* default */ 
</span> 
    <a href="initdb.c.html#LN2048"><span class='Ref_To_Local'>save</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN201"><span class='Ref_to_Macro'>setlocale</span></a><span class='Parentheses'>(</span>LC_TIME<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="initdb.c.html#LN2048"><span class='Ref_To_Local'>save</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="initdb.c.html#LN2050"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN2048"><span class='Ref_To_Local'>save</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2048"><span class='Ref_To_Local'>save</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN201"><span class='Ref_to_Macro'>setlocale</span></a><span class='Parentheses'>(</span>LC_TIME<span class='Delimiter'>, </span><a href="initdb.c.html#LN2041"><span class='Ref_to_Parameter'>locale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN2043"><span class='Ref_To_Local'>testtime</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN2043"><span class='Ref_To_Local'>testtime</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN2043"><span class='Ref_To_Local'>testtime</span></a><span class='Operator'>.</span>tm_mday <span class='Operator'>= </span><span class='Number'>22</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN2043"><span class='Ref_To_Local'>testtime</span></a><span class='Operator'>.</span>tm_mon <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* November, should come out as "11" */ 
</span>    <a href="initdb.c.html#LN2043"><span class='Ref_To_Local'>testtime</span></a><span class='Operator'>.</span>tm_year <span class='Operator'>= </span><span class='Number'>133</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* 2033 */ 
</span> 
    <a href="initdb.c.html#LN2049"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN2031"><span class='Ref_to_Func'>my_strftime</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2044"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN2044"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%x"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN2043"><span class='Ref_To_Local'>testtime</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN201"><span class='Ref_to_Macro'>setlocale</span></a><span class='Parentheses'>(</span>LC_TIME<span class='Delimiter'>, </span><a href="initdb.c.html#LN2048"><span class='Ref_To_Local'>save</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2048"><span class='Ref_To_Local'>save</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2049"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="initdb.c.html#LN2050"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN2046"><span class='Ref_To_Local'>posM</span></a> <span class='Operator'>= </span>strstr<span class='Parentheses'>(</span><a href="initdb.c.html#LN2044"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"11"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN2045"><span class='Ref_To_Local'>posD</span></a> <span class='Operator'>= </span>strstr<span class='Parentheses'>(</span><a href="initdb.c.html#LN2044"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"22"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN2047"><span class='Ref_To_Local'>posY</span></a> <span class='Operator'>= </span>strstr<span class='Parentheses'>(</span><a href="initdb.c.html#LN2044"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"33"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="initdb.c.html#LN2046"><span class='Ref_To_Local'>posM</span></a> <span class='Operator'>|| !</span><a href="initdb.c.html#LN2045"><span class='Ref_To_Local'>posD</span></a> <span class='Operator'>|| !</span><a href="initdb.c.html#LN2047"><span class='Ref_To_Local'>posY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="initdb.c.html#LN2050"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2047"><span class='Ref_To_Local'>posY</span></a> <span class='Operator'>&LT; </span><a href="initdb.c.html#LN2046"><span class='Ref_To_Local'>posM</span></a> <span class='Operator'>&& </span><a href="initdb.c.html#LN2046"><span class='Ref_To_Local'>posM</span></a> <span class='Operator'>&LT; </span><a href="initdb.c.html#LN2045"><span class='Ref_To_Local'>posD</span></a><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN2050"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/miscadmin.h.html#LN218"><span class='Ref_to_Const'>DATEORDER_YMD</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2045"><span class='Ref_To_Local'>posD</span></a> <span class='Operator'>&LT; </span><a href="initdb.c.html#LN2046"><span class='Ref_To_Local'>posM</span></a><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN2050"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="initdb.c.html#LN2050"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/miscadmin.h.html#LN220"><span class='Ref_to_Const'>DATEORDER_MDY</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="initdb.c.html#LN2050"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end locale_date_order &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Verify that locale name is valid for the locale category. 
 * 
 * If successful, and canonname isn't NULL, a malloc'd copy of the locale's 
 * canonical name is stored there.  This is especially useful for figuring out 
 * what locale name "" means (ie, the environment value).  (Actually, 
 * it seems that on most implementations that's the only thing it's good for; 
 * we could wish that setlocale gave back a canonically spelled version of 
 * the locale name, but typically it doesn't.) 
 * 
 * this should match the backend's check_locale() function 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2104"></a><span class='Declare_Function'>check_locale_name</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>category</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>locale</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>canonname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2106"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>save</span><span class='Delimiter'>; 
</span><a name="LN2107"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2104"><span class='Ref_to_Parameter'>canonname</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="initdb.c.html#LN2104"><span class='Ref_to_Parameter'>canonname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* in case of failure */ 
</span> 
    <a href="initdb.c.html#LN2106"><span class='Ref_To_Local'>save</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN201"><span class='Ref_to_Macro'>setlocale</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2104"><span class='Ref_to_Parameter'>category</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="initdb.c.html#LN2106"><span class='Ref_To_Local'>save</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: setlocale() failed\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* save may be pointing at a modifiable scratch variable, so copy it. */ 
</span>    <a href="initdb.c.html#LN2106"><span class='Ref_To_Local'>save</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2106"><span class='Ref_To_Local'>save</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set the locale with setlocale, to see if it accepts it. */ 
</span>    <a href="initdb.c.html#LN2107"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN201"><span class='Ref_to_Macro'>setlocale</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2104"><span class='Ref_to_Parameter'>category</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2104"><span class='Ref_to_Parameter'>locale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* save canonical name if requested. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2107"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&& </span><a href="initdb.c.html#LN2104"><span class='Ref_to_Parameter'>canonname</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="initdb.c.html#LN2104"><span class='Ref_to_Parameter'>canonname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2107"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* restore old value. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port.h.html#LN201"><span class='Ref_to_Macro'>setlocale</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2104"><span class='Ref_to_Parameter'>category</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2106"><span class='Ref_To_Local'>save</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: failed to restore old locale \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2106"><span class='Ref_To_Local'>save</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2106"><span class='Ref_To_Local'>save</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* complain if locale wasn't valid */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2107"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN2104"><span class='Ref_to_Parameter'>locale</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: invalid locale name \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2104"><span class='Ref_to_Parameter'>locale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If no relevant switch was given on command line, locale is an 
             * empty string, which is not too helpful to report.  Presumably 
             * setlocale() found something it did not like in the environment. 
             * Ideally we'd report the bad environment variable, but since 
             * setlocale's behavior is implementation-specific, it's hard to 
             * be sure what it didn't like.  Print a safe generic message. 
             */ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: invalid locale settings; check LANG and LC_* environment variables\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if res==NULL &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end check_locale_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * check if the chosen encoding matches the encoding required by the locale 
 * 
 * this should match the similar check in the backend createdb() function 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2168"></a><span class='Declare_Function'>check_locale_encoding</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>locale</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>user_enc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2170"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>locale_enc</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN2170"><span class='Ref_To_Local'>locale_enc</span></a> <span class='Operator'>= </span><a href="../../port/chklocale.c.html#LN309"><span class='Ref_to_Func'>pg_get_encoding_from_locale</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2168"><span class='Ref_to_Parameter'>locale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* See notes in createdb() to understand these tests */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN2170"><span class='Ref_To_Local'>locale_enc</span></a> <span class='Operator'>== </span><a href="initdb.c.html#LN2168"><span class='Ref_to_Parameter'>user_enc</span></a> <span class='Operator'>|| 
</span>          <a href="initdb.c.html#LN2170"><span class='Ref_To_Local'>locale_enc</span></a> <span class='Operator'>== </span><a href="../../include/mb/pg_wchar.h.html#LN237"><span class='Ref_to_EnumConst'>PG_SQL_ASCII</span></a> <span class='Operator'>|| 
</span>          <a href="initdb.c.html#LN2170"><span class='Ref_To_Local'>locale_enc</span></a> <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>|| 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
          <a href="initdb.c.html#LN2168"><span class='Ref_to_Parameter'>user_enc</span></a> <span class='Operator'>== </span><a href="../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a> <span class='Operator'>|| 
</span><span class='Directive'>#endif</span> 
          <a href="initdb.c.html#LN2168"><span class='Ref_to_Parameter'>user_enc</span></a> <span class='Operator'>== </span><a href="../../include/mb/pg_wchar.h.html#LN237"><span class='Ref_to_EnumConst'>PG_SQL_ASCII</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: encoding mismatch\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"The encoding you selected (%s) and the encoding that the\n"</span> 
              <span class='String'>"selected locale uses (%s) do not match.  This would lead to\n"</span> 
            <span class='String'>"misbehavior in various character string processing functions.\n"</span> 
               <span class='String'>"Rerun %s and either do not specify an encoding explicitly,\n"</span> 
                  <span class='String'>"or choose a matching combination.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2168"><span class='Ref_to_Parameter'>user_enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2170"><span class='Ref_To_Local'>locale_enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !(locale_enc==user_en... &raquo; </span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_locale_encoding &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * set up the locale variables 
 * 
 * assumes we have called setlocale(LC_ALL, "") -- see set_pglocale_pgservice 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2204"></a><span class='Declare_Function'>setlocales</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2206"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>canonname</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set empty lc_* values to locale config if set */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN122"><span class='Ref_to_Global_Var'>locale</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN122"><span class='Ref_to_Global_Var'>locale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN123"><span class='Ref_to_Global_Var'>lc_collate</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="initdb.c.html#LN123"><span class='Ref_to_Global_Var'>lc_collate</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN122"><span class='Ref_to_Global_Var'>locale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN126"><span class='Ref_to_Global_Var'>lc_numeric</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="initdb.c.html#LN126"><span class='Ref_to_Global_Var'>lc_numeric</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN122"><span class='Ref_to_Global_Var'>locale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN127"><span class='Ref_to_Global_Var'>lc_time</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="initdb.c.html#LN127"><span class='Ref_to_Global_Var'>lc_time</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN122"><span class='Ref_to_Global_Var'>locale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN125"><span class='Ref_to_Global_Var'>lc_monetary</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="initdb.c.html#LN125"><span class='Ref_to_Global_Var'>lc_monetary</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN122"><span class='Ref_to_Global_Var'>locale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN128"><span class='Ref_to_Global_Var'>lc_messages</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="initdb.c.html#LN128"><span class='Ref_to_Global_Var'>lc_messages</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN122"><span class='Ref_to_Global_Var'>locale</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * canonicalize locale names, and obtain any missing values from our 
     * current environment 
     */ 
</span> 
    <a href="initdb.c.html#LN265"><span class='Ref_to_Proto'>check_locale_name</span></a><span class='Parentheses'>(</span>LC_CTYPE<span class='Delimiter'>, </span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN265"><span class='Ref_to_Proto'>check_locale_name</span></a><span class='Parentheses'>(</span>LC_COLLATE<span class='Delimiter'>, </span><a href="initdb.c.html#LN123"><span class='Ref_to_Global_Var'>lc_collate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN123"><span class='Ref_to_Global_Var'>lc_collate</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN265"><span class='Ref_to_Proto'>check_locale_name</span></a><span class='Parentheses'>(</span>LC_NUMERIC<span class='Delimiter'>, </span><a href="initdb.c.html#LN126"><span class='Ref_to_Global_Var'>lc_numeric</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN126"><span class='Ref_to_Global_Var'>lc_numeric</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN265"><span class='Ref_to_Proto'>check_locale_name</span></a><span class='Parentheses'>(</span>LC_TIME<span class='Delimiter'>, </span><a href="initdb.c.html#LN127"><span class='Ref_to_Global_Var'>lc_time</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN127"><span class='Ref_to_Global_Var'>lc_time</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN265"><span class='Ref_to_Proto'>check_locale_name</span></a><span class='Parentheses'>(</span>LC_MONETARY<span class='Delimiter'>, </span><a href="initdb.c.html#LN125"><span class='Ref_to_Global_Var'>lc_monetary</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN125"><span class='Ref_to_Global_Var'>lc_monetary</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>LC_MESSAGES<span class='Parentheses'>) </span><span class='Operator'>&& !</span>defined<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a><span class='Parentheses'>) 
</span>    <a href="initdb.c.html#LN265"><span class='Ref_to_Proto'>check_locale_name</span></a><span class='Parentheses'>(</span>LC_MESSAGES<span class='Delimiter'>, </span><a href="initdb.c.html#LN128"><span class='Ref_to_Global_Var'>lc_messages</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN128"><span class='Ref_to_Global_Var'>lc_messages</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Comment_Multi_Line'>/* when LC_MESSAGES is not available, use the LC_CTYPE setting */ 
</span>    <a href="initdb.c.html#LN265"><span class='Ref_to_Proto'>check_locale_name</span></a><span class='Parentheses'>(</span>LC_CTYPE<span class='Delimiter'>, </span><a href="initdb.c.html#LN128"><span class='Ref_to_Global_Var'>lc_messages</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN128"><span class='Ref_to_Global_Var'>lc_messages</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN2206"><span class='Ref_To_Local'>canonname</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end setlocales &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * print help text 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2255"></a><span class='Declare_Function'>usage</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>progname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s initializes a PostgreSQL database cluster.\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN2255"><span class='Ref_to_Parameter'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Usage:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s [OPTION]... [DATADIR]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN2255"><span class='Ref_to_Parameter'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nOptions:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -A, --auth=METHOD         default authentication method for local connections\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"      --auth-host=METHOD    default authentication method for local TCP/IP connections\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"      --auth-local=METHOD   default authentication method for local-socket connections\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" [-D, --pgdata=]DATADIR     location for this database cluster\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -E, --encoding=ENCODING   set default encoding for new databases\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"      --locale=LOCALE       set default locale for new databases\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"      --lc-collate=, --lc-ctype=, --lc-messages=LOCALE\n"</span> 
             <span class='String'>"      --lc-monetary=, --lc-numeric=, --lc-time=LOCALE\n"</span> 
             <span class='String'>"                            set default locale in the respective category for\n"</span> 
             <span class='String'>"                            new databases (default taken from environment)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"      --no-locale           equivalent to --locale=C\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"      --pwfile=FILE         read password for the new superuser from file\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -T, --text-search-config=CFG\n"</span> 
         <span class='String'>"                            default text search configuration\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -U, --username=NAME       database superuser name\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -W, --pwprompt            prompt for a password for the new superuser\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -X, --waldir=WALDIR       location for the write-ahead log directory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nLess commonly used options:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -d, --debug               generate lots of debugging output\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -k, --data-checksums      use data page checksums\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -L DIRECTORY              where to find the input files\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -n, --no-clean            do not clean up after errors\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -N, --no-sync             do not wait for changes to be written safely to disk\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -s, --show                show internal settings\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -S, --sync-only           only sync data directory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nOther options:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -V, --version             output version information, then exit\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -?, --help                show this help, then exit\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nIf the data directory is not specified, the environment variable PGDATA\n"</span> 
             <span class='String'>"is used.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nReport bugs to &LT;pgsql-bugs@postgresql.org&GT;.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end usage &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2295"></a><span class='Declare_Function'>check_authmethod_unspecified</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>authmethod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN2295"><span class='Ref_to_Parameter'>authmethod</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strlen<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="initdb.c.html#LN2295"><span class='Ref_to_Parameter'>authmethod</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN182"><span class='Ref_to_Global_Var'>authwarning</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\nWARNING: enabling \"trust\" authentication for local connections\n"</span> 
                        <span class='String'>"You can change this by editing pg_hba.conf or using the option -A, or\n"</span> 
            <span class='String'>"--auth-local and --auth-host, the next time you run initdb.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="initdb.c.html#LN2295"><span class='Ref_to_Parameter'>authmethod</span></a> <span class='Operator'>= </span><span class='String'>"trust"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN2307"></a><span class='Declare_Function'>check_authmethod_valid</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>authmethod</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>valid_methods</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conntype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2309"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2309"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN2307"><span class='Ref_to_Parameter'>valid_methods</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="initdb.c.html#LN2309"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="initdb.c.html#LN2309"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2307"><span class='Ref_to_Parameter'>authmethod</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="initdb.c.html#LN2309"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* with space = param */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="initdb.c.html#LN2307"><span class='Ref_to_Parameter'>authmethod</span></a><span class='Delimiter'>, </span><span class='String'>' '</span><span class='Parentheses'>))</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2307"><span class='Ref_to_Parameter'>authmethod</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="initdb.c.html#LN2309"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="initdb.c.html#LN2307"><span class='Ref_to_Parameter'>authmethod</span></a> <span class='Operator'>- </span>strchr<span class='Parentheses'>(</span><a href="initdb.c.html#LN2307"><span class='Ref_to_Parameter'>authmethod</span></a><span class='Delimiter'>, </span><span class='String'>' '</span><span class='Parentheses'>)))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: invalid authentication method \"%s\" for \"%s\" connections\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2307"><span class='Ref_to_Parameter'>authmethod</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2307"><span class='Ref_to_Parameter'>conntype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN2327"></a><span class='Declare_Function'>check_need_password</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>authmethodlocal</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>authmethodhost</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodlocal</span></a><span class='Delimiter'>, </span><span class='String'>"md5"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>         strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodlocal</span></a><span class='Delimiter'>, </span><span class='String'>"password"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>         strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodlocal</span></a><span class='Delimiter'>, </span><span class='String'>"scram-sha-256"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodhost</span></a><span class='Delimiter'>, </span><span class='String'>"md5"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>         strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodhost</span></a><span class='Delimiter'>, </span><span class='String'>"password"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>         strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodhost</span></a><span class='Delimiter'>, </span><span class='String'>"scram-sha-256"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN131"><span class='Ref_to_Global_Var'>pwprompt</span></a> <span class='Operator'>|| </span><a href="initdb.c.html#LN132"><span class='Ref_to_Global_Var'>pwfilename</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: must specify a password for the superuser to enable %s authentication\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodlocal</span></a><span class='Delimiter'>, </span><span class='String'>"md5"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodlocal</span></a><span class='Delimiter'>, </span><span class='String'>"password"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodlocal</span></a><span class='Delimiter'>, </span><span class='String'>"scram-sha-256"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Operator'>? </span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodlocal</span></a> 
                <span class='Operator'>: </span><a href="initdb.c.html#LN2327"><span class='Ref_to_Parameter'>authmethodhost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end check_need_password &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN2349"></a><span class='Declare_Function'>setup_pgdata</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2351"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pgdata_get_env</span><span class='Delimiter'>, 
</span><a name="LN2352"></a>               <span class='Operator'>*</span><span class='Declare_Local'>pgdata_set_env</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN2351"><span class='Ref_To_Local'>pgdata_get_env</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGDATA"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2351"><span class='Ref_To_Local'>pgdata_get_env</span></a> <span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN2351"><span class='Ref_To_Local'>pgdata_get_env</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* PGDATA found */ 
</span>            <a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2351"><span class='Ref_To_Local'>pgdata_get_env</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"%s: no data directory specified\n"</span> 
                      <span class='String'>"You must identify the directory where the data for this database system\n"</span> 
                      <span class='String'>"will reside.  Do this with either the invocation option -D or the\n"</span> 
                      <span class='String'>"environment variable PGDATA.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="initdb.c.html#LN167"><span class='Ref_to_Global_Var'>pgdata_native</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * we have to set PGDATA for postgres rather than pass it on the command 
     * line to avoid dumb quoting problems on Windows, and we would especially 
     * need quotes otherwise on Windows because paths there are most likely to 
     * have embedded spaces. 
     */ 
</span>    <a href="initdb.c.html#LN2352"><span class='Ref_To_Local'>pgdata_set_env</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"PGDATA=%s"</span><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2352"><span class='Ref_To_Local'>pgdata_set_env</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_pgdata &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN2389"></a><span class='Declare_Function'>setup_bin_paths</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>argv0</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2391"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN2391"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN97"><span class='Ref_to_Proto'>find_other_exec</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2389"><span class='Ref_to_Parameter'>argv0</span></a><span class='Delimiter'>, </span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><a href="../../include/miscadmin.h.html#LN30"><span class='Ref_to_Const'>PG_BACKEND_VERSIONSTR</span></a><span class='Delimiter'>, 
</span>                               <a href="initdb.c.html#LN225"><span class='Ref_to_Global_Var'>backend_exec</span></a><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2396"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>full_path</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN96"><span class='Ref_to_Proto'>find_my_exec</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2389"><span class='Ref_to_Parameter'>argv0</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2396"><span class='Ref_To_Local'>full_path</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2396"><span class='Ref_To_Local'>full_path</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN2396"><span class='Ref_To_Local'>full_path</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2391"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"The program \"postgres\" is needed by %s "</span> 
                      <span class='String'>"but was not found in the\n"</span> 
                      <span class='String'>"same directory as \"%s\".\n"</span> 
                      <span class='String'>"Check your installation.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2396"><span class='Ref_To_Local'>full_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"The program \"postgres\" was found by \"%s\"\n"</span> 
                      <span class='String'>"but was not the same version as %s.\n"</span> 
                      <span class='String'>"Check your installation.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="initdb.c.html#LN2396"><span class='Ref_To_Local'>full_path</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (ret=find_other_exec(... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* store binary directory */ 
</span>    <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN224"><span class='Ref_to_Global_Var'>bin_path</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN225"><span class='Ref_to_Global_Var'>backend_exec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="../../include/port.h.html#LN38"><span class='Ref_to_Proto'>last_dir_separator</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN224"><span class='Ref_to_Global_Var'>bin_path</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN224"><span class='Ref_to_Global_Var'>bin_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="initdb.c.html#LN117"><span class='Ref_to_Global_Var'>share_path</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN117"><span class='Ref_to_Global_Var'>share_path</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port.h.html#LN50"><span class='Ref_to_Proto'>get_share_path</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN225"><span class='Ref_to_Global_Var'>backend_exec</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN117"><span class='Ref_to_Global_Var'>share_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port.h.html#LN76"><span class='Ref_to_Macro'>is_absolute_path</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN117"><span class='Ref_to_Global_Var'>share_path</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: input file location must be an absolute path\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN117"><span class='Ref_to_Global_Var'>share_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_bin_paths &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2437"></a><span class='Declare_Function'>setup_locale_encoding</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2439"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>user_enc</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN268"><span class='Ref_to_Proto'>setlocales</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN123"><span class='Ref_to_Global_Var'>lc_collate</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN127"><span class='Ref_to_Global_Var'>lc_time</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN126"><span class='Ref_to_Global_Var'>lc_numeric</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN125"><span class='Ref_to_Global_Var'>lc_monetary</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN128"><span class='Ref_to_Global_Var'>lc_messages</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"The database cluster will be initialized with locale \"%s\".\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"The database cluster will be initialized with locales\n"</span> 
                 <span class='String'>"  COLLATE:  %s\n"</span> 
                 <span class='String'>"  CTYPE:    %s\n"</span> 
                 <span class='String'>"  MESSAGES: %s\n"</span> 
                 <span class='String'>"  MONETARY: %s\n"</span> 
                 <span class='String'>"  NUMERIC:  %s\n"</span> 
                 <span class='String'>"  TIME:     %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="initdb.c.html#LN123"><span class='Ref_to_Global_Var'>lc_collate</span></a><span class='Delimiter'>, 
</span>               <a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Delimiter'>, 
</span>               <a href="initdb.c.html#LN128"><span class='Ref_to_Global_Var'>lc_messages</span></a><span class='Delimiter'>, 
</span>               <a href="initdb.c.html#LN125"><span class='Ref_to_Global_Var'>lc_monetary</span></a><span class='Delimiter'>, 
</span>               <a href="initdb.c.html#LN126"><span class='Ref_to_Global_Var'>lc_numeric</span></a><span class='Delimiter'>, 
</span>               <a href="initdb.c.html#LN127"><span class='Ref_to_Global_Var'>lc_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="../../test/regress/pg_regress.c.html#LN80"><span class='Ref_to_Global_Var'>encoding</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2468"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ctype_enc</span><span class='Delimiter'>; 
</span> 
        <a href="initdb.c.html#LN2468"><span class='Ref_To_Local'>ctype_enc</span></a> <span class='Operator'>= </span><a href="../../port/chklocale.c.html#LN309"><span class='Ref_to_Func'>pg_get_encoding_from_locale</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2468"><span class='Ref_To_Local'>ctype_enc</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Couldn't recognize the locale's codeset */ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not find suitable encoding for locale \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Rerun %s with the -E option.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/mb/pg_wchar.h.html#LN503"><span class='Ref_to_Proto'>pg_valid_server_encoding_id</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2468"><span class='Ref_To_Local'>ctype_enc</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We recognized it, but it's not a legal server encoding. On 
             * Windows, UTF-8 works with any locale, so we can fall back to 
             * UTF-8. 
             */ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Encoding \"%s\" implied by locale is not allowed as a server-side encoding.\n"</span> 
            <span class='String'>"The default database encoding will be set to \"%s\" instead.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2468"><span class='Ref_To_Local'>ctype_enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="initdb.c.html#LN2468"><span class='Ref_To_Local'>ctype_enc</span></a> <span class='Operator'>= </span><a href="../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Delimiter'>; 
</span>            <a href="initdb.c.html#LN147"><span class='Ref_to_Global_Var'>encodingid</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN626"><span class='Ref_to_Func'>encodingid_to_string</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2468"><span class='Ref_To_Local'>ctype_enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>               _<span class='Parentheses'>(</span><span class='String'>"%s: locale \"%s\" requires unsupported encoding \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Delimiter'>, </span><a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2468"><span class='Ref_To_Local'>ctype_enc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>              _<span class='Parentheses'>(</span><span class='String'>"Encoding \"%s\" is not allowed as a server-side encoding.\n"</span> 
                <span class='String'>"Rerun %s with a different locale selection.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2468"><span class='Ref_To_Local'>ctype_enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !pg_valid_server_enco... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="initdb.c.html#LN147"><span class='Ref_to_Global_Var'>encodingid</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN626"><span class='Ref_to_Func'>encodingid_to_string</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2468"><span class='Ref_To_Local'>ctype_enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"The default database encoding has accordingly been set to \"%s\".\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2468"><span class='Ref_To_Local'>ctype_enc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strlen(encoding)==0 &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="initdb.c.html#LN147"><span class='Ref_to_Global_Var'>encodingid</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN238"><span class='Ref_to_Proto'>get_encoding_id</span></a><span class='Parentheses'>(</span><a href="../../test/regress/pg_regress.c.html#LN80"><span class='Ref_to_Global_Var'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN2439"><span class='Ref_To_Local'>user_enc</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="initdb.c.html#LN147"><span class='Ref_to_Global_Var'>encodingid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="initdb.c.html#LN267"><span class='Ref_to_Proto'>check_locale_encoding</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2439"><span class='Ref_To_Local'>user_enc</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Operator'>!</span><a href="initdb.c.html#LN267"><span class='Ref_to_Proto'>check_locale_encoding</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN123"><span class='Ref_to_Global_Var'>lc_collate</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2439"><span class='Ref_To_Local'>user_enc</span></a><span class='Parentheses'>))</span> 
        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* check_locale_encoding printed the error */ 
</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end setup_locale_encoding &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN2526"></a><span class='Declare_Function'>setup_data_file_paths</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN148"><span class='Ref_to_Global_Var'>bki_file</span></a><span class='Delimiter'>, </span><span class='String'>"postgres.bki"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN149"><span class='Ref_to_Global_Var'>desc_file</span></a><span class='Delimiter'>, </span><span class='String'>"postgres.description"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN150"><span class='Ref_to_Global_Var'>shdesc_file</span></a><span class='Delimiter'>, </span><span class='String'>"postgres.shdescription"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN151"><span class='Ref_to_Global_Var'>hba_file</span></a><span class='Delimiter'>, </span><span class='String'>"pg_hba.conf.sample"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN152"><span class='Ref_to_Global_Var'>ident_file</span></a><span class='Delimiter'>, </span><span class='String'>"pg_ident.conf.sample"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN153"><span class='Ref_to_Global_Var'>conf_file</span></a><span class='Delimiter'>, </span><span class='String'>"postgresql.conf.sample"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN154"><span class='Ref_to_Global_Var'>conversion_file</span></a><span class='Delimiter'>, </span><span class='String'>"conversion_create.sql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN155"><span class='Ref_to_Global_Var'>dictionary_file</span></a><span class='Delimiter'>, </span><span class='String'>"snowball_create.sql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN156"><span class='Ref_to_Global_Var'>info_schema_file</span></a><span class='Delimiter'>, </span><span class='String'>"information_schema.sql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN157"><span class='Ref_to_Global_Var'>features_file</span></a><span class='Delimiter'>, </span><span class='String'>"sql_features.txt"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN239"><span class='Ref_to_Proto'>set_input</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN158"><span class='Ref_to_Global_Var'>system_views_file</span></a><span class='Delimiter'>, </span><span class='String'>"system_views.sql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN140"><span class='Ref_to_Global_Var'>show_setting</span></a> <span class='Operator'>|| </span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                <span class='String'>"VERSION=%s\n"</span> 
                <span class='String'>"PGDATA=%s\nshare_path=%s\nPGPATH=%s\n"</span> 
                <span class='String'>"POSTGRES_SUPERUSERNAME=%s\nPOSTGRES_BKI=%s\n"</span> 
                <span class='String'>"POSTGRES_DESCR=%s\nPOSTGRES_SHDESCR=%s\n"</span> 
                <span class='String'>"POSTGRESQL_CONF_SAMPLE=%s\n"</span> 
                <span class='String'>"PG_HBA_SAMPLE=%s\nPG_IDENT_SAMPLE=%s\n"</span><span class='Delimiter'>, 
</span>                PG_VERSION<span class='Delimiter'>, 
</span>                <a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN117"><span class='Ref_to_Global_Var'>share_path</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN224"><span class='Ref_to_Global_Var'>bin_path</span></a><span class='Delimiter'>, 
</span>                <a href="initdb.c.html#LN130"><span class='Ref_to_Global_Var'>username</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN148"><span class='Ref_to_Global_Var'>bki_file</span></a><span class='Delimiter'>, 
</span>                <a href="initdb.c.html#LN149"><span class='Ref_to_Global_Var'>desc_file</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN150"><span class='Ref_to_Global_Var'>shdesc_file</span></a><span class='Delimiter'>, 
</span>                <a href="initdb.c.html#LN153"><span class='Ref_to_Global_Var'>conf_file</span></a><span class='Delimiter'>, 
</span>                <a href="initdb.c.html#LN151"><span class='Ref_to_Global_Var'>hba_file</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN152"><span class='Ref_to_Global_Var'>ident_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN140"><span class='Ref_to_Global_Var'>show_setting</span></a><span class='Parentheses'>) 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN148"><span class='Ref_to_Global_Var'>bki_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN149"><span class='Ref_to_Global_Var'>desc_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN150"><span class='Ref_to_Global_Var'>shdesc_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN151"><span class='Ref_to_Global_Var'>hba_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN152"><span class='Ref_to_Global_Var'>ident_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN153"><span class='Ref_to_Global_Var'>conf_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN154"><span class='Ref_to_Global_Var'>conversion_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN155"><span class='Ref_to_Global_Var'>dictionary_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN156"><span class='Ref_to_Global_Var'>info_schema_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN157"><span class='Ref_to_Global_Var'>features_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN240"><span class='Ref_to_Proto'>check_input</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN158"><span class='Ref_to_Global_Var'>system_views_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_data_file_paths &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN2574"></a><span class='Declare_Function'>setup_text_search</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN129"><span class='Ref_to_Global_Var'>default_text_search_config</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN129"><span class='Ref_to_Global_Var'>default_text_search_config</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN703"><span class='Ref_to_Func'>find_matching_ts_config</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN129"><span class='Ref_to_Global_Var'>default_text_search_config</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not find suitable text search configuration for locale \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="initdb.c.html#LN129"><span class='Ref_to_Global_Var'>default_text_search_config</span></a> <span class='Operator'>= </span><span class='String'>"simple"</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2588"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>checkmatch</span> <span class='Operator'>= </span><a href="initdb.c.html#LN703"><span class='Ref_to_Func'>find_matching_ts_config</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2588"><span class='Ref_To_Local'>checkmatch</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: warning: suitable text search configuration for locale \"%s\" is unknown\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2588"><span class='Ref_To_Local'>checkmatch</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN129"><span class='Ref_to_Global_Var'>default_text_search_config</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: warning: specified text search configuration \"%s\" might not match locale \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN129"><span class='Ref_to_Global_Var'>default_text_search_config</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"The default text search configuration will be set to \"%s\".\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="initdb.c.html#LN129"><span class='Ref_to_Global_Var'>default_text_search_config</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end setup_text_search &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN2609"></a><span class='Declare_Function'>setup_signals</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* some of these are not valid on Windows */ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/port/win32.h.html#LN187"><span class='Ref_to_Const'>SIGHUP</span></a> 
    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN187"><span class='Ref_to_Const'>SIGHUP</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN261"><span class='Ref_to_Proto'>trapsig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> SIGINT 
    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span>SIGINT<span class='Delimiter'>, </span><a href="initdb.c.html#LN261"><span class='Ref_to_Proto'>trapsig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/port/win32.h.html#LN188"><span class='Ref_to_Const'>SIGQUIT</span></a> 
    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN188"><span class='Ref_to_Const'>SIGQUIT</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN261"><span class='Ref_to_Proto'>trapsig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> SIGTERM 
    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span>SIGTERM<span class='Delimiter'>, </span><a href="initdb.c.html#LN261"><span class='Ref_to_Proto'>trapsig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* Ignore SIGPIPE when writing to backend, so we can clean up */ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/port/win32.h.html#LN192"><span class='Ref_to_Const'>SIGPIPE</span></a> 
    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN192"><span class='Ref_to_Const'>SIGPIPE</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN184"><span class='Ref_to_Const'>SIG_IGN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* Prevent SIGSYS so we can probe for kernel calls that might not work */ 
</span><span class='Directive'>#ifdef</span> SIGSYS 
    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span>SIGSYS<span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN184"><span class='Ref_to_Const'>SIG_IGN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end setup_signals &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN2638"></a><span class='Declare_Function'>create_data_directory</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2640"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN2640"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../port/pgcheckdir.c.html#LN29"><span class='Ref_to_Func'>pg_check_dir</span></a><span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* PGDATA not there, must create it */ 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"creating directory %s ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgmkdirp.c.html#LN55"><span class='Ref_to_Func'>pg_mkdir_p</span></a><span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN427"><span class='Ref_to_Const'>S_IRWXU</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not create directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="../pg_upgrade/util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <a href="../pg_basebackup/pg_basebackup.c.html#LN96"><span class='Ref_to_Global_Var'>made_new_pgdata</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Present but empty, fix permissions and use it */ 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"fixing permissions on existing directory %s ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>chmod<span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN427"><span class='Ref_to_Const'>S_IRWXU</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not change permissions of directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="../pg_upgrade/util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <a href="../pg_basebackup/pg_basebackup.c.html#LN97"><span class='Ref_to_Global_Var'>found_existing_pgdata</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Present and not empty */ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"%s: directory \"%s\" exists but is not empty\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2640"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>!= </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>                <a href="initdb.c.html#LN278"><span class='Ref_to_Proto'>warn_on_mount_point</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2640"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                        _<span class='Parentheses'>(</span><span class='String'>"If you want to create a new database system, either remove or empty\n"</span> 
                          <span class='String'>"the directory \"%s\" or run %s\n"</span> 
                          <span class='String'>"with an argument other than \"%s\".\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* no further message needed */ 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Trouble accessing directory */ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not access directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch (ret=pg_check_dir(pg_... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end create_data_directory &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* Create WAL directory, and symlink if required */ 
</span><span class='Keyword'>void 
</span><a name="LN2708"></a><span class='Declare_Function'>create_xlog_or_symlink</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2710"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>subdirloc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* form name of the place for the subdirectory or symlink */ 
</span>    <a href="initdb.c.html#LN2710"><span class='Ref_To_Local'>subdirloc</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s/pg_wal"</span><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2717"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* clean up xlog directory name, check it's absolute */ 
</span>        <a href="../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port.h.html#LN76"><span class='Ref_to_Macro'>is_absolute_path</span></a><span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: WAL directory location must be an absolute path\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* check if the specified xlog directory exists/is empty */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN2717"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../port/pgcheckdir.c.html#LN29"><span class='Ref_to_Func'>pg_check_dir</span></a><span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* xlog directory not there, must create it */ 
</span>                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"creating directory %s ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgmkdirp.c.html#LN55"><span class='Ref_to_Func'>pg_mkdir_p</span></a><span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN427"><span class='Ref_to_Const'>S_IRWXU</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not create directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="../pg_upgrade/util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                <a href="../pg_basebackup/pg_basebackup.c.html#LN98"><span class='Ref_to_Global_Var'>made_new_xlogdir</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Present but empty, fix permissions and use it */ 
</span>                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"fixing permissions on existing directory %s ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>chmod<span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN427"><span class='Ref_to_Const'>S_IRWXU</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not change permissions of directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="../pg_upgrade/util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                <a href="../pg_basebackup/pg_basebackup.c.html#LN99"><span class='Ref_to_Global_Var'>found_existing_xlogdir</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Present and not empty */ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                        _<span class='Parentheses'>(</span><span class='String'>"%s: directory \"%s\" exists but is not empty\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2717"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>!= </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>                    <a href="initdb.c.html#LN278"><span class='Ref_to_Proto'>warn_on_mount_point</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2717"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                            _<span class='Parentheses'>(</span><span class='String'>"If you want to store the WAL there, either remove or empty the directory\n"</span> 
                              <span class='String'>"\"%s\".\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Trouble accessing directory */ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not access directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch (ret=pg_check_dir(xlo... &raquo; </span> 
 
<span class='Directive'>#ifdef</span> HAVE_SYMLINK 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN255"><span class='Ref_to_Macro'>symlink</span></a><span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2710"><span class='Ref_To_Local'>subdirloc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not create symbolic link \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2710"><span class='Ref_To_Local'>subdirloc</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#else</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: symlinks are not supported on this platform"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(xlog_dir,"")!=... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Without -X option, just make the subdirectory normally */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN56"><span class='Ref_to_Macro'>mkdir</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2710"><span class='Ref_To_Local'>subdirloc</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN427"><span class='Ref_to_Const'>S_IRWXU</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not create directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2710"><span class='Ref_To_Local'>subdirloc</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2710"><span class='Ref_To_Local'>subdirloc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end create_xlog_or_symlink &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN2817"></a><span class='Declare_Function'>warn_on_mount_point</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>error</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2817"><span class='Ref_to_Parameter'>error</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"It contains a dot-prefixed/invisible file, perhaps due to it being a mount point.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2817"><span class='Ref_to_Parameter'>error</span></a> <span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"It contains a lost+found directory, perhaps due to it being a mount point.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>            _<span class='Parentheses'>(</span><span class='String'>"Using a mount point directly as the data directory is not recommended.\n"</span> 
              <span class='String'>"Create a subdirectory under the mount point.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>void 
</span><a name="LN2833"></a><span class='Declare_Function'>initialize_data_directory</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="initdb.c.html#LN284"><span class='Ref_to_Const'>PG_CMD_DECL</span></a><span class='Delimiter'>; 
</span><a name="LN2836"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN274"><span class='Ref_to_Proto'>setup_signals</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    umask<span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN450"><span class='Ref_to_Const'>S_IRWXG</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN454"><span class='Ref_to_Const'>S_IRWXO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN276"><span class='Ref_to_Proto'>create_data_directory</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN277"><span class='Ref_to_Proto'>create_xlog_or_symlink</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create required subdirectories (other than pg_wal) */ 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"creating subdirectories ... "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2836"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN2836"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN561"><span class='Ref_to_Macro'>lengthof</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN197"><span class='Ref_to_Global_Var'>subdirs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="initdb.c.html#LN2836"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2852"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span> 
        <a href="initdb.c.html#LN2852"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s/%s"</span><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN197"><span class='Ref_to_Global_Var'>subdirs</span></a><span class='Delimiter'>[</span><a href="initdb.c.html#LN2836"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The parent directory already exists, so we only need mkdir() not 
         * pg_mkdir_p() here, which avoids some failure modes; cf bug #13853. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN56"><span class='Ref_to_Macro'>mkdir</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2852"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN427"><span class='Ref_to_Const'>S_IRWXU</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not create directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2852"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2852"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../pg_upgrade/util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Top level PG_VERSION is checked by bootstrapper, so make it first */ 
</span>    <a href="initdb.c.html#LN241"><span class='Ref_to_Proto'>write_version_file</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Select suitable configuration settings */ 
</span>    <a href="initdb.c.html#LN242"><span class='Ref_to_Proto'>set_null_conf</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN243"><span class='Ref_to_Proto'>test_config_settings</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now create all the text config files */ 
</span>    <a href="initdb.c.html#LN244"><span class='Ref_to_Proto'>setup_config</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Bootstrap template1 */ 
</span>    <a href="initdb.c.html#LN245"><span class='Ref_to_Proto'>bootstrap_template1</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make the per-database PG_VERSION for template1 only after init'ing it 
     */ 
</span>    <a href="initdb.c.html#LN241"><span class='Ref_to_Proto'>write_version_file</span></a><span class='Parentheses'>(</span><span class='String'>"base/1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the stuff we don't need to use bootstrap mode for, using a 
     * backend running in simple standalone mode. 
     */ 
</span>    <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"performing post-bootstrap initialization ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span>cmd<span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>cmd<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"\"%s\" %s template1 &GT;%s"</span><span class='Delimiter'>, 
</span>             <a href="initdb.c.html#LN225"><span class='Ref_to_Global_Var'>backend_exec</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN195"><span class='Ref_to_Global_Var'>backend_options</span></a><span class='Delimiter'>, 
</span>             <a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN286"><span class='Ref_to_Const'>PG_CMD_OPEN</span></a><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN246"><span class='Ref_to_Proto'>setup_auth</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN248"><span class='Ref_to_Proto'>setup_depend</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN249"><span class='Ref_to_Proto'>setup_sysviews</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN250"><span class='Ref_to_Proto'>setup_description</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN251"><span class='Ref_to_Proto'>setup_collation</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN252"><span class='Ref_to_Proto'>setup_conversion</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN253"><span class='Ref_to_Proto'>setup_dictionary</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN254"><span class='Ref_to_Proto'>setup_privileges</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN256"><span class='Ref_to_Proto'>setup_schema</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN257"><span class='Ref_to_Proto'>load_plpgsql</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN258"><span class='Ref_to_Proto'>vacuum_db</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN259"><span class='Ref_to_Proto'>make_template0</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN260"><span class='Ref_to_Proto'>make_postgres</span></a><span class='Parentheses'>(</span>cmdfd<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN293"><span class='Ref_to_Const'>PG_CMD_CLOSE</span></a><span class='Delimiter'>; 
</span> 
    <a href="../pg_upgrade/util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end initialize_data_directory &raquo; </span> 
 
 
<span class='Keyword'>int 
</span><a name="LN2937"></a><span class='Declare_Function'>main</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>argv</span><span class='Delimiter'>[]</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2939"></a>    <span class='Keyword'>static </span><span class='Control'>struct</span> <a href="../../include/getopt_long.h.html#LN15"><span class='Ref_to_Struct'>option</span></a> <span class='Declare_Local'>long_options</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"pgdata"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'D'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"encoding"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'E'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"locale"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"lc-collate"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"lc-ctype"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"lc-monetary"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"lc-numeric"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"lc-time"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"lc-messages"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-locale"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"text-search-config"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'T'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"auth"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'A'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"auth-local"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"auth-host"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"pwprompt"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'W'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"pwfile"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>9</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"username"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'U'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"help"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'?'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"version"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'V'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"debug"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"show"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'s'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"noclean"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'n'</span><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* for backwards compatibility */ 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-clean"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'n'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"nosync"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'N'</span><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* for backwards compatibility */ 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-sync"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'N'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"sync-only"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'S'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"waldir"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'X'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"data-checksums"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'k'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * options with no short version return a low integer, the rest return 
     * their short version value 
     */ 
</span><a name="LN2975"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN2976"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>option_index</span><span class='Delimiter'>; 
</span><a name="LN2977"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>effective_user</span><span class='Delimiter'>; 
</span><a name="LN2978"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>start_db_cmd</span><span class='Delimiter'>; 
</span><a name="LN2979"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>pg_ctl_path</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ensure that buffering behavior of stdout and stderr matches what it is 
     * in interactive usage (at least on most platforms).  This prevents 
     * unexpected output ordering when, eg, output is redirected to a file. 
     * POSIX says we must do this before any other usage of these files. 
     */ 
</span>    setvbuf<span class='Parentheses'>(</span>stdout<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/port.h.html#LN339"><span class='Ref_to_Const'>PG_IOLBF</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    setvbuf<span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span>_IONBF<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN49"><span class='Ref_to_Proto'>get_progname</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN93"><span class='Ref_to_Proto'>set_pglocale_pgservice</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="../../include/c.h.html#LN1009"><span class='Ref_to_Macro'>PG_TEXTDOMAIN</span></a><span class='Parentheses'>(</span><span class='String'>"initdb"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--help"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"-?"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../psql/help.h.html#LN10"><span class='Ref_to_Proto'>usage</span></a><span class='Parentheses'>(</span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--version"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"-V"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            puts<span class='Parentheses'>(</span><span class='String'>"initdb (PostgreSQL) "</span> PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* process command-line options */ 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="initdb.c.html#LN2975"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="../../include/getopt_long.h.html#LN30"><span class='Ref_to_Proto'>getopt_long</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>, </span><span class='String'>"dD:E:kL:nNU:WA:sST:X:"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN2939"><span class='Ref_To_Local'>long_options</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="initdb.c.html#LN2976"><span class='Ref_To_Local'>option_index</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN2975"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'A'</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN135"><span class='Ref_to_Global_Var'>authmethodlocal</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN134"><span class='Ref_to_Global_Var'>authmethodhost</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * When ident is specified, use peer for local connections. 
                 * Mirrored, when peer is specified, use ident for TCP/IP 
                 * connections. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN134"><span class='Ref_to_Global_Var'>authmethodhost</span></a><span class='Delimiter'>, </span><span class='String'>"ident"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="initdb.c.html#LN135"><span class='Ref_to_Global_Var'>authmethodlocal</span></a> <span class='Operator'>= </span><span class='String'>"peer"</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN135"><span class='Ref_to_Global_Var'>authmethodlocal</span></a><span class='Delimiter'>, </span><span class='String'>"peer"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="initdb.c.html#LN134"><span class='Ref_to_Global_Var'>authmethodhost</span></a> <span class='Operator'>= </span><span class='String'>"ident"</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>10</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN135"><span class='Ref_to_Global_Var'>authmethodlocal</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>11</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN134"><span class='Ref_to_Global_Var'>authmethodhost</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>: 
</span>                <a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>: 
</span>                <a href="../../test/regress/pg_regress.c.html#LN80"><span class='Ref_to_Global_Var'>encoding</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'W'</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN131"><span class='Ref_to_Global_Var'>pwprompt</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'U'</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN130"><span class='Ref_to_Global_Var'>username</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>                <a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Running in debug mode.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>: 
</span>                <a href="../pg_basebackup/pg_basebackup.c.html#LN81"><span class='Ref_to_Global_Var'>noclean</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Running in no-clean mode.  Mistakes will not be cleaned up.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'N'</span><span class='Operator'>: 
</span>                <a href="../pg_basebackup/pg_basebackup.c.html#LN88"><span class='Ref_to_Global_Var'>do_sync</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN139"><span class='Ref_to_Global_Var'>sync_only</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'k'</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN141"><span class='Ref_to_Global_Var'>data_checksums</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'L'</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN117"><span class='Ref_to_Global_Var'>share_path</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN122"><span class='Ref_to_Global_Var'>locale</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN123"><span class='Ref_to_Global_Var'>lc_collate</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN124"><span class='Ref_to_Global_Var'>lc_ctype</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN125"><span class='Ref_to_Global_Var'>lc_monetary</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>5</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN126"><span class='Ref_to_Global_Var'>lc_numeric</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>6</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN127"><span class='Ref_to_Global_Var'>lc_time</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>7</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN128"><span class='Ref_to_Global_Var'>lc_messages</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>8</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN122"><span class='Ref_to_Global_Var'>locale</span></a> <span class='Operator'>= </span><span class='String'>"C"</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>9</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN132"><span class='Ref_to_Global_Var'>pwfilename</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN140"><span class='Ref_to_Global_Var'>show_setting</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'T'</span><span class='Operator'>: 
</span>                <a href="initdb.c.html#LN129"><span class='Ref_to_Global_Var'>default_text_search_config</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'X'</span><span class='Operator'>: 
</span>                <a href="../pg_basebackup/pg_basebackup.c.html#LN78"><span class='Ref_to_Global_Var'>xlog_dir</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* getopt_long already emitted a complaint */ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch c &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (c=getopt_long(argc,a... &raquo; </span> 
 
 
    <span class='Comment_Multi_Line'>/* 
     * Non-option argument specifies data directory as long as it wasn't 
     * already specified with -D / --pgdata 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>&LT; </span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>&LT; </span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: too many command-line arguments (first is \"%s\")\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If we only need to fsync, just do it and exit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN139"><span class='Ref_to_Global_Var'>sync_only</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="initdb.c.html#LN270"><span class='Ref_to_Proto'>setup_pgdata</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* must check that directory is readable */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgcheckdir.c.html#LN29"><span class='Ref_to_Func'>pg_check_dir</span></a><span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not access directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"syncing data to disk ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/file_utils.h.html#LN19"><span class='Ref_to_Proto'>fsync_pgdata</span></a><span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span>PG_VERSION_NUM<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_upgrade/util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN131"><span class='Ref_to_Global_Var'>pwprompt</span></a> <span class='Operator'>&& </span><a href="initdb.c.html#LN132"><span class='Ref_to_Global_Var'>pwfilename</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: password prompt and password file cannot be specified together\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="initdb.c.html#LN2294"><span class='Ref_to_Func'>check_authmethod_unspecified</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN135"><span class='Ref_to_Global_Var'>authmethodlocal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN2294"><span class='Ref_to_Func'>check_authmethod_unspecified</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="initdb.c.html#LN134"><span class='Ref_to_Global_Var'>authmethodhost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN2306"><span class='Ref_to_Func'>check_authmethod_valid</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN135"><span class='Ref_to_Global_Var'>authmethodlocal</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN100"><span class='Ref_to_Global_Var'>auth_methods_local</span></a><span class='Delimiter'>, </span><span class='String'>"local"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="initdb.c.html#LN2306"><span class='Ref_to_Func'>check_authmethod_valid</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN134"><span class='Ref_to_Global_Var'>authmethodhost</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN78"><span class='Ref_to_Global_Var'>auth_methods_host</span></a><span class='Delimiter'>, </span><span class='String'>"host"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN2326"><span class='Ref_to_Func'>check_need_password</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN135"><span class='Ref_to_Global_Var'>authmethodlocal</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN134"><span class='Ref_to_Global_Var'>authmethodhost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/restricted_token.h.html#LN16"><span class='Ref_to_Proto'>get_restricted_token</span></a><span class='Parentheses'>(</span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN270"><span class='Ref_to_Proto'>setup_pgdata</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN271"><span class='Ref_to_Proto'>setup_bin_paths</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN2977"><span class='Ref_To_Local'>effective_user</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN237"><span class='Ref_to_Proto'>get_id</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="initdb.c.html#LN130"><span class='Ref_to_Global_Var'>username</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="initdb.c.html#LN130"><span class='Ref_to_Global_Var'>username</span></a> <span class='Operator'>= </span><a href="initdb.c.html#LN2977"><span class='Ref_To_Local'>effective_user</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="initdb.c.html#LN130"><span class='Ref_to_Global_Var'>username</span></a><span class='Delimiter'>, </span><span class='String'>"pg_"</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: superuser name \"%s\" is disallowed; role names cannot begin with \"pg_\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN130"><span class='Ref_to_Global_Var'>username</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"The files belonging to this database system will be owned "</span> 
             <span class='String'>"by user \"%s\".\n"</span> 
             <span class='String'>"This user must also own the server process.\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="initdb.c.html#LN2977"><span class='Ref_To_Local'>effective_user</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN255"><span class='Ref_to_Proto'>set_info_version</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN272"><span class='Ref_to_Proto'>setup_data_file_paths</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN273"><span class='Ref_to_Proto'>setup_locale_encoding</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN275"><span class='Ref_to_Proto'>setup_text_search</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN141"><span class='Ref_to_Global_Var'>data_checksums</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Data page checksums are enabled.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Data page checksums are disabled.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN131"><span class='Ref_to_Global_Var'>pwprompt</span></a> <span class='Operator'>|| </span><a href="initdb.c.html#LN132"><span class='Ref_to_Global_Var'>pwfilename</span></a><span class='Parentheses'>) 
</span>        <a href="initdb.c.html#LN247"><span class='Ref_to_Proto'>get_su_pwd</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="initdb.c.html#LN279"><span class='Ref_to_Proto'>initialize_data_directory</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_basebackup.c.html#LN88"><span class='Ref_to_Global_Var'>do_sync</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"syncing data to disk ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/file_utils.h.html#LN19"><span class='Ref_to_Proto'>fsync_pgdata</span></a><span class='Parentheses'>(</span><a href="../pg_ctl/pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span>PG_VERSION_NUM<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_upgrade/util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nSync to disk skipped.\nThe data directory might become corrupt if the operating system crashes.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="initdb.c.html#LN182"><span class='Ref_to_Global_Var'>authwarning</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="initdb.c.html#LN182"><span class='Ref_to_Global_Var'>authwarning</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build up a shell command to tell the user how to start the server 
     */ 
</span>    <a href="initdb.c.html#LN2978"><span class='Ref_To_Local'>start_db_cmd</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get directory specification used to start initdb ... */ 
</span>    <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2979"><span class='Ref_To_Local'>pg_ctl_path</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2937"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="initdb.c.html#LN2979"><span class='Ref_To_Local'>pg_ctl_path</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2979"><span class='Ref_To_Local'>pg_ctl_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN62"><span class='Ref_to_Proto'>get_parent_directory</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2979"><span class='Ref_To_Local'>pg_ctl_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* ... and tag on pg_ctl instead */ 
</span>    <a href="../../include/port.h.html#LN40"><span class='Ref_to_Proto'>join_path_components</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2979"><span class='Ref_To_Local'>pg_ctl_path</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2979"><span class='Ref_To_Local'>pg_ctl_path</span></a><span class='Delimiter'>, </span><span class='String'>"pg_ctl"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* path to pg_ctl, properly quoted */ 
</span>    <a href="../../include/fe_utils/string_utils.h.html#LN43"><span class='Ref_to_Proto'>appendShellString</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2978"><span class='Ref_To_Local'>start_db_cmd</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN2979"><span class='Ref_To_Local'>pg_ctl_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* add -D switch, with properly quoted data directory */ 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2978"><span class='Ref_To_Local'>start_db_cmd</span></a><span class='Delimiter'>, </span><span class='String'>" -D "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/fe_utils/string_utils.h.html#LN43"><span class='Ref_to_Proto'>appendShellString</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2978"><span class='Ref_To_Local'>start_db_cmd</span></a><span class='Delimiter'>, </span><a href="initdb.c.html#LN167"><span class='Ref_to_Global_Var'>pgdata_native</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* add suggested -l switch and "start" command */ 
</span>    <span class='Comment_Multi_Line'>/* translator: This is a placeholder in a shell command. */ 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2978"><span class='Ref_To_Local'>start_db_cmd</span></a><span class='Delimiter'>, </span><span class='String'>" -l %s start"</span><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"logfile"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nSuccess. You can now start the database server using:\n\n"</span> 
             <span class='String'>"    %s\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="initdb.c.html#LN2978"><span class='Ref_To_Local'>start_db_cmd</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="initdb.c.html#LN2978"><span class='Ref_To_Local'>start_db_cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end main &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>