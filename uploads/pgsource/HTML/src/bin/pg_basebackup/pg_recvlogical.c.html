<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_basebackup\pg_recvlogical.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_basebackup\pg_recvlogical.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:59 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_recvlogical.c - receive data from a logical decoding slot in a streaming 
 *                    fashion and write it to a local file. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *        src/bin/pg_basebackup/pg_recvlogical.c 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;dirent.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
<span class='Directive'>#ifdef</span> HAVE_SYS_SELECT_H 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/select.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* local includes */ 
</span><span class='Keyword'>#include </span><span class='String'>"streamutil.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/xlog_internal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/fe_memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"getopt_long.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq-fe.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqsignal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pqexpbuffer.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* Time to sleep between reconnection attempts */ 
</span><a name="LN33"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>RECONNECT_SLEEP_TIME</span> <span class='Number'>5</span> 
 
<span class='Comment_Multi_Line'>/* Global Options */ 
</span><a name="LN36"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>outfile</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN37"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>verbose</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN38"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>noloop</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN39"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>standby_message_timeout</span> <span class='Operator'>= </span><span class='Number'>10</span> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* 10 sec = default */ 
</span><a name="LN40"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>fsync_interval</span> <span class='Operator'>= </span><span class='Number'>10</span> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* 10 sec = default */ 
</span><a name="LN41"></a><span class='Keyword'>static </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Var'>startpos</span> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN42"></a><span class='Keyword'>static </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Var'>endpos</span> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>do_create_slot</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN44"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>slot_exists_ok</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN45"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>do_start_slot</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN46"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>do_drop_slot</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>replication_slot</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* filled pairwise with option, value. value may be NULL */ 
</span><a name="LN50"></a><span class='Keyword'>static char </span><span class='Operator'>**</span><span class='Declare_Var'>options</span><span class='Delimiter'>; 
</span><a name="LN51"></a><span class='Keyword'>static </span>size_t <span class='Declare_Var'>noptions</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN52"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>plugin</span> <span class='Operator'>= </span><span class='String'>"test_decoding"</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Global State */ 
</span><a name="LN55"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>outfd</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN56"></a><span class='Keyword'>static volatile </span>sig_atomic_t <span class='Declare_Var'>time_to_abort</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN57"></a><span class='Keyword'>static volatile </span>sig_atomic_t <span class='Declare_Var'>output_reopen</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN58"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>output_isfile</span><span class='Delimiter'>; 
</span><a name="LN59"></a><span class='Keyword'>static </span><a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Var'>output_last_fsync</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN60"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>output_needs_fsync</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN61"></a><span class='Keyword'>static </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Var'>output_written_lsn</span> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN62"></a><span class='Keyword'>static </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Var'>output_fsync_lsn</span> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span> 
<a name="LN64"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>usage</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN65"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>StreamLogicalLog</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN66"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>disconnect_and_exit</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN67"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>flushAndSendFeedback</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>now</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN68"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>prepareToTerminate</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>endpos</span><span class='Delimiter'>, 
</span><a name="LN69"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>keepalive</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>lsn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static void 
</span><a name="LN72"></a><span class='Declare_Function'>usage</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s controls PostgreSQL logical decoding streams.\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Usage:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s [OPTION]...\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nAction to be performed:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"      --create-slot      create a new replication slot (for the slot's name see --slot)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"      --drop-slot        drop the replication slot (for the slot's name see --slot)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"      --start            start streaming in a replication slot (for the slot's name see --slot)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nOptions:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -E, --endpos=LSN       exit after receiving the specified LSN\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -f, --file=FILE        receive log into this file, - for stdout\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -F  --fsync-interval=SECS\n"</span> 
             <span class='String'>"                         time between fsyncs to the output file (default: %d)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN40"><span class='Ref_to_Global_Var'>fsync_interval</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"      --if-not-exists    do not error if slot already exists when creating a slot\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -I, --startpos=LSN     where in an existing slot should the streaming start\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -n, --no-loop          do not loop on connection lost\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -o, --option=NAME[=VALUE]\n"</span> 
             <span class='String'>"                         pass option NAME with optional value VALUE to the\n"</span> 
             <span class='String'>"                         output plugin\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -P, --plugin=PLUGIN    use output plugin PLUGIN (default: %s)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN52"><span class='Ref_to_Global_Var'>plugin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -s, --status-interval=SECS\n"</span> 
             <span class='String'>"                         time between status packets sent to server (default: %d)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN37"><span class='Ref_to_Global_Var'>standby_message_timeout</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -S, --slot=SLOTNAME    name of the logical replication slot\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -v, --verbose          output verbose messages\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -V, --version          output version information, then exit\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -?, --help             show this help, then exit\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nConnection options:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -d, --dbname=DBNAME    database to connect to\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -h, --host=HOSTNAME    database server host or socket directory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -p, --port=PORT        database server port number\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -U, --username=NAME    connect as specified database user\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -w, --no-password      never prompt for password\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -W, --password         force password prompt (should happen automatically)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nReport bugs to &LT;pgsql-bugs@postgresql.org&GT;.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end usage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Send a Standby Status Update message to server. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN114"></a><span class='Declare_Function'>sendFeedback</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>now</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>force</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>replyRequested</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN116"></a>    <span class='Keyword'>static </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Local'>last_written_lsn</span> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN117"></a>    <span class='Keyword'>static </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Local'>last_fsync_lsn</span> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span> 
<a name="LN119"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>replybuf</span><span class='Delimiter'>[</span><span class='Number'>1</span> <span class='Operator'>+ </span><span class='Number'>8</span> <span class='Operator'>+ </span><span class='Number'>8</span> <span class='Operator'>+ </span><span class='Number'>8</span> <span class='Operator'>+ </span><span class='Number'>8</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN120"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * we normally don't want to send superfluous feedbacks, but if it's 
     * because of a timeout we need to, otherwise wal_sender_timeout will kill 
     * us. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN114"><span class='Ref_to_Parameter'>force</span></a> <span class='Operator'>&& 
</span>        <a href="pg_recvlogical.c.html#LN116"><span class='Ref_To_Local'>last_written_lsn</span></a> <span class='Operator'>== </span><a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a> <span class='Operator'>&& 
</span>        <a href="pg_recvlogical.c.html#LN117"><span class='Ref_To_Local'>last_fsync_lsn</span></a> <span class='Operator'>!= </span><a href="pg_recvlogical.c.html#LN62"><span class='Ref_to_Global_Var'>output_fsync_lsn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>           _<span class='Parentheses'>(</span><span class='String'>"%s: confirming write up to %X/%X, flush to %X/%X (slot %s)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_recvlogical.c.html#LN62"><span class='Ref_to_Global_Var'>output_fsync_lsn</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_recvlogical.c.html#LN62"><span class='Ref_to_Global_Var'>output_fsync_lsn</span></a><span class='Delimiter'>, 
</span>                <a href="pg_receivewal.c.html#LN43"><span class='Ref_to_Global_Var'>replication_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_recvlogical.c.html#LN119"><span class='Ref_To_Local'>replybuf</span></a><span class='Delimiter'>[</span><a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'r'</span><span class='Delimiter'>; 
</span>    <a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="streamutil.h.html#LN47"><span class='Ref_to_Proto'>fe_sendint64</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN119"><span class='Ref_To_Local'>replybuf</span></a><span class='Delimiter'>[</span><a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* write */ 
</span>    <a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="streamutil.h.html#LN47"><span class='Ref_to_Proto'>fe_sendint64</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN62"><span class='Ref_to_Global_Var'>output_fsync_lsn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN119"><span class='Ref_To_Local'>replybuf</span></a><span class='Delimiter'>[</span><a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* flush */ 
</span>    <a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="streamutil.h.html#LN47"><span class='Ref_to_Proto'>fe_sendint64</span></a><span class='Parentheses'>(</span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN119"><span class='Ref_To_Local'>replybuf</span></a><span class='Delimiter'>[</span><a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* apply */ 
</span>    <a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="streamutil.h.html#LN47"><span class='Ref_to_Proto'>fe_sendint64</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN114"><span class='Ref_to_Parameter'>now</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN119"><span class='Ref_To_Local'>replybuf</span></a><span class='Delimiter'>[</span><a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* sendTime */ 
</span>    <a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="pg_recvlogical.c.html#LN119"><span class='Ref_To_Local'>replybuf</span></a><span class='Delimiter'>[</span><a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN114"><span class='Ref_to_Parameter'>replyRequested</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* replyRequested */ 
</span>    <a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="pg_recvlogical.c.html#LN41"><span class='Ref_to_Global_Var'>startpos</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a><span class='Delimiter'>; 
</span>    <a href="pg_recvlogical.c.html#LN116"><span class='Ref_To_Local'>last_written_lsn</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a><span class='Delimiter'>; 
</span>    <a href="pg_recvlogical.c.html#LN117"><span class='Ref_To_Local'>last_fsync_lsn</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN62"><span class='Ref_to_Global_Var'>output_fsync_lsn</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN431"><span class='Ref_to_Proto'>PQputCopyData</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN114"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN119"><span class='Ref_To_Local'>replybuf</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN120"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN451"><span class='Ref_to_Proto'>PQflush</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN114"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not send feedback packet: %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN114"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end sendFeedback &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN168"></a><span class='Declare_Function'>disconnect_and_exit</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN168"><span class='Ref_to_Parameter'>code</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN177"></a><span class='Declare_Function'>OutputFsync</span><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>now</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_recvlogical.c.html#LN59"><span class='Ref_to_Global_Var'>output_last_fsync</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN177"><span class='Ref_to_Parameter'>now</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_recvlogical.c.html#LN62"><span class='Ref_to_Global_Var'>output_fsync_lsn</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN40"><span class='Ref_to_Global_Var'>fsync_interval</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN60"><span class='Ref_to_Global_Var'>output_needs_fsync</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="pg_recvlogical.c.html#LN60"><span class='Ref_to_Global_Var'>output_needs_fsync</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* can only fsync if it's a regular file */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN58"><span class='Ref_to_Global_Var'>output_isfile</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN61"><span class='Ref_to_Macro'>fsync</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: could not fsync log file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end OutputFsync &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Start the log streaming 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN210"></a><span class='Declare_Function'>StreamLogicalLog</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN212"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN213"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>copybuf</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN214"></a>    <a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>last_status</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN215"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN216"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span> 
    <a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span>    <a href="pg_recvlogical.c.html#LN62"><span class='Ref_to_Global_Var'>output_fsync_lsn</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Connect in replication mode to the server 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>) 
</span>        <a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a> <span class='Operator'>= </span><a href="streamutil.h.html#LN30"><span class='Ref_to_Proto'>GetConnection</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Comment_Multi_Line'>/* Error message already written in GetConnection() */ 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start the replication 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: starting log streaming at %X/%X (slot %s)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_recvlogical.c.html#LN41"><span class='Ref_to_Global_Var'>startpos</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_recvlogical.c.html#LN41"><span class='Ref_to_Global_Var'>startpos</span></a><span class='Delimiter'>, 
</span>                <a href="pg_receivewal.c.html#LN43"><span class='Ref_to_Global_Var'>replication_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initiate the replication stream at specified location */ 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"START_REPLICATION SLOT \"%s\" LOGICAL %X/%X"</span><span class='Delimiter'>, 
</span>             <a href="pg_receivewal.c.html#LN43"><span class='Ref_to_Global_Var'>replication_slot</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_recvlogical.c.html#LN41"><span class='Ref_to_Global_Var'>startpos</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_recvlogical.c.html#LN41"><span class='Ref_to_Global_Var'>startpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* print options if there are any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN51"><span class='Ref_to_Global_Var'>noptions</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>" ("</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN215"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_recvlogical.c.html#LN215"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_recvlogical.c.html#LN51"><span class='Ref_to_Global_Var'>noptions</span></a><span class='Delimiter'>; </span><a href="pg_recvlogical.c.html#LN215"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* separator */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN215"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* write option name */ 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"\"%s\""</span><span class='Delimiter'>, </span><a href="../../../contrib/oid2name/oid2name.c.html#LN25"><span class='Ref_to_Struct'>options</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN215"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* write option value if specified */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../contrib/oid2name/oid2name.c.html#LN25"><span class='Ref_to_Struct'>options</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN215"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>" '%s'"</span><span class='Delimiter'>, </span><a href="../../../contrib/oid2name/oid2name.c.html#LN25"><span class='Ref_to_Struct'>options</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN215"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN51"><span class='Ref_to_Global_Var'>noptions</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>')'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_recvlogical.c.html#LN212"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN212"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN96"><span class='Ref_to_EnumConst'>PGRES_COPY_BOTH</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not send replication command \"%s\": %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN468"><span class='Ref_to_Proto'>PQresultErrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN212"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN212"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN212"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: streaming initiated\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_receivewal.c.html#LN38"><span class='Ref_to_Global_Var'>time_to_abort</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN284"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span><a name="LN285"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>bytes_left</span><span class='Delimiter'>; 
</span><a name="LN286"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>bytes_written</span><span class='Delimiter'>; 
</span><a name="LN287"></a>        <a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>now</span><span class='Delimiter'>; 
</span><a name="LN288"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>hdr_len</span><span class='Delimiter'>; 
</span><a name="LN289"></a>        <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>cur_record_lsn</span> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN504"><span class='Ref_to_Proto'>PQfreemem</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Potentially send a status message to the master 
         */ 
</span>        <a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a> <span class='Operator'>= </span><a href="streamutil.h.html#LN41"><span class='Ref_to_Proto'>feGetCurrentTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span> <span class='Operator'>&& 
</span>            <a href="streamutil.h.html#LN45"><span class='Ref_to_Proto'>feTimestampDifferenceExceeds</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN59"><span class='Ref_to_Global_Var'>output_last_fsync</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>, 
</span>                                         <a href="pg_recvlogical.c.html#LN40"><span class='Ref_to_Global_Var'>fsync_interval</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN176"><span class='Ref_to_Func'>OutputFsync</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN37"><span class='Ref_to_Global_Var'>standby_message_timeout</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="streamutil.h.html#LN45"><span class='Ref_to_Proto'>feTimestampDifferenceExceeds</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN214"><span class='Ref_To_Local'>last_status</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>, 
</span>                                         <a href="pg_receivewal.c.html#LN37"><span class='Ref_to_Global_Var'>standby_message_timeout</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Time to send feedback! */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN113"><span class='Ref_to_Func'>sendFeedback</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
            <a href="pg_recvlogical.c.html#LN214"><span class='Ref_To_Local'>last_status</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* got SIGHUP, close output file */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="pg_recvlogical.c.html#LN57"><span class='Ref_to_Global_Var'>output_reopen</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a><span class='Delimiter'>, </span><span class='String'>"-"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a> <span class='Operator'>= </span><a href="streamutil.h.html#LN41"><span class='Ref_to_Proto'>feGetCurrentTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN176"><span class='Ref_to_Func'>OutputFsync</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_recvlogical.c.html#LN57"><span class='Ref_to_Global_Var'>output_reopen</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* open the output file, if not open yet */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN335"></a>            <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>statbuf</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a><span class='Delimiter'>, </span><span class='String'>"-"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a> <span class='Operator'>= </span>fileno<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a><span class='Delimiter'>, </span>O_CREAT <span class='Operator'>| </span>O_APPEND <span class='Operator'>| </span>O_WRONLY <span class='Operator'>| </span><a href="../../include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/port/win32.h.html#LN424"><span class='Ref_to_Const'>S_IRUSR</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN425"><span class='Ref_to_Const'>S_IWUSR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                        _<span class='Parentheses'>(</span><span class='String'>"%s: could not open log file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>fstat<span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN335"><span class='Ref_To_Local'>statbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                        _<span class='Parentheses'>(</span><span class='String'>"%s: could not stat file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="pg_recvlogical.c.html#LN58"><span class='Ref_to_Global_Var'>output_isfile</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN430"><span class='Ref_to_Macro'>S_ISREG</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN335"><span class='Ref_To_Local'>statbuf</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>) </span><span class='Operator'>&& !</span>isatty<span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if outfd==-1 &raquo; </span> 
 
        <a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN433"><span class='Ref_to_Proto'>PQgetCopyData</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * In async mode, and no data available. We block on reading but 
             * not more than the specified timeout, so that we can send a 
             * response back to the client. 
             */ 
</span><a name="LN366"></a>            fd_set      <span class='Declare_Local'>input_mask</span><span class='Delimiter'>; 
</span><a name="LN367"></a>            <a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>message_target</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN368"></a>            <a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>fsync_target</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN369"></a>            <span class='Control'>struct</span> timeval <span class='Declare_Local'>timeout</span><span class='Delimiter'>; 
</span><a name="LN370"></a>            <span class='Control'>struct</span> timeval <span class='Operator'>*</span><span class='Declare_Local'>timeoutptr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN324"><span class='Ref_to_Proto'>PQsocket</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                        _<span class='Parentheses'>(</span><span class='String'>"%s: invalid socket: %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            FD_ZERO<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN366"><span class='Ref_To_Local'>input_mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            FD_SET<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN324"><span class='Ref_to_Proto'>PQsocket</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN366"><span class='Ref_To_Local'>input_mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Compute when we need to wakeup to send a keepalive message. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN37"><span class='Ref_to_Global_Var'>standby_message_timeout</span></a><span class='Parentheses'>) 
</span>                <a href="pg_recvlogical.c.html#LN367"><span class='Ref_To_Local'>message_target</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN214"><span class='Ref_To_Local'>last_status</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN37"><span class='Ref_to_Global_Var'>standby_message_timeout</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                    <span class='Parentheses'>((</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Compute when we need to wakeup to fsync the output file. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN40"><span class='Ref_to_Global_Var'>fsync_interval</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_recvlogical.c.html#LN60"><span class='Ref_to_Global_Var'>output_needs_fsync</span></a><span class='Parentheses'>) 
</span>                <a href="pg_recvlogical.c.html#LN368"><span class='Ref_To_Local'>fsync_target</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN59"><span class='Ref_to_Global_Var'>output_last_fsync</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN40"><span class='Ref_to_Global_Var'>fsync_interval</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                    <span class='Parentheses'>((</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Now compute when to wakeup. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN367"><span class='Ref_To_Local'>message_target</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pg_recvlogical.c.html#LN368"><span class='Ref_To_Local'>fsync_target</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN396"></a>                <a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>targettime</span><span class='Delimiter'>; 
</span><a name="LN397"></a>                <span class='Keyword'>long</span>        <span class='Declare_Local'>secs</span><span class='Delimiter'>; 
</span><a name="LN398"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>usecs</span><span class='Delimiter'>; 
</span> 
                <a href="pg_recvlogical.c.html#LN396"><span class='Ref_To_Local'>targettime</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN367"><span class='Ref_To_Local'>message_target</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN368"><span class='Ref_To_Local'>fsync_target</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_recvlogical.c.html#LN368"><span class='Ref_To_Local'>fsync_target</span></a> <span class='Operator'>&LT; </span><a href="pg_recvlogical.c.html#LN396"><span class='Ref_To_Local'>targettime</span></a><span class='Parentheses'>) 
</span>                    <a href="pg_recvlogical.c.html#LN396"><span class='Ref_To_Local'>targettime</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN368"><span class='Ref_To_Local'>fsync_target</span></a><span class='Delimiter'>; 
</span> 
                <a href="streamutil.h.html#LN42"><span class='Ref_to_Proto'>feTimestampDifference</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>, 
</span>                                      <a href="pg_recvlogical.c.html#LN396"><span class='Ref_To_Local'>targettime</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN397"><span class='Ref_To_Local'>secs</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN398"><span class='Ref_To_Local'>usecs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN397"><span class='Ref_To_Local'>secs</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="pg_recvlogical.c.html#LN369"><span class='Ref_To_Local'>timeout</span></a><span class='Operator'>.</span>tv_sec <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* Always sleep at least 1 sec */ 
</span>                <span class='Control'>else</span> 
                    <a href="pg_recvlogical.c.html#LN369"><span class='Ref_To_Local'>timeout</span></a><span class='Operator'>.</span>tv_sec <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN397"><span class='Ref_To_Local'>secs</span></a><span class='Delimiter'>; 
</span>                <a href="pg_recvlogical.c.html#LN369"><span class='Ref_To_Local'>timeout</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN398"><span class='Ref_To_Local'>usecs</span></a><span class='Delimiter'>; 
</span>                <a href="pg_recvlogical.c.html#LN370"><span class='Ref_To_Local'>timeoutptr</span></a> <span class='Operator'>= &</span><a href="pg_recvlogical.c.html#LN369"><span class='Ref_To_Local'>timeout</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if message_target&GT;0||fsy... &raquo; </span> 
 
            <a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN373"><span class='Ref_to_Macro'>select</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN324"><span class='Ref_to_Proto'>PQsocket</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN366"><span class='Ref_To_Local'>input_mask</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN370"><span class='Ref_To_Local'>timeoutptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span>errno <span class='Operator'>== </span><a href="../../interfaces/libpq/win32.h.html#LN17"><span class='Ref_to_Const'>EINTR</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Got a timeout or signal. Continue the loop and either 
                 * deliver a status packet to the server or just go back into 
                 * blocking. 
                 */ 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: select() failed: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Else there is actually data on the socket */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN425"><span class='Ref_to_Proto'>PQconsumeInput</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                        _<span class='Parentheses'>(</span><span class='String'>"%s: could not receive data from WAL stream: %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if r==0 &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* End of copy stream */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Failure while reading the copy stream */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== -</span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not read COPY data: %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Check the message type. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'k'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN460"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>pos</span><span class='Delimiter'>; 
</span><a name="LN461"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>replyRequested</span><span class='Delimiter'>; 
</span><a name="LN462"></a>            <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>walEnd</span><span class='Delimiter'>; 
</span><a name="LN463"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>endposReached</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Parse the keepalive message, enclosed in the CopyData message. 
             * We just check if the server requested a reply, and ignore the 
             * rest. 
             */ 
</span>            <a href="pg_recvlogical.c.html#LN460"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* skip msgtype 'k' */ 
</span>            <a href="pg_recvlogical.c.html#LN462"><span class='Ref_To_Local'>walEnd</span></a> <span class='Operator'>= </span><a href="streamutil.h.html#LN48"><span class='Ref_to_Proto'>fe_recvint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a><span class='Delimiter'>[</span><a href="pg_recvlogical.c.html#LN460"><span class='Ref_To_Local'>pos</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN462"><span class='Ref_To_Local'>walEnd</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_recvlogical.c.html#LN460"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* read walEnd */ 
</span> 
            <a href="pg_recvlogical.c.html#LN460"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* skip sendTime */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><a href="pg_recvlogical.c.html#LN460"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: streaming header too small: %d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="pg_recvlogical.c.html#LN461"><span class='Ref_To_Local'>replyRequested</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a><span class='Delimiter'>[</span><a href="pg_recvlogical.c.html#LN460"><span class='Ref_To_Local'>pos</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a> <span class='Operator'>!= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a> <span class='Operator'>&& </span><a href="pg_recvlogical.c.html#LN462"><span class='Ref_To_Local'>walEnd</span></a> <span class='Operator'>&GT;= </span><a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If there's nothing to read on the socket until a keepalive 
                 * we know that the server has nothing to send us; and if 
                 * walEnd has passed endpos, we know nothing else can have 
                 * committed before endpos.  So we can bail out now. 
                 */ 
</span>                <a href="pg_recvlogical.c.html#LN463"><span class='Ref_To_Local'>endposReached</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Send a reply, if necessary */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN461"><span class='Ref_To_Local'>replyRequested</span></a> <span class='Operator'>|| </span><a href="pg_recvlogical.c.html#LN463"><span class='Ref_To_Local'>endposReached</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN67"><span class='Ref_to_Proto'>flushAndSendFeedback</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>                <a href="pg_recvlogical.c.html#LN214"><span class='Ref_To_Local'>last_status</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN463"><span class='Ref_To_Local'>endposReached</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_recvlogical.c.html#LN68"><span class='Ref_to_Proto'>prepareToTerminate</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_receivewal.c.html#LN38"><span class='Ref_to_Global_Var'>time_to_abort</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if copybuf[0]=='k' &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'w'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: unrecognized streaming header: \"%c\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Read the header of the XLogData message, enclosed in the CopyData 
         * message. We only need the WAL location field (dataStart), the rest 
         * of the header is ignored. 
         */ 
</span>        <a href="pg_recvlogical.c.html#LN288"><span class='Ref_To_Local'>hdr_len</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* msgtype 'w' */ 
</span>        <a href="pg_recvlogical.c.html#LN288"><span class='Ref_To_Local'>hdr_len</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* dataStart */ 
</span>        <a href="pg_recvlogical.c.html#LN288"><span class='Ref_To_Local'>hdr_len</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* walEnd */ 
</span>        <a href="pg_recvlogical.c.html#LN288"><span class='Ref_To_Local'>hdr_len</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* sendTime */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><a href="pg_recvlogical.c.html#LN288"><span class='Ref_To_Local'>hdr_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: streaming header too small: %d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Extract WAL location for this block */ 
</span>        <a href="pg_recvlogical.c.html#LN289"><span class='Ref_To_Local'>cur_record_lsn</span></a> <span class='Operator'>= </span><a href="streamutil.h.html#LN48"><span class='Ref_to_Proto'>fe_recvint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a> <span class='Operator'>!= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a> <span class='Operator'>&& </span><a href="pg_recvlogical.c.html#LN289"><span class='Ref_To_Local'>cur_record_lsn</span></a> <span class='Operator'>&GT; </span><a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We've read past our endpoint, so prepare to go away being 
             * cautious about what happens to our output data. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN67"><span class='Ref_to_Proto'>flushAndSendFeedback</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <a href="pg_recvlogical.c.html#LN68"><span class='Ref_to_Proto'>prepareToTerminate</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN289"><span class='Ref_To_Local'>cur_record_lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_receivewal.c.html#LN38"><span class='Ref_to_Global_Var'>time_to_abort</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN289"><span class='Ref_To_Local'>cur_record_lsn</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN61"><span class='Ref_to_Global_Var'>output_written_lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_recvlogical.c.html#LN285"><span class='Ref_To_Local'>bytes_left</span></a> <span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN284"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>- </span><a href="pg_recvlogical.c.html#LN288"><span class='Ref_To_Local'>hdr_len</span></a><span class='Delimiter'>; 
</span>        <a href="pg_recvlogical.c.html#LN286"><span class='Ref_To_Local'>bytes_written</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* signal that a fsync is needed */ 
</span>        <a href="pg_recvlogical.c.html#LN60"><span class='Ref_to_Global_Var'>output_needs_fsync</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN285"><span class='Ref_To_Local'>bytes_left</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN563"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
            <a href="pg_recvlogical.c.html#LN563"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/win32.h.html#LN13"><span class='Ref_to_Macro'>write</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a><span class='Delimiter'>, 
</span>                        <a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a> <span class='Operator'>+ </span><a href="pg_recvlogical.c.html#LN288"><span class='Ref_To_Local'>hdr_len</span></a> <span class='Operator'>+ </span><a href="pg_recvlogical.c.html#LN286"><span class='Ref_To_Local'>bytes_written</span></a><span class='Delimiter'>, 
</span>                        <a href="pg_recvlogical.c.html#LN285"><span class='Ref_To_Local'>bytes_left</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN563"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                  _<span class='Parentheses'>(</span><span class='String'>"%s: could not write %u bytes to log file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN285"><span class='Ref_To_Local'>bytes_left</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a><span class='Delimiter'>, 
</span>                        <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Write was successful, advance our position */ 
</span>            <a href="pg_recvlogical.c.html#LN286"><span class='Ref_To_Local'>bytes_written</span></a> <span class='Operator'>+= </span><a href="pg_recvlogical.c.html#LN563"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
</span>            <a href="pg_recvlogical.c.html#LN285"><span class='Ref_To_Local'>bytes_left</span></a> <span class='Operator'>-= </span><a href="pg_recvlogical.c.html#LN563"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while bytes_left &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/win32.h.html#LN13"><span class='Ref_to_Macro'>write</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                  _<span class='Parentheses'>(</span><span class='String'>"%s: could not write %u bytes to log file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a><span class='Delimiter'>, 
</span>                    <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a> <span class='Operator'>!= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a> <span class='Operator'>&& </span><a href="pg_recvlogical.c.html#LN289"><span class='Ref_To_Local'>cur_record_lsn</span></a> <span class='Operator'>== </span><a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* endpos was exactly the record we just processed, we're done */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN67"><span class='Ref_to_Proto'>flushAndSendFeedback</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN287"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <a href="pg_recvlogical.c.html#LN68"><span class='Ref_to_Proto'>prepareToTerminate</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN289"><span class='Ref_To_Local'>cur_record_lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_receivewal.c.html#LN38"><span class='Ref_to_Global_Var'>time_to_abort</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !time_to_abort &raquo; </span> 
 
    <a href="pg_recvlogical.c.html#LN212"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN212"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN90"><span class='Ref_to_EnumConst'>PGRES_COPY_OUT</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We're doing a client-initiated clean exit and have sent CopyDone to 
         * the server. We've already sent replay confirmation and fsync'd so 
         * we can just clean up the connection now. 
         */ 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN212"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: unexpected termination of replication stream: %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN468"><span class='Ref_to_Proto'>PQresultErrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN212"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_recvlogical.c.html#LN634"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN212"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a><span class='Delimiter'>, </span><span class='String'>"-"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN624"></a>        <a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>t</span> <span class='Operator'>= </span><a href="streamutil.h.html#LN41"><span class='Ref_to_Proto'>feGetCurrentTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* no need to jump to error on failure here, we're finishing anyway */ 
</span>        <a href="pg_recvlogical.c.html#LN176"><span class='Ref_to_Func'>OutputFsync</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN624"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not close file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_recvlogical.c.html#LN55"><span class='Ref_to_Global_Var'>outfd</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN634"></a><span class='Label'>error</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN504"><span class='Ref_to_Proto'>PQfreemem</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_recvlogical.c.html#LN213"><span class='Ref_To_Local'>copybuf</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN216"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end StreamLogicalLog &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Unfortunately we can't do sensible signal handling on windows... 
 */ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
<span class='Comment_Multi_Line'>/* 
 * When sigint is called, just tell the system to exit at the next possible 
 * moment. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN655"></a><span class='Declare_Function'>sigint_handler</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>signum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_receivewal.c.html#LN38"><span class='Ref_to_Global_Var'>time_to_abort</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Trigger the output file to be reopened. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN664"></a><span class='Declare_Function'>sighup_handler</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>signum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_recvlogical.c.html#LN57"><span class='Ref_to_Global_Var'>output_reopen</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
 
<span class='Keyword'>int 
</span><a name="LN672"></a><span class='Declare_Function'>main</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>argv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN674"></a>    <span class='Keyword'>static </span><span class='Control'>struct</span> <a href="../../include/getopt_long.h.html#LN15"><span class='Ref_to_Struct'>option</span></a> <span class='Declare_Local'>long_options</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span><span class='Comment_Multi_Line'>/* general options */ 
</span>        <span class='Delimiter'>{</span><span class='String'>"file"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'f'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"fsync-interval"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'F'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-loop"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'n'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"verbose"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'v'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"version"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'V'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"help"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'?'</span><span class='Delimiter'>}, 
</span><span class='Comment_Multi_Line'>/* connection options */ 
</span>        <span class='Delimiter'>{</span><span class='String'>"dbname"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"host"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'h'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"port"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'p'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"username"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'U'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-password"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'w'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"password"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'W'</span><span class='Delimiter'>}, 
</span><span class='Comment_Multi_Line'>/* replication options */ 
</span>        <span class='Delimiter'>{</span><span class='String'>"startpos"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'I'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"endpos"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'E'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"option"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'o'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"plugin"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'P'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"status-interval"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'s'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"slot"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'S'</span><span class='Delimiter'>}, 
</span><span class='Comment_Multi_Line'>/* action */ 
</span>        <span class='Delimiter'>{</span><span class='String'>"create-slot"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"start"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"drop-slot"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"if-not-exists"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span><a name="LN703"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN704"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>option_index</span><span class='Delimiter'>; 
</span><a name="LN705"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>hi</span><span class='Delimiter'>, 
</span><a name="LN706"></a>                <span class='Declare_Local'>lo</span><span class='Delimiter'>; 
</span><a name="LN707"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>db_name</span><span class='Delimiter'>; 
</span> 
    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN49"><span class='Ref_to_Proto'>get_progname</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN93"><span class='Ref_to_Proto'>set_pglocale_pgservice</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="../../include/c.h.html#LN1009"><span class='Ref_to_Macro'>PG_TEXTDOMAIN</span></a><span class='Parentheses'>(</span><span class='String'>"pg_basebackup"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--help"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"-?"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../psql/help.h.html#LN10"><span class='Ref_to_Proto'>usage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"-V"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--version"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            puts<span class='Parentheses'>(</span><span class='String'>"pg_recvlogical (PostgreSQL) "</span> PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_recvlogical.c.html#LN703"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="../../include/getopt_long.h.html#LN30"><span class='Ref_to_Proto'>getopt_long</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>, </span><span class='String'>"E:f:F:nvd:h:p:U:wWI:o:P:s:S:"</span><span class='Delimiter'>, 
</span>                            <a href="pg_recvlogical.c.html#LN674"><span class='Ref_To_Local'>long_options</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN704"><span class='Ref_To_Local'>option_index</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN703"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><span class='Comment_Multi_Line'>/* general options */ 
</span>            <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>: 
</span>                <a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'F'</span><span class='Operator'>: 
</span>                <a href="pg_recvlogical.c.html#LN40"><span class='Ref_to_Global_Var'>fsync_interval</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN40"><span class='Ref_to_Global_Var'>fsync_interval</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: invalid fsync interval \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>: 
</span>                <a href="pg_receivewal.c.html#LN36"><span class='Ref_to_Global_Var'>noloop</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'v'</span><span class='Operator'>: 
</span>                <a href="pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span><span class='Comment_Multi_Line'>/* connection options */ 
</span>            <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>                <a href="streamutil.c.html#LN37"><span class='Ref_to_Global_Var'>dbname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'h'</span><span class='Operator'>: 
</span>                <a href="streamutil.c.html#LN34"><span class='Ref_to_Global_Var'>dbhost</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: invalid port number \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="streamutil.c.html#LN36"><span class='Ref_to_Global_Var'>dbport</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'U'</span><span class='Operator'>: 
</span>                <a href="streamutil.c.html#LN35"><span class='Ref_to_Global_Var'>dbuser</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'w'</span><span class='Operator'>: 
</span>                <a href="streamutil.c.html#LN38"><span class='Ref_to_Global_Var'>dbgetpassword</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'W'</span><span class='Operator'>: 
</span>                <a href="streamutil.c.html#LN38"><span class='Ref_to_Global_Var'>dbgetpassword</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span><span class='Comment_Multi_Line'>/* replication options */ 
</span>            <span class='Control'>case</span> <span class='String'>'I'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>sscanf<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"%X/%X"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN705"><span class='Ref_To_Local'>hi</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN706"><span class='Ref_To_Local'>lo</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                            _<span class='Parentheses'>(</span><span class='String'>"%s: could not parse start position \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pg_recvlogical.c.html#LN41"><span class='Ref_to_Global_Var'>startpos</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pg_recvlogical.c.html#LN705"><span class='Ref_To_Local'>hi</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>32</span> <span class='Operator'>| </span><a href="pg_recvlogical.c.html#LN706"><span class='Ref_To_Local'>lo</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>sscanf<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"%X/%X"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN705"><span class='Ref_To_Local'>hi</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN706"><span class='Ref_To_Local'>lo</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                            _<span class='Parentheses'>(</span><span class='String'>"%s: could not parse end position \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pg_recvlogical.c.html#LN705"><span class='Ref_To_Local'>hi</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>32</span> <span class='Operator'>| </span><a href="pg_recvlogical.c.html#LN706"><span class='Ref_To_Local'>lo</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'o'</span><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN799"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN800"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN799"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='String'>'='</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN800"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* remove =; separate data from val */ 
</span>                        <span class='Operator'>*</span><a href="pg_recvlogical.c.html#LN800"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                        <a href="pg_recvlogical.c.html#LN800"><span class='Ref_To_Local'>val</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <a href="pg_recvlogical.c.html#LN51"><span class='Ref_to_Global_Var'>noptions</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="../../../contrib/oid2name/oid2name.c.html#LN25"><span class='Ref_to_Struct'>options</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN28"><span class='Ref_to_Proto'>pg_realloc</span></a><span class='Parentheses'>(</span><a href="../../../contrib/oid2name/oid2name.c.html#LN25"><span class='Ref_to_Struct'>options</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pg_recvlogical.c.html#LN51"><span class='Ref_to_Global_Var'>noptions</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="../../../contrib/oid2name/oid2name.c.html#LN25"><span class='Ref_to_Struct'>options</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN51"><span class='Ref_to_Global_Var'>noptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN799"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../contrib/oid2name/oid2name.c.html#LN25"><span class='Ref_to_Struct'>options</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN51"><span class='Ref_to_Global_Var'>noptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_recvlogical.c.html#LN800"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>: 
</span>                <a href="pg_recvlogical.c.html#LN52"><span class='Ref_to_Global_Var'>plugin</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>: 
</span>                <a href="pg_receivewal.c.html#LN37"><span class='Ref_to_Global_Var'>standby_message_timeout</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN37"><span class='Ref_to_Global_Var'>standby_message_timeout</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: invalid status interval \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span>                <a href="pg_receivewal.c.html#LN43"><span class='Ref_to_Global_Var'>replication_slot</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span><span class='Comment_Multi_Line'>/* action */ 
</span>            <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>                <a href="pg_receivewal.c.html#LN39"><span class='Ref_to_Global_Var'>do_create_slot</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>                <a href="pg_recvlogical.c.html#LN45"><span class='Ref_to_Global_Var'>do_start_slot</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>                <a href="pg_receivewal.c.html#LN41"><span class='Ref_to_Global_Var'>do_drop_slot</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>                <a href="pg_receivewal.c.html#LN40"><span class='Ref_to_Global_Var'>slot_exists_ok</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * getopt_long already emitted a complaint 
                 */ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch c &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (c=getopt_long(argc,a... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Any non-option arguments? 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>&LT; </span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: too many command-line arguments (first is \"%s\")\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN672"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Required arguments 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN43"><span class='Ref_to_Global_Var'>replication_slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: no slot specified\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN45"><span class='Ref_to_Global_Var'>do_start_slot</span></a> <span class='Operator'>&& </span><a href="pg_recvlogical.c.html#LN36"><span class='Ref_to_Global_Var'>outfile</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: no target file specified\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_receivewal.c.html#LN41"><span class='Ref_to_Global_Var'>do_drop_slot</span></a> <span class='Operator'>&& </span><a href="streamutil.c.html#LN37"><span class='Ref_to_Global_Var'>dbname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: no database specified\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_receivewal.c.html#LN41"><span class='Ref_to_Global_Var'>do_drop_slot</span></a> <span class='Operator'>&& !</span><a href="pg_receivewal.c.html#LN39"><span class='Ref_to_Global_Var'>do_create_slot</span></a> <span class='Operator'>&& !</span><a href="pg_recvlogical.c.html#LN45"><span class='Ref_to_Global_Var'>do_start_slot</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: at least one action needs to be specified\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN41"><span class='Ref_to_Global_Var'>do_drop_slot</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN39"><span class='Ref_to_Global_Var'>do_create_slot</span></a> <span class='Operator'>|| </span><a href="pg_recvlogical.c.html#LN45"><span class='Ref_to_Global_Var'>do_start_slot</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: cannot use --create-slot or --start together with --drop-slot\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN41"><span class='Ref_to_Global_Var'>startpos</span></a> <span class='Operator'>!= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN39"><span class='Ref_to_Global_Var'>do_create_slot</span></a> <span class='Operator'>|| </span><a href="pg_receivewal.c.html#LN41"><span class='Ref_to_Global_Var'>do_drop_slot</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: cannot use --create-slot or --drop-slot together with --startpos\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN42"><span class='Ref_to_Global_Var'>endpos</span></a> <span class='Operator'>!= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a> <span class='Operator'>&& !</span><a href="pg_recvlogical.c.html#LN45"><span class='Ref_to_Global_Var'>do_start_slot</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: --endpos may only be specified with --start\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span>SIGINT<span class='Delimiter'>, </span><a href="pg_receivewal.c.html#LN446"><span class='Ref_to_Func'>sigint_handler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN187"><span class='Ref_to_Const'>SIGHUP</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN663"><span class='Ref_to_Func'>sighup_handler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Obtain a connection to server. This is not really necessary but it 
     * helps to get more precise error messages about authentication, required 
     * GUC parameters and such. 
     */ 
</span>    <a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a> <span class='Operator'>= </span><a href="streamutil.h.html#LN30"><span class='Ref_to_Proto'>GetConnection</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Comment_Multi_Line'>/* Error message already written in GetConnection() */ 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Run IDENTIFY_SYSTEM to make sure we connected using a database specific 
     * replication connection. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="streamutil.h.html#LN37"><span class='Ref_to_Proto'>RunIdentifySystem</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_recvlogical.c.html#LN707"><span class='Ref_To_Local'>db_name</span></a><span class='Parentheses'>))</span> 
        <a href="pg_receivewal.c.html#LN54"><span class='Ref_to_Macro'>disconnect_and_exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN707"><span class='Ref_To_Local'>db_name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: could not establish database-specific replication connection\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_receivewal.c.html#LN54"><span class='Ref_to_Macro'>disconnect_and_exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Drop a replication slot. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN41"><span class='Ref_to_Global_Var'>do_drop_slot</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"%s: dropping replication slot \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_receivewal.c.html#LN43"><span class='Ref_to_Global_Var'>replication_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="streamutil.h.html#LN36"><span class='Ref_to_Proto'>DropReplicationSlot</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><a href="pg_receivewal.c.html#LN43"><span class='Ref_to_Global_Var'>replication_slot</span></a><span class='Parentheses'>))</span> 
            <a href="pg_receivewal.c.html#LN54"><span class='Ref_to_Macro'>disconnect_and_exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Create a replication slot. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN39"><span class='Ref_to_Global_Var'>do_create_slot</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"%s: creating replication slot \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_receivewal.c.html#LN43"><span class='Ref_to_Global_Var'>replication_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="streamutil.h.html#LN33"><span class='Ref_to_Proto'>CreateReplicationSlot</span></a><span class='Parentheses'>(</span><a href="../pg_rewind/libpq_fetch.c.html#LN31"><span class='Ref_to_Global_Var'>conn</span></a><span class='Delimiter'>, </span><a href="pg_receivewal.c.html#LN43"><span class='Ref_to_Global_Var'>replication_slot</span></a><span class='Delimiter'>, </span><a href="pg_recvlogical.c.html#LN52"><span class='Ref_to_Global_Var'>plugin</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="pg_receivewal.c.html#LN40"><span class='Ref_to_Global_Var'>slot_exists_ok</span></a><span class='Parentheses'>))</span> 
            <a href="pg_receivewal.c.html#LN54"><span class='Ref_to_Macro'>disconnect_and_exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_recvlogical.c.html#LN41"><span class='Ref_to_Global_Var'>startpos</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN45"><span class='Ref_to_Global_Var'>do_start_slot</span></a><span class='Parentheses'>) 
</span>        <a href="pg_receivewal.c.html#LN54"><span class='Ref_to_Macro'>disconnect_and_exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Stream loop */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_recvlogical.c.html#LN65"><span class='Ref_to_Proto'>StreamLogicalLog</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN38"><span class='Ref_to_Global_Var'>time_to_abort</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We've been Ctrl-C'ed or reached an exit limit condition. That's 
             * not an error, so exit without an errorcode. 
             */ 
</span>            <a href="pg_receivewal.c.html#LN54"><span class='Ref_to_Macro'>disconnect_and_exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN36"><span class='Ref_to_Global_Var'>noloop</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: disconnected\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>            <span class='Comment_Multi_Line'>/* translator: check source for value for %d */ 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"%s: disconnected; waiting %d seconds to try again\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_receivewal.c.html#LN30"><span class='Ref_to_Const'>RECONNECT_SLEEP_TIME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN30"><span class='Ref_to_Const'>RECONNECT_SLEEP_TIME</span></a> <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while true &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end main &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Fsync our output data, and send a feedback message to the server.  Returns 
 * true if successful, false otherwise. 
 * 
 * If successful, *now is updated to the current timestamp just before sending 
 * feedback. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1026"></a><span class='Declare_Function'>flushAndSendFeedback</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>now</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* flush data to disk, so that we send a recent flush pointer */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN176"><span class='Ref_to_Func'>OutputFsync</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_recvlogical.c.html#LN1026"><span class='Ref_to_Parameter'>now</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="pg_recvlogical.c.html#LN1026"><span class='Ref_to_Parameter'>now</span></a> <span class='Operator'>= </span><a href="streamutil.h.html#LN41"><span class='Ref_to_Proto'>feGetCurrentTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_recvlogical.c.html#LN113"><span class='Ref_to_Func'>sendFeedback</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN1026"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="pg_recvlogical.c.html#LN1026"><span class='Ref_to_Parameter'>now</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Try to inform the server about of upcoming demise, but don't wait around or 
 * retry on failure. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1043"></a><span class='Declare_Function'>prepareToTerminate</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>endpos</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>keepalive</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>lsn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN432"><span class='Ref_to_Proto'>PQputCopyEnd</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN1043"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN451"><span class='Ref_to_Proto'>PQflush</span></a><span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN1043"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_recvlogical.c.html#LN1043"><span class='Ref_to_Parameter'>keepalive</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: endpos %X/%X reached by keepalive\n"</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_recvlogical.c.html#LN1043"><span class='Ref_to_Parameter'>endpos</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_recvlogical.c.html#LN1043"><span class='Ref_to_Parameter'>endpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: endpos %X/%X reached by record at %X/%X\n"</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_recvlogical.c.html#LN1043"><span class='Ref_to_Parameter'>endpos</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_recvlogical.c.html#LN1043"><span class='Ref_to_Parameter'>endpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_recvlogical.c.html#LN1043"><span class='Ref_to_Parameter'>lsn</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_recvlogical.c.html#LN1043"><span class='Ref_to_Parameter'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Delimiter'>} 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>