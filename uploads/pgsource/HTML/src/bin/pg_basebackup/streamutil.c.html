<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_basebackup\streamutil.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_basebackup\streamutil.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:59 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * streamutil.c - utility functions for pg_basebackup and pg_receivelog 
 * 
 * Author: Magnus Hagander &LT;magnus@hagander.net&GT; 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *        src/bin/pg_basebackup/streamutil.c 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/time.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Comment_Multi_Line'>/* for ntohl/htonl */ 
</span><span class='Keyword'>#include </span><span class='String'>&LT;netinet/in.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;arpa/inet.h&GT;</span> 
 
<span class='Comment_Multi_Line'>/* local includes */ 
</span><span class='Keyword'>#include </span><span class='String'>"receivelog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"streamutil.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"pqexpbuffer.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/fe_memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"datatype/timestamp.h"</span> 
 
<a name="LN30"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ERRCODE_DUPLICATE_OBJECT</span>  <span class='String'>"42710"</span> 
 
<a name="LN32"></a><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Var'>progname</span><span class='Delimiter'>; 
</span><a name="LN33"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>connection_string</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN34"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>dbhost</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN35"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>dbuser</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN36"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>dbport</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN37"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>dbname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN38"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>dbgetpassword</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* 0=auto, -1=never, 1=always */ 
</span><a name="LN39"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>have_password</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN40"></a><span class='Keyword'>static char </span><span class='Declare_Var'>password</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span><a name="LN41"></a><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Var'>conn</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Connect to the server. Returns a valid PGconn pointer if connected, 
 * or NULL on non-permanent error. On permanent error, the function will 
 * call exit(1) directly. 
 */ 
</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>* 
</span><a name="LN49"></a><span class='Declare_Function'>GetConnection</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN51"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>tmpconn</span><span class='Delimiter'>; 
</span><a name="LN52"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>argcount</span> <span class='Operator'>= </span><span class='Number'>7</span><span class='Delimiter'>;</span>   <span class='Comment_Multi_Line'>/* dbname, replication, fallback_app_name, 
                                 * host, user, port, password */ 
</span><a name="LN54"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN55"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Local'>keywords</span><span class='Delimiter'>; 
</span><a name="LN56"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN57"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tmpparam</span><span class='Delimiter'>; 
</span><a name="LN58"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>need_password</span><span class='Delimiter'>; 
</span><a name="LN59"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>conn_opts</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN60"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>conn_opt</span><span class='Delimiter'>; 
</span><a name="LN61"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_msg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* pg_recvlogical uses dbname only; others use connection_string only. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="streamutil.c.html#LN37"><span class='Ref_to_Global_Var'>dbname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="streamutil.c.html#LN33"><span class='Ref_to_Global_Var'>connection_string</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Merge the connection info inputs given in form of connection string, 
     * options and default values (dbname=replication, replication=true, etc.) 
     * Explicitly discard any dbname value in the connection string; 
     * otherwise, PQconnectdbParams() would interpret that value as being 
     * itself a connection string. 
     */ 
</span>    <a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN33"><span class='Ref_to_Global_Var'>connection_string</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="streamutil.c.html#LN59"><span class='Ref_To_Local'>conn_opts</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN278"><span class='Ref_to_Proto'>PQconninfoParse</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN33"><span class='Ref_to_Global_Var'>connection_string</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="streamutil.c.html#LN61"><span class='Ref_To_Local'>err_msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN59"><span class='Ref_To_Local'>conn_opts</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: %s"</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN61"><span class='Ref_To_Local'>err_msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a> <span class='Operator'>= </span><a href="streamutil.c.html#LN59"><span class='Ref_To_Local'>conn_opts</span></a><span class='Delimiter'>; </span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& 
</span>                strcmp<span class='Parentheses'>(</span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><span class='String'>"dbname"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="streamutil.c.html#LN52"><span class='Ref_To_Local'>argcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>((</span><a href="streamutil.c.html#LN52"><span class='Ref_To_Local'>argcount</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>((</span><a href="streamutil.c.html#LN52"><span class='Ref_To_Local'>argcount</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a> <span class='Operator'>= </span><a href="streamutil.c.html#LN59"><span class='Ref_To_Local'>conn_opts</span></a><span class='Delimiter'>; </span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& 
</span>                strcmp<span class='Parentheses'>(</span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><span class='String'>"dbname"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>; 
</span>                <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="streamutil.c.html#LN60"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>; 
</span>                <a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if connection_string &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>((</span><a href="streamutil.c.html#LN52"><span class='Ref_To_Local'>argcount</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>((</span><a href="streamutil.c.html#LN52"><span class='Ref_To_Local'>argcount</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"dbname"</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="streamutil.c.html#LN37"><span class='Ref_to_Global_Var'>dbname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>? </span><span class='String'>"replication"</span> <span class='Operator'>: </span><a href="streamutil.c.html#LN37"><span class='Ref_to_Global_Var'>dbname</span></a><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"replication"</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="streamutil.c.html#LN37"><span class='Ref_to_Global_Var'>dbname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>? </span><span class='String'>"true"</span> <span class='Operator'>: </span><span class='String'>"database"</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"fallback_application_name"</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN34"><span class='Ref_to_Global_Var'>dbhost</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"host"</span><span class='Delimiter'>; 
</span>        <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="streamutil.c.html#LN34"><span class='Ref_to_Global_Var'>dbhost</span></a><span class='Delimiter'>; 
</span>        <a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN35"><span class='Ref_to_Global_Var'>dbuser</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"user"</span><span class='Delimiter'>; 
</span>        <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="streamutil.c.html#LN35"><span class='Ref_to_Global_Var'>dbuser</span></a><span class='Delimiter'>; 
</span>        <a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN36"><span class='Ref_to_Global_Var'>dbport</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"port"</span><span class='Delimiter'>; 
</span>        <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="streamutil.c.html#LN36"><span class='Ref_to_Global_Var'>dbport</span></a><span class='Delimiter'>; 
</span>        <a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If -W was given, force prompt for password, but only the first time */ 
</span>    <a href="streamutil.c.html#LN58"><span class='Ref_To_Local'>need_password</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="streamutil.c.html#LN38"><span class='Ref_to_Global_Var'>dbgetpassword</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& !</span><a href="streamutil.c.html#LN39"><span class='Ref_to_Global_Var'>have_password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Get a new password if appropriate */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN58"><span class='Ref_To_Local'>need_password</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../port/sprompt.c.html#LN35"><span class='Ref_to_Func'>simple_prompt</span></a><span class='Parentheses'>(</span><span class='String'>"Password: "</span><span class='Delimiter'>, </span><a href="streamutil.c.html#LN40"><span class='Ref_to_Global_Var'>password</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="streamutil.c.html#LN40"><span class='Ref_to_Global_Var'>password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="streamutil.c.html#LN39"><span class='Ref_to_Global_Var'>have_password</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="streamutil.c.html#LN58"><span class='Ref_To_Local'>need_password</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Use (or reuse, on a subsequent connection) password if we have it */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN39"><span class='Ref_to_Global_Var'>have_password</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"password"</span><span class='Delimiter'>; 
</span>            <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="streamutil.c.html#LN40"><span class='Ref_to_Global_Var'>password</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="streamutil.c.html#LN54"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN261"><span class='Ref_to_Proto'>PQconnectdbParams</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If there is too little memory even to allocate the PGconn object 
         * and PQconnectdbParams returns NULL, we call exit(1) directly. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not connect to server\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* If we need a password and -w wasn't given, loop back and get one */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN317"><span class='Ref_to_Proto'>PQstatus</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a> <span class='Operator'>&& 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN326"><span class='Ref_to_Proto'>PQconnectionNeedsPassword</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="streamutil.c.html#LN38"><span class='Ref_to_Global_Var'>dbgetpassword</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="streamutil.c.html#LN58"><span class='Ref_To_Local'>need_password</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN58"><span class='Ref_To_Local'>need_password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN317"><span class='Ref_to_Proto'>PQstatus</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not connect to server: %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN59"><span class='Ref_To_Local'>conn_opts</span></a><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN59"><span class='Ref_To_Local'>conn_opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Connection ok! */ 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN56"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN55"><span class='Ref_To_Local'>keywords</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN59"><span class='Ref_To_Local'>conn_opts</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN59"><span class='Ref_To_Local'>conn_opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ensure we have the same value of integer_datetimes (now always "on") as 
     * the server we are connecting to. 
     */ 
</span>    <a href="streamutil.c.html#LN57"><span class='Ref_To_Local'>tmpparam</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN319"><span class='Ref_to_Proto'>PQparameterStatus</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Delimiter'>, </span><span class='String'>"integer_datetimes"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="streamutil.c.html#LN57"><span class='Ref_To_Local'>tmpparam</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>         _<span class='Parentheses'>(</span><span class='String'>"%s: could not determine server setting for integer_datetimes\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="streamutil.c.html#LN57"><span class='Ref_To_Local'>tmpparam</span></a><span class='Delimiter'>, </span><span class='String'>"on"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>             _<span class='Parentheses'>(</span><span class='String'>"%s: integer_datetimes compile flag does not match server\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="streamutil.c.html#LN51"><span class='Ref_To_Local'>tmpconn</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetConnection &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Run IDENTIFY_SYSTEM through a given connection and give back to caller 
 * some result information if requested: 
 * - System identifier 
 * - Current timeline ID 
 * - Start LSN position 
 * - Database name (NULL in servers prior to 9.4) 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN241"></a><span class='Declare_Function'>RunIdentifySystem</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>sysid</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN44"><span class='Ref_to_Typedef'>TimeLineID</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>starttli</span><span class='Delimiter'>, 
</span><a name="LN242"></a>                  <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>startpos</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>db_name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN244"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN245"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>hi</span><span class='Delimiter'>, 
</span><a name="LN246"></a>                <span class='Declare_Local'>lo</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check connection existence */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="streamutil.c.html#LN241"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN241"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"IDENTIFY_SYSTEM"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not send replication command \"%s\": %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='String'>"IDENTIFY_SYSTEM"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN241"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: could not identify system: got %d rows and %d fields, expected %d rows and %d or more fields\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get system identifier */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN241"><span class='Ref_to_Parameter'>sysid</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="streamutil.c.html#LN241"><span class='Ref_to_Parameter'>sysid</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get timeline ID to start streaming from */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN241"><span class='Ref_to_Parameter'>starttli</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="streamutil.c.html#LN241"><span class='Ref_to_Parameter'>starttli</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get LSN start position if necessary */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN242"><span class='Ref_to_Parameter'>startpos</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>sscanf<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%X/%X"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="streamutil.c.html#LN245"><span class='Ref_To_Local'>hi</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="streamutil.c.html#LN246"><span class='Ref_To_Local'>lo</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                  _<span class='Parentheses'>(</span><span class='String'>"%s: could not parse write-ahead log location \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="streamutil.c.html#LN242"><span class='Ref_to_Parameter'>startpos</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="streamutil.c.html#LN245"><span class='Ref_To_Local'>hi</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>32</span> <span class='Operator'>| </span><a href="streamutil.c.html#LN246"><span class='Ref_To_Local'>lo</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get database name, only available in 9.4 and newer versions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN242"><span class='Ref_to_Parameter'>db_name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="streamutil.c.html#LN242"><span class='Ref_to_Parameter'>db_name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN322"><span class='Ref_to_Proto'>PQserverVersion</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN241"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>90400</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                        _<span class='Parentheses'>(</span><span class='String'>"%s: could not identify system: got %d rows and %d fields, expected %d rows and %d or more fields\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>))</span> 
                <span class='Operator'>*</span><a href="streamutil.c.html#LN242"><span class='Ref_to_Parameter'>db_name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN244"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RunIdentifySystem &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create a replication slot for the given connection. This function 
 * returns true in case of success. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN322"></a><span class='Declare_Function'>CreateReplicationSlot</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>slot_name</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>plugin</span><span class='Delimiter'>, 
</span><a name="LN323"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_physical</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>slot_exists_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN325"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN326"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="streamutil.c.html#LN325"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>((</span><a href="streamutil.c.html#LN323"><span class='Ref_to_Parameter'>is_physical</span></a> <span class='Operator'>&& </span><a href="streamutil.c.html#LN322"><span class='Ref_to_Parameter'>plugin</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>           <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="streamutil.c.html#LN323"><span class='Ref_to_Parameter'>is_physical</span></a> <span class='Operator'>&& </span><a href="streamutil.c.html#LN322"><span class='Ref_to_Parameter'>plugin</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="streamutil.c.html#LN322"><span class='Ref_to_Parameter'>slot_name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build query */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN323"><span class='Ref_to_Parameter'>is_physical</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN325"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE_REPLICATION_SLOT \"%s\" PHYSICAL"</span><span class='Delimiter'>, 
</span>                          <a href="streamutil.c.html#LN322"><span class='Ref_to_Parameter'>slot_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN325"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE_REPLICATION_SLOT \"%s\" LOGICAL \"%s\""</span><span class='Delimiter'>, 
</span>                          <a href="streamutil.c.html#LN322"><span class='Ref_to_Parameter'>slot_name</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN322"><span class='Ref_to_Parameter'>plugin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN322"><span class='Ref_to_Proto'>PQserverVersion</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN322"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>100000</span><span class='Parentheses'>)</span> 
            <span class='Comment_Multi_Line'>/* pg_recvlogical doesn't use an exported snapshot, so suppress */ 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN325"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>" NOEXPORT_SNAPSHOT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN322"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN325"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN350"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>sqlstate</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN56"><span class='Ref_to_Const'>PG_DIAG_SQLSTATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN323"><span class='Ref_to_Parameter'>slot_exists_ok</span></a> <span class='Operator'>&& 
</span>            <a href="streamutil.c.html#LN350"><span class='Ref_To_Local'>sqlstate</span></a> <span class='Operator'>&& 
</span>            strcmp<span class='Parentheses'>(</span><a href="streamutil.c.html#LN350"><span class='Ref_To_Local'>sqlstate</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN325"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not send replication command \"%s\": %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN325"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN322"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN325"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if PQresultStatus(res)!=... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>4</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: could not create replication slot \"%s\": got %d rows and %d fields, expected %d rows and %d fields\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN322"><span class='Ref_to_Parameter'>slot_name</span></a><span class='Delimiter'>, 
</span>                <a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN325"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN325"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateReplicationSlot &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Drop a replication slot for the given connection. This function 
 * returns true in case of success. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN393"></a><span class='Declare_Function'>DropReplicationSlot</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>slot_name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN395"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN396"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="streamutil.c.html#LN393"><span class='Ref_to_Parameter'>slot_name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="streamutil.c.html#LN395"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build query */ 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN395"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"DROP_REPLICATION_SLOT \"%s\""</span><span class='Delimiter'>, 
</span>                      <a href="streamutil.c.html#LN393"><span class='Ref_to_Parameter'>slot_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN396"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN393"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN395"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN396"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not send replication command \"%s\": %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN395"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN393"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN395"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN396"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN396"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN396"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: could not drop replication slot \"%s\": got %d rows and %d fields, expected %d rows and %d fields\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN393"><span class='Ref_to_Parameter'>slot_name</span></a><span class='Delimiter'>, 
</span>                <a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN396"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN396"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN395"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN396"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN395"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="streamutil.c.html#LN396"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DropReplicationSlot &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Frontend version of GetCurrentTimestamp(), since we are not linked with 
 * backend code. 
 */ 
</span><a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> 
<a name="LN439"></a><span class='Declare_Function'>feGetCurrentTimestamp</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN441"></a>    <a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN442"></a>    <span class='Control'>struct</span> timeval <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span> 
    <a href="../../port/gettimeofday.c.html#LN103"><span class='Ref_to_Func'>gettimeofday</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="streamutil.c.html#LN442"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="streamutil.c.html#LN441"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a><span class='Parentheses'>) </span><a href="streamutil.c.html#LN442"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>.</span>tv_sec <span class='Operator'>- 
</span>        <span class='Parentheses'>((</span><a href="../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a> <span class='Operator'>- </span><a href="../../include/datatype/timestamp.h.html#LN161"><span class='Ref_to_Const'>UNIX_EPOCH_JDATE</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN441"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="streamutil.c.html#LN441"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>* </span><a href="../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="streamutil.c.html#LN442"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>.</span>tv_usec<span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="streamutil.c.html#LN441"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Frontend version of TimestampDifference(), since we are not linked with 
 * backend code. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN458"></a><span class='Declare_Function'>feTimestampDifference</span><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>start_time</span><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>stop_time</span><span class='Delimiter'>, 
</span><a name="LN459"></a>                      <span class='Keyword'>long </span><span class='Operator'>*</span><span class='Declare_Parameter'>secs</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>microsecs</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN461"></a>    <a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>diff</span> <span class='Operator'>= </span><a href="streamutil.c.html#LN458"><span class='Ref_to_Parameter'>stop_time</span></a> <span class='Operator'>- </span><a href="streamutil.c.html#LN458"><span class='Ref_to_Parameter'>start_time</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN461"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="streamutil.c.html#LN459"><span class='Ref_to_Parameter'>secs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="streamutil.c.html#LN459"><span class='Ref_to_Parameter'>microsecs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="streamutil.c.html#LN459"><span class='Ref_to_Parameter'>secs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="streamutil.c.html#LN461"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>/ </span><a href="../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="streamutil.c.html#LN459"><span class='Ref_to_Parameter'>microsecs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="streamutil.c.html#LN461"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>% </span><a href="../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Frontend version of TimestampDifferenceExceeds(), since we are not 
 * linked with backend code. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN480"></a><span class='Declare_Function'>feTimestampDifferenceExceeds</span><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>start_time</span><span class='Delimiter'>, 
</span><a name="LN481"></a>                             <a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>stop_time</span><span class='Delimiter'>, 
</span><a name="LN482"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>msec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN484"></a>    <a href="../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>diff</span> <span class='Operator'>= </span><a href="streamutil.c.html#LN481"><span class='Ref_to_Parameter'>stop_time</span></a> <span class='Operator'>- </span><a href="streamutil.c.html#LN480"><span class='Ref_to_Parameter'>start_time</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="streamutil.c.html#LN484"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>&GT;= </span><a href="streamutil.c.html#LN482"><span class='Ref_to_Parameter'>msec</span></a> <span class='Operator'>* </span><a href="../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>1000</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Converts an int64 to network byte order. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN493"></a><span class='Declare_Function'>fe_sendint64</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>i</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN495"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>n32</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* High order half first, since we're doing MSB-first */ 
</span>    <a href="streamutil.c.html#LN495"><span class='Ref_To_Local'>n32</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="streamutil.c.html#LN493"><span class='Ref_to_Parameter'>i</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN495"><span class='Ref_To_Local'>n32</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="streamutil.c.html#LN495"><span class='Ref_To_Local'>n32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="streamutil.c.html#LN493"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="streamutil.c.html#LN495"><span class='Ref_To_Local'>n32</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now the low order half */ 
</span>    <a href="streamutil.c.html#LN495"><span class='Ref_To_Local'>n32</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="streamutil.c.html#LN493"><span class='Ref_to_Parameter'>i</span></a><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN495"><span class='Ref_To_Local'>n32</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="streamutil.c.html#LN495"><span class='Ref_To_Local'>n32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="streamutil.c.html#LN493"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="streamutil.c.html#LN495"><span class='Ref_To_Local'>n32</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Converts an int64 from network byte order to native format. 
 */ 
</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN512"></a><span class='Declare_Function'>fe_recvint64</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN514"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN515"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>h32</span><span class='Delimiter'>; 
</span><a name="LN516"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>l32</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="streamutil.c.html#LN515"><span class='Ref_To_Local'>h32</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN512"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="streamutil.c.html#LN516"><span class='Ref_To_Local'>l32</span></a><span class='Delimiter'>, </span><a href="streamutil.c.html#LN512"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN515"><span class='Ref_To_Local'>h32</span></a> <span class='Operator'>= </span>ntohl<span class='Parentheses'>(</span><a href="streamutil.c.html#LN515"><span class='Ref_To_Local'>h32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN516"><span class='Ref_To_Local'>l32</span></a> <span class='Operator'>= </span>ntohl<span class='Parentheses'>(</span><a href="streamutil.c.html#LN516"><span class='Ref_To_Local'>l32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="streamutil.c.html#LN514"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="streamutil.c.html#LN515"><span class='Ref_To_Local'>h32</span></a><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN514"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>32</span><span class='Delimiter'>; 
</span>    <a href="streamutil.c.html#LN514"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>|= </span><a href="streamutil.c.html#LN516"><span class='Ref_To_Local'>l32</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="streamutil.c.html#LN514"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>