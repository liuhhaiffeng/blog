<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_ctl\pg_ctl.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_ctl\pg_ctl.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:59 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_ctl --- start/stops/restarts the PostgreSQL server 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * 
 * src/bin/pg_ctl/pg_ctl.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Comment_Multi_Line'>/* 
 * Need this to get defines for restricted tokens and jobs. And it 
 * has to be set before any header from the Win32 API is loaded. 
 */ 
</span><a name="LN16"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>_WIN32_WINNT</span> <span class='Number'>0x0501</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;signal.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;time.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/wait.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Directive'>#ifdef</span> HAVE_SYS_RESOURCE_H 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/time.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/resource.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_control.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/controldata_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"getopt_long.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq-fe.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pqexpbuffer.h"</span> 
 
<span class='Comment_Multi_Line'>/* PID can be negative for standalone backend */ 
</span><a name="LN41"></a><span class='Control'>typedef</span> <span class='Keyword'>long </span><span class='Declare_Typedef'>pgpid_t</span><span class='Delimiter'>; 
</span> 
 
<span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN46"></a>    <span class='Declare_Enum_Const'>SMART_MODE</span><span class='Delimiter'>, 
</span><a name="LN47"></a>    <span class='Declare_Enum_Const'>FAST_MODE</span><span class='Delimiter'>, 
</span><a name="LN48"></a>    <span class='Declare_Enum_Const'>IMMEDIATE_MODE</span> 
<a name="LN49"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ShutdownMode</span><span class='Delimiter'>; 
</span> 
 
<span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN54"></a>    <span class='Declare_Enum_Const'>NO_COMMAND</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN55"></a>    <span class='Declare_Enum_Const'>INIT_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN56"></a>    <span class='Declare_Enum_Const'>START_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN57"></a>    <span class='Declare_Enum_Const'>STOP_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN58"></a>    <span class='Declare_Enum_Const'>RESTART_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN59"></a>    <span class='Declare_Enum_Const'>RELOAD_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN60"></a>    <span class='Declare_Enum_Const'>STATUS_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN61"></a>    <span class='Declare_Enum_Const'>PROMOTE_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN62"></a>    <span class='Declare_Enum_Const'>KILL_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN63"></a>    <span class='Declare_Enum_Const'>REGISTER_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN64"></a>    <span class='Declare_Enum_Const'>UNREGISTER_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN65"></a>    <span class='Declare_Enum_Const'>RUN_AS_SERVICE_COMMAND</span> 
<a name="LN66"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>CtlCommand</span><span class='Delimiter'>; 
</span> 
<a name="LN68"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEFAULT_WAIT</span>    <span class='Number'>60</span> 
 
<a name="LN70"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>do_wait</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN71"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>wait_seconds</span> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN68"><span class='Ref_to_Const'>DEFAULT_WAIT</span></a><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>wait_seconds_arg</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN73"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>silent_mode</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static </span><a href="pg_ctl.c.html#LN44"><span class='Ref_to_Typedef'>ShutdownMode</span></a> <span class='Declare_Var'>shutdown_mode</span> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN47"><span class='Ref_to_EnumConst'>FAST_MODE</span></a><span class='Delimiter'>; 
</span><a name="LN75"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>sig</span> <span class='Operator'>= </span>SIGINT<span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* default */ 
</span><a name="LN76"></a><span class='Keyword'>static </span><a href="pg_ctl.c.html#LN52"><span class='Ref_to_Typedef'>CtlCommand</span></a> <span class='Declare_Var'>ctl_command</span> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN54"><span class='Ref_to_EnumConst'>NO_COMMAND</span></a><span class='Delimiter'>; 
</span><a name="LN77"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>pg_data</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN78"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>pg_config</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN79"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>pgdata_opt</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN80"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>post_opts</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN81"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>progname</span><span class='Delimiter'>; 
</span><a name="LN82"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>log_file</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN83"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>exec_path</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>event_source</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN85"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>register_servicename</span> <span class='Operator'>= </span><span class='String'>"PostgreSQL"</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* FIXME: + version ID? */ 
</span><a name="LN86"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>register_username</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN87"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>register_password</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>argv0</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>allow_core_files</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN90"></a><span class='Keyword'>static </span>time_t <span class='Declare_Var'>start_time</span><span class='Delimiter'>; 
</span> 
<a name="LN92"></a><span class='Keyword'>static char </span><span class='Declare_Var'>postopts_file</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN93"></a><span class='Keyword'>static char </span><span class='Declare_Var'>version_file</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN94"></a><span class='Keyword'>static char </span><span class='Declare_Var'>pid_file</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN95"></a><span class='Keyword'>static char </span><span class='Declare_Var'>backup_file</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN96"></a><span class='Keyword'>static char </span><span class='Declare_Var'>promote_file</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN99"></a><span class='Keyword'>static DWORD </span><span class='Declare_Var'>pgctl_start_type</span> <span class='Operator'>= </span>SERVICE_AUTO_START<span class='Delimiter'>; 
</span><a name="LN100"></a><span class='Keyword'>static </span>SERVICE_STATUS <span class='Declare_Var'>status</span><span class='Delimiter'>; 
</span><a name="LN101"></a><span class='Keyword'>static </span>SERVICE_STATUS_HANDLE <span class='Declare_Var'>hStatus</span> <span class='Operator'>= </span><span class='Parentheses'>(</span>SERVICE_STATUS_HANDLE<span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN102"></a><span class='Keyword'>static </span>HANDLE <span class='Declare_Var'>shutdownHandles</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN103"></a><span class='Keyword'>static </span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a> <span class='Declare_Var'>postmasterPID</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
<a name="LN105"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>shutdownEvent</span>     <a href="pg_ctl.c.html#LN102"><span class='Ref_to_Global_Var'>shutdownHandles</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] 
</span><a name="LN106"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>postmasterProcess</span> <a href="pg_ctl.c.html#LN102"><span class='Ref_to_Global_Var'>shutdownHandles</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] 
</span><span class='Directive'>#endif</span> 
 
 
<a name="LN110"></a><span class='Keyword'>static void </span><a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span>fmt<span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) </span><span class='Declare_Var'>pg_attribute_printf</span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN111"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_advice</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN112"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_help</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN113"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_mode</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>modeopt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN114"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_sig</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>signame</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN115"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_init</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN116"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_start</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN117"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_stop</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN118"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_restart</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN119"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_reload</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN120"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_status</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN121"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_promote</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN122"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_kill</span><span class='Parentheses'>(</span><a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a> <span class='Declare_Parameter'>pid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN123"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>print_msg</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN124"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>adjust_data_dir</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Directive'>#if</span> <span class='Parentheses'>(</span>_MSC_VER <span class='Operator'>&GT;= </span><span class='Number'>1800</span><span class='Parentheses'>) 
</span><span class='Keyword'>#include </span><span class='String'>&LT;versionhelpers.h&GT;</span> 
<span class='Directive'>#else</span> 
<a name="LN130"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>IsWindowsXPOrGreater</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN131"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>IsWindows7OrGreater</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN133"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>pgwin32_IsInstalled</span><span class='Parentheses'>(</span>SC_HANDLE<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN134"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>pgwin32_CommandLine</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN135"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgwin32_doRegister</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN136"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgwin32_doUnregister</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN137"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgwin32_SetServiceStatus</span><span class='Parentheses'>(</span><span class='Keyword'>DWORD</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN138"></a><span class='Keyword'>static void </span>WINAPI <span class='Declare_Prototype'>pgwin32_ServiceHandler</span><span class='Parentheses'>(</span><span class='Keyword'>DWORD</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN139"></a><span class='Keyword'>static void </span>WINAPI <span class='Declare_Prototype'>pgwin32_ServiceMain</span><span class='Parentheses'>(</span><span class='Keyword'>DWORD</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>LPTSTR</span> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN140"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgwin32_doRunAsService</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN141"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>CreateRestrictedProcess</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span>PROCESS_INFORMATION <span class='Operator'>*</span><span class='Declare_Parameter'>processInfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>as_service</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<a name="LN144"></a><span class='Keyword'>static </span><a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a> <span class='Declare_Prototype'>get_pgpid</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_status_request</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN145"></a><span class='Keyword'>static char </span><span class='Operator'>**</span><span class='Declare_Prototype'>readfile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN146"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>free_readfile</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>optlines</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN147"></a><span class='Keyword'>static </span><a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a> <span class='Declare_Prototype'>start_postmaster</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN148"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>read_post_opts</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN150"></a><span class='Keyword'>static </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN128"><span class='Ref_to_Typedef'>PGPing</span></a> <span class='Declare_Prototype'>test_postmaster_connection</span><span class='Parentheses'>(</span><a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a> <span class='Declare_Parameter'>pm_pid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>do_checkpoint</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN151"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>postmaster_is_alive</span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a> <span class='Declare_Parameter'>pid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_GETRLIMIT<span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span>RLIMIT_CORE<span class='Parentheses'>) 
</span><a name="LN154"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>unlimit_core_size</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<a name="LN157"></a><span class='Keyword'>static </span><a href="../../include/catalog/pg_control.h.html#LN83"><span class='Ref_to_Enum'>DBState</span></a> <span class='Declare_Prototype'>get_control_dbstate</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>static void 
</span><a name="LN162"></a><span class='Declare_Function'>write_eventlog</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>line</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN164"></a>    <span class='Keyword'>static </span>HANDLE <span class='Declare_Local'>evtHandle</span> <span class='Operator'>= </span>INVALID_HANDLE_VALUE<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN73"><span class='Ref_to_Global_Var'>silent_mode</span></a> <span class='Operator'>&& </span><a href="pg_ctl.c.html#LN162"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>== </span>EVENTLOG_INFORMATION_TYPE<span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN164"><span class='Ref_To_Local'>evtHandle</span></a> <span class='Operator'>== </span>INVALID_HANDLE_VALUE<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN164"><span class='Ref_To_Local'>evtHandle</span></a> <span class='Operator'>= </span>RegisterEventSource<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                         <a href="../pgevent/pgevent.c.html#LN24"><span class='Ref_to_Global_Var'>event_source</span></a> <span class='Operator'>? </span><a href="../pgevent/pgevent.c.html#LN24"><span class='Ref_to_Global_Var'>event_source</span></a> <span class='Operator'>: </span><a href="../../include/pg_config_manual.h.html#LN188"><span class='Ref_to_Const'>DEFAULT_EVENT_SOURCE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN164"><span class='Ref_To_Local'>evtHandle</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN164"><span class='Ref_To_Local'>evtHandle</span></a> <span class='Operator'>= </span>INVALID_HANDLE_VALUE<span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    ReportEvent<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN164"><span class='Ref_To_Local'>evtHandle</span></a><span class='Delimiter'>, 
</span>                <a href="pg_ctl.c.html#LN162"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, 
</span>                <span class='Number'>0</span><span class='Delimiter'>, 
</span>                <span class='Number'>0</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* All events are Id 0 */ 
</span>                <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                <span class='Number'>1</span><span class='Delimiter'>, 
</span>                <span class='Number'>0</span><span class='Delimiter'>, 
</span>                <span class='Operator'>&</span><a href="pg_ctl.c.html#LN162"><span class='Ref_to_Parameter'>line</span></a><span class='Delimiter'>, 
</span>                <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end write_eventlog &raquo; </span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write errors to stderr (or by equal means when stderr is 
 * not available). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN197"></a><span class='Declare_Function'>write_stderr</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN199"></a>    va_list     <span class='Declare_Local'>ap</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN199"><span class='Ref_To_Local'>ap</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN197"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Comment_Multi_Line'>/* On Unix, we just fprintf to stderr */ 
</span>    <a href="../../include/port.h.html#LN171"><span class='Ref_to_Macro'>vfprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN197"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN199"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * On Win32, we print to stderr if running on a console, or write to 
     * eventlog if running as a service 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/win32security.c.html#LN115"><span class='Ref_to_Func'>pgwin32_is_service</span></a><span class='Parentheses'>())</span>   <span class='Comment_Single_Line'>/* Running as a service */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN213"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>errbuf</span><span class='Delimiter'>[</span><span class='Number'>2048</span><span class='Delimiter'>];</span>       <span class='Comment_Single_Line'>/* Arbitrary size? */ 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN59"><span class='Ref_to_Macro'>vsnprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN213"><span class='Ref_To_Local'>errbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN213"><span class='Ref_To_Local'>errbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN197"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN199"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../backend/utils/error/elog.c.html#LN133"><span class='Ref_to_Proto'>write_eventlog</span></a><span class='Parentheses'>(</span>EVENTLOG_ERROR_TYPE<span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN213"><span class='Ref_To_Local'>errbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Comment_Multi_Line'>/* Not running as service, write to stderr */ 
</span>        <a href="../../include/port.h.html#LN171"><span class='Ref_to_Macro'>vfprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN197"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN199"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN199"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end write_stderr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given an already-localized string, print it to stdout unless the 
 * user has specified that no messages should be printed. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN231"></a><span class='Declare_Function'>print_msg</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_ctl.c.html#LN73"><span class='Ref_to_Global_Var'>silent_mode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN231"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static </span><a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a> 
<a name="LN241"></a><span class='Declare_Function'>get_pgpid</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_status_request</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN243"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>pidf</span><span class='Delimiter'>; 
</span><a name="LN244"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>pid</span><span class='Delimiter'>; 
</span><a name="LN245"></a>    <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>statbuf</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN245"><span class='Ref_To_Local'>statbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: directory \"%s\" does not exist\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, 
</span>                         <a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not access directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, 
</span>                         <a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The Linux Standard Base Core Specification 3.1 says this should 
         * return '4, program or service status is unknown' 
         * https://refspecs.linuxbase.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-g 
         * eneric/iniscrptact.html 
         */ 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN241"><span class='Ref_to_Parameter'>is_status_request</span></a> <span class='Operator'>? </span><span class='Number'>4</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN93"><span class='Ref_to_Global_Var'>version_file</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN245"><span class='Ref_To_Local'>statbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: directory \"%s\" is not a database cluster directory\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN241"><span class='Ref_to_Parameter'>is_status_request</span></a> <span class='Operator'>? </span><span class='Number'>4</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_ctl.c.html#LN243"><span class='Ref_To_Local'>pidf</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN94"><span class='Ref_to_Global_Var'>pid_file</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN243"><span class='Ref_To_Local'>pidf</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No pid file, not an error on startup */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open PID file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN94"><span class='Ref_to_Global_Var'>pid_file</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fscanf<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN243"><span class='Ref_To_Local'>pidf</span></a><span class='Delimiter'>, </span><span class='String'>"%ld"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN244"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Is the file empty? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>ftell<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN243"><span class='Ref_To_Local'>pidf</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span>feof<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN243"><span class='Ref_To_Local'>pidf</span></a><span class='Parentheses'>))</span> 
            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: the PID file \"%s\" is empty\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN94"><span class='Ref_to_Global_Var'>pid_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: invalid data in PID file \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN94"><span class='Ref_to_Global_Var'>pid_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    fclose<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN243"><span class='Ref_To_Local'>pidf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN244"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_pgpid &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * get the lines from a text file - return NULL if file can't be opened 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>** 
</span><a name="LN305"></a><span class='Declare_Function'>readfile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN307"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fd</span><span class='Delimiter'>; 
</span><a name="LN308"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nlines</span><span class='Delimiter'>; 
</span><a name="LN309"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN310"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN311"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>linebegin</span><span class='Delimiter'>; 
</span><a name="LN312"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN313"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span><a name="LN314"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN315"></a>    <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>statbuf</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Slurp the file into memory. 
     * 
     * The file can change concurrently, so we read the whole file into memory 
     * with a single read() call. That's not guaranteed to get an atomic 
     * snapshot, but in practice, for a small file, it's close enough for the 
     * current use. 
     */ 
</span>    <a href="pg_ctl.c.html#LN307"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN305"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span>O_RDONLY <span class='Operator'>| </span><a href="../../include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN307"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fstat<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN307"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN315"><span class='Ref_To_Local'>statbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN307"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN315"><span class='Ref_To_Local'>statbuf</span></a><span class='Operator'>.</span>st_size <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* empty file */ 
</span>        <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN307"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN309"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pg_ctl.c.html#LN309"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="pg_ctl.c.html#LN309"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_ctl.c.html#LN310"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN315"><span class='Ref_To_Local'>statbuf</span></a><span class='Operator'>.</span>st_size <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN314"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/win32.h.html#LN12"><span class='Ref_to_Macro'>read</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN307"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN310"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN315"><span class='Ref_To_Local'>statbuf</span></a><span class='Operator'>.</span>st_size <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN307"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN314"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>!= </span><a href="pg_ctl.c.html#LN315"><span class='Ref_To_Local'>statbuf</span></a><span class='Operator'>.</span>st_size<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* oops, the file size changed between fstat and read */ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN310"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Count newlines. We expect there to be a newline after each full line, 
     * including one at the end of file. If there isn't a newline at the end, 
     * any characters after the last newline will be ignored. 
     */ 
</span>    <a href="pg_ctl.c.html#LN308"><span class='Ref_To_Local'>nlines</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN312"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN312"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_ctl.c.html#LN314"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN312"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN310"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>[</span><a href="pg_ctl.c.html#LN312"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <a href="pg_ctl.c.html#LN308"><span class='Ref_To_Local'>nlines</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* set up the result buffer */ 
</span>    <a href="pg_ctl.c.html#LN309"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN308"><span class='Ref_To_Local'>nlines</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* now split the buffer into lines */ 
</span>    <a href="pg_ctl.c.html#LN311"><span class='Ref_To_Local'>linebegin</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN310"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN313"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN312"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN312"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_ctl.c.html#LN314"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN312"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN310"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>[</span><a href="pg_ctl.c.html#LN312"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN374"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>slen</span> <span class='Operator'>= &</span><a href="pg_ctl.c.html#LN310"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>[</span><a href="pg_ctl.c.html#LN312"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="pg_ctl.c.html#LN311"><span class='Ref_To_Local'>linebegin</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN375"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>linebuf</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN374"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            memcpy<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN375"><span class='Ref_To_Local'>linebuf</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN311"><span class='Ref_To_Local'>linebegin</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN374"><span class='Ref_To_Local'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_ctl.c.html#LN375"><span class='Ref_To_Local'>linebuf</span></a><span class='Delimiter'>[</span><a href="pg_ctl.c.html#LN374"><span class='Ref_To_Local'>slen</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <a href="pg_ctl.c.html#LN309"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="pg_ctl.c.html#LN313"><span class='Ref_To_Local'>n</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_ctl.c.html#LN375"><span class='Ref_To_Local'>linebuf</span></a><span class='Delimiter'>; 
</span>            <a href="pg_ctl.c.html#LN311"><span class='Ref_To_Local'>linebegin</span></a> <span class='Operator'>= &</span><a href="pg_ctl.c.html#LN310"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>[</span><a href="pg_ctl.c.html#LN312"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_ctl.c.html#LN309"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="pg_ctl.c.html#LN313"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN310"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_ctl.c.html#LN309"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end readfile &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Free memory allocated for optlines through readfile() 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN395"></a><span class='Declare_Function'>free_readfile</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>optlines</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN397"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curr_line</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN398"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_ctl.c.html#LN395"><span class='Ref_to_Parameter'>optlines</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN397"><span class='Ref_To_Local'>curr_line</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN395"><span class='Ref_to_Parameter'>optlines</span></a><span class='Delimiter'>[</span><a href="pg_ctl.c.html#LN398"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN397"><span class='Ref_To_Local'>curr_line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN395"><span class='Ref_to_Parameter'>optlines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * start/test/stop routines 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Start the postmaster and return its PID. 
 * 
 * Currently, on Windows what we return is the PID of the shell process 
 * that launched the postmaster (and, we trust, is waiting for it to exit). 
 * So the PID is usable for "is the postmaster still running" checks, 
 * but cannot be compared directly to postmaster.pid. 
 * 
 * On Windows, we also save aside a handle to the shell process in 
 * "postmasterProcess", which the caller should close when done with it. 
 */ 
</span><span class='Keyword'>static </span><a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a> 
<a name="LN427"></a><span class='Declare_Function'>start_postmaster</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN429"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>cmd</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN432"></a>    <a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a>     <span class='Declare_Local'>pm_pid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Flush stdio channels just before fork, to avoid double-output problems */ 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN432"><span class='Ref_To_Local'>pm_pid</span></a> <span class='Operator'>= </span>fork<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN432"><span class='Ref_To_Local'>pm_pid</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* fork failed */ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not start server: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN432"><span class='Ref_To_Local'>pm_pid</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* fork succeeded, in parent */ 
</span>        <span class='Control'>return</span> <a href="pg_ctl.c.html#LN432"><span class='Ref_To_Local'>pm_pid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* fork succeeded, in child */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since there might be quotes to handle here, it is easier simply to pass 
     * everything to a shell to process them.  Use exec so that the postmaster 
     * has the same PID as the current child process. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN82"><span class='Ref_to_Global_Var'>log_file</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN429"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"exec \"%s\" %s%s &LT; \"%s\" &GT;&GT; \"%s\" 2&GT;&1"</span><span class='Delimiter'>, 
</span>                 <a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Delimiter'>, 
</span>                 <a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN82"><span class='Ref_to_Global_Var'>log_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN429"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"exec \"%s\" %s%s &LT; \"%s\" 2&GT;&1"</span><span class='Delimiter'>, 
</span>                 <a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Delimiter'>, </span><a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span>execl<span class='Parentheses'>(</span><span class='String'>"/bin/sh"</span><span class='Delimiter'>, </span><span class='String'>"/bin/sh"</span><span class='Delimiter'>, </span><span class='String'>"-c"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN429"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* exec failed */ 
</span>    <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not start server: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* keep dumb compilers quiet */ 
</span> 
<span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * As with the Unix case, it's easiest to use the shell (CMD.EXE) to 
     * handle redirection etc.  Unfortunately CMD.EXE lacks any equivalent of 
     * "exec", so we don't get to find out the postmaster's PID immediately. 
     */ 
</span><a name="LN483"></a>    PROCESS_INFORMATION <span class='Declare_Local'>pi</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN82"><span class='Ref_to_Global_Var'>log_file</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN429"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"CMD /C \"\"%s\" %s%s &LT; \"%s\" &GT;&GT; \"%s\" 2&GT;&1\""</span><span class='Delimiter'>, 
</span>                 <a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Delimiter'>, </span><a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN82"><span class='Ref_to_Global_Var'>log_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN429"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"CMD /C \"\"%s\" %s%s &LT; \"%s\" 2&GT;&1\""</span><span class='Delimiter'>, 
</span>                 <a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Delimiter'>, </span><a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/common/restricted_token.h.html#LN20"><span class='Ref_to_Proto'>CreateRestrictedProcess</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN429"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN483"><span class='Ref_To_Local'>pi</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not start server: error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Don't close command process handle here; caller must do so */ 
</span>    <a href="pg_ctl.c.html#LN106"><span class='Ref_to_Const'>postmasterProcess</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN483"><span class='Ref_To_Local'>pi</span></a><span class='Operator'>.</span>hProcess<span class='Delimiter'>; 
</span>    CloseHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN483"><span class='Ref_To_Local'>pi</span></a><span class='Operator'>.</span>hThread<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_ctl.c.html#LN483"><span class='Ref_To_Local'>pi</span></a><span class='Operator'>.</span>dwProcessId<span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* Shell's PID, not postmaster's! */ 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end start_postmaster &raquo; </span> 
 
 
 
<span class='Comment_Multi_Line'>/* 
 * Find the pgport and try a connection 
 * 
 * On Unix, pm_pid is the PID of the just-launched postmaster.  On Windows, 
 * it may be the PID of an ancestor shell process, so we can't check the 
 * contents of postmaster.pid quite as carefully. 
 * 
 * On Windows, the static variable postmasterProcess is an implicit argument 
 * to this routine; it contains a handle to the postmaster process or an 
 * ancestor shell process thereof. 
 * 
 * Note that the checkpoint parameter enables a Windows service control 
 * manager checkpoint, it's got nothing to do with database checkpoints!! 
 */ 
</span><span class='Keyword'>static </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN128"><span class='Ref_to_Typedef'>PGPing</span></a> 
<a name="LN522"></a><span class='Declare_Function'>test_postmaster_connection</span><span class='Parentheses'>(</span><a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a> <span class='Declare_Parameter'>pm_pid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>do_checkpoint</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN524"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN128"><span class='Ref_to_Typedef'>PGPing</span></a>      <span class='Declare_Local'>ret</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN132"><span class='Ref_to_EnumConst'>PQPING_NO_RESPONSE</span></a><span class='Delimiter'>; 
</span><a name="LN525"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>connstr</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>256</span><span class='Delimiter'>]; 
</span><a name="LN526"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if requested wait time is zero, return "still starting up" code */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN71"><span class='Ref_to_Global_Var'>wait_seconds</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN131"><span class='Ref_to_EnumConst'>PQPING_REJECT</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN525"><span class='Ref_To_Local'>connstr</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN526"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN526"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_ctl.c.html#LN71"><span class='Ref_to_Global_Var'>wait_seconds</span></a><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN526"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Do we need a connection string? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN525"><span class='Ref_To_Local'>connstr</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/*---------- 
             * The number of lines in postmaster.pid tells us several things: 
             * 
             * # of lines 
             *      0   lock file created but status not written 
             *      2   pre-9.1 server, shared memory not created 
             *      3   pre-9.1 server, shared memory created 
             *      5   9.1+ server, ports not opened 
             *      6   9.1+ server, shared memory not created 
             *      7   9.1+ server, shared memory created 
             * 
             * This code does not support pre-9.1 servers.  On Unix machines 
             * we could consider extracting the port number from the shmem 
             * key, but that (a) is not robust, and (b) doesn't help with 
             * finding out the socket directory.  And it wouldn't work anyway 
             * on Windows. 
             * 
             * If we see less than 6 lines in postmaster.pid, just keep 
             * waiting. 
             *---------- 
             */ 
</span><a name="LN560"></a>            <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>optlines</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Try to read the postmaster.pid file */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN94"><span class='Ref_to_Global_Var'>pid_file</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                <a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                <a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                <a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* File is exactly three lines, must be pre-9.1 */ 
</span>                    <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: -w option is not supported when starting a pre-9.1 server\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN133"><span class='Ref_to_EnumConst'>PQPING_NO_ATTEMPT</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                         <a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* File is complete enough for us, parse it */ 
</span><a name="LN579"></a>                    <a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a>     <span class='Declare_Local'>pmpid</span><span class='Delimiter'>; 
</span><a name="LN580"></a>                    time_t      <span class='Declare_Local'>pmstart</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Make sanity checks.  If it's for the wrong PID, or the 
                     * recorded start time is before pg_ctl started, then 
                     * either we are looking at the wrong data directory, or 
                     * this is a pre-existing pidfile that hasn't (yet?) been 
                     * overwritten by our child postmaster.  Allow 2 seconds 
                     * slop for possible cross-process clock skew. 
                     */ 
</span>                    <a href="pg_ctl.c.html#LN579"><span class='Ref_To_Local'>pmpid</span></a> <span class='Operator'>= </span>atol<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><a href="../../include/miscadmin.h.html#LN450"><span class='Ref_to_Const'>LOCK_FILE_LINE_PID</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pg_ctl.c.html#LN580"><span class='Ref_To_Local'>pmstart</span></a> <span class='Operator'>= </span>atol<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><a href="../../include/miscadmin.h.html#LN452"><span class='Ref_to_Const'>LOCK_FILE_LINE_START_TIME</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN580"><span class='Ref_To_Local'>pmstart</span></a> <span class='Operator'>&GT;= </span><a href="pg_ctl.c.html#LN90"><span class='Ref_to_Global_Var'>start_time</span></a> <span class='Operator'>- </span><span class='Number'>2</span> <span class='Operator'>&& 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
                        <a href="pg_ctl.c.html#LN579"><span class='Ref_To_Local'>pmpid</span></a> <span class='Operator'>== </span><a href="pg_ctl.c.html#LN522"><span class='Ref_to_Parameter'>pm_pid</span></a> 
<span class='Directive'>#else</span> 
                    <span class='Comment_Multi_Line'>/* Windows can only reject standalone-backend PIDs */ 
</span>                        <a href="pg_ctl.c.html#LN579"><span class='Ref_To_Local'>pmpid</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> 
<span class='Directive'>#endif</span> 
                        <span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * OK, seems to be a valid pidfile from our child. 
                         */ 
</span><a name="LN604"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>portnum</span><span class='Delimiter'>; 
</span><a name="LN605"></a>                        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sockdir</span><span class='Delimiter'>; 
</span><a name="LN606"></a>                        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>hostaddr</span><span class='Delimiter'>; 
</span><a name="LN607"></a>                        <span class='Keyword'>char</span>        <span class='Declare_Local'>host_str</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * Extract port number and host string to use. Prefer 
                         * using Unix socket if available. 
                         */ 
</span>                        <a href="pg_ctl.c.html#LN604"><span class='Ref_To_Local'>portnum</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><a href="../../include/miscadmin.h.html#LN453"><span class='Ref_to_Const'>LOCK_FILE_LINE_PORT</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pg_ctl.c.html#LN605"><span class='Ref_To_Local'>sockdir</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><a href="../../include/miscadmin.h.html#LN454"><span class='Ref_to_Const'>LOCK_FILE_LINE_SOCKET_DIR</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                        <a href="pg_ctl.c.html#LN606"><span class='Ref_To_Local'>hostaddr</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><a href="../../include/miscadmin.h.html#LN455"><span class='Ref_to_Const'>LOCK_FILE_LINE_LISTEN_ADDR</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * While unix_socket_directories can accept relative 
                         * directories, libpq's host parameter must have a 
                         * leading slash to indicate a socket directory.  So, 
                         * ignore sockdir if it's relative, and try to use TCP 
                         * instead. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN605"><span class='Ref_To_Local'>sockdir</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'/'</span><span class='Parentheses'>) 
</span>                            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN605"><span class='Ref_To_Local'>sockdir</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN606"><span class='Ref_To_Local'>hostaddr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* remove trailing newline */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                            <span class='Operator'>*</span>strchr<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* Fail if couldn't get either sockdir or host addr */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: -w option cannot use a relative socket directory specification\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN133"><span class='Ref_to_EnumConst'>PQPING_NO_ATTEMPT</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * Map listen-only addresses to counterparts usable 
                         * for establishing a connection.  connect() to "::" 
                         * or "0.0.0.0" is not portable to OpenBSD 5.0 or to 
                         * Windows Server 2008, and connect() to "::" is 
                         * additionally not portable to NetBSD 6.0.  (Cygwin 
                         * does handle both addresses, though.) 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>, </span><span class='String'>"*"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>, </span><span class='String'>"localhost"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>, </span><span class='String'>"0.0.0.0"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>, </span><span class='String'>"127.0.0.1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>, </span><span class='String'>"::"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Delimiter'>, </span><span class='String'>"::1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * We need to set connect_timeout otherwise on Windows 
                         * the Service Control Manager (SCM) will probably 
                         * timeout first. 
                         */ 
</span>                        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN525"><span class='Ref_To_Local'>connstr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN525"><span class='Ref_To_Local'>connstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <span class='String'>"dbname=postgres port=%d host='%s' connect_timeout=5"</span><span class='Delimiter'>, 
</span>                                 <a href="pg_ctl.c.html#LN604"><span class='Ref_To_Local'>portnum</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN607"><span class='Ref_To_Local'>host_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pmstart&GT;=start_time-2... &raquo; </span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if optlines[4]!=NULL&&op... &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (optlines=readfile(pi... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Free the results of readfile. 
             * 
             * This is safe to call even if optlines is NULL. 
             */ 
</span>            <a href="pg_ctl.c.html#LN146"><span class='Ref_to_Proto'>free_readfile</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN560"><span class='Ref_To_Local'>optlines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if connstr[0]=='\0' &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* If we have a connection string, ping the server */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN525"><span class='Ref_To_Local'>connstr</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN524"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN446"><span class='Ref_to_Proto'>PQping</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN525"><span class='Ref_To_Local'>connstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN524"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN130"><span class='Ref_to_EnumConst'>PQPING_OK</span></a> <span class='Operator'>|| </span><a href="pg_ctl.c.html#LN524"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN133"><span class='Ref_to_EnumConst'>PQPING_NO_ATTEMPT</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check whether the child postmaster process is still alive.  This 
         * lets us exit early if the postmaster fails during startup. 
         * 
         * On Windows, we may be checking the postmaster's parent shell, but 
         * that's fine for this purpose. 
         */ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
        <span class='Delimiter'>{ 
</span><a name="LN693"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>exitstatus</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../backend/postmaster/postmaster.c.html#LN445"><span class='Ref_to_Proto'>waitpid</span></a><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN522"><span class='Ref_to_Parameter'>pm_pid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN693"><span class='Ref_To_Local'>exitstatus</span></a><span class='Delimiter'>, </span><a href="../../backend/postmaster/postmaster.c.html#LN443"><span class='Ref_to_Const'>WNOHANG</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>)</span> <a href="pg_ctl.c.html#LN522"><span class='Ref_to_Parameter'>pm_pid</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN132"><span class='Ref_to_EnumConst'>PQPING_NO_RESPONSE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#else</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>WaitForSingleObject<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN106"><span class='Ref_to_Const'>postmasterProcess</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>== </span>WAIT_OBJECT_0<span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN132"><span class='Ref_to_EnumConst'>PQPING_NO_RESPONSE</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <span class='Comment_Multi_Line'>/* No response, or startup still in process; wait */ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN522"><span class='Ref_to_Parameter'>do_checkpoint</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Increment the wait hint by 6 secs (connection timeout + sleep) 
             * We must do this to indicate to the SCM that our startup time is 
             * changing, otherwise it'll usually send a stop signal after 20 
             * seconds, despite incrementing the checkpoint counter. 
             */ 
</span>            <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwWaitHint <span class='Operator'>+= </span><span class='Number'>6000</span><span class='Delimiter'>; 
</span>            <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwCheckPoint<span class='Operator'>++</span><span class='Delimiter'>; 
</span>            SetServiceStatus<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN101"><span class='Ref_to_Global_Var'>hStatus</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>LPSERVICE_STATUS<span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
            <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span><span class='String'>"."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* 1 sec */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;wait_seconds;i+... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* return result of last call to PQping */ 
</span>    <span class='Control'>return</span> <a href="pg_ctl.c.html#LN524"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end test_postmaster_connection &raquo; </span> 
 
 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_GETRLIMIT<span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span>RLIMIT_CORE<span class='Parentheses'>) 
</span><span class='Keyword'>static void 
</span><a name="LN731"></a><span class='Declare_Function'>unlimit_core_size</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN733"></a>    <span class='Control'>struct</span> rlimit <span class='Declare_Local'>lim</span><span class='Delimiter'>; 
</span> 
    getrlimit<span class='Parentheses'>(</span>RLIMIT_CORE<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN733"><span class='Ref_To_Local'>lim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN733"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_max <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: cannot set core file size limit; disallowed by hard limit\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN733"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_max <span class='Operator'>== </span>RLIM_INFINITY <span class='Operator'>|| </span><a href="pg_ctl.c.html#LN733"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_cur <span class='Operator'>&LT; </span><a href="pg_ctl.c.html#LN733"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_max<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN733"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_cur <span class='Operator'>= </span><a href="pg_ctl.c.html#LN733"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_max<span class='Delimiter'>; 
</span>        setrlimit<span class='Parentheses'>(</span>RLIMIT_CORE<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN733"><span class='Ref_To_Local'>lim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Keyword'>static void 
</span><a name="LN751"></a><span class='Declare_Function'>read_post_opts</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* default */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>== </span><a href="pg_ctl.c.html#LN58"><span class='Ref_to_EnumConst'>RESTART_COMMAND</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN758"></a>            <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>optlines</span><span class='Delimiter'>; 
</span> 
            <a href="pg_ctl.c.html#LN758"><span class='Ref_To_Local'>optlines</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN92"><span class='Ref_to_Global_Var'>postopts_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN758"><span class='Ref_To_Local'>optlines</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not read file \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN92"><span class='Ref_to_Global_Var'>postopts_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN758"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="pg_ctl.c.html#LN758"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: option file \"%s\" must have exactly one line\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN92"><span class='Ref_to_Global_Var'>postopts_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN774"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN775"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>optline</span><span class='Delimiter'>; 
</span><a name="LN776"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span><span class='Delimiter'>; 
</span> 
                <a href="pg_ctl.c.html#LN775"><span class='Ref_To_Local'>optline</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN758"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>                <span class='Comment_Multi_Line'>/* trim off line endings */ 
</span>                <a href="pg_ctl.c.html#LN774"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span>strcspn<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN775"><span class='Ref_To_Local'>optline</span></a><span class='Delimiter'>, </span><span class='String'>"\r\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_ctl.c.html#LN775"><span class='Ref_To_Local'>optline</span></a><span class='Delimiter'>[</span><a href="pg_ctl.c.html#LN774"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Are we at the first option, as defined by space and 
                 * double-quote? 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN776"><span class='Ref_To_Local'>arg1</span></a> <span class='Operator'>= </span>strstr<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN775"><span class='Ref_To_Local'>optline</span></a><span class='Delimiter'>, </span><span class='String'>" \""</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="pg_ctl.c.html#LN776"><span class='Ref_To_Local'>arg1</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>       <span class='Comment_Multi_Line'>/* terminate so we get only program 
                                         * name */ 
</span>                    <a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN776"><span class='Ref_To_Local'>arg1</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* point past whitespace */ 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN775"><span class='Ref_To_Local'>optline</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* Free the results of readfile. */ 
</span>            <a href="pg_ctl.c.html#LN146"><span class='Ref_to_Proto'>free_readfile</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN758"><span class='Ref_To_Local'>optlines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ctl_command==RESTART_... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if post_opts==NULL &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end read_post_opts &raquo; </span> 
 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN804"></a><span class='Declare_Function'>find_other_exec_or_die</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>argv0</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>target</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>versionstr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN806"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN807"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>found_path</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN807"><span class='Ref_To_Local'>found_path</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN806"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN97"><span class='Ref_to_Proto'>find_other_exec</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN804"><span class='Ref_to_Parameter'>argv0</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN804"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN804"><span class='Ref_to_Parameter'>versionstr</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN807"><span class='Ref_To_Local'>found_path</span></a><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN813"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>full_path</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN96"><span class='Ref_to_Proto'>find_my_exec</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN804"><span class='Ref_to_Parameter'>argv0</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN813"><span class='Ref_To_Local'>full_path</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN813"><span class='Ref_To_Local'>full_path</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN813"><span class='Ref_To_Local'>full_path</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN806"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"The program \"%s\" is needed by %s "</span> 
                           <span class='String'>"but was not found in the\n"</span> 
                           <span class='String'>"same directory as \"%s\".\n"</span> 
                           <span class='String'>"Check your installation.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="pg_ctl.c.html#LN804"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN813"><span class='Ref_To_Local'>full_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"The program \"%s\" was found by \"%s\"\n"</span> 
                           <span class='String'>"but was not the same version as %s.\n"</span> 
                           <span class='String'>"Check your installation.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="pg_ctl.c.html#LN804"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN813"><span class='Ref_To_Local'>full_path</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (ret=find_other_exec(... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="pg_ctl.c.html#LN807"><span class='Ref_To_Local'>found_path</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_other_exec_or_die &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN836"></a><span class='Declare_Function'>do_init</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN838"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>cmd</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN803"><span class='Ref_to_Func'>find_other_exec_or_die</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN88"><span class='Ref_to_Global_Var'>argv0</span></a><span class='Delimiter'>, </span><span class='String'>"initdb"</span><span class='Delimiter'>, </span><span class='String'>"initdb (PostgreSQL) "</span> PG_VERSION <span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_ctl.c.html#LN73"><span class='Ref_to_Global_Var'>silent_mode</span></a><span class='Parentheses'>) 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN838"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"\"%s\" %s%s"</span><span class='Delimiter'>, 
</span>                 <a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN838"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"\"%s\" %s%s &GT; \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Delimiter'>, </span><a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN838"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: database system initialization failed\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end do_init &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN864"></a><span class='Declare_Function'>do_start</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN866"></a>    <a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a>     <span class='Declare_Local'>old_pid</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN867"></a>    <a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a>     <span class='Declare_Local'>pm_pid</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>!= </span><a href="pg_ctl.c.html#LN58"><span class='Ref_to_EnumConst'>RESTART_COMMAND</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN866"><span class='Ref_To_Local'>old_pid</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN144"><span class='Ref_to_Proto'>get_pgpid</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN866"><span class='Ref_To_Local'>old_pid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: another server might be running; "</span> 
                           <span class='String'>"trying to start server anyway\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_ctl.c.html#LN148"><span class='Ref_to_Proto'>read_post_opts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* No -D or -D already added during server start */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>== </span><a href="pg_ctl.c.html#LN58"><span class='Ref_to_EnumConst'>RESTART_COMMAND</span></a> <span class='Operator'>|| </span><a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN803"><span class='Ref_to_Func'>find_other_exec_or_die</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN88"><span class='Ref_to_Global_Var'>argv0</span></a><span class='Delimiter'>, </span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><a href="../../include/miscadmin.h.html#LN30"><span class='Ref_to_Const'>PG_BACKEND_VERSIONSTR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_GETRLIMIT<span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span>RLIMIT_CORE<span class='Parentheses'>) 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN89"><span class='Ref_to_Global_Var'>allow_core_files</span></a><span class='Parentheses'>) 
</span>        <a href="pg_ctl.c.html#LN154"><span class='Ref_to_Proto'>unlimit_core_size</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If possible, tell the postmaster our parent shell's PID (see the 
     * comments in CreateLockFile() for motivation).  Windows hasn't got 
     * getppid() unfortunately. 
     */ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Delimiter'>{ 
</span><a name="LN899"></a>        <span class='Keyword'>static char </span><span class='Declare_Local'>env_var</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN899"><span class='Ref_To_Local'>env_var</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN899"><span class='Ref_To_Local'>env_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"PG_GRANDPARENT_PID=%d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>getppid<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN899"><span class='Ref_To_Local'>env_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <a href="pg_ctl.c.html#LN867"><span class='Ref_To_Local'>pm_pid</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN147"><span class='Ref_to_Proto'>start_postmaster</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN70"><span class='Ref_to_Global_Var'>do_wait</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"waiting for server to start..."</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN150"><span class='Ref_to_Proto'>test_postmaster_connection</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN867"><span class='Ref_To_Local'>pm_pid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN130"><span class='Ref_to_EnumConst'>PQPING_OK</span></a><span class='Operator'>: 
</span>                <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" done\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"server started\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN131"><span class='Ref_to_EnumConst'>PQPING_REJECT</span></a><span class='Operator'>: 
</span>                <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" stopped waiting\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"server is still starting up\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN132"><span class='Ref_to_EnumConst'>PQPING_NO_RESPONSE</span></a><span class='Operator'>: 
</span>                <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" stopped waiting\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not start server\n"</span> 
                               <span class='String'>"Examine the log output.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN133"><span class='Ref_to_EnumConst'>PQPING_NO_ATTEMPT</span></a><span class='Operator'>: 
</span>                <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" failed\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not wait for server because of misconfiguration\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch test_postmaster_conne... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if do_wait &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"server starting\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Comment_Multi_Line'>/* Now we don't need the handle to the shell process anymore */ 
</span>    CloseHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN106"><span class='Ref_to_Const'>postmasterProcess</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN106"><span class='Ref_to_Const'>postmasterProcess</span></a> <span class='Operator'>= </span>INVALID_HANDLE_VALUE<span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do_start &raquo; </span> 
 
 
<span class='Keyword'>static void 
</span><a name="LN949"></a><span class='Declare_Function'>do_stop</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN951"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cnt</span><span class='Delimiter'>; 
</span><a name="LN952"></a>    <a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a>     <span class='Declare_Local'>pid</span><span class='Delimiter'>; 
</span><a name="LN953"></a>    <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>statbuf</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN952"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN144"><span class='Ref_to_Proto'>get_pgpid</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN952"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* no pid file */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: PID file \"%s\" does not exist\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN94"><span class='Ref_to_Global_Var'>pid_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Is server running?\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN952"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>           <span class='Comment_Single_Line'>/* standalone backend, not postmaster */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN952"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= -</span><a href="pg_ctl.c.html#LN952"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: cannot stop server; "</span> 
                       <span class='String'>"single-user server is running (PID: %ld)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN952"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN952"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not send stop signal (PID: %ld): %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN952"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>, 
</span>                     <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_ctl.c.html#LN70"><span class='Ref_to_Global_Var'>do_wait</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"server shutting down\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If backup_label exists, an online backup is running. Warn the user 
         * that smart shutdown will wait for it to finish. However, if the 
         * server is in archive recovery, we're recovering from an online 
         * backup instead of performing one. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN74"><span class='Ref_to_Global_Var'>shutdown_mode</span></a> <span class='Operator'>== </span><a href="pg_ctl.c.html#LN46"><span class='Ref_to_EnumConst'>SMART_MODE</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN95"><span class='Ref_to_Global_Var'>backup_file</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN953"><span class='Ref_To_Local'>statbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="pg_ctl.c.html#LN157"><span class='Ref_to_Proto'>get_control_dbstate</span></a><span class='Parentheses'>() </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_control.h.html#LN90"><span class='Ref_to_EnumConst'>DB_IN_ARCHIVE_RECOVERY</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"WARNING: online backup mode is active\n"</span> 
                        <span class='String'>"Shutdown will not complete until pg_stop_backup() is called.\n\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"waiting for server to shut down..."</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN951"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN951"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>&LT; </span><a href="pg_ctl.c.html#LN71"><span class='Ref_to_Global_Var'>wait_seconds</span></a><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN951"><span class='Ref_To_Local'>cnt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN952"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN144"><span class='Ref_to_Proto'>get_pgpid</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span><span class='String'>"."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* 1 sec */ 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN952"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span>           <span class='Comment_Single_Line'>/* pid file still exists */ 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" failed\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: server does not shut down\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN74"><span class='Ref_to_Global_Var'>shutdown_mode</span></a> <span class='Operator'>== </span><a href="pg_ctl.c.html#LN46"><span class='Ref_to_EnumConst'>SMART_MODE</span></a><span class='Parentheses'>) 
</span>                <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"HINT: The \"-m fast\" option immediately disconnects sessions rather than\n"</span> 
                          <span class='String'>"waiting for session-initiated disconnection.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" done\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"server stopped\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do_stop &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  restart/reload routines 
 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1035"></a><span class='Declare_Function'>do_restart</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1037"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cnt</span><span class='Delimiter'>; 
</span><a name="LN1038"></a>    <a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a>     <span class='Declare_Local'>pid</span><span class='Delimiter'>; 
</span><a name="LN1039"></a>    <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>statbuf</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN144"><span class='Ref_to_Proto'>get_pgpid</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* no pid file */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: PID file \"%s\" does not exist\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN94"><span class='Ref_to_Global_Var'>pid_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Is server running?\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"starting server anyway\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../backend/bootstrap/bootparse.y.html#LN67"><span class='Ref_to_Func'>do_start</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>           <span class='Comment_Single_Line'>/* standalone backend, not postmaster */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= -</span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN151"><span class='Ref_to_Proto'>postmaster_is_alive</span></a><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: cannot restart server; "</span> 
                           <span class='String'>"single-user server is running (PID: %ld)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Please terminate the single-user server and try again.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN151"><span class='Ref_to_Proto'>postmaster_is_alive</span></a><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not send stop signal (PID: %ld): %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>, 
</span>                         <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If backup_label exists, an online backup is running. Warn the user 
         * that smart shutdown will wait for it to finish. However, if the 
         * server is in archive recovery, we're recovering from an online 
         * backup instead of performing one. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN74"><span class='Ref_to_Global_Var'>shutdown_mode</span></a> <span class='Operator'>== </span><a href="pg_ctl.c.html#LN46"><span class='Ref_to_EnumConst'>SMART_MODE</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN95"><span class='Ref_to_Global_Var'>backup_file</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1039"><span class='Ref_To_Local'>statbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="pg_ctl.c.html#LN157"><span class='Ref_to_Proto'>get_control_dbstate</span></a><span class='Parentheses'>() </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_control.h.html#LN90"><span class='Ref_to_EnumConst'>DB_IN_ARCHIVE_RECOVERY</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"WARNING: online backup mode is active\n"</span> 
                        <span class='String'>"Shutdown will not complete until pg_stop_backup() is called.\n\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"waiting for server to shut down..."</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* always wait for restart */ 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1037"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN1037"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>&LT; </span><a href="pg_ctl.c.html#LN71"><span class='Ref_to_Global_Var'>wait_seconds</span></a><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN1037"><span class='Ref_To_Local'>cnt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN144"><span class='Ref_to_Proto'>get_pgpid</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span><span class='String'>"."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* 1 sec */ 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span>           <span class='Comment_Single_Line'>/* pid file still exists */ 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" failed\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: server does not shut down\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN74"><span class='Ref_to_Global_Var'>shutdown_mode</span></a> <span class='Operator'>== </span><a href="pg_ctl.c.html#LN46"><span class='Ref_to_EnumConst'>SMART_MODE</span></a><span class='Parentheses'>) 
</span>                <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"HINT: The \"-m fast\" option immediately disconnects sessions rather than\n"</span> 
                          <span class='String'>"waiting for session-initiated disconnection.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" done\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"server stopped\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if postmaster_is_alive((... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: old server process (PID: %ld) seems to be gone\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1038"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"starting server anyway\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../backend/bootstrap/bootparse.y.html#LN67"><span class='Ref_to_Func'>do_start</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end do_restart &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1128"></a><span class='Declare_Function'>do_reload</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1130"></a>    <a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a>     <span class='Declare_Local'>pid</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN1130"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN144"><span class='Ref_to_Proto'>get_pgpid</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1130"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* no pid file */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: PID file \"%s\" does not exist\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN94"><span class='Ref_to_Global_Var'>pid_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Is server running?\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1130"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>           <span class='Comment_Single_Line'>/* standalone backend, not postmaster */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN1130"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= -</span><a href="pg_ctl.c.html#LN1130"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: cannot reload server; "</span> 
                       <span class='String'>"single-user server is running (PID: %ld)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1130"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Please terminate the single-user server and try again.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN1130"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not send reload signal (PID: %ld): %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1130"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"server signaled\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end do_reload &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * promote 
 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1165"></a><span class='Declare_Function'>do_promote</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1167"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>prmfile</span><span class='Delimiter'>; 
</span><a name="LN1168"></a>    <a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a>     <span class='Declare_Local'>pid</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN1168"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN144"><span class='Ref_to_Proto'>get_pgpid</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1168"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* no pid file */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: PID file \"%s\" does not exist\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN94"><span class='Ref_to_Global_Var'>pid_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Is server running?\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1168"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>           <span class='Comment_Single_Line'>/* standalone backend, not postmaster */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN1168"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= -</span><a href="pg_ctl.c.html#LN1168"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: cannot promote server; "</span> 
                       <span class='String'>"single-user server is running (PID: %ld)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1168"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN157"><span class='Ref_to_Proto'>get_control_dbstate</span></a><span class='Parentheses'>() </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_control.h.html#LN90"><span class='Ref_to_EnumConst'>DB_IN_ARCHIVE_RECOVERY</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: cannot promote server; "</span> 
                       <span class='String'>"server is not in standby mode\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For 9.3 onwards, "fast" promotion is performed. Promotion with a full 
     * checkpoint is still possible by writing a file called 
     * "fallback_promote" instead of "promote" 
     */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN96"><span class='Ref_to_Global_Var'>promote_file</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/promote"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN1167"><span class='Ref_To_Local'>prmfile</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN96"><span class='Ref_to_Global_Var'>promote_file</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not create promote signal file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN96"><span class='Ref_to_Global_Var'>promote_file</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1167"><span class='Ref_To_Local'>prmfile</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not write promote signal file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN96"><span class='Ref_to_Global_Var'>promote_file</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN201"><span class='Ref_to_Const'>SIGUSR1</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN1168"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not send promote signal (PID: %ld): %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1168"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN96"><span class='Ref_to_Global_Var'>promote_file</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not remove promote signal file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN96"><span class='Ref_to_Global_Var'>promote_file</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN70"><span class='Ref_to_Global_Var'>do_wait</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1228"></a>        <a href="../../include/catalog/pg_control.h.html#LN83"><span class='Ref_to_Enum'>DBState</span></a>     <span class='Declare_Local'>state</span> <span class='Operator'>= </span><a href="../../include/catalog/pg_control.h.html#LN85"><span class='Ref_to_EnumConst'>DB_STARTUP</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"waiting for server to promote..."</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN71"><span class='Ref_to_Global_Var'>wait_seconds</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN1228"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN157"><span class='Ref_to_Proto'>get_control_dbstate</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1228"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_control.h.html#LN91"><span class='Ref_to_EnumConst'>DB_IN_PRODUCTION</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span><span class='String'>"."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* 1 sec */ 
</span>            <a href="pg_ctl.c.html#LN71"><span class='Ref_to_Global_Var'>wait_seconds</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1228"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_control.h.html#LN91"><span class='Ref_to_EnumConst'>DB_IN_PRODUCTION</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" done\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"server promoted\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" stopped waiting\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"server is still promoting\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if do_wait &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="pg_ctl.c.html#LN123"><span class='Ref_to_Proto'>print_msg</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"server promoting\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end do_promote &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  utility routines 
 */ 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN1262"></a><span class='Declare_Function'>postmaster_is_alive</span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a> <span class='Declare_Parameter'>pid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Test to see if the process is still there.  Note that we do not 
     * consider an EPERM failure to mean that the process is still there; 
     * EPERM must mean that the given PID belongs to some other userid, and 
     * considering the permissions on $PGDATA, that means it's not the 
     * postmaster we are after. 
     * 
     * Don't believe that our own PID or parent shell's PID is the postmaster, 
     * either.  (Windows hasn't got getppid(), though.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1262"><span class='Ref_to_Parameter'>pid</span></a> <span class='Operator'>== </span>getpid<span class='Parentheses'>())</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1262"><span class='Ref_to_Parameter'>pid</span></a> <span class='Operator'>== </span>getppid<span class='Parentheses'>())</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1262"><span class='Ref_to_Parameter'>pid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postmaster_is_alive &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1286"></a><span class='Declare_Function'>do_status</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1288"></a>    <a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a>     <span class='Declare_Local'>pid</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN1288"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN144"><span class='Ref_to_Proto'>get_pgpid</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Is there a pid file? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1288"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* standalone backend? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1288"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN1288"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= -</span><a href="pg_ctl.c.html#LN1288"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN151"><span class='Ref_to_Proto'>postmaster_is_alive</span></a><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN1288"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: single-user server is running (PID: %ld)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1288"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Comment_Multi_Line'>/* must be a postmaster */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN151"><span class='Ref_to_Proto'>postmaster_is_alive</span></a><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN1288"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN1310"></a>                <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>optlines</span><span class='Delimiter'>; 
</span><a name="LN1311"></a>                <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>curr_line</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: server is running (PID: %ld)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1288"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pg_ctl.c.html#LN1310"><span class='Ref_To_Local'>optlines</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN145"><span class='Ref_to_Proto'>readfile</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN92"><span class='Ref_to_Global_Var'>postopts_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1310"><span class='Ref_To_Local'>optlines</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1311"><span class='Ref_To_Local'>curr_line</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN1310"><span class='Ref_To_Local'>optlines</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="pg_ctl.c.html#LN1311"><span class='Ref_To_Local'>curr_line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_ctl.c.html#LN1311"><span class='Ref_To_Local'>curr_line</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_ctl.c.html#LN1311"><span class='Ref_To_Local'>curr_line</span></a><span class='Delimiter'>, </span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Free the results of readfile */ 
</span>                    <a href="pg_ctl.c.html#LN146"><span class='Ref_to_Proto'>free_readfile</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1310"><span class='Ref_To_Local'>optlines</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pid!=0 &raquo; </span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: no server running\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The Linux Standard Base Core Specification 3.1 says this should return 
     * '3, program is not running' 
     * https://refspecs.linuxbase.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-gener 
     * ic/iniscrptact.html 
     */ 
</span>    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end do_status &raquo; </span> 
 
 
 
<span class='Keyword'>static void 
</span><a name="LN1343"></a><span class='Declare_Function'>do_kill</span><span class='Parentheses'>(</span><a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a> <span class='Declare_Parameter'>pid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN1343"><span class='Ref_to_Parameter'>pid</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not send signal %d (PID: %ld): %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1343"><span class='Ref_to_Parameter'>pid</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
<span class='Directive'>#if</span> <span class='Parentheses'>(</span>_MSC_VER <span class='Operator'>&LT; </span><span class='Number'>1800</span><span class='Parentheses'>) 
</span><span class='Keyword'>static bool 
</span><a name="LN1357"></a><span class='Declare_Function'>IsWindowsXPOrGreater</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1359"></a>    OSVERSIONINFO <span class='Declare_Local'>osv</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN1359"><span class='Ref_To_Local'>osv</span></a><span class='Operator'>.</span>dwOSVersionInfoSize <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1359"><span class='Ref_To_Local'>osv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Windows XP = Version 5.1 */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>GetVersionEx<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1359"><span class='Ref_To_Local'>osv</span></a><span class='Parentheses'>) </span><span class='Operator'>||</span>      <span class='Comment_Single_Line'>/* could not get version */ 
</span>            <a href="pg_ctl.c.html#LN1359"><span class='Ref_To_Local'>osv</span></a><span class='Operator'>.</span>dwMajorVersion <span class='Operator'>&GT; </span><span class='Number'>5</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1359"><span class='Ref_To_Local'>osv</span></a><span class='Operator'>.</span>dwMajorVersion <span class='Operator'>== </span><span class='Number'>5</span> <span class='Operator'>&& </span><a href="pg_ctl.c.html#LN1359"><span class='Ref_To_Local'>osv</span></a><span class='Operator'>.</span>dwMinorVersion <span class='Operator'>&GT;= </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN1369"></a><span class='Declare_Function'>IsWindows7OrGreater</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1371"></a>    OSVERSIONINFO <span class='Declare_Local'>osv</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN1371"><span class='Ref_To_Local'>osv</span></a><span class='Operator'>.</span>dwOSVersionInfoSize <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1371"><span class='Ref_To_Local'>osv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Windows 7 = Version 6.0 */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>GetVersionEx<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1371"><span class='Ref_To_Local'>osv</span></a><span class='Parentheses'>) </span><span class='Operator'>||</span>      <span class='Comment_Single_Line'>/* could not get version */ 
</span>            <a href="pg_ctl.c.html#LN1371"><span class='Ref_To_Local'>osv</span></a><span class='Operator'>.</span>dwMajorVersion <span class='Operator'>&GT; </span><span class='Number'>6</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1371"><span class='Ref_To_Local'>osv</span></a><span class='Operator'>.</span>dwMajorVersion <span class='Operator'>== </span><span class='Number'>6</span> <span class='Operator'>&& </span><a href="pg_ctl.c.html#LN1371"><span class='Ref_To_Local'>osv</span></a><span class='Operator'>.</span>dwMinorVersion <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Keyword'>static bool 
</span><a name="LN1382"></a><span class='Declare_Function'>pgwin32_IsInstalled</span><span class='Parentheses'>(</span>SC_HANDLE <span class='Declare_Parameter'>hSCM</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1384"></a>    SC_HANDLE   <span class='Declare_Local'>hService</span> <span class='Operator'>= </span>OpenService<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1382"><span class='Ref_to_Parameter'>hSCM</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Delimiter'>, </span>SERVICE_QUERY_CONFIG<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1385"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>bResult</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1384"><span class='Ref_To_Local'>hService</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1385"><span class='Ref_To_Local'>bResult</span></a><span class='Parentheses'>) 
</span>        CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1384"><span class='Ref_To_Local'>hService</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_ctl.c.html#LN1385"><span class='Ref_To_Local'>bResult</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN1393"></a><span class='Declare_Function'>pgwin32_CommandLine</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>registration</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1395"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>cmdLine</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1396"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>cmdPath</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN1397"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1393"><span class='Ref_to_Parameter'>registration</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN1397"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN96"><span class='Ref_to_Proto'>find_my_exec</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN88"><span class='Ref_to_Global_Var'>argv0</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1397"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not find own program executable\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN1397"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN97"><span class='Ref_to_Proto'>find_other_exec</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN88"><span class='Ref_to_Global_Var'>argv0</span></a><span class='Delimiter'>, </span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><a href="../../include/miscadmin.h.html#LN30"><span class='Ref_to_Const'>PG_BACKEND_VERSIONSTR</span></a><span class='Delimiter'>, 
</span>                              <a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1397"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not find postgres program executable\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* if path does not end in .exe, append it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT; </span><span class='Number'>4</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='String'>".exe"</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>".exe"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* use backslashes in path to avoid problems with some third-party tools */ 
</span>    <a href="../../include/port.h.html#LN43"><span class='Ref_to_Proto'>make_native_path</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* be sure to double-quote the executable's name in the command */ 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1395"><span class='Ref_To_Local'>cmdLine</span></a><span class='Delimiter'>, </span><span class='String'>"\"%s\""</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1396"><span class='Ref_To_Local'>cmdPath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* append assorted switches to the command line, as needed */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1393"><span class='Ref_to_Parameter'>registration</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1395"><span class='Ref_To_Local'>cmdLine</span></a><span class='Delimiter'>, </span><span class='String'>" runservice -N \"%s\""</span><span class='Delimiter'>, 
</span>                          <a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We need the -D path to be absolute */ 
</span><a name="LN1440"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dataDir</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN1440"><span class='Ref_To_Local'>dataDir</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN48"><span class='Ref_to_Proto'>make_absolute_path</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* make_absolute_path already reported the error */ 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/port.h.html#LN43"><span class='Ref_to_Proto'>make_native_path</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1440"><span class='Ref_To_Local'>dataDir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1395"><span class='Ref_To_Local'>cmdLine</span></a><span class='Delimiter'>, </span><span class='String'>" -D \"%s\""</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1440"><span class='Ref_To_Local'>dataDir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1440"><span class='Ref_To_Local'>dataDir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1393"><span class='Ref_to_Parameter'>registration</span></a> <span class='Operator'>&& </span><a href="../pgevent/pgevent.c.html#LN24"><span class='Ref_to_Global_Var'>event_source</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1395"><span class='Ref_To_Local'>cmdLine</span></a><span class='Delimiter'>, </span><span class='String'>" -e \"%s\""</span><span class='Delimiter'>, </span><a href="../pgevent/pgevent.c.html#LN24"><span class='Ref_to_Global_Var'>event_source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1393"><span class='Ref_to_Parameter'>registration</span></a> <span class='Operator'>&& </span><a href="pg_ctl.c.html#LN70"><span class='Ref_to_Global_Var'>do_wait</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1395"><span class='Ref_To_Local'>cmdLine</span></a><span class='Delimiter'>, </span><span class='String'>" -w"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't propagate a value from an environment variable. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1393"><span class='Ref_to_Parameter'>registration</span></a> <span class='Operator'>&& </span><a href="pg_ctl.c.html#LN72"><span class='Ref_to_Global_Var'>wait_seconds_arg</span></a> <span class='Operator'>&& </span><a href="pg_ctl.c.html#LN71"><span class='Ref_to_Global_Var'>wait_seconds</span></a> <span class='Operator'>!= </span><a href="pg_ctl.c.html#LN68"><span class='Ref_to_Const'>DEFAULT_WAIT</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1395"><span class='Ref_To_Local'>cmdLine</span></a><span class='Delimiter'>, </span><span class='String'>" -t %d"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN71"><span class='Ref_to_Global_Var'>wait_seconds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1393"><span class='Ref_to_Parameter'>registration</span></a> <span class='Operator'>&& </span><a href="pg_ctl.c.html#LN73"><span class='Ref_to_Global_Var'>silent_mode</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1395"><span class='Ref_To_Local'>cmdLine</span></a><span class='Delimiter'>, </span><span class='String'>" -s"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1393"><span class='Ref_to_Parameter'>registration</span></a><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1395"><span class='Ref_To_Local'>cmdLine</span></a><span class='Delimiter'>, </span><span class='String'>" -o \"%s\""</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1395"><span class='Ref_To_Local'>cmdLine</span></a><span class='Delimiter'>, </span><span class='String'>" %s"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pg_ctl.c.html#LN1395"><span class='Ref_To_Local'>cmdLine</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgwin32_CommandLine &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1477"></a><span class='Declare_Function'>pgwin32_doRegister</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1479"></a>    SC_HANDLE   <span class='Declare_Local'>hService</span><span class='Delimiter'>; 
</span><a name="LN1480"></a>    SC_HANDLE   <span class='Declare_Local'>hSCM</span> <span class='Operator'>= </span>OpenSCManager<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span>SC_MANAGER_ALL_ACCESS<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1480"><span class='Ref_To_Local'>hSCM</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open service manager\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN133"><span class='Ref_to_Proto'>pgwin32_IsInstalled</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1480"><span class='Ref_To_Local'>hSCM</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1480"><span class='Ref_To_Local'>hSCM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: service \"%s\" already registered\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN1479"><span class='Ref_To_Local'>hService</span></a> <span class='Operator'>= </span>CreateService<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1480"><span class='Ref_To_Local'>hSCM</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Delimiter'>, 
</span>                               SERVICE_ALL_ACCESS<span class='Delimiter'>, </span>SERVICE_WIN32_OWN_PROCESS<span class='Delimiter'>, 
</span>                                  <a href="pg_ctl.c.html#LN99"><span class='Ref_to_Global_Var'>pgctl_start_type</span></a><span class='Delimiter'>, </span>SERVICE_ERROR_NORMAL<span class='Delimiter'>, 
</span>                                  <a href="pg_ctl.c.html#LN134"><span class='Ref_to_Proto'>pgwin32_CommandLine</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>       <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>"RPCSS\0"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN86"><span class='Ref_to_Global_Var'>register_username</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN87"><span class='Ref_to_Global_Var'>register_password</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1480"><span class='Ref_To_Local'>hSCM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not register service \"%s\": error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1479"><span class='Ref_To_Local'>hService</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1480"><span class='Ref_To_Local'>hSCM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgwin32_doRegister &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1511"></a><span class='Declare_Function'>pgwin32_doUnregister</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1513"></a>    SC_HANDLE   <span class='Declare_Local'>hService</span><span class='Delimiter'>; 
</span><a name="LN1514"></a>    SC_HANDLE   <span class='Declare_Local'>hSCM</span> <span class='Operator'>= </span>OpenSCManager<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span>SC_MANAGER_ALL_ACCESS<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1514"><span class='Ref_To_Local'>hSCM</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open service manager\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_ctl.c.html#LN133"><span class='Ref_to_Proto'>pgwin32_IsInstalled</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1514"><span class='Ref_To_Local'>hSCM</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1514"><span class='Ref_To_Local'>hSCM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: service \"%s\" not registered\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN1513"><span class='Ref_To_Local'>hService</span></a> <span class='Operator'>= </span>OpenService<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1514"><span class='Ref_To_Local'>hSCM</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Delimiter'>, </span>DELETE<span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1514"><span class='Ref_To_Local'>hSCM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open service \"%s\": error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>DeleteService<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1513"><span class='Ref_To_Local'>hService</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1513"><span class='Ref_To_Local'>hService</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1514"><span class='Ref_To_Local'>hSCM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not unregister service \"%s\": error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1513"><span class='Ref_To_Local'>hService</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CloseServiceHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1514"><span class='Ref_To_Local'>hSCM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgwin32_doUnregister &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1550"></a><span class='Declare_Function'>pgwin32_SetServiceStatus</span><span class='Parentheses'>(</span><span class='Keyword'>DWORD </span><span class='Declare_Parameter'>currentState</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwCurrentState <span class='Operator'>= </span><a href="pg_ctl.c.html#LN1550"><span class='Ref_to_Parameter'>currentState</span></a><span class='Delimiter'>; 
</span>    SetServiceStatus<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN101"><span class='Ref_to_Global_Var'>hStatus</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>LPSERVICE_STATUS<span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void </span>WINAPI 
<a name="LN1557"></a><span class='Declare_Function'>pgwin32_ServiceHandler</span><span class='Parentheses'>(</span><span class='Keyword'>DWORD </span><span class='Declare_Parameter'>request</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1557"><span class='Ref_to_Parameter'>request</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> SERVICE_CONTROL_STOP<span class='Operator'>: 
</span>        <span class='Control'>case</span> SERVICE_CONTROL_SHUTDOWN<span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We only need a short wait hint here as it just needs to wait 
             * for the next checkpoint. They occur every 5 seconds during 
             * shutdown 
             */ 
</span>            <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwWaitHint <span class='Operator'>= </span><span class='Number'>10000</span><span class='Delimiter'>; 
</span>            <a href="pg_ctl.c.html#LN137"><span class='Ref_to_Proto'>pgwin32_SetServiceStatus</span></a><span class='Parentheses'>(</span>SERVICE_STOP_PENDING<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            SetEvent<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN105"><span class='Ref_to_Const'>shutdownEvent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> SERVICE_CONTROL_PAUSE<span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Win32 config reloading */ 
</span>            <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwWaitHint <span class='Operator'>= </span><span class='Number'>5000</span><span class='Delimiter'>; 
</span>            <a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN103"><span class='Ref_to_Global_Var'>postmasterPID</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN187"><span class='Ref_to_Const'>SIGHUP</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* FIXME: These could be used to replace other signals etc */ 
</span>        <span class='Control'>case</span> SERVICE_CONTROL_CONTINUE<span class='Operator'>: 
</span>        <span class='Control'>case</span> SERVICE_CONTROL_INTERROGATE<span class='Operator'>: 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch request &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pgwin32_ServiceHandler &raquo; </span> 
 
<span class='Keyword'>static void </span>WINAPI 
<a name="LN1589"></a><span class='Declare_Function'>pgwin32_ServiceMain</span><span class='Parentheses'>(</span><span class='Keyword'>DWORD </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span>LPTSTR <span class='Operator'>*</span><span class='Declare_Parameter'>argv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1591"></a>    PROCESS_INFORMATION <span class='Declare_Local'>pi</span><span class='Delimiter'>; 
</span><a name="LN1592"></a>    <span class='Keyword'>DWORD</span>       <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize variables */ 
</span>    <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwWin32ExitCode <span class='Operator'>= </span>S_OK<span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwCheckPoint <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwWaitHint <span class='Operator'>= </span><span class='Number'>60000</span><span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwServiceType <span class='Operator'>= </span>SERVICE_WIN32_OWN_PROCESS<span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwControlsAccepted <span class='Operator'>= </span>SERVICE_ACCEPT_STOP <span class='Operator'>| </span>SERVICE_ACCEPT_SHUTDOWN <span class='Operator'>| </span>SERVICE_ACCEPT_PAUSE_CONTINUE<span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwServiceSpecificExitCode <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwCurrentState <span class='Operator'>= </span>SERVICE_START_PENDING<span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1591"><span class='Ref_To_Local'>pi</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1591"><span class='Ref_To_Local'>pi</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN148"><span class='Ref_to_Proto'>read_post_opts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Register the control request handler */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN101"><span class='Ref_to_Global_Var'>hStatus</span></a> <span class='Operator'>= </span>RegisterServiceCtrlHandler<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN138"><span class='Ref_to_Proto'>pgwin32_ServiceHandler</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Parentheses'>(</span>SERVICE_STATUS_HANDLE<span class='Parentheses'>)</span> <span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN105"><span class='Ref_to_Const'>shutdownEvent</span></a> <span class='Operator'>= </span>CreateEvent<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Start the postmaster */ 
</span>    <a href="pg_ctl.c.html#LN137"><span class='Ref_to_Proto'>pgwin32_SetServiceStatus</span></a><span class='Parentheses'>(</span>SERVICE_START_PENDING<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/common/restricted_token.h.html#LN20"><span class='Ref_to_Proto'>CreateRestrictedProcess</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN134"><span class='Ref_to_Proto'>pgwin32_CommandLine</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1591"><span class='Ref_To_Local'>pi</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN137"><span class='Ref_to_Proto'>pgwin32_SetServiceStatus</span></a><span class='Parentheses'>(</span>SERVICE_STOPPED<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_ctl.c.html#LN103"><span class='Ref_to_Global_Var'>postmasterPID</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN1591"><span class='Ref_To_Local'>pi</span></a><span class='Operator'>.</span>dwProcessId<span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN106"><span class='Ref_to_Const'>postmasterProcess</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN1591"><span class='Ref_To_Local'>pi</span></a><span class='Operator'>.</span>hProcess<span class='Delimiter'>; 
</span>    CloseHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1591"><span class='Ref_To_Local'>pi</span></a><span class='Operator'>.</span>hThread<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN70"><span class='Ref_to_Global_Var'>do_wait</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../backend/utils/error/elog.c.html#LN133"><span class='Ref_to_Proto'>write_eventlog</span></a><span class='Parentheses'>(</span>EVENTLOG_INFORMATION_TYPE<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Waiting for server startup...\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN150"><span class='Ref_to_Proto'>test_postmaster_connection</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN103"><span class='Ref_to_Global_Var'>postmasterPID</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN130"><span class='Ref_to_EnumConst'>PQPING_OK</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../backend/utils/error/elog.c.html#LN133"><span class='Ref_to_Proto'>write_eventlog</span></a><span class='Parentheses'>(</span>EVENTLOG_ERROR_TYPE<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Timed out waiting for server startup\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pg_ctl.c.html#LN137"><span class='Ref_to_Proto'>pgwin32_SetServiceStatus</span></a><span class='Parentheses'>(</span>SERVICE_STOPPED<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../backend/utils/error/elog.c.html#LN133"><span class='Ref_to_Proto'>write_eventlog</span></a><span class='Parentheses'>(</span>EVENTLOG_INFORMATION_TYPE<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Server started and accepting connections\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_ctl.c.html#LN137"><span class='Ref_to_Proto'>pgwin32_SetServiceStatus</span></a><span class='Parentheses'>(</span>SERVICE_RUNNING<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Wait for quit... */ 
</span>    <a href="pg_ctl.c.html#LN1592"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span>WaitForMultipleObjects<span class='Parentheses'>(</span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN102"><span class='Ref_to_Global_Var'>shutdownHandles</span></a><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span>INFINITE<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN137"><span class='Ref_to_Proto'>pgwin32_SetServiceStatus</span></a><span class='Parentheses'>(</span>SERVICE_STOP_PENDING<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1592"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> WAIT_OBJECT_0<span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* shutdown event */ 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * status.dwCheckPoint can be incremented by 
                 * test_postmaster_connection(), so it might not start from 0. 
                 */ 
</span><a name="LN1651"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>maxShutdownCheckPoint</span> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwCheckPoint <span class='Operator'>+ </span><span class='Number'>12</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN103"><span class='Ref_to_Global_Var'>postmasterPID</span></a><span class='Delimiter'>, </span>SIGINT<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Increment the checkpoint and try again. Abort after 12 
                 * checkpoints as the postmaster has probably hung. 
                 */ 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span>WaitForSingleObject<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN106"><span class='Ref_to_Const'>postmasterProcess</span></a><span class='Delimiter'>, </span><span class='Number'>5000</span><span class='Parentheses'>) </span><span class='Operator'>== </span>WAIT_TIMEOUT <span class='Operator'>&& </span><a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwCheckPoint <span class='Operator'>&LT; </span><a href="pg_ctl.c.html#LN1651"><span class='Ref_To_Local'>maxShutdownCheckPoint</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Operator'>.</span>dwCheckPoint<span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    SetServiceStatus<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN101"><span class='Ref_to_Global_Var'>hStatus</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>LPSERVICE_STATUS<span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN100"><span class='Ref_to_Global_Var'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <span class='Parentheses'>(</span>WAIT_OBJECT_0 <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* postmaster went down */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* shouldn't get here? */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ret &raquo; </span> 
 
    CloseHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN105"><span class='Ref_to_Const'>shutdownEvent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CloseHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN106"><span class='Ref_to_Const'>postmasterProcess</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN137"><span class='Ref_to_Proto'>pgwin32_SetServiceStatus</span></a><span class='Parentheses'>(</span>SERVICE_STOPPED<span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgwin32_ServiceMain &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1682"></a><span class='Declare_Function'>pgwin32_doRunAsService</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1684"></a>    SERVICE_TABLE_ENTRY <span class='Declare_Local'>st</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{{</span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN139"><span class='Ref_to_Proto'>pgwin32_ServiceMain</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>}}; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>StartServiceCtrlDispatcher<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1684"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not start service \"%s\": error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Mingw headers are incomplete, and so are the libraries. So we have to load 
 * a whole lot of API functions dynamically. Since we have to do this anyway, 
 * also load the couple of functions that *do* exist in minwg headers but not 
 * on NT4. That way, we don't break on NT4. 
 */ 
</span><a name="LN1703"></a><span class='Control'>typedef</span> BOOL <span class='Parentheses'>(</span>WINAPI <span class='Operator'>* </span><span class='Declare_Typedef'>__CreateRestrictedToken</span><span class='Parentheses'>) (</span>HANDLE<span class='Delimiter'>, </span><span class='Keyword'>DWORD</span><span class='Delimiter'>, </span><span class='Keyword'>DWORD</span><span class='Delimiter'>, </span>PSID_AND_ATTRIBUTES<span class='Delimiter'>, </span><span class='Keyword'>DWORD</span><span class='Delimiter'>, </span>PLUID_AND_ATTRIBUTES<span class='Delimiter'>, </span><span class='Keyword'>DWORD</span><span class='Delimiter'>, </span>PSID_AND_ATTRIBUTES<span class='Delimiter'>, </span>PHANDLE<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1704"></a><span class='Control'>typedef</span> BOOL <span class='Parentheses'>(</span>WINAPI <span class='Operator'>* </span><span class='Declare_Typedef'>__IsProcessInJob</span><span class='Parentheses'>) (</span>HANDLE<span class='Delimiter'>, </span>HANDLE<span class='Delimiter'>, </span>PBOOL<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1705"></a><span class='Control'>typedef</span> HANDLE <span class='Parentheses'>(</span>WINAPI <span class='Operator'>* </span><span class='Declare_Typedef'>__CreateJobObject</span><span class='Parentheses'>) (</span>LPSECURITY_ATTRIBUTES<span class='Delimiter'>, </span>LPCTSTR<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1706"></a><span class='Control'>typedef</span> BOOL <span class='Parentheses'>(</span>WINAPI <span class='Operator'>* </span><span class='Declare_Typedef'>__SetInformationJobObject</span><span class='Parentheses'>) (</span>HANDLE<span class='Delimiter'>, </span>JOBOBJECTINFOCLASS<span class='Delimiter'>, </span>LPVOID<span class='Delimiter'>, </span><span class='Keyword'>DWORD</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1707"></a><span class='Control'>typedef</span> BOOL <span class='Parentheses'>(</span>WINAPI <span class='Operator'>* </span><span class='Declare_Typedef'>__AssignProcessToJobObject</span><span class='Parentheses'>) (</span>HANDLE<span class='Delimiter'>, </span>HANDLE<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1708"></a><span class='Control'>typedef</span> BOOL <span class='Parentheses'>(</span>WINAPI <span class='Operator'>* </span><span class='Declare_Typedef'>__QueryInformationJobObject</span><span class='Parentheses'>) (</span>HANDLE<span class='Delimiter'>, </span>JOBOBJECTINFOCLASS<span class='Delimiter'>, </span>LPVOID<span class='Delimiter'>, </span><span class='Keyword'>DWORD</span><span class='Delimiter'>, </span>LPDWORD<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Windows API define missing from some versions of MingW headers */ 
</span><span class='Directive'>#ifndef</span>  <a href="../../common/restricted_token.c.html#LN33"><span class='Ref_to_Const'>DISABLE_MAX_PRIVILEGE</span></a> 
<a name="LN1712"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DISABLE_MAX_PRIVILEGE</span>   <span class='Number'>0x1</span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create a restricted token, a job object sandbox, and execute the specified 
 * process with it. 
 * 
 * Returns 0 on success, non-zero on failure, same as CreateProcess(). 
 * 
 * On NT4, or any other system not containing the required functions, will 
 * launch the process under the current token without doing any modifications. 
 * 
 * NOTE! Job object will only work when running as a service, because it's 
 * automatically destroyed when pg_ctl exits. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1728"></a><span class='Declare_Function'>CreateRestrictedProcess</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span>PROCESS_INFORMATION <span class='Operator'>*</span><span class='Declare_Parameter'>processInfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>as_service</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1730"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span><a name="LN1731"></a>    BOOL        <span class='Declare_Local'>b</span><span class='Delimiter'>; 
</span><a name="LN1732"></a>    STARTUPINFO <span class='Declare_Local'>si</span><span class='Delimiter'>; 
</span><a name="LN1733"></a>    HANDLE      <span class='Declare_Local'>origToken</span><span class='Delimiter'>; 
</span><a name="LN1734"></a>    HANDLE      <span class='Declare_Local'>restrictedToken</span><span class='Delimiter'>; 
</span><a name="LN1735"></a>    SID_IDENTIFIER_AUTHORITY <span class='Declare_Local'>NtAuthority</span> <span class='Operator'>= </span><span class='Delimiter'>{</span>SECURITY_NT_AUTHORITY<span class='Delimiter'>}; 
</span><a name="LN1736"></a>    SID_AND_ATTRIBUTES <span class='Declare_Local'>dropSids</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* Functions loaded dynamically */ 
</span><a name="LN1739"></a>    <a href="../../common/restricted_token.c.html#LN29"><span class='Ref_to_Typedef'>__CreateRestrictedToken</span></a> <span class='Declare_Local'>_CreateRestrictedToken</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1740"></a>    <a href="pg_ctl.c.html#LN1704"><span class='Ref_to_Typedef'>__IsProcessInJob</span></a> <span class='Declare_Local'>_IsProcessInJob</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1741"></a>    <a href="pg_ctl.c.html#LN1705"><span class='Ref_to_Typedef'>__CreateJobObject</span></a> <span class='Declare_Local'>_CreateJobObject</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1742"></a>    <a href="pg_ctl.c.html#LN1706"><span class='Ref_to_Typedef'>__SetInformationJobObject</span></a> <span class='Declare_Local'>_SetInformationJobObject</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1743"></a>    <a href="pg_ctl.c.html#LN1707"><span class='Ref_to_Typedef'>__AssignProcessToJobObject</span></a> <span class='Declare_Local'>_AssignProcessToJobObject</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1744"></a>    <a href="pg_ctl.c.html#LN1708"><span class='Ref_to_Typedef'>__QueryInformationJobObject</span></a> <span class='Declare_Local'>_QueryInformationJobObject</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1745"></a>    HANDLE      <span class='Declare_Local'>Kernel32Handle</span><span class='Delimiter'>; 
</span><a name="LN1746"></a>    HANDLE      <span class='Declare_Local'>Advapi32Handle</span><span class='Delimiter'>; 
</span> 
    ZeroMemory<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1732"><span class='Ref_To_Local'>si</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1732"><span class='Ref_To_Local'>si</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN1732"><span class='Ref_To_Local'>si</span></a><span class='Operator'>.</span>cb <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1732"><span class='Ref_To_Local'>si</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN1746"><span class='Ref_To_Local'>Advapi32Handle</span></a> <span class='Operator'>= </span>LoadLibrary<span class='Parentheses'>(</span><span class='String'>"ADVAPI32.DLL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1746"><span class='Ref_To_Local'>Advapi32Handle</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN1739"><span class='Ref_To_Local'>_CreateRestrictedToken</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../common/restricted_token.c.html#LN29"><span class='Ref_to_Typedef'>__CreateRestrictedToken</span></a><span class='Parentheses'>) </span>GetProcAddress<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1746"><span class='Ref_To_Local'>Advapi32Handle</span></a><span class='Delimiter'>, </span><span class='String'>"CreateRestrictedToken"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1739"><span class='Ref_To_Local'>_CreateRestrictedToken</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * NT4 doesn't have CreateRestrictedToken, so just call ordinary 
         * CreateProcess 
         */ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: WARNING: cannot create restricted tokens on this platform\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1746"><span class='Ref_To_Local'>Advapi32Handle</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            FreeLibrary<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1746"><span class='Ref_To_Local'>Advapi32Handle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> CreateProcess<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1728"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1732"><span class='Ref_To_Local'>si</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1728"><span class='Ref_to_Parameter'>processInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Open the current token to use as a base for the restricted one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>OpenProcessToken<span class='Parentheses'>(</span>GetCurrentProcess<span class='Parentheses'>()</span><span class='Delimiter'>, </span>TOKEN_ALL_ACCESS<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1733"><span class='Ref_To_Local'>origToken</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Most Windows targets make DWORD a 32-bit unsigned long, but in case 
         * it doesn't cast DWORD before printing. 
         */ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open process token: error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate list of SIDs to remove */ 
</span>    ZeroMemory<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1736"><span class='Ref_To_Local'>dropSids</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1736"><span class='Ref_To_Local'>dropSids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>AllocateAndInitializeSid<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1735"><span class='Ref_To_Local'>NtAuthority</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>         SECURITY_BUILTIN_DOMAIN_RID<span class='Delimiter'>, </span>DOMAIN_ALIAS_RID_ADMINS<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                  <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1736"><span class='Ref_To_Local'>dropSids</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span>Sid<span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Operator'>!</span>AllocateAndInitializeSid<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1735"><span class='Ref_To_Local'>NtAuthority</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>    SECURITY_BUILTIN_DOMAIN_RID<span class='Delimiter'>, </span>DOMAIN_ALIAS_RID_POWER_USERS<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                  <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1736"><span class='Ref_To_Local'>dropSids</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span>Sid<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not allocate SIDs: error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_ctl.c.html#LN1731"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN1739"><span class='Ref_To_Local'>_CreateRestrictedToken</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1733"><span class='Ref_To_Local'>origToken</span></a><span class='Delimiter'>, 
</span>                               <a href="../../common/restricted_token.c.html#LN33"><span class='Ref_to_Const'>DISABLE_MAX_PRIVILEGE</span></a><span class='Delimiter'>, 
</span>                               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1736"><span class='Ref_To_Local'>dropSids</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1736"><span class='Ref_To_Local'>dropSids</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="pg_ctl.c.html#LN1736"><span class='Ref_To_Local'>dropSids</span></a><span class='Delimiter'>, 
</span>                               <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                               <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="pg_ctl.c.html#LN1734"><span class='Ref_To_Local'>restrictedToken</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    FreeSid<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1736"><span class='Ref_To_Local'>dropSids</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span>Sid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    FreeSid<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1736"><span class='Ref_To_Local'>dropSids</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span>Sid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CloseHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1733"><span class='Ref_To_Local'>origToken</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    FreeLibrary<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1746"><span class='Ref_To_Local'>Advapi32Handle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_ctl.c.html#LN1731"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not create restricted token: error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/port.h.html#LN102"><span class='Ref_to_Proto'>AddUserToTokenDacl</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1734"><span class='Ref_To_Local'>restrictedToken</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN1730"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>CreateProcessAsUser<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1734"><span class='Ref_To_Local'>restrictedToken</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1728"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>TRUE</span><span class='Delimiter'>, </span>CREATE_SUSPENDED<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1732"><span class='Ref_To_Local'>si</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1728"><span class='Ref_to_Parameter'>processInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN1745"><span class='Ref_To_Local'>Kernel32Handle</span></a> <span class='Operator'>= </span>LoadLibrary<span class='Parentheses'>(</span><span class='String'>"KERNEL32.DLL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1745"><span class='Ref_To_Local'>Kernel32Handle</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN1740"><span class='Ref_To_Local'>_IsProcessInJob</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1704"><span class='Ref_to_Typedef'>__IsProcessInJob</span></a><span class='Parentheses'>) </span>GetProcAddress<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1745"><span class='Ref_To_Local'>Kernel32Handle</span></a><span class='Delimiter'>, </span><span class='String'>"IsProcessInJob"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN1741"><span class='Ref_To_Local'>_CreateJobObject</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1705"><span class='Ref_to_Typedef'>__CreateJobObject</span></a><span class='Parentheses'>) </span>GetProcAddress<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1745"><span class='Ref_To_Local'>Kernel32Handle</span></a><span class='Delimiter'>, </span><span class='String'>"CreateJobObjectA"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN1742"><span class='Ref_To_Local'>_SetInformationJobObject</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1706"><span class='Ref_to_Typedef'>__SetInformationJobObject</span></a><span class='Parentheses'>) </span>GetProcAddress<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1745"><span class='Ref_To_Local'>Kernel32Handle</span></a><span class='Delimiter'>, </span><span class='String'>"SetInformationJobObject"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN1743"><span class='Ref_To_Local'>_AssignProcessToJobObject</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1707"><span class='Ref_to_Typedef'>__AssignProcessToJobObject</span></a><span class='Parentheses'>) </span>GetProcAddress<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1745"><span class='Ref_To_Local'>Kernel32Handle</span></a><span class='Delimiter'>, </span><span class='String'>"AssignProcessToJobObject"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN1744"><span class='Ref_To_Local'>_QueryInformationJobObject</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1708"><span class='Ref_to_Typedef'>__QueryInformationJobObject</span></a><span class='Parentheses'>) </span>GetProcAddress<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1745"><span class='Ref_To_Local'>Kernel32Handle</span></a><span class='Delimiter'>, </span><span class='String'>"QueryInformationJobObject"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Verify that we found all functions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1740"><span class='Ref_To_Local'>_IsProcessInJob</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="pg_ctl.c.html#LN1741"><span class='Ref_To_Local'>_CreateJobObject</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="pg_ctl.c.html#LN1742"><span class='Ref_To_Local'>_SetInformationJobObject</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="pg_ctl.c.html#LN1743"><span class='Ref_To_Local'>_AssignProcessToJobObject</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="pg_ctl.c.html#LN1744"><span class='Ref_To_Local'>_QueryInformationJobObject</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * IsProcessInJob() is not available on &LT; WinXP, so there is no need 
         * to log the error every time in that case 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN130"><span class='Ref_to_Proto'>IsWindowsXPOrGreater</span></a><span class='Parentheses'>())</span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Log error if we can't get version, or if we're on WinXP/2003 or 
             * newer 
             */ 
</span>            <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: WARNING: could not locate all job object functions in system API\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1845"></a>        BOOL        <span class='Declare_Local'>inJob</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1740"><span class='Ref_To_Local'>_IsProcessInJob</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1728"><span class='Ref_to_Parameter'>processInfo</span></a><span class='Operator'>-&GT;</span>hProcess<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1845"><span class='Ref_To_Local'>inJob</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_ctl.c.html#LN1845"><span class='Ref_To_Local'>inJob</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Job objects are working, and the new process isn't in one, 
                 * so we can create one safely. If any problems show up when 
                 * setting it, we're going to ignore them. 
                 */ 
</span><a name="LN1856"></a>                HANDLE      <span class='Declare_Local'>job</span><span class='Delimiter'>; 
</span><a name="LN1857"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>jobname</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span> 
                <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1857"><span class='Ref_To_Local'>jobname</span></a><span class='Delimiter'>, </span><span class='String'>"PostgreSQL_%lu"</span><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span><a href="pg_ctl.c.html#LN1728"><span class='Ref_to_Parameter'>processInfo</span></a><span class='Operator'>-&GT;</span>dwProcessId<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pg_ctl.c.html#LN1856"><span class='Ref_To_Local'>job</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN1741"><span class='Ref_To_Local'>_CreateJobObject</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1857"><span class='Ref_To_Local'>jobname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1856"><span class='Ref_To_Local'>job</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1865"></a>                    JOBOBJECT_BASIC_LIMIT_INFORMATION <span class='Declare_Local'>basicLimit</span><span class='Delimiter'>; 
</span><a name="LN1866"></a>                    JOBOBJECT_BASIC_UI_RESTRICTIONS <span class='Declare_Local'>uiRestrictions</span><span class='Delimiter'>; 
</span><a name="LN1867"></a>                    JOBOBJECT_SECURITY_LIMIT_INFORMATION <span class='Declare_Local'>securityLimit</span><span class='Delimiter'>; 
</span> 
                    ZeroMemory<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1865"><span class='Ref_To_Local'>basicLimit</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1865"><span class='Ref_To_Local'>basicLimit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    ZeroMemory<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1866"><span class='Ref_To_Local'>uiRestrictions</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1866"><span class='Ref_To_Local'>uiRestrictions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    ZeroMemory<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1867"><span class='Ref_To_Local'>securityLimit</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1867"><span class='Ref_To_Local'>securityLimit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_ctl.c.html#LN1865"><span class='Ref_To_Local'>basicLimit</span></a><span class='Operator'>.</span>LimitFlags <span class='Operator'>= </span>JOB_OBJECT_LIMIT_DIE_ON_UNHANDLED_EXCEPTION <span class='Operator'>| </span>JOB_OBJECT_LIMIT_PRIORITY_CLASS<span class='Delimiter'>; 
</span>                    <a href="pg_ctl.c.html#LN1865"><span class='Ref_To_Local'>basicLimit</span></a><span class='Operator'>.</span>PriorityClass <span class='Operator'>= </span>NORMAL_PRIORITY_CLASS<span class='Delimiter'>; 
</span>                    <a href="pg_ctl.c.html#LN1742"><span class='Ref_To_Local'>_SetInformationJobObject</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1856"><span class='Ref_To_Local'>job</span></a><span class='Delimiter'>, </span>JobObjectBasicLimitInformation<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1865"><span class='Ref_To_Local'>basicLimit</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1865"><span class='Ref_To_Local'>basicLimit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_ctl.c.html#LN1866"><span class='Ref_To_Local'>uiRestrictions</span></a><span class='Operator'>.</span>UIRestrictionsClass <span class='Operator'>= </span>JOB_OBJECT_UILIMIT_DESKTOP <span class='Operator'>| </span>JOB_OBJECT_UILIMIT_DISPLAYSETTINGS <span class='Operator'>| 
</span>                        JOB_OBJECT_UILIMIT_EXITWINDOWS <span class='Operator'>| </span>JOB_OBJECT_UILIMIT_READCLIPBOARD <span class='Operator'>| 
</span>                        JOB_OBJECT_UILIMIT_SYSTEMPARAMETERS <span class='Operator'>| </span>JOB_OBJECT_UILIMIT_WRITECLIPBOARD<span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1728"><span class='Ref_to_Parameter'>as_service</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_ctl.c.html#LN131"><span class='Ref_to_Proto'>IsWindows7OrGreater</span></a><span class='Parentheses'>())</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * On Windows 7 (and presumably later), 
                             * JOB_OBJECT_UILIMIT_HANDLES prevents us from 
                             * starting as a service. So we only enable it on 
                             * Vista and earlier (version &LT;= 6.0) 
                             */ 
</span>                            <a href="pg_ctl.c.html#LN1866"><span class='Ref_To_Local'>uiRestrictions</span></a><span class='Operator'>.</span>UIRestrictionsClass <span class='Operator'>|= </span>JOB_OBJECT_UILIMIT_HANDLES<span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="pg_ctl.c.html#LN1742"><span class='Ref_To_Local'>_SetInformationJobObject</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1856"><span class='Ref_To_Local'>job</span></a><span class='Delimiter'>, </span>JobObjectBasicUIRestrictions<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1866"><span class='Ref_To_Local'>uiRestrictions</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1866"><span class='Ref_To_Local'>uiRestrictions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_ctl.c.html#LN1867"><span class='Ref_To_Local'>securityLimit</span></a><span class='Operator'>.</span>SecurityLimitFlags <span class='Operator'>= </span>JOB_OBJECT_SECURITY_NO_ADMIN <span class='Operator'>| </span>JOB_OBJECT_SECURITY_ONLY_TOKEN<span class='Delimiter'>; 
</span>                    <a href="pg_ctl.c.html#LN1867"><span class='Ref_To_Local'>securityLimit</span></a><span class='Operator'>.</span>JobToken <span class='Operator'>= </span><a href="pg_ctl.c.html#LN1734"><span class='Ref_To_Local'>restrictedToken</span></a><span class='Delimiter'>; 
</span>                    <a href="pg_ctl.c.html#LN1742"><span class='Ref_To_Local'>_SetInformationJobObject</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1856"><span class='Ref_To_Local'>job</span></a><span class='Delimiter'>, </span>JobObjectSecurityLimitInformation<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN1867"><span class='Ref_To_Local'>securityLimit</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1867"><span class='Ref_To_Local'>securityLimit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_ctl.c.html#LN1743"><span class='Ref_To_Local'>_AssignProcessToJobObject</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1856"><span class='Ref_To_Local'>job</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN1728"><span class='Ref_to_Parameter'>processInfo</span></a><span class='Operator'>-&GT;</span>hProcess<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if job &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !inJob &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if _IsProcessInJob(proce... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
 
    CloseHandle<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1734"><span class='Ref_To_Local'>restrictedToken</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    ResumeThread<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1728"><span class='Ref_to_Parameter'>processInfo</span></a><span class='Operator'>-&GT;</span>hThread<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    FreeLibrary<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN1745"><span class='Ref_To_Local'>Kernel32Handle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We intentionally don't close the job object handle, because we want the 
     * object to live on until pg_ctl shuts down. 
     */ 
</span>    <span class='Control'>return</span> <a href="pg_ctl.c.html#LN1730"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateRestrictedProcess &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1922"></a><span class='Declare_Function'>do_advice</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
 
<span class='Keyword'>static void 
</span><a name="LN1930"></a><span class='Declare_Function'>do_help</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s is a utility to initialize, start, stop, or control a PostgreSQL server.\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Usage:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s init[db] [-D DATADIR] [-s] [-o OPTIONS]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s start    [-D DATADIR] [-l FILENAME] [-W] [-t SECS] [-s]\n"</span> 
             <span class='String'>"                  [-o OPTIONS] [-p PATH] [-c]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s stop     [-D DATADIR] [-m SHUTDOWN-MODE] [-W] [-t SECS] [-s]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s restart  [-D DATADIR] [-m SHUTDOWN-MODE] [-W] [-t SECS] [-s]\n"</span> 
             <span class='String'>"                  [-o OPTIONS] [-c]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s reload   [-D DATADIR] [-s]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s status   [-D DATADIR]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s promote  [-D DATADIR] [-W] [-t SECS] [-s]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s kill     SIGNALNAME PID\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s register [-D DATADIR] [-N SERVICENAME] [-U USERNAME] [-P PASSWORD]\n"</span> 
             <span class='String'>"                  [-S START-TYPE] [-e SOURCE] [-W] [-t SECS] [-s] [-o OPTIONS]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s unregister [-N SERVICENAME]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nCommon options:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -D, --pgdata=DATADIR   location of the database storage area\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -e SOURCE              event source for logging when running as a service\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -s, --silent           only print errors, no informational messages\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -t, --timeout=SECS     seconds to wait when using -w option\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -V, --version          output version information, then exit\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -w, --wait             wait until operation completes (default)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -W, --no-wait          do not wait until operation completes\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -?, --help             show this help, then exit\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"If the -D option is omitted, the environment variable PGDATA is used.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nOptions for start or restart:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_GETRLIMIT<span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span>RLIMIT_CORE<span class='Parentheses'>) 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -c, --core-files       allow postgres to produce core files\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -c, --core-files       not applicable on this platform\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -l, --log=FILENAME     write (or append) server log to FILENAME\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -o, --options=OPTIONS  command line options to pass to postgres\n"</span> 
     <span class='String'>"                         (PostgreSQL server executable) or initdb\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -p PATH-TO-POSTGRES    normally not necessary\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nOptions for stop or restart:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -m, --mode=MODE        MODE can be \"smart\", \"fast\", or \"immediate\"\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nShutdown modes are:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  smart       quit after all clients have disconnected\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  fast        quit directly, with proper shutdown (default)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  immediate   quit without complete shutdown; will lead to recovery on restart\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nAllowed signal names for kill:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"  ABRT HUP INT QUIT TERM USR1 USR2\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nOptions for register and unregister:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -N SERVICENAME  service name with which to register PostgreSQL server\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -P PASSWORD     password of account to register PostgreSQL server\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -U USERNAME     user name of account to register PostgreSQL server\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -S START-TYPE   service start type to register PostgreSQL server\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nStart types are:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  auto       start service automatically during system startup (default)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  demand     start service on demand\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nReport bugs to &LT;pgsql-bugs@postgresql.org&GT;.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end do_help &raquo; </span> 
 
 
 
<span class='Keyword'>static void 
</span><a name="LN2002"></a><span class='Declare_Function'>set_mode</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>modeopt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2002"><span class='Ref_to_Parameter'>modeopt</span></a><span class='Delimiter'>, </span><span class='String'>"s"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2002"><span class='Ref_to_Parameter'>modeopt</span></a><span class='Delimiter'>, </span><span class='String'>"smart"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN74"><span class='Ref_to_Global_Var'>shutdown_mode</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN46"><span class='Ref_to_EnumConst'>SMART_MODE</span></a><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span>SIGTERM<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2002"><span class='Ref_to_Parameter'>modeopt</span></a><span class='Delimiter'>, </span><span class='String'>"f"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2002"><span class='Ref_to_Parameter'>modeopt</span></a><span class='Delimiter'>, </span><span class='String'>"fast"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN74"><span class='Ref_to_Global_Var'>shutdown_mode</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN47"><span class='Ref_to_EnumConst'>FAST_MODE</span></a><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span>SIGINT<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2002"><span class='Ref_to_Parameter'>modeopt</span></a><span class='Delimiter'>, </span><span class='String'>"i"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2002"><span class='Ref_to_Parameter'>modeopt</span></a><span class='Delimiter'>, </span><span class='String'>"immediate"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN74"><span class='Ref_to_Global_Var'>shutdown_mode</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN48"><span class='Ref_to_EnumConst'>IMMEDIATE_MODE</span></a><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN188"><span class='Ref_to_Const'>SIGQUIT</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: unrecognized shutdown mode \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2002"><span class='Ref_to_Parameter'>modeopt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN111"><span class='Ref_to_Proto'>do_advice</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end set_mode &raquo; </span> 
 
 
 
<span class='Keyword'>static void 
</span><a name="LN2030"></a><span class='Declare_Function'>set_sig</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>signame</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2030"><span class='Ref_to_Parameter'>signame</span></a><span class='Delimiter'>, </span><span class='String'>"HUP"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN187"><span class='Ref_to_Const'>SIGHUP</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2030"><span class='Ref_to_Parameter'>signame</span></a><span class='Delimiter'>, </span><span class='String'>"INT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span>SIGINT<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2030"><span class='Ref_to_Parameter'>signame</span></a><span class='Delimiter'>, </span><span class='String'>"QUIT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN188"><span class='Ref_to_Const'>SIGQUIT</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2030"><span class='Ref_to_Parameter'>signame</span></a><span class='Delimiter'>, </span><span class='String'>"ABRT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN190"><span class='Ref_to_Const'>SIGABRT</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#if</span> <span class='Number'>0</span> 
<span class='Inactive_Code'>    /* probably should NOT provide SIGKILL */ 
    else if (strcmp(signame, "KILL") == 0) 
        sig = SIGKILL; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2030"><span class='Ref_to_Parameter'>signame</span></a><span class='Delimiter'>, </span><span class='String'>"TERM"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span>SIGTERM<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2030"><span class='Ref_to_Parameter'>signame</span></a><span class='Delimiter'>, </span><span class='String'>"USR1"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN201"><span class='Ref_to_Const'>SIGUSR1</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2030"><span class='Ref_to_Parameter'>signame</span></a><span class='Delimiter'>, </span><span class='String'>"USR2"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN202"><span class='Ref_to_Const'>SIGUSR2</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: unrecognized signal name \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2030"><span class='Ref_to_Parameter'>signame</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN111"><span class='Ref_to_Proto'>do_advice</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end set_sig &raquo; </span> 
 
 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>static void 
</span><a name="LN2062"></a><span class='Declare_Function'>set_starttype</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>starttypeopt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2062"><span class='Ref_to_Parameter'>starttypeopt</span></a><span class='Delimiter'>, </span><span class='String'>"a"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2062"><span class='Ref_to_Parameter'>starttypeopt</span></a><span class='Delimiter'>, </span><span class='String'>"auto"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_ctl.c.html#LN99"><span class='Ref_to_Global_Var'>pgctl_start_type</span></a> <span class='Operator'>= </span>SERVICE_AUTO_START<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2062"><span class='Ref_to_Parameter'>starttypeopt</span></a><span class='Delimiter'>, </span><span class='String'>"d"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2062"><span class='Ref_to_Parameter'>starttypeopt</span></a><span class='Delimiter'>, </span><span class='String'>"demand"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_ctl.c.html#LN99"><span class='Ref_to_Global_Var'>pgctl_start_type</span></a> <span class='Operator'>= </span>SERVICE_DEMAND_START<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: unrecognized start type \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2062"><span class='Ref_to_Parameter'>starttypeopt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN111"><span class='Ref_to_Proto'>do_advice</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * adjust_data_dir 
 * 
 * If a configuration-only directory was specified, find the real data dir. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2083"></a><span class='Declare_Function'>adjust_data_dir</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2085"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>cmd</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>], 
</span><a name="LN2086"></a>                <span class='Declare_Local'>filename</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>], 
</span><a name="LN2087"></a>               <span class='Operator'>*</span><span class='Declare_Local'>my_exec_path</span><span class='Delimiter'>; 
</span><a name="LN2088"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>fd</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* do nothing if we're working without knowledge of data dir */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there is no postgresql.conf, it can't be a config-only dir */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/postgresql.conf"</span><span class='Delimiter'>, </span><a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN2088"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    fclose<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2088"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If PG_VERSION exists, it can't be a config-only dir */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/PG_VERSION"</span><span class='Delimiter'>, </span><a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN2088"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        fclose<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2088"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Must be a configuration directory, so find the data directory */ 
</span> 
    <span class='Comment_Multi_Line'>/* we use a private my_exec_path to avoid interfering with later uses */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_ctl.c.html#LN2087"><span class='Ref_To_Local'>my_exec_path</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN803"><span class='Ref_to_Func'>find_other_exec_or_die</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN88"><span class='Ref_to_Global_Var'>argv0</span></a><span class='Delimiter'>, </span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><a href="../../include/miscadmin.h.html#LN30"><span class='Ref_to_Const'>PG_BACKEND_VERSIONSTR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_ctl.c.html#LN2087"><span class='Ref_To_Local'>my_exec_path</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* it's important for -C to be the first option, see main.c */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2085"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"\"%s\" -C data_directory %s%s"</span><span class='Delimiter'>, 
</span>             <a href="pg_ctl.c.html#LN2087"><span class='Ref_To_Local'>my_exec_path</span></a><span class='Delimiter'>, 
</span>             <a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a> <span class='Operator'>? </span><a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>             <a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a> <span class='Operator'>? </span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_ctl.c.html#LN2088"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN313"><span class='Ref_to_Macro'>popen</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2085"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2088"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>fgets<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2088"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not determine the data directory using command \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2085"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/port.h.html#LN314"><span class='Ref_to_Macro'>pclose</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2088"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2087"><span class='Ref_To_Local'>my_exec_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove trailing newline */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Operator'>*</span>strchr<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2086"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end adjust_data_dir &raquo; </span> 
 
 
<span class='Keyword'>static </span><a href="../../include/catalog/pg_control.h.html#LN83"><span class='Ref_to_Enum'>DBState</span></a> 
<a name="LN2142"></a><span class='Declare_Function'>get_control_dbstate</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2144"></a>    <a href="../../include/catalog/pg_control.h.html#LN83"><span class='Ref_to_Enum'>DBState</span></a>     <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN2145"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>crc_ok</span><span class='Delimiter'>; 
</span><a name="LN2146"></a>    <a href="../../include/catalog/pg_control.h.html#LN102"><span class='Ref_to_Struct'>ControlFileData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>control_file_data</span> <span class='Operator'>= </span><a href="../../include/common/controldata_utils.h.html#LN14"><span class='Ref_to_Proto'>get_controlfile</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN2145"><span class='Ref_To_Local'>crc_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_ctl.c.html#LN2145"><span class='Ref_To_Local'>crc_ok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: control file appears to be corrupt\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_ctl.c.html#LN2144"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN2146"><span class='Ref_To_Local'>control_file_data</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_control.h.html#LN129"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2146"><span class='Ref_To_Local'>control_file_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_ctl.c.html#LN2144"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>int 
</span><a name="LN2161"></a><span class='Declare_Function'>main</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>argv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2163"></a>    <span class='Keyword'>static </span><span class='Control'>struct</span> <a href="../../include/getopt_long.h.html#LN15"><span class='Ref_to_Struct'>option</span></a> <span class='Declare_Local'>long_options</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"help"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'?'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"version"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'V'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"log"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'l'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"mode"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'m'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"pgdata"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'D'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"options"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'o'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"silent"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'s'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"timeout"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'t'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"core-files"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"wait"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'w'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-wait"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'W'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
<a name="LN2178"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>env_wait</span><span class='Delimiter'>; 
</span><a name="LN2179"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>option_index</span><span class='Delimiter'>; 
</span><a name="LN2180"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN2181"></a>    <a href="../pg_upgrade/pg_upgrade.h.html#LN251"><span class='Ref_to_Typedef'>pgpid_t</span></a>     <span class='Declare_Local'>killproc</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    setvbuf<span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span>_IONBF<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN49"><span class='Ref_to_Proto'>get_progname</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN93"><span class='Ref_to_Proto'>set_pglocale_pgservice</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="../../include/c.h.html#LN1009"><span class='Ref_to_Macro'>PG_TEXTDOMAIN</span></a><span class='Parentheses'>(</span><span class='String'>"pg_ctl"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_ctl.c.html#LN90"><span class='Ref_to_Global_Var'>start_time</span></a> <span class='Operator'>= </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * save argv[0] so do_start() can look for the postmaster if necessary. we 
     * don't look for postmaster here because in many cases we won't need it. 
     */ 
</span>    <a href="pg_ctl.c.html#LN88"><span class='Ref_to_Global_Var'>argv0</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
    umask<span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN450"><span class='Ref_to_Const'>S_IRWXG</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN454"><span class='Ref_to_Const'>S_IRWXO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* support --help and --version even if invoked as root */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--help"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"-?"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_ctl.c.html#LN112"><span class='Ref_to_Proto'>do_help</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--version"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"-V"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            puts<span class='Parentheses'>(</span><span class='String'>"pg_ctl (PostgreSQL) "</span> PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Disallow running as root, to forestall any possible security holes. 
     */ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>geteuid<span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: cannot be run as root\n"</span> 
                       <span class='String'>"Please log in (using, e.g., \"su\") as the "</span> 
                       <span class='String'>"(unprivileged) user that will\n"</span> 
                       <span class='String'>"own the server process.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <a href="pg_ctl.c.html#LN2178"><span class='Ref_To_Local'>env_wait</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGCTLTIMEOUT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2178"><span class='Ref_To_Local'>env_wait</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_ctl.c.html#LN71"><span class='Ref_to_Global_Var'>wait_seconds</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2178"><span class='Ref_To_Local'>env_wait</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 'Action' can be before or after args so loop over both. Some 
     * getopt_long() implementations will reorder argv[] to place all flags 
     * first (GNU?), but we don't rely on it. Our /port version doesn't do 
     * that. 
     */ 
</span>    <a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* process command-line options */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>&LT; </span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_ctl.c.html#LN2180"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="../../include/getopt_long.h.html#LN30"><span class='Ref_to_Proto'>getopt_long</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>, </span><span class='String'>"cD:e:l:m:N:o:p:P:sS:t:U:wW"</span><span class='Delimiter'>, 
</span>                                <a href="pg_ctl.c.html#LN2163"><span class='Ref_To_Local'>long_options</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_ctl.c.html#LN2179"><span class='Ref_To_Local'>option_index</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2180"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>: 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN2251"></a>                        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pgdata_D</span><span class='Delimiter'>; 
</span><a name="LN2252"></a>                        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>env_var</span><span class='Delimiter'>; 
</span> 
                        <a href="pg_ctl.c.html#LN2251"><span class='Ref_To_Local'>pgdata_D</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2251"><span class='Ref_To_Local'>pgdata_D</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pg_ctl.c.html#LN2252"><span class='Ref_To_Local'>env_var</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"PGDATA=%s"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2251"><span class='Ref_To_Local'>pgdata_D</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2252"><span class='Ref_To_Local'>env_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * We could pass PGDATA just in an environment 
                         * variable but we do -D too for clearer postmaster 
                         * 'ps' display 
                         */ 
</span>                        <a href="pg_ctl.c.html#LN79"><span class='Ref_to_Global_Var'>pgdata_opt</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"-D \"%s\" "</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2251"><span class='Ref_To_Local'>pgdata_D</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Control'>case</span> <span class='String'>'e'</span><span class='Operator'>: 
</span>                    <a href="../pgevent/pgevent.c.html#LN24"><span class='Ref_to_Global_Var'>event_source</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'l'</span><span class='Operator'>: 
</span>                    <a href="pg_ctl.c.html#LN82"><span class='Ref_to_Global_Var'>log_file</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'m'</span><span class='Operator'>: 
</span>                    <a href="pg_ctl.c.html#LN113"><span class='Ref_to_Proto'>set_mode</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'N'</span><span class='Operator'>: 
</span>                    <a href="pg_ctl.c.html#LN85"><span class='Ref_to_Global_Var'>register_servicename</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'o'</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* append option? */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Parentheses'>) 
</span>                        <a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span><a name="LN2285"></a>                        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>old_post_opts</span> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a><span class='Delimiter'>; 
</span> 
                        <a href="pg_ctl.c.html#LN80"><span class='Ref_to_Global_Var'>post_opts</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s %s"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2285"><span class='Ref_To_Local'>old_post_opts</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2285"><span class='Ref_To_Local'>old_post_opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>: 
</span>                    <a href="pg_ctl.c.html#LN83"><span class='Ref_to_Global_Var'>exec_path</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>: 
</span>                    <a href="pg_ctl.c.html#LN87"><span class='Ref_to_Global_Var'>register_password</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>: 
</span>                    <a href="pg_ctl.c.html#LN73"><span class='Ref_to_Global_Var'>silent_mode</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
                    <a href="pg_ctl.c.html#LN2061"><span class='Ref_to_Func'>set_starttype</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
                    <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: -S option not supported on this platform\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>: 
</span>                    <a href="pg_ctl.c.html#LN71"><span class='Ref_to_Global_Var'>wait_seconds</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pg_ctl.c.html#LN72"><span class='Ref_to_Global_Var'>wait_seconds_arg</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'U'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>'\\'</span><span class='Parentheses'>))</span> 
                        <a href="pg_ctl.c.html#LN86"><span class='Ref_to_Global_Var'>register_username</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <span class='Comment_Multi_Line'>/* Prepend .\ for local accounts */ 
</span>                        <a href="pg_ctl.c.html#LN86"><span class='Ref_to_Global_Var'>register_username</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>".\\%s"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'w'</span><span class='Operator'>: 
</span>                    <a href="pg_ctl.c.html#LN70"><span class='Ref_to_Global_Var'>do_wait</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'W'</span><span class='Operator'>: 
</span>                    <a href="pg_ctl.c.html#LN70"><span class='Ref_to_Global_Var'>do_wait</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span>                    <a href="pg_ctl.c.html#LN89"><span class='Ref_to_Global_Var'>allow_core_files</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* getopt_long already issued a suitable error message */ 
</span>                    <a href="pg_ctl.c.html#LN111"><span class='Ref_to_Proto'>do_advice</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch c &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (c=getopt_long(argc,a... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Process an action */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>&LT; </span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>!= </span><a href="pg_ctl.c.html#LN54"><span class='Ref_to_EnumConst'>NO_COMMAND</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: too many command-line arguments (first is \"%s\")\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_ctl.c.html#LN111"><span class='Ref_to_Proto'>do_advice</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"init"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> 
                <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"initdb"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN55"><span class='Ref_to_EnumConst'>INIT_COMMAND</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"start"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN56"><span class='Ref_to_EnumConst'>START_COMMAND</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"stop"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN57"><span class='Ref_to_EnumConst'>STOP_COMMAND</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"restart"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN58"><span class='Ref_to_EnumConst'>RESTART_COMMAND</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"reload"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN59"><span class='Ref_to_EnumConst'>RELOAD_COMMAND</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"status"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN60"><span class='Ref_to_EnumConst'>STATUS_COMMAND</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"promote"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN61"><span class='Ref_to_EnumConst'>PROMOTE_COMMAND</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"kill"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>- </span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: missing arguments for kill mode\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pg_ctl.c.html#LN111"><span class='Ref_to_Proto'>do_advice</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN62"><span class='Ref_to_EnumConst'>KILL_COMMAND</span></a><span class='Delimiter'>; 
</span>                <a href="pg_ctl.c.html#LN114"><span class='Ref_to_Proto'>set_sig</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Operator'>++</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_ctl.c.html#LN2181"><span class='Ref_To_Local'>killproc</span></a> <span class='Operator'>= </span>atol<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Operator'>++</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"register"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN63"><span class='Ref_to_EnumConst'>REGISTER_COMMAND</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"unregister"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN64"><span class='Ref_to_EnumConst'>UNREGISTER_COMMAND</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='String'>"runservice"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>= </span><a href="pg_ctl.c.html#LN65"><span class='Ref_to_EnumConst'>RUN_AS_SERVICE_COMMAND</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: unrecognized operation mode \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN2161"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_ctl.c.html#LN111"><span class='Ref_to_Proto'>do_advice</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if optind&LT;argc &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while optind&LT;argc &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>== </span><a href="pg_ctl.c.html#LN54"><span class='Ref_to_EnumConst'>NO_COMMAND</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: no operation specified\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN111"><span class='Ref_to_Proto'>do_advice</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Note we put any -D switch into the env var above */ 
</span>    <a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGDATA"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* -D might point at config-only directory; if so find the real PGDATA */ 
</span>    <a href="pg_ctl.c.html#LN124"><span class='Ref_to_Proto'>adjust_data_dir</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Complain if -D needed and not provided */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../backend/utils/misc/pg_config.c.html#LN24"><span class='Ref_to_Func'>pg_config</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>!= </span><a href="pg_ctl.c.html#LN62"><span class='Ref_to_EnumConst'>KILL_COMMAND</span></a> <span class='Operator'>&& </span><a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>!= </span><a href="pg_ctl.c.html#LN64"><span class='Ref_to_EnumConst'>UNREGISTER_COMMAND</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_dump/parallel.c.html#LN179"><span class='Ref_to_Macro'>write_stderr</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s: no database directory specified and environment variable PGDATA unset\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN111"><span class='Ref_to_Proto'>do_advice</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a> <span class='Operator'>== </span><a href="pg_ctl.c.html#LN59"><span class='Ref_to_EnumConst'>RELOAD_COMMAND</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_ctl.c.html#LN75"><span class='Ref_to_Global_Var'>sig</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN187"><span class='Ref_to_Const'>SIGHUP</span></a><span class='Delimiter'>; 
</span>        <a href="pg_ctl.c.html#LN70"><span class='Ref_to_Global_Var'>do_wait</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN92"><span class='Ref_to_Global_Var'>postopts_file</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/postmaster.opts"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN93"><span class='Ref_to_Global_Var'>version_file</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/PG_VERSION"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN94"><span class='Ref_to_Global_Var'>pid_file</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/postmaster.pid"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN95"><span class='Ref_to_Global_Var'>backup_file</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/backup_label"</span><span class='Delimiter'>, </span><a href="pg_ctl.c.html#LN77"><span class='Ref_to_Global_Var'>pg_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN76"><span class='Ref_to_Global_Var'>ctl_command</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN55"><span class='Ref_to_EnumConst'>INIT_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="pg_ctl.c.html#LN115"><span class='Ref_to_Proto'>do_init</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN60"><span class='Ref_to_EnumConst'>STATUS_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="pg_ctl.c.html#LN120"><span class='Ref_to_Proto'>do_status</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN56"><span class='Ref_to_EnumConst'>START_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="../../backend/bootstrap/bootparse.y.html#LN67"><span class='Ref_to_Func'>do_start</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN57"><span class='Ref_to_EnumConst'>STOP_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="pg_ctl.c.html#LN117"><span class='Ref_to_Proto'>do_stop</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN58"><span class='Ref_to_EnumConst'>RESTART_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="pg_ctl.c.html#LN118"><span class='Ref_to_Proto'>do_restart</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN59"><span class='Ref_to_EnumConst'>RELOAD_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="pg_ctl.c.html#LN119"><span class='Ref_to_Proto'>do_reload</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN61"><span class='Ref_to_EnumConst'>PROMOTE_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="pg_ctl.c.html#LN121"><span class='Ref_to_Proto'>do_promote</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN62"><span class='Ref_to_EnumConst'>KILL_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="pg_ctl.c.html#LN122"><span class='Ref_to_Proto'>do_kill</span></a><span class='Parentheses'>(</span><a href="pg_ctl.c.html#LN2181"><span class='Ref_To_Local'>killproc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN63"><span class='Ref_to_EnumConst'>REGISTER_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="pg_ctl.c.html#LN135"><span class='Ref_to_Proto'>pgwin32_doRegister</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN64"><span class='Ref_to_EnumConst'>UNREGISTER_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="pg_ctl.c.html#LN136"><span class='Ref_to_Proto'>pgwin32_doUnregister</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_ctl.c.html#LN65"><span class='Ref_to_EnumConst'>RUN_AS_SERVICE_COMMAND</span></a><span class='Operator'>: 
</span>            <a href="pg_ctl.c.html#LN140"><span class='Ref_to_Proto'>pgwin32_doRunAsService</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ctl_command &raquo; </span> 
 
    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end main &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>