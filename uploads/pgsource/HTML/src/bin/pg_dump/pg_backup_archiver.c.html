<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_dump\pg_backup_archiver.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_dump\pg_backup_archiver.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:59 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_backup_archiver.c 
 * 
 *  Private implementation of the archiver routines. 
 * 
 *  See the headers to pg_restore for more details. 
 * 
 * Copyright (c) 2000, Philip Warner 
 *  Rights are granted to use this software in any way so long 
 *  as this notice is not removed. 
 * 
 *  The author is not responsible for loss or damages that may 
 *  result from its use. 
 * 
 * 
 * IDENTIFICATION 
 *      src/bin/pg_dump/pg_backup_archiver.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/wait.h&GT;</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>#include </span><span class='String'>&LT;io.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"parallel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_backup_archiver.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_backup_db.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_backup_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"dumputils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"fe_utils/string_utils.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"libpq/libpq-fs.h"</span> 
 
<a name="LN41"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TEXT_DUMP_HEADER</span> <span class='String'>"--\n-- PostgreSQL database dump\n--\n\n"</span> 
<a name="LN42"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TEXT_DUMPALL_HEADER</span> <span class='String'>"--\n-- PostgreSQL database cluster dump\n--\n\n"</span> 
 
<span class='Comment_Multi_Line'>/* state needed to save/restore an archive's output target */ 
</span><a name="LN45"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>_outputContext</span> 
<span class='Delimiter'>{ 
</span><a name="LN47"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>OF</span><span class='Delimiter'>; 
</span><a name="LN48"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>gzOut</span><span class='Delimiter'>; 
</span><a name="LN49"></a>} <span class='Declare_Typedef'>OutputContext</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* translator: this is a module name */ 
</span><a name="LN52"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>modulename</span> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"archiver"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<a name="LN55"></a><span class='Keyword'>static </span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>_allocAH</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>FileSpec</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_backup.h.html#LN36"><span class='Ref_to_Typedef'>ArchiveFormat</span></a> <span class='Declare_Parameter'>fmt</span><span class='Delimiter'>, 
</span><a name="LN56"></a>         <span class='Keyword'>const int </span><span class='Declare_Parameter'>compression</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>dosync</span><span class='Delimiter'>, </span><a href="../../include/access/xlog.h.html#LN114"><span class='Ref_to_Enum'>ArchiveMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Delimiter'>, 
</span><a name="LN57"></a>         <a href="pg_backup.h.html#LN233"><span class='Ref_to_Typedef'>SetupWorkerPtrType</span></a> <span class='Declare_Parameter'>setupWorkerPtr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN58"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_getObjectDescription</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, 
</span><a name="LN59"></a>                      <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN60"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_printTocEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isData</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>acl_pass</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN61"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>replace_line_endings</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN62"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_doSetFixedOutputState</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN63"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_doSetSessionAuth</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>user</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN64"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_doSetWithOids</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const bool </span><span class='Declare_Parameter'>withOids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN65"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_reconnectToDB</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN66"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_becomeUser</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>user</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN67"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_becomeOwner</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN68"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_selectOutputSchema</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>schemaName</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN69"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_selectTablespace</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tablespace</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>processEncodingEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN71"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>processStdStringsEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static </span><a href="pg_backup_archiver.h.html#LN205"><span class='Ref_to_Typedef'>teReqs</span></a> <span class='Declare_Prototype'>_tocEntryRequired</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN52"><span class='Ref_to_Typedef'>teSection</span></a> <span class='Declare_Parameter'>curSection</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ropt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN73"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>_tocEntryIsACL</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_disableTriggersIfNecessary</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN75"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_enableTriggersIfNecessary</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN76"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>buildTocEntryArrays</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN77"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_moveBefore</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pos</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN78"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>_discoverArchiveFormat</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN80"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>RestoringToDB</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN81"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dump_lo_buf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN82"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpTimestamp</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span>time_t <span class='Declare_Parameter'>tim</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN83"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>SetOutput</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>compression</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static </span><a href="pg_backup_archiver.c.html#LN45"><span class='Ref_to_Typedef'>OutputContext</span></a> <span class='Declare_Prototype'>SaveOutput</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN85"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RestoreOutput</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN45"><span class='Ref_to_Typedef'>OutputContext</span></a> <span class='Declare_Parameter'>savedContext</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN87"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>restore_toc_entry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_parallel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>restore_toc_entries_prefork</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>restore_toc_entries_parallel</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="parallel.h.html#LN39"><span class='Ref_to_Struct'>ParallelState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, 
</span><a name="LN90"></a>                             <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pending_list</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN91"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>restore_toc_entries_postfork</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pending_list</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN92"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>par_list_header_init</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>l</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN93"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>par_list_append</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>l</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN94"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>par_list_remove</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN95"></a><span class='Keyword'>static </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_next_work_item</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, 
</span><a name="LN96"></a>                   <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ready_list</span><span class='Delimiter'>, 
</span><a name="LN97"></a>                   <a href="parallel.h.html#LN39"><span class='Ref_to_Struct'>ParallelState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN98"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>mark_dump_job_done</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, 
</span><a name="LN99"></a>                   <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, 
</span><a name="LN100"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>status</span><span class='Delimiter'>, 
</span><a name="LN101"></a>                   <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>callback_data</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN102"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>mark_restore_job_done</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, 
</span><a name="LN103"></a>                      <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, 
</span><a name="LN104"></a>                      <span class='Keyword'>int </span><span class='Declare_Parameter'>status</span><span class='Delimiter'>, 
</span><a name="LN105"></a>                      <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>callback_data</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fix_dependencies</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>has_lock_conflicts</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te1</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN108"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>repoint_table_dependencies</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN109"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>identify_locking_dependencies</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN110"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>reduce_dependencies</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ready_list</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN112"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>mark_create_done</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN113"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>inhibit_data_for_failed_table</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN115"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>StrictNamesCheck</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ropt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Allocate a new DumpOptions block containing all default values. 
 */ 
</span><a href="pg_backup.h.html#LN126"><span class='Ref_to_Typedef'>DumpOptions</span></a> <span class='Operator'>* 
</span><a name="LN122"></a><span class='Declare_Function'>NewDumpOptions</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN124"></a>    <a href="pg_backup.h.html#LN126"><span class='Ref_to_Typedef'>DumpOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>opts</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN126"><span class='Ref_to_Typedef'>DumpOptions</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN126"><span class='Ref_to_Typedef'>DumpOptions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN133"><span class='Ref_to_Func'>InitDumpOptions</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN124"><span class='Ref_To_Local'>opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN124"><span class='Ref_To_Local'>opts</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Initialize a DumpOptions struct to all default values 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN134"></a><span class='Declare_Function'>InitDumpOptions</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN126"><span class='Ref_to_Typedef'>DumpOptions</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opts</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    memset<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN134"><span class='Ref_to_Parameter'>opts</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN126"><span class='Ref_to_Typedef'>DumpOptions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* set any fields that shouldn't default to zeroes */ 
</span>    <a href="pg_backup_archiver.c.html#LN134"><span class='Ref_to_Parameter'>opts</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN161"><span class='Ref_to_Member'>include_everything</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN134"><span class='Ref_to_Parameter'>opts</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN139"><span class='Ref_to_Member'>dumpSections</span></a> <span class='Operator'>= </span><a href="pg_backup_utils.h.html#LN22"><span class='Ref_to_EnumConst'>DUMP_UNSECTIONED</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Create a freshly allocated DumpOptions with options equivalent to those 
 * found in the given RestoreOptions. 
 */ 
</span><a href="pg_backup.h.html#LN126"><span class='Ref_to_Typedef'>DumpOptions</span></a> <span class='Operator'>* 
</span><a name="LN147"></a><span class='Declare_Function'>dumpOptionsFromRestoreOptions</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ropt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN149"></a>    <a href="pg_backup.h.html#LN126"><span class='Ref_to_Typedef'>DumpOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dopt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN121"><span class='Ref_to_Func'>NewDumpOptions</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* this is the inverse of what's at the end of pg_dump.c's main() */ 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN163"><span class='Ref_to_Member'>outputClean</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN71"><span class='Ref_to_Member'>dropSchema</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN138"><span class='Ref_to_Member'>dataOnly</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN82"><span class='Ref_to_Member'>dataOnly</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN137"><span class='Ref_to_Member'>schemaOnly</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN83"><span class='Ref_to_Member'>schemaOnly</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN147"><span class='Ref_to_Member'>if_exists</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN75"><span class='Ref_to_Member'>if_exists</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN146"><span class='Ref_to_Member'>column_inserts</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN74"><span class='Ref_to_Member'>column_inserts</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN139"><span class='Ref_to_Member'>dumpSections</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN84"><span class='Ref_to_Member'>dumpSections</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN140"><span class='Ref_to_Member'>aclsSkip</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN86"><span class='Ref_to_Member'>aclsSkip</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN168"><span class='Ref_to_Member'>outputSuperuser</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN69"><span class='Ref_to_Member'>superuser</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN164"><span class='Ref_to_Member'>outputCreateDB</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN62"><span class='Ref_to_Member'>createDB</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN167"><span class='Ref_to_Member'>outputNoOwner</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN63"><span class='Ref_to_Member'>noOwner</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN156"><span class='Ref_to_Member'>outputNoTablespaces</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN64"><span class='Ref_to_Member'>noTablespace</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN155"><span class='Ref_to_Member'>disable_triggers</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN65"><span class='Ref_to_Member'>disable_triggers</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN157"><span class='Ref_to_Member'>use_setsessauth</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN67"><span class='Ref_to_Member'>use_setsessauth</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN144"><span class='Ref_to_Member'>disable_dollar_quoting</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN72"><span class='Ref_to_Member'>disable_dollar_quoting</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN145"><span class='Ref_to_Member'>dump_inserts</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN73"><span class='Ref_to_Member'>dump_inserts</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN149"><span class='Ref_to_Member'>no_publications</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN76"><span class='Ref_to_Member'>no_publications</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN148"><span class='Ref_to_Member'>no_security_labels</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN77"><span class='Ref_to_Member'>no_security_labels</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN150"><span class='Ref_to_Member'>no_subscriptions</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN78"><span class='Ref_to_Member'>no_subscriptions</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN141"><span class='Ref_to_Member'>lockWaitTimeout</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN87"><span class='Ref_to_Member'>lockWaitTimeout</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN161"><span class='Ref_to_Member'>include_everything</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN88"><span class='Ref_to_Member'>include_everything</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN158"><span class='Ref_to_Member'>enable_row_security</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN121"><span class='Ref_to_Member'>enable_row_security</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN170"><span class='Ref_to_Member'>sequence_data</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN147"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN122"><span class='Ref_to_Member'>sequence_data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN149"><span class='Ref_To_Local'>dopt</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dumpOptionsFromRestoreOptions &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  Wrapper functions. 
 * 
 *  The objective it to make writing new formats and dumpers as simple 
 *  as possible, if necessary at the expense of extra function calls etc. 
 * 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The dump worker setup needs lots of knowledge of the internals of pg_dump, 
 * so It's defined in pg_dump.c and passed into OpenArchive. The restore worker 
 * setup doesn't need to know anything much, so it's defined here. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN194"></a><span class='Declare_Function'>setupRestoreWorker</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AHX</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN196"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN194"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN196"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN256"><span class='Ref_to_Member'>ReopenPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN196"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* Create a new archive */ 
/* Public */ 
</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>* 
</span><a name="LN205"></a><span class='Declare_Function'>CreateArchive</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>FileSpec</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_backup.h.html#LN36"><span class='Ref_to_Typedef'>ArchiveFormat</span></a> <span class='Declare_Parameter'>fmt</span><span class='Delimiter'>, 
</span><a name="LN206"></a>              <span class='Keyword'>const int </span><span class='Declare_Parameter'>compression</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>dosync</span><span class='Delimiter'>, </span><a href="../../include/access/xlog.h.html#LN114"><span class='Ref_to_Enum'>ArchiveMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Delimiter'>, 
</span><a name="LN207"></a>              <a href="pg_backup.h.html#LN233"><span class='Ref_to_Typedef'>SetupWorkerPtrType</span></a> <span class='Declare_Parameter'>setupDumpWorker</span><span class='Parentheses'>) 
</span> 
<span class='Delimiter'>{ 
</span><a name="LN210"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN55"><span class='Ref_to_Proto'>_allocAH</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN205"><span class='Ref_to_Parameter'>FileSpec</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN205"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN206"><span class='Ref_to_Parameter'>compression</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN206"><span class='Ref_to_Parameter'>dosync</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_backup_archiver.c.html#LN206"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN207"><span class='Ref_to_Parameter'>setupDumpWorker</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN210"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Open an existing archive */ 
/* Public */ 
</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>* 
</span><a name="LN219"></a><span class='Declare_Function'>OpenArchive</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>FileSpec</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_backup.h.html#LN36"><span class='Ref_to_Typedef'>ArchiveFormat</span></a> <span class='Declare_Parameter'>fmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN221"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN55"><span class='Ref_to_Proto'>_allocAH</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN219"><span class='Ref_to_Parameter'>FileSpec</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN219"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN49"><span class='Ref_to_EnumConst'>archModeRead</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN193"><span class='Ref_to_Func'>setupRestoreWorker</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN221"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Public */ 
</span><span class='Keyword'>void 
</span><a name="LN228"></a><span class='Declare_Function'>CloseArchive</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AHX</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN230"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN231"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN228"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN231"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN255"><span class='Ref_to_Member'>ClosePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN231"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Close the output */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN231"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN300"><span class='Ref_to_Member'>gzOut</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN230"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN42"><span class='Ref_to_Macro'>GZCLOSE</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN231"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN231"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a> <span class='Operator'>!= </span>stdout<span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN230"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>fclose<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN231"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN230"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not close output file: %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Public */ 
</span><span class='Keyword'>void 
</span><a name="LN248"></a><span class='Declare_Function'>SetArchiveOptions</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN126"><span class='Ref_to_Typedef'>DumpOptions</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dopt</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ropt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Caller can omit dump options, in which case we synthesize them */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN248"><span class='Ref_to_Parameter'>dopt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN248"><span class='Ref_to_Parameter'>ropt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN248"><span class='Ref_to_Parameter'>dopt</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN146"><span class='Ref_to_Func'>dumpOptionsFromRestoreOptions</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN248"><span class='Ref_to_Parameter'>ropt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save options for later access */ 
</span>    <a href="pg_backup_archiver.c.html#LN248"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN179"><span class='Ref_to_Member'>dopt</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN248"><span class='Ref_to_Parameter'>dopt</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN248"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN248"><span class='Ref_to_Parameter'>ropt</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Public */ 
</span><span class='Keyword'>void 
</span><a name="LN261"></a><span class='Declare_Function'>ProcessArchiveRestoreOptions</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AHX</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN263"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN261"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>; 
</span><a name="LN264"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN263"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span><a name="LN265"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span><a name="LN266"></a>    <a href="pg_backup.h.html#LN52"><span class='Ref_to_Typedef'>teSection</span></a>   <span class='Declare_Local'>curSection</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Decide which TOC entries will be dumped/restored, and mark them */ 
</span>    <a href="pg_backup_archiver.c.html#LN266"><span class='Ref_To_Local'>curSection</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN55"><span class='Ref_to_EnumConst'>SECTION_PRE_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN265"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN263"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN265"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN263"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN265"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN265"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * When writing an archive, we also take this opportunity to check 
         * that we have generated the entries in a sane order that respects 
         * the section divisions.  When reading, don't complain, since buggy 
         * old versions of pg_dump might generate out-of-order archives. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN263"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN316"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>!= </span><a href="pg_backup.h.html#LN49"><span class='Ref_to_EnumConst'>archModeRead</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN265"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="pg_backup.h.html#LN54"><span class='Ref_to_EnumConst'>SECTION_NONE</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ok to be anywhere */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="pg_backup.h.html#LN55"><span class='Ref_to_EnumConst'>SECTION_PRE_DATA</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN266"><span class='Ref_To_Local'>curSection</span></a> <span class='Operator'>!= </span><a href="pg_backup.h.html#LN55"><span class='Ref_to_EnumConst'>SECTION_PRE_DATA</span></a><span class='Parentheses'>) 
</span>                        <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                                  <span class='String'>"WARNING: archive items not in correct section order\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="pg_backup.h.html#LN56"><span class='Ref_to_EnumConst'>SECTION_DATA</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN266"><span class='Ref_To_Local'>curSection</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN57"><span class='Ref_to_EnumConst'>SECTION_POST_DATA</span></a><span class='Parentheses'>) 
</span>                        <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                                  <span class='String'>"WARNING: archive items not in correct section order\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="pg_backup.h.html#LN57"><span class='Ref_to_EnumConst'>SECTION_POST_DATA</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ok no matter which section we were in */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected section code %d\n"</span><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN265"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch te-&GT;section &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if AH-&GT;mode!=archModeRea... &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN265"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>!= </span><a href="pg_backup.h.html#LN54"><span class='Ref_to_EnumConst'>SECTION_NONE</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN266"><span class='Ref_To_Local'>curSection</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN265"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN265"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN72"><span class='Ref_to_Proto'>_tocEntryRequired</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN265"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN266"><span class='Ref_To_Local'>curSection</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN264"><span class='Ref_To_Local'>ropt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for te=AH-&GT;toc-&GT;next;te!=... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Enforce strict names checking */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN264"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN79"><span class='Ref_to_Member'>strict_names</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN115"><span class='Ref_to_Proto'>StrictNamesCheck</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN264"><span class='Ref_To_Local'>ropt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ProcessArchiveRestoreOptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Public */ 
</span><span class='Keyword'>void 
</span><a name="LN318"></a><span class='Declare_Function'>RestoreArchive</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AHX</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN320"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN318"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>; 
</span><a name="LN321"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span><a name="LN322"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>parallel_mode</span><span class='Delimiter'>; 
</span><a name="LN323"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span><a name="LN324"></a>    <a href="pg_backup_archiver.c.html#LN45"><span class='Ref_to_Typedef'>OutputContext</span></a> <span class='Declare_Local'>sav</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN330"><span class='Ref_to_Member'>stage</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN193"><span class='Ref_to_EnumConst'>STAGE_INITIALIZING</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for nonsensical option combinations. 
     * 
     * -C is not compatible with -1, because we can't create a database inside 
     * a transaction block. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN62"><span class='Ref_to_Member'>createDB</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN118"><span class='Ref_to_Member'>single_txn</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"-C and -1 are incompatible options\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're going to do parallel restore, there are some restrictions. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN322"><span class='Ref_To_Local'>parallel_mode</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN190"><span class='Ref_to_Member'>numWorkers</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN107"><span class='Ref_to_Member'>useDB</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN322"><span class='Ref_To_Local'>parallel_mode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We haven't got round to making this work for all archive formats */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN274"><span class='Ref_to_Member'>ClonePtr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN256"><span class='Ref_to_Member'>ReopenPtr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"parallel restore is not supported with this archive file format\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Doesn't work if the archive represents dependencies as OIDs */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.h.html#LN84"><span class='Ref_to_Const'>K_VERS_1_8</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"parallel restore is not supported with archives made by pre-8.0 pg_dump\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * It's also not gonna work if we can't reopen the input file, so 
         * let's try that immediately. 
         */ 
</span>        <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN256"><span class='Ref_to_Member'>ReopenPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure we won't need (de)compression we haven't got 
     */ 
</span><span class='Directive'>#ifndef</span> HAVE_LIBZ 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN263"><span class='Ref_to_Member'>PrintTocDataPtr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN343"><span class='Ref_to_Member'>hadDumper</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a> <span class='Operator'>& </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"cannot restore from compressed archive (compression not supported in this installation)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Prepare index arrays, so we can assume we have them throughout restore. 
     * It's possible we already did this, though. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN76"><span class='Ref_to_Proto'>buildTocEntryArrays</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're using a DB connection, then connect it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN107"><span class='Ref_to_Member'>useDB</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"connecting to database for restore\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.h.html#LN78"><span class='Ref_to_Const'>K_VERS_1_3</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"direct database connections are not supported in pre-1.3 archives\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't want to guess at whether the dump will successfully 
         * restore; allow the attempt regardless of the version of the restore 
         * target. 
         */ 
</span>        <a href="pg_backup_archiver.c.html#LN318"><span class='Ref_to_Parameter'>AHX</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN187"><span class='Ref_to_Member'>minRemoteVersion</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN318"><span class='Ref_to_Parameter'>AHX</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN188"><span class='Ref_to_Member'>maxRemoteVersion</span></a> <span class='Operator'>= </span><span class='Number'>9999999</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup.h.html#LN239"><span class='Ref_to_Proto'>ConnectDatabase</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN318"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN108"><span class='Ref_to_Member'>dbname</span></a><span class='Delimiter'>, 
</span>                        <a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN110"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN109"><span class='Ref_to_Member'>pgport</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN111"><span class='Ref_to_Member'>username</span></a><span class='Delimiter'>, 
</span>                        <a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN113"><span class='Ref_to_Member'>promptPassword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we're talking to the DB directly, don't send comments since they 
         * obscure SQL when displaying errors 
         */ 
</span>        <a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN329"><span class='Ref_to_Member'>noTocComments</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ropt-&GT;useDB &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Work out if we have an implied data-only restore. This can happen if 
     * the dump was data only or if the user has used a toc list to exclude 
     * all of the schema data. All we do is look for schema entries - if none 
     * are found then we set the dataOnly flag. 
     * 
     * We could scan for wanted TABLE entries, but that is not the same as 
     * dataOnly. At this stage, it seems unnecessary (6-Mar-2001). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN82"><span class='Ref_to_Member'>dataOnly</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN418"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>impliedDataOnly</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a> <span class='Operator'>& </span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{</span>                   <span class='Comment_Single_Line'>/* It's schema, and it's wanted */ 
</span>                <a href="pg_backup_archiver.c.html#LN418"><span class='Ref_To_Local'>impliedDataOnly</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN418"><span class='Ref_To_Local'>impliedDataOnly</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN82"><span class='Ref_to_Member'>dataOnly</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN418"><span class='Ref_To_Local'>impliedDataOnly</span></a><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"implied data-only restore\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup the output file if necessary. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN324"><span class='Ref_To_Local'>sav</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN84"><span class='Ref_to_Proto'>SaveOutput</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN81"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN115"><span class='Ref_to_Member'>compression</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN83"><span class='Ref_to_Proto'>SetOutput</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN81"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN115"><span class='Ref_to_Member'>compression</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- PostgreSQL database dump\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN217"><span class='Ref_to_Member'>archiveRemoteVersion</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"-- Dumped from database version %s\n"</span><span class='Delimiter'>, 
</span>                 <a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN217"><span class='Ref_to_Member'>archiveRemoteVersion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN219"><span class='Ref_to_Member'>archiveDumpVersion</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"-- Dumped by pg_dump version %s\n"</span><span class='Delimiter'>, 
</span>                 <a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN219"><span class='Ref_to_Member'>archiveDumpVersion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN182"><span class='Ref_to_Member'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN48"><span class='Ref_to_Proto'>dumpTimestamp</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"Started on"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN231"><span class='Ref_to_Member'>createDate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN118"><span class='Ref_to_Member'>single_txn</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_db.h.html#LN22"><span class='Ref_to_Proto'>StartTransaction</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN318"><span class='Ref_to_Parameter'>AHX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"BEGIN;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Establish important parameter values right away. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN62"><span class='Ref_to_Proto'>_doSetFixedOutputState</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN330"><span class='Ref_to_Member'>stage</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN194"><span class='Ref_to_EnumConst'>STAGE_PROCESSING</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Drop the items at the start, in reverse order 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN71"><span class='Ref_to_Member'>dropSchema</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In createDB mode, issue a DROP *only* for the database as a 
             * whole.  Issuing drops against anything else would be wrong, 
             * because at this point we're connected to the wrong database. 
             * Conversely, if we're not in createDB mode, we'd better not 
             * issue a DROP against the database at all. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN62"><span class='Ref_to_Member'>createDB</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"DATABASE"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"DATABASE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Otherwise, drop anything that's selected and has a dropStmt */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a> <span class='Operator'>| </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN353"><span class='Ref_to_Member'>dropStmt</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"dropping %s %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Select owner and schema as necessary */ 
</span>                <a href="pg_backup_archiver.c.html#LN67"><span class='Ref_to_Proto'>_becomeOwner</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_backup_archiver.c.html#LN68"><span class='Ref_to_Proto'>_selectOutputSchema</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Now emit the DROP command, if the object has one.  Note we 
                 * don't necessarily emit it verbatim; at this point we add an 
                 * appropriate IF EXISTS clause, if the user requested it. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN353"><span class='Ref_to_Member'>dropStmt</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN75"><span class='Ref_to_Member'>if_exists</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* No --if-exists?  Then just use the original */ 
</span>                        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN353"><span class='Ref_to_Member'>dropStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Inject an appropriate spelling of "if exists".  For 
                         * large objects, we have a separate routine that 
                         * knows how to do it, without depending on 
                         * te-&GT;dropStmt; use that.  For other objects we need 
                         * to parse the command. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOB"</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="pg_backup_archiver.h.html#LN427"><span class='Ref_to_Proto'>DropBlobIfExists</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN226"><span class='Ref_to_Member'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                        <span class='Delimiter'>{ 
</span><a name="LN533"></a>                            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dropStmt</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN353"><span class='Ref_to_Member'>dropStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN534"></a>                            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dropStmtOrig</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN533"><span class='Ref_To_Local'>dropStmt</span></a><span class='Delimiter'>; 
</span><a name="LN535"></a>                            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>ftStmt</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                            <span class='Comment_Multi_Line'>/* 
                             * Need to inject IF EXISTS clause after ALTER 
                             * TABLE part in ALTER TABLE .. DROP statement 
                             */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN533"><span class='Ref_To_Local'>dropStmt</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <span class='Delimiter'>{ 
</span>                                <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN535"><span class='Ref_To_Local'>ftStmt</span></a><span class='Delimiter'>, 
</span>                                                  <span class='String'>"ALTER TABLE IF EXISTS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="pg_backup_archiver.c.html#LN533"><span class='Ref_To_Local'>dropStmt</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN533"><span class='Ref_To_Local'>dropStmt</span></a> <span class='Operator'>+ </span><span class='Number'>11</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span> 
                            <span class='Comment_Multi_Line'>/* 
                             * ALTER TABLE..ALTER COLUMN..DROP DEFAULT does 
                             * not support the IF EXISTS clause, and therefore 
                             * we simply emit the original command for DEFAULT 
                             * objects (modulo the adjustment made above). 
                             * 
                             * If we used CREATE OR REPLACE VIEW as a means of 
                             * quasi-dropping an ON SELECT rule, that should 
                             * be emitted unchanged as well. 
                             * 
                             * For other object types, we need to extract the 
                             * first part of the DROP which includes the 
                             * object type.  Most of the time this matches 
                             * te-&GT;desc, so search for that; however for the 
                             * different kinds of CONSTRAINTs, we know to 
                             * search for hardcoded "DROP CONSTRAINT" instead. 
                             */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"DEFAULT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                                strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN533"><span class='Ref_To_Local'>dropStmt</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE OR REPLACE VIEW"</span><span class='Delimiter'>, </span><span class='Number'>22</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN535"><span class='Ref_To_Local'>ftStmt</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN533"><span class='Ref_To_Local'>dropStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> 
                            <span class='Delimiter'>{ 
</span><a name="LN570"></a>                                <span class='Keyword'>char</span>        <span class='Declare_Local'>buffer</span><span class='Delimiter'>[</span><span class='Number'>40</span><span class='Delimiter'>]; 
</span><a name="LN571"></a>                                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>mark</span><span class='Delimiter'>; 
</span> 
                                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"CHECK CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                                    strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"FK CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                                    <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN570"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='String'>"DROP CONSTRAINT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>else</span> 
                                    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN570"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN570"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"DROP %s"</span><span class='Delimiter'>, 
</span>                                             <a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                                <a href="pg_backup_archiver.c.html#LN571"><span class='Ref_To_Local'>mark</span></a> <span class='Operator'>= </span>strstr<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN533"><span class='Ref_To_Local'>dropStmt</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN570"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN571"><span class='Ref_To_Local'>mark</span></a><span class='Parentheses'>) 
</span>                                <span class='Delimiter'>{ 
</span>                                    <span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN571"><span class='Ref_To_Local'>mark</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                                    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN535"><span class='Ref_To_Local'>ftStmt</span></a><span class='Delimiter'>, </span><span class='String'>"%s%s IF EXISTS%s"</span><span class='Delimiter'>, 
</span>                                                      <a href="pg_backup_archiver.c.html#LN533"><span class='Ref_To_Local'>dropStmt</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN570"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, 
</span>                                                      <a href="pg_backup_archiver.c.html#LN571"><span class='Ref_To_Local'>mark</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN570"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                                <span class='Delimiter'>} 
</span>                                <span class='Control'>else</span> 
                                <span class='Delimiter'>{ 
</span>                                    <span class='Comment_Multi_Line'>/* complain and emit unmodified command */ 
</span>                                    <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                                              <span class='String'>"WARNING: could not find where to insert IF EXISTS in statement \"%s\"\n"</span><span class='Delimiter'>, 
</span>                                              <a href="pg_backup_archiver.c.html#LN534"><span class='Ref_To_Local'>dropStmtOrig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN535"><span class='Ref_To_Local'>ftStmt</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN533"><span class='Ref_To_Local'>dropStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Delimiter'>} 
</span>                            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
                            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN535"><span class='Ref_To_Local'>ftStmt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN535"><span class='Ref_To_Local'>ftStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN534"><span class='Ref_To_Local'>dropStmtOrig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *te-&GT;dropStmt!='\0' &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ((te-&GT;reqs&(REQ_SCHEM... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for te=AH-&GT;toc-&GT;prev;te!=... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * _selectOutputSchema may have set currSchema to reflect the effect 
         * of a "SET search_path" command it emitted.  However, by now we may 
         * have dropped that schema; or it might not have existed in the first 
         * place.  In either case the effective value of search_path will not 
         * be what we think.  Forcibly reset currSchema so that we will 
         * re-establish the search_path setting when needed (after creating 
         * the schema). 
         * 
         * If we treated users as pg_dump'able objects then we'd need to reset 
         * currUser here too. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ropt-&GT;dropSchema &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * In serial mode, we now process each non-ACL TOC entry. 
     * 
     * In parallel mode, turn control over to the parallel-restore logic. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN322"><span class='Ref_To_Local'>parallel_mode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN634"></a>        <a href="parallel.h.html#LN39"><span class='Ref_to_Struct'>ParallelState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span><a name="LN635"></a>        <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>    <span class='Declare_Local'>pending_list</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN92"><span class='Ref_to_Proto'>par_list_header_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN635"><span class='Ref_To_Local'>pending_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* This runs PRE_DATA items and then disconnects from the database */ 
</span>        <a href="pg_backup_archiver.c.html#LN88"><span class='Ref_to_Proto'>restore_toc_entries_prefork</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ParallelBackupStart() will actually fork the processes */ 
</span>        <a href="pg_backup_archiver.c.html#LN634"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="parallel.h.html#LN58"><span class='Ref_to_Proto'>ParallelBackupStart</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN89"><span class='Ref_to_Proto'>restore_toc_entries_parallel</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN634"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN635"><span class='Ref_To_Local'>pending_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parallel.h.html#LN65"><span class='Ref_to_Proto'>ParallelBackupEnd</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN634"><span class='Ref_To_Local'>pstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* reconnect the master and see if we missed something */ 
</span>        <a href="pg_backup_archiver.c.html#LN91"><span class='Ref_to_Proto'>restore_toc_entries_postfork</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN635"><span class='Ref_To_Local'>pending_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if parallel_mode &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN87"><span class='Ref_to_Proto'>restore_toc_entry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan TOC again to output ownership commands and ACLs 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Both schema and data objects might now have ownership/ACLs */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a> <span class='Operator'>| </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Show namespace if available */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"setting owner and privileges for %s \"%s.%s\"\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"setting owner and privileges for %s \"%s\"\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN60"><span class='Ref_to_Proto'>_printTocEntry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN323"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN118"><span class='Ref_to_Member'>single_txn</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_db.h.html#LN23"><span class='Ref_to_Proto'>CommitTransaction</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN318"><span class='Ref_to_Parameter'>AHX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"COMMIT;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN182"><span class='Ref_to_Member'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN48"><span class='Ref_to_Proto'>dumpTimestamp</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"Completed on"</span><span class='Delimiter'>, </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- PostgreSQL database dump complete\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clean up & we're done. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN330"><span class='Ref_to_Member'>stage</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN195"><span class='Ref_to_EnumConst'>STAGE_FINALIZING</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN81"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN115"><span class='Ref_to_Member'>compression</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN85"><span class='Ref_to_Proto'>RestoreOutput</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN324"><span class='Ref_To_Local'>sav</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN321"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN107"><span class='Ref_to_Member'>useDB</span></a><span class='Parentheses'>) 
</span>        <a href="../scripts/vacuumdb.c.html#LN73"><span class='Ref_to_Proto'>DisconnectDatabase</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN320"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RestoreArchive &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Restore a single TOC item.  Used in both parallel and non-parallel restore; 
 * is_parallel is true if we are in a worker child process. 
 * 
 * Returns 0 normally, but WORKER_CREATE_DONE or WORKER_INHIBIT_DATA if 
 * the parallel parent has to make the corresponding status update. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN712"></a><span class='Declare_Function'>restore_toc_entry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_parallel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN714"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span><a name="LN715"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>status</span> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN114"><span class='Ref_to_Const'>WORKER_OK</span></a><span class='Delimiter'>; 
</span><a name="LN716"></a>    <a href="pg_backup_archiver.h.html#LN205"><span class='Ref_to_Typedef'>teReqs</span></a>      <span class='Declare_Local'>reqs</span><span class='Delimiter'>; 
</span><a name="LN717"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>defnDumped</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Work out what, if anything, we want from this entry */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN73"><span class='Ref_to_Proto'>_tocEntryIsACL</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>))</span> 
        <a href="pg_backup_archiver.c.html#LN716"><span class='Ref_To_Local'>reqs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* ACLs are never restored here */ 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN716"><span class='Ref_To_Local'>reqs</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ignore DATABASE entry unless we should create it.  We must check this 
     * here, not in _tocEntryRequired, because the createDB option should not 
     * affect emitting a DATABASE entry to an archive file. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN714"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN62"><span class='Ref_to_Member'>createDB</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"DATABASE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.c.html#LN716"><span class='Ref_To_Local'>reqs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Dump any relevant dump warnings to stderr */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN714"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN116"><span class='Ref_to_Member'>suppressDumpWarnings</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"WARNING"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN714"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN82"><span class='Ref_to_Member'>dataOnly</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"warning from original dump file: %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"warning from original dump file: %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_archiver.c.html#LN717"><span class='Ref_To_Local'>defnDumped</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN716"><span class='Ref_To_Local'>reqs</span></a> <span class='Operator'>& </span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* We want the schema */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Show namespace if available */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"creating %s \"%s.%s\"\n"</span><span class='Delimiter'>, 
</span>                  <a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"creating %s \"%s\"\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
        <a href="pg_backup_archiver.c.html#LN60"><span class='Ref_to_Proto'>_printTocEntry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN717"><span class='Ref_To_Local'>defnDumped</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN333"><span class='Ref_to_Member'>lastErrorTE</span></a> <span class='Operator'>== </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * We failed to create the table. If 
                 * --no-data-for-failed-tables was given, mark the 
                 * corresponding TABLE DATA to be ignored. 
                 * 
                 * In the parallel case this must be done in the parent, so we 
                 * just set the return value. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN714"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN112"><span class='Ref_to_Member'>noDataForFailedTables</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>is_parallel</span></a><span class='Parentheses'>) 
</span>                        <a href="pg_backup_archiver.c.html#LN715"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN116"><span class='Ref_to_Const'>WORKER_INHIBIT_DATA</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="pg_backup_archiver.c.html#LN113"><span class='Ref_to_Proto'>inhibit_data_for_failed_table</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * We created the table successfully.  Mark the corresponding 
                 * TABLE DATA for possible truncation. 
                 * 
                 * In the parallel case this must be done in the parent, so we 
                 * just set the return value. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>is_parallel</span></a><span class='Parentheses'>) 
</span>                    <a href="pg_backup_archiver.c.html#LN715"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN115"><span class='Ref_to_Const'>WORKER_CREATE_DONE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pg_backup_archiver.c.html#LN112"><span class='Ref_to_Proto'>mark_create_done</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(te-&GT;desc,"TABL... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* If we created a DB, connect to it... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"DATABASE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN798"></a>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>connstr</span><span class='Delimiter'>; 
</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN798"><span class='Ref_To_Local'>connstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN798"><span class='Ref_To_Local'>connstr</span></a><span class='Delimiter'>, </span><span class='String'>"dbname="</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/fe_utils/string_utils.h.html#LN45"><span class='Ref_to_Proto'>appendConnStrVal</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN798"><span class='Ref_To_Local'>connstr</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Abandon struct, but keep its buffer until process exit. */ 
</span> 
            <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"connecting to new database \"%s\"\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN65"><span class='Ref_to_Proto'>_reconnectToDB</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN714"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN108"><span class='Ref_to_Member'>dbname</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN798"><span class='Ref_To_Local'>connstr</span></a><span class='Operator'>.</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (reqs&REQ_SCHEMA)!=0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we have a data component, then process it 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN716"><span class='Ref_To_Local'>reqs</span></a> <span class='Operator'>& </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * hadDumper will be set if there is genuine data component for this 
         * node. Otherwise, we need to check the defn field for statements 
         * that need to be executed in data-only restores. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN343"><span class='Ref_to_Member'>hadDumper</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If we can output the data, then restore it. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN263"><span class='Ref_to_Member'>PrintTocDataPtr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN60"><span class='Ref_to_Proto'>_printTocEntry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOBS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                    strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOB COMMENTS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"processing %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_backup_archiver.c.html#LN68"><span class='Ref_to_Proto'>_selectOutputSchema</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"pg_catalog"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Send BLOB COMMENTS data to ExecuteSimpleCommands() */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOB COMMENTS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN290"><span class='Ref_to_Member'>outputKind</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN202"><span class='Ref_to_EnumConst'>OUTPUT_OTHERDATA</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN263"><span class='Ref_to_Member'>PrintTocDataPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN290"><span class='Ref_to_Member'>outputKind</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN200"><span class='Ref_to_EnumConst'>OUTPUT_SQLCMDS</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pg_backup_archiver.c.html#LN74"><span class='Ref_to_Proto'>_disableTriggersIfNecessary</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Select owner and schema as necessary */ 
</span>                    <a href="pg_backup_archiver.c.html#LN67"><span class='Ref_to_Proto'>_becomeOwner</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pg_backup_archiver.c.html#LN68"><span class='Ref_to_Proto'>_selectOutputSchema</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"processing data for table \"%s.%s\"\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * In parallel restore, if we created the table earlier in 
                     * the run then we wrap the COPY in a transaction and 
                     * precede it with a TRUNCATE.  If archiving is not on 
                     * this prevents WAL-logging the COPY.  This obtains a 
                     * speedup similar to that from using single_txn mode in 
                     * non-parallel restores. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>is_parallel</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN364"><span class='Ref_to_Member'>created</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Parallel restore is always talking directly to a 
                         * server, so no need to see if we should issue BEGIN. 
                         */ 
</span>                        <a href="pg_backup_db.h.html#LN22"><span class='Ref_to_Proto'>StartTransaction</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * If the server version is &GT;= 8.4, make sure we issue 
                         * TRUNCATE with ONLY so that child tables are not 
                         * wiped. 
                         */ 
</span>                        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"TRUNCATE TABLE %s%s;\n\n"</span><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN322"><span class='Ref_to_Proto'>PQserverVersion</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>80400</span> <span class='Operator'>? 
</span>                                  <span class='String'>"ONLY "</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If we have a copy statement, use it. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a> <span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN290"><span class='Ref_to_Member'>outputKind</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN201"><span class='Ref_to_EnumConst'>OUTPUT_COPYDATA</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN290"><span class='Ref_to_Member'>outputKind</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN202"><span class='Ref_to_EnumConst'>OUTPUT_OTHERDATA</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN263"><span class='Ref_to_Member'>PrintTocDataPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Terminate COPY if needed. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN290"><span class='Ref_to_Member'>outputKind</span></a> <span class='Operator'>== </span><a href="pg_backup_archiver.h.html#LN201"><span class='Ref_to_EnumConst'>OUTPUT_COPYDATA</span></a> <span class='Operator'>&& 
</span>                        <a href="pg_backup_archiver.c.html#LN80"><span class='Ref_to_Proto'>RestoringToDB</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>))</span> 
                        <a href="pg_backup_db.h.html#LN20"><span class='Ref_to_Proto'>EndDBCopyMode</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN290"><span class='Ref_to_Member'>outputKind</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN200"><span class='Ref_to_EnumConst'>OUTPUT_SQLCMDS</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* close out the transaction started above */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>is_parallel</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN364"><span class='Ref_to_Member'>created</span></a><span class='Parentheses'>) 
</span>                        <a href="pg_backup_db.h.html#LN23"><span class='Ref_to_Proto'>CommitTransaction</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_backup_archiver.c.html#LN75"><span class='Ref_to_Proto'>_enableTriggersIfNecessary</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if AH-&GT;PrintTocDataPtr!=... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if te-&GT;hadDumper &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN717"><span class='Ref_To_Local'>defnDumped</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* If we haven't already dumped the defn part, do so now */ 
</span>            <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"executing %s %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN60"><span class='Ref_to_Proto'>_printTocEntry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (reqs&REQ_DATA)!=0 &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN712"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN201"><span class='Ref_to_Member'>n_errors</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN715"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>== </span><a href="pg_backup_archiver.h.html#LN114"><span class='Ref_to_Const'>WORKER_OK</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN715"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN117"><span class='Ref_to_Const'>WORKER_IGNORED_ERRORS</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN715"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end restore_toc_entry &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Allocate a new RestoreOptions block. 
 * This is mainly so we can initialize it, but also for future expansion, 
 */ 
</span><a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>* 
</span><a name="LN931"></a><span class='Declare_Function'>NewRestoreOptions</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN933"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>opts</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN933"><span class='Ref_To_Local'>opts</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set any fields that shouldn't default to zeroes */ 
</span>    <a href="pg_backup_archiver.c.html#LN933"><span class='Ref_To_Local'>opts</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN92"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN38"><span class='Ref_to_EnumConst'>archUnknown</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN933"><span class='Ref_To_Local'>opts</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN113"><span class='Ref_to_Member'>promptPassword</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN31"><span class='Ref_to_EnumConst'>TRI_DEFAULT</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN933"><span class='Ref_To_Local'>opts</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN84"><span class='Ref_to_Member'>dumpSections</span></a> <span class='Operator'>= </span><a href="pg_backup_utils.h.html#LN22"><span class='Ref_to_EnumConst'>DUMP_UNSECTIONED</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN933"><span class='Ref_To_Local'>opts</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN946"></a><span class='Declare_Function'>_disableTriggersIfNecessary</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN948"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN946"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This hack is only needed in a data-only restore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN948"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN82"><span class='Ref_to_Member'>dataOnly</span></a> <span class='Operator'>|| !</span><a href="pg_backup_archiver.c.html#LN948"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN65"><span class='Ref_to_Member'>disable_triggers</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN946"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"disabling triggers for %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN946"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Become superuser if possible, since they are the only ones who can 
     * disable constraint triggers.  If -S was not given, assume the initial 
     * user identity is a superuser.  (XXX would it be better to become the 
     * table owner?) 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN66"><span class='Ref_to_Proto'>_becomeUser</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN946"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN948"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN69"><span class='Ref_to_Member'>superuser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Disable them. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN68"><span class='Ref_to_Proto'>_selectOutputSchema</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN946"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN946"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN946"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE %s DISABLE TRIGGER ALL;\n\n"</span><span class='Delimiter'>, 
</span>             <a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN946"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _disableTriggersIfNecessary &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN974"></a><span class='Declare_Function'>_enableTriggersIfNecessary</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN976"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN974"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This hack is only needed in a data-only restore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN976"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN82"><span class='Ref_to_Member'>dataOnly</span></a> <span class='Operator'>|| !</span><a href="pg_backup_archiver.c.html#LN976"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN65"><span class='Ref_to_Member'>disable_triggers</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN974"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"enabling triggers for %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN974"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Become superuser if possible, since they are the only ones who can 
     * disable constraint triggers.  If -S was not given, assume the initial 
     * user identity is a superuser.  (XXX would it be better to become the 
     * table owner?) 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN66"><span class='Ref_to_Proto'>_becomeUser</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN974"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN976"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN69"><span class='Ref_to_Member'>superuser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Enable them. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN68"><span class='Ref_to_Proto'>_selectOutputSchema</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN974"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN974"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN974"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE %s ENABLE TRIGGER ALL;\n\n"</span><span class='Delimiter'>, 
</span>             <a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN974"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _enableTriggersIfNecessary &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This is a routine that is part of the dumper interface, hence the 'Archive*' parameter. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* Public */ 
</span><span class='Keyword'>void 
</span><a name="LN1007"></a><span class='Declare_Function'>WriteData</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AHX</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>dLen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1009"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1007"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN1009"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN310"><span class='Ref_to_Member'>currToc</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"internal error -- WriteData cannot be called outside the context of a DataDumper routine\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1009"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN248"><span class='Ref_to_Member'>WriteDataPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1009"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1007"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1007"><span class='Ref_to_Parameter'>dLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Create a new TOC entry. The TOC was designed as a TOC, but is now the 
 * repository for all metadata. But the name has stuck. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* Public */ 
</span><span class='Keyword'>void 
</span><a name="LN1026"></a><span class='Declare_Function'>ArchiveEntry</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AHX</span><span class='Delimiter'>, 
</span><a name="LN1027"></a>             <a href="pg_backup.h.html#LN223"><span class='Ref_to_Typedef'>CatalogId</span></a> <span class='Declare_Parameter'>catalogId</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Declare_Parameter'>dumpId</span><span class='Delimiter'>, 
</span><a name="LN1028"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tag</span><span class='Delimiter'>, 
</span><a name="LN1029"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>namespace</span><span class='Delimiter'>, 
</span><a name="LN1030"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tablespace</span><span class='Delimiter'>, 
</span><a name="LN1031"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>owner</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>withOids</span><span class='Delimiter'>, 
</span><a name="LN1032"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN52"><span class='Ref_to_Typedef'>teSection</span></a> <span class='Declare_Parameter'>section</span><span class='Delimiter'>, 
</span><a name="LN1033"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>defn</span><span class='Delimiter'>, 
</span><a name="LN1034"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dropStmt</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>copyStmt</span><span class='Delimiter'>, 
</span><a name="LN1035"></a>             <span class='Keyword'>const </span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>deps</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nDeps</span><span class='Delimiter'>, 
</span><a name="LN1036"></a>             <a href="pg_backup.h.html#LN231"><span class='Ref_to_Typedef'>DataDumperPtr</span></a> <span class='Declare_Parameter'>dumpFn</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>dumpArg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1038"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1026"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>; 
</span><a name="LN1039"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newToc</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1038"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN303"><span class='Ref_to_Member'>tocCount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1027"><span class='Ref_to_Parameter'>dumpId</span></a> <span class='Operator'>&GT; </span><a href="pg_backup_archiver.c.html#LN1038"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1038"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1027"><span class='Ref_to_Parameter'>dumpId</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1038"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1038"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1038"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1038"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1027"><span class='Ref_to_Parameter'>catalogId</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1027"><span class='Ref_to_Parameter'>dumpId</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1032"><span class='Ref_to_Parameter'>section</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1028"><span class='Ref_to_Parameter'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span> <span class='Operator'>= </span><span class='Control'>namespace</span> <span class='Operator'>? </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><span class='Control'>namespace</span><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN347"><span class='Ref_to_Member'>tablespace</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1030"><span class='Ref_to_Parameter'>tablespace</span></a> <span class='Operator'>? </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1030"><span class='Ref_to_Parameter'>tablespace</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN349"><span class='Ref_to_Member'>owner</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1031"><span class='Ref_to_Parameter'>owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN350"><span class='Ref_to_Member'>withOids</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1031"><span class='Ref_to_Parameter'>withOids</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1032"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1033"><span class='Ref_to_Parameter'>defn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN353"><span class='Ref_to_Member'>dropStmt</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1034"><span class='Ref_to_Parameter'>dropStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1034"><span class='Ref_to_Parameter'>copyStmt</span></a> <span class='Operator'>? </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1034"><span class='Ref_to_Parameter'>copyStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1035"><span class='Ref_to_Parameter'>nDeps</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1035"><span class='Ref_to_Parameter'>nDeps</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1035"><span class='Ref_to_Parameter'>deps</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1035"><span class='Ref_to_Parameter'>nDeps</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1035"><span class='Ref_to_Parameter'>nDeps</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN358"><span class='Ref_to_Member'>dataDumper</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1036"><span class='Ref_to_Parameter'>dumpFn</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN359"><span class='Ref_to_Member'>dataDumperArg</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1036"><span class='Ref_to_Parameter'>dumpArg</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN343"><span class='Ref_to_Member'>hadDumper</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1036"><span class='Ref_to_Parameter'>dumpFn</span></a> <span class='Operator'>? </span><span class='Boolean'>true </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1038"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN244"><span class='Ref_to_Member'>ArchiveEntryPtr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1038"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN244"><span class='Ref_to_Member'>ArchiveEntryPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1038"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1039"><span class='Ref_To_Local'>newToc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ArchiveEntry &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Public */ 
</span><span class='Keyword'>void 
</span><a name="LN1090"></a><span class='Declare_Function'>PrintTOCSummary</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AHX</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1092"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1090"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>; 
</span><a name="LN1093"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span><a name="LN1094"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span><a name="LN1095"></a>    <a href="pg_backup.h.html#LN52"><span class='Ref_to_Typedef'>teSection</span></a>   <span class='Declare_Local'>curSection</span><span class='Delimiter'>; 
</span><a name="LN1096"></a>    <a href="pg_backup_archiver.c.html#LN45"><span class='Ref_to_Typedef'>OutputContext</span></a> <span class='Declare_Local'>sav</span><span class='Delimiter'>; 
</span><a name="LN1097"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>fmtName</span><span class='Delimiter'>; 
</span><a name="LN1098"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>stamp_str</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1096"><span class='Ref_To_Local'>sav</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN84"><span class='Ref_to_Proto'>SaveOutput</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1093"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN81"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN83"><span class='Ref_to_Proto'>SetOutput</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1093"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN81"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><span class='Number'>0</span> <span class='Comment_Multi_Line'>/* no compression */ </span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../backend/utils/adt/pg_locale.c.html#LN753"><span class='Ref_to_Macro'>strftime</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1098"><span class='Ref_To_Local'>stamp_str</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1098"><span class='Ref_To_Local'>stamp_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="dumputils.h.html#LN32"><span class='Ref_to_Const'>PGDUMP_STRFTIME_FMT</span></a><span class='Delimiter'>, 
</span>                 localtime<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN231"><span class='Ref_to_Member'>createDate</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1098"><span class='Ref_To_Local'>stamp_str</span></a><span class='Delimiter'>, </span><span class='String'>"[unknown]"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>";\n; Archive created at %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1098"><span class='Ref_To_Local'>stamp_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>";     dbname: %s\n;     TOC Entries: %d\n;     Compression: %d\n"</span><span class='Delimiter'>, 
</span>             <a href="pg_backup_archiver.c.html#LN61"><span class='Ref_to_Proto'>replace_line_endings</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN280"><span class='Ref_to_Member'>archdbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN303"><span class='Ref_to_Member'>tocCount</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="pg_backup.h.html#LN39"><span class='Ref_to_EnumConst'>archCustom</span></a><span class='Operator'>: 
</span>            <a href="pg_backup_archiver.c.html#LN1097"><span class='Ref_To_Local'>fmtName</span></a> <span class='Operator'>= </span><span class='String'>"CUSTOM"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_backup.h.html#LN42"><span class='Ref_to_EnumConst'>archDirectory</span></a><span class='Operator'>: 
</span>            <a href="pg_backup_archiver.c.html#LN1097"><span class='Ref_To_Local'>fmtName</span></a> <span class='Operator'>= </span><span class='String'>"DIRECTORY"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_backup.h.html#LN40"><span class='Ref_to_EnumConst'>archTar</span></a><span class='Operator'>: 
</span>            <a href="pg_backup_archiver.c.html#LN1097"><span class='Ref_To_Local'>fmtName</span></a> <span class='Operator'>= </span><span class='String'>"TAR"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="pg_backup_archiver.c.html#LN1097"><span class='Ref_To_Local'>fmtName</span></a> <span class='Operator'>= </span><span class='String'>"UNKNOWN"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>";     Dump Version: %d.%d-%d\n"</span><span class='Delimiter'>, 
</span>             <a href="pg_backup_archiver.h.html#LN71"><span class='Ref_to_Macro'>ARCHIVE_MAJOR</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN72"><span class='Ref_to_Macro'>ARCHIVE_MINOR</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN73"><span class='Ref_to_Macro'>ARCHIVE_REV</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>";     Format: %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1097"><span class='Ref_To_Local'>fmtName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>";     Integer: %d bytes\n"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>";     Offset: %d bytes\n"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN225"><span class='Ref_to_Member'>offSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN217"><span class='Ref_to_Member'>archiveRemoteVersion</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>";     Dumped from database version: %s\n"</span><span class='Delimiter'>, 
</span>                 <a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN217"><span class='Ref_to_Member'>archiveRemoteVersion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN219"><span class='Ref_to_Member'>archiveDumpVersion</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>";     Dumped by pg_dump version: %s\n"</span><span class='Delimiter'>, 
</span>                 <a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN219"><span class='Ref_to_Member'>archiveDumpVersion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>";\n;\n; Selected TOC Entries:\n;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1095"><span class='Ref_To_Local'>curSection</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN55"><span class='Ref_to_EnumConst'>SECTION_PRE_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>!= </span><a href="pg_backup.h.html#LN54"><span class='Ref_to_EnumConst'>SECTION_NONE</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN1095"><span class='Ref_To_Local'>curSection</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1093"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN85"><span class='Ref_to_Member'>verbose</span></a> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN72"><span class='Ref_to_Proto'>_tocEntryRequired</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1095"><span class='Ref_To_Local'>curSection</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1093"><span class='Ref_To_Local'>ropt</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a> <span class='Operator'>| </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1150"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sanitized_name</span><span class='Delimiter'>; 
</span><a name="LN1151"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sanitized_schema</span><span class='Delimiter'>; 
</span><a name="LN1152"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sanitized_owner</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * As in _printTocEntry(), sanitize strings that might contain 
             * newlines, to ensure that each logical output line is in fact 
             * one physical output line.  This prevents confusion when the 
             * file is read by "pg_restore -L".  Note that we currently don't 
             * bother to quote names, meaning that the name fields aren't 
             * automatically parseable.  "pg_restore -L" doesn't care because 
             * it only examines the dumpId field, but someday we might want to 
             * try harder. 
             */ 
</span>            <a href="pg_backup_archiver.c.html#LN1150"><span class='Ref_To_Local'>sanitized_name</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN61"><span class='Ref_to_Proto'>replace_line_endings</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_archiver.c.html#LN1151"><span class='Ref_To_Local'>sanitized_schema</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN61"><span class='Ref_to_Proto'>replace_line_endings</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_backup_archiver.c.html#LN1151"><span class='Ref_To_Local'>sanitized_schema</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><span class='String'>"-"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN1152"><span class='Ref_To_Local'>sanitized_owner</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN61"><span class='Ref_to_Proto'>replace_line_endings</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN349"><span class='Ref_to_Member'>owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%d; %u %u %s %s %s %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, 
</span>                     <a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN225"><span class='Ref_to_Member'>tableoid</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN226"><span class='Ref_to_Member'>oid</span></a><span class='Delimiter'>, 
</span>                     <a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1151"><span class='Ref_To_Local'>sanitized_schema</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1150"><span class='Ref_To_Local'>sanitized_name</span></a><span class='Delimiter'>, 
</span>                     <a href="pg_backup_archiver.c.html#LN1152"><span class='Ref_To_Local'>sanitized_owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1150"><span class='Ref_To_Local'>sanitized_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1151"><span class='Ref_To_Local'>sanitized_schema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1152"><span class='Ref_To_Local'>sanitized_owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ropt-&GT;verbose||(_tocE... &raquo; </span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1093"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN85"><span class='Ref_to_Member'>verbose</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1182"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>";\tdepends on:"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1182"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1182"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1182"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>" %d"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1094"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN1182"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for te=AH-&GT;toc-&GT;next;te!=... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Enforce strict names checking */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1093"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN79"><span class='Ref_to_Member'>strict_names</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN115"><span class='Ref_to_Proto'>StrictNamesCheck</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1093"><span class='Ref_To_Local'>ropt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1093"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN81"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN85"><span class='Ref_to_Proto'>RestoreOutput</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1092"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1096"><span class='Ref_To_Local'>sav</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PrintTOCSummary &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*********** 
 * BLOB Archival 
 ***********/ 
</span> 
<span class='Comment_Multi_Line'>/* Called by a dumper to signal start of a BLOB */ 
</span><span class='Keyword'>int 
</span><a name="LN1205"></a><span class='Declare_Function'>StartBlob</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AHX</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1207"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1205"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN1207"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN267"><span class='Ref_to_Member'>StartBlobPtr</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"large-object output not supported in chosen format\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1207"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN267"><span class='Ref_to_Member'>StartBlobPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1207"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1207"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN310"><span class='Ref_to_Member'>currToc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1205"><span class='Ref_to_Parameter'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Called by a dumper to signal end of a BLOB */ 
</span><span class='Keyword'>int 
</span><a name="LN1219"></a><span class='Declare_Function'>EndBlob</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AHX</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1221"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1219"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1221"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN268"><span class='Ref_to_Member'>EndBlobPtr</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1221"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN268"><span class='Ref_to_Member'>EndBlobPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1221"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1221"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN310"><span class='Ref_to_Member'>currToc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1219"><span class='Ref_to_Parameter'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/********** 
 * BLOB Restoration 
 **********/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by a format handler before any blobs are restored 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1237"></a><span class='Declare_Function'>StartRestoreBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1239"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN1239"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN118"><span class='Ref_to_Member'>single_txn</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_db.h.html#LN22"><span class='Ref_to_Proto'>StartTransaction</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN1237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1237"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"BEGIN;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_archiver.c.html#LN1237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN295"><span class='Ref_to_Member'>blobCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by a format handler after all blobs are restored 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1256"></a><span class='Declare_Function'>EndRestoreBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1258"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1256"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN1258"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN118"><span class='Ref_to_Member'>single_txn</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1256"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_db.h.html#LN23"><span class='Ref_to_Proto'>CommitTransaction</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN1256"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1256"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"COMMIT;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1256"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN126"><span class='Ref_to_Macro'>ngettext</span></a><span class='Parentheses'>(</span><span class='String'>"restored %d large object\n"</span><span class='Delimiter'>, 
</span>                          <span class='String'>"restored %d large objects\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN1256"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN295"><span class='Ref_to_Member'>blobCount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="pg_backup_archiver.c.html#LN1256"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN295"><span class='Ref_to_Member'>blobCount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Called by a format handler to initiate restoration of a blob 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1279"></a><span class='Declare_Function'>StartRestoreBlob</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>drop</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1281"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>old_blob_style</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.h.html#LN92"><span class='Ref_to_Const'>K_VERS_1_12</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1282"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>loOid</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN295"><span class='Ref_to_Member'>blobCount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize the LO Buffer */ 
</span>    <a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"restoring large object with OID %u\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* With an old archive we must do drop and create logic here */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1281"><span class='Ref_To_Local'>old_blob_style</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>drop</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.h.html#LN427"><span class='Ref_to_Proto'>DropBlobIfExists</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1281"><span class='Ref_To_Local'>old_blob_style</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_archiver.c.html#LN1282"><span class='Ref_To_Local'>loOid</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/fe-lobj.c.html#LN503"><span class='Ref_to_Func'>lo_create</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1282"><span class='Ref_To_Local'>loOid</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN1282"><span class='Ref_To_Local'>loOid</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>oid</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not create large object %u: %s"</span><span class='Delimiter'>, 
</span>                              <a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>oid</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN293"><span class='Ref_to_Member'>loFd</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/fe-lobj.c.html#LN56"><span class='Ref_to_Func'>lo_open</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>oid</span></a><span class='Delimiter'>, </span><a href="../../include/libpq/libpq-fs.h.html#LN20"><span class='Ref_to_Const'>INV_WRITE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN293"><span class='Ref_to_Member'>loFd</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open large object %u: %s"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>oid</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1281"><span class='Ref_To_Local'>old_blob_style</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT pg_catalog.lo_open(pg_catalog.lo_create('%u'), %d);\n"</span><span class='Delimiter'>, 
</span>                     <a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>oid</span></a><span class='Delimiter'>, </span><a href="../../include/libpq/libpq-fs.h.html#LN20"><span class='Ref_to_Const'>INV_WRITE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT pg_catalog.lo_open('%u', %d);\n"</span><span class='Delimiter'>, 
</span>                     <a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>oid</span></a><span class='Delimiter'>, </span><a href="../../include/libpq/libpq-fs.h.html#LN20"><span class='Ref_to_Const'>INV_WRITE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_archiver.c.html#LN1279"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN294"><span class='Ref_to_Member'>writingBlob</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end StartRestoreBlob &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN1323"></a><span class='Declare_Function'>EndRestoreBlob</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1323"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Write remaining bytes from the LO buffer */ 
</span>        <a href="pg_backup_archiver.c.html#LN81"><span class='Ref_to_Proto'>dump_lo_buf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1323"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_archiver.c.html#LN1323"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN294"><span class='Ref_to_Member'>writingBlob</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1323"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/libpq/fe-lobj.c.html#LN98"><span class='Ref_to_Func'>lo_close</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1323"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1323"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN293"><span class='Ref_to_Member'>loFd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1323"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN293"><span class='Ref_to_Member'>loFd</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1323"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT pg_catalog.lo_close(0);\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end EndRestoreBlob &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*********** 
 * Sorting and Reordering 
 ***********/ 
</span> 
<span class='Keyword'>void 
</span><a name="LN1349"></a><span class='Declare_Function'>SortTocFromFile</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AHX</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1351"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1349"><span class='Ref_to_Parameter'>AHX</span></a><span class='Delimiter'>; 
</span><a name="LN1352"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1351"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span><a name="LN1353"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>fh</span><span class='Delimiter'>; 
</span><a name="LN1354"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span><a name="LN1355"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>incomplete_line</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate space for the 'wanted' array, and init it */ 
</span>    <a href="pg_backup_archiver.c.html#LN1352"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN120"><span class='Ref_to_Member'>idWanted</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN1351"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1352"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN120"><span class='Ref_to_Member'>idWanted</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN1351"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Setup the file */ 
</span>    <a href="pg_backup_archiver.c.html#LN1353"><span class='Ref_To_Local'>fh</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1352"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN91"><span class='Ref_to_Member'>tocFile</span></a><span class='Delimiter'>, </span><a href="../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN1353"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open TOC file \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN1352"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN91"><span class='Ref_to_Member'>tocFile</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1355"><span class='Ref_To_Local'>incomplete_line</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span>fgets<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1354"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1354"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1353"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1370"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>prev_incomplete_line</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1355"><span class='Ref_To_Local'>incomplete_line</span></a><span class='Delimiter'>; 
</span><a name="LN1371"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>buflen</span><span class='Delimiter'>; 
</span><a name="LN1372"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cmnt</span><span class='Delimiter'>; 
</span><a name="LN1373"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span><a name="LN1374"></a>        <a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a>      <span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span><a name="LN1375"></a>        <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Some lines in the file might be longer than sizeof(buf).  This is 
         * no problem, since we only care about the leading numeric ID which 
         * can be at most a few characters; but we have to skip continuation 
         * bufferloads when processing a long line. 
         */ 
</span>        <a href="pg_backup_archiver.c.html#LN1371"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1354"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1371"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN1354"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN1371"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN1355"><span class='Ref_To_Local'>incomplete_line</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN1355"><span class='Ref_To_Local'>incomplete_line</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1370"><span class='Ref_To_Local'>prev_incomplete_line</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Truncate line at comment, if any */ 
</span>        <a href="pg_backup_archiver.c.html#LN1372"><span class='Ref_To_Local'>cmnt</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1354"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>';'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1372"><span class='Ref_To_Local'>cmnt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN1372"><span class='Ref_To_Local'>cmnt</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore if all blank */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strspn<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1354"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" \t\r\n"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1354"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get an ID, check it's valid and not already seen */ 
</span>        <a href="pg_backup_archiver.c.html#LN1374"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1354"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN1373"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1373"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>== </span><a href="pg_backup_archiver.c.html#LN1354"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN1374"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN1374"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>&GT; </span><a href="pg_backup_archiver.c.html#LN1351"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a> <span class='Operator'>|| 
</span>            <a href="pg_backup_archiver.c.html#LN1352"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN120"><span class='Ref_to_Member'>idWanted</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN1374"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"WARNING: line ignored: %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1354"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Find TOC entry */ 
</span>        <a href="pg_backup_archiver.c.html#LN1375"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN393"><span class='Ref_to_Proto'>getTocEntryByDumpId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1351"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1374"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN1375"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not find entry for ID %d\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN1374"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Mark it wanted */ 
</span>        <a href="pg_backup_archiver.c.html#LN1352"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN120"><span class='Ref_to_Member'>idWanted</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN1374"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Move each item to the end of the list as it is selected, so that 
         * they are placed in the desired order.  Any unwanted items will end 
         * up at the front of the list, which may seem unintuitive but it's 
         * what we need.  In an ordinary serial restore that makes no 
         * difference, but in a parallel restore we need to mark unrestored 
         * items' dependencies as satisfied before we start examining 
         * restorable items.  Otherwise they could have surprising 
         * side-effects on the order in which restorable items actually get 
         * restored. 
         */ 
</span>        <a href="pg_backup_archiver.c.html#LN77"><span class='Ref_to_Proto'>_moveBefore</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1351"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1351"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1375"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while fgets(buf,sizeof(buf)... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1353"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not close TOC file: %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SortTocFromFile &raquo; </span> 
 
<span class='Comment_Multi_Line'>/********************** 
 * 'Convenience functions that look like standard IO functions 
 * for writing data when in dump mode. 
 **********************/ 
</span> 
<span class='Comment_Multi_Line'>/* Public */ 
</span><span class='Keyword'>void 
</span><a name="LN1444"></a><span class='Declare_Function'>archputs</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_backup.h.html#LN261"><span class='Ref_to_Proto'>WriteData</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1444"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1444"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1444"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Public */ 
</span><span class='Keyword'>int 
</span><a name="LN1452"></a><span class='Declare_Function'>archprintf</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1454"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN1455"></a>    size_t      <span class='Declare_Local'>len</span> <span class='Operator'>= </span><span class='Number'>128</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* initial assumption about buffer size */ 
</span><a name="LN1456"></a>    size_t      <span class='Declare_Local'>cnt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1460"></a>        va_list     <span class='Declare_Local'>args</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Allocate work buffer. */ 
</span>        <a href="pg_backup_archiver.c.html#LN1454"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1455"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Try to format the data. */ 
</span>        <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1460"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1452"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1456"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN102"><span class='Ref_to_Func'>pvsnprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1454"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1455"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1452"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1460"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1460"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1456"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN1455"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* success */ 
</span> 
        <span class='Comment_Multi_Line'>/* Release buffer and loop around to try again with larger len. */ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1454"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1455"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1456"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup.h.html#LN261"><span class='Ref_to_Proto'>WriteData</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1452"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1454"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1456"><span class='Ref_To_Local'>cnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1454"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1456"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end archprintf &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/******************************* 
 * Stuff below here should be 'private' to the archiver routines 
 *******************************/ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1489"></a><span class='Declare_Function'>SetOutput</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>compression</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1491"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fn</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1491"><span class='Ref_To_Local'>fn</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1491"><span class='Ref_To_Local'>fn</span></a> <span class='Operator'>= </span>fileno<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN1491"><span class='Ref_To_Local'>fn</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN1491"><span class='Ref_To_Local'>fn</span></a> <span class='Operator'>= </span>fileno<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If compression explicitly requested, use gzopen */ 
</span><span class='Directive'>#ifdef</span> HAVE_LIBZ 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>compression</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1509"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>fmode</span><span class='Delimiter'>[</span><span class='Number'>10</span><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* Don't use PG_BINARY_x since this is zlib */ 
</span>        <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1509"><span class='Ref_To_Local'>fmode</span></a><span class='Delimiter'>, </span><span class='String'>"wb%d"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>compression</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1491"><span class='Ref_To_Local'>fn</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a> <span class='Operator'>= </span>gzdopen<span class='Parentheses'>(</span>dup<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1491"><span class='Ref_To_Local'>fn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1509"><span class='Ref_To_Local'>fmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a> <span class='Operator'>= </span>gzopen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1509"><span class='Ref_To_Local'>fmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN300"><span class='Ref_to_Member'>gzOut</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* Use fopen */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN316"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN47"><span class='Ref_to_EnumConst'>archModeAppend</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1491"><span class='Ref_To_Local'>fn</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a> <span class='Operator'>= </span>fdopen<span class='Parentheses'>(</span>dup<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1491"><span class='Ref_To_Local'>fn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1033"><span class='Ref_to_Const'>PG_BINARY_A</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1033"><span class='Ref_to_Const'>PG_BINARY_A</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1491"><span class='Ref_To_Local'>fn</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a> <span class='Operator'>= </span>fdopen<span class='Parentheses'>(</span>dup<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1491"><span class='Ref_To_Local'>fn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN300"><span class='Ref_to_Member'>gzOut</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open output file \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN1489"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open output file: %s\n"</span><span class='Delimiter'>, 
</span>                          <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end SetOutput &raquo; </span> 
 
<span class='Keyword'>static </span><a href="pg_backup_archiver.c.html#LN45"><span class='Ref_to_Typedef'>OutputContext</span></a> 
<a name="LN1551"></a><span class='Declare_Function'>SaveOutput</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1553"></a>    <a href="pg_backup_archiver.c.html#LN45"><span class='Ref_to_Typedef'>OutputContext</span></a> <span class='Declare_Local'>sav</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1553"><span class='Ref_To_Local'>sav</span></a><span class='Operator'>.</span><a href="pg_backup_archiver.c.html#LN47"><span class='Ref_to_Member'>OF</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1551"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1553"><span class='Ref_To_Local'>sav</span></a><span class='Operator'>.</span><a href="pg_backup_archiver.c.html#LN48"><span class='Ref_to_Member'>gzOut</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1551"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN300"><span class='Ref_to_Member'>gzOut</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN1553"><span class='Ref_To_Local'>sav</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1562"></a><span class='Declare_Function'>RestoreOutput</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN45"><span class='Ref_to_Typedef'>OutputContext</span></a> <span class='Declare_Parameter'>savedContext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1564"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1562"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN300"><span class='Ref_to_Member'>gzOut</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1564"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN42"><span class='Ref_to_Macro'>GZCLOSE</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1562"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN1564"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>fclose<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1562"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1564"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not close output file: %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1562"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN300"><span class='Ref_to_Member'>gzOut</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1562"><span class='Ref_to_Parameter'>savedContext</span></a><span class='Operator'>.</span><a href="pg_backup_archiver.c.html#LN48"><span class='Ref_to_Member'>gzOut</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1562"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1562"><span class='Ref_to_Parameter'>savedContext</span></a><span class='Operator'>.</span><a href="pg_backup_archiver.c.html#LN47"><span class='Ref_to_Member'>OF</span></a><span class='Delimiter'>; 
} 
</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  Print formatted text to the output file (usually stdout). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1585"></a><span class='Declare_Function'>ahprintf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1587"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN1588"></a>    size_t      <span class='Declare_Local'>len</span> <span class='Operator'>= </span><span class='Number'>128</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* initial assumption about buffer size */ 
</span><a name="LN1589"></a>    size_t      <span class='Declare_Local'>cnt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1593"></a>        va_list     <span class='Declare_Local'>args</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Allocate work buffer. */ 
</span>        <a href="pg_backup_archiver.c.html#LN1587"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1588"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Try to format the data. */ 
</span>        <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1593"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1585"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1589"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN102"><span class='Ref_to_Func'>pvsnprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1587"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1588"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1585"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1593"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1593"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1589"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN1588"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* success */ 
</span> 
        <span class='Comment_Multi_Line'>/* Release buffer and loop around to try again with larger len. */ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1587"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1588"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1589"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_archiver.h.html#LN429"><span class='Ref_to_Proto'>ahwrite</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1587"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1589"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1585"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1587"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1589"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ahprintf &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN1617"></a><span class='Declare_Function'>ahlog</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1619"></a>    va_list     <span class='Declare_Local'>ap</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1617"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN222"><span class='Ref_to_Member'>debugLevel</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN1617"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN1617"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN182"><span class='Ref_to_Member'>verbose</span></a> <span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN1617"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1619"><span class='Ref_To_Local'>ap</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1617"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_utils.c.html#LN82"><span class='Ref_to_Func'>vwrite_msg</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1617"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1619"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1619"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Single place for logic which says 'We are restoring to a direct DB connection'. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1633"></a><span class='Declare_Function'>RestoringToDB</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1635"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1633"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1635"><span class='Ref_To_Local'>ropt</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN1635"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN107"><span class='Ref_to_Member'>useDB</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN1633"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Dump the current contents of the LO data buffer while writing a BLOB 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1644"></a><span class='Declare_Function'>dump_lo_buf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1648"></a>        size_t      <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN1648"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/libpq/be-fsstubs.h.html#LN27"><span class='Ref_to_Proto'>lo_write</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN293"><span class='Ref_to_Member'>loFd</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN325"><span class='Ref_to_Member'>lo_buf</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN126"><span class='Ref_to_Macro'>ngettext</span></a><span class='Parentheses'>(</span><span class='String'>"wrote %lu byte of large object data (result = %lu)\n"</span><span class='Delimiter'>, 
</span>                     <span class='String'>"wrote %lu bytes of large object data (result = %lu)\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1648"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1648"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>            <span class='String'>"could not write to large object (result: %lu, expected: %lu)\n"</span><span class='Delimiter'>, 
</span>                       <span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1648"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1662"></a>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.h.html#LN399"><span class='Ref_to_Macro'>appendByteaLiteralAHX</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1662"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                              <span class='Parentheses'>(</span><span class='Keyword'>const unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN325"><span class='Ref_to_Member'>lo_buf</span></a><span class='Delimiter'>, 
</span>                              <a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a><span class='Delimiter'>, 
</span>                              <a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Hack: turn off writingBlob so ahwrite doesn't recurse to here */ 
</span>        <a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN294"><span class='Ref_to_Member'>writingBlob</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT pg_catalog.lowrite(0, %s);\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1662"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN294"><span class='Ref_to_Member'>writingBlob</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1662"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_backup_archiver.c.html#LN1644"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dump_lo_buf &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  Write buffer to the output file (usually stdout). This is used for 
 *  outputting 'restore' scripts etc. It is even possible for an archive 
 *  format to create a custom output routine to 'fake' a restore if it 
 *  wants to generate a script (see TAR output). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1687"></a><span class='Declare_Function'>ahwrite</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>size</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>nmemb</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1689"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bytes_written</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN294"><span class='Ref_to_Member'>writingBlob</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1693"></a>        size_t      <span class='Declare_Local'>remaining</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>size</span></a> <span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>nmemb</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a> <span class='Operator'>+ </span><a href="pg_backup_archiver.c.html#LN1693"><span class='Ref_To_Local'>remaining</span></a> <span class='Operator'>&GT; </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN327"><span class='Ref_to_Member'>lo_buf_size</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1697"></a>            size_t      <span class='Declare_Local'>avail</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN327"><span class='Ref_to_Member'>lo_buf_size</span></a> <span class='Operator'>- </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a><span class='Delimiter'>; 
</span> 
            memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN325"><span class='Ref_to_Member'>lo_buf</span></a> <span class='Operator'>+ </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1697"><span class='Ref_To_Local'>avail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Parentheses'>) ((</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>+ </span><a href="pg_backup_archiver.c.html#LN1697"><span class='Ref_To_Local'>avail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN1693"><span class='Ref_To_Local'>remaining</span></a> <span class='Operator'>-= </span><a href="pg_backup_archiver.c.html#LN1697"><span class='Ref_To_Local'>avail</span></a><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a> <span class='Operator'>+= </span><a href="pg_backup_archiver.c.html#LN1697"><span class='Ref_To_Local'>avail</span></a><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN81"><span class='Ref_to_Proto'>dump_lo_buf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN325"><span class='Ref_to_Member'>lo_buf</span></a> <span class='Operator'>+ </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1693"><span class='Ref_To_Local'>remaining</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN326"><span class='Ref_to_Member'>lo_buf_used</span></a> <span class='Operator'>+= </span><a href="pg_backup_archiver.c.html#LN1693"><span class='Ref_To_Local'>remaining</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN1689"><span class='Ref_To_Local'>bytes_written</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>size</span></a> <span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>nmemb</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if AH-&GT;writingBlob &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN300"><span class='Ref_to_Member'>gzOut</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1689"><span class='Ref_To_Local'>bytes_written</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN43"><span class='Ref_to_Macro'>GZWRITE</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>size</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>nmemb</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN277"><span class='Ref_to_Member'>CustomOutPtr</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1689"><span class='Ref_To_Local'>bytes_written</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN277"><span class='Ref_to_Member'>CustomOutPtr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>size</span></a> <span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>nmemb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we're doing a restore, and it's direct to DB, and we're 
         * connected then send it to the DB. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN80"><span class='Ref_to_Proto'>RestoringToDB</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>))</span> 
            <a href="pg_backup_archiver.c.html#LN1689"><span class='Ref_To_Local'>bytes_written</span></a> <span class='Operator'>= </span><a href="pg_backup_db.h.html#LN13"><span class='Ref_to_Proto'>ExecuteSqlCommandBuf</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>size</span></a> <span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>nmemb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN1689"><span class='Ref_To_Local'>bytes_written</span></a> <span class='Operator'>= </span>fwrite<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>size</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>nmemb</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>size</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1689"><span class='Ref_To_Local'>bytes_written</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>size</span></a> <span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN1687"><span class='Ref_to_Parameter'>nmemb</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.h.html#LN133"><span class='Ref_to_Const'>WRITE_ERROR_EXIT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ahwrite &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* on some error, we may decide to go on... */ 
</span><span class='Keyword'>void 
</span><a name="LN1736"></a><span class='Declare_Function'>warn_or_exit_horribly</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, 
</span><a name="LN1737"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>modulename</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1739"></a>    va_list     <span class='Declare_Local'>ap</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN330"><span class='Ref_to_Member'>stage</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span> 
        <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN192"><span class='Ref_to_EnumConst'>STAGE_NONE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Do nothing special */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN193"><span class='Ref_to_EnumConst'>STAGE_INITIALIZING</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN330"><span class='Ref_to_Member'>stage</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN331"><span class='Ref_to_Member'>lastErrorStage</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1737"><span class='Ref_to_Parameter'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"Error while INITIALIZING:\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN194"><span class='Ref_to_EnumConst'>STAGE_PROCESSING</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN330"><span class='Ref_to_Member'>stage</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN331"><span class='Ref_to_Member'>lastErrorStage</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1737"><span class='Ref_to_Parameter'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"Error while PROCESSING TOC:\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN195"><span class='Ref_to_EnumConst'>STAGE_FINALIZING</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN330"><span class='Ref_to_Member'>stage</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN331"><span class='Ref_to_Member'>lastErrorStage</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1737"><span class='Ref_to_Parameter'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"Error while FINALIZING:\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch AH-&GT;stage &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN333"><span class='Ref_to_Member'>lastErrorTE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1737"><span class='Ref_to_Parameter'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"Error from TOC entry %d; %u %u %s %s %s\n"</span><span class='Delimiter'>, 
</span>                  <a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, 
</span>             <a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN225"><span class='Ref_to_Member'>tableoid</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN226"><span class='Ref_to_Member'>oid</span></a><span class='Delimiter'>, 
</span>              <a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN349"><span class='Ref_to_Member'>owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN331"><span class='Ref_to_Member'>lastErrorStage</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN330"><span class='Ref_to_Member'>stage</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN333"><span class='Ref_to_Member'>lastErrorTE</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN332"><span class='Ref_to_Member'>currentTE</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1739"><span class='Ref_To_Local'>ap</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1737"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_utils.c.html#LN82"><span class='Ref_to_Func'>vwrite_msg</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1737"><span class='Ref_to_Parameter'>modulename</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1737"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1739"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1739"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN200"><span class='Ref_to_Member'>exit_on_error</span></a><span class='Parentheses'>) 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN1736"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN201"><span class='Ref_to_Member'>n_errors</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end warn_or_exit_horribly &raquo; </span> 
 
<span class='Directive'>#ifdef</span> NOT_USED 
 
<span class='Keyword'>static void 
</span><a name="LN1786"></a><span class='Declare_Function'>_moveAfter</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pos</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Unlink te from list */ 
</span>    <a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* and insert it after "pos" */ 
</span>    <a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>pos</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1786"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Keyword'>static void 
</span><a name="LN1801"></a><span class='Declare_Function'>_moveBefore</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pos</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Unlink te from list */ 
</span>    <a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* and insert it before "pos" */ 
</span>    <a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>pos</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1801"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Build index arrays for the TOC list 
 * 
 * This should be invoked only after we have created or read in all the TOC 
 * items. 
 * 
 * The arrays are indexed by dump ID (so entry zero is unused).  Note that the 
 * array entries run only up to maxDumpId.  We might see dependency dump IDs 
 * beyond that (if the dump was partial); so always check the array bound 
 * before trying to touch an array entry. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1826"></a><span class='Declare_Function'>buildTocEntryArrays</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1828"></a>    <a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a>      <span class='Declare_Local'>maxDumpId</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1826"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a><span class='Delimiter'>; 
</span><a name="LN1829"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1826"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN1828"><span class='Ref_To_Local'>maxDumpId</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1826"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN308"><span class='Ref_to_Member'>tableDataId</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN1828"><span class='Ref_To_Local'>maxDumpId</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1826"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN1826"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* this check is purely paranoia, maxDumpId should be correct */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a> <span class='Operator'>&GT; </span><a href="pg_backup_archiver.c.html#LN1828"><span class='Ref_To_Local'>maxDumpId</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"bad dumpId\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* tocsByDumpId indexes all TOCs by their dump ID */ 
</span>        <a href="pg_backup_archiver.c.html#LN1826"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * tableDataId provides the TABLE DATA item's dump ID for each TABLE 
         * TOC entry that has a DATA item.  We compute this by reversing the 
         * TABLE DATA item's dependency, knowing that a TABLE DATA item has 
         * just one dependency and it is the TABLE item. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE DATA"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1851"></a>            <a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a>      <span class='Declare_Local'>tableId</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The TABLE item might not have been in the archive, if this was 
             * a data-only dump; but its dump ID should be less than its data 
             * item's dump ID, so there should be a place for it in the array. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1851"><span class='Ref_To_Local'>tableId</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN1851"><span class='Ref_To_Local'>tableId</span></a> <span class='Operator'>&GT; </span><a href="pg_backup_archiver.c.html#LN1828"><span class='Ref_To_Local'>maxDumpId</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"bad table dumpId for TABLE DATA item\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_backup_archiver.c.html#LN1826"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN308"><span class='Ref_to_Member'>tableDataId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN1851"><span class='Ref_To_Local'>tableId</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN1829"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for te=AH-&GT;toc-&GT;next;te!=... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end buildTocEntryArrays &raquo; </span> 
 
<a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>* 
</span><a name="LN1867"></a><span class='Declare_Function'>getTocEntryByDumpId</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Declare_Parameter'>id</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* build index arrays if we didn't already */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1867"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN76"><span class='Ref_to_Proto'>buildTocEntryArrays</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1867"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1867"><span class='Ref_to_Parameter'>id</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN1867"><span class='Ref_to_Parameter'>id</span></a> <span class='Operator'>&LT;= </span><a href="pg_backup_archiver.c.html#LN1867"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN1867"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN1867"><span class='Ref_to_Parameter'>id</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<a href="pg_backup_archiver.h.html#LN205"><span class='Ref_to_Typedef'>teReqs</span></a> 
<a name="LN1880"></a><span class='Declare_Function'>TocIDRequired</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Declare_Parameter'>id</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1882"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN393"><span class='Ref_to_Proto'>getTocEntryByDumpId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1880"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1880"><span class='Ref_to_Parameter'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN1882"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN1882"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a><span class='Delimiter'>; 
} 
</span> 
size_t 
<a name="LN1891"></a><span class='Declare_Function'>WriteOffset</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a> <span class='Declare_Parameter'>o</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>wasSet</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1893"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>off</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save the flag */ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1891"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1891"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1891"><span class='Ref_to_Parameter'>wasSet</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Write out pgoff_t smallest byte first, prevents endian mismatch */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1893"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1893"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>&LT; </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1893"><span class='Ref_To_Local'>off</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1891"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1891"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1891"><span class='Ref_to_Parameter'>o</span></a> <span class='Operator'>& </span><span class='Number'>0xFF</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1891"><span class='Ref_to_Parameter'>o</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>int 
</span><a name="LN1908"></a><span class='Declare_Function'>ReadOffset</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>o</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1910"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1911"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>off</span><span class='Delimiter'>; 
</span><a name="LN1912"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>offsetFlg</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize to zero */ 
</span>    <span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>o</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for old version */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.h.html#LN82"><span class='Ref_to_Const'>K_VERS_1_7</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Prior versions wrote offsets using WriteInt */ 
</span>        <a href="pg_backup_archiver.c.html#LN1910"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* -1 means not set */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1910"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pg_backup_archiver.h.html#LN106"><span class='Ref_to_Const'>K_OFFSET_POS_NOT_SET</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1910"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pg_backup_archiver.h.html#LN108"><span class='Ref_to_Const'>K_OFFSET_NO_DATA</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Cast to pgoff_t because it was written as an int. */ 
</span>        <span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>o</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN1910"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="pg_backup_archiver.h.html#LN107"><span class='Ref_to_Const'>K_OFFSET_POS_SET</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the flag indicating the state of the data pointer. Check if valid 
     * and die if not. 
     * 
     * This used to be handled by a negative or zero pointer, now we use an 
     * extra byte specifically for the state. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN1912"><span class='Ref_To_Local'>offsetFlg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0xFF</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1912"><span class='Ref_To_Local'>offsetFlg</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN106"><span class='Ref_to_Const'>K_OFFSET_POS_NOT_SET</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN108"><span class='Ref_to_Const'>K_OFFSET_NO_DATA</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN107"><span class='Ref_to_Const'>K_OFFSET_POS_SET</span></a><span class='Operator'>: 
</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected data offset flag %d\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1912"><span class='Ref_To_Local'>offsetFlg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the bytes 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1911"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1911"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN225"><span class='Ref_to_Member'>offSize</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1911"><span class='Ref_To_Local'>off</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1911"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>&LT; </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>o</span></a> <span class='Operator'>|= </span><span class='Parentheses'>((</span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)))</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1911"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>* </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1908"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"file offset in dump file is too large\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN1912"><span class='Ref_To_Local'>offsetFlg</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ReadOffset &raquo; </span> 
 
size_t 
<a name="LN1972"></a><span class='Declare_Function'>WriteInt</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>i</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1974"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>b</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This is a bit yucky, but I don't want to make the binary format very 
     * dependent on representation, and not knowing much about it, I write out 
     * a sign byte. If you change this, don't forget to change the file 
     * version #, and modify readInt to read the new format AS WELL AS the old 
     * formats. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* SIGN byte */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>i</span></a> <span class='Operator'>= -</span><a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN1974"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1974"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN1974"><span class='Ref_To_Local'>b</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>i</span></a> <span class='Operator'>& </span><span class='Number'>0xFF</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>i</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN1972"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end WriteInt &raquo; </span> 
 
<span class='Keyword'>int 
</span><a name="LN2003"></a><span class='Declare_Function'>ReadInt</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2005"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2006"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bv</span><span class='Delimiter'>, 
</span><a name="LN2007"></a>                <span class='Declare_Local'>b</span><span class='Delimiter'>; 
</span><a name="LN2008"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sign</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Default positive */ 
</span><a name="LN2009"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitShift</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2003"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT; </span><a href="pg_backup_archiver.h.html#LN76"><span class='Ref_to_Const'>K_VERS_1_0</span></a><span class='Parentheses'>) 
</span>        <span class='Comment_Multi_Line'>/* Read a sign byte */ 
</span>        <a href="pg_backup_archiver.c.html#LN2008"><span class='Ref_To_Local'>sign</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN2003"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN2003"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2007"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2007"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN2003"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2007"><span class='Ref_To_Local'>b</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2006"><span class='Ref_To_Local'>bv</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN2003"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN2003"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0xFF</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2006"><span class='Ref_To_Local'>bv</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN2005"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2005"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2006"><span class='Ref_To_Local'>bv</span></a> <span class='Operator'>&LT;&LT; </span><a href="pg_backup_archiver.c.html#LN2009"><span class='Ref_To_Local'>bitShift</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2009"><span class='Ref_To_Local'>bitShift</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2008"><span class='Ref_To_Local'>sign</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN2005"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= -</span><a href="pg_backup_archiver.c.html#LN2005"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN2005"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ReadInt &raquo; </span> 
 
size_t 
<a name="LN2030"></a><span class='Declare_Function'>WriteStr</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2032"></a>    size_t      <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2030"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2036"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2030"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2032"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2030"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2036"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN2030"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN253"><span class='Ref_to_Member'>WriteBufPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN2030"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2030"><span class='Ref_to_Parameter'>c</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2036"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2032"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>+= </span><a href="pg_backup_archiver.c.html#LN2036"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN2032"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2030"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN2032"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN2049"></a><span class='Declare_Function'>ReadStr</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2051"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN2052"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2052"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2049"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2052"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN2051"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2051"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2052"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN2049"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN254"><span class='Ref_to_Member'>ReadBufPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN2049"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN2051"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2052"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2051"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2052"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN2051"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN2069"></a><span class='Declare_Function'>_discoverArchiveFormat</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2071"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>fh</span><span class='Delimiter'>; 
</span><a name="LN2072"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sig</span><span class='Delimiter'>[</span><span class='Number'>6</span><span class='Delimiter'>];</span>         <span class='Comment_Single_Line'>/* More than enough */ 
</span><a name="LN2073"></a>    size_t      <span class='Declare_Local'>cnt</span><span class='Delimiter'>; 
</span><a name="LN2074"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>wantClose</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> <span class='Number'>0</span> 
<span class='Inactive_Code'>    write_msg(modulename, "attempting to ascertain archive format\n"); 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN240"><span class='Ref_to_Member'>lookaheadSize</span></a> <span class='Operator'>= </span><span class='Number'>512</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Number'>512</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN242"><span class='Ref_to_Member'>lookaheadPos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2090"></a>        <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>st</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2074"><span class='Ref_To_Local'>wantClose</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check if the specified archive is a directory. If so, check if 
         * there's a "toc.dat" (or "toc.dat.gz") file in it. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2090"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="../../include/port/win32.h.html#LN429"><span class='Ref_to_Macro'>S_ISDIR</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2090"><span class='Ref_To_Local'>st</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2100"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2100"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/toc.dat"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span> 
                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"directory name too long: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2100"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2090"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="../../include/port/win32.h.html#LN430"><span class='Ref_to_Macro'>S_ISREG</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2090"><span class='Ref_To_Local'>st</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN42"><span class='Ref_to_EnumConst'>archDirectory</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> HAVE_LIBZ 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2100"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/toc.dat.gz"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span> 
                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"directory name too long: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2100"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2090"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="../../include/port/win32.h.html#LN430"><span class='Ref_to_Macro'>S_ISREG</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2090"><span class='Ref_To_Local'>st</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN42"><span class='Ref_to_EnumConst'>archDirectory</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"directory \"%s\" does not appear to be a valid archive (\"toc.dat\" does not exist)\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stat(AH-&GT;fSpec,&st)==... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open input file \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if AH-&GT;fSpec &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a> <span class='Operator'>= </span>stdin<span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open input file: %s\n"</span><span class='Delimiter'>, 
</span>                          <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN2073"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2072"><span class='Ref_To_Local'>sig</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>5</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>ferror<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>))</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not read input file: %s\n"</span><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"input file is too short (read %lu, expected 5)\n"</span><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN2073"><span class='Ref_To_Local'>cnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Save it, just in case we need it later */ 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="pg_backup_archiver.c.html#LN2072"><span class='Ref_To_Local'>sig</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a> <span class='Operator'>= </span><span class='Number'>5</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2072"><span class='Ref_To_Local'>sig</span></a><span class='Delimiter'>, </span><span class='String'>"PGDMP"</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2156"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>byteread</span><span class='Delimiter'>; 
</span><a name="LN2157"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>vmaj</span><span class='Delimiter'>, 
</span><a name="LN2158"></a>                    <span class='Declare_Local'>vmin</span><span class='Delimiter'>, 
</span><a name="LN2159"></a>                    <span class='Declare_Local'>vrev</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Finish reading (most of) a custom-format header. 
         * 
         * NB: this code must agree with ReadHead(). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN2156"><span class='Ref_To_Local'>byteread</span></a> <span class='Operator'>= </span>fgetc<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span>EOF<span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2157"><span class='Ref_To_Local'>vmaj</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2156"><span class='Ref_To_Local'>byteread</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN2156"><span class='Ref_To_Local'>byteread</span></a> <span class='Operator'>= </span>fgetc<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span>EOF<span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2158"><span class='Ref_To_Local'>vmin</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2156"><span class='Ref_To_Local'>byteread</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Save these too... */ 
</span>        <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2157"><span class='Ref_To_Local'>vmaj</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2158"><span class='Ref_To_Local'>vmin</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check header version; varies from V1.0 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2157"><span class='Ref_To_Local'>vmaj</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2157"><span class='Ref_To_Local'>vmaj</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN2158"><span class='Ref_To_Local'>vmin</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span>        <span class='Comment_Single_Line'>/* Version &GT; 1.0 */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN2156"><span class='Ref_To_Local'>byteread</span></a> <span class='Operator'>= </span>fgetc<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span>EOF<span class='Parentheses'>)</span> 
                <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_backup_archiver.c.html#LN2159"><span class='Ref_To_Local'>vrev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2156"><span class='Ref_To_Local'>byteread</span></a><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2159"><span class='Ref_To_Local'>vrev</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN2159"><span class='Ref_To_Local'>vrev</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN69"><span class='Ref_to_Macro'>MAKE_ARCHIVE_VERSION</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2157"><span class='Ref_To_Local'>vmaj</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2158"><span class='Ref_To_Local'>vmin</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2159"><span class='Ref_To_Local'>vrev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a> <span class='Operator'>= </span>fgetc<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span>EOF<span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN82"><span class='Ref_to_Const'>K_VERS_1_7</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN225"><span class='Ref_to_Member'>offSize</span></a> <span class='Operator'>= </span>fgetc<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span>EOF<span class='Parentheses'>)</span> 
                <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN225"><span class='Ref_to_Member'>offSize</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN225"><span class='Ref_to_Member'>offSize</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN2156"><span class='Ref_To_Local'>byteread</span></a> <span class='Operator'>= </span>fgetc<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span>EOF<span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2156"><span class='Ref_To_Local'>byteread</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strncmp(sig,"PGDMP",5... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * *Maybe* we have a tar archive format file or a text dump ... So, 
         * read first 512 byte header... 
         */ 
</span>        <a href="pg_backup_archiver.c.html#LN2073"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a><span class='Delimiter'>], </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>512</span> <span class='Operator'>- </span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* read failure is checked below */ 
</span>        <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a> <span class='Operator'>+= </span><a href="pg_backup_archiver.c.html#LN2073"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a> <span class='Operator'>&GT;= </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN42"><span class='Ref_to_Const'>TEXT_DUMPALL_HEADER</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN41"><span class='Ref_to_Const'>TEXT_DUMP_HEADER</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN41"><span class='Ref_to_Const'>TEXT_DUMP_HEADER</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>             strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN42"><span class='Ref_to_Const'>TEXT_DUMPALL_HEADER</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN42"><span class='Ref_to_Const'>TEXT_DUMPALL_HEADER</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * looks like it's probably a text format dump. so suggest they 
             * try psql 
             */ 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"input file appears to be a text format dump. Please use psql.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a> <span class='Operator'>!= </span><span class='Number'>512</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>feof<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>))</span> 
                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"input file does not appear to be a valid archive (too short?)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.h.html#LN424"><span class='Ref_to_Proto'>isValidTarHeader</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a><span class='Parentheses'>))</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"input file does not appear to be a valid archive\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN40"><span class='Ref_to_EnumConst'>archTar</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* If we can't seek, then mark the header as read */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/fseeko.c.html#LN32"><span class='Ref_to_Func'>fseeko</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * NOTE: Formats that use the lookahead buffer can unset this in their 
         * Init routine. 
         */ 
</span>        <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN237"><span class='Ref_to_Member'>readHeader</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* Don't bother since we've reset the file */ 
</span> 
    <span class='Comment_Multi_Line'>/* Close the file */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2074"><span class='Ref_To_Local'>wantClose</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2071"><span class='Ref_To_Local'>fh</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not close input file: %s\n"</span><span class='Delimiter'>, 
</span>                          <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN2069"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _discoverArchiveFormat &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Allocate an archive handle 
 */ 
</span><span class='Keyword'>static </span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>* 
</span><a name="LN2274"></a><span class='Declare_Function'>_allocAH</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>FileSpec</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_backup.h.html#LN36"><span class='Ref_to_Typedef'>ArchiveFormat</span></a> <span class='Declare_Parameter'>fmt</span><span class='Delimiter'>, 
</span><a name="LN2275"></a>         <span class='Keyword'>const int </span><span class='Declare_Parameter'>compression</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>dosync</span><span class='Delimiter'>, </span><a href="../../include/access/xlog.h.html#LN114"><span class='Ref_to_Enum'>ArchiveMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Delimiter'>, 
</span><a name="LN2276"></a>         <a href="pg_backup.h.html#LN233"><span class='Ref_to_Typedef'>SetupWorkerPtrType</span></a> <span class='Declare_Parameter'>setupWorkerPtr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2278"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>AH</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> <span class='Number'>0</span> 
<span class='Inactive_Code'>    write_msg(modulename, "allocating AH for %s, format %d\n", FileSpec, fmt); 
</span><span class='Directive'>#endif</span> 
 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* AH-&GT;debugLevel = 100; */ 
</span> 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN99"><span class='Ref_to_Const'>K_VERS_SELF</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* initialize for backwards compatible string processing */ 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN195"><span class='Ref_to_Member'>encoding</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* PG_SQL_ASCII */ 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN196"><span class='Ref_to_Member'>std_strings</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sql error handling */ 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN200"><span class='Ref_to_Member'>exit_on_error</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN201"><span class='Ref_to_Member'>n_errors</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN219"><span class='Ref_to_Member'>archiveDumpVersion</span></a> <span class='Operator'>= </span>PG_VERSION<span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN231"><span class='Ref_to_Member'>createDate</span></a> <span class='Operator'>= </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN225"><span class='Ref_to_Member'>offSize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2274"><span class='Ref_to_Parameter'>FileSpec</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2274"><span class='Ref_to_Parameter'>FileSpec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Not used; maybe later.... 
         * 
         * AH-&GT;workDir = pg_strdup(FileSpec); for(i=strlen(FileSpec) ; i &GT; 0 ; 
         * i--) if (AH-&GT;workDir[i-1] == '/') 
         */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* unknown */ 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* ditto */ 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* ditto */ 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN323"><span class='Ref_to_Member'>currWithOids</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* force SET */ 
</span> 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN316"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2275"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2275"><span class='Ref_to_Parameter'>compression</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN315"><span class='Ref_to_Member'>dosync</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2275"><span class='Ref_to_Parameter'>dosync</span></a><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN229"><span class='Ref_to_Member'>sqlparse</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN229"><span class='Ref_to_Member'>sqlparse</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Open stdout with no compression for AH output handle */ 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN300"><span class='Ref_to_Member'>gzOut</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN299"><span class='Ref_to_Member'>OF</span></a> <span class='Operator'>= </span>stdout<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * On Windows, we need to use binary mode to read/write non-text archive 
     * formats.  Force stdin/stdout into binary mode if that is what we are 
     * using. 
     */ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2274"><span class='Ref_to_Parameter'>fmt</span></a> <span class='Operator'>!= </span><a href="pg_backup.h.html#LN41"><span class='Ref_to_EnumConst'>archNull</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2275"><span class='Ref_to_Parameter'>mode</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN48"><span class='Ref_to_EnumConst'>archModeWrite</span></a><span class='Parentheses'>) 
</span>            setmode<span class='Parentheses'>(</span>fileno<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>, </span>O_BINARY<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            setmode<span class='Parentheses'>(</span>fileno<span class='Parentheses'>(</span>stdin<span class='Parentheses'>)</span><span class='Delimiter'>, </span>O_BINARY<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN270"><span class='Ref_to_Member'>SetupWorkerPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2276"><span class='Ref_to_Parameter'>setupWorkerPtr</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2274"><span class='Ref_to_Parameter'>fmt</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN38"><span class='Ref_to_EnumConst'>archUnknown</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN78"><span class='Ref_to_Proto'>_discoverArchiveFormat</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2274"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN281"><span class='Ref_to_Member'>promptPassword</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN31"><span class='Ref_to_EnumConst'>TRI_DEFAULT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="pg_backup.h.html#LN39"><span class='Ref_to_EnumConst'>archCustom</span></a><span class='Operator'>: 
</span>            <a href="pg_backup_custom.c.html#LN106"><span class='Ref_to_Func'>InitArchiveFmt_Custom</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="pg_backup.h.html#LN41"><span class='Ref_to_EnumConst'>archNull</span></a><span class='Operator'>: 
</span>            <a href="pg_backup_null.c.html#LN47"><span class='Ref_to_Func'>InitArchiveFmt_Null</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="pg_backup.h.html#LN42"><span class='Ref_to_EnumConst'>archDirectory</span></a><span class='Operator'>: 
</span>            <a href="pg_backup_directory.c.html#LN108"><span class='Ref_to_Func'>InitArchiveFmt_Directory</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="pg_backup.h.html#LN40"><span class='Ref_to_EnumConst'>archTar</span></a><span class='Operator'>: 
</span>            <a href="pg_backup_archiver.h.html#LN422"><span class='Ref_to_Proto'>InitArchiveFmt_Tar</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized file format \"%d\"\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2274"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch AH-&GT;format &raquo; </span> 
 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN2278"><span class='Ref_To_Local'>AH</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _allocAH &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write out all data (tables & blobs) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2392"></a><span class='Declare_Function'>WriteDataChunks</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="parallel.h.html#LN39"><span class='Ref_to_Struct'>ParallelState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2394"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2394"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2394"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2394"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2394"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2394"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN358"><span class='Ref_to_Member'>dataDumper</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN2394"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a> <span class='Operator'>& </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>pstate</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="parallel.h.html#LN41"><span class='Ref_to_Member'>numWorkers</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If we are in a parallel backup, then we are always the master 
             * process.  Dispatch each data-transfer job to a worker. 
             */ 
</span>            <a href="parallel.h.html#LN59"><span class='Ref_to_Proto'>DispatchJobForTocEntry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2394"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN141"><span class='Ref_to_EnumConst'>ACT_DUMP</span></a><span class='Delimiter'>, 
</span>                                   <a href="pg_backup_archiver.c.html#LN98"><span class='Ref_to_Proto'>mark_dump_job_done</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.h.html#LN388"><span class='Ref_to_Proto'>WriteDataChunksForTocEntry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2394"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for te=AH-&GT;toc-&GT;next;te!=... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If parallel, wait for workers to finish. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>pstate</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="parallel.h.html#LN41"><span class='Ref_to_Member'>numWorkers</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="parallel.h.html#LN55"><span class='Ref_to_Proto'>WaitForWorkers</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2392"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="parallel.h.html#LN32"><span class='Ref_to_EnumConst'>WFW_ALL_IDLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end WriteDataChunks &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Callback function that's invoked in the master process after a step has 
 * been parallel dumped. 
 * 
 * We don't need to do anything except check for worker failure. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2432"></a><span class='Declare_Function'>mark_dump_job_done</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, 
</span><a name="LN2433"></a>                   <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, 
</span><a name="LN2434"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>status</span><span class='Delimiter'>, 
</span><a name="LN2435"></a>                   <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>callback_data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2432"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"finished item %d %s %s\n"</span><span class='Delimiter'>, 
</span>          <a href="pg_backup_archiver.c.html#LN2433"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2433"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2433"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2434"><span class='Ref_to_Parameter'>status</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"worker process failed: exit code %d\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN2434"><span class='Ref_to_Parameter'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>void 
</span><a name="LN2447"></a><span class='Declare_Function'>WriteDataChunksForTocEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2449"></a>    <a href="pg_backup_archiver.h.html#LN149"><span class='Ref_to_Typedef'>StartDataPtrType</span></a> <span class='Declare_Local'>startPtr</span><span class='Delimiter'>; 
</span><a name="LN2450"></a>    <a href="pg_backup_archiver.h.html#LN151"><span class='Ref_to_Typedef'>EndDataPtrType</span></a> <span class='Declare_Local'>endPtr</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN310"><span class='Ref_to_Member'>currToc</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOBS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2449"><span class='Ref_To_Local'>startPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN265"><span class='Ref_to_Member'>StartBlobsPtr</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2450"><span class='Ref_To_Local'>endPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN266"><span class='Ref_to_Member'>EndBlobsPtr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2449"><span class='Ref_To_Local'>startPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN246"><span class='Ref_to_Member'>StartDataPtr</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2450"><span class='Ref_To_Local'>endPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN250"><span class='Ref_to_Member'>EndDataPtr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2449"><span class='Ref_To_Local'>startPtr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN2449"><span class='Ref_To_Local'>startPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The user-provided DataDumper routine needs to call AH-&GT;WriteData 
     */ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN358"><span class='Ref_to_Member'>dataDumper</span></a><span class='Parentheses'>) ((</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN359"><span class='Ref_to_Member'>dataDumperArg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2450"><span class='Ref_To_Local'>endPtr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN2450"><span class='Ref_To_Local'>endPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2447"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN310"><span class='Ref_to_Member'>currToc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end WriteDataChunksForTocEntry &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2480"></a><span class='Declare_Function'>WriteToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2482"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span><a name="LN2483"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>workbuf</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span><a name="LN2484"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tocCount</span><span class='Delimiter'>; 
</span><a name="LN2485"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* count entries that will actually be dumped */ 
</span>    <a href="pg_backup_archiver.c.html#LN2484"><span class='Ref_To_Local'>tocCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a> <span class='Operator'>| </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a> <span class='Operator'>| </span><a href="pg_backup_archiver.h.html#LN209"><span class='Ref_to_EnumConst'>REQ_SPECIAL</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.c.html#LN2484"><span class='Ref_To_Local'>tocCount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* printf("%d TOC Entries to save\n", tocCount); */ 
</span> 
    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2484"><span class='Ref_To_Local'>tocCount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a> <span class='Operator'>| </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a> <span class='Operator'>| </span><a href="pg_backup_archiver.h.html#LN209"><span class='Ref_to_EnumConst'>REQ_SPECIAL</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN358"><span class='Ref_to_Member'>dataDumper</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* OID is recorded as a string for historical reasons */ 
</span>        <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2483"><span class='Ref_To_Local'>workbuf</span></a><span class='Delimiter'>, </span><span class='String'>"%u"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN225"><span class='Ref_to_Member'>tableoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2483"><span class='Ref_To_Local'>workbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2483"><span class='Ref_To_Local'>workbuf</span></a><span class='Delimiter'>, </span><span class='String'>"%u"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN226"><span class='Ref_to_Member'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2483"><span class='Ref_To_Local'>workbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN353"><span class='Ref_to_Member'>dropStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN347"><span class='Ref_to_Member'>tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN349"><span class='Ref_to_Member'>owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN350"><span class='Ref_to_Member'>withOids</span></a> <span class='Operator'>? </span><span class='String'>"true"</span> <span class='Operator'>: </span><span class='String'>"false"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Dump list of dependencies */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2485"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2485"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2485"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2483"><span class='Ref_To_Local'>workbuf</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2485"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2483"><span class='Ref_To_Local'>workbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Terminate List */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN257"><span class='Ref_to_Member'>WriteExtraTocPtr</span></a><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN257"><span class='Ref_to_Member'>WriteExtraTocPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN2480"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2482"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for te=AH-&GT;toc-&GT;next;te!=... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end WriteToc &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2538"></a><span class='Declare_Function'>ReadToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2540"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2541"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN2542"></a>    <a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>deps</span><span class='Delimiter'>; 
</span><a name="LN2543"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>depIdx</span><span class='Delimiter'>; 
</span><a name="LN2544"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>depSize</span><span class='Delimiter'>; 
</span><a name="LN2545"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN303"><span class='Ref_to_Member'>tocCount</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2540"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2540"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN303"><span class='Ref_to_Member'>tocCount</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN2540"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a> <span class='Operator'>&GT; </span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Sanity check */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                       <span class='String'>"entry ID %d out of range -- perhaps a corrupt TOC\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN343"><span class='Ref_to_Member'>hadDumper</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN84"><span class='Ref_to_Const'>K_VERS_1_8</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_archiver.c.html#LN2541"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            sscanf<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2541"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='String'>"%u"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN225"><span class='Ref_to_Member'>tableoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2541"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN225"><span class='Ref_to_Member'>tableoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2541"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        sscanf<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2541"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='String'>"%u"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN226"><span class='Ref_to_Member'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2541"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN90"><span class='Ref_to_Const'>K_VERS_1_11</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Rules for pre-8.4 archives wherein pg_dump hasn't classified 
             * the entries into sections.  This list need not cover entry 
             * types added later than 8.4. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"COMMENT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"ACL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"ACL LANGUAGE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN54"><span class='Ref_to_EnumConst'>SECTION_NONE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE DATA"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOBS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOB COMMENTS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN56"><span class='Ref_to_EnumConst'>SECTION_DATA</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"CHECK CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"FK CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"INDEX"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"RULE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TRIGGER"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN57"><span class='Ref_to_EnumConst'>SECTION_POST_DATA</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN55"><span class='Ref_to_EnumConst'>SECTION_PRE_DATA</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN353"><span class='Ref_to_Member'>dropStmt</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN78"><span class='Ref_to_Const'>K_VERS_1_3</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN81"><span class='Ref_to_Const'>K_VERS_1_6</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN89"><span class='Ref_to_Const'>K_VERS_1_10</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN347"><span class='Ref_to_Member'>tablespace</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN349"><span class='Ref_to_Member'>owner</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN87"><span class='Ref_to_Const'>K_VERS_1_9</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN350"><span class='Ref_to_Member'>withOids</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN350"><span class='Ref_to_Member'>withOids</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN350"><span class='Ref_to_Member'>withOids</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Read TOC entry dependencies */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN80"><span class='Ref_to_Const'>K_VERS_1_5</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_archiver.c.html#LN2544"><span class='Ref_To_Local'>depSize</span></a> <span class='Operator'>= </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN2542"><span class='Ref_To_Local'>deps</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN2544"><span class='Ref_To_Local'>depSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN2543"><span class='Ref_To_Local'>depIdx</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN2541"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2541"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* end of list */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2543"><span class='Ref_To_Local'>depIdx</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.c.html#LN2544"><span class='Ref_To_Local'>depSize</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pg_backup_archiver.c.html#LN2544"><span class='Ref_To_Local'>depSize</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                    <a href="pg_backup_archiver.c.html#LN2542"><span class='Ref_To_Local'>deps</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN28"><span class='Ref_to_Proto'>pg_realloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2542"><span class='Ref_To_Local'>deps</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN2544"><span class='Ref_To_Local'>depSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                sscanf<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2541"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2542"><span class='Ref_To_Local'>deps</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2543"><span class='Ref_To_Local'>depIdx</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2541"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_backup_archiver.c.html#LN2543"><span class='Ref_To_Local'>depIdx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2543"><span class='Ref_To_Local'>depIdx</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* We have a non-null entry */ 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN2542"><span class='Ref_To_Local'>deps</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN28"><span class='Ref_to_Proto'>pg_realloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2542"><span class='Ref_To_Local'>deps</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pg_backup_archiver.c.html#LN2543"><span class='Ref_To_Local'>depIdx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2542"><span class='Ref_To_Local'>deps</span></a><span class='Delimiter'>; 
</span>                <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2543"><span class='Ref_To_Local'>depIdx</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2542"><span class='Ref_To_Local'>deps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if AH-&GT;version&GT;=K_VERS_1... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN260"><span class='Ref_to_Member'>ReadExtraTocPtr</span></a><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN260"><span class='Ref_to_Member'>ReadExtraTocPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='String'>"read TOC entry %d (ID %d) for %s %s\n"</span><span class='Delimiter'>, 
</span>              <a href="pg_backup_archiver.c.html#LN2540"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* link completed entry into TOC circular list */ 
</span>        <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN338"><span class='Ref_to_Member'>prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* special processing immediately upon read for some items */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"ENCODING"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.c.html#LN70"><span class='Ref_to_Proto'>processEncodingEntry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"STDSTRINGS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.c.html#LN71"><span class='Ref_to_Proto'>processStdStringsEntry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2538"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2545"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;AH-&GT;tocCount;i+... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ReadToc &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2695"></a><span class='Declare_Function'>processEncodingEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* te-&GT;defn should have the form SET client_encoding = 'foo'; */ 
</span><a name="LN2698"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>defn</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2695"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2699"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr1</span><span class='Delimiter'>; 
</span><a name="LN2700"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr2</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2701"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>encoding</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2699"><span class='Ref_To_Local'>ptr1</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2698"><span class='Ref_To_Local'>defn</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2699"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN2700"><span class='Ref_To_Local'>ptr2</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><span class='Operator'>++</span><a href="pg_backup_archiver.c.html#LN2699"><span class='Ref_To_Local'>ptr1</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2700"><span class='Ref_To_Local'>ptr2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN2700"><span class='Ref_To_Local'>ptr2</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2701"><span class='Ref_To_Local'>encoding</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN501"><span class='Ref_to_Proto'>pg_char_to_encoding</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2699"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2701"><span class='Ref_To_Local'>encoding</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized encoding \"%s\"\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN2699"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN2695"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN195"><span class='Ref_to_Member'>encoding</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2701"><span class='Ref_To_Local'>encoding</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"invalid ENCODING item: %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN2695"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2698"><span class='Ref_To_Local'>defn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end processEncodingEntry &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2723"></a><span class='Declare_Function'>processStdStringsEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* te-&GT;defn should have the form SET standard_conforming_strings = 'x'; */ 
</span><a name="LN2726"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr1</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN2726"><span class='Ref_To_Local'>ptr1</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2723"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2726"><span class='Ref_To_Local'>ptr1</span></a> <span class='Operator'>&& </span>strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2726"><span class='Ref_To_Local'>ptr1</span></a><span class='Delimiter'>, </span><span class='String'>"'on'"</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.c.html#LN2723"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN196"><span class='Ref_to_Member'>std_strings</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2726"><span class='Ref_To_Local'>ptr1</span></a> <span class='Operator'>&& </span>strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2726"><span class='Ref_To_Local'>ptr1</span></a><span class='Delimiter'>, </span><span class='String'>"'off'"</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.c.html#LN2723"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN196"><span class='Ref_to_Member'>std_strings</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"invalid STDSTRINGS item: %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN2723"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN2739"></a><span class='Declare_Function'>StrictNamesCheck</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ropt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2741"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>missing_name</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN79"><span class='Ref_to_Member'>strict_names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN102"><span class='Ref_to_Member'>schemaNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a> <span class='Operator'>= </span><a href="../../include/fe_utils/simple_list.h.html#LN52"><span class='Ref_to_Proto'>simple_string_list_not_touched</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN102"><span class='Ref_to_Member'>schemaNames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"schema \"%s\" not found\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN105"><span class='Ref_to_Member'>tableNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a> <span class='Operator'>= </span><a href="../../include/fe_utils/simple_list.h.html#LN52"><span class='Ref_to_Proto'>simple_string_list_not_touched</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN105"><span class='Ref_to_Member'>tableNames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"table \"%s\" not found\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN100"><span class='Ref_to_Member'>indexNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a> <span class='Operator'>= </span><a href="../../include/fe_utils/simple_list.h.html#LN52"><span class='Ref_to_Proto'>simple_string_list_not_touched</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN100"><span class='Ref_to_Member'>indexNames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"index \"%s\" not found\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN101"><span class='Ref_to_Member'>functionNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a> <span class='Operator'>= </span><a href="../../include/fe_utils/simple_list.h.html#LN52"><span class='Ref_to_Proto'>simple_string_list_not_touched</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN101"><span class='Ref_to_Member'>functionNames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"function \"%s\" not found\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN104"><span class='Ref_to_Member'>triggerNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a> <span class='Operator'>= </span><a href="../../include/fe_utils/simple_list.h.html#LN52"><span class='Ref_to_Proto'>simple_string_list_not_touched</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2739"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN104"><span class='Ref_to_Member'>triggerNames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"trigger \"%s\" not found\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2741"><span class='Ref_To_Local'>missing_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end StrictNamesCheck &raquo; </span> 
 
<span class='Keyword'>static </span><a href="pg_backup_archiver.h.html#LN205"><span class='Ref_to_Typedef'>teReqs</span></a> 
<a name="LN2782"></a><span class='Declare_Function'>_tocEntryRequired</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN52"><span class='Ref_to_Typedef'>teSection</span></a> <span class='Declare_Parameter'>curSection</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ropt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2784"></a>    <a href="pg_backup_archiver.h.html#LN205"><span class='Ref_to_Typedef'>teReqs</span></a>      <span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a> <span class='Operator'>| </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ENCODING and STDSTRINGS items are treated specially */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"ENCODING"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"STDSTRINGS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="pg_backup_archiver.h.html#LN209"><span class='Ref_to_EnumConst'>REQ_SPECIAL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If it's an ACL, maybe ignore it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN86"><span class='Ref_to_Member'>aclsSkip</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN73"><span class='Ref_to_Proto'>_tocEntryIsACL</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If it's a publication, maybe ignore it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN76"><span class='Ref_to_Member'>no_publications</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"PUBLICATION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If it's security labels, maybe ignore it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN77"><span class='Ref_to_Member'>no_security_labels</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SECURITY LABEL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If it's a subcription, maybe ignore it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN78"><span class='Ref_to_Member'>no_subscriptions</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SUBSCRIPTION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ignore it if section is not to be dumped/restored */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>curSection</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="pg_backup.h.html#LN55"><span class='Ref_to_EnumConst'>SECTION_PRE_DATA</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN84"><span class='Ref_to_Member'>dumpSections</span></a> <span class='Operator'>& </span><a href="pg_backup_utils.h.html#LN19"><span class='Ref_to_EnumConst'>DUMP_PRE_DATA</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_backup.h.html#LN56"><span class='Ref_to_EnumConst'>SECTION_DATA</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN84"><span class='Ref_to_Member'>dumpSections</span></a> <span class='Operator'>& </span><a href="pg_backup_utils.h.html#LN20"><span class='Ref_to_EnumConst'>DUMP_DATA</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_backup.h.html#LN57"><span class='Ref_to_EnumConst'>SECTION_POST_DATA</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN84"><span class='Ref_to_Member'>dumpSections</span></a> <span class='Operator'>& </span><a href="pg_backup_utils.h.html#LN21"><span class='Ref_to_EnumConst'>DUMP_POST_DATA</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* shouldn't get here, really, but ignore it */ 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Check options for selective dump/restore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN102"><span class='Ref_to_Member'>schemaNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If no namespace is specified, it means all. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/fe_utils/simple_list.h.html#LN50"><span class='Ref_to_Proto'>simple_string_list_member</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN102"><span class='Ref_to_Member'>schemaNames</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>)))</span> 
            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN103"><span class='Ref_to_Member'>schemaExcludeNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span> <span class='Operator'>&& 
</span>        <a href="../../include/fe_utils/simple_list.h.html#LN50"><span class='Ref_to_Proto'>simple_string_list_member</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN103"><span class='Ref_to_Member'>schemaExcludeNames</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN95"><span class='Ref_to_Member'>selTypes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE DATA"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"VIEW"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"FOREIGN TABLE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"MATERIALIZED VIEW"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"MATERIALIZED VIEW DATA"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SEQUENCE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SEQUENCE SET"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN99"><span class='Ref_to_Member'>selTable</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN105"><span class='Ref_to_Member'>tableNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/fe_utils/simple_list.h.html#LN50"><span class='Ref_to_Proto'>simple_string_list_member</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN105"><span class='Ref_to_Member'>tableNames</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>))))</span> 
                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"INDEX"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN96"><span class='Ref_to_Member'>selIndex</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN100"><span class='Ref_to_Member'>indexNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/fe_utils/simple_list.h.html#LN50"><span class='Ref_to_Proto'>simple_string_list_member</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN100"><span class='Ref_to_Member'>indexNames</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>))))</span> 
                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"FUNCTION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN97"><span class='Ref_to_Member'>selFunction</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN101"><span class='Ref_to_Member'>functionNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/fe_utils/simple_list.h.html#LN50"><span class='Ref_to_Proto'>simple_string_list_member</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN101"><span class='Ref_to_Member'>functionNames</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>))))</span> 
                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TRIGGER"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN98"><span class='Ref_to_Member'>selTrigger</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN104"><span class='Ref_to_Member'>triggerNames</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/simple_list.h.html#LN41"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/fe_utils/simple_list.h.html#LN50"><span class='Ref_to_Proto'>simple_string_list_member</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN104"><span class='Ref_to_Member'>triggerNames</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>))))</span> 
                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ropt-&GT;selTypes &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Check if we had a dataDumper. Indicates if the entry is schema or data 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN343"><span class='Ref_to_Member'>hadDumper</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Special Case: If 'SEQUENCE SET' or anything to do with BLOBs, then 
         * it is considered a data entry.  We don't need to check for the 
         * BLOBS entry or old-style BLOB COMMENTS, because they will have 
         * hadDumper = true ... but we do need to check new-style BLOB 
         * comments. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SEQUENCE SET"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOB"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"ACL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>             strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"LARGE OBJECT "</span><span class='Delimiter'>, </span><span class='Number'>13</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"COMMENT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>             strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"LARGE OBJECT "</span><span class='Delimiter'>, </span><span class='Number'>13</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SECURITY LABEL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>             strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"LARGE OBJECT "</span><span class='Delimiter'>, </span><span class='Number'>13</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>& </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>& ~</span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !te-&GT;hadDumper &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Special case: &LT;Init&GT; type with &LT;Max OID&GT; tag; this is obsolete and we 
     * always ignore it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;Init&GT;"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"Max OID"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mask it if we only want schema */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN83"><span class='Ref_to_Member'>schemaOnly</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * In binary-upgrade mode, even with schema-only set, we do not mask 
         * out large objects.  Only large object definitions, comments and 
         * other information should be generated in binary-upgrade mode (not 
         * the actual data). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN122"><span class='Ref_to_Member'>sequence_data</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SEQUENCE SET"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN123"><span class='Ref_to_Member'>binary_upgrade</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOB"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN123"><span class='Ref_to_Member'>binary_upgrade</span></a> <span class='Operator'>&& </span>strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"LARGE OBJECT "</span><span class='Delimiter'>, </span><span class='Number'>13</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>& </span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Mask it if we only want data */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN82"><span class='Ref_to_Member'>dataOnly</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>& </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mask it if we don't have a schema contribution */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a> <span class='Operator'>|| </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>& ~</span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Finally, if there's a per-ID filter, limit based on that as well */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN120"><span class='Ref_to_Member'>idWanted</span></a> <span class='Operator'>&& !</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN120"><span class='Ref_to_Member'>idWanted</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN2782"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN2784"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _tocEntryRequired &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Identify TOC entries that are ACLs. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2949"></a><span class='Declare_Function'>_tocEntryIsACL</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* "ACL LANGUAGE" was a crock emitted only in PG 7.4 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2949"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"ACL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2949"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"ACL LANGUAGE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2949"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"DEFAULT ACL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Issue SET commands for parameters that we want to have set the same way 
 * at all times during execution of a restore script. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2964"></a><span class='Declare_Function'>_doSetFixedOutputState</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2966"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Disable timeouts to allow for slow commands, idle parallel workers, etc 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET statement_timeout = 0;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET lock_timeout = 0;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET idle_in_transaction_session_timeout = 0;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Select the correct character set encoding */ 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET client_encoding = '%s';\n"</span><span class='Delimiter'>, 
</span>             <a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN195"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Select the correct string literal syntax */ 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET standard_conforming_strings = %s;\n"</span><span class='Delimiter'>, 
</span>             <a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN196"><span class='Ref_to_Member'>std_strings</span></a> <span class='Operator'>? </span><span class='String'>"on"</span> <span class='Operator'>: </span><span class='String'>"off"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Select the role to be used during restore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2966"><span class='Ref_To_Local'>ropt</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN2966"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN70"><span class='Ref_to_Member'>use_role</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET ROLE %s;\n"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2966"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN70"><span class='Ref_to_Member'>use_role</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make sure function checking is disabled */ 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET check_function_bodies = false;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Avoid annoying notices etc */ 
</span>    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET client_min_messages = warning;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN196"><span class='Ref_to_Member'>std_strings</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET escape_string_warning = off;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust row-security state */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2966"><span class='Ref_To_Local'>ropt</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN2966"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN121"><span class='Ref_to_Member'>enable_row_security</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET row_security = on;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"SET row_security = off;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN2964"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _doSetFixedOutputState &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Issue a SET SESSION AUTHORIZATION command.  Caller is responsible 
 * for updating state if appropriate.  If user is NULL or an empty string, 
 * the specification DEFAULT will be used. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3010"></a><span class='Declare_Function'>_doSetSessionAuth</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>user</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3012"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>cmd</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3012"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>"SET SESSION AUTHORIZATION "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * SQL requires a string literal here.  Might as well be correct. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3010"><span class='Ref_to_Parameter'>user</span></a> <span class='Operator'>&& *</span><a href="pg_backup_archiver.c.html#LN3010"><span class='Ref_to_Parameter'>user</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.h.html#LN396"><span class='Ref_to_Macro'>appendStringLiteralAHX</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3012"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3010"><span class='Ref_to_Parameter'>user</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3010"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3012"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>"DEFAULT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3012"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>';'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN80"><span class='Ref_to_Proto'>RestoringToDB</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3010"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3027"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN3027"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3010"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3012"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3027"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>|| </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3027"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
            <span class='Comment_Multi_Line'>/* NOT warn_or_exit_horribly... use -O instead to skip this. */ 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not set session user to \"%s\": %s"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN3010"><span class='Ref_to_Parameter'>user</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3010"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3027"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3010"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3012"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3012"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _doSetSessionAuth &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Issue a SET default_with_oids command.  Caller is responsible 
 * for updating state if appropriate. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3050"></a><span class='Declare_Function'>_doSetWithOids</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const bool </span><span class='Declare_Parameter'>withOids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3052"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>cmd</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3052"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>"SET default_with_oids = %s;"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3050"><span class='Ref_to_Parameter'>withOids</span></a> <span class='Operator'>? 
</span>                      <span class='String'>"true"</span> <span class='Operator'>: </span><span class='String'>"false"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN80"><span class='Ref_to_Proto'>RestoringToDB</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3050"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3059"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN3059"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3050"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3052"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3059"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>|| </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3059"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.c.html#LN1735"><span class='Ref_to_Func'>warn_or_exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3050"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                                  <span class='String'>"could not set default_with_oids: %s"</span><span class='Delimiter'>, 
</span>                                  <a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3050"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3059"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3050"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3052"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3052"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _doSetWithOids &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Issue the commands to connect to the specified database. 
 * 
 * If we're currently restoring right into a database, this will 
 * actually establish a connection. Otherwise it puts a \connect into 
 * the script output. 
 * 
 * NULL dbname implies reconnecting to the current DB (pretty useless). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3087"></a><span class='Declare_Function'>_reconnectToDB</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN80"><span class='Ref_to_Proto'>RestoringToDB</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>))</span> 
        <a href="pg_backup_db.c.html#LN84"><span class='Ref_to_Func'>ReconnectToServer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3095"></a>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>connectbuf</span><span class='Delimiter'>; 
</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3095"><span class='Ref_To_Local'>connectbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/fe_utils/string_utils.h.html#LN46"><span class='Ref_to_Proto'>appendPsqlMetaConnect</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3095"><span class='Ref_To_Local'>connectbuf</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3095"><span class='Ref_To_Local'>connectbuf</span></a><span class='Operator'>.</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3095"><span class='Ref_To_Local'>connectbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><span class='String'>"\\connect -\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * NOTE: currUser keeps track of what the imaginary session user in our 
     * script is.  It's now effectively reset to the original userID. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* don't assume we still know the output schema, tablespace, etc either */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN323"><span class='Ref_to_Member'>currWithOids</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* re-establish fixed state */ 
</span>    <a href="pg_backup_archiver.c.html#LN62"><span class='Ref_to_Proto'>_doSetFixedOutputState</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3087"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _reconnectToDB &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Become the specified user, and update state to avoid redundant commands 
 * 
 * NULL or empty argument is taken to mean restoring the session default 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3133"></a><span class='Declare_Function'>_becomeUser</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>user</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>user</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>user</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* avoid null pointers */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>user</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* no need to do anything */ 
</span> 
    <a href="pg_backup_archiver.c.html#LN63"><span class='Ref_to_Proto'>_doSetSessionAuth</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>user</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * NOTE: currUser keeps track of what the imaginary session user in our 
     * script is 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3133"><span class='Ref_to_Parameter'>user</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Become the owner of the given TOC entry object.  If 
 * changes in ownership are not allowed, this doesn't do anything. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3157"></a><span class='Declare_Function'>_becomeOwner</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3159"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3157"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3159"><span class='Ref_To_Local'>ropt</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3159"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN63"><span class='Ref_to_Member'>noOwner</span></a> <span class='Operator'>|| !</span><a href="pg_backup_archiver.c.html#LN3159"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN67"><span class='Ref_to_Member'>use_setsessauth</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN66"><span class='Ref_to_Proto'>_becomeUser</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3157"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3157"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN349"><span class='Ref_to_Member'>owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Set the proper default_with_oids value for the table. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3172"></a><span class='Declare_Function'>_setWithOids</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3172"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN323"><span class='Ref_to_Member'>currWithOids</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN3172"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN350"><span class='Ref_to_Member'>withOids</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN64"><span class='Ref_to_Proto'>_doSetWithOids</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3172"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3172"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN350"><span class='Ref_to_Member'>withOids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN3172"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN323"><span class='Ref_to_Member'>currWithOids</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3172"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN350"><span class='Ref_to_Member'>withOids</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Issue the commands to select the specified schema as the current schema 
 * in the target database. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3187"></a><span class='Declare_Function'>_selectOutputSchema</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>schemaName</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3189"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>qry</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>schemaName</span></a> <span class='Operator'>|| *</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>schemaName</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* no need to do anything */ 
</span> 
    <a href="pg_backup_archiver.c.html#LN3189"><span class='Ref_To_Local'>qry</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3189"><span class='Ref_To_Local'>qry</span></a><span class='Delimiter'>, </span><span class='String'>"SET search_path = %s"</span><span class='Delimiter'>, 
</span>                      <a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Delimiter'>, </span><span class='String'>"pg_catalog"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3189"><span class='Ref_To_Local'>qry</span></a><span class='Delimiter'>, </span><span class='String'>", pg_catalog"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN80"><span class='Ref_to_Proto'>RestoringToDB</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3204"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN3204"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3189"><span class='Ref_To_Local'>qry</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3204"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>|| </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3204"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.c.html#LN1735"><span class='Ref_to_Func'>warn_or_exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                                  <span class='String'>"could not set search_path to \"%s\": %s"</span><span class='Delimiter'>, 
</span>                                  <a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3204"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s;\n\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3189"><span class='Ref_To_Local'>qry</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3187"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3189"><span class='Ref_To_Local'>qry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _selectOutputSchema &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Issue the commands to select the specified tablespace as the current one 
 * in the target database. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3230"></a><span class='Declare_Function'>_selectTablespace</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tablespace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3232"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span><a name="LN3233"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>qry</span><span class='Delimiter'>; 
</span><a name="LN3234"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>want</span><span class='Delimiter'>, 
</span><a name="LN3235"></a>               <span class='Operator'>*</span><span class='Declare_Local'>have</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* do nothing in --no-tablespaces mode */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3232"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN64"><span class='Ref_to_Member'>noTablespace</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN3235"><span class='Ref_To_Local'>have</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3234"><span class='Ref_To_Local'>want</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>tablespace</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* no need to do anything for non-tablespace object */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3234"><span class='Ref_To_Local'>want</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3235"><span class='Ref_To_Local'>have</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3234"><span class='Ref_To_Local'>want</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3235"><span class='Ref_To_Local'>have</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* no need to do anything */ 
</span> 
    <a href="pg_backup_archiver.c.html#LN3233"><span class='Ref_To_Local'>qry</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3234"><span class='Ref_To_Local'>want</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We want the tablespace to be the database's default */ 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3233"><span class='Ref_To_Local'>qry</span></a><span class='Delimiter'>, </span><span class='String'>"SET default_tablespace = ''"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We want an explicit tablespace */ 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3233"><span class='Ref_To_Local'>qry</span></a><span class='Delimiter'>, </span><span class='String'>"SET default_tablespace = %s"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3234"><span class='Ref_To_Local'>want</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN80"><span class='Ref_to_Proto'>RestoringToDB</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3266"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN3266"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3233"><span class='Ref_To_Local'>qry</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3266"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>|| </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3266"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.c.html#LN1735"><span class='Ref_to_Func'>warn_or_exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"could not set default_tablespace to %s: %s"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3234"><span class='Ref_To_Local'>want</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3266"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s;\n\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3233"><span class='Ref_To_Local'>qry</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3230"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3234"><span class='Ref_To_Local'>want</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3233"><span class='Ref_To_Local'>qry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _selectTablespace &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract an object description for a TOC entry, and append it to buf. 
 * 
 * This is used for ALTER ... OWNER TO. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3293"></a><span class='Declare_Function'>_getObjectDescription</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3295"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>type</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3293"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use ALTER TABLE for views and sequences */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"VIEW"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"SEQUENCE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"MATERIALIZED VIEW"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><span class='String'>"TABLE"</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* objects that don't require special decoration */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"COLLATION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"CONVERSION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"DOMAIN"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"TYPE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"FOREIGN TABLE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"TEXT SEARCH DICTIONARY"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"TEXT SEARCH CONFIGURATION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>    <span class='Comment_Multi_Line'>/* non-schema-specified objects */ 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"DATABASE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"PROCEDURAL LANGUAGE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"SCHEMA"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"FOREIGN DATA WRAPPER"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"SERVER"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"PUBLICATION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"SUBSCRIPTION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"USER MAPPING"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We already know that search_path was set properly */ 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3293"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%s %s"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3293"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(type,"COLLATIO... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* BLOBs just have a name, but it's numeric so must not use fmtId */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"BLOB"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3293"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"LARGE OBJECT %s"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3293"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * These object types require additional decoration.  Fortunately, the 
     * information needed is exactly what's in the DROP command. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"AGGREGATE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"FUNCTION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"OPERATOR"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"OPERATOR CLASS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='String'>"OPERATOR FAMILY"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Chop "DROP " off the front and make a modifiable copy */ 
</span><a name="LN3344"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>first</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3293"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN353"><span class='Ref_to_Member'>dropStmt</span></a> <span class='Operator'>+ </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3345"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>last</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* point to last character in string */ 
</span>        <a href="pg_backup_archiver.c.html#LN3345"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3344"><span class='Ref_To_Local'>first</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3344"><span class='Ref_To_Local'>first</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Strip off any ';' or '\n' at the end */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3345"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.c.html#LN3344"><span class='Ref_To_Local'>first</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3345"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span> <span class='Operator'>|| *</span><a href="pg_backup_archiver.c.html#LN3345"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>== </span><span class='String'>';'</span><span class='Parentheses'>))</span> 
            <a href="pg_backup_archiver.c.html#LN3345"><span class='Ref_To_Local'>last</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3345"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3293"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3344"><span class='Ref_To_Local'>first</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3344"><span class='Ref_To_Local'>first</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(type,"AGGREGAT... &raquo; </span> 
 
    <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"WARNING: don't know how to set owner for object type %s\n"</span><span class='Delimiter'>, 
</span>              <a href="pg_backup_archiver.c.html#LN3295"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _getObjectDescription &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3366"></a><span class='Declare_Function'>_printTocEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isData</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>acl_pass</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3368"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ACLs are dumped only during acl pass */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>acl_pass</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN73"><span class='Ref_to_Proto'>_tocEntryIsACL</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN73"><span class='Ref_to_Proto'>_tocEntryIsACL</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Avoid dumping the public schema, as it will already be created ... 
     * unless we are using --clean mode (and *not* --create mode), in which 
     * case we've previously issued a DROP for it so we'd better recreate it. 
     * 
     * Likewise for its comment, if any.  (We could try issuing the COMMENT 
     * command anyway; but it'd fail if the restore is done as non-super-user, 
     * so let's not.) 
     * 
     * XXX it looks pretty ugly to hard-wire the public schema like this, but 
     * it sits in a sort of no-mans-land between being a system object and a 
     * user object, so it really is special in a way. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3368"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN71"><span class='Ref_to_Member'>dropSchema</span></a> <span class='Operator'>&& !</span><a href="pg_backup_archiver.c.html#LN3368"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN62"><span class='Ref_to_Member'>createDB</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SCHEMA"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"public"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"COMMENT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"SCHEMA public"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Select owner, schema, and tablespace as necessary */ 
</span>    <a href="pg_backup_archiver.c.html#LN67"><span class='Ref_to_Proto'>_becomeOwner</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN68"><span class='Ref_to_Proto'>_selectOutputSchema</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN69"><span class='Ref_to_Proto'>_selectTablespace</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN347"><span class='Ref_to_Member'>tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up OID mode too */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.c.html#LN3171"><span class='Ref_to_Func'>_setWithOids</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Emit header comment for item */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN329"><span class='Ref_to_Member'>noTocComments</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3417"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>pfx</span><span class='Delimiter'>; 
</span><a name="LN3418"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sanitized_name</span><span class='Delimiter'>; 
</span><a name="LN3419"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sanitized_schema</span><span class='Delimiter'>; 
</span><a name="LN3420"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sanitized_owner</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>isData</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN3417"><span class='Ref_To_Local'>pfx</span></a> <span class='Operator'>= </span><span class='String'>"Data for "</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN3417"><span class='Ref_To_Local'>pfx</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"--\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN182"><span class='Ref_to_Member'>verbose</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"-- TOC entry %d (class %u OID %u)\n"</span><span class='Delimiter'>, 
</span>                     <a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN225"><span class='Ref_to_Member'>tableoid</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN340"><span class='Ref_to_Member'>catalogId</span></a><span class='Operator'>.</span><a href="pg_backup.h.html#LN226"><span class='Ref_to_Member'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3434"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"-- Dependencies:"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3434"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN3434"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN3434"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>" %d"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN3434"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Zap any line endings embedded in user-supplied fields, to prevent 
         * corruption of the dump (which could, in the worst case, present an 
         * SQL injection vulnerability if someone were to incautiously load a 
         * dump containing objects with maliciously crafted names). 
         */ 
</span>        <a href="pg_backup_archiver.c.html#LN3418"><span class='Ref_To_Local'>sanitized_name</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN61"><span class='Ref_to_Proto'>replace_line_endings</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN3419"><span class='Ref_To_Local'>sanitized_schema</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN61"><span class='Ref_to_Proto'>replace_line_endings</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><span class='Control'>namespace</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN3419"><span class='Ref_To_Local'>sanitized_schema</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><span class='String'>"-"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3368"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN63"><span class='Ref_to_Member'>noOwner</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN3420"><span class='Ref_To_Local'>sanitized_owner</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN61"><span class='Ref_to_Proto'>replace_line_endings</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN349"><span class='Ref_to_Member'>owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN3420"><span class='Ref_To_Local'>sanitized_owner</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><span class='String'>"-"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"-- %sName: %s; Type: %s; Schema: %s; Owner: %s"</span><span class='Delimiter'>, 
</span>                 <a href="pg_backup_archiver.c.html#LN3417"><span class='Ref_To_Local'>pfx</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3418"><span class='Ref_To_Local'>sanitized_name</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3419"><span class='Ref_To_Local'>sanitized_schema</span></a><span class='Delimiter'>, 
</span>                 <a href="pg_backup_archiver.c.html#LN3420"><span class='Ref_To_Local'>sanitized_owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3418"><span class='Ref_To_Local'>sanitized_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3419"><span class='Ref_To_Local'>sanitized_schema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3420"><span class='Ref_To_Local'>sanitized_owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN347"><span class='Ref_to_Member'>tablespace</span></a> <span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN347"><span class='Ref_to_Member'>tablespace</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="pg_backup_archiver.c.html#LN3368"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN64"><span class='Ref_to_Member'>noTablespace</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN3469"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sanitized_tablespace</span><span class='Delimiter'>; 
</span> 
            <a href="pg_backup_archiver.c.html#LN3469"><span class='Ref_To_Local'>sanitized_tablespace</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN61"><span class='Ref_to_Proto'>replace_line_endings</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN347"><span class='Ref_to_Member'>tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"; Tablespace: %s"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3469"><span class='Ref_To_Local'>sanitized_tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3469"><span class='Ref_To_Local'>sanitized_tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN262"><span class='Ref_to_Member'>PrintExtraTocPtr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN262"><span class='Ref_to_Member'>PrintExtraTocPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !AH-&GT;noTocComments &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Actually print the definition. 
     * 
     * Really crude hack for suppressing AUTHORIZATION clause that old pg_dump 
     * versions put into CREATE SCHEMA.  We have to do this when --no-owner 
     * mode is selected.  This is ugly, but I see no other good way ... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3368"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN63"><span class='Ref_to_Member'>noOwner</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SCHEMA"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE SCHEMA %s;\n\n\n"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN352"><span class='Ref_to_Member'>defn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we aren't using SET SESSION AUTH to determine ownership, we must 
     * instead issue an ALTER OWNER command.  We assume that anything without 
     * a DROP command is not a separately ownable object.  All the categories 
     * with DROP commands must appear in one list or the other. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3368"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN63"><span class='Ref_to_Member'>noOwner</span></a> <span class='Operator'>&& !</span><a href="pg_backup_archiver.c.html#LN3368"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN67"><span class='Ref_to_Member'>use_setsessauth</span></a> <span class='Operator'>&& 
</span>        strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN349"><span class='Ref_to_Member'>owner</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN353"><span class='Ref_to_Member'>dropStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"AGGREGATE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOB"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"COLLATION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"CONVERSION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"DATABASE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"DOMAIN"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"FUNCTION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"OPERATOR"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"OPERATOR CLASS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"OPERATOR FAMILY"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"PROCEDURAL LANGUAGE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SCHEMA"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TYPE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"VIEW"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"MATERIALIZED VIEW"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SEQUENCE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"FOREIGN TABLE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TEXT SEARCH DICTIONARY"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TEXT SEARCH CONFIGURATION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"FOREIGN DATA WRAPPER"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SERVER"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"PUBLICATION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"SUBSCRIPTION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN3533"></a>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>temp</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3533"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN58"><span class='Ref_to_Proto'>_getObjectDescription</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3533"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3533"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>, </span><span class='String'>" OWNER TO %s;"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN349"><span class='Ref_to_Member'>owner</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3533"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3533"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(te-&GT;desc,"AGGR... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"CAST"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"CHECK CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"DEFAULT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"FK CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"INDEX"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"RULE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TRIGGER"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"ROW SECURITY"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"POLICY"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"USER MAPPING"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"STATISTICS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* these object types don't have separate owners */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"WARNING: don't know how to set owner for object type %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !ropt-&GT;noOwner&&!ropt... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If it's an ACL entry, it might contain SET SESSION AUTHORIZATION 
     * commands, so we can no longer assume we know the current auth setting. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>acl_pass</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN3366"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end _printTocEntry &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Sanitize a string to be included in an SQL comment or TOC listing, 
 * by replacing any newlines with spaces. 
 * The result is a freshly malloc'd string. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN3581"></a><span class='Declare_Function'>replace_line_endings</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3583"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3584"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN3583"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3581"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3584"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3583"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3584"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN3584"><span class='Ref_To_Local'>s</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3584"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span> <span class='Operator'>|| *</span><a href="pg_backup_archiver.c.html#LN3584"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3584"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN3583"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN3598"></a><span class='Declare_Function'>WriteHead</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3600"></a>    <span class='Control'>struct</span> <a href="../../timezone/localtime.c.html#LN110"><span class='Ref_to_Global_Var'>tm</span></a>   <span class='Declare_Local'>crtm</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN253"><span class='Ref_to_Member'>WriteBufPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"PGDMP"</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Magic code */ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN71"><span class='Ref_to_Macro'>ARCHIVE_MAJOR</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN72"><span class='Ref_to_Macro'>ARCHIVE_MINOR</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN73"><span class='Ref_to_Macro'>ARCHIVE_REV</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN225"><span class='Ref_to_Member'>offSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3600"><span class='Ref_To_Local'>crtm</span></a> <span class='Operator'>= *</span>localtime<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN231"><span class='Ref_to_Member'>createDate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3600"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_sec<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3600"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_min<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3600"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_hour<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3600"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_mday<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3600"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_mon<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3600"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_year<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3600"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_isdst<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN310"><span class='Ref_to_Proto'>PQdb</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN183"><span class='Ref_to_Member'>remoteVersionStr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3598"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span>PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end WriteHead &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN3624"></a><span class='Declare_Function'>ReadHead</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3626"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tmpMag</span><span class='Delimiter'>[</span><span class='Number'>7</span><span class='Delimiter'>]; 
</span><a name="LN3627"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fmt</span><span class='Delimiter'>; 
</span><a name="LN3628"></a>    <span class='Control'>struct</span> <a href="../../timezone/localtime.c.html#LN110"><span class='Ref_to_Global_Var'>tm</span></a>   <span class='Declare_Local'>crtm</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we haven't already read the header, do so. 
     * 
     * NB: this code must agree with _discoverArchiveFormat().  Maybe find a 
     * way to unify the cases? 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN237"><span class='Ref_to_Member'>readHeader</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3638"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>vmaj</span><span class='Delimiter'>, 
</span><a name="LN3639"></a>                    <span class='Declare_Local'>vmin</span><span class='Delimiter'>, 
</span><a name="LN3640"></a>                    <span class='Declare_Local'>vrev</span><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN254"><span class='Ref_to_Member'>ReadBufPtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3626"><span class='Ref_To_Local'>tmpMag</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3626"><span class='Ref_To_Local'>tmpMag</span></a><span class='Delimiter'>, </span><span class='String'>"PGDMP"</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"did not find magic string in file header\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN3638"><span class='Ref_To_Local'>vmaj</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN3639"><span class='Ref_To_Local'>vmin</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3638"><span class='Ref_To_Local'>vmaj</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3638"><span class='Ref_To_Local'>vmaj</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN3639"><span class='Ref_To_Local'>vmin</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span>        <span class='Comment_Single_Line'>/* Version &GT; 1.0 */ 
</span>            <a href="pg_backup_archiver.c.html#LN3640"><span class='Ref_To_Local'>vrev</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN3640"><span class='Ref_To_Local'>vrev</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN69"><span class='Ref_to_Macro'>MAKE_ARCHIVE_VERSION</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3638"><span class='Ref_To_Local'>vmaj</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3639"><span class='Ref_To_Local'>vmin</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3640"><span class='Ref_To_Local'>vrev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.h.html#LN76"><span class='Ref_to_Const'>K_VERS_1_0</span></a> <span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT; </span><a href="pg_backup_archiver.h.html#LN102"><span class='Ref_to_Const'>K_VERS_MAX</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported version (%d.%d) in file header\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN3638"><span class='Ref_To_Local'>vmaj</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3639"><span class='Ref_To_Local'>vmin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a> <span class='Operator'>&GT; </span><span class='Number'>32</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"sanity check on integer size (%lu) failed\n"</span><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a> <span class='Operator'>&GT; </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span> 
            <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"WARNING: archive was made on a machine with larger integers, some operations might fail\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN82"><span class='Ref_to_Const'>K_VERS_1_7</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN225"><span class='Ref_to_Member'>offSize</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN225"><span class='Ref_to_Member'>offSize</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN224"><span class='Ref_to_Member'>intSize</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN3627"><span class='Ref_To_Local'>fmt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN3627"><span class='Ref_To_Local'>fmt</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"expected format (%d) differs from format found in file (%d)\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN227"><span class='Ref_to_Member'>format</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3627"><span class='Ref_To_Local'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !AH-&GT;readHeader &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN77"><span class='Ref_to_Const'>K_VERS_1_2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.h.html#LN79"><span class='Ref_to_Const'>K_VERS_1_4</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN52"><span class='Ref_to_Const'>Z_DEFAULT_COMPRESSION</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifndef</span> HAVE_LIBZ 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"WARNING: archive is compressed, but this installation does not support compression -- no data will be available\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN79"><span class='Ref_to_Const'>K_VERS_1_4</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN3628"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_sec <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN3628"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_min <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN3628"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_hour <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN3628"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_mday <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN3628"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_mon <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN3628"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_year <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN3628"><span class='Ref_To_Local'>crtm</span></a><span class='Operator'>.</span>tm_isdst <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN280"><span class='Ref_to_Member'>archdbname</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN231"><span class='Ref_to_Member'>createDate</span></a> <span class='Operator'>= </span>mktime<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3628"><span class='Ref_To_Local'>crtm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN231"><span class='Ref_to_Member'>createDate</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span>time_t<span class='Parentheses'>) </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"WARNING: invalid creation date in header\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_archiver.h.html#LN89"><span class='Ref_to_Const'>K_VERS_1_10</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN217"><span class='Ref_to_Member'>archiveRemoteVersion</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN219"><span class='Ref_to_Member'>archiveDumpVersion</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3624"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ReadHead &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * checkSeek 
 *    check to see if ftell/fseek can be performed. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN3727"></a><span class='Declare_Function'>checkSeek</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>fp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3729"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Local'>tpos</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If pgoff_t is wider than long, we must have "real" fseeko and not an 
     * emulation using fseek.  Otherwise report no seek capability. 
     */ 
</span><span class='Directive'>#ifndef</span> HAVE_FSEEKO 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* Check that ftello works on this file */ 
</span>    <a href="pg_backup_archiver.c.html#LN3729"><span class='Ref_To_Local'>tpos</span></a> <span class='Operator'>= </span><a href="../../port/fseeko.c.html#LN73"><span class='Ref_to_Func'>ftello</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3727"><span class='Ref_to_Parameter'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3729"><span class='Ref_To_Local'>tpos</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that fseeko(SEEK_SET) works, too.  NB: we used to try to test 
     * this with fseeko(fp, 0, SEEK_CUR).  But some platforms treat that as a 
     * successful no-op even on files that are otherwise unseekable. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/fseeko.c.html#LN32"><span class='Ref_to_Func'>fseeko</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3727"><span class='Ref_to_Parameter'>fp</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3729"><span class='Ref_To_Local'>tpos</span></a><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end checkSeek &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * dumpTimestamp 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3761"></a><span class='Declare_Function'>dumpTimestamp</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span>time_t <span class='Declare_Parameter'>tim</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3763"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../backend/utils/adt/pg_locale.c.html#LN753"><span class='Ref_to_Macro'>strftime</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="dumputils.h.html#LN32"><span class='Ref_to_Const'>PGDUMP_STRFTIME_FMT</span></a><span class='Delimiter'>, </span>localtime<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3761"><span class='Ref_to_Parameter'>tim</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3761"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"-- %s %s\n\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3761"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Main engine for parallel restore. 
 * 
 * Work is done in three phases. 
 * First we process all SECTION_PRE_DATA tocEntries, in a single connection, 
 * just as for a standard restore.  Second we process the remaining non-ACL 
 * steps in parallel worker children (threads on Windows, processes on Unix), 
 * each of which connects separately to the database.  Finally we process all 
 * the ACL entries in a single connection (that happens back in 
 * RestoreArchive). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3781"></a><span class='Declare_Function'>restore_toc_entries_prefork</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3783"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>skipped_some</span><span class='Delimiter'>; 
</span><a name="LN3784"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>next_work_item</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"entering restore_toc_entries_prefork\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust dependency information */ 
</span>    <a href="pg_backup_archiver.c.html#LN106"><span class='Ref_to_Proto'>fix_dependencies</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do all the early stuff in a single connection in the parent. There's no 
     * great point in running it in parallel, in fact it will actually run 
     * faster in a single connection because we avoid all the connection and 
     * setup overhead.  Also, pre-9.2 pg_dump versions were not very good 
     * about showing all the dependencies of SECTION_PRE_DATA items, so we do 
     * not risk trying to process them out-of-order. 
     * 
     * Note: as of 9.2, it should be guaranteed that all PRE_DATA items appear 
     * before DATA items, and all DATA items before POST_DATA items.  That is 
     * not certain to be true in older archives, though, so this loop is coded 
     * to not assume it. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN3783"><span class='Ref_To_Local'>skipped_some</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* NB: process-or-continue logic must be the inverse of loop below */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>!= </span><a href="pg_backup.h.html#LN55"><span class='Ref_to_EnumConst'>SECTION_PRE_DATA</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* DATA and POST_DATA items are just ignored for now */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN56"><span class='Ref_to_EnumConst'>SECTION_DATA</span></a> <span class='Operator'>|| 
</span>                <a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN57"><span class='Ref_to_EnumConst'>SECTION_POST_DATA</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN3783"><span class='Ref_To_Local'>skipped_some</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * SECTION_NONE items, such as comments, can be processed now 
                 * if we are still in the PRE_DATA part of the archive.  Once 
                 * we've skipped any items, we have to consider whether the 
                 * comment's dependencies are satisfied, so skip it for now. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3783"><span class='Ref_To_Local'>skipped_some</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if next_work_item-&GT;secti... &raquo; </span> 
 
        <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"processing item %d %s %s\n"</span><span class='Delimiter'>, 
</span>              <a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, 
</span>              <a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN87"><span class='Ref_to_Proto'>restore_toc_entry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* there should be no touch of ready_list here, so pass NULL */ 
</span>        <a href="pg_backup_archiver.c.html#LN110"><span class='Ref_to_Proto'>reduce_dependencies</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3784"><span class='Ref_To_Local'>next_work_item</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for next_work_item=AH-&GT;to... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now close parent connection in prep for parallel steps.  We do this 
     * mainly to ensure that we don't exceed the specified number of parallel 
     * connections. 
     */ 
</span>    <a href="../scripts/vacuumdb.c.html#LN73"><span class='Ref_to_Proto'>DisconnectDatabase</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* blow away any transient state from the old connection */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN323"><span class='Ref_to_Member'>currWithOids</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end restore_toc_entries_prefork &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Main engine for parallel restore. 
 * 
 * Work is done in three phases. 
 * First we process all SECTION_PRE_DATA tocEntries, in a single connection, 
 * just as for a standard restore. This is done in restore_toc_entries_prefork(). 
 * Second we process the remaining non-ACL steps in parallel worker children 
 * (threads on Windows, processes on Unix), these fork off and set up their 
 * connections before we call restore_toc_entries_parallel_forked. 
 * Finally we process all the ACL entries in a single connection (that happens 
 * back in RestoreArchive). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3873"></a><span class='Declare_Function'>restore_toc_entries_parallel</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="parallel.h.html#LN39"><span class='Ref_to_Struct'>ParallelState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, 
</span><a name="LN3874"></a>                             <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pending_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3876"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>skipped_some</span><span class='Delimiter'>; 
</span><a name="LN3877"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>    <span class='Declare_Local'>ready_list</span><span class='Delimiter'>; 
</span><a name="LN3878"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>next_work_item</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"entering restore_toc_entries_parallel\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the lists of ready items, the list for pending items has 
     * already been initialized in the caller.  After this setup, the pending 
     * list is everything that needs to be done but is blocked by one or more 
     * dependencies, while the ready list contains items that have no 
     * remaining dependencies. Note: we don't yet filter out entries that 
     * aren't going to be restored. They might participate in dependency 
     * chains connecting entries that should be restored, so we treat them as 
     * live until we actually process them. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN92"><span class='Ref_to_Proto'>par_list_header_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3877"><span class='Ref_To_Local'>ready_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN3876"><span class='Ref_To_Local'>skipped_some</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* NB: process-or-continue logic must be the inverse of loop above */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN55"><span class='Ref_to_EnumConst'>SECTION_PRE_DATA</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* All PRE_DATA items were dealt with above */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN56"><span class='Ref_to_EnumConst'>SECTION_DATA</span></a> <span class='Operator'>|| 
</span>            <a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN57"><span class='Ref_to_EnumConst'>SECTION_POST_DATA</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* set this flag at same point that previous loop did */ 
</span>            <a href="pg_backup_archiver.c.html#LN3876"><span class='Ref_To_Local'>skipped_some</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* SECTION_NONE items must be processed if previous loop didn't */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_archiver.c.html#LN3876"><span class='Ref_To_Local'>skipped_some</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN369"><span class='Ref_to_Member'>depCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN93"><span class='Ref_to_Proto'>par_list_append</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3874"><span class='Ref_to_Parameter'>pending_list</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_archiver.c.html#LN93"><span class='Ref_to_Proto'>par_list_append</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3877"><span class='Ref_To_Local'>ready_list</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for next_work_item=AH-&GT;to... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * main parent loop 
     * 
     * Keep going until there is no worker still running AND there is no work 
     * left to be done. 
     */ 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"entering main parallel loop\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN95"><span class='Ref_to_Proto'>get_next_work_item</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3877"><span class='Ref_To_Local'>ready_list</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>           <span class='Operator'>!</span><a href="parallel.h.html#LN54"><span class='Ref_to_Proto'>IsEveryWorkerIdle</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* If not to be restored, don't waste time launching a worker */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN207"><span class='Ref_to_EnumConst'>REQ_SCHEMA</span></a> <span class='Operator'>| </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <a href="pg_backup_archiver.c.html#LN73"><span class='Ref_to_Proto'>_tocEntryIsACL</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"skipping item %d %s %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pg_backup_archiver.c.html#LN94"><span class='Ref_to_Proto'>par_list_remove</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_backup_archiver.c.html#LN110"><span class='Ref_to_Proto'>reduce_dependencies</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3877"><span class='Ref_To_Local'>ready_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"launching item %d %s %s\n"</span><span class='Delimiter'>, 
</span>                  <a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, 
</span>                  <a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_backup_archiver.c.html#LN94"><span class='Ref_to_Proto'>par_list_remove</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="parallel.h.html#LN59"><span class='Ref_to_Proto'>DispatchJobForTocEntry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN142"><span class='Ref_to_EnumConst'>ACT_RESTORE</span></a><span class='Delimiter'>, 
</span>                                   <a href="pg_backup_archiver.c.html#LN102"><span class='Ref_to_Proto'>mark_restore_job_done</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN3877"><span class='Ref_To_Local'>ready_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if next_work_item!=NULL &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* at least one child is working and we have nothing ready. */ 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Before dispatching another job, check to see if anything has 
         * finished.  We should check every time through the loop so as to 
         * reduce dependencies as soon as possible.  If we were unable to 
         * dispatch any job this time through, wait until some worker finishes 
         * (and, hopefully, unblocks some pending item).  If we did dispatch 
         * something, continue as soon as there's at least one idle worker. 
         * Note that in either case, there's guaranteed to be at least one 
         * idle worker when we return to the top of the loop.  This ensures we 
         * won't block inside DispatchJobForTocEntry, which would be 
         * undesirable: we'd rather postpone dispatching until we see what's 
         * been unblocked by finished jobs. 
         */ 
</span>        <a href="parallel.h.html#LN55"><span class='Ref_to_Proto'>WaitForWorkers</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, 
</span>                       <a href="pg_backup_archiver.c.html#LN3878"><span class='Ref_To_Local'>next_work_item</span></a> <span class='Operator'>? </span><a href="parallel.h.html#LN31"><span class='Ref_to_EnumConst'>WFW_ONE_IDLE</span></a> <span class='Operator'>: </span><a href="parallel.h.html#LN30"><span class='Ref_to_EnumConst'>WFW_GOT_STATUS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (next_work_item=get_n... &raquo; </span> 
 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3873"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"finished main parallel loop\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end restore_toc_entries_parallel &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3984"></a><span class='Declare_Function'>restore_toc_entries_postfork</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pending_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3986"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3984"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span><a name="LN3987"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3984"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"entering restore_toc_entries_postfork\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now reconnect the single parent connection. 
     */ 
</span>    <a href="pg_backup.h.html#LN239"><span class='Ref_to_Proto'>ConnectDatabase</span></a><span class='Parentheses'>((</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN3984"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3986"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN108"><span class='Ref_to_Member'>dbname</span></a><span class='Delimiter'>, 
</span>                    <a href="pg_backup_archiver.c.html#LN3986"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN110"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3986"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN109"><span class='Ref_to_Member'>pgport</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3986"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN111"><span class='Ref_to_Member'>username</span></a><span class='Delimiter'>, 
</span>                    <a href="pg_backup_archiver.c.html#LN3986"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN113"><span class='Ref_to_Member'>promptPassword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* re-establish fixed state */ 
</span>    <a href="pg_backup_archiver.c.html#LN62"><span class='Ref_to_Proto'>_doSetFixedOutputState</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3984"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure there is no non-ACL work left due to, say, circular 
     * dependencies, or some other pathological condition. If so, do it in the 
     * single parent connection. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3987"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3984"><span class='Ref_to_Parameter'>pending_list</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN3987"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN3984"><span class='Ref_to_Parameter'>pending_list</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN3987"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN3987"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3984"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"processing missed item %d %s %s\n"</span><span class='Delimiter'>, 
</span>              <a href="pg_backup_archiver.c.html#LN3987"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3987"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3987"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN87"><span class='Ref_to_Proto'>restore_toc_entry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN3984"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN3987"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* The ACLs will be handled back in RestoreArchive. */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end restore_toc_entries_postfork &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check if te1 has an exclusive lock requirement for an item that te2 also 
 * requires, whether or not te2's requirement is for an exclusive lock. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4021"></a><span class='Declare_Function'>has_lock_conflicts</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te1</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4023"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN4024"></a>                <span class='Declare_Local'>k</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4023"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4023"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN4021"><span class='Ref_to_Parameter'>te1</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN373"><span class='Ref_to_Member'>nLockDeps</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4023"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4024"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4024"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN4021"><span class='Ref_to_Parameter'>te2</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4024"><span class='Ref_To_Local'>k</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4021"><span class='Ref_to_Parameter'>te1</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN372"><span class='Ref_to_Member'>lockDeps</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4023"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="pg_backup_archiver.c.html#LN4021"><span class='Ref_to_Parameter'>te2</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4024"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Initialize the header of a parallel-processing list. 
 * 
 * These are circular lists with a dummy TocEntry as header, just like the 
 * main TOC list; but we use separate list links so that an entry can be in 
 * the main TOC list as well as in a parallel-processing list. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4046"></a><span class='Declare_Function'>par_list_header_init</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>l</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_backup_archiver.c.html#LN4046"><span class='Ref_to_Parameter'>l</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4046"><span class='Ref_to_Parameter'>l</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4046"><span class='Ref_to_Parameter'>l</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Append te to the end of the parallel-processing list headed by l */ 
</span><span class='Keyword'>static void 
</span><a name="LN4053"></a><span class='Declare_Function'>par_list_append</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>l</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_backup_archiver.c.html#LN4053"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4053"><span class='Ref_to_Parameter'>l</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4053"><span class='Ref_to_Parameter'>l</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4053"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4053"><span class='Ref_to_Parameter'>l</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4053"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4053"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4053"><span class='Ref_to_Parameter'>l</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Remove te from whatever parallel-processing list it's in */ 
</span><span class='Keyword'>static void 
</span><a name="LN4063"></a><span class='Declare_Function'>par_list_remove</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_backup_archiver.c.html#LN4063"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4063"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4063"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4063"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4063"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4063"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find the next work item (if any) that is capable of being run now. 
 * 
 * To qualify, the item must have no remaining dependencies 
 * and no requirements for locks that are incompatible with 
 * items currently running.  Items in the ready_list are known to have 
 * no remaining dependencies, but we have to check for lock conflicts. 
 * 
 * Note that the returned item has *not* been removed from ready_list. 
 * The caller must do that after successfully dispatching the item. 
 * 
 * pref_non_data is for an alternative selection algorithm that gives 
 * preference to non-data items if there is already a data load running. 
 * It is currently disabled. 
 */ 
</span><span class='Keyword'>static </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>* 
</span><a name="LN4088"></a><span class='Declare_Function'>get_next_work_item</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ready_list</span><span class='Delimiter'>, 
</span><a name="LN4089"></a>                   <a href="parallel.h.html#LN39"><span class='Ref_to_Struct'>ParallelState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4091"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>pref_non_data</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* or get from AH-&GT;ropt */ 
</span><a name="LN4092"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>data_te</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4093"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span><a name="LN4094"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN4095"></a>                <span class='Declare_Local'>k</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Bogus heuristics for pref_non_data 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4091"><span class='Ref_To_Local'>pref_non_data</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4102"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4095"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4095"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN4089"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="parallel.h.html#LN41"><span class='Ref_to_Member'>numWorkers</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4095"><span class='Ref_To_Local'>k</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4106"></a>            <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>running_te</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4089"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="parallel.h.html#LN43"><span class='Ref_to_Member'>te</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4095"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4106"><span class='Ref_To_Local'>running_te</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                <a href="pg_backup_archiver.c.html#LN4106"><span class='Ref_To_Local'>running_te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN56"><span class='Ref_to_EnumConst'>SECTION_DATA</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_archiver.c.html#LN4102"><span class='Ref_To_Local'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4089"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="parallel.h.html#LN41"><span class='Ref_to_Member'>numWorkers</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pg_backup_archiver.c.html#LN4102"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>* </span><span class='Number'>4</span> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN4089"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="parallel.h.html#LN41"><span class='Ref_to_Member'>numWorkers</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN4091"><span class='Ref_To_Local'>pref_non_data</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Search the ready_list until we find a suitable item. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4093"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4088"><span class='Ref_to_Parameter'>ready_list</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4093"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN4088"><span class='Ref_to_Parameter'>ready_list</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4093"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4093"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4121"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>conflicts</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check to see if the item would need exclusive lock on something 
         * that a currently running item also needs lock on, or vice versa. If 
         * so, we don't want to schedule them together. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4094"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4094"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN4089"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="parallel.h.html#LN41"><span class='Ref_to_Member'>numWorkers</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4094"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4130"></a>            <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>running_te</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4089"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="parallel.h.html#LN43"><span class='Ref_to_Member'>te</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4094"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4130"><span class='Ref_To_Local'>running_te</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN107"><span class='Ref_to_Proto'>has_lock_conflicts</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4093"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4130"><span class='Ref_To_Local'>running_te</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <a href="pg_backup_archiver.c.html#LN107"><span class='Ref_to_Proto'>has_lock_conflicts</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4130"><span class='Ref_To_Local'>running_te</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4093"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN4121"><span class='Ref_To_Local'>conflicts</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4121"><span class='Ref_To_Local'>conflicts</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4091"><span class='Ref_To_Local'>pref_non_data</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN4093"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN56"><span class='Ref_to_EnumConst'>SECTION_DATA</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4092"><span class='Ref_To_Local'>data_te</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_archiver.c.html#LN4092"><span class='Ref_To_Local'>data_te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4093"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* passed all tests, so this item can run */ 
</span>        <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN4093"><span class='Ref_To_Local'>te</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for te=ready_list-&GT;par_ne... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4092"><span class='Ref_To_Local'>data_te</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN4092"><span class='Ref_To_Local'>data_te</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4088"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"no item ready\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_next_work_item &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Restore a single TOC item in parallel with others 
 * 
 * this is run in the worker, i.e. in a thread (Windows) or a separate process 
 * (everything else). A worker process executes several such work items during 
 * a parallel backup or restore. Once we terminate here and report back that 
 * our work is finished, the master process will assign us a new work item. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN4173"></a><span class='Declare_Function'>parallel_restore</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4175"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4173"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Count only errors associated with this TOC entry */ 
</span>    <a href="pg_backup_archiver.c.html#LN4173"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN201"><span class='Ref_to_Member'>n_errors</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Restore the TOC item */ 
</span>    <a href="pg_backup_archiver.c.html#LN4175"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN87"><span class='Ref_to_Proto'>restore_toc_entry</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4173"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4173"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN4175"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Callback function that's invoked in the master process after a step has 
 * been parallel restored. 
 * 
 * Update status and reduce the dependency count of any dependent items. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4196"></a><span class='Declare_Function'>mark_restore_job_done</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, 
</span><a name="LN4197"></a>                      <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, 
</span><a name="LN4198"></a>                      <span class='Keyword'>int </span><span class='Declare_Parameter'>status</span><span class='Delimiter'>, 
</span><a name="LN4199"></a>                      <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>callback_data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4201"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ready_list</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN4199"><span class='Ref_to_Parameter'>callback_data</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4196"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"finished item %d %s %s\n"</span><span class='Delimiter'>, 
</span>          <a href="pg_backup_archiver.c.html#LN4197"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4197"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4197"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4198"><span class='Ref_to_Parameter'>status</span></a> <span class='Operator'>== </span><a href="pg_backup_archiver.h.html#LN115"><span class='Ref_to_Const'>WORKER_CREATE_DONE</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN112"><span class='Ref_to_Proto'>mark_create_done</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4196"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4197"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4198"><span class='Ref_to_Parameter'>status</span></a> <span class='Operator'>== </span><a href="pg_backup_archiver.h.html#LN116"><span class='Ref_to_Const'>WORKER_INHIBIT_DATA</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN113"><span class='Ref_to_Proto'>inhibit_data_for_failed_table</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4196"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4197"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN4196"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN201"><span class='Ref_to_Member'>n_errors</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4198"><span class='Ref_to_Parameter'>status</span></a> <span class='Operator'>== </span><a href="pg_backup_archiver.h.html#LN117"><span class='Ref_to_Const'>WORKER_IGNORED_ERRORS</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN4196"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN201"><span class='Ref_to_Member'>n_errors</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4198"><span class='Ref_to_Parameter'>status</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"worker process failed: exit code %d\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN4198"><span class='Ref_to_Parameter'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN110"><span class='Ref_to_Proto'>reduce_dependencies</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4196"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4197"><span class='Ref_to_Parameter'>te</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4201"><span class='Ref_To_Local'>ready_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end mark_restore_job_done &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Process the dependency information into a form useful for parallel restore. 
 * 
 * This function takes care of fixing up some missing or badly designed 
 * dependencies, and then prepares subsidiary data structures that will be 
 * used in the main parallel-restore logic, including: 
 * 1. We build the revDeps[] arrays of incoming dependency dumpIds. 
 * 2. We set up depCount fields that are the number of as-yet-unprocessed 
 * dependencies for each TOC entry. 
 * 
 * We also identify locking dependencies so that we can avoid trying to 
 * schedule conflicting items at the same time. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4237"></a><span class='Declare_Function'>fix_dependencies</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4239"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span><a name="LN4240"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the depCount/revDeps/nRevDeps fields, and make sure the TOC 
     * items are marked as not being in any parallel-processing list. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN369"><span class='Ref_to_Member'>depCount</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN370"><span class='Ref_to_Member'>revDeps</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN371"><span class='Ref_to_Member'>nRevDeps</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN368"><span class='Ref_to_Member'>par_next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * POST_DATA items that are shown as depending on a table need to be 
     * re-pointed to depend on that table's data, instead.  This ensures they 
     * won't get scheduled until the data has been loaded. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN108"><span class='Ref_to_Proto'>repoint_table_dependencies</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pre-8.4 versions of pg_dump neglected to set up a dependency from BLOB 
     * COMMENTS to BLOBS.  Cope.  (We assume there's only one BLOBS and only 
     * one BLOB COMMENTS in such files.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.h.html#LN90"><span class='Ref_to_Const'>K_VERS_1_11</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOB COMMENTS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><a name="LN4273"></a>                <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te2</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4273"><span class='Ref_To_Local'>te2</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4273"><span class='Ref_To_Local'>te2</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4273"><span class='Ref_To_Local'>te2</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4273"><span class='Ref_To_Local'>te2</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4273"><span class='Ref_To_Local'>te2</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOBS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4273"><span class='Ref_To_Local'>te2</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>; 
</span>                        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN369"><span class='Ref_to_Member'>depCount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for te=AH-&GT;toc-&GT;next;te!=... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if AH-&GT;version&LT;K_VERS_1_... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * At this point we start to build the revDeps reverse-dependency arrays, 
     * so all changes of dependencies must be complete. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Count the incoming dependencies for each item.  Also, it is possible 
     * that the dependencies list items that are not in the archive at all 
     * (that should not happen in 9.2 and later, but is highly likely in older 
     * archives).  Subtract such items from the depCounts. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4240"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4240"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4240"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4306"></a>            <a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a>      <span class='Declare_Local'>depid</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4240"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4306"><span class='Ref_To_Local'>depid</span></a> <span class='Operator'>&LT;= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4306"><span class='Ref_To_Local'>depid</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4306"><span class='Ref_To_Local'>depid</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN371"><span class='Ref_to_Member'>nRevDeps</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN369"><span class='Ref_to_Member'>depCount</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate space for revDeps[] arrays, and reset nRevDeps so we can use 
     * it as a counter below. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN371"><span class='Ref_to_Member'>nRevDeps</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN370"><span class='Ref_to_Member'>revDeps</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN371"><span class='Ref_to_Member'>nRevDeps</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN371"><span class='Ref_to_Member'>nRevDeps</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build the revDeps[] arrays of incoming-dependency dumpIds.  This had 
     * better agree with the loops above. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4240"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4240"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4240"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4334"></a>            <a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a>      <span class='Declare_Local'>depid</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4240"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4334"><span class='Ref_To_Local'>depid</span></a> <span class='Operator'>&LT;= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4334"><span class='Ref_To_Local'>depid</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4338"></a>                <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>otherte</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4334"><span class='Ref_To_Local'>depid</span></a><span class='Delimiter'>]; 
</span> 
                <a href="pg_backup_archiver.c.html#LN4338"><span class='Ref_To_Local'>otherte</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN370"><span class='Ref_to_Member'>revDeps</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4338"><span class='Ref_To_Local'>otherte</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN371"><span class='Ref_to_Member'>nRevDeps</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lastly, work out the locking dependencies. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN372"><span class='Ref_to_Member'>lockDeps</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN373"><span class='Ref_to_Member'>nLockDeps</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN109"><span class='Ref_to_Proto'>identify_locking_dependencies</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4237"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4239"><span class='Ref_To_Local'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end fix_dependencies &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change dependencies on table items to depend on table data items instead, 
 * but only in POST_DATA items. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4361"></a><span class='Declare_Function'>repoint_table_dependencies</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4363"></a>    <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>te</span><span class='Delimiter'>; 
</span><a name="LN4364"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4365"></a>    <a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a>      <span class='Declare_Local'>olddep</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4363"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4361"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4363"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>!= </span><a href="pg_backup_archiver.c.html#LN4361"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN302"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4363"><span class='Ref_To_Local'>te</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4363"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN339"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4363"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN342"><span class='Ref_to_Member'>section</span></a> <span class='Operator'>!= </span><a href="pg_backup.h.html#LN57"><span class='Ref_to_EnumConst'>SECTION_POST_DATA</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4364"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4364"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN4363"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4364"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_archiver.c.html#LN4365"><span class='Ref_To_Local'>olddep</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4363"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4364"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4365"><span class='Ref_To_Local'>olddep</span></a> <span class='Operator'>&LT;= </span><a href="pg_backup_archiver.c.html#LN4361"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a> <span class='Operator'>&& 
</span>                <a href="pg_backup_archiver.c.html#LN4361"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN308"><span class='Ref_to_Member'>tableDataId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4365"><span class='Ref_To_Local'>olddep</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN4363"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4364"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4361"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN308"><span class='Ref_to_Member'>tableDataId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4365"><span class='Ref_To_Local'>olddep</span></a><span class='Delimiter'>]; 
</span>                <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4361"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"transferring dependency %d -&GT; %d to %d\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_archiver.c.html#LN4363"><span class='Ref_To_Local'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4365"><span class='Ref_To_Local'>olddep</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4361"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN308"><span class='Ref_to_Member'>tableDataId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4365"><span class='Ref_To_Local'>olddep</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end repoint_table_dependencies &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Identify which objects we'll need exclusive lock on in order to restore 
 * the given TOC entry (*other* than the one identified by the TOC entry 
 * itself).  Record their dump IDs in the entry's lockDeps[] array. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4391"></a><span class='Declare_Function'>identify_locking_dependencies</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4393"></a>    <a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>lockids</span><span class='Delimiter'>; 
</span><a name="LN4394"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nlockids</span><span class='Delimiter'>; 
</span><a name="LN4395"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick exit if no dependencies at all */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Exit if this entry doesn't need exclusive lock on other objects */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>          strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"CHECK CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>          strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"FK CONSTRAINT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>          strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"RULE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>          strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TRIGGER"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We assume the entry requires exclusive lock on each TABLE or TABLE DATA 
     * item listed among its dependencies.  Originally all of these would have 
     * been TABLE items, but repoint_table_dependencies would have repointed 
     * them to the TABLE DATA items if those are present (which they might not 
     * be, eg in a schema-only dump).  Note that all of the entries we are 
     * processing here are POST_DATA; otherwise there might be a significant 
     * difference between a dependency on a table and a dependency on its 
     * data, so that closer analysis would be needed here. 
     */ 
</span>    <a href="pg_backup_archiver.c.html#LN4393"><span class='Ref_To_Local'>lockids</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4394"><span class='Ref_To_Local'>nlockids</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4395"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4395"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN356"><span class='Ref_to_Member'>nDeps</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4395"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4423"></a>        <a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a>      <span class='Declare_Local'>depid</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN355"><span class='Ref_to_Member'>dependencies</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4395"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4423"><span class='Ref_To_Local'>depid</span></a> <span class='Operator'>&LT;= </span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN304"><span class='Ref_to_Member'>maxDumpId</span></a> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4423"><span class='Ref_To_Local'>depid</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>            <span class='Parentheses'>((</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4423"><span class='Ref_To_Local'>depid</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE DATA"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>             strcmp<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4423"><span class='Ref_To_Local'>depid</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <a href="pg_backup_archiver.c.html#LN4393"><span class='Ref_To_Local'>lockids</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4394"><span class='Ref_To_Local'>nlockids</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4423"><span class='Ref_To_Local'>depid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4394"><span class='Ref_To_Local'>nlockids</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4393"><span class='Ref_To_Local'>lockids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN372"><span class='Ref_to_Member'>lockDeps</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN28"><span class='Ref_to_Proto'>pg_realloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4393"><span class='Ref_To_Local'>lockids</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4394"><span class='Ref_To_Local'>nlockids</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN229"><span class='Ref_to_Typedef'>DumpId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4391"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN373"><span class='Ref_to_Member'>nLockDeps</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4394"><span class='Ref_To_Local'>nlockids</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end identify_locking_dependencies &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Remove the specified TOC entry from the depCounts of items that depend on 
 * it, thereby possibly making them ready-to-run.  Any pending item that 
 * becomes ready should be moved to the ready list. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4447"></a><span class='Declare_Function'>reduce_dependencies</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ready_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4449"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4447"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"reducing dependencies for %d\n"</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4447"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4449"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4449"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.c.html#LN4447"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN371"><span class='Ref_to_Member'>nRevDeps</span></a><span class='Delimiter'>; </span><a href="pg_backup_archiver.c.html#LN4449"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4455"></a>        <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>otherte</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4447"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4447"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN370"><span class='Ref_to_Member'>revDeps</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4449"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]]; 
</span> 
        <a href="pg_backup_archiver.c.html#LN4455"><span class='Ref_To_Local'>otherte</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN369"><span class='Ref_to_Member'>depCount</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4455"><span class='Ref_To_Local'>otherte</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN369"><span class='Ref_to_Member'>depCount</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_backup_archiver.c.html#LN4455"><span class='Ref_To_Local'>otherte</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN367"><span class='Ref_to_Member'>par_prev</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* It must be in the pending list, so remove it ... */ 
</span>            <a href="pg_backup_archiver.c.html#LN94"><span class='Ref_to_Proto'>par_list_remove</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4455"><span class='Ref_To_Local'>otherte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* ... and add to ready_list */ 
</span>            <a href="pg_backup_archiver.c.html#LN93"><span class='Ref_to_Proto'>par_list_append</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4447"><span class='Ref_to_Parameter'>ready_list</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4455"><span class='Ref_To_Local'>otherte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end reduce_dependencies &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Set the created flag on the DATA member corresponding to the given 
 * TABLE member 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4473"></a><span class='Declare_Function'>mark_create_done</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4473"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN308"><span class='Ref_to_Member'>tableDataId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4473"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4477"></a>        <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ted</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4473"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4473"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN308"><span class='Ref_to_Member'>tableDataId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4473"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>]]; 
</span> 
        <a href="pg_backup_archiver.c.html#LN4477"><span class='Ref_To_Local'>ted</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN364"><span class='Ref_to_Member'>created</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Mark the DATA member corresponding to the given TABLE member 
 * as not wanted 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4488"></a><span class='Declare_Function'>inhibit_data_for_failed_table</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4488"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"table \"%s\" could not be created, will not restore its data\n"</span><span class='Delimiter'>, 
</span>          <a href="pg_backup_archiver.c.html#LN4488"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN345"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4488"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN308"><span class='Ref_to_Member'>tableDataId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4488"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4495"></a>        <a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ted</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4488"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN307"><span class='Ref_to_Member'>tocsByDumpId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4488"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN308"><span class='Ref_to_Member'>tableDataId</span></a><span class='Delimiter'>[</span><a href="pg_backup_archiver.c.html#LN4488"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Delimiter'>]]; 
</span> 
        <a href="pg_backup_archiver.c.html#LN4495"><span class='Ref_To_Local'>ted</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN363"><span class='Ref_to_Member'>reqs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Clone and de-clone routines used in parallel restoration. 
 * 
 * Enough of the structure is cloned to ensure that there is no 
 * conflict between different threads each with their own clone. 
 */ 
</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>* 
</span><a name="LN4508"></a><span class='Declare_Function'>CloneArchive</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4510"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Local'>clone</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a "flat" copy */ 
</span>    <a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4508"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Handle format-independent fields */ 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN229"><span class='Ref_to_Member'>sqlparse</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN229"><span class='Ref_to_Member'>sqlparse</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* The clone will have its own connection, so disregard connection state */ 
</span>    <a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN286"><span class='Ref_to_Member'>connCancel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN323"><span class='Ref_to_Member'>currWithOids</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* savedPassword must be local in case we change it while connecting */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN282"><span class='Ref_to_Member'>savedPassword</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN282"><span class='Ref_to_Member'>savedPassword</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN282"><span class='Ref_to_Member'>savedPassword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* clone has its own error count, too */ 
</span>    <a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN201"><span class='Ref_to_Member'>n_errors</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Connect our new clone object to the database: In parallel restore the 
     * parent is already disconnected, because we can connect the worker 
     * processes independently to the database (no snapshot sync required). In 
     * parallel backup we clone the parent's existing connection. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4508"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN316"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN49"><span class='Ref_to_EnumConst'>archModeRead</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4542"></a>        <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span> <span class='Operator'>= </span><a href="pg_backup_archiver.c.html#LN4508"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4508"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* this also sets clone-&GT;connection */ 
</span>        <a href="pg_backup.h.html#LN239"><span class='Ref_to_Proto'>ConnectDatabase</span></a><span class='Parentheses'>((</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4542"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN108"><span class='Ref_to_Member'>dbname</span></a><span class='Delimiter'>, 
</span>                        <a href="pg_backup_archiver.c.html#LN4542"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN110"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4542"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN109"><span class='Ref_to_Member'>pgport</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4542"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN111"><span class='Ref_to_Member'>username</span></a><span class='Delimiter'>, 
</span>                        <a href="pg_backup_archiver.c.html#LN4542"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN113"><span class='Ref_to_Member'>promptPassword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* re-establish fixed state */ 
</span>        <a href="pg_backup_archiver.c.html#LN62"><span class='Ref_to_Proto'>_doSetFixedOutputState</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4556"></a>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>connstr</span><span class='Delimiter'>; 
</span><a name="LN4557"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pghost</span><span class='Delimiter'>; 
</span><a name="LN4558"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pgport</span><span class='Delimiter'>; 
</span><a name="LN4559"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>username</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4508"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Even though we are technically accessing the parent's database 
         * object here, these functions are fine to be called like that 
         * because all just return a pointer and do not actually send/receive 
         * any data to/from the database. 
         */ 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN4556"><span class='Ref_To_Local'>connstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN4556"><span class='Ref_To_Local'>connstr</span></a><span class='Delimiter'>, </span><span class='String'>"dbname="</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fe_utils/string_utils.h.html#LN45"><span class='Ref_to_Proto'>appendConnStrVal</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN4556"><span class='Ref_To_Local'>connstr</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN310"><span class='Ref_to_Proto'>PQdb</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4508"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN4557"><span class='Ref_To_Local'>pghost</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN313"><span class='Ref_to_Proto'>PQhost</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4508"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN4558"><span class='Ref_To_Local'>pgport</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN314"><span class='Ref_to_Proto'>PQport</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4508"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN4559"><span class='Ref_To_Local'>username</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN311"><span class='Ref_to_Proto'>PQuser</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4508"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* this also sets clone-&GT;connection */ 
</span>        <a href="pg_backup.h.html#LN239"><span class='Ref_to_Proto'>ConnectDatabase</span></a><span class='Parentheses'>((</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4556"><span class='Ref_To_Local'>connstr</span></a><span class='Operator'>.</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                        <a href="pg_backup_archiver.c.html#LN4557"><span class='Ref_To_Local'>pghost</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4558"><span class='Ref_To_Local'>pgport</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.c.html#LN4559"><span class='Ref_To_Local'>username</span></a><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN32"><span class='Ref_to_EnumConst'>TRI_NO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_archiver.c.html#LN4556"><span class='Ref_To_Local'>connstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* setupDumpWorker will fix up connection state */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Let the format-specific code have a chance too */ 
</span>    <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN274"><span class='Ref_to_Member'>ClonePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_backup_archiver.c.html#LN4510"><span class='Ref_To_Local'>clone</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CloneArchive &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Release clone-local storage. 
 * 
 * Note: we assume any clone-local connection was already closed. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4597"></a><span class='Declare_Function'>DeCloneArchive</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Should not have an open database connection */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN284"><span class='Ref_to_Member'>connection</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clear format-specific state */ 
</span>    <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN275"><span class='Ref_to_Member'>DeClonePtr</span></a><span class='Parentheses'>) (</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clear state allocated by CloneArchive */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN229"><span class='Ref_to_Member'>sqlparse</span></a><span class='Operator'>.</span><a href="pg_backup_archiver.h.html#LN187"><span class='Ref_to_Member'>curCmd</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN229"><span class='Ref_to_Member'>sqlparse</span></a><span class='Operator'>.</span><a href="pg_backup_archiver.h.html#LN187"><span class='Ref_to_Member'>curCmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clear any connection-local state */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN320"><span class='Ref_to_Member'>currUser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN321"><span class='Ref_to_Member'>currSchema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN322"><span class='Ref_to_Member'>currTablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN282"><span class='Ref_to_Member'>savedPassword</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN282"><span class='Ref_to_Member'>savedPassword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.c.html#LN4597"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DeCloneArchive &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>