<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_dump\pg_backup_custom.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_dump\pg_backup_custom.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:00 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_backup_custom.c 
 * 
 *  Implements the custom output format. 
 * 
 *  The comments with the routined in this code are a good place to 
 *  understand how to write a new format. 
 * 
 *  See the headers to pg_restore for more details. 
 * 
 * Copyright (c) 2000, Philip Warner 
 *      Rights are granted to use this software in any way so long 
 *      as this notice is not removed. 
 * 
 *  The author is not responsible for loss or damages that may 
 *  and any liability will be limited to the time taken to fix any 
 *  related bug. 
 * 
 * 
 * IDENTIFICATION 
 *      src/bin/pg_dump/pg_backup_custom.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"compress_io.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parallel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_backup_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/file_utils.h"</span> 
 
<span class='Comment_Multi_Line'>/*-------- 
 * Routines in the format interface 
 *-------- 
 */ 
</span> 
<a name="LN37"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_ArchiveEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN38"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_StartData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN39"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_WriteData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>dLen</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN40"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_EndData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN41"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>_WriteByte</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const int </span><span class='Declare_Parameter'>i</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN42"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>_ReadByte</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>ArchiveHandle</span> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_WriteBuf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN44"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_ReadBuf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN45"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_CloseArchive</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN46"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_ReopenArchive</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_PrintTocData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN48"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_WriteExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN49"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_ReadExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN50"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_PrintExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN52"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_PrintData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN53"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_skipData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_skipBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN56"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_StartBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN57"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_StartBlob</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN58"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_EndBlob</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN59"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_EndBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN60"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_LoadBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>drop</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN61"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_Clone</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN62"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_DeClone</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN64"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>_WorkerJobRestoreCustom</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN68"></a>    <a href="compress_io.c.html#LN64"><span class='Ref_to_Struct'>CompressorState</span></a> <span class='Operator'>*</span><span class='Declare_Member'>cs</span><span class='Delimiter'>; 
</span><a name="LN69"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>hasSeek</span><span class='Delimiter'>; 
</span><a name="LN70"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Member'>filePos</span><span class='Delimiter'>; 
</span><a name="LN71"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Member'>dataStart</span><span class='Delimiter'>; 
</span><a name="LN72"></a>} <span class='Declare_Typedef'>lclContext</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN76"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>dataState</span><span class='Delimiter'>; 
</span><a name="LN77"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Member'>dataPos</span><span class='Delimiter'>; 
</span><a name="LN78"></a>} <span class='Declare_Typedef'>lclTocEntry</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/*------ 
 * Static declarations 
 *------ 
 */ 
</span><a name="LN85"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_readBlockHeader</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>type</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>id</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN86"></a><span class='Keyword'>static </span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a> <span class='Declare_Prototype'>_getFilePos</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN88"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_CustomWriteFunc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static </span>size_t <span class='Declare_Prototype'>_CustomReadFunc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Operator'>*</span><span class='Declare_Parameter'>buflen</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* translator: this is a module name */ 
</span><a name="LN92"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>modulename</span> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"custom archiver"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  Init routine required by ALL formats. This is a global routine 
 *  and should be declared in pg_backup_archiver.h 
 * 
 *  It's task is to create any extra archive context (using AH-&GT;formatData), 
 *  and to initialize the supported function pointers. 
 * 
 *  It should also prepare whatever it's input source is for reading/writing, 
 *  and in the case of a read mode connection, it should load the Header & TOC. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN107"></a><span class='Declare_Function'>InitArchiveFmt_Custom</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN109"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assuming static functions, this can be copied for each format. */ 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN244"><span class='Ref_to_Member'>ArchiveEntryPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN37"><span class='Ref_to_Proto'>_ArchiveEntry</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN246"><span class='Ref_to_Member'>StartDataPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN38"><span class='Ref_to_Proto'>_StartData</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN248"><span class='Ref_to_Member'>WriteDataPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN31"><span class='Ref_to_Proto'>_WriteData</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN250"><span class='Ref_to_Member'>EndDataPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN33"><span class='Ref_to_Proto'>_EndData</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN34"><span class='Ref_to_Proto'>_WriteByte</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN42"><span class='Ref_to_Proto'>_ReadByte</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN253"><span class='Ref_to_Member'>WriteBufPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN35"><span class='Ref_to_Proto'>_WriteBuf</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN254"><span class='Ref_to_Member'>ReadBufPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN44"><span class='Ref_to_Proto'>_ReadBuf</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN255"><span class='Ref_to_Member'>ClosePtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN36"><span class='Ref_to_Proto'>_CloseArchive</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN256"><span class='Ref_to_Member'>ReopenPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN46"><span class='Ref_to_Proto'>_ReopenArchive</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN263"><span class='Ref_to_Member'>PrintTocDataPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN37"><span class='Ref_to_Proto'>_PrintTocData</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN260"><span class='Ref_to_Member'>ReadExtraTocPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN49"><span class='Ref_to_Proto'>_ReadExtraToc</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN257"><span class='Ref_to_Member'>WriteExtraTocPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN48"><span class='Ref_to_Proto'>_WriteExtraToc</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN262"><span class='Ref_to_Member'>PrintExtraTocPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN50"><span class='Ref_to_Proto'>_PrintExtraToc</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN265"><span class='Ref_to_Member'>StartBlobsPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN38"><span class='Ref_to_Proto'>_StartBlobs</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN267"><span class='Ref_to_Member'>StartBlobPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN39"><span class='Ref_to_Proto'>_StartBlob</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN268"><span class='Ref_to_Member'>EndBlobPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN40"><span class='Ref_to_Proto'>_EndBlob</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN266"><span class='Ref_to_Member'>EndBlobsPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN41"><span class='Ref_to_Proto'>_EndBlobs</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN274"><span class='Ref_to_Member'>ClonePtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN61"><span class='Ref_to_Proto'>_Clone</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN275"><span class='Ref_to_Member'>DeClonePtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN62"><span class='Ref_to_Proto'>_DeClone</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* no parallel dump in the custom archive, only parallel restore */ 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN271"><span class='Ref_to_Member'>WorkerJobDumpPtr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN272"><span class='Ref_to_Member'>WorkerJobRestorePtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN64"><span class='Ref_to_Proto'>_WorkerJobRestoreCustom</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up a private area. */ 
</span>    <a href="pg_backup_custom.c.html#LN109"><span class='Ref_To_Local'>ctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN109"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize LO buffering */ 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN327"><span class='Ref_to_Member'>lo_buf_size</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN34"><span class='Ref_to_Const'>LOBBUFSIZE</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN325"><span class='Ref_to_Member'>lo_buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN34"><span class='Ref_to_Const'>LOBBUFSIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN109"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now open the file 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN316"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN48"><span class='Ref_to_EnumConst'>archModeWrite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open output file \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span>stdout<span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open output file: %s\n"</span><span class='Delimiter'>, 
</span>                              <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_backup_custom.c.html#LN109"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN69"><span class='Ref_to_Member'>hasSeek</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN394"><span class='Ref_to_Proto'>checkSeek</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open input file \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span>stdin<span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open input file: %s\n"</span><span class='Delimiter'>, 
</span>                              <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_backup_custom.c.html#LN109"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN69"><span class='Ref_to_Member'>hasSeek</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN394"><span class='Ref_to_Proto'>checkSeek</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.h.html#LN384"><span class='Ref_to_Proto'>ReadHead</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN386"><span class='Ref_to_Proto'>ReadToc</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_custom.c.html#LN109"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN71"><span class='Ref_to_Member'>dataStart</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN86"><span class='Ref_to_Proto'>_getFilePos</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN107"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN109"><span class='Ref_To_Local'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end InitArchiveFmt_Custom &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Called by the Archiver when the dumper creates a new TOC entry. 
 * 
 * Optional. 
 * 
 * Set up extract format-related TOC data. 
*/ 
</span><span class='Keyword'>static void 
</span><a name="LN204"></a><span class='Declare_Function'>_ArchiveEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN206"></a>    <a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN206"><span class='Ref_To_Local'>ctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN204"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN358"><span class='Ref_to_Member'>dataDumper</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_custom.c.html#LN206"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN76"><span class='Ref_to_Member'>dataState</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN106"><span class='Ref_to_Const'>K_OFFSET_POS_NOT_SET</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_custom.c.html#LN206"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN76"><span class='Ref_to_Member'>dataState</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN108"><span class='Ref_to_Const'>K_OFFSET_NO_DATA</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN204"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN206"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the Archiver to save any extra format-related TOC entry 
 * data. 
 * 
 * Optional. 
 * 
 * Use the Archiver routines to write data - they are non-endian, and 
 * maintain other important file information. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN227"></a><span class='Declare_Function'>_WriteExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN229"></a>    <a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN227"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.h.html#LN412"><span class='Ref_to_Proto'>WriteOffset</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN227"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN229"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN77"><span class='Ref_to_Member'>dataPos</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN229"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN76"><span class='Ref_to_Member'>dataState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the Archiver to read any extra format-related TOC data. 
 * 
 * Optional. 
 * 
 * Needs to match the order defined in _WriteExtraToc, and should also 
 * use the Archiver input routines. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN243"></a><span class='Declare_Function'>_ReadExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN245"></a>    <a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN243"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN245"><span class='Ref_To_Local'>ctx</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_custom.c.html#LN245"><span class='Ref_To_Local'>ctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_custom.c.html#LN243"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN245"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_custom.c.html#LN245"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN76"><span class='Ref_to_Member'>dataState</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN411"><span class='Ref_to_Proto'>ReadOffset</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN243"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN245"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN77"><span class='Ref_to_Member'>dataPos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prior to V1.7 (pg7.3), we dumped the data size as an int now we don't 
     * dump it at all. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN243"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.h.html#LN82"><span class='Ref_to_Const'>K_VERS_1_7</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN243"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _ReadExtraToc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Called by the Archiver when restoring an archive to output a comment 
 * that includes useful information about the TOC entry. 
 * 
 * Optional. 
 * 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN271"></a><span class='Declare_Function'>_PrintExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN273"></a>    <a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN271"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN271"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN182"><span class='Ref_to_Member'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN271"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"-- Data Pos: "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>"\n"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN273"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN77"><span class='Ref_to_Member'>dataPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the archiver when saving TABLE DATA (not schema). This routine 
 * should save whatever format-specific information is needed to read 
 * the archive back. 
 * 
 * It is called just prior to the dumper's 'DataDumper' routine being called. 
 * 
 * Optional, but strongly recommended. 
 * 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN291"></a><span class='Declare_Function'>_StartData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN293"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN291"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN294"></a>    <a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN291"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN294"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN77"><span class='Ref_to_Member'>dataPos</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN86"><span class='Ref_to_Proto'>_getFilePos</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN291"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN293"><span class='Ref_To_Local'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN294"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN76"><span class='Ref_to_Member'>dataState</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN107"><span class='Ref_to_Const'>K_OFFSET_POS_SET</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_null.c.html#LN34"><span class='Ref_to_Proto'>_WriteByte</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN291"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN65"><span class='Ref_to_Const'>BLK_DATA</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* Block type */ 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN291"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN291"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* For sanity check */ 
</span> 
    <a href="pg_backup_custom.c.html#LN293"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN68"><span class='Ref_to_Member'>cs</span></a> <span class='Operator'>= </span><a href="compress_io.h.html#LN48"><span class='Ref_to_Proto'>AllocateCompressor</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN291"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN88"><span class='Ref_to_Proto'>_CustomWriteFunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by archiver when dumper calls WriteData. This routine is 
 * called for both BLOB and TABLE data; it is the responsibility of 
 * the format to manage each kind of data using StartBlob/StartData. 
 * 
 * It should only be called from within a DataDumper routine. 
 * 
 * Mandatory. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN315"></a><span class='Declare_Function'>_WriteData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>dLen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN317"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN315"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN318"></a>    <a href="compress_io.c.html#LN64"><span class='Ref_to_Struct'>CompressorState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cs</span> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN317"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN68"><span class='Ref_to_Member'>cs</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN315"><span class='Ref_to_Parameter'>dLen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Comment_Multi_Line'>/* WriteDataToArchive() internally throws write errors */ 
</span>        <a href="compress_io.h.html#LN51"><span class='Ref_to_Proto'>WriteDataToArchive</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN315"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN318"><span class='Ref_To_Local'>cs</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN315"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN315"><span class='Ref_to_Parameter'>dLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the archiver when a dumper's 'DataDumper' routine has 
 * finished. 
 * 
 * Optional. 
 * 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN335"></a><span class='Declare_Function'>_EndData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN337"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN335"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <a href="compress_io.h.html#LN53"><span class='Ref_to_Proto'>EndCompressor</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN335"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN337"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN68"><span class='Ref_to_Member'>cs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Send the end marker */ 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN335"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the archiver when starting to save all BLOB DATA (not schema). 
 * This routine should save whatever format-specific information is needed 
 * to read the BLOBs back into memory. 
 * 
 * It is called just prior to the dumper's DataDumper routine. 
 * 
 * Optional, but strongly recommended. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN354"></a><span class='Declare_Function'>_StartBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN356"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN354"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN357"></a>    <a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN354"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN357"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN77"><span class='Ref_to_Member'>dataPos</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN86"><span class='Ref_to_Proto'>_getFilePos</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN354"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN356"><span class='Ref_To_Local'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN357"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN76"><span class='Ref_to_Member'>dataState</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN107"><span class='Ref_to_Const'>K_OFFSET_POS_SET</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_null.c.html#LN34"><span class='Ref_to_Proto'>_WriteByte</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN354"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN66"><span class='Ref_to_Const'>BLK_BLOBS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Block type */ 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN354"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN354"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* For sanity check */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the archiver when the dumper calls StartBlob. 
 * 
 * Mandatory. 
 * 
 * Must save the passed OID for retrieval at restore-time. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN374"></a><span class='Declare_Function'>_StartBlob</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN376"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN374"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN374"><span class='Ref_to_Parameter'>oid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"invalid OID for large object\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN374"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN374"><span class='Ref_to_Parameter'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN376"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN68"><span class='Ref_to_Member'>cs</span></a> <span class='Operator'>= </span><a href="compress_io.h.html#LN48"><span class='Ref_to_Proto'>AllocateCompressor</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN374"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN88"><span class='Ref_to_Proto'>_CustomWriteFunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the archiver when the dumper calls EndBlob. 
 * 
 * Optional. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN392"></a><span class='Declare_Function'>_EndBlob</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN394"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN392"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <a href="compress_io.h.html#LN53"><span class='Ref_to_Proto'>EndCompressor</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN392"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN394"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN68"><span class='Ref_to_Member'>cs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Send the end marker */ 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN392"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the archiver when finishing saving all BLOB DATA. 
 * 
 * Optional. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN407"></a><span class='Declare_Function'>_EndBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Write out a fake zero OID to mark end-of-blobs. */ 
</span>    <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN407"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Print data for a given TOC entry 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN417"></a><span class='Declare_Function'>_PrintTocData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN419"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN420"></a>    <a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN58"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN421"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>blkType</span><span class='Delimiter'>; 
</span><a name="LN422"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN420"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN76"><span class='Ref_to_Member'>dataState</span></a> <span class='Operator'>== </span><a href="pg_backup_archiver.h.html#LN108"><span class='Ref_to_Const'>K_OFFSET_NO_DATA</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_custom.c.html#LN419"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN69"><span class='Ref_to_Member'>hasSeek</span></a> <span class='Operator'>|| </span><a href="pg_backup_custom.c.html#LN420"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN76"><span class='Ref_to_Member'>dataState</span></a> <span class='Operator'>== </span><a href="pg_backup_archiver.h.html#LN106"><span class='Ref_to_Const'>K_OFFSET_POS_NOT_SET</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We cannot seek directly to the desired block.  Instead, skip over 
         * block headers until we find the one we want.  This could fail if we 
         * are asked to restore items out-of-order. 
         */ 
</span>        <a href="pg_backup_custom.c.html#LN85"><span class='Ref_to_Proto'>_readBlockHeader</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_custom.c.html#LN421"><span class='Ref_To_Local'>blkType</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_custom.c.html#LN422"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN421"><span class='Ref_To_Local'>blkType</span></a> <span class='Operator'>!= </span>EOF <span class='Operator'>&& </span><a href="pg_backup_custom.c.html#LN422"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>!= </span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN421"><span class='Ref_To_Local'>blkType</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN65"><span class='Ref_to_Const'>BLK_DATA</span></a><span class='Operator'>: 
</span>                    <a href="pg_backup_custom.c.html#LN53"><span class='Ref_to_Proto'>_skipData</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN66"><span class='Ref_to_Const'>BLK_BLOBS</span></a><span class='Operator'>: 
</span>                    <a href="pg_backup_custom.c.html#LN54"><span class='Ref_to_Proto'>_skipBlobs</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* Always have a default */ 
</span>                    <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                                  <span class='String'>"unrecognized data block type (%d) while searching archive\n"</span><span class='Delimiter'>, 
</span>                                  <a href="pg_backup_custom.c.html#LN421"><span class='Ref_To_Local'>blkType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="pg_backup_custom.c.html#LN85"><span class='Ref_to_Proto'>_readBlockHeader</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_custom.c.html#LN421"><span class='Ref_To_Local'>blkType</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_custom.c.html#LN422"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while blkType!=EOF&&id!=te-... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !ctx-&GT;hasSeek||tctx-&GT;... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We can just seek to the place we need to be. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/fseeko.c.html#LN32"><span class='Ref_to_Func'>fseeko</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN420"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN77"><span class='Ref_to_Member'>dataPos</span></a><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"error during file seek: %s\n"</span><span class='Delimiter'>, 
</span>                          <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_custom.c.html#LN85"><span class='Ref_to_Proto'>_readBlockHeader</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_custom.c.html#LN421"><span class='Ref_To_Local'>blkType</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_custom.c.html#LN422"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Produce suitable failure message if we fell off end of file */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN421"><span class='Ref_To_Local'>blkType</span></a> <span class='Operator'>== </span>EOF<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN420"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN76"><span class='Ref_to_Member'>dataState</span></a> <span class='Operator'>== </span><a href="pg_backup_archiver.h.html#LN106"><span class='Ref_to_Const'>K_OFFSET_POS_NOT_SET</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not find block ID %d in archive -- "</span> 
                          <span class='String'>"possibly due to out-of-order restore request, "</span> 
                          <span class='String'>"which cannot be handled due to lack of data offsets in archive\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_custom.c.html#LN419"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN69"><span class='Ref_to_Member'>hasSeek</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not find block ID %d in archive -- "</span> 
                          <span class='String'>"possibly due to out-of-order restore request, "</span> 
                  <span class='String'>"which cannot be handled due to non-seekable input file\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* huh, the dataPos led us to EOF? */ 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not find block ID %d in archive -- "</span> 
                          <span class='String'>"possibly corrupt archive\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Are we sane? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN422"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>!= </span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"found unexpected block ID (%d) when reading data -- expected %d\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_custom.c.html#LN422"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN421"><span class='Ref_To_Local'>blkType</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN65"><span class='Ref_to_Const'>BLK_DATA</span></a><span class='Operator'>: 
</span>            <a href="pg_backup_custom.c.html#LN52"><span class='Ref_to_Proto'>_PrintData</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="pg_backup_archiver.h.html#LN66"><span class='Ref_to_Const'>BLK_BLOBS</span></a><span class='Operator'>: 
</span>            <a href="pg_backup_custom.c.html#LN60"><span class='Ref_to_Proto'>_LoadBlobs</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN417"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN71"><span class='Ref_to_Member'>dropSchema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>:</span>                <span class='Comment_Single_Line'>/* Always have a default */ 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized data block type %d while restoring archive\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_custom.c.html#LN421"><span class='Ref_To_Local'>blkType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end _PrintTocData &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Print data from current file position. 
*/ 
</span><span class='Keyword'>static void 
</span><a name="LN512"></a><span class='Declare_Function'>_PrintData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="compress_io.h.html#LN49"><span class='Ref_to_Proto'>ReadDataFromArchive</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN512"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN512"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN89"><span class='Ref_to_Proto'>_CustomReadFunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN518"></a><span class='Declare_Function'>_LoadBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>drop</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN520"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_archiver.h.html#LN414"><span class='Ref_to_Proto'>StartRestoreBlobs</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN520"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN520"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.h.html#LN415"><span class='Ref_to_Proto'>StartRestoreBlob</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN520"><span class='Ref_To_Local'>oid</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN518"><span class='Ref_to_Parameter'>drop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_custom.c.html#LN52"><span class='Ref_to_Proto'>_PrintData</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN416"><span class='Ref_to_Proto'>EndRestoreBlob</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN520"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_custom.c.html#LN520"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_archiver.h.html#LN417"><span class='Ref_to_Proto'>EndRestoreBlobs</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Skip the BLOBs from the current file position. 
 * BLOBS are written sequentially as data blocks (see below). 
 * Each BLOB is preceded by it's original OID. 
 * A zero OID indicated the end of the BLOBS 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN543"></a><span class='Declare_Function'>_skipBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN545"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN545"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN543"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN545"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_custom.c.html#LN53"><span class='Ref_to_Proto'>_skipData</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN543"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_custom.c.html#LN545"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN543"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Skip data from current file position. 
 * Data blocks are formatted as an integer length, followed by data. 
 * A zero length denoted the end of the block. 
*/ 
</span><span class='Keyword'>static void 
</span><a name="LN561"></a><span class='Declare_Function'>_skipData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN563"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN561"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN564"></a>    size_t      <span class='Declare_Local'>blkLen</span><span class='Delimiter'>; 
</span><a name="LN565"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN566"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>buflen</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN567"></a>    size_t      <span class='Declare_Local'>cnt</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN564"><span class='Ref_To_Local'>blkLen</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN561"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN564"><span class='Ref_To_Local'>blkLen</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN564"><span class='Ref_To_Local'>blkLen</span></a> <span class='Operator'>&GT; </span><a href="pg_backup_custom.c.html#LN566"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN565"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN565"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_custom.c.html#LN565"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN564"><span class='Ref_To_Local'>blkLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_custom.c.html#LN566"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN564"><span class='Ref_To_Local'>blkLen</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_custom.c.html#LN567"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN565"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN564"><span class='Ref_To_Local'>blkLen</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN561"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="pg_backup_custom.c.html#LN564"><span class='Ref_To_Local'>blkLen</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>feof<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN561"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>))</span> 
                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                            <span class='String'>"could not read from input file: end of file\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                    <span class='String'>"could not read from input file: %s\n"</span><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_backup_custom.c.html#LN563"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>+= </span><a href="pg_backup_custom.c.html#LN564"><span class='Ref_To_Local'>blkLen</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_custom.c.html#LN564"><span class='Ref_To_Local'>blkLen</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN561"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while blkLen!=0 &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN565"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN565"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _skipData &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write a byte of data to the archive. 
 * 
 * Mandatory. 
 * 
 * Called by the archiver to do integer & byte output to the archive. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN606"></a><span class='Declare_Function'>_WriteByte</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const int </span><span class='Declare_Parameter'>i</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN608"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN606"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN609"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_custom.c.html#LN609"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>fputc<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN606"><span class='Ref_to_Parameter'>i</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN606"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span>EOF<span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.h.html#LN133"><span class='Ref_to_Const'>WRITE_ERROR_EXIT</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN608"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Read a byte of data from the archive. 
 * 
 * Mandatory 
 * 
 * Called by the archiver to read bytes & integers from the archive. 
 * EOF should be treated as a fatal error. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN627"></a><span class='Declare_Function'>_ReadByte</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN629"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN627"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN630"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN630"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>getc<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN627"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN630"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span>EOF<span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN627"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN629"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_backup_custom.c.html#LN630"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Write a buffer of data to the archive. 
 * 
 * Mandatory. 
 * 
 * Called by the archiver to write a block of bytes to the archive. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN647"></a><span class='Declare_Function'>_WriteBuf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN649"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN647"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN647"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN647"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN647"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_backup_custom.c.html#LN647"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.h.html#LN133"><span class='Ref_to_Const'>WRITE_ERROR_EXIT</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN649"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>+= </span><a href="pg_backup_custom.c.html#LN647"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Read a block of bytes from the archive. 
 * 
 * Mandatory. 
 * 
 * Called by the archiver to read a block of bytes from the archive 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN666"></a><span class='Declare_Function'>_ReadBuf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN668"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN666"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN666"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN666"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN666"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_backup_custom.c.html#LN666"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN666"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN668"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>+= </span><a href="pg_backup_custom.c.html#LN666"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Close the archive. 
 * 
 * Mandatory. 
 * 
 * When writing the archive, this is the routine that actually starts 
 * the process of saving it to files. No data should be written prior 
 * to this point, since the user could sort the TOC after creating it. 
 * 
 * If an archive is to be written, this routine must call: 
 *      WriteHead           to save the archive header 
 *      WriteToc            to save the TOC entries 
 *      WriteDataChunks     to save all DATA & BLOBs. 
 * 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN693"></a><span class='Declare_Function'>_CloseArchive</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN695"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN696"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Local'>tpos</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN316"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN48"><span class='Ref_to_EnumConst'>archModeWrite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.h.html#LN383"><span class='Ref_to_Proto'>WriteHead</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Remember TOC's seek position for use below */ 
</span>        <a href="pg_backup_custom.c.html#LN696"><span class='Ref_To_Local'>tpos</span></a> <span class='Operator'>= </span><a href="../../port/fseeko.c.html#LN73"><span class='Ref_to_Func'>ftello</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN696"><span class='Ref_To_Local'>tpos</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_backup_custom.c.html#LN695"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN69"><span class='Ref_to_Member'>hasSeek</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not determine seek position in archive file: %s\n"</span><span class='Delimiter'>, 
</span>                          <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN385"><span class='Ref_to_Proto'>WriteToc</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_custom.c.html#LN695"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN71"><span class='Ref_to_Member'>dataStart</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN86"><span class='Ref_to_Proto'>_getFilePos</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN695"><span class='Ref_To_Local'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN387"><span class='Ref_to_Proto'>WriteDataChunks</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If possible, re-write the TOC in order to update the data offset 
         * information.  This is not essential, as pg_restore can cope in most 
         * cases without it; but it can make pg_restore significantly faster 
         * in some situations (especially parallel restore). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN695"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN69"><span class='Ref_to_Member'>hasSeek</span></a> <span class='Operator'>&& 
</span>            <a href="../../port/fseeko.c.html#LN32"><span class='Ref_to_Func'>fseeko</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN696"><span class='Ref_To_Local'>tpos</span></a><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.h.html#LN385"><span class='Ref_to_Proto'>WriteToc</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if AH-&GT;mode==archModeWri... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not close archive file: %s\n"</span><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sync the output file if one is defined */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN315"><span class='Ref_to_Member'>dosync</span></a> <span class='Operator'>&& </span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN316"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN48"><span class='Ref_to_EnumConst'>archModeWrite</span></a> <span class='Operator'>&& </span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/common/file_utils.h.html#LN17"><span class='Ref_to_Proto'>fsync_fname</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN693"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _CloseArchive &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Reopen the archive's file handle. 
 * 
 * We close the original file handle, except on Windows.  (The difference 
 * is because on Windows, this is used within a multithreading context, 
 * and we don't want a thread closing the parent file handle.) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN739"></a><span class='Declare_Function'>_ReopenArchive</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN741"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN742"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Local'>tpos</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN316"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN48"><span class='Ref_to_EnumConst'>archModeWrite</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"can only reopen input archives\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * These two cases are user-facing errors since they represent unsupported 
     * (but not invalid) use-cases.  Word the error messages appropriately. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"parallel restore from standard input is not supported\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_custom.c.html#LN741"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN69"><span class='Ref_to_Member'>hasSeek</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"parallel restore from non-seekable file is not supported\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN742"><span class='Ref_To_Local'>tpos</span></a> <span class='Operator'>= </span><a href="../../port/fseeko.c.html#LN73"><span class='Ref_to_Func'>ftello</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN742"><span class='Ref_To_Local'>tpos</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not determine seek position in archive file: %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not close archive file: %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open input file \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/fseeko.c.html#LN32"><span class='Ref_to_Func'>fseeko</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN739"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN742"><span class='Ref_To_Local'>tpos</span></a><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not set seek position in archive file: %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _ReopenArchive &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Clone format-specific fields during parallel restoration. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN781"></a><span class='Declare_Function'>_Clone</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN783"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_custom.c.html#LN781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN783"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_custom.c.html#LN783"><span class='Ref_To_Local'>ctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN781"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sanity check, shouldn't happen */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN783"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN68"><span class='Ref_to_Member'>cs</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"compressor active\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: we do not make a local lo_buf because we expect at most one BLOBS 
     * entry per archive, so no parallelism is possible.  Likewise, 
     * TOC-entry-local state isn't an issue because any one TOC entry is 
     * touched by just one worker child. 
     */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end _Clone &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN802"></a><span class='Declare_Function'>_DeClone</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN804"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN802"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN804"><span class='Ref_To_Local'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * This function is executed in the child of a parallel restore from a 
 * custom-format archive and restores the actual data for one TOC entry. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN814"></a><span class='Declare_Function'>_WorkerJobRestoreCustom</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="pg_backup_archiver.h.html#LN376"><span class='Ref_to_Proto'>parallel_restore</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN814"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN814"><span class='Ref_to_Parameter'>te</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/*-------------------------------------------------- 
 * END OF FORMAT CALLBACKS 
 *-------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Get the current position in the archive file. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a> 
<a name="LN828"></a><span class='Declare_Function'>_getFilePos</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN830"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Local'>pos</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN828"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN69"><span class='Ref_to_Member'>hasSeek</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Prior to 1.7 (pg7.3) we relied on the internally maintained 
         * pointer.  Now we rely on ftello() always, unless the file has been 
         * found to not support it.  For debugging purposes, print a warning 
         * if the internal pointer disagrees, so that we're more likely to 
         * notice if something's broken about the internal position tracking. 
         */ 
</span>        <a href="pg_backup_custom.c.html#LN830"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><a href="../../port/fseeko.c.html#LN73"><span class='Ref_to_Func'>ftello</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN828"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN830"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not determine seek position in archive file: %s\n"</span><span class='Delimiter'>, 
</span>                          <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN830"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>!= </span><a href="pg_backup_custom.c.html#LN828"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN69"><span class='Ref_to_Func'>write_msg</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"WARNING: ftell mismatch with expected position -- ftell used\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_custom.c.html#LN830"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN828"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_backup_custom.c.html#LN830"><span class='Ref_To_Local'>pos</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _getFilePos &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read a data block header. The format changed in V1.3, so we 
 * centralize the code here for simplicity.  Returns *type = EOF 
 * if at EOF. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN860"></a><span class='Declare_Function'>_readBlockHeader</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>type</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>id</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN862"></a>    <a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_directory.c.html#LN44"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_custom.c.html#LN860"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN863"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>byt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: if we are at EOF with a pre-1.3 input file, we'll exit_horribly 
     * inside ReadInt rather than returning EOF.  It doesn't seem worth 
     * jumping through hoops to deal with that case better, because no such 
     * files are likely to exist in the wild: only some 7.1 development 
     * versions of pg_dump ever generated such files. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN860"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN215"><span class='Ref_to_Member'>version</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_archiver.h.html#LN78"><span class='Ref_to_Const'>K_VERS_1_3</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="pg_backup_custom.c.html#LN860"><span class='Ref_to_Parameter'>type</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN65"><span class='Ref_to_Const'>BLK_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_custom.c.html#LN863"><span class='Ref_To_Local'>byt</span></a> <span class='Operator'>= </span>getc<span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN860"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pg_backup_custom.c.html#LN860"><span class='Ref_to_Parameter'>type</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN863"><span class='Ref_To_Local'>byt</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN863"><span class='Ref_To_Local'>byt</span></a> <span class='Operator'>== </span>EOF<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="pg_backup_custom.c.html#LN860"><span class='Ref_to_Parameter'>id</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* don't return an uninitialized value */ 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_backup_custom.c.html#LN862"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="pg_backup_custom.c.html#LN860"><span class='Ref_to_Parameter'>id</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN860"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _readBlockHeader &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Callback function for WriteDataToArchive. Writes one block of (compressed) 
 * data to the archive. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN894"></a><span class='Declare_Function'>_CustomWriteFunc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* never write 0-byte blocks (this should not happen) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN894"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.h.html#LN406"><span class='Ref_to_Proto'>WriteInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN894"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN894"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_null.c.html#LN35"><span class='Ref_to_Proto'>_WriteBuf</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN894"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN894"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN894"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Callback function for ReadDataFromArchive. To keep things simple, we 
 * always read one compressed block at a time. 
 */ 
</span><span class='Keyword'>static </span>size_t 
<a name="LN910"></a><span class='Declare_Function'>_CustomReadFunc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Operator'>*</span><span class='Declare_Parameter'>buflen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN912"></a>    size_t      <span class='Declare_Local'>blkLen</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Read length */ 
</span>    <a href="pg_backup_custom.c.html#LN912"><span class='Ref_To_Local'>blkLen</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN407"><span class='Ref_to_Proto'>ReadInt</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN910"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN912"><span class='Ref_To_Local'>blkLen</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If the caller's buffer is not large enough, allocate a bigger one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN912"><span class='Ref_To_Local'>blkLen</span></a> <span class='Operator'>&GT; *</span><a href="pg_backup_custom.c.html#LN910"><span class='Ref_to_Parameter'>buflen</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_backup_custom.c.html#LN910"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pg_backup_custom.c.html#LN910"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN912"><span class='Ref_To_Local'>blkLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pg_backup_custom.c.html#LN910"><span class='Ref_to_Parameter'>buflen</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN912"><span class='Ref_To_Local'>blkLen</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* exits app on read errors */ 
</span>    <a href="pg_backup_custom.c.html#LN44"><span class='Ref_to_Proto'>_ReadBuf</span></a><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN910"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="pg_backup_custom.c.html#LN910"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pg_backup_custom.c.html#LN912"><span class='Ref_To_Local'>blkLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_custom.c.html#LN912"><span class='Ref_To_Local'>blkLen</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _CustomReadFunc &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>