<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_dump\pg_backup_tar.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_dump\pg_backup_tar.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:00 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_backup_tar.c 
 * 
 *  This file is copied from the 'files' format file, but dumps data into 
 *  one temp file then sends it to the output TAR archive. 
 * 
 *  The tar format also includes a 'restore.sql' script which is there for 
 *  the benefit of humans. This script is never used by pg_restore. 
 * 
 *  NOTE: If you untar the created 'tar' file, the resulting files are 
 *  compatible with the 'directory' format. Please keep the two formats in 
 *  sync. 
 * 
 *  See the headers to pg_backup_directory & pg_restore for more details. 
 * 
 * Copyright (c) 2000, Philip Warner 
 *      Rights are granted to use this software in any way so long 
 *      as this notice is not removed. 
 * 
 *  The author is not responsible for loss or damages that may 
 *  result from it's use. 
 * 
 * 
 * IDENTIFICATION 
 *      src/bin/pg_dump/pg_backup_tar.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"pg_backup_archiver.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_backup_tar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_backup_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgtar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/file_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"fe_utils/string_utils.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<a name="LN43"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_ArchiveEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN44"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_StartData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN45"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_WriteData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>dLen</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN46"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_EndData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>_WriteByte</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const int </span><span class='Declare_Parameter'>i</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN48"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>_ReadByte</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>ArchiveHandle</span> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN49"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_WriteBuf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN50"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_ReadBuf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN51"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_CloseArchive</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN52"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_PrintTocData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN53"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_WriteExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_ReadExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN55"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_PrintExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN57"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_StartBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN58"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_StartBlob</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN59"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_EndBlob</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN60"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_EndBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN62"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>K_STD_BUF_SIZE</span> <span class='Number'>1024</span> 
 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> HAVE_LIBZ 
<a name="LN68"></a>    gzFile      <span class='Declare_Member'>zFH</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN70"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Member'>zFH</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN72"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Member'>nFH</span><span class='Delimiter'>; 
</span><a name="LN73"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Member'>tarFH</span><span class='Delimiter'>; 
</span><a name="LN74"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Member'>tmpFH</span><span class='Delimiter'>; 
</span><a name="LN75"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>targetFile</span><span class='Delimiter'>; 
</span><a name="LN76"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>mode</span><span class='Delimiter'>; 
</span><a name="LN77"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Member'>pos</span><span class='Delimiter'>; 
</span><a name="LN78"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Member'>fileLen</span><span class='Delimiter'>; 
</span><a name="LN79"></a>    <a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Member'>AH</span><span class='Delimiter'>; 
</span><a name="LN80"></a>} <span class='Declare_Typedef'>TAR_MEMBER</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN84"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>hasSeek</span><span class='Delimiter'>; 
</span><a name="LN85"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Member'>filePos</span><span class='Delimiter'>; 
</span><a name="LN86"></a>    <a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Member'>blobToc</span><span class='Delimiter'>; 
</span><a name="LN87"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Member'>tarFH</span><span class='Delimiter'>; 
</span><a name="LN88"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Member'>tarFHpos</span><span class='Delimiter'>; 
</span><a name="LN89"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Member'>tarNextMember</span><span class='Delimiter'>; 
</span><a name="LN90"></a>    <a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Member'>FH</span><span class='Delimiter'>; 
</span><a name="LN91"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>isSpecialScript</span><span class='Delimiter'>; 
</span><a name="LN92"></a>    <a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Member'>scriptTH</span><span class='Delimiter'>; 
</span><a name="LN93"></a>} <span class='Declare_Typedef'>lclContext</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN97"></a>    <a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Member'>TH</span><span class='Delimiter'>; 
</span><a name="LN98"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>filename</span><span class='Delimiter'>; 
</span><a name="LN99"></a>} <span class='Declare_Typedef'>lclTocEntry</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* translator: this is a module name */ 
</span><a name="LN102"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>modulename</span> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"tar archiver"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN104"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_LoadBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN106"></a><span class='Keyword'>static </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>tarOpen</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>mode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>tarClose</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>TH</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> __NOT_USED__ 
<a name="LN110"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>tarGets</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN112"></a><span class='Keyword'>static int</span>  <span class='Declare_Function'>tarPrintf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) </span><a href="../../port/win32security.c.html#LN25"><span class='Ref_to_Func'>pg_attribute_printf</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static void </span><a href="pg_backup_tar.c.html#LN1071"><span class='Ref_to_Func'>_tarAddFile</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN1130"><span class='Ref_to_Func'>_tarPositionTo</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static </span>size_t <a href="pg_backup_tar.c.html#LN576"><span class='Ref_to_Func'>tarRead</span></a><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span>size_t <a href="../../backend/replication/repl_scanner.l.html#LN155"><span class='Ref_to_Global_Var'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static </span>size_t <a href="pg_backup_tar.c.html#LN594"><span class='Ref_to_Func'>tarWrite</span></a><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span>size_t <a href="../../backend/replication/repl_scanner.l.html#LN155"><span class='Ref_to_Global_Var'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="../../backend/replication/basebackup.c.html#LN58"><span class='Ref_to_Proto'>_tarWriteHeader</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static int</span>  <a href="pg_backup_tar.c.html#LN1212"><span class='Ref_to_Func'>_tarGetHeader</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static </span>size_t <a href="pg_backup_tar.c.html#LN517"><span class='Ref_to_Func'>_tarReadRaw</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span>size_t <a href="../../backend/replication/repl_scanner.l.html#LN155"><span class='Ref_to_Global_Var'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>th</span></a><span class='Delimiter'>, </span>FILE <span class='Operator'>*</span>fh<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static </span>size_t <a href="pg_backup_tar.c.html#LN913"><span class='Ref_to_Func'>_scriptOut</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN66"><span class='Ref_to_Global_Var'>buf</span></a><span class='Delimiter'>, </span>size_t <a href="../../backend/replication/repl_scanner.l.html#LN155"><span class='Ref_to_Global_Var'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 *  Initializer 
 */ 
</span><span class='Keyword'>void 
</span><a href="pg_backup_archiver.h.html#LN422"><span class='Ref_to_Proto'>InitArchiveFmt_Tar</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN130"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assuming static functions, this can be copied for each format. */ 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN244"><span class='Ref_to_Member'>ArchiveEntryPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN37"><span class='Ref_to_Proto'>_ArchiveEntry</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN246"><span class='Ref_to_Member'>StartDataPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN38"><span class='Ref_to_Proto'>_StartData</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN248"><span class='Ref_to_Member'>WriteDataPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN31"><span class='Ref_to_Proto'>_WriteData</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN250"><span class='Ref_to_Member'>EndDataPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN33"><span class='Ref_to_Proto'>_EndData</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN251"><span class='Ref_to_Member'>WriteBytePtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN34"><span class='Ref_to_Proto'>_WriteByte</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN252"><span class='Ref_to_Member'>ReadBytePtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN42"><span class='Ref_to_Proto'>_ReadByte</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN253"><span class='Ref_to_Member'>WriteBufPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN35"><span class='Ref_to_Proto'>_WriteBuf</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN254"><span class='Ref_to_Member'>ReadBufPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN44"><span class='Ref_to_Proto'>_ReadBuf</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN255"><span class='Ref_to_Member'>ClosePtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN36"><span class='Ref_to_Proto'>_CloseArchive</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN256"><span class='Ref_to_Member'>ReopenPtr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN263"><span class='Ref_to_Member'>PrintTocDataPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN37"><span class='Ref_to_Proto'>_PrintTocData</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN260"><span class='Ref_to_Member'>ReadExtraTocPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN49"><span class='Ref_to_Proto'>_ReadExtraToc</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN257"><span class='Ref_to_Member'>WriteExtraTocPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN48"><span class='Ref_to_Proto'>_WriteExtraToc</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN262"><span class='Ref_to_Member'>PrintExtraTocPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_custom.c.html#LN50"><span class='Ref_to_Proto'>_PrintExtraToc</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN265"><span class='Ref_to_Member'>StartBlobsPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN38"><span class='Ref_to_Proto'>_StartBlobs</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN267"><span class='Ref_to_Member'>StartBlobPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN39"><span class='Ref_to_Proto'>_StartBlob</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN268"><span class='Ref_to_Member'>EndBlobPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN40"><span class='Ref_to_Proto'>_EndBlob</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN266"><span class='Ref_to_Member'>EndBlobsPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_null.c.html#LN41"><span class='Ref_to_Proto'>_EndBlobs</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN274"><span class='Ref_to_Member'>ClonePtr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN275"><span class='Ref_to_Member'>DeClonePtr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN271"><span class='Ref_to_Member'>WorkerJobDumpPtr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN272"><span class='Ref_to_Member'>WorkerJobRestorePtr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up some special context used in compressing data. 
     */ 
</span>    <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN91"><span class='Ref_to_Member'>isSpecialScript</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize LO buffering */ 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN327"><span class='Ref_to_Member'>lo_buf_size</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN34"><span class='Ref_to_Const'>LOBBUFSIZE</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN325"><span class='Ref_to_Member'>lo_buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN34"><span class='Ref_to_Const'>LOBBUFSIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now open the tar file, and load the TOC if we're in read mode. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN316"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN48"><span class='Ref_to_EnumConst'>archModeWrite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                           <span class='String'>"could not open TOC file \"%s\" for output: %s\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a> <span class='Operator'>= </span>stdout<span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"could not open TOC file for output: %s\n"</span><span class='Delimiter'>, 
</span>                              <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN88"><span class='Ref_to_Member'>tarFHpos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make unbuffered since we will dup() it, and the buffers screw each 
         * other 
         */ 
</span>        <span class='Comment_Multi_Line'>/* setvbuf(ctx-&GT;tarFH, NULL, _IONBF, 0); */ 
</span> 
        <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN69"><span class='Ref_to_Member'>hasSeek</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN394"><span class='Ref_to_Proto'>checkSeek</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't support compression because reading the files back is not 
         * possible since gzdopen uses buffered IO which totally screws file 
         * positioning. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                     <span class='String'>"compression is not supported by tar archive format\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if AH-&GT;mode==archModeWri... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* Read Mode */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open TOC file \"%s\" for input: %s\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a> <span class='Operator'>= </span>stdin<span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open TOC file for input: %s\n"</span><span class='Delimiter'>, 
</span>                              <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make unbuffered since we will dup() it, and the buffers screw each 
         * other 
         */ 
</span>        <span class='Comment_Multi_Line'>/* setvbuf(ctx-&GT;tarFH, NULL, _IONBF, 0); */ 
</span> 
        <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN88"><span class='Ref_to_Member'>tarFHpos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN69"><span class='Ref_to_Member'>hasSeek</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN394"><span class='Ref_to_Proto'>checkSeek</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Forcibly unmark the header as read since we use the lookahead 
         * buffer 
         */ 
</span>        <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN237"><span class='Ref_to_Member'>readHeader</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN90"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN106"><span class='Ref_to_Proto'>tarOpen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"toc.dat"</span><span class='Delimiter'>, </span><span class='String'>'r'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN384"><span class='Ref_to_Proto'>ReadHead</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN386"><span class='Ref_to_Proto'>ReadToc</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN107"><span class='Ref_to_Proto'>tarClose</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN130"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN90"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Nothing else in the file... */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end tarPrintf &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * - Start a new TOC entry 
 *   Setup the output file name. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN256"></a><span class='Declare_Function'>_ArchiveEntry</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN258"></a>    <a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span><span class='Delimiter'>; 
</span><a name="LN259"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>fn</span><span class='Delimiter'>[</span><a href="pg_backup_tar.c.html#LN62"><span class='Ref_to_Const'>K_STD_BUF_SIZE</span></a><span class='Delimiter'>]; 
</span> 
    <a href="pg_backup_tar.c.html#LN258"><span class='Ref_To_Local'>ctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN256"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN358"><span class='Ref_to_Member'>dataDumper</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> HAVE_LIBZ 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN256"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN259"><span class='Ref_To_Local'>fn</span></a><span class='Delimiter'>, </span><span class='String'>"%d.dat"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN256"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN259"><span class='Ref_To_Local'>fn</span></a><span class='Delimiter'>, </span><span class='String'>"%d.dat.gz"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN256"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN259"><span class='Ref_To_Local'>fn</span></a><span class='Delimiter'>, </span><span class='String'>"%d.dat"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN256"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN341"><span class='Ref_to_Member'>dumpId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <a href="pg_backup_tar.c.html#LN258"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN259"><span class='Ref_To_Local'>fn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_tar.c.html#LN258"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN258"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN97"><span class='Ref_to_Member'>TH</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_backup_tar.c.html#LN256"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN258"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _ArchiveEntry &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN283"></a><span class='Declare_Function'>_WriteExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN285"></a>    <a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN283"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN285"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN283"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN285"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_archiver.h.html#LN409"><span class='Ref_to_Proto'>WriteStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN283"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN294"></a><span class='Declare_Function'>_ReadExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN296"></a>    <a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN294"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN296"><span class='Ref_To_Local'>ctx</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_tar.c.html#LN296"><span class='Ref_To_Local'>ctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN294"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN296"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_tar.c.html#LN296"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN408"><span class='Ref_to_Proto'>ReadStr</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN294"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN296"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN296"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN296"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_backup_tar.c.html#LN296"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN97"><span class='Ref_to_Member'>TH</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN314"></a><span class='Declare_Function'>_PrintExtraToc</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN316"></a>    <a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN314"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN314"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN182"><span class='Ref_to_Member'>verbose</span></a> <span class='Operator'>&& </span><a href="pg_backup_tar.c.html#LN316"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN314"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"-- File: %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN316"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN323"></a><span class='Declare_Function'>_StartData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN325"></a>    <a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN323"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN325"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN97"><span class='Ref_to_Member'>TH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN106"><span class='Ref_to_Proto'>tarOpen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN323"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN325"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><span class='String'>'w'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>* 
</span><a name="LN331"></a><span class='Declare_Function'>tarOpen</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN333"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN334"></a>    <a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_LIBZ 
<a name="LN337"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>fmode</span><span class='Delimiter'>[</span><span class='Number'>10</span><span class='Delimiter'>]; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>mode</span></a> <span class='Operator'>== </span><span class='String'>'r'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN1130"><span class='Ref_to_Func'>_tarPositionTo</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>)</span>                <span class='Comment_Single_Line'>/* Not found */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Couldn't find the requested file. Future: do SEEK(0) and 
                 * retry. 
                 */ 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not find file \"%s\" in archive\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Any file OK, none left, so return NULL */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> HAVE_LIBZ 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN72"><span class='Ref_to_Member'>nFH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN333"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"compression is not supported by tar archive format\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* tm-&GT;zFH = gzdopen(dup(fileno(ctx-&GT;tarFH)), "rb"); */ 
</span><span class='Directive'>#else</span> 
        <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN72"><span class='Ref_to_Member'>nFH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN333"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if mode=='r' &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN373"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>old_umask</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * POSIX does not require, but permits, tmpfile() to restrict file 
         * permissions.  Given an OS crash after we write data, the filesystem 
         * might retain the data but forget tmpfile()'s unlink().  If so, the 
         * file mode protects confidentiality of the data written. 
         */ 
</span>        <a href="pg_backup_tar.c.html#LN373"><span class='Ref_To_Local'>old_umask</span></a> <span class='Operator'>= </span>umask<span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN450"><span class='Ref_to_Const'>S_IRWXG</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN454"><span class='Ref_to_Const'>S_IRWXO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
        <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN74"><span class='Ref_to_Member'>tmpFH</span></a> <span class='Operator'>= </span>tmpfile<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
 
        <span class='Comment_Multi_Line'>/* 
         * On WIN32, tmpfile() generates a filename in the root directory, 
         * which requires administrative permissions on certain systems. Loop 
         * until we find a unique file name we can create. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN396"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span><span class='Delimiter'>; 
</span><a name="LN397"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>fd</span><span class='Delimiter'>; 
</span> 
            <a href="pg_backup_tar.c.html#LN396"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>= </span>_tempnam<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>"pg_temp_"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN396"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_tar.c.html#LN397"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN396"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span>O_RDWR <span class='Operator'>| </span>O_CREAT <span class='Operator'>| </span>O_EXCL <span class='Operator'>| </span>O_BINARY <span class='Operator'>| 
</span>                      O_TEMPORARY<span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN424"><span class='Ref_to_Const'>S_IRUSR</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN425"><span class='Ref_to_Const'>S_IWUSR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN396"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN397"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* created a file */ 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN74"><span class='Ref_to_Member'>tmpFH</span></a> <span class='Operator'>= </span>fdopen<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN397"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span><span class='String'>"w+b"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>!= </span>EEXIST<span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* failure other than file exists */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while 1 &raquo; </span> 
<span class='Directive'>#endif</span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN74"><span class='Ref_to_Member'>tmpFH</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not generate temporary file name: %s\n"</span><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        umask<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN373"><span class='Ref_To_Local'>old_umask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_LIBZ 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN337"><span class='Ref_To_Local'>fmode</span></a><span class='Delimiter'>, </span><span class='String'>"wb%d"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN68"><span class='Ref_to_Member'>zFH</span></a> <span class='Operator'>= </span>gzdopen<span class='Parentheses'>(</span>dup<span class='Parentheses'>(</span>fileno<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN74"><span class='Ref_to_Member'>tmpFH</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN337"><span class='Ref_To_Local'>fmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN68"><span class='Ref_to_Member'>zFH</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not open temporary file\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN72"><span class='Ref_to_Member'>nFH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN74"><span class='Ref_to_Member'>tmpFH</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
 
        <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN72"><span class='Ref_to_Member'>nFH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN74"><span class='Ref_to_Member'>tmpFH</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN79"><span class='Ref_to_Member'>AH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN76"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN331"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN73"><span class='Ref_to_Member'>tarFH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN333"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_tar.c.html#LN334"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tarOpen &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN448"></a><span class='Declare_Function'>tarClose</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Close the GZ file since we dup'd. This will flush the buffers. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN448"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN42"><span class='Ref_to_Macro'>GZCLOSE</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN448"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN68"><span class='Ref_to_Member'>zFH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not close tar member\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN448"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN76"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><span class='String'>'w'</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_tar.c.html#LN1071"><span class='Ref_to_Func'>_tarAddFile</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN448"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN448"><span class='Ref_to_Parameter'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* This will close the temp file */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * else Nothing to do for normal read since we don't dup() normal file 
     * handle, and we don't use temp files. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN448"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN448"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN448"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN72"><span class='Ref_to_Member'>nFH</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN448"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN68"><span class='Ref_to_Member'>zFH</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tarClose &raquo; </span> 
 
<span class='Directive'>#ifdef</span> __NOT_USED__ 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN474"></a><span class='Declare_Function'>tarGets</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN476"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span><a name="LN477"></a>    size_t      <span class='Declare_Local'>cnt</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN478"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span> <span class='Operator'>= </span><span class='String'>' '</span><span class='Delimiter'>; 
</span><a name="LN479"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>eof</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't read past logical EOF */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a> <span class='Operator'>- </span><a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN77"><span class='Ref_to_Member'>pos</span></a><span class='Parentheses'>))</span> 
        <a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a> <span class='Operator'>- </span><a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN77"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN477"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&& </span><a href="pg_backup_tar.c.html#LN478"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>!= </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN517"><span class='Ref_to_Func'>_tarReadRaw</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN79"><span class='Ref_to_Member'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN478"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>th</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_tar.c.html#LN479"><span class='Ref_To_Local'>eof</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>[</span><a href="pg_backup_tar.c.html#LN477"><span class='Ref_To_Local'>cnt</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN478"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN479"><span class='Ref_To_Local'>eof</span></a> <span class='Operator'>&& </span><a href="pg_backup_tar.c.html#LN477"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_tar.c.html#LN476"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>[</span><a href="pg_backup_tar.c.html#LN477"><span class='Ref_To_Local'>cnt</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN476"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN476"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN476"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN77"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>+= </span><a href="pg_backup_tar.c.html#LN474"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_tar.c.html#LN476"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tarGets &raquo; </span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Just read bytes from the archive. This is the low level read routine 
 * that is used for ALL reads on a tar file. 
 */ 
</span><span class='Keyword'>static </span>size_t 
<a name="LN518"></a><span class='Declare_Function'>_tarReadRaw</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Delimiter'>, </span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>fh</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN520"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN521"></a>    size_t      <span class='Declare_Local'>avail</span><span class='Delimiter'>; 
</span><a name="LN522"></a>    size_t      <span class='Declare_Local'>used</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN523"></a>    size_t      <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN521"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN241"><span class='Ref_to_Member'>lookaheadLen</span></a> <span class='Operator'>- </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN242"><span class='Ref_to_Member'>lookaheadPos</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN521"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We have some lookahead bytes to use */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN521"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>&GT;= </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* Just use the lookahead buffer */ 
</span>            <a href="pg_backup_tar.c.html#LN522"><span class='Ref_To_Local'>used</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_tar.c.html#LN522"><span class='Ref_To_Local'>used</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN521"><span class='Ref_To_Local'>avail</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Copy, and adjust buffer pos */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN238"><span class='Ref_to_Member'>lookahead</span></a> <span class='Operator'>+ </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN242"><span class='Ref_to_Member'>lookaheadPos</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN522"><span class='Ref_To_Local'>used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN242"><span class='Ref_to_Member'>lookaheadPos</span></a> <span class='Operator'>+= </span><a href="pg_backup_tar.c.html#LN522"><span class='Ref_To_Local'>used</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Adjust required length */ 
</span>        <a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>-= </span><a href="pg_backup_tar.c.html#LN522"><span class='Ref_To_Local'>used</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Read the file if len &GT; 0 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>fh</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_tar.c.html#LN523"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="pg_backup_tar.c.html#LN522"><span class='Ref_To_Local'>used</span></a><span class='Delimiter'>], </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>fh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN523"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&& !</span>feof<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>fh</span></a><span class='Parentheses'>))</span> 
                <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>fh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>th</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN68"><span class='Ref_to_Member'>zFH</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_tar.c.html#LN523"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN44"><span class='Ref_to_Macro'>GZREAD</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="pg_backup_tar.c.html#LN522"><span class='Ref_To_Local'>used</span></a><span class='Delimiter'>], </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN68"><span class='Ref_to_Member'>zFH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN523"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&& !</span><a href="pg_backup_archiver.h.html#LN45"><span class='Ref_to_Macro'>GZEOF</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN68"><span class='Ref_to_Member'>zFH</span></a><span class='Parentheses'>))</span> 
                    <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                    <span class='String'>"could not read from input file: %s\n"</span><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_tar.c.html#LN523"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="pg_backup_tar.c.html#LN522"><span class='Ref_To_Local'>used</span></a><span class='Delimiter'>], </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN72"><span class='Ref_to_Member'>nFH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN523"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&& !</span>feof<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN72"><span class='Ref_to_Member'>nFH</span></a><span class='Parentheses'>))</span> 
                    <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN518"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN72"><span class='Ref_to_Member'>nFH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"internal error -- neither th nor fh specified in tarReadRaw()\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if len&GT;0 &raquo; </span> 
 
    <a href="pg_backup_tar.c.html#LN520"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN88"><span class='Ref_to_Member'>tarFHpos</span></a> <span class='Operator'>+= </span><a href="pg_backup_tar.c.html#LN523"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>+ </span><a href="pg_backup_tar.c.html#LN522"><span class='Ref_To_Local'>used</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN523"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>+ </span><a href="pg_backup_tar.c.html#LN522"><span class='Ref_To_Local'>used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _tarReadRaw &raquo; </span> 
 
<span class='Keyword'>static </span>size_t 
<a name="LN577"></a><span class='Declare_Function'>tarRead</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN579"></a>    size_t      <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN77"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>+ </span><a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a><span class='Parentheses'>) 
</span>        <a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a> <span class='Operator'>- </span><a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN77"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN579"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN517"><span class='Ref_to_Func'>_tarReadRaw</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN79"><span class='Ref_to_Member'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>th</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN577"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN77"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>+= </span><a href="pg_backup_tar.c.html#LN579"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_tar.c.html#LN579"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>size_t 
<a name="LN595"></a><span class='Declare_Function'>tarWrite</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN597"></a>    size_t      <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN595"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN68"><span class='Ref_to_Member'>zFH</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_tar.c.html#LN597"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_archiver.h.html#LN43"><span class='Ref_to_Macro'>GZWRITE</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN595"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN595"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN595"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN68"><span class='Ref_to_Member'>zFH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_tar.c.html#LN597"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>fwrite<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN595"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN595"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN595"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN72"><span class='Ref_to_Member'>nFH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN595"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN77"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>+= </span><a href="pg_backup_tar.c.html#LN597"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_backup_tar.c.html#LN597"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN609"></a><span class='Declare_Function'>_WriteData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>dLen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN611"></a>    <a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN609"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN310"><span class='Ref_to_Member'>currToc</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN594"><span class='Ref_to_Func'>tarWrite</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN609"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN609"><span class='Ref_to_Parameter'>dLen</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN611"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN97"><span class='Ref_to_Member'>TH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_backup_tar.c.html#LN609"><span class='Ref_to_Parameter'>dLen</span></a><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.h.html#LN133"><span class='Ref_to_Const'>WRITE_ERROR_EXIT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN620"></a><span class='Declare_Function'>_EndData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN622"></a>    <a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN620"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Close the file */ 
</span>    <a href="pg_backup_tar.c.html#LN107"><span class='Ref_to_Proto'>tarClose</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN620"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN622"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN97"><span class='Ref_to_Member'>TH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN622"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN97"><span class='Ref_to_Member'>TH</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Print data for a given file 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN633"></a><span class='Declare_Function'>_PrintFileData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN635"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN633"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN636"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>4096</span><span class='Delimiter'>]; 
</span><a name="LN637"></a>    size_t      <span class='Declare_Local'>cnt</span><span class='Delimiter'>; 
</span><a name="LN638"></a>    <a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Local'>th</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_tar.c.html#LN633"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN638"><span class='Ref_To_Local'>th</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN106"><span class='Ref_to_Proto'>tarOpen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN633"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN633"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><span class='String'>'r'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN635"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN90"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN638"><span class='Ref_To_Local'>th</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_backup_tar.c.html#LN637"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN576"><span class='Ref_to_Func'>tarRead</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN636"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4095</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN638"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_tar.c.html#LN636"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="pg_backup_tar.c.html#LN637"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN429"><span class='Ref_to_Proto'>ahwrite</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN636"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN637"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN633"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_tar.c.html#LN107"><span class='Ref_to_Proto'>tarClose</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN633"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN638"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _PrintFileData &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Print data for a given TOC entry 
*/ 
</span><span class='Keyword'>static void 
</span><a name="LN660"></a><span class='Declare_Function'>_PrintTocData</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN662"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN663"></a>    <a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN664"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pos1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_tar.c.html#LN663"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're writing the special restore.sql script, emit a suitable 
     * command to include each table's data from the corresponding file. 
     * 
     * In the COPY case this is a bit klugy because the regular COPY command 
     * was already printed before we get control. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN662"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN91"><span class='Ref_to_Member'>isSpecialScript</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Abort the COPY FROM stdin */ 
</span>            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"\\.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The COPY statement should look like "COPY ... FROM stdin;\n", 
             * see dumpTableData(). 
             */ 
</span>            <a href="pg_backup_tar.c.html#LN664"><span class='Ref_To_Local'>pos1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>strlen<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>13</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN664"><span class='Ref_To_Local'>pos1</span></a> <span class='Operator'>&LT; </span><span class='Number'>6</span> <span class='Operator'>|| </span>strncmp<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a><span class='Delimiter'>, </span><span class='String'>"COPY "</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                strcmp<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a> <span class='Operator'>+ </span><a href="pg_backup_tar.c.html#LN664"><span class='Ref_To_Local'>pos1</span></a><span class='Delimiter'>, </span><span class='String'>" FROM stdin;\n"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"unexpected COPY statement syntax: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Emit all but the FROM part ... */ 
</span>            <a href="pg_backup_archiver.h.html#LN429"><span class='Ref_to_Proto'>ahwrite</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN354"><span class='Ref_to_Member'>copyStmt</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN664"><span class='Ref_To_Local'>pos1</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* ... and insert modified FROM */ 
</span>            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>" FROM '$$PATH$$/%s';\n\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN663"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if te-&GT;copyStmt &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* --inserts mode, no worries, just include the data file */ 
</span>            <a href="pg_backup_archiver.c.html#LN1584"><span class='Ref_to_Func'>ahprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"\\i $$PATH$$/%s\n\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN663"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ctx-&GT;isSpecialScript &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN351"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><span class='String'>"BLOBS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_custom.c.html#LN60"><span class='Ref_to_Proto'>_LoadBlobs</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_directory.c.html#LN379"><span class='Ref_to_Func'>_PrintFileData</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN660"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN663"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_directory.c.html#LN60"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _PrintTocData &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN715"></a><span class='Declare_Function'>_LoadBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN717"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span><a name="LN718"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN719"></a>    <a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Local'>th</span><span class='Delimiter'>; 
</span><a name="LN720"></a>    size_t      <span class='Declare_Local'>cnt</span><span class='Delimiter'>; 
</span><a name="LN721"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>foundBlob</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN722"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>4096</span><span class='Delimiter'>]; 
</span> 
    <a href="pg_backup_archiver.h.html#LN414"><span class='Ref_to_Proto'>StartRestoreBlobs</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN719"><span class='Ref_To_Local'>th</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN106"><span class='Ref_to_Proto'>tarOpen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'r'</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Open next file */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN719"><span class='Ref_To_Local'>th</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_tar.c.html#LN718"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN90"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN719"><span class='Ref_To_Local'>th</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN719"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a><span class='Delimiter'>, </span><span class='String'>"blob_"</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_tar.c.html#LN717"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN719"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN717"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"restoring large object with OID %u\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN717"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pg_backup_archiver.h.html#LN415"><span class='Ref_to_Proto'>StartRestoreBlob</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN717"><span class='Ref_To_Local'>oid</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN71"><span class='Ref_to_Member'>dropSchema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_backup_tar.c.html#LN720"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN576"><span class='Ref_to_Func'>tarRead</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN722"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4095</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN719"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pg_backup_tar.c.html#LN722"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="pg_backup_tar.c.html#LN720"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                    <a href="pg_backup_archiver.h.html#LN429"><span class='Ref_to_Proto'>ahwrite</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN722"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN720"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pg_backup_archiver.h.html#LN416"><span class='Ref_to_Proto'>EndRestoreBlob</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN717"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_backup_tar.c.html#LN721"><span class='Ref_To_Local'>foundBlob</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="pg_backup_tar.c.html#LN107"><span class='Ref_to_Proto'>tarClose</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN719"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_backup_tar.c.html#LN107"><span class='Ref_to_Proto'>tarClose</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN719"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Once we have found the first blob, stop at the first non-blob 
             * entry (which will be 'blobs.toc').  This coding would eat all 
             * the rest of the archive if there are no blobs ... but this 
             * function shouldn't be called at all in that case. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN721"><span class='Ref_To_Local'>foundBlob</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_backup_tar.c.html#LN719"><span class='Ref_To_Local'>th</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN106"><span class='Ref_to_Proto'>tarOpen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'r'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while th!=NULL &raquo; </span> 
    <a href="pg_backup_archiver.h.html#LN417"><span class='Ref_to_Proto'>EndRestoreBlobs</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN715"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _LoadBlobs &raquo; </span> 
 
 
<span class='Keyword'>static int 
</span><a name="LN771"></a><span class='Declare_Function'>_WriteByte</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const int </span><span class='Declare_Parameter'>i</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN773"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN771"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN774"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>b</span> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN771"><span class='Ref_to_Parameter'>i</span></a><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* Avoid endian problems */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN594"><span class='Ref_to_Func'>tarWrite</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN774"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN773"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN90"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.h.html#LN133"><span class='Ref_to_Const'>WRITE_ERROR_EXIT</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN773"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN784"></a><span class='Declare_Function'>_ReadByte</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN786"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN784"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN787"></a>    size_t      <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN788"></a>    <span class='Keyword'>unsigned char </span><span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN787"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN576"><span class='Ref_to_Func'>tarRead</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN788"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN786"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN90"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN787"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Comment_Multi_Line'>/* We already would have exited for errors on reads, must be EOF */ 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                      <span class='String'>"could not read from input file: end of file\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN786"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_backup_tar.c.html#LN788"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN800"></a><span class='Declare_Function'>_WriteBuf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN802"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN800"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN594"><span class='Ref_to_Func'>tarWrite</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN800"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN800"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN802"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN90"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_backup_tar.c.html#LN800"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.h.html#LN133"><span class='Ref_to_Const'>WRITE_ERROR_EXIT</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN802"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>+= </span><a href="pg_backup_tar.c.html#LN800"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN811"></a><span class='Declare_Function'>_ReadBuf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN813"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN811"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN576"><span class='Ref_to_Func'>tarRead</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN811"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN811"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN813"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN90"><span class='Ref_to_Member'>FH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_backup_tar.c.html#LN811"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span> 
        <span class='Comment_Multi_Line'>/* We already would have exited for errors on reads, must be EOF */ 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                      <span class='String'>"could not read from input file: end of file\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN813"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_custom.c.html#LN70"><span class='Ref_to_Member'>filePos</span></a> <span class='Operator'>+= </span><a href="pg_backup_tar.c.html#LN811"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN825"></a><span class='Declare_Function'>_CloseArchive</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN827"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN828"></a>    <a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Local'>th</span><span class='Delimiter'>; 
</span><a name="LN829"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ropt</span><span class='Delimiter'>; 
</span><a name="LN830"></a>    <a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>savRopt</span><span class='Delimiter'>; 
</span><a name="LN831"></a>    <a href="pg_backup.h.html#LN126"><span class='Ref_to_Typedef'>DumpOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>savDopt</span><span class='Delimiter'>; 
</span><a name="LN832"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>savVerbose</span><span class='Delimiter'>, 
</span><a name="LN833"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN316"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN48"><span class='Ref_to_EnumConst'>archModeWrite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Write the Header & TOC to the archive FIRST 
         */ 
</span>        <a href="pg_backup_tar.c.html#LN828"><span class='Ref_To_Local'>th</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN106"><span class='Ref_to_Proto'>tarOpen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"toc.dat"</span><span class='Delimiter'>, </span><span class='String'>'w'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN827"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN90"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN828"><span class='Ref_To_Local'>th</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN383"><span class='Ref_to_Proto'>WriteHead</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.h.html#LN385"><span class='Ref_to_Proto'>WriteToc</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN107"><span class='Ref_to_Proto'>tarClose</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN828"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Not needed any more */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now send the data (tables & blobs) 
         */ 
</span>        <a href="pg_backup_archiver.h.html#LN387"><span class='Ref_to_Proto'>WriteDataChunks</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now this format wants to append a script which does a full restore 
         * if the files have been extracted. 
         */ 
</span>        <a href="pg_backup_tar.c.html#LN828"><span class='Ref_To_Local'>th</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN106"><span class='Ref_to_Proto'>tarOpen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='String'>"restore.sql"</span><span class='Delimiter'>, </span><span class='String'>'w'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Func'>tarPrintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN828"><span class='Ref_To_Local'>th</span></a><span class='Delimiter'>, </span><span class='String'>"--\n"</span> 
                  <span class='String'>"-- NOTE:\n"</span> 
                  <span class='String'>"--\n"</span> 
                  <span class='String'>"-- File paths need to be edited. Search for $$PATH$$ and\n"</span> 
                  <span class='String'>"-- replace it with the path to the directory containing\n"</span> 
                  <span class='String'>"-- the extracted data files.\n"</span> 
                  <span class='String'>"--\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN277"><span class='Ref_to_Member'>CustomOutPtr</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN913"><span class='Ref_to_Func'>_scriptOut</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN827"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN91"><span class='Ref_to_Member'>isSpecialScript</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN827"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN92"><span class='Ref_to_Member'>scriptTH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN828"><span class='Ref_To_Local'>th</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN829"><span class='Ref_To_Local'>ropt</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN285"><span class='Ref_to_Proto'>NewRestoreOptions</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN829"><span class='Ref_To_Local'>ropt</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup.h.html#LN60"><span class='Ref_to_Typedef'>RestoreOptions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN829"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN81"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN829"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN71"><span class='Ref_to_Member'>dropSchema</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN829"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN115"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN829"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN69"><span class='Ref_to_Member'>superuser</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN829"><span class='Ref_To_Local'>ropt</span></a><span class='Operator'>-&GT;</span><a href="pg_backup.h.html#LN116"><span class='Ref_to_Member'>suppressDumpWarnings</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN831"><span class='Ref_To_Local'>savDopt</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN179"><span class='Ref_to_Member'>dopt</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN830"><span class='Ref_To_Local'>savRopt</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN180"><span class='Ref_to_Member'>ropt</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN247"><span class='Ref_to_Func'>SetArchiveOptions</span></a><span class='Parentheses'>((</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN829"><span class='Ref_To_Local'>ropt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN832"><span class='Ref_To_Local'>savVerbose</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN182"><span class='Ref_to_Member'>verbose</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN182"><span class='Ref_to_Member'>verbose</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup.h.html#LN272"><span class='Ref_to_Proto'>RestoreArchive</span></a><span class='Parentheses'>((</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_archiver.c.html#LN247"><span class='Ref_to_Func'>SetArchiveOptions</span></a><span class='Parentheses'>((</span><a href="pg_backup.h.html#LN177"><span class='Ref_to_Struct'>Archive</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN831"><span class='Ref_To_Local'>savDopt</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN830"><span class='Ref_To_Local'>savRopt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>public</span><span class='Operator'>.</span><a href="pg_backup.h.html#LN182"><span class='Ref_to_Member'>verbose</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN832"><span class='Ref_To_Local'>savVerbose</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN107"><span class='Ref_to_Proto'>tarClose</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN828"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN827"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN91"><span class='Ref_to_Member'>isSpecialScript</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * EOF marker for tar files is two blocks of NULLs. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN833"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_tar.c.html#LN833"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>512</span> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>; </span><a href="pg_backup_tar.c.html#LN833"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fputc<span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN827"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span>EOF<span class='Parentheses'>)</span> 
                <a href="pg_backup_archiver.h.html#LN133"><span class='Ref_to_Const'>WRITE_ERROR_EXIT</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Sync the output file if one is defined */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN315"><span class='Ref_to_Member'>dosync</span></a> <span class='Operator'>&& </span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/common/file_utils.h.html#LN17"><span class='Ref_to_Proto'>fsync_fname</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN297"><span class='Ref_to_Member'>fSpec</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if AH-&GT;mode==archModeWri... &raquo; </span> 
 
    <a href="pg_backup_tar.c.html#LN825"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN298"><span class='Ref_to_Member'>FH</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _CloseArchive &raquo; </span> 
 
<span class='Keyword'>static </span>size_t 
<a name="LN914"></a><span class='Declare_Function'>_scriptOut</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN916"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN914"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_tar.c.html#LN594"><span class='Ref_to_Func'>tarWrite</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN914"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN914"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN916"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN92"><span class='Ref_to_Member'>scriptTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * BLOB support 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the archiver when starting to save all BLOB DATA (not schema). 
 * This routine should save whatever format-specific information is needed 
 * to read the BLOBs back into memory. 
 * 
 * It is called just prior to the dumper's DataDumper routine. 
 * 
 * Optional, but strongly recommended. 
 * 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN936"></a><span class='Declare_Function'>_StartBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN938"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN936"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN939"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>fname</span><span class='Delimiter'>[</span><a href="pg_backup_tar.c.html#LN62"><span class='Ref_to_Const'>K_STD_BUF_SIZE</span></a><span class='Delimiter'>]; 
</span> 
    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN939"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><span class='String'>"blobs.toc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN938"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN86"><span class='Ref_to_Member'>blobToc</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN106"><span class='Ref_to_Proto'>tarOpen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN936"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN939"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><span class='String'>'w'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the archiver when the dumper calls StartBlob. 
 * 
 * Mandatory. 
 * 
 * Must save the passed OID for retrieval at restore-time. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN953"></a><span class='Declare_Function'>_StartBlob</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN955"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN953"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN956"></a>    <a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN953"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN957"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>fname</span><span class='Delimiter'>[</span><span class='Number'>255</span><span class='Delimiter'>]; 
</span><a name="LN958"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sfx</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN953"><span class='Ref_to_Parameter'>oid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"invalid OID for large object (%u)\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN953"><span class='Ref_to_Parameter'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN953"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN311"><span class='Ref_to_Member'>compression</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_tar.c.html#LN958"><span class='Ref_To_Local'>sfx</span></a> <span class='Operator'>= </span><span class='String'>".gz"</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_backup_tar.c.html#LN958"><span class='Ref_To_Local'>sfx</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN957"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><span class='String'>"blob_%u.dat%s"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN953"><span class='Ref_to_Parameter'>oid</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN958"><span class='Ref_To_Local'>sfx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN112"><span class='Ref_to_Func'>tarPrintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN953"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN955"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN86"><span class='Ref_to_Member'>blobToc</span></a><span class='Delimiter'>, </span><span class='String'>"%u %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN953"><span class='Ref_to_Parameter'>oid</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN957"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN956"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN97"><span class='Ref_to_Member'>TH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN106"><span class='Ref_to_Proto'>tarOpen</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN953"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN957"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><span class='String'>'w'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _StartBlob &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Called by the archiver when the dumper calls EndBlob. 
 * 
 * Optional. 
 * 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN982"></a><span class='Declare_Function'>_EndBlob</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN984"></a>    <a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN74"><span class='Ref_to_Typedef'>lclTocEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN982"><span class='Ref_to_Parameter'>te</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN360"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN107"><span class='Ref_to_Proto'>tarClose</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN982"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN984"><span class='Ref_To_Local'>tctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN97"><span class='Ref_to_Member'>TH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Called by the archiver when finishing saving all BLOB DATA. 
 * 
 * Optional. 
 * 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN996"></a><span class='Declare_Function'>_EndBlobs</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_archiver.h.html#LN120"><span class='Ref_to_Typedef'>TocEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>te</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN998"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN996"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Write out a fake zero OID to mark end-of-blobs. */ 
</span>    <span class='Comment_Multi_Line'>/* WriteInt(AH, 0); */ 
</span> 
    <a href="pg_backup_tar.c.html#LN107"><span class='Ref_to_Proto'>tarClose</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN996"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN998"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN86"><span class='Ref_to_Member'>blobToc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
 
<span class='Comment_Multi_Line'>/*------------ 
 * TAR Support 
 *------------ 
 */ 
</span> 
<span class='Keyword'>static int 
</span><a name="LN1014"></a><span class='Declare_Function'>tarPrintf</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1016"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN1017"></a>    size_t      <span class='Declare_Local'>len</span> <span class='Operator'>= </span><span class='Number'>128</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* initial assumption about buffer size */ 
</span><a name="LN1018"></a>    size_t      <span class='Declare_Local'>cnt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1022"></a>        va_list     <span class='Declare_Local'>args</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Allocate work buffer. */ 
</span>        <a href="pg_backup_tar.c.html#LN1016"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1017"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Try to format the data. */ 
</span>        <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1022"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1014"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN1018"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN102"><span class='Ref_to_Func'>pvsnprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1016"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1017"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1014"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1022"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1022"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1018"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_tar.c.html#LN1017"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* success */ 
</span> 
        <span class='Comment_Multi_Line'>/* Release buffer and loop around to try again with larger len. */ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1016"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN1017"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN1018"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_tar.c.html#LN1018"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN594"><span class='Ref_to_Func'>tarWrite</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1016"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1018"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1014"><span class='Ref_to_Parameter'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1016"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1018"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tarPrintf &raquo; </span> 
 
<span class='Keyword'>bool 
</span><a name="LN1046"></a><span class='Declare_Function'>isValidTarHeader</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>header</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1048"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sum</span><span class='Delimiter'>; 
</span><a name="LN1049"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>chk</span> <span class='Operator'>= </span><a href="../../include/pgtar.h.html#LN25"><span class='Ref_to_Proto'>tarChecksum</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1046"><span class='Ref_to_Parameter'>header</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN1048"><span class='Ref_To_Local'>sum</span></a> <span class='Operator'>= </span><a href="../../include/pgtar.h.html#LN23"><span class='Ref_to_Proto'>read_tar_number</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN1046"><span class='Ref_to_Parameter'>header</span></a><span class='Delimiter'>[</span><span class='Number'>148</span><span class='Delimiter'>], </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1048"><span class='Ref_To_Local'>sum</span></a> <span class='Operator'>!= </span><a href="pg_backup_tar.c.html#LN1049"><span class='Ref_To_Local'>chk</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* POSIX tar format */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN1046"><span class='Ref_to_Parameter'>header</span></a><span class='Delimiter'>[</span><span class='Number'>257</span><span class='Delimiter'>], </span><span class='String'>"ustar\0"</span><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        memcmp<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN1046"><span class='Ref_to_Parameter'>header</span></a><span class='Delimiter'>[</span><span class='Number'>263</span><span class='Delimiter'>], </span><span class='String'>"00"</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* GNU tar format */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN1046"><span class='Ref_to_Parameter'>header</span></a><span class='Delimiter'>[</span><span class='Number'>257</span><span class='Delimiter'>], </span><span class='String'>"ustar  \0"</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* not-quite-POSIX format written by pre-9.3 pg_dump */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN1046"><span class='Ref_to_Parameter'>header</span></a><span class='Delimiter'>[</span><span class='Number'>257</span><span class='Delimiter'>], </span><span class='String'>"ustar00\0"</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end isValidTarHeader &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Given the member, write the TAR header & copy the file */ 
</span><span class='Keyword'>static void 
</span><a name="LN1072"></a><span class='Declare_Function'>_tarAddFile</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1074"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1072"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN1075"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>tmp</span> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN1072"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN74"><span class='Ref_to_Member'>tmpFH</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Grab it for convenience */ 
</span><a name="LN1076"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>32768</span><span class='Delimiter'>]; 
</span><a name="LN1077"></a>    size_t      <span class='Declare_Local'>cnt</span><span class='Delimiter'>; 
</span><a name="LN1078"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Local'>len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1079"></a>    size_t      <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1080"></a>    size_t      <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1081"></a>                <span class='Declare_Local'>pad</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find file len & go back to start. 
     */ 
</span>    <a href="../../port/fseeko.c.html#LN32"><span class='Ref_to_Func'>fseeko</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1075"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span>SEEK_END<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN1072"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a> <span class='Operator'>= </span><a href="../../port/fseeko.c.html#LN73"><span class='Ref_to_Func'>ftello</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1075"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1072"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not determine seek position in archive file: %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../port/fseeko.c.html#LN32"><span class='Ref_to_Func'>fseeko</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1075"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../backend/replication/basebackup.c.html#LN58"><span class='Ref_to_Proto'>_tarWriteHeader</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1072"><span class='Ref_to_Parameter'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_backup_tar.c.html#LN1077"><span class='Ref_To_Local'>cnt</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1076"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1076"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1075"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_tar.c.html#LN1079"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>fwrite<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1076"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1077"><span class='Ref_To_Local'>cnt</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1072"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN73"><span class='Ref_to_Member'>tarFH</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="pg_backup_tar.c.html#LN1077"><span class='Ref_To_Local'>cnt</span></a><span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.h.html#LN133"><span class='Ref_to_Const'>WRITE_ERROR_EXIT</span></a><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN1078"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><a href="pg_backup_tar.c.html#LN1079"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>feof<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1075"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>))</span> 
        <a href="pg_backup_archiver.h.html#LN123"><span class='Ref_to_Macro'>READ_ERROR_EXIT</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1075"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1075"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* This *should* delete it... */ 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not close temporary file: %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1078"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>!= </span><a href="pg_backup_tar.c.html#LN1072"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1110"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>buf1</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>], 
</span><a name="LN1111"></a>                    <span class='Declare_Local'>buf2</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1110"><span class='Ref_To_Local'>buf1</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1110"><span class='Ref_To_Local'>buf1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1078"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1111"><span class='Ref_To_Local'>buf2</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1111"><span class='Ref_To_Local'>buf2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1072"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"actual file length (%s) does not match expected (%s)\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_tar.c.html#LN1110"><span class='Ref_To_Local'>buf1</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1111"><span class='Ref_To_Local'>buf2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_tar.c.html#LN1081"><span class='Ref_To_Local'>pad</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="pg_backup_tar.c.html#LN1078"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>511</span><span class='Parentheses'>) </span><span class='Operator'>& ~</span><span class='Number'>511</span><span class='Parentheses'>)</span> <span class='Operator'>- </span><a href="pg_backup_tar.c.html#LN1078"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1080"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_tar.c.html#LN1080"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_tar.c.html#LN1081"><span class='Ref_To_Local'>pad</span></a><span class='Delimiter'>; </span><a href="pg_backup_tar.c.html#LN1080"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>fputc<span class='Parentheses'>(</span><span class='String'>'\0'</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1072"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN73"><span class='Ref_to_Member'>tarFH</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span>EOF<span class='Parentheses'>)</span> 
            <a href="pg_backup_archiver.h.html#LN133"><span class='Ref_to_Const'>WRITE_ERROR_EXIT</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_tar.c.html#LN1074"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN88"><span class='Ref_to_Member'>tarFHpos</span></a> <span class='Operator'>+= </span><a href="pg_backup_tar.c.html#LN1078"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><a href="pg_backup_tar.c.html#LN1081"><span class='Ref_To_Local'>pad</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _tarAddFile &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Locate the file in the archive, read header and position to data */ 
</span><span class='Keyword'>static </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>* 
</span><a name="LN1131"></a><span class='Declare_Function'>_tarPositionTo</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1133"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN1134"></a>    <a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Local'>th</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN1135"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN1136"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>header</span><span class='Delimiter'>[</span><span class='Number'>512</span><span class='Delimiter'>]; 
</span><a name="LN1137"></a>    size_t      <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1138"></a>                <span class='Declare_Local'>len</span><span class='Delimiter'>, 
</span><a name="LN1139"></a>                <span class='Declare_Local'>blks</span><span class='Delimiter'>; 
</span><a name="LN1140"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN79"><span class='Ref_to_Member'>AH</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Go to end of current file, if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1133"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN88"><span class='Ref_to_Member'>tarFHpos</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1147"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>buf1</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>], 
</span><a name="LN1148"></a>                    <span class='Declare_Local'>buf2</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1147"><span class='Ref_To_Local'>buf1</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1147"><span class='Ref_To_Local'>buf1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1133"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN88"><span class='Ref_to_Member'>tarFHpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1148"><span class='Ref_To_Local'>buf2</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1148"><span class='Ref_To_Local'>buf2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1133"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN89"><span class='Ref_to_Member'>tarNextMember</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='String'>"moving from position %s to next member at file position %s\n"</span><span class='Delimiter'>, 
</span>              <a href="pg_backup_tar.c.html#LN1147"><span class='Ref_To_Local'>buf1</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1148"><span class='Ref_To_Local'>buf2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1133"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN88"><span class='Ref_to_Member'>tarFHpos</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_tar.c.html#LN1133"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN89"><span class='Ref_to_Member'>tarNextMember</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_tar.c.html#LN517"><span class='Ref_to_Func'>_tarReadRaw</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN1135"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1133"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1160"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1160"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1160"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1133"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN88"><span class='Ref_to_Member'>tarFHpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='String'>"now at file position %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1160"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* We are at the start of the file, or at the next member */ 
</span> 
    <span class='Comment_Multi_Line'>/* Get the header */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_tar.c.html#LN1212"><span class='Ref_to_Func'>_tarGetHeader</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not find header for file \"%s\" in tar archive\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We're just scanning the archive for the next file, so return 
             * null 
             */ 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='String'>"skipping tar member %s\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_backup_tar.c.html#LN1140"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_backup_archiver.h.html#LN392"><span class='Ref_to_Proto'>TocIDRequired</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1140"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="pg_backup_archiver.h.html#LN208"><span class='Ref_to_EnumConst'>REQ_DATA</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"restoring data out of order is not supported in this archive format: "</span> 
                          <span class='String'>"\"%s\" is required, but comes before \"%s\" in the archive file.\n"</span><span class='Delimiter'>, 
</span>                          <a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Header doesn't match, so read to next header */ 
</span>        <a href="pg_backup_tar.c.html#LN1138"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a> <span class='Operator'>+ </span><span class='Number'>511</span><span class='Parentheses'>) </span><span class='Operator'>& ~</span><span class='Number'>511</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Padded length */ 
</span>        <a href="pg_backup_tar.c.html#LN1139"><span class='Ref_To_Local'>blks</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN1138"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>9</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* # of 512 byte blocks */ 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1137"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_tar.c.html#LN1137"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_backup_tar.c.html#LN1139"><span class='Ref_To_Local'>blks</span></a><span class='Delimiter'>; </span><a href="pg_backup_tar.c.html#LN1137"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_tar.c.html#LN517"><span class='Ref_to_Func'>_tarReadRaw</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN1136"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Number'>512</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1133"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_tar.c.html#LN1212"><span class='Ref_to_Func'>_tarGetHeader</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>))</span> 
            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, </span><span class='String'>"could not find header for file \"%s\" in tar archive\n"</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1131"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while filename!=NULL&&strcm... &raquo; </span> 
 
    <a href="pg_backup_tar.c.html#LN1133"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN89"><span class='Ref_to_Member'>tarNextMember</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN1133"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN88"><span class='Ref_to_Member'>tarFHpos</span></a> <span class='Operator'>+ </span><span class='Parentheses'>((</span><a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a> <span class='Operator'>+ </span><span class='Number'>511</span><span class='Parentheses'>) </span><span class='Operator'>& ~</span><span class='Number'>511</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN77"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_backup_tar.c.html#LN1134"><span class='Ref_To_Local'>th</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _tarPositionTo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Read & verify a header */ 
</span><span class='Keyword'>static int 
</span><a name="LN1213"></a><span class='Declare_Function'>_tarGetHeader</span><span class='Parentheses'>(</span><a href="pg_backup_archiver.h.html#LN119"><span class='Ref_to_Typedef'>ArchiveHandle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>AH</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1215"></a>    <a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_backup_custom.c.html#LN66"><span class='Ref_to_Typedef'>lclContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1213"><span class='Ref_to_Parameter'>AH</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_archiver.h.html#LN317"><span class='Ref_to_Member'>formatData</span></a><span class='Delimiter'>; 
</span><a name="LN1216"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>h</span><span class='Delimiter'>[</span><span class='Number'>512</span><span class='Delimiter'>]; 
</span><a name="LN1217"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tag</span><span class='Delimiter'>[</span><span class='Number'>100</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1218"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sum</span><span class='Delimiter'>, 
</span><a name="LN1219"></a>                <span class='Declare_Local'>chk</span><span class='Delimiter'>; 
</span><a name="LN1220"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN1221"></a>    <a href="../../include/port/win32.h.html#LN230"><span class='Ref_to_Const'>pgoff_t</span></a>     <span class='Declare_Local'>hPos</span><span class='Delimiter'>; 
</span><a name="LN1222"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>gotBlock</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_backup_tar.c.html#LN1222"><span class='Ref_To_Local'>gotBlock</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Save the pos for reporting purposes */ 
</span>        <a href="pg_backup_tar.c.html#LN1221"><span class='Ref_To_Local'>hPos</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN1215"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN88"><span class='Ref_to_Member'>tarFHpos</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Read a 512 byte block, return EOF, exit if short */ 
</span>        <a href="pg_backup_tar.c.html#LN1220"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN517"><span class='Ref_to_Func'>_tarReadRaw</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1213"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1216"><span class='Ref_To_Local'>h</span></a><span class='Delimiter'>, </span><span class='Number'>512</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1215"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1220"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>           <span class='Comment_Single_Line'>/* EOF */ 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1220"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>!= </span><span class='Number'>512</span><span class='Parentheses'>) 
</span>            <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                          <a href="../../include/c.h.html#LN126"><span class='Ref_to_Macro'>ngettext</span></a><span class='Parentheses'>(</span><span class='String'>"incomplete tar header found (%lu byte)\n"</span><span class='Delimiter'>, 
</span>                                 <span class='String'>"incomplete tar header found (%lu bytes)\n"</span><span class='Delimiter'>, 
</span>                                   <a href="pg_backup_tar.c.html#LN1220"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1220"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Calc checksum */ 
</span>        <a href="pg_backup_tar.c.html#LN1219"><span class='Ref_To_Local'>chk</span></a> <span class='Operator'>= </span><a href="../../include/pgtar.h.html#LN25"><span class='Ref_to_Proto'>tarChecksum</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1216"><span class='Ref_To_Local'>h</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_tar.c.html#LN1218"><span class='Ref_To_Local'>sum</span></a> <span class='Operator'>= </span><a href="../../include/pgtar.h.html#LN23"><span class='Ref_to_Proto'>read_tar_number</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN1216"><span class='Ref_To_Local'>h</span></a><span class='Delimiter'>[</span><span class='Number'>148</span><span class='Delimiter'>], </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the checksum failed, see if it is a null block. If so, silently 
         * continue to the next block. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1219"><span class='Ref_To_Local'>chk</span></a> <span class='Operator'>== </span><a href="pg_backup_tar.c.html#LN1218"><span class='Ref_To_Local'>sum</span></a><span class='Parentheses'>) 
</span>            <a href="pg_backup_tar.c.html#LN1222"><span class='Ref_To_Local'>gotBlock</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1253"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1253"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_backup_tar.c.html#LN1253"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>512</span><span class='Delimiter'>; </span><a href="pg_backup_tar.c.html#LN1253"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1216"><span class='Ref_To_Local'>h</span></a><span class='Delimiter'>[</span><a href="pg_backup_tar.c.html#LN1253"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pg_backup_tar.c.html#LN1222"><span class='Ref_To_Local'>gotBlock</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !gotBlock &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Name field is 100 bytes, might not be null-terminated */ 
</span>    <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1217"><span class='Ref_To_Local'>tag</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN1216"><span class='Ref_To_Local'>h</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Number'>100</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_backup_tar.c.html#LN1220"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../include/pgtar.h.html#LN23"><span class='Ref_to_Proto'>read_tar_number</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_backup_tar.c.html#LN1216"><span class='Ref_To_Local'>h</span></a><span class='Delimiter'>[</span><span class='Number'>124</span><span class='Delimiter'>], </span><span class='Number'>12</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1272"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>posbuf</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span><a name="LN1273"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>lenbuf</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1272"><span class='Ref_To_Local'>posbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1272"><span class='Ref_To_Local'>posbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1221"><span class='Ref_To_Local'>hPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1273"><span class='Ref_To_Local'>lenbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1273"><span class='Ref_To_Local'>lenbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pg_backup_tar.c.html#LN1220"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_archiver.c.html#LN1616"><span class='Ref_to_Func'>ahlog</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1213"><span class='Ref_to_Parameter'>AH</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='String'>"TOC Entry %s at %s (length %s, checksum %d)\n"</span><span class='Delimiter'>, 
</span>              <a href="pg_backup_tar.c.html#LN1217"><span class='Ref_To_Local'>tag</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1272"><span class='Ref_To_Local'>posbuf</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1273"><span class='Ref_To_Local'>lenbuf</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1218"><span class='Ref_To_Local'>sum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1219"><span class='Ref_To_Local'>chk</span></a> <span class='Operator'>!= </span><a href="pg_backup_tar.c.html#LN1218"><span class='Ref_To_Local'>sum</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1283"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>posbuf</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1283"><span class='Ref_To_Local'>posbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1283"><span class='Ref_To_Local'>posbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="../../port/fseeko.c.html#LN73"><span class='Ref_to_Func'>ftello</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1215"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN87"><span class='Ref_to_Member'>tarFH</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_backup_utils.c.html#LN100"><span class='Ref_to_Func'>exit_horribly</span></a><span class='Parentheses'>(</span><a href="pg_dump_sort.c.html#LN24"><span class='Ref_to_Global_Var'>modulename</span></a><span class='Delimiter'>, 
</span>                      <span class='String'>"corrupt tar header found in %s "</span> 
                      <span class='String'>"(expected %d, computed %d) file position %s\n"</span><span class='Delimiter'>, 
</span>                      <a href="pg_backup_tar.c.html#LN1217"><span class='Ref_To_Local'>tag</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1218"><span class='Ref_To_Local'>sum</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1219"><span class='Ref_To_Local'>chk</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1283"><span class='Ref_To_Local'>posbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_backup_tar.c.html#LN1213"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1217"><span class='Ref_To_Local'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_backup_tar.c.html#LN1213"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a> <span class='Operator'>= </span><a href="pg_backup_tar.c.html#LN1220"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _tarGetHeader &raquo; </span> 
 
 
<span class='Keyword'>static void 
</span><a name="LN1301"></a><span class='Declare_Function'>_tarWriteHeader</span><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN65"><span class='Ref_to_Typedef'>TAR_MEMBER</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>th</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1303"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>h</span><span class='Delimiter'>[</span><span class='Number'>512</span><span class='Delimiter'>]; 
</span> 
    <a href="../../include/pgtar.h.html#LN21"><span class='Ref_to_Proto'>tarCreateHeader</span></a><span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1303"><span class='Ref_To_Local'>h</span></a><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1301"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN75"><span class='Ref_to_Member'>targetFile</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1301"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN78"><span class='Ref_to_Member'>fileLen</span></a><span class='Delimiter'>, 
</span>                    <span class='Number'>0600</span><span class='Delimiter'>, </span><span class='Number'>04000</span><span class='Delimiter'>, </span><span class='Number'>02000</span><span class='Delimiter'>, </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now write the completed header. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><a href="pg_backup_tar.c.html#LN1303"><span class='Ref_To_Local'>h</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>512</span><span class='Delimiter'>, </span><a href="pg_backup_tar.c.html#LN1301"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pg_backup_tar.c.html#LN73"><span class='Ref_to_Member'>tarFH</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>512</span><span class='Parentheses'>)</span> 
        <a href="pg_backup_archiver.h.html#LN133"><span class='Ref_to_Const'>WRITE_ERROR_EXIT</span></a><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>