<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_dump\pg_dumpall.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_dump\pg_dumpall.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:01 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_dumpall.c 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * pg_dumpall forces all pg_dump output to be text, since it also outputs 
 * text into the same output stream. 
 * 
 * src/bin/pg_dump/pg_dumpall.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;time.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"getopt_long.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"dumputils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_backup.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/file_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"fe_utils/string_utils.h"</span> 
 
<span class='Comment_Multi_Line'>/* version string we expect back from pg_dump */ 
</span><a name="LN28"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PGDUMP_VERSIONSTR</span> <span class='String'>"pg_dump (PostgreSQL) "</span> PG_VERSION <span class='String'>"\n"</span> 
 
 
<a name="LN31"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>help</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN33"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dropRoles</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN34"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpRoles</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN35"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpRoleMembership</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN36"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpGroups</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN37"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dropTablespaces</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN38"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpTablespaces</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN39"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dropDBs</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN40"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpCreateDB</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN41"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpDatabaseConfig</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN42"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpUserConfig</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>username</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpDbRoleConfig</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN44"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>makeAlterConfigCommand</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arrayitem</span><span class='Delimiter'>, 
</span><a name="LN45"></a>                       <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>type</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>type2</span><span class='Delimiter'>, 
</span><a name="LN46"></a>                       <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpDatabases</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN48"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dumpTimestamp</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN50"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>runPgDump</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN51"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>buildShSecLabels</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>catalog_name</span><span class='Delimiter'>, 
</span><a name="LN52"></a>                 <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>objectId</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, 
</span><a name="LN53"></a>                 <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>target</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>objname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Keyword'>static </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>connectDatabase</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>connstr</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pghost</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pgport</span><span class='Delimiter'>, 
</span><a name="LN55"></a>           <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pguser</span><span class='Delimiter'>, </span><a href="pg_backup.h.html#LN29"><span class='Ref_to_Enum'>trivalue</span></a> <span class='Declare_Parameter'>prompt_password</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>fail_on_error</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN56"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>constructConnStr</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>keywords</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>values</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN57"></a><span class='Keyword'>static </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>executeQuery</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN58"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>executeCommand</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN60"></a><span class='Keyword'>static char </span><span class='Declare_Var'>pg_dump_bin</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN61"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>progname</span><span class='Delimiter'>; 
</span><a name="LN62"></a><span class='Keyword'>static </span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Var'>pgdumpopts</span><span class='Delimiter'>; 
</span><a name="LN63"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>connstr</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN64"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>skip_acls</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN65"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>verbose</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN66"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>dosync</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<a name="LN68"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>binary_upgrade</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN69"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>column_inserts</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN70"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>disable_dollar_quoting</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN71"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>disable_triggers</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>if_exists</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN73"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>inserts</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>no_tablespaces</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN75"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>use_setsessauth</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN76"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>no_publications</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN77"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>no_security_labels</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN78"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>no_subscriptions</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN79"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>no_unlogged_table_data</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN80"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>no_role_passwords</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN81"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>server_version</span><span class='Delimiter'>; 
</span> 
<a name="LN83"></a><span class='Keyword'>static char </span><span class='Declare_Var'>role_catalog</span><span class='Delimiter'>[</span><span class='Number'>10</span><span class='Delimiter'>]; 
</span><a name="LN84"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_AUTHID</span> <span class='String'>"pg_authid"</span> 
<a name="LN85"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_ROLES</span>  <span class='String'>"pg_roles "</span> 
 
<a name="LN87"></a><span class='Keyword'>static </span>FILE <span class='Operator'>*</span><span class='Declare_Var'>OPF</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>filename</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN90"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>exit_nicely</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>code</span><span class='Parentheses'>) </span><a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN90"><span class='Ref_to_Parameter'>code</span></a><span class='Parentheses'>) 
</span> 
<span class='Keyword'>int 
</span><a name="LN93"></a><span class='Declare_Function'>main</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>argv</span><span class='Delimiter'>[]</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN95"></a>    <span class='Keyword'>static </span><span class='Control'>struct</span> <a href="../../include/getopt_long.h.html#LN15"><span class='Ref_to_Struct'>option</span></a> <span class='Declare_Local'>long_options</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"data-only"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"clean"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"file"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'f'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"globals-only"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'g'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"host"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'h'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"dbname"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"database"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'l'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"oids"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'o'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-owner"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'O'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"port"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'p'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"roles-only"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'r'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"schema-only"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'s'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"superuser"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'S'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"tablespaces-only"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'t'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"username"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'U'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"verbose"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'v'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-password"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'w'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"password"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'W'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-privileges"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'x'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-acl"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'x'</span><span class='Delimiter'>}, 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * the following options don't have an equivalent short option letter 
         */ 
</span>        <span class='Delimiter'>{</span><span class='String'>"attribute-inserts"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN69"><span class='Ref_to_Global_Var'>column_inserts</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"binary-upgrade"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN68"><span class='Ref_to_Global_Var'>binary_upgrade</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"column-inserts"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN69"><span class='Ref_to_Global_Var'>column_inserts</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"disable-dollar-quoting"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN70"><span class='Ref_to_Global_Var'>disable_dollar_quoting</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"disable-triggers"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN71"><span class='Ref_to_Global_Var'>disable_triggers</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"if-exists"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN72"><span class='Ref_to_Global_Var'>if_exists</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"inserts"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN73"><span class='Ref_to_Global_Var'>inserts</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"lock-wait-timeout"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-tablespaces"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN74"><span class='Ref_to_Global_Var'>no_tablespaces</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"quote-all-identifiers"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="../../fe_utils/string_utils.c.html#LN27"><span class='Ref_to_Global_Var'>quote_all_identifiers</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"role"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"use-set-session-authorization"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN75"><span class='Ref_to_Global_Var'>use_setsessauth</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-publications"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN76"><span class='Ref_to_Global_Var'>no_publications</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-role-passwords"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN80"><span class='Ref_to_Global_Var'>no_role_passwords</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-security-labels"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN77"><span class='Ref_to_Global_Var'>no_security_labels</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-subscriptions"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN78"><span class='Ref_to_Global_Var'>no_subscriptions</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-sync"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-unlogged-table-data"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN79"><span class='Ref_to_Global_Var'>no_unlogged_table_data</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span> 
        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
<a name="LN142"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pghost</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pgport</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN144"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pguser</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN145"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pgdb</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN146"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>use_role</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN147"></a>    <a href="pg_backup.h.html#LN29"><span class='Ref_to_Enum'>trivalue</span></a>    <span class='Declare_Local'>prompt_password</span> <span class='Operator'>= </span><a href="pg_backup.h.html#LN31"><span class='Ref_to_EnumConst'>TRI_DEFAULT</span></a><span class='Delimiter'>; 
</span><a name="LN148"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>data_only</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN149"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>globals_only</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN150"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>output_clean</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN151"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>roles_only</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN152"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tablespaces_only</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN153"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span><a name="LN154"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>encoding</span><span class='Delimiter'>; 
</span><a name="LN155"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>std_strings</span><span class='Delimiter'>; 
</span><a name="LN156"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>, 
</span><a name="LN157"></a>                <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN158"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>optindex</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN93"><span class='Ref_to_Proto'>set_pglocale_pgservice</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="../../include/c.h.html#LN1009"><span class='Ref_to_Macro'>PG_TEXTDOMAIN</span></a><span class='Parentheses'>(</span><span class='String'>"pg_dump"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN49"><span class='Ref_to_Proto'>get_progname</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--help"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"-?"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../scripts/pg_isready.c.html#LN16"><span class='Ref_to_Proto'>help</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--version"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"-V"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            puts<span class='Parentheses'>(</span><span class='String'>"pg_dumpall (PostgreSQL) "</span> PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_dumpall.c.html#LN157"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN97"><span class='Ref_to_Proto'>find_other_exec</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"pg_dump"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN28"><span class='Ref_to_Const'>PGDUMP_VERSIONSTR</span></a><span class='Delimiter'>, 
</span>                               <a href="pg_dumpall.c.html#LN60"><span class='Ref_to_Global_Var'>pg_dump_bin</span></a><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN181"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>full_path</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN96"><span class='Ref_to_Proto'>find_my_exec</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="pg_dumpall.c.html#LN181"><span class='Ref_To_Local'>full_path</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN181"><span class='Ref_To_Local'>full_path</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN181"><span class='Ref_To_Local'>full_path</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN157"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"The program \"pg_dump\" is needed by %s "</span> 
                      <span class='String'>"but was not found in the\n"</span> 
                      <span class='String'>"same directory as \"%s\".\n"</span> 
                      <span class='String'>"Check your installation.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN181"><span class='Ref_To_Local'>full_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"The program \"pg_dump\" was found by \"%s\"\n"</span> 
                      <span class='String'>"but was not the same version as %s.\n"</span> 
                      <span class='String'>"Check your installation.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="pg_dumpall.c.html#LN181"><span class='Ref_To_Local'>full_path</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (ret=find_other_exec(... &raquo; </span> 
 
    <a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_dumpall.c.html#LN156"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="../../include/getopt_long.h.html#LN30"><span class='Ref_to_Proto'>getopt_long</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>, </span><span class='String'>"acd:f:gh:l:oOp:rsS:tU:vwWx"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN95"><span class='Ref_To_Local'>long_options</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN158"><span class='Ref_To_Local'>optindex</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN156"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'a'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN148"><span class='Ref_To_Local'>data_only</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" -a"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN150"><span class='Ref_To_Local'>output_clean</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN63"><span class='Ref_to_Global_Var'>connstr</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>: 
</span>                <a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" -f "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/fe_utils/string_utils.h.html#LN43"><span class='Ref_to_Proto'>appendShellString</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'g'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN149"><span class='Ref_To_Local'>globals_only</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'h'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN142"><span class='Ref_To_Local'>pghost</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'l'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN145"><span class='Ref_To_Local'>pgdb</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'o'</span><span class='Operator'>: 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" -o"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'O'</span><span class='Operator'>: 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" -O"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN143"><span class='Ref_To_Local'>pgport</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'r'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN151"><span class='Ref_To_Local'>roles_only</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>: 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" -s"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" -S "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/fe_utils/string_utils.h.html#LN43"><span class='Ref_to_Proto'>appendShellString</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN152"><span class='Ref_To_Local'>tablespaces_only</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'U'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN144"><span class='Ref_To_Local'>pguser</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'v'</span><span class='Operator'>: 
</span>                <a href="../pg_basebackup/pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" -v"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'w'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN147"><span class='Ref_To_Local'>prompt_password</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN32"><span class='Ref_to_EnumConst'>TRI_NO</span></a><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" -w"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'W'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN147"><span class='Ref_To_Local'>prompt_password</span></a> <span class='Operator'>= </span><a href="pg_backup.h.html#LN33"><span class='Ref_to_EnumConst'>TRI_YES</span></a><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" -W"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'x'</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN64"><span class='Ref_to_Global_Var'>skip_acls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" -x"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --lock-wait-timeout "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/fe_utils/string_utils.h.html#LN43"><span class='Ref_to_Proto'>appendShellString</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN146"><span class='Ref_To_Local'>use_role</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --role "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/fe_utils/string_utils.h.html#LN43"><span class='Ref_to_Proto'>appendShellString</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN146"><span class='Ref_To_Local'>use_role</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>                <a href="pg_dumpall.c.html#LN66"><span class='Ref_to_Global_Var'>dosync</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --no-sync"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch c &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (c=getopt_long(argc,a... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Complain if any arguments remain */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>&LT; </span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: too many command-line arguments (first is \"%s\")\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN93"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Make sure the user hasn't specified a mix of globals-only options */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN149"><span class='Ref_To_Local'>globals_only</span></a> <span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN151"><span class='Ref_To_Local'>roles_only</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: options -g/--globals-only and -r/--roles-only cannot be used together\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN149"><span class='Ref_To_Local'>globals_only</span></a> <span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN152"><span class='Ref_To_Local'>tablespaces_only</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: options -g/--globals-only and -t/--tablespaces-only cannot be used together\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN72"><span class='Ref_to_Global_Var'>if_exists</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN150"><span class='Ref_To_Local'>output_clean</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: option --if-exists requires option -c/--clean\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN151"><span class='Ref_To_Local'>roles_only</span></a> <span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN152"><span class='Ref_To_Local'>tablespaces_only</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: options -r/--roles-only and -t/--tablespaces-only cannot be used together\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If password values are not required in the dump, switch to using 
     * pg_roles which is equally useful, just more likely to have unrestricted 
     * access than pg_authid. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN80"><span class='Ref_to_Global_Var'>no_role_passwords</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN85"><span class='Ref_to_Const'>PG_ROLES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN84"><span class='Ref_to_Const'>PG_AUTHID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add long options to the pg_dump argument list */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN68"><span class='Ref_to_Global_Var'>binary_upgrade</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --binary-upgrade"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN69"><span class='Ref_to_Global_Var'>column_inserts</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --column-inserts"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN70"><span class='Ref_to_Global_Var'>disable_dollar_quoting</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --disable-dollar-quoting"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN71"><span class='Ref_to_Global_Var'>disable_triggers</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --disable-triggers"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN73"><span class='Ref_to_Global_Var'>inserts</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --inserts"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN74"><span class='Ref_to_Global_Var'>no_tablespaces</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --no-tablespaces"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../fe_utils/string_utils.c.html#LN27"><span class='Ref_to_Global_Var'>quote_all_identifiers</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --quote-all-identifiers"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN75"><span class='Ref_to_Global_Var'>use_setsessauth</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --use-set-session-authorization"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN76"><span class='Ref_to_Global_Var'>no_publications</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --no-publications"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN77"><span class='Ref_to_Global_Var'>no_security_labels</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --no-security-labels"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN78"><span class='Ref_to_Global_Var'>no_subscriptions</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --no-subscriptions"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN79"><span class='Ref_to_Global_Var'>no_unlogged_table_data</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Delimiter'>, </span><span class='String'>" --no-unlogged-table-data"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there was a database specified on the command line, use that, 
     * otherwise try to connect to database "postgres", and failing that 
     * "template1".  "postgres" is the preferred choice for 8.1 and later 
     * servers, but it usually will not exist on older ones. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN145"><span class='Ref_To_Local'>pgdb</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN31"><span class='Ref_to_Proto'>connectDatabase</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN145"><span class='Ref_To_Local'>pgdb</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN63"><span class='Ref_to_Global_Var'>connstr</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN142"><span class='Ref_To_Local'>pghost</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN143"><span class='Ref_To_Local'>pgport</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN144"><span class='Ref_To_Local'>pguser</span></a><span class='Delimiter'>, 
</span>                               <a href="pg_dumpall.c.html#LN147"><span class='Ref_To_Local'>prompt_password</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not connect to database \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN145"><span class='Ref_To_Local'>pgdb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN31"><span class='Ref_to_Proto'>connectDatabase</span></a><span class='Parentheses'>(</span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN63"><span class='Ref_to_Global_Var'>connstr</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN142"><span class='Ref_To_Local'>pghost</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN143"><span class='Ref_To_Local'>pgport</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN144"><span class='Ref_To_Local'>pguser</span></a><span class='Delimiter'>, 
</span>                               <a href="pg_dumpall.c.html#LN147"><span class='Ref_To_Local'>prompt_password</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) 
</span>            <a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN31"><span class='Ref_to_Proto'>connectDatabase</span></a><span class='Parentheses'>(</span><span class='String'>"template1"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN63"><span class='Ref_to_Global_Var'>connstr</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN142"><span class='Ref_To_Local'>pghost</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN143"><span class='Ref_To_Local'>pgport</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN144"><span class='Ref_To_Local'>pguser</span></a><span class='Delimiter'>, 
</span>                                   <a href="pg_dumpall.c.html#LN147"><span class='Ref_To_Local'>prompt_password</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not connect to databases \"postgres\" or \"template1\"\n"</span> 
                              <span class='String'>"Please specify an alternative database.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open the output file if required, otherwise use stdout 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open the output file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a> <span class='Operator'>= </span>stdout<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the active encoding and the standard_conforming_strings setting, so 
     * we know how to escape strings. 
     */ 
</span>    <a href="pg_dumpall.c.html#LN154"><span class='Ref_To_Local'>encoding</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN328"><span class='Ref_to_Proto'>PQclientEncoding</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN155"><span class='Ref_To_Local'>std_strings</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN319"><span class='Ref_to_Proto'>PQparameterStatus</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"standard_conforming_strings"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN155"><span class='Ref_To_Local'>std_strings</span></a><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN155"><span class='Ref_To_Local'>std_strings</span></a> <span class='Operator'>= </span><span class='String'>"off"</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set the role if requested */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN146"><span class='Ref_To_Local'>use_role</span></a> <span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>80100</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN463"></a>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN463"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"SET ROLE %s"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN146"><span class='Ref_To_Local'>use_role</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../scripts/common.h.html#LN43"><span class='Ref_to_Proto'>executeCommand</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN463"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN463"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Force quoting of all identifiers if requested. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../fe_utils/string_utils.c.html#LN27"><span class='Ref_to_Global_Var'>quote_all_identifiers</span></a> <span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90100</span><span class='Parentheses'>) 
</span>        <a href="../scripts/common.h.html#LN43"><span class='Ref_to_Proto'>executeCommand</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"SET quote_all_identifiers = true"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- PostgreSQL database cluster dump\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN48"><span class='Ref_to_Proto'>dumpTimestamp</span></a><span class='Parentheses'>(</span><span class='String'>"Started on"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We used to emit \connect postgres here, but that served no purpose 
     * other than to break things for installations without a postgres 
     * database.  Everything we're restoring here is a global, so whichever 
     * database we're connected to at the moment is fine. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Restore will need to write to the target cluster */ 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"SET default_transaction_read_only = off;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Replicate encoding and std_strings in output */ 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"SET client_encoding = '%s';\n"</span><span class='Delimiter'>, 
</span>            <a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN154"><span class='Ref_To_Local'>encoding</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"SET standard_conforming_strings = %s;\n"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN155"><span class='Ref_To_Local'>std_strings</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN155"><span class='Ref_To_Local'>std_strings</span></a><span class='Delimiter'>, </span><span class='String'>"off"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"SET escape_string_warning = off;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN148"><span class='Ref_To_Local'>data_only</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If asked to --clean, do that first.  We can avoid detailed 
         * dependency analysis because databases never depend on each other, 
         * and tablespaces never depend on each other.  Roles could have 
         * grants to each other, but DROP ROLE will clean those up silently. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN150"><span class='Ref_To_Local'>output_clean</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN149"><span class='Ref_To_Local'>globals_only</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN151"><span class='Ref_To_Local'>roles_only</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN152"><span class='Ref_To_Local'>tablespaces_only</span></a><span class='Parentheses'>) 
</span>                <a href="pg_dumpall.c.html#LN39"><span class='Ref_to_Proto'>dropDBs</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN151"><span class='Ref_To_Local'>roles_only</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN74"><span class='Ref_to_Global_Var'>no_tablespaces</span></a><span class='Parentheses'>) 
</span>                <a href="pg_dumpall.c.html#LN37"><span class='Ref_to_Proto'>dropTablespaces</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN152"><span class='Ref_To_Local'>tablespaces_only</span></a><span class='Parentheses'>) 
</span>                <a href="pg_dumpall.c.html#LN33"><span class='Ref_to_Proto'>dropRoles</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now create objects as requested.  Be careful that option logic here 
         * is the same as for drops above. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN152"><span class='Ref_To_Local'>tablespaces_only</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Dump roles (users) */ 
</span>            <a href="pg_dumpall.c.html#LN34"><span class='Ref_to_Proto'>dumpRoles</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Dump role memberships --- need different method for pre-8.1 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>80100</span><span class='Parentheses'>) 
</span>                <a href="pg_dumpall.c.html#LN35"><span class='Ref_to_Proto'>dumpRoleMembership</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_dumpall.c.html#LN36"><span class='Ref_to_Proto'>dumpGroups</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Dump tablespaces */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN151"><span class='Ref_To_Local'>roles_only</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN74"><span class='Ref_to_Global_Var'>no_tablespaces</span></a><span class='Parentheses'>) 
</span>            <a href="pg_dumpall.c.html#LN38"><span class='Ref_to_Proto'>dumpTablespaces</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Dump CREATE DATABASE commands */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN68"><span class='Ref_to_Global_Var'>binary_upgrade</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN149"><span class='Ref_To_Local'>globals_only</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN151"><span class='Ref_To_Local'>roles_only</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN152"><span class='Ref_To_Local'>tablespaces_only</span></a><span class='Parentheses'>))</span> 
            <a href="pg_dumpall.c.html#LN40"><span class='Ref_to_Proto'>dumpCreateDB</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Dump role/database settings */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN152"><span class='Ref_To_Local'>tablespaces_only</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN151"><span class='Ref_To_Local'>roles_only</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90000</span><span class='Parentheses'>) 
</span>                <a href="pg_dumpall.c.html#LN43"><span class='Ref_to_Proto'>dumpDbRoleConfig</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !data_only &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN149"><span class='Ref_To_Local'>globals_only</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN151"><span class='Ref_To_Local'>roles_only</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN152"><span class='Ref_To_Local'>tablespaces_only</span></a><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN47"><span class='Ref_to_Proto'>dumpDatabases</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN153"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN48"><span class='Ref_to_Proto'>dumpTimestamp</span></a><span class='Parentheses'>(</span><span class='String'>"Completed on"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- PostgreSQL database cluster dump complete\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        fclose<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* sync the resulting file, errors are not fatal */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN66"><span class='Ref_to_Global_Var'>dosync</span></a><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/common/file_utils.h.html#LN17"><span class='Ref_to_Proto'>fsync_fname</span></a><span class='Parentheses'>(</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end main &raquo; </span> 
 
 
<span class='Keyword'>static void 
</span><a name="LN571"></a><span class='Declare_Function'>help</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s extracts a PostgreSQL database cluster into an SQL script file.\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Usage:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s [OPTION]...\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nGeneral options:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -f, --file=FILENAME          output file name\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -v, --verbose                verbose mode\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -V, --version                output version information, then exit\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --lock-wait-timeout=TIMEOUT  fail after waiting TIMEOUT for a table lock\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -?, --help                   show this help, then exit\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nOptions controlling the output content:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -a, --data-only              dump only the data, not the schema\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -c, --clean                  clean (drop) databases before recreating\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -g, --globals-only           dump only global objects, no databases\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -o, --oids                   include OIDs in dump\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -O, --no-owner               skip restoration of object ownership\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -r, --roles-only             dump only roles, no databases or tablespaces\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -s, --schema-only            dump only the schema, no data\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -S, --superuser=NAME         superuser user name to use in the dump\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -t, --tablespaces-only       dump only tablespaces, no databases or roles\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -x, --no-privileges          do not dump privileges (grant/revoke)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --binary-upgrade             for use by upgrade utilities only\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --column-inserts             dump data as INSERT commands with column names\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --disable-dollar-quoting     disable dollar quoting, use SQL standard quoting\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --disable-triggers           disable triggers during data-only restore\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --if-exists                  use IF EXISTS when dropping objects\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --inserts                    dump data as INSERT commands, rather than COPY\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --no-publications            do not dump publications\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --no-role-passwords          do not dump passwords for roles\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --no-security-labels         do not dump security label assignments\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --no-subscriptions           do not dump subscriptions\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --no-sync                    do not wait for changes to be written safely to disk\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --no-tablespaces             do not dump tablespace assignments\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --no-unlogged-table-data     do not dump unlogged table data\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --quote-all-identifiers      quote all identifiers, even if not key words\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --use-set-session-authorization\n"</span> 
             <span class='String'>"                               use SET SESSION AUTHORIZATION commands instead of\n"</span> 
             <span class='String'>"                               ALTER OWNER commands to set ownership\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nConnection options:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -d, --dbname=CONNSTR     connect using connection string\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -h, --host=HOSTNAME      database server host or socket directory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -l, --database=DBNAME    alternative default database\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -p, --port=PORT          database server port number\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -U, --username=NAME      connect as specified database user\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -w, --no-password        never prompt for password\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -W, --password           force password prompt (should happen automatically)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --role=ROLENAME          do SET ROLE before dump\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nIf -f/--file is not used, then the SQL script will be written to the standard\n"</span> 
             <span class='String'>"output.\n\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Report bugs to &LT;pgsql-bugs@postgresql.org&GT;.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end help &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Drop roles 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN632"></a><span class='Declare_Function'>dropRoles</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN634"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN635"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN636"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i_rolname</span><span class='Delimiter'>; 
</span><a name="LN637"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90600</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN634"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT rolname "</span> 
                          <span class='String'>"FROM %s "</span> 
                          <span class='String'>"WHERE rolname !~ '^pg_' "</span> 
                          <span class='String'>"ORDER BY 1"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>80100</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN634"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT rolname "</span> 
                          <span class='String'>"FROM %s "</span> 
                          <span class='String'>"ORDER BY 1"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN634"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT usename as rolname "</span> 
                          <span class='String'>"FROM pg_shadow "</span> 
                          <span class='String'>"UNION "</span> 
                          <span class='String'>"SELECT groname as rolname "</span> 
                          <span class='String'>"FROM pg_group "</span> 
                          <span class='String'>"ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN635"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN632"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN634"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN636"><span class='Ref_To_Local'>i_rolname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN635"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN635"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- Drop roles\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN637"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN637"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN635"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN637"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN668"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>rolename</span><span class='Delimiter'>; 
</span> 
        <a href="pg_dumpall.c.html#LN668"><span class='Ref_To_Local'>rolename</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN635"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN637"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN636"><span class='Ref_To_Local'>i_rolname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"DROP ROLE %s%s;\n"</span><span class='Delimiter'>, 
</span>                <a href="pg_dumpall.c.html#LN72"><span class='Ref_to_Global_Var'>if_exists</span></a> <span class='Operator'>? </span><span class='String'>"IF EXISTS "</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                <a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN668"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN635"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN634"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dropRoles &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Dump roles 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN687"></a><span class='Declare_Function'>dumpRoles</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN689"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN690"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN691"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i_oid</span><span class='Delimiter'>, 
</span><a name="LN692"></a>                <span class='Declare_Local'>i_rolname</span><span class='Delimiter'>, 
</span><a name="LN693"></a>                <span class='Declare_Local'>i_rolsuper</span><span class='Delimiter'>, 
</span><a name="LN694"></a>                <span class='Declare_Local'>i_rolinherit</span><span class='Delimiter'>, 
</span><a name="LN695"></a>                <span class='Declare_Local'>i_rolcreaterole</span><span class='Delimiter'>, 
</span><a name="LN696"></a>                <span class='Declare_Local'>i_rolcreatedb</span><span class='Delimiter'>, 
</span><a name="LN697"></a>                <span class='Declare_Local'>i_rolcanlogin</span><span class='Delimiter'>, 
</span><a name="LN698"></a>                <span class='Declare_Local'>i_rolconnlimit</span><span class='Delimiter'>, 
</span><a name="LN699"></a>                <span class='Declare_Local'>i_rolpassword</span><span class='Delimiter'>, 
</span><a name="LN700"></a>                <span class='Declare_Local'>i_rolvaliduntil</span><span class='Delimiter'>, 
</span><a name="LN701"></a>                <span class='Declare_Local'>i_rolreplication</span><span class='Delimiter'>, 
</span><a name="LN702"></a>                <span class='Declare_Local'>i_rolbypassrls</span><span class='Delimiter'>, 
</span><a name="LN703"></a>                <span class='Declare_Local'>i_rolcomment</span><span class='Delimiter'>, 
</span><a name="LN704"></a>                <span class='Declare_Local'>i_is_current_user</span><span class='Delimiter'>; 
</span><a name="LN705"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* note: rolconfig is dumped later */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90600</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT oid, rolname, rolsuper, rolinherit, "</span> 
                          <span class='String'>"rolcreaterole, rolcreatedb, "</span> 
                          <span class='String'>"rolcanlogin, rolconnlimit, rolpassword, "</span> 
                          <span class='String'>"rolvaliduntil, rolreplication, rolbypassrls, "</span> 
                    <span class='String'>"pg_catalog.shobj_description(oid, '%s') as rolcomment, "</span> 
                          <span class='String'>"rolname = current_user AS is_current_user "</span> 
                          <span class='String'>"FROM %s "</span> 
                          <span class='String'>"WHERE rolname !~ '^pg_' "</span> 
                          <span class='String'>"ORDER BY 2"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90500</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT oid, rolname, rolsuper, rolinherit, "</span> 
                          <span class='String'>"rolcreaterole, rolcreatedb, "</span> 
                          <span class='String'>"rolcanlogin, rolconnlimit, rolpassword, "</span> 
                          <span class='String'>"rolvaliduntil, rolreplication, rolbypassrls, "</span> 
                    <span class='String'>"pg_catalog.shobj_description(oid, '%s') as rolcomment, "</span> 
                          <span class='String'>"rolname = current_user AS is_current_user "</span> 
                          <span class='String'>"FROM %s "</span> 
                          <span class='String'>"ORDER BY 2"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90100</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT oid, rolname, rolsuper, rolinherit, "</span> 
                          <span class='String'>"rolcreaterole, rolcreatedb, "</span> 
                          <span class='String'>"rolcanlogin, rolconnlimit, rolpassword, "</span> 
                          <span class='String'>"rolvaliduntil, rolreplication, "</span> 
                          <span class='String'>"false as rolbypassrls, "</span> 
                    <span class='String'>"pg_catalog.shobj_description(oid, '%s') as rolcomment, "</span> 
                          <span class='String'>"rolname = current_user AS is_current_user "</span> 
                          <span class='String'>"FROM %s "</span> 
                          <span class='String'>"ORDER BY 2"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>80200</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT oid, rolname, rolsuper, rolinherit, "</span> 
                          <span class='String'>"rolcreaterole, rolcreatedb, "</span> 
                          <span class='String'>"rolcanlogin, rolconnlimit, rolpassword, "</span> 
                          <span class='String'>"rolvaliduntil, false as rolreplication, "</span> 
                          <span class='String'>"false as rolbypassrls, "</span> 
                    <span class='String'>"pg_catalog.shobj_description(oid, '%s') as rolcomment, "</span> 
                          <span class='String'>"rolname = current_user AS is_current_user "</span> 
                          <span class='String'>"FROM %s "</span> 
                          <span class='String'>"ORDER BY 2"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>80100</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT oid, rolname, rolsuper, rolinherit, "</span> 
                          <span class='String'>"rolcreaterole, rolcreatedb, "</span> 
                          <span class='String'>"rolcanlogin, rolconnlimit, rolpassword, "</span> 
                          <span class='String'>"rolvaliduntil, false as rolreplication, "</span> 
                          <span class='String'>"false as rolbypassrls, "</span> 
                          <span class='String'>"null as rolcomment, "</span> 
                          <span class='String'>"rolname = current_user AS is_current_user "</span> 
                          <span class='String'>"FROM %s "</span> 
                          <span class='String'>"ORDER BY 2"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT 0 as oid, usename as rolname, "</span> 
                          <span class='String'>"usesuper as rolsuper, "</span> 
                          <span class='String'>"true as rolinherit, "</span> 
                          <span class='String'>"usesuper as rolcreaterole, "</span> 
                          <span class='String'>"usecreatedb as rolcreatedb, "</span> 
                          <span class='String'>"true as rolcanlogin, "</span> 
                          <span class='String'>"-1 as rolconnlimit, "</span> 
                          <span class='String'>"passwd as rolpassword, "</span> 
                          <span class='String'>"valuntil as rolvaliduntil, "</span> 
                          <span class='String'>"false as rolreplication, "</span> 
                          <span class='String'>"false as rolbypassrls, "</span> 
                          <span class='String'>"null as rolcomment, "</span> 
                          <span class='String'>"usename = current_user AS is_current_user "</span> 
                          <span class='String'>"FROM pg_shadow "</span> 
                          <span class='String'>"UNION ALL "</span> 
                          <span class='String'>"SELECT 0 as oid, groname as rolname, "</span> 
                          <span class='String'>"false as rolsuper, "</span> 
                          <span class='String'>"true as rolinherit, "</span> 
                          <span class='String'>"false as rolcreaterole, "</span> 
                          <span class='String'>"false as rolcreatedb, "</span> 
                          <span class='String'>"false as rolcanlogin, "</span> 
                          <span class='String'>"-1 as rolconnlimit, "</span> 
                          <span class='String'>"null::text as rolpassword, "</span> 
                          <span class='String'>"null::abstime as rolvaliduntil, "</span> 
                          <span class='String'>"false as rolreplication, "</span> 
                          <span class='String'>"false as rolbypassrls, "</span> 
                          <span class='String'>"null as rolcomment, "</span> 
                          <span class='String'>"false AS is_current_user "</span> 
                          <span class='String'>"FROM pg_group "</span> 
                          <span class='String'>"WHERE NOT EXISTS (SELECT 1 FROM pg_shadow "</span> 
                          <span class='String'>" WHERE usename = groname) "</span> 
                          <span class='String'>"ORDER BY 2"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN687"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN691"><span class='Ref_To_Local'>i_oid</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"oid"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN692"><span class='Ref_To_Local'>i_rolname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN693"><span class='Ref_To_Local'>i_rolsuper</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolsuper"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN694"><span class='Ref_To_Local'>i_rolinherit</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolinherit"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN695"><span class='Ref_To_Local'>i_rolcreaterole</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolcreaterole"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN696"><span class='Ref_To_Local'>i_rolcreatedb</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolcreatedb"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN697"><span class='Ref_To_Local'>i_rolcanlogin</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolcanlogin"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN698"><span class='Ref_To_Local'>i_rolconnlimit</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolconnlimit"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN699"><span class='Ref_To_Local'>i_rolpassword</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolpassword"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN700"><span class='Ref_To_Local'>i_rolvaliduntil</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolvaliduntil"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN701"><span class='Ref_To_Local'>i_rolreplication</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolreplication"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN702"><span class='Ref_To_Local'>i_rolbypassrls</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolbypassrls"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN703"><span class='Ref_To_Local'>i_rolcomment</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"rolcomment"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN704"><span class='Ref_To_Local'>i_is_current_user</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"is_current_user"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- Roles\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN819"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>rolename</span><span class='Delimiter'>; 
</span><a name="LN820"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>auth_oid</span><span class='Delimiter'>; 
</span> 
        <a href="pg_dumpall.c.html#LN820"><span class='Ref_To_Local'>auth_oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN691"><span class='Ref_To_Local'>i_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_dumpall.c.html#LN819"><span class='Ref_To_Local'>rolename</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN692"><span class='Ref_To_Local'>i_rolname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN819"><span class='Ref_To_Local'>rolename</span></a><span class='Delimiter'>, </span><span class='String'>"pg_"</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: role name starting with \"pg_\" skipped (%s)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN819"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN68"><span class='Ref_to_Global_Var'>binary_upgrade</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\n-- For binary upgrade, must preserve pg_authid.oid\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"SELECT pg_catalog.binary_upgrade_set_next_pg_authid_oid('%u'::pg_catalog.oid);\n\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_dumpall.c.html#LN820"><span class='Ref_To_Local'>auth_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We dump CREATE ROLE followed by ALTER ROLE to ensure that the role 
         * will acquire the right properties even if it already exists (ie, it 
         * won't hurt for the CREATE to fail).  This is particularly important 
         * for the role we are connected as, since even with --clean we will 
         * have failed to drop it.  binary_upgrade cannot generate any errors, 
         * so we assume the current role is already created. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN68"><span class='Ref_to_Global_Var'>binary_upgrade</span></a> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN704"><span class='Ref_To_Local'>i_is_current_user</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"f"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE ROLE %s;\n"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN819"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER ROLE %s WITH"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN819"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN693"><span class='Ref_To_Local'>i_rolsuper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"t"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" SUPERUSER"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" NOSUPERUSER"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN694"><span class='Ref_To_Local'>i_rolinherit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"t"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" INHERIT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" NOINHERIT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN695"><span class='Ref_To_Local'>i_rolcreaterole</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"t"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" CREATEROLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" NOCREATEROLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN696"><span class='Ref_To_Local'>i_rolcreatedb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"t"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" CREATEDB"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" NOCREATEDB"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN697"><span class='Ref_To_Local'>i_rolcanlogin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"t"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" LOGIN"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" NOLOGIN"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN701"><span class='Ref_To_Local'>i_rolreplication</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"t"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" REPLICATION"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" NOREPLICATION"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN702"><span class='Ref_To_Local'>i_rolbypassrls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"t"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" BYPASSRLS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" NOBYPASSRLS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN698"><span class='Ref_To_Local'>i_rolconnlimit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"-1"</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" CONNECTION LIMIT %s"</span><span class='Delimiter'>, 
</span>                              <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN698"><span class='Ref_To_Local'>i_rolconnlimit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN699"><span class='Ref_To_Local'>i_rolpassword</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN80"><span class='Ref_to_Global_Var'>no_role_passwords</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" PASSWORD "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN699"><span class='Ref_To_Local'>i_rolpassword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN687"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN700"><span class='Ref_To_Local'>i_rolvaliduntil</span></a><span class='Parentheses'>))</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" VALID UNTIL '%s'"</span><span class='Delimiter'>, 
</span>                              <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN700"><span class='Ref_To_Local'>i_rolvaliduntil</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>";\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN703"><span class='Ref_To_Local'>i_rolcomment</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"COMMENT ON ROLE %s IS "</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN819"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN703"><span class='Ref_To_Local'>i_rolcomment</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN687"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>";\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN77"><span class='Ref_to_Global_Var'>no_security_labels</span></a> <span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90200</span><span class='Parentheses'>) 
</span>            <a href="pg_dumpall.c.html#LN51"><span class='Ref_to_Proto'>buildShSecLabels</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN687"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"pg_authid"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN820"><span class='Ref_To_Local'>auth_oid</span></a><span class='Delimiter'>, 
</span>                             <a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"ROLE"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN819"><span class='Ref_To_Local'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;PQntuples(res);... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Dump configuration settings for roles after all roles have been dumped. 
     * We do it this way because config settings for roles could mention the 
     * names of other roles. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <a href="pg_dumpall.c.html#LN42"><span class='Ref_to_Proto'>dumpUserConfig</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN687"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN705"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN692"><span class='Ref_To_Local'>i_rolname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN690"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN689"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dumpRoles &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Dump role memberships.  This code is used for 8.1 and later servers. 
 * 
 * Note: we expect dumpRoles already created all the roles, but there is 
 * no membership yet. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN944"></a><span class='Declare_Function'>dumpRoleMembership</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN946"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN947"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN948"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN946"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT ur.rolname AS roleid, "</span> 
                      <span class='String'>"um.rolname AS member, "</span> 
                      <span class='String'>"a.admin_option, "</span> 
                      <span class='String'>"ug.rolname AS grantor "</span> 
                      <span class='String'>"FROM pg_auth_members a "</span> 
                      <span class='String'>"LEFT JOIN %s ur on ur.oid = a.roleid "</span> 
                      <span class='String'>"LEFT JOIN %s um on um.oid = a.member "</span> 
                      <span class='String'>"LEFT JOIN %s ug on ug.oid = a.grantor "</span> 
                    <span class='String'>"WHERE NOT (ur.rolname ~ '^pg_' AND um.rolname ~ '^pg_')"</span> 
                 <span class='String'>"ORDER BY 1,2,3"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN947"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN944"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN946"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN947"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- Role memberships\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN948"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN948"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN947"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN948"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN967"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN947"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN948"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN968"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>member</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN947"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN948"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN969"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>option</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN947"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN948"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"GRANT %s"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN967"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>" TO %s"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN968"><span class='Ref_To_Local'>member</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_dumpall.c.html#LN969"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>== </span><span class='String'>'t'</span><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>" WITH ADMIN OPTION"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't track the grantor very carefully in the backend, so cope 
         * with the possibility that it has been dropped. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN947"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN948"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN982"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>grantor</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN947"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN948"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>" GRANTED BY %s"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN982"><span class='Ref_To_Local'>grantor</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>";\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;PQntuples(res);... &raquo; </span> 
 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN947"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN946"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dumpRoleMembership &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Dump group memberships from a pre-8.1 server.  It's annoying that we 
 * can't share any useful amount of code with the post-8.1 case, but 
 * the catalog representations are too different. 
 * 
 * Note: we expect dumpRoles already created all the roles, but there is 
 * no membership yet. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1004"></a><span class='Declare_Function'>dumpGroups</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1006"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1007"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1008"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN1007"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1004"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                       <span class='String'>"SELECT groname, grolist FROM pg_group ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1007"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- Role memberships\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1008"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1008"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1007"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1008"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1018"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>groname</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1007"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1008"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1019"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>grolist</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1007"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1008"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1020"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res2</span><span class='Delimiter'>; 
</span><a name="LN1021"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Array representation is {1,2,3} ... convert to (1,2,3) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1019"><span class='Ref_To_Local'>grolist</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="pg_dumpall.c.html#LN1019"><span class='Ref_To_Local'>grolist</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1019"><span class='Ref_To_Local'>grolist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_dumpall.c.html#LN1019"><span class='Ref_To_Local'>grolist</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'('</span><span class='Delimiter'>; 
</span>        <a href="pg_dumpall.c.html#LN1019"><span class='Ref_To_Local'>grolist</span></a><span class='Delimiter'>[</span>strlen<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1019"><span class='Ref_To_Local'>grolist</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>')'</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1006"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT usename FROM pg_shadow "</span> 
                          <span class='String'>"WHERE usesysid IN %s ORDER BY 1"</span><span class='Delimiter'>, 
</span>                          <a href="pg_dumpall.c.html#LN1019"><span class='Ref_To_Local'>grolist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1019"><span class='Ref_To_Local'>grolist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_dumpall.c.html#LN1020"><span class='Ref_To_Local'>res2</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1004"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1006"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1021"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1021"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1020"><span class='Ref_To_Local'>res2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1021"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1042"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>usename</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1020"><span class='Ref_To_Local'>res2</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1021"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Don't try to grant a role to itself; can happen if old 
             * installation has identically named user and group. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1018"><span class='Ref_To_Local'>groname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1042"><span class='Ref_To_Local'>usename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"GRANT %s"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1018"><span class='Ref_To_Local'>groname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>" TO %s;\n"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1042"><span class='Ref_To_Local'>usename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1020"><span class='Ref_To_Local'>res2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;PQntuples(res);... &raquo; </span> 
 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1007"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1006"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dumpGroups &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Drop tablespaces. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1069"></a><span class='Declare_Function'>dropTablespaces</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1071"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1072"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get all tablespaces except built-in ones (which we assume are named 
     * pg_xxx) 
     */ 
</span>    <a href="pg_dumpall.c.html#LN1071"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1069"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT spcname "</span> 
                       <span class='String'>"FROM pg_catalog.pg_tablespace "</span> 
                       <span class='String'>"WHERE spcname !~ '^pg_' "</span> 
                       <span class='String'>"ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1071"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- Drop tablespaces\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1072"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1072"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1071"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1072"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1088"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>spcname</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1071"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1072"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"DROP TABLESPACE %s%s;\n"</span><span class='Delimiter'>, 
</span>                <a href="pg_dumpall.c.html#LN72"><span class='Ref_to_Global_Var'>if_exists</span></a> <span class='Operator'>? </span><span class='String'>"IF EXISTS "</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                <a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1088"><span class='Ref_To_Local'>spcname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1071"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dropTablespaces &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Dump tablespaces. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1104"></a><span class='Declare_Function'>dumpTablespaces</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1106"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1107"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get all tablespaces except built-in ones (which we assume are named 
     * pg_xxx) 
     * 
     * For the tablespace ACLs, as of 9.6, we extract both the positive (as 
     * spcacl) and negative (as rspcacl) ACLs, relative to the default ACL for 
     * tablespaces, which are then passed to buildACLCommands() below. 
     * 
     * See buildACLQueries() and buildACLCommands(). 
     * 
     * Note that we do not support initial privileges (pg_init_privs) on 
     * tablespaces. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90600</span><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1104"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT oid, spcname, "</span> 
                         <span class='String'>"pg_catalog.pg_get_userbyid(spcowner) AS spcowner, "</span> 
                           <span class='String'>"pg_catalog.pg_tablespace_location(oid), "</span> 
                           <span class='String'>"(SELECT pg_catalog.array_agg(acl) FROM (SELECT pg_catalog.unnest(coalesce(spcacl,pg_catalog.acldefault('t',spcowner))) AS acl "</span> 
                           <span class='String'>"EXCEPT SELECT pg_catalog.unnest(pg_catalog.acldefault('t',spcowner))) as foo)"</span> 
                           <span class='String'>"AS spcacl,"</span> 
                           <span class='String'>"(SELECT pg_catalog.array_agg(acl) FROM (SELECT pg_catalog.unnest(pg_catalog.acldefault('t',spcowner)) AS acl "</span> 
                           <span class='String'>"EXCEPT SELECT pg_catalog.unnest(coalesce(spcacl,pg_catalog.acldefault('t',spcowner)))) as foo)"</span> 
                           <span class='String'>"AS rspcacl,"</span> 
                           <span class='String'>"array_to_string(spcoptions, ', '),"</span> 
                        <span class='String'>"pg_catalog.shobj_description(oid, 'pg_tablespace') "</span> 
                           <span class='String'>"FROM pg_catalog.pg_tablespace "</span> 
                           <span class='String'>"WHERE spcname !~ '^pg_' "</span> 
                           <span class='String'>"ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90200</span><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1104"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT oid, spcname, "</span> 
                         <span class='String'>"pg_catalog.pg_get_userbyid(spcowner) AS spcowner, "</span> 
                           <span class='String'>"pg_catalog.pg_tablespace_location(oid), "</span> 
                           <span class='String'>"spcacl, '' as rspcacl, "</span> 
                           <span class='String'>"array_to_string(spcoptions, ', '),"</span> 
                        <span class='String'>"pg_catalog.shobj_description(oid, 'pg_tablespace') "</span> 
                           <span class='String'>"FROM pg_catalog.pg_tablespace "</span> 
                           <span class='String'>"WHERE spcname !~ '^pg_' "</span> 
                           <span class='String'>"ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90000</span><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1104"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT oid, spcname, "</span> 
                         <span class='String'>"pg_catalog.pg_get_userbyid(spcowner) AS spcowner, "</span> 
                           <span class='String'>"spclocation, spcacl, '' as rspcacl, "</span> 
                           <span class='String'>"array_to_string(spcoptions, ', '),"</span> 
                        <span class='String'>"pg_catalog.shobj_description(oid, 'pg_tablespace') "</span> 
                           <span class='String'>"FROM pg_catalog.pg_tablespace "</span> 
                           <span class='String'>"WHERE spcname !~ '^pg_' "</span> 
                           <span class='String'>"ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>80200</span><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1104"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT oid, spcname, "</span> 
                         <span class='String'>"pg_catalog.pg_get_userbyid(spcowner) AS spcowner, "</span> 
                           <span class='String'>"spclocation, spcacl, '' as rspcacl, null, "</span> 
                        <span class='String'>"pg_catalog.shobj_description(oid, 'pg_tablespace') "</span> 
                           <span class='String'>"FROM pg_catalog.pg_tablespace "</span> 
                           <span class='String'>"WHERE spcname !~ '^pg_' "</span> 
                           <span class='String'>"ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1104"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT oid, spcname, "</span> 
                         <span class='String'>"pg_catalog.pg_get_userbyid(spcowner) AS spcowner, "</span> 
                           <span class='String'>"spclocation, spcacl, '' as rspcacl, "</span> 
                           <span class='String'>"null, null "</span> 
                           <span class='String'>"FROM pg_catalog.pg_tablespace "</span> 
                           <span class='String'>"WHERE spcname !~ '^pg_' "</span> 
                           <span class='String'>"ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- Tablespaces\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1178"></a>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1179"></a>        <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>spcoid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN1180"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>spcname</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1181"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>spcowner</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1182"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>spclocation</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1183"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>spcacl</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1184"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rspcacl</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1185"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>spcoptions</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1186"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>spccomment</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1107"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1187"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fspcname</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* needed for buildACLCommands() */ 
</span>        <a href="pg_dumpall.c.html#LN1187"><span class='Ref_To_Local'>fspcname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1180"><span class='Ref_To_Local'>spcname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE TABLESPACE %s"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1187"><span class='Ref_To_Local'>fspcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" OWNER %s"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1181"><span class='Ref_To_Local'>spcowner</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" LOCATION "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1182"><span class='Ref_To_Local'>spclocation</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1104"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>";\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1185"><span class='Ref_To_Local'>spcoptions</span></a> <span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN1185"><span class='Ref_To_Local'>spcoptions</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLESPACE %s SET (%s);\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_dumpall.c.html#LN1187"><span class='Ref_To_Local'>fspcname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1185"><span class='Ref_To_Local'>spcoptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN64"><span class='Ref_to_Global_Var'>skip_acls</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="dumputils.h.html#LN38"><span class='Ref_to_Proto'>buildACLCommands</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1187"><span class='Ref_To_Local'>fspcname</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>"TABLESPACE"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1183"><span class='Ref_To_Local'>spcacl</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1184"><span class='Ref_To_Local'>rspcacl</span></a><span class='Delimiter'>, 
</span>                              <a href="pg_dumpall.c.html#LN1181"><span class='Ref_To_Local'>spcowner</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not parse ACL list (%s) for tablespace \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1183"><span class='Ref_To_Local'>spcacl</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1187"><span class='Ref_To_Local'>fspcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1104"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1186"><span class='Ref_To_Local'>spccomment</span></a> <span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1186"><span class='Ref_To_Local'>spccomment</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"COMMENT ON TABLESPACE %s IS "</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1187"><span class='Ref_To_Local'>fspcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1186"><span class='Ref_To_Local'>spccomment</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1104"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>";\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN77"><span class='Ref_to_Global_Var'>no_security_labels</span></a> <span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90200</span><span class='Parentheses'>) 
</span>            <a href="pg_dumpall.c.html#LN51"><span class='Ref_to_Proto'>buildShSecLabels</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1104"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"pg_tablespace"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1179"><span class='Ref_To_Local'>spcoid</span></a><span class='Delimiter'>, 
</span>                             <a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"TABLESPACE"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1187"><span class='Ref_To_Local'>fspcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1187"><span class='Ref_To_Local'>fspcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1178"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;PQntuples(res);... &raquo; </span> 
 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1106"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dumpTablespaces &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Dump commands to drop each database. 
 * 
 * This should match the set of databases targeted by dumpCreateDB(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1241"></a><span class='Declare_Function'>dropDBs</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1243"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1244"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN1243"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1241"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                       <span class='String'>"SELECT datname "</span> 
                       <span class='String'>"FROM pg_database d "</span> 
                       <span class='String'>"WHERE datallowconn ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1243"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- Drop databases\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1244"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1244"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1243"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1244"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1256"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbname</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1243"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1244"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Skip "template1" and "postgres"; the restore script is almost 
         * certainly going to be run in one or the other, and we don't know 
         * which.  This must agree with dumpCreateDB's choices! 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1256"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><span class='String'>"template1"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1256"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><span class='String'>"postgres"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"DROP DATABASE %s%s;\n"</span><span class='Delimiter'>, 
</span>                    <a href="pg_dumpall.c.html#LN72"><span class='Ref_to_Global_Var'>if_exists</span></a> <span class='Operator'>? </span><span class='String'>"IF EXISTS "</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                    <a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1256"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1243"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dropDBs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Dump commands to create each database. 
 * 
 * To minimize the number of reconnections (and possibly ensuing 
 * password prompts) required by the output script, we emit all CREATE 
 * DATABASE commands during the initial phase of the script, and then 
 * run pg_dump for each database to dump the contents of that 
 * database.  We skip databases marked not datallowconn, since we'd be 
 * unable to connect to them anyway (and besides, we don't want to 
 * dump template0). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1289"></a><span class='Declare_Function'>dumpCreateDB</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1291"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1292"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>default_encoding</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1293"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>default_collate</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1294"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>default_ctype</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1295"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1296"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- Database creation\n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, get the installation's default encoding and locale information. 
     * We will dump encoding and locale specifications in the CREATE DATABASE 
     * commands for just those databases with values different from defaults. 
     * 
     * We consider template0's encoding and locale to define the installation 
     * default.  Pre-8.4 installations do not have per-database locale 
     * settings; for them, every database must necessarily be using the 
     * installation default, so there's no need to do anything. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>80400</span><span class='Parentheses'>) 
</span>        <a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1289"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                           <span class='String'>"SELECT pg_encoding_to_char(encoding), "</span> 
                           <span class='String'>"datcollate, datctype "</span> 
                           <span class='String'>"FROM pg_database "</span> 
                           <span class='String'>"WHERE datname = 'template0'"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1289"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                           <span class='String'>"SELECT pg_encoding_to_char(encoding), "</span> 
                           <span class='String'>"null::text AS datcollate, null::text AS datctype "</span> 
                           <span class='String'>"FROM pg_database "</span> 
                           <span class='String'>"WHERE datname = 'template0'"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If for some reason the template DB isn't there, treat as unknown */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <a href="pg_dumpall.c.html#LN1292"><span class='Ref_To_Local'>default_encoding</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="pg_dumpall.c.html#LN1293"><span class='Ref_To_Local'>default_collate</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>))</span> 
            <a href="pg_dumpall.c.html#LN1294"><span class='Ref_To_Local'>default_ctype</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now collect all the information about databases to dump. 
     * 
     * For the database ACLs, as of 9.6, we extract both the positive (as 
     * datacl) and negative (as rdatacl) ACLs, relative to the default ACL for 
     * databases, which are then passed to buildACLCommands() below. 
     * 
     * See buildACLQueries() and buildACLCommands(). 
     * 
     * Note that we do not support initial privileges (pg_init_privs) on 
     * databases. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90600</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT datname, "</span> 
                          <span class='String'>"coalesce(rolname, (select rolname from %s where oid=(select datdba from pg_database where datname='template0'))), "</span> 
                          <span class='String'>"pg_encoding_to_char(d.encoding), "</span> 
                          <span class='String'>"datcollate, datctype, datfrozenxid, datminmxid, "</span> 
                          <span class='String'>"datistemplate, "</span> 
                          <span class='String'>"(SELECT pg_catalog.array_agg(acl ORDER BY acl::text COLLATE \"C\") FROM ( "</span> 
                          <span class='String'>"  SELECT pg_catalog.unnest(coalesce(datacl,pg_catalog.acldefault('d',datdba))) AS acl "</span> 
                          <span class='String'>"  EXCEPT SELECT pg_catalog.unnest(pg_catalog.acldefault('d',datdba))) as datacls)"</span> 
                          <span class='String'>"AS datacl, "</span> 
                          <span class='String'>"(SELECT pg_catalog.array_agg(acl ORDER BY acl::text COLLATE \"C\") FROM ( "</span> 
                          <span class='String'>"  SELECT pg_catalog.unnest(pg_catalog.acldefault('d',datdba)) AS acl "</span> 
                          <span class='String'>"  EXCEPT SELECT pg_catalog.unnest(coalesce(datacl,pg_catalog.acldefault('d',datdba)))) as rdatacls)"</span> 
                          <span class='String'>"AS rdatacl, "</span> 
                          <span class='String'>"datconnlimit, "</span> 
                          <span class='String'>"(SELECT spcname FROM pg_tablespace t WHERE t.oid = d.dattablespace) AS dattablespace "</span> 
                     <span class='String'>"FROM pg_database d LEFT JOIN %s u ON (datdba = u.oid) "</span> 
                <span class='String'>"WHERE datallowconn ORDER BY 1"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90300</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT datname, "</span> 
                          <span class='String'>"coalesce(rolname, (select rolname from %s where oid=(select datdba from pg_database where datname='template0'))), "</span> 
                          <span class='String'>"pg_encoding_to_char(d.encoding), "</span> 
                          <span class='String'>"datcollate, datctype, datfrozenxid, datminmxid, "</span> 
                          <span class='String'>"datistemplate, datacl, '' as rdatacl, "</span> 
                          <span class='String'>"datconnlimit, "</span> 
                          <span class='String'>"(SELECT spcname FROM pg_tablespace t WHERE t.oid = d.dattablespace) AS dattablespace "</span> 
                     <span class='String'>"FROM pg_database d LEFT JOIN %s u ON (datdba = u.oid) "</span> 
                <span class='String'>"WHERE datallowconn ORDER BY 1"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>80400</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT datname, "</span> 
                          <span class='String'>"coalesce(rolname, (select rolname from %s where oid=(select datdba from pg_database where datname='template0'))), "</span> 
                          <span class='String'>"pg_encoding_to_char(d.encoding), "</span> 
                      <span class='String'>"datcollate, datctype, datfrozenxid, 0 AS datminmxid, "</span> 
                          <span class='String'>"datistemplate, datacl, '' as rdatacl, "</span> 
                          <span class='String'>"datconnlimit, "</span> 
                          <span class='String'>"(SELECT spcname FROM pg_tablespace t WHERE t.oid = d.dattablespace) AS dattablespace "</span> 
                     <span class='String'>"FROM pg_database d LEFT JOIN %s u ON (datdba = u.oid) "</span> 
                <span class='String'>"WHERE datallowconn ORDER BY 1"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>80100</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT datname, "</span> 
                          <span class='String'>"coalesce(rolname, (select rolname from %s where oid=(select datdba from pg_database where datname='template0'))), "</span> 
                          <span class='String'>"pg_encoding_to_char(d.encoding), "</span> 
                          <span class='String'>"null::text AS datcollate, null::text AS datctype, datfrozenxid, 0 AS datminmxid, "</span> 
                          <span class='String'>"datistemplate, datacl, '' as rdatacl, "</span> 
                          <span class='String'>"datconnlimit, "</span> 
                          <span class='String'>"(SELECT spcname FROM pg_tablespace t WHERE t.oid = d.dattablespace) AS dattablespace "</span> 
                     <span class='String'>"FROM pg_database d LEFT JOIN %s u ON (datdba = u.oid) "</span> 
                <span class='String'>"WHERE datallowconn ORDER BY 1"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                          <span class='String'>"SELECT datname, "</span> 
                          <span class='String'>"coalesce(usename, (select usename from pg_shadow where usesysid=(select datdba from pg_database where datname='template0'))), "</span> 
                          <span class='String'>"pg_encoding_to_char(d.encoding), "</span> 
                          <span class='String'>"null::text AS datcollate, null::text AS datctype, datfrozenxid, 0 AS datminmxid, "</span> 
                          <span class='String'>"datistemplate, datacl, '' as rdatacl, "</span> 
                          <span class='String'>"-1 as datconnlimit, "</span> 
                          <span class='String'>"(SELECT spcname FROM pg_tablespace t WHERE t.oid = d.dattablespace) AS dattablespace "</span> 
           <span class='String'>"FROM pg_database d LEFT JOIN pg_shadow u ON (datdba = usesysid) "</span> 
                          <span class='String'>"WHERE datallowconn ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1289"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1417"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbname</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1418"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbowner</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1419"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbencoding</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1420"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbcollate</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1421"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbctype</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1422"></a>        <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>dbfrozenxid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN1423"></a>        <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>dbminmxid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN1424"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbistemplate</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1425"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbacl</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1426"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rdbacl</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>9</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1427"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbconnlimit</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1428"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbtablespace</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1296"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1429"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fdbname</span><span class='Delimiter'>; 
</span> 
        <a href="pg_dumpall.c.html#LN1429"><span class='Ref_To_Local'>fdbname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1417"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Skip the CREATE DATABASE commands for "template1" and "postgres", 
         * since they are presumably already there in the destination cluster. 
         * We do want to emit their ACLs and config options if any, however. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1417"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><span class='String'>"template1"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1417"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><span class='String'>"postgres"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE DATABASE %s"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1429"><span class='Ref_To_Local'>fdbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" WITH TEMPLATE = template0"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1418"><span class='Ref_To_Local'>dbowner</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" OWNER = %s"</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1418"><span class='Ref_To_Local'>dbowner</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1292"><span class='Ref_To_Local'>default_encoding</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1419"><span class='Ref_To_Local'>dbencoding</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1292"><span class='Ref_To_Local'>default_encoding</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" ENCODING = "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1419"><span class='Ref_To_Local'>dbencoding</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1289"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1293"><span class='Ref_To_Local'>default_collate</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1420"><span class='Ref_To_Local'>dbcollate</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1293"><span class='Ref_To_Local'>default_collate</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" LC_COLLATE = "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1420"><span class='Ref_To_Local'>dbcollate</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1289"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1294"><span class='Ref_To_Local'>default_ctype</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1421"><span class='Ref_To_Local'>dbctype</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1294"><span class='Ref_To_Local'>default_ctype</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" LC_CTYPE = "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1421"><span class='Ref_To_Local'>dbctype</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1289"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Output tablespace if it isn't the default.  For default, it 
             * uses the default from the template database.  If tablespace is 
             * specified and tablespace creation failed earlier, (e.g. no such 
             * directory), the database creation will fail too.  One solution 
             * would be to use 'SET default_tablespace' like we do in pg_dump 
             * for setting non-default database locations. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1428"><span class='Ref_To_Local'>dbtablespace</span></a><span class='Delimiter'>, </span><span class='String'>"pg_default"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN74"><span class='Ref_to_Global_Var'>no_tablespaces</span></a><span class='Parentheses'>)</span> 
                <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" TABLESPACE = %s"</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1428"><span class='Ref_To_Local'>dbtablespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1424"><span class='Ref_To_Local'>dbistemplate</span></a><span class='Delimiter'>, </span><span class='String'>"t"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" IS_TEMPLATE = true"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1427"><span class='Ref_To_Local'>dbconnlimit</span></a><span class='Delimiter'>, </span><span class='String'>"-1"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" CONNECTION LIMIT = %s"</span><span class='Delimiter'>, 
</span>                                  <a href="pg_dumpall.c.html#LN1427"><span class='Ref_To_Local'>dbconnlimit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>";\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(dbname,"templa... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1428"><span class='Ref_To_Local'>dbtablespace</span></a><span class='Delimiter'>, </span><span class='String'>"pg_default"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN74"><span class='Ref_to_Global_Var'>no_tablespaces</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Cannot change tablespace of the database we're connected to, so 
             * to move "postgres" to another tablespace, we connect to 
             * "template1", and vice versa. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1417"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><span class='String'>"postgres"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\connect template1\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\connect postgres\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER DATABASE %s SET TABLESPACE %s;\n"</span><span class='Delimiter'>, 
</span>                              <a href="pg_dumpall.c.html#LN1429"><span class='Ref_To_Local'>fdbname</span></a><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1428"><span class='Ref_To_Local'>dbtablespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* connect to original database */ 
</span>            <a href="../../include/fe_utils/string_utils.h.html#LN46"><span class='Ref_to_Proto'>appendPsqlMetaConnect</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1417"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN68"><span class='Ref_to_Global_Var'>binary_upgrade</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"-- For binary upgrade, set datfrozenxid and datminmxid.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"UPDATE pg_catalog.pg_database "</span> 
                              <span class='String'>"SET datfrozenxid = '%u', datminmxid = '%u' "</span> 
                              <span class='String'>"WHERE datname = "</span><span class='Delimiter'>, 
</span>                              <a href="pg_dumpall.c.html#LN1422"><span class='Ref_To_Local'>dbfrozenxid</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1423"><span class='Ref_To_Local'>dbminmxid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1417"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1289"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>";\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN64"><span class='Ref_to_Global_Var'>skip_acls</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="dumputils.h.html#LN38"><span class='Ref_to_Proto'>buildACLCommands</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1429"><span class='Ref_To_Local'>fdbname</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>"DATABASE"</span><span class='Delimiter'>, 
</span>                              <a href="pg_dumpall.c.html#LN1425"><span class='Ref_To_Local'>dbacl</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1426"><span class='Ref_To_Local'>rdbacl</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1418"><span class='Ref_To_Local'>dbowner</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>""</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not parse ACL list (%s) for database \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1425"><span class='Ref_To_Local'>dbacl</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1429"><span class='Ref_To_Local'>fdbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1289"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_dumpall.c.html#LN41"><span class='Ref_to_Proto'>dumpDatabaseConfig</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1289"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1417"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1429"><span class='Ref_To_Local'>fdbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;PQntuples(res);... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1292"><span class='Ref_To_Local'>default_encoding</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1292"><span class='Ref_To_Local'>default_encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1293"><span class='Ref_To_Local'>default_collate</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1293"><span class='Ref_To_Local'>default_collate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1294"><span class='Ref_To_Local'>default_ctype</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1294"><span class='Ref_To_Local'>default_ctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1295"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1291"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dumpCreateDB &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Dump database-specific configuration 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1555"></a><span class='Declare_Function'>dumpDatabaseConfig</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1557"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1558"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1562"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90000</span><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1557"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT setconfig[%d] FROM pg_db_role_setting WHERE "</span> 
                              <span class='String'>"setrole = 0 AND setdatabase = (SELECT oid FROM pg_database WHERE datname = "</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1558"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1557"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT datconfig[%d] FROM pg_database WHERE datname = "</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1558"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1557"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1555"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1555"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90000</span><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1557"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>")"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_dumpall.c.html#LN1562"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1555"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1557"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1562"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1562"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN44"><span class='Ref_to_Proto'>makeAlterConfigCommand</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1555"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1562"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <span class='String'>"DATABASE"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1555"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1562"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1558"><span class='Ref_To_Local'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1562"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1557"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dumpDatabaseConfig &raquo; </span> 
 
 
 
<span class='Comment_Multi_Line'>/* 
 * Dump user-specific configuration 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1599"></a><span class='Declare_Function'>dumpUserConfig</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>username</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1601"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1602"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1606"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90000</span><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1601"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT setconfig[%d] FROM pg_db_role_setting WHERE "</span> 
                              <span class='String'>"setdatabase = 0 AND setrole = "</span> 
                <span class='String'>"(SELECT oid FROM %s WHERE rolname = "</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1602"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>80100</span><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1601"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT rolconfig[%d] FROM %s WHERE rolname = "</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1602"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1601"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT useconfig[%d] FROM pg_shadow WHERE usename = "</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1602"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1601"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1599"><span class='Ref_to_Parameter'>username</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1599"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&GT;= </span><span class='Number'>90000</span><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1601"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>')'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_dumpall.c.html#LN1606"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1599"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1601"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1606"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1606"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN44"><span class='Ref_to_Proto'>makeAlterConfigCommand</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1599"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1606"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <span class='String'>"ROLE"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1599"><span class='Ref_to_Parameter'>username</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1606"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1602"><span class='Ref_To_Local'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1606"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1601"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dumpUserConfig &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Dump user-and-database-specific configuration 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1644"></a><span class='Declare_Function'>dumpDbRoleConfig</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1646"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1647"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1648"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1646"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT rolname, datname, unnest(setconfig) "</span> 
                      <span class='String'>"FROM pg_db_role_setting, %s u, pg_database "</span> 
    <span class='String'>"WHERE setrole = u.oid AND setdatabase = pg_database.oid"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN83"><span class='Ref_to_Global_Var'>role_catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN1647"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1644"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1646"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1647"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"--\n-- Per-Database Role Settings \n--\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1648"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1648"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1647"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1648"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN44"><span class='Ref_to_Proto'>makeAlterConfigCommand</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1644"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1647"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1648"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <span class='String'>"ROLE"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1647"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1648"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <span class='String'>"DATABASE"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1647"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1648"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1647"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1646"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dumpDbRoleConfig &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Helper function for dumpXXXConfig(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1678"></a><span class='Declare_Function'>makeAlterConfigCommand</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arrayitem</span><span class='Delimiter'>, 
</span><a name="LN1679"></a>                       <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>type</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, 
</span><a name="LN1680"></a>                       <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>type2</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1682"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pos</span><span class='Delimiter'>; 
</span><a name="LN1683"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>mine</span><span class='Delimiter'>; 
</span><a name="LN1684"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN1683"><span class='Ref_To_Local'>mine</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1678"><span class='Ref_to_Parameter'>arrayitem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN1682"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1683"><span class='Ref_To_Local'>mine</span></a><span class='Delimiter'>, </span><span class='String'>'='</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1682"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1683"><span class='Ref_To_Local'>mine</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_dumpall.c.html#LN1684"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="pg_dumpall.c.html#LN1682"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1684"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER %s %s "</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1679"><span class='Ref_to_Parameter'>type</span></a><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1679"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1680"><span class='Ref_to_Parameter'>type2</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN1680"><span class='Ref_to_Parameter'>name2</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1684"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"IN %s %s "</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1680"><span class='Ref_to_Parameter'>type2</span></a><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1680"><span class='Ref_to_Parameter'>name2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1684"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"SET %s TO "</span><span class='Delimiter'>, </span><a href="../../include/fe_utils/string_utils.h.html#LN26"><span class='Ref_to_Proto'>fmtId</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1683"><span class='Ref_To_Local'>mine</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Some GUC variable names are 'LIST' type and hence must not be quoted. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1683"><span class='Ref_To_Local'>mine</span></a><span class='Delimiter'>, </span><span class='String'>"DateStyle"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> 
        <span class='Operator'>|| </span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1683"><span class='Ref_To_Local'>mine</span></a><span class='Delimiter'>, </span><span class='String'>"search_path"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1684"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1682"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/fe_utils/string_utils.h.html#LN35"><span class='Ref_to_Proto'>appendStringLiteralConn</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1684"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1682"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1678"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1684"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>";\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1684"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1684"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1683"><span class='Ref_To_Local'>mine</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeAlterConfigCommand &raquo; </span> 
 
 
 
<span class='Comment_Multi_Line'>/* 
 * Dump contents of databases. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1723"></a><span class='Declare_Function'>dumpDatabases</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1725"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1726"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN1725"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1723"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT datname FROM pg_database WHERE datallowconn ORDER BY 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1726"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1726"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1725"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1726"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1732"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
<a name="LN1734"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbname</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1725"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1726"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1735"></a>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>connectbuf</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: dumping database \"%s\"...\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1734"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN1735"><span class='Ref_To_Local'>connectbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fe_utils/string_utils.h.html#LN46"><span class='Ref_to_Proto'>appendPsqlMetaConnect</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN1735"><span class='Ref_To_Local'>connectbuf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1734"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1735"><span class='Ref_To_Local'>connectbuf</span></a><span class='Operator'>.</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN1735"><span class='Ref_To_Local'>connectbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restore will need to write to the target cluster.  This connection 
         * setting is emitted for pg_dumpall rather than in the code also used 
         * by pg_dump, so that a cluster with databases or users which have 
         * this flag turned on can still be replicated through pg_dumpall 
         * without editing the file or stream.  With pg_dump there are many 
         * other ways to allow the file to be used, and leaving it out allows 
         * users to protect databases from being accidental restore targets. 
         */ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"SET default_transaction_read_only = off;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Parentheses'>) 
</span>            fclose<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_dumpall.c.html#LN1732"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="pg_dumpall.c.html#LN50"><span class='Ref_to_Proto'>runPgDump</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1734"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1732"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: pg_dump failed on database \"%s\", exiting\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1734"><span class='Ref_To_Local'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1033"><span class='Ref_to_Const'>PG_BINARY_A</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not re-open the output file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;PQntuples(res);... &raquo; </span> 
 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1725"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dumpDatabases &raquo; </span> 
 
 
 
<span class='Comment_Multi_Line'>/* 
 * Run pg_dump on dbname. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1788"></a><span class='Declare_Function'>runPgDump</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1790"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>connstrbuf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1791"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>cmd</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1792"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1791"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>"\"%s\" %s"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN60"><span class='Ref_to_Global_Var'>pg_dump_bin</span></a><span class='Delimiter'>, 
</span>                      <a href="pg_dumpall.c.html#LN62"><span class='Ref_to_Global_Var'>pgdumpopts</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have a filename, use the undocumented plain-append pg_dump 
     * format. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_test_fsync/pg_test_fsync.c.html#LN67"><span class='Ref_to_Global_Var'>filename</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1791"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>" -Fa "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1791"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>" -Fp "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Append the database name to the already-constructed stem of connection 
     * string. 
     */ 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1790"><span class='Ref_To_Local'>connstrbuf</span></a><span class='Delimiter'>, </span><span class='String'>"%s dbname="</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN63"><span class='Ref_to_Global_Var'>connstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/fe_utils/string_utils.h.html#LN45"><span class='Ref_to_Proto'>appendConnStrVal</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1790"><span class='Ref_To_Local'>connstrbuf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1788"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fe_utils/string_utils.h.html#LN43"><span class='Ref_to_Proto'>appendShellString</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1791"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1790"><span class='Ref_To_Local'>connstrbuf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: running \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1791"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN1792"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1791"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1791"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1790"><span class='Ref_To_Local'>connstrbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_dumpall.c.html#LN1792"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end runPgDump &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * buildShSecLabels 
 * 
 * Build SECURITY LABEL command(s) for a shared object 
 * 
 * The caller has to provide object type and identifier to select security 
 * labels from pg_seclabels system view. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1838"></a><span class='Declare_Function'>buildShSecLabels</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>catalog_name</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>objectId</span><span class='Delimiter'>, 
</span><a name="LN1839"></a>                 <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>target</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>objname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1841"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>sql</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1842"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="dumputils.h.html#LN48"><span class='Ref_to_Proto'>buildShSecLabelQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1838"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1838"><span class='Ref_to_Parameter'>catalog_name</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1838"><span class='Ref_to_Parameter'>objectId</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1841"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_dumpall.c.html#LN1842"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../scripts/common.h.html#LN40"><span class='Ref_to_Proto'>executeQuery</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1838"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1841"><span class='Ref_To_Local'>sql</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="dumputils.h.html#LN50"><span class='Ref_to_Proto'>emitShSecLabels</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1838"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1842"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1839"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1839"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1839"><span class='Ref_to_Parameter'>objname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1842"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1841"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Make a database connection with the given parameters.  An 
 * interactive password prompt is automatically issued if required. 
 * 
 * If fail_on_error is false, we return NULL without printing any message 
 * on failure, but preserve any prompted password for the next try. 
 * 
 * On success, the global variable 'connstr' is set to a connection string 
 * containing the options used. 
 */ 
</span><span class='Keyword'>static </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>* 
</span><a name="LN1863"></a><span class='Declare_Function'>connectDatabase</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>connection_string</span><span class='Delimiter'>, 
</span><a name="LN1864"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pghost</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pgport</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pguser</span><span class='Delimiter'>, 
</span><a name="LN1865"></a>                <a href="pg_backup.h.html#LN29"><span class='Ref_to_Enum'>trivalue</span></a> <span class='Declare_Parameter'>prompt_password</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>fail_on_error</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1867"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span><a name="LN1868"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_pass</span><span class='Delimiter'>; 
</span><a name="LN1869"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>remoteversion_str</span><span class='Delimiter'>; 
</span><a name="LN1870"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>my_version</span><span class='Delimiter'>; 
</span><a name="LN1871"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Local'>keywords</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1872"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Local'>values</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1873"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>conn_opts</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1874"></a>    <span class='Keyword'>static bool </span><span class='Declare_Local'>have_password</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1875"></a>    <span class='Keyword'>static char </span><span class='Declare_Local'>password</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1865"><span class='Ref_to_Parameter'>prompt_password</span></a> <span class='Operator'>== </span><a href="pg_backup.h.html#LN33"><span class='Ref_to_EnumConst'>TRI_YES</span></a> <span class='Operator'>&& !</span><a href="pg_dumpall.c.html#LN1874"><span class='Ref_To_Local'>have_password</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../port/sprompt.c.html#LN35"><span class='Ref_to_Func'>simple_prompt</span></a><span class='Parentheses'>(</span><span class='String'>"Password: "</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1875"><span class='Ref_To_Local'>password</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1875"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_dumpall.c.html#LN1874"><span class='Ref_To_Local'>have_password</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start the connection.  Loop until we have a password if requested by 
     * backend. 
     */ 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1889"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>argcount</span> <span class='Operator'>= </span><span class='Number'>6</span><span class='Delimiter'>; 
</span><a name="LN1890"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>conn_opt</span><span class='Delimiter'>; 
</span><a name="LN1891"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_msg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1892"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1873"><span class='Ref_To_Local'>conn_opts</span></a><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1873"><span class='Ref_To_Local'>conn_opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Merge the connection info inputs given in form of connection string 
         * and other options.  Explicitly discard any dbname value in the 
         * connection string; otherwise, PQconnectdbParams() would interpret 
         * that value as being itself a connection string. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1863"><span class='Ref_to_Parameter'>connection_string</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN1873"><span class='Ref_To_Local'>conn_opts</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN278"><span class='Ref_to_Proto'>PQconninfoParse</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1863"><span class='Ref_to_Parameter'>connection_string</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN1891"><span class='Ref_To_Local'>err_msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1873"><span class='Ref_To_Local'>conn_opts</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: %s"</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1891"><span class='Ref_To_Local'>err_msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a> <span class='Operator'>= </span><a href="pg_dumpall.c.html#LN1873"><span class='Ref_To_Local'>conn_opts</span></a><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& 
</span>                    strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><span class='String'>"dbname"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="pg_dumpall.c.html#LN1889"><span class='Ref_To_Local'>argcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>((</span><a href="pg_dumpall.c.html#LN1889"><span class='Ref_To_Local'>argcount</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>((</span><a href="pg_dumpall.c.html#LN1889"><span class='Ref_To_Local'>argcount</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a> <span class='Operator'>= </span><a href="pg_dumpall.c.html#LN1873"><span class='Ref_To_Local'>conn_opts</span></a><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& 
</span>                    strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><span class='String'>"dbname"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>; 
</span>                    <a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_dumpall.c.html#LN1890"><span class='Ref_To_Local'>conn_opt</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if connection_string &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>((</span><a href="pg_dumpall.c.html#LN1889"><span class='Ref_To_Local'>argcount</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>((</span><a href="pg_dumpall.c.html#LN1889"><span class='Ref_To_Local'>argcount</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1864"><span class='Ref_to_Parameter'>pghost</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"host"</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_dumpall.c.html#LN1864"><span class='Ref_to_Parameter'>pghost</span></a><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1864"><span class='Ref_to_Parameter'>pgport</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"port"</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_dumpall.c.html#LN1864"><span class='Ref_to_Parameter'>pgport</span></a><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1864"><span class='Ref_to_Parameter'>pguser</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"user"</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_dumpall.c.html#LN1864"><span class='Ref_to_Parameter'>pguser</span></a><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1874"><span class='Ref_To_Local'>have_password</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"password"</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_dumpall.c.html#LN1875"><span class='Ref_To_Local'>password</span></a><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1863"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"dbname"</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_dumpall.c.html#LN1863"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"fallback_application_name"</span><span class='Delimiter'>; 
</span>        <a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>; 
</span>        <a href="pg_dumpall.c.html#LN1892"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <a href="pg_dumpall.c.html#LN1868"><span class='Ref_To_Local'>new_pass</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN261"><span class='Ref_to_Proto'>PQconnectdbParams</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not connect to database \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1863"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN317"><span class='Ref_to_Proto'>PQstatus</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a> <span class='Operator'>&& 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN326"><span class='Ref_to_Proto'>PQconnectionNeedsPassword</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="pg_dumpall.c.html#LN1874"><span class='Ref_To_Local'>have_password</span></a> <span class='Operator'>&& 
</span>            <a href="pg_dumpall.c.html#LN1865"><span class='Ref_to_Parameter'>prompt_password</span></a> <span class='Operator'>!= </span><a href="pg_backup.h.html#LN32"><span class='Ref_to_EnumConst'>TRI_NO</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../port/sprompt.c.html#LN35"><span class='Ref_to_Func'>simple_prompt</span></a><span class='Parentheses'>(</span><span class='String'>"Password: "</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1875"><span class='Ref_To_Local'>password</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1875"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1874"><span class='Ref_To_Local'>have_password</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="pg_dumpall.c.html#LN1868"><span class='Ref_To_Local'>new_pass</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1868"><span class='Ref_To_Local'>new_pass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check to see that the backend connection was successfully made */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN317"><span class='Ref_to_Proto'>PQstatus</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1865"><span class='Ref_to_Parameter'>fail_on_error</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"%s: could not connect to database \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1863"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1873"><span class='Ref_To_Local'>conn_opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if PQstatus(conn)==CONNE... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Ok, connected successfully. Remember the options used, in the form of a 
     * connection string. 
     */ 
</span>    <a href="pg_dumpall.c.html#LN63"><span class='Ref_to_Global_Var'>connstr</span></a> <span class='Operator'>= </span><a href="pg_dumpall.c.html#LN56"><span class='Ref_to_Proto'>constructConnStr</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1871"><span class='Ref_To_Local'>keywords</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1872"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1873"><span class='Ref_To_Local'>conn_opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check version */ 
</span>    <a href="pg_dumpall.c.html#LN1869"><span class='Ref_To_Local'>remoteversion_str</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN319"><span class='Ref_to_Proto'>PQparameterStatus</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"server_version"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN1869"><span class='Ref_To_Local'>remoteversion_str</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not get server version\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN322"><span class='Ref_to_Proto'>PQserverVersion</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not parse server version \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN1869"><span class='Ref_To_Local'>remoteversion_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_dumpall.c.html#LN1870"><span class='Ref_To_Local'>my_version</span></a> <span class='Operator'>= </span>PG_VERSION_NUM<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We allow the server to be back to 8.0, and up to any minor release of 
     * our own major version.  (See also version check in pg_dump.c.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1870"><span class='Ref_To_Local'>my_version</span></a> <span class='Operator'>!= </span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> 
        <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>&LT; </span><span class='Number'>80000</span> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN81"><span class='Ref_to_Global_Var'>server_version</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1870"><span class='Ref_To_Local'>my_version</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"server version: %s; %s version: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="pg_dumpall.c.html#LN1869"><span class='Ref_To_Local'>remoteversion_str</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span>PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"aborting because of server version mismatch\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure we are not fooled by non-system schemas in the search path. 
     */ 
</span>    <a href="../scripts/common.h.html#LN43"><span class='Ref_to_Proto'>executeCommand</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"SET search_path = pg_catalog"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_dumpall.c.html#LN1867"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end connectDatabase &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Construct a connection string from the given keyword/value pairs. It is 
 * used to pass the connection options to the pg_dump subprocess. 
 * 
 * The following parameters are excluded: 
 *  dbname      - varies in each pg_dump invocation 
 *  password    - it's not secure to pass a password on the command line 
 *  fallback_application_name - we'll let pg_dump set it 
 * ---------- 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN2081"></a><span class='Declare_Function'>constructConnStr</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>keywords</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>values</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2083"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/pqexpbuffer.c.html#LN69"><span class='Ref_to_Func'>createPQExpBuffer</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN2084"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>connstr</span><span class='Delimiter'>; 
</span><a name="LN2085"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2086"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>firstkeyword</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Construct a new connection string in key='value' format. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2085"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN2081"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN2085"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_dumpall.c.html#LN2085"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2081"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN2085"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>"dbname"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2081"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN2085"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>"password"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2081"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN2085"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>"fallback_application_name"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN2086"><span class='Ref_To_Local'>firstkeyword</span></a><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2083"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>' '</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_dumpall.c.html#LN2086"><span class='Ref_To_Local'>firstkeyword</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2083"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%s="</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN2081"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN2085"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fe_utils/string_utils.h.html#LN45"><span class='Ref_to_Proto'>appendConnStrVal</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2083"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN2081"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="pg_dumpall.c.html#LN2085"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_dumpall.c.html#LN2084"><span class='Ref_To_Local'>connstr</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2083"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN111"><span class='Ref_to_Func'>destroyPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2083"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_dumpall.c.html#LN2084"><span class='Ref_To_Local'>connstr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end constructConnStr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Run a query, return the results, exit program on failure. 
 */ 
</span><span class='Keyword'>static </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>* 
</span><a name="LN2112"></a><span class='Declare_Function'>executeQuery</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2114"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: executing %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN2112"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN2114"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2112"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN2112"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN2114"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>|| 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2114"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: query failed: %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2112"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: query was: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN2112"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2112"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pg_dumpall.c.html#LN2114"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end executeQuery &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * As above for a SQL command (which returns nothing). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2138"></a><span class='Declare_Function'>executeCommand</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2140"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_basebackup/pg_receivewal.c.html#LN34"><span class='Ref_to_Global_Var'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: executing %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN2138"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_dumpall.c.html#LN2140"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2138"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN2138"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_dumpall.c.html#LN2140"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>|| 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2140"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: query failed: %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2138"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: query was: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN2138"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2138"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/examples/testlibpq.c.html#LN12"><span class='Ref_to_Func'>exit_nicely</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2140"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end executeCommand &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * dumpTimestamp 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2165"></a><span class='Declare_Function'>dumpTimestamp</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2167"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span><a name="LN2168"></a>    time_t      <span class='Declare_Local'>now</span> <span class='Operator'>= </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../backend/utils/adt/pg_locale.c.html#LN753"><span class='Ref_to_Macro'>strftime</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2167"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN2167"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="dumputils.h.html#LN32"><span class='Ref_to_Const'>PGDUMP_STRFTIME_FMT</span></a><span class='Delimiter'>, </span>localtime<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_dumpall.c.html#LN2168"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_dumpall.c.html#LN87"><span class='Ref_to_Global_Var'>OPF</span></a><span class='Delimiter'>, </span><span class='String'>"-- %s %s\n\n"</span><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN2165"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="pg_dumpall.c.html#LN2167"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>