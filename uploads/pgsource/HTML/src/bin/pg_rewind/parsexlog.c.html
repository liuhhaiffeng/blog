<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_rewind\parsexlog.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_rewind\parsexlog.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:01 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * parsexlog.c 
 *    Functions for reading Write-Ahead-Log 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"pg_rewind.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"filemap.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"logging.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/rmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog_internal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlogreader.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_control.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/storage_xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/dbcommands_xlog.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * RmgrNames is an array of resource manager names, to make error messages 
 * a bit nicer. 
 */ 
</span><a name="LN31"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_RMGR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>symname</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>redo</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>desc</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>identify</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>startup</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>cleanup</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>mask</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>  <a href="parsexlog.c.html#LN31"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, 
</span> 
<a name="LN34"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>RmgrNames</span><span class='Delimiter'>[</span><a href="../../include/access/rmgr.h.html#LN32"><span class='Ref_to_Const'>RM_MAX_ID</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span><span class='Keyword'>#include </span><span class='String'>"access/rmgrlist.h"</span> 
<span class='Delimiter'>}; 
</span> 
<a name="LN38"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>extractPageInfo</span><span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN40"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>xlogreadfd</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN41"></a><span class='Keyword'>static </span><a href="../../include/access/xlogdefs.h.html#LN33"><span class='Ref_to_Typedef'>XLogSegNo</span></a> <span class='Declare_Var'>xlogreadsegno</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN42"></a><span class='Keyword'>static char </span><span class='Declare_Var'>xlogfpath</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
<a name="LN44"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>XLogPageReadPrivate</span> 
<span class='Delimiter'>{ 
</span><a name="LN46"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>datadir</span><span class='Delimiter'>; 
</span><a name="LN47"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>tliIndex</span><span class='Delimiter'>; 
</span><a name="LN48"></a>} <span class='Declare_Typedef'>XLogPageReadPrivate</span><span class='Delimiter'>; 
</span> 
<a name="LN50"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>SimpleXLogPageRead</span><span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>xlogreader</span><span class='Delimiter'>, 
</span><a name="LN51"></a>                   <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>targetPagePtr</span><span class='Delimiter'>, 
</span><a name="LN52"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>reqLen</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>targetRecPtr</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>readBuf</span><span class='Delimiter'>, 
</span><a name="LN53"></a>                   <a href="../../include/access/xlogdefs.h.html#LN44"><span class='Ref_to_Typedef'>TimeLineID</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pageTLI</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Read WAL from the datadir/pg_wal, starting from 'startpoint' on timeline 
 * index 'tliIndex' in target timeline history, until 'endpoint'. Make note of 
 * the data blocks touched by the WAL records, and return them in a page map. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN61"></a><span class='Declare_Function'>extractPageMap</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>datadir</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>startpoint</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>tliIndex</span><span class='Delimiter'>, 
</span><a name="LN62"></a>               <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>endpoint</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN64"></a>    <a href="../../include/access/xlogrecord.h.html#LN40"><span class='Ref_to_Struct'>XLogRecord</span></a> <span class='Operator'>*</span><span class='Declare_Local'>record</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlogreader</span><span class='Delimiter'>; 
</span><a name="LN66"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>errormsg</span><span class='Delimiter'>; 
</span><a name="LN67"></a>    <a href="../../backend/access/transam/xlog.c.html#LN798"><span class='Ref_to_Struct'>XLogPageReadPrivate</span></a> <span class='Declare_Local'>private</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="parsexlog.c.html#LN46"><span class='Ref_to_Member'>datadir</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN61"><span class='Ref_to_Parameter'>datadir</span></a><span class='Delimiter'>; 
</span>    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN61"><span class='Ref_to_Parameter'>tliIndex</span></a><span class='Delimiter'>; 
</span>    <a href="parsexlog.c.html#LN65"><span class='Ref_To_Local'>xlogreader</span></a> <span class='Operator'>= </span><a href="../../backend/access/transam/xlogreader.c.html#LN65"><span class='Ref_to_Func'>XLogReaderAllocate</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parsexlog.c.html#LN50"><span class='Ref_to_Proto'>SimpleXLogPageRead</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>private</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN65"><span class='Ref_To_Local'>xlogreader</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="parsexlog.c.html#LN64"><span class='Ref_To_Local'>record</span></a> <span class='Operator'>= </span><a href="../../backend/access/transam/xlogreader.c.html#LN191"><span class='Ref_to_Func'>XLogReadRecord</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN65"><span class='Ref_To_Local'>xlogreader</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN61"><span class='Ref_to_Parameter'>startpoint</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parsexlog.c.html#LN66"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN64"><span class='Ref_To_Local'>record</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN81"></a>            <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>errptr</span><span class='Delimiter'>; 
</span> 
            <a href="parsexlog.c.html#LN81"><span class='Ref_To_Local'>errptr</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN61"><span class='Ref_to_Parameter'>startpoint</span></a> <span class='Operator'>? </span><a href="parsexlog.c.html#LN61"><span class='Ref_to_Parameter'>startpoint</span></a> <span class='Operator'>: </span><a href="parsexlog.c.html#LN65"><span class='Ref_To_Local'>xlogreader</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN66"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>) 
</span>                <a href="logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"could not read WAL record at %X/%X: %s\n"</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN81"><span class='Ref_To_Local'>errptr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN81"><span class='Ref_To_Local'>errptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="parsexlog.c.html#LN66"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"could not read WAL record at %X/%X\n"</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN61"><span class='Ref_to_Parameter'>startpoint</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN61"><span class='Ref_to_Parameter'>startpoint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="parsexlog.c.html#LN38"><span class='Ref_to_Proto'>extractPageInfo</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN65"><span class='Ref_To_Local'>xlogreader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="parsexlog.c.html#LN61"><span class='Ref_to_Parameter'>startpoint</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* continue reading at next record */ 
</span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN65"><span class='Ref_To_Local'>xlogreader</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN113"><span class='Ref_to_Member'>ReadRecPtr</span></a> <span class='Operator'>!= </span><a href="parsexlog.c.html#LN62"><span class='Ref_to_Parameter'>endpoint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../backend/access/transam/xlogreader.c.html#LN123"><span class='Ref_to_Func'>XLogReaderFree</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN65"><span class='Ref_To_Local'>xlogreader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end extractPageMap &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Reads one WAL record. Returns the end position of the record, without 
 * doing anything with the record itself. 
 */ 
</span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> 
<a name="LN114"></a><span class='Declare_Function'>readOneRecord</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>datadir</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>tliIndex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN116"></a>    <a href="../../include/access/xlogrecord.h.html#LN40"><span class='Ref_to_Struct'>XLogRecord</span></a> <span class='Operator'>*</span><span class='Declare_Local'>record</span><span class='Delimiter'>; 
</span><a name="LN117"></a>    <a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlogreader</span><span class='Delimiter'>; 
</span><a name="LN118"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>errormsg</span><span class='Delimiter'>; 
</span><a name="LN119"></a>    <a href="../../backend/access/transam/xlog.c.html#LN798"><span class='Ref_to_Struct'>XLogPageReadPrivate</span></a> <span class='Declare_Local'>private</span><span class='Delimiter'>; 
</span><a name="LN120"></a>    <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="parsexlog.c.html#LN46"><span class='Ref_to_Member'>datadir</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN114"><span class='Ref_to_Parameter'>datadir</span></a><span class='Delimiter'>; 
</span>    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN114"><span class='Ref_to_Parameter'>tliIndex</span></a><span class='Delimiter'>; 
</span>    <a href="parsexlog.c.html#LN117"><span class='Ref_To_Local'>xlogreader</span></a> <span class='Operator'>= </span><a href="../../backend/access/transam/xlogreader.c.html#LN65"><span class='Ref_to_Func'>XLogReaderAllocate</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parsexlog.c.html#LN50"><span class='Ref_to_Proto'>SimpleXLogPageRead</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>private</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN117"><span class='Ref_To_Local'>xlogreader</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="parsexlog.c.html#LN116"><span class='Ref_To_Local'>record</span></a> <span class='Operator'>= </span><a href="../../backend/access/transam/xlogreader.c.html#LN191"><span class='Ref_to_Func'>XLogReadRecord</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN117"><span class='Ref_To_Local'>xlogreader</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN114"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parsexlog.c.html#LN118"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN116"><span class='Ref_To_Local'>record</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN118"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>) 
</span>            <a href="logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"could not read WAL record at %X/%X: %s\n"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN114"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN114"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN118"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"could not read WAL record at %X/%X\n"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN114"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN114"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="parsexlog.c.html#LN120"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN117"><span class='Ref_To_Local'>xlogreader</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../backend/access/transam/xlogreader.c.html#LN123"><span class='Ref_to_Func'>XLogReaderFree</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN117"><span class='Ref_To_Local'>xlogreader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="parsexlog.c.html#LN120"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end readOneRecord &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find the previous checkpoint preceding given WAL location. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN154"></a><span class='Declare_Function'>findLastCheckpoint</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>datadir</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>forkptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>tliIndex</span><span class='Delimiter'>, 
</span><a name="LN155"></a>                   <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lastchkptrec</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN44"><span class='Ref_to_Typedef'>TimeLineID</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lastchkpttli</span><span class='Delimiter'>, 
</span><a name="LN156"></a>                   <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lastchkptredo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Walk backwards, starting from the given record */ 
</span><a name="LN159"></a>    <a href="../../include/access/xlogrecord.h.html#LN40"><span class='Ref_to_Struct'>XLogRecord</span></a> <span class='Operator'>*</span><span class='Declare_Local'>record</span><span class='Delimiter'>; 
</span><a name="LN160"></a>    <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>searchptr</span><span class='Delimiter'>; 
</span><a name="LN161"></a>    <a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlogreader</span><span class='Delimiter'>; 
</span><a name="LN162"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>errormsg</span><span class='Delimiter'>; 
</span><a name="LN163"></a>    <a href="../../backend/access/transam/xlog.c.html#LN798"><span class='Ref_to_Struct'>XLogPageReadPrivate</span></a> <span class='Declare_Local'>private</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The given fork pointer points to the end of the last common record, 
     * which is not necessarily the beginning of the next record, if the 
     * previous record happens to end at a page boundary. Skip over the page 
     * header in that case to find the next record. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN154"><span class='Ref_to_Parameter'>forkptr</span></a> <span class='Operator'>% </span>XLOG_BLCKSZ <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="parsexlog.c.html#LN154"><span class='Ref_to_Parameter'>forkptr</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN154"><span class='Ref_to_Parameter'>forkptr</span></a> <span class='Operator'>% </span><a href="../../include/access/xlog_internal.h.html#LN91"><span class='Ref_to_Const'>XLogSegSize</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../include/access/xlog_internal.h.html#LN71"><span class='Ref_to_Const'>SizeOfXLogLongPHD</span></a> <span class='Operator'>: </span><a href="../../include/access/xlog_internal.h.html#LN54"><span class='Ref_to_Const'>SizeOfXLogShortPHD</span></a><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="parsexlog.c.html#LN46"><span class='Ref_to_Member'>datadir</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN154"><span class='Ref_to_Parameter'>datadir</span></a><span class='Delimiter'>; 
</span>    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN154"><span class='Ref_to_Parameter'>tliIndex</span></a><span class='Delimiter'>; 
</span>    <a href="parsexlog.c.html#LN161"><span class='Ref_To_Local'>xlogreader</span></a> <span class='Operator'>= </span><a href="../../backend/access/transam/xlogreader.c.html#LN65"><span class='Ref_to_Func'>XLogReaderAllocate</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parsexlog.c.html#LN50"><span class='Ref_to_Proto'>SimpleXLogPageRead</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>private</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN161"><span class='Ref_To_Local'>xlogreader</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="parsexlog.c.html#LN160"><span class='Ref_To_Local'>searchptr</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN154"><span class='Ref_to_Parameter'>forkptr</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN183"></a>        <a href="../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span><span class='Delimiter'>; 
</span> 
        <a href="parsexlog.c.html#LN159"><span class='Ref_To_Local'>record</span></a> <span class='Operator'>= </span><a href="../../backend/access/transam/xlogreader.c.html#LN191"><span class='Ref_to_Func'>XLogReadRecord</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN161"><span class='Ref_To_Local'>xlogreader</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN160"><span class='Ref_To_Local'>searchptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parsexlog.c.html#LN162"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN159"><span class='Ref_To_Local'>record</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN162"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>) 
</span>                <a href="logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"could not find previous WAL record at %X/%X: %s\n"</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN160"><span class='Ref_To_Local'>searchptr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN160"><span class='Ref_To_Local'>searchptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="parsexlog.c.html#LN162"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"could not find previous WAL record at %X/%X\n"</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN160"><span class='Ref_To_Local'>searchptr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN160"><span class='Ref_To_Local'>searchptr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check if it is a checkpoint record. This checkpoint record needs to 
         * be the latest checkpoint before WAL forked and not the checkpoint 
         * where the master has been stopped to be rewinded. 
         */ 
</span>        <a href="parsexlog.c.html#LN183"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN161"><span class='Ref_To_Local'>xlogreader</span></a><span class='Parentheses'>) </span><span class='Operator'>& ~</span><a href="../../include/access/xlogrecord.h.html#LN61"><span class='Ref_to_Const'>XLR_INFO_MASK</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN160"><span class='Ref_To_Local'>searchptr</span></a> <span class='Operator'>&LT; </span><a href="parsexlog.c.html#LN154"><span class='Ref_to_Parameter'>forkptr</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/access/xlogreader.h.html#LN216"><span class='Ref_to_Macro'>XLogRecGetRmid</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN161"><span class='Ref_To_Local'>xlogreader</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span>RM_XLOG_ID <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN183"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_control.h.html#LN65"><span class='Ref_to_Const'>XLOG_CHECKPOINT_SHUTDOWN</span></a> <span class='Operator'>|| 
</span>             <a href="parsexlog.c.html#LN183"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_control.h.html#LN66"><span class='Ref_to_Const'>XLOG_CHECKPOINT_ONLINE</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN209"></a>            <a href="../../include/catalog/pg_control.h.html#LN32"><span class='Ref_to_Struct'>CheckPoint</span></a>  <span class='Declare_Local'>checkPoint</span><span class='Delimiter'>; 
</span> 
            memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="parsexlog.c.html#LN209"><span class='Ref_To_Local'>checkPoint</span></a><span class='Delimiter'>, </span><a href="../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN161"><span class='Ref_To_Local'>xlogreader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_control.h.html#LN32"><span class='Ref_to_Struct'>CheckPoint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="parsexlog.c.html#LN155"><span class='Ref_to_Parameter'>lastchkptrec</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN160"><span class='Ref_To_Local'>searchptr</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="parsexlog.c.html#LN155"><span class='Ref_to_Parameter'>lastchkpttli</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN209"><span class='Ref_To_Local'>checkPoint</span></a><span class='Operator'>.</span><a href="../../include/catalog/pg_control.h.html#LN36"><span class='Ref_to_Member'>ThisTimeLineID</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="parsexlog.c.html#LN156"><span class='Ref_to_Parameter'>lastchkptredo</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN209"><span class='Ref_To_Local'>checkPoint</span></a><span class='Operator'>.</span><a href="../../include/catalog/pg_control.h.html#LN34"><span class='Ref_to_Member'>redo</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Walk backwards to previous record. */ 
</span>        <a href="parsexlog.c.html#LN160"><span class='Ref_To_Local'>searchptr</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN159"><span class='Ref_To_Local'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogrecord.h.html#LN44"><span class='Ref_to_Member'>xl_prev</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <a href="../../backend/access/transam/xlogreader.c.html#LN123"><span class='Ref_to_Func'>XLogReaderFree</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN161"><span class='Ref_To_Local'>xlogreader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end findLastCheckpoint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* XLogreader callback function, to read a WAL page */ 
</span><span class='Keyword'>static int 
</span><a name="LN232"></a><span class='Declare_Function'>SimpleXLogPageRead</span><span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>xlogreader</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>targetPagePtr</span><span class='Delimiter'>, 
</span><a name="LN233"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>reqLen</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>targetRecPtr</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>readBuf</span><span class='Delimiter'>, 
</span><a name="LN234"></a>                   <a href="../../include/access/xlogdefs.h.html#LN44"><span class='Ref_to_Typedef'>TimeLineID</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pageTLI</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN236"></a>    <a href="../../backend/access/transam/xlog.c.html#LN798"><span class='Ref_to_Struct'>XLogPageReadPrivate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>private</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../backend/access/transam/xlog.c.html#LN798"><span class='Ref_to_Struct'>XLogPageReadPrivate</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="parsexlog.c.html#LN232"><span class='Ref_to_Parameter'>xlogreader</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN107"><span class='Ref_to_Member'>private_data</span></a><span class='Delimiter'>; 
</span><a name="LN237"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>targetPageOff</span><span class='Delimiter'>; 
</span><a name="LN238"></a>    <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>targetSegEnd</span><span class='Delimiter'>; 
</span><a name="LN239"></a>    <a href="../../include/access/xlogdefs.h.html#LN33"><span class='Ref_to_Typedef'>XLogSegNo</span></a>   <span class='Declare_Local'>targetSegNo</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/xlog_internal.h.html#LN105"><span class='Ref_to_Macro'>XLByteToSeg</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN232"><span class='Ref_to_Parameter'>targetPagePtr</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN239"><span class='Ref_To_Local'>targetSegNo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/xlog_internal.h.html#LN94"><span class='Ref_to_Macro'>XLogSegNoOffsetToRecPtr</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN239"><span class='Ref_To_Local'>targetSegNo</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN238"><span class='Ref_To_Local'>targetSegEnd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="parsexlog.c.html#LN237"><span class='Ref_To_Local'>targetPageOff</span></a> <span class='Operator'>= </span><a href="parsexlog.c.html#LN232"><span class='Ref_to_Parameter'>targetPagePtr</span></a> <span class='Operator'>% </span><a href="../../include/access/xlog_internal.h.html#LN91"><span class='Ref_to_Const'>XLogSegSize</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * See if we need to switch to a new segment because the requested record 
     * is not in the currently open one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../include/access/xlog_internal.h.html#LN117"><span class='Ref_to_Macro'>XLByteInSeg</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN232"><span class='Ref_to_Parameter'>targetPagePtr</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN41"><span class='Ref_to_Global_Var'>xlogreadsegno</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/xlog_internal.h.html#LN105"><span class='Ref_to_Macro'>XLByteToSeg</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN232"><span class='Ref_to_Parameter'>targetPagePtr</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN41"><span class='Ref_to_Global_Var'>xlogreadsegno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN259"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>xlogfname</span><span class='Delimiter'>[</span><a href="../../include/access/xlog_internal.h.html#LN137"><span class='Ref_to_Const'>MAXFNAMELEN</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Since incomplete segments are copied into next timelines, switch to 
         * the timeline holding the required segment. Assuming this scan can 
         * be done both forward and backward, consider also switching timeline 
         * accordingly. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a> <span class='Operator'>&LT; </span><a href="pg_rewind.c.html#LN58"><span class='Ref_to_Global_Var'>targetNentries</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>               <a href="pg_rewind.c.html#LN57"><span class='Ref_to_Global_Var'>targetHistory</span></a><span class='Delimiter'>[</span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/timeline.h.html#LN28"><span class='Ref_to_Member'>end</span></a> <span class='Operator'>&LT; </span><a href="parsexlog.c.html#LN238"><span class='Ref_To_Local'>targetSegEnd</span></a><span class='Parentheses'>) 
</span>            <span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>               <a href="pg_rewind.c.html#LN57"><span class='Ref_to_Global_Var'>targetHistory</span></a><span class='Delimiter'>[</span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/timeline.h.html#LN27"><span class='Ref_to_Member'>begin</span></a> <span class='Operator'>&GT;= </span><a href="parsexlog.c.html#LN238"><span class='Ref_To_Local'>targetSegEnd</span></a><span class='Parentheses'>) 
</span>            <span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/xlog_internal.h.html#LN142"><span class='Ref_to_Macro'>XLogFileName</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN259"><span class='Ref_To_Local'>xlogfname</span></a><span class='Delimiter'>, </span><a href="pg_rewind.c.html#LN57"><span class='Ref_to_Global_Var'>targetHistory</span></a><span class='Delimiter'>[</span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/timeline.h.html#LN26"><span class='Ref_to_Member'>tli</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN41"><span class='Ref_to_Global_Var'>xlogreadsegno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN42"><span class='Ref_to_Global_Var'>xlogfpath</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/"</span> <a href="../../include/access/xlog_internal.h.html#LN130"><span class='Ref_to_Const'>XLOGDIR</span></a> <span class='String'>"/%s"</span><span class='Delimiter'>, </span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="parsexlog.c.html#LN46"><span class='Ref_to_Member'>datadir</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN259"><span class='Ref_To_Local'>xlogfname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN42"><span class='Ref_to_Global_Var'>xlogfpath</span></a><span class='Delimiter'>, </span>O_RDONLY <span class='Operator'>| </span><a href="../../include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN42"><span class='Ref_to_Global_Var'>xlogfpath</span></a><span class='Delimiter'>, 
</span>                   <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if xlogreadfd&LT;0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * At this point, we have the right segment open. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Read the requested page */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>lseek<span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>off_t<span class='Parentheses'>) </span><a href="parsexlog.c.html#LN237"><span class='Ref_To_Local'>targetPageOff</span></a><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>)</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"could not seek in file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN42"><span class='Ref_to_Global_Var'>xlogfpath</span></a><span class='Delimiter'>, 
</span>               <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/win32.h.html#LN12"><span class='Ref_to_Macro'>read</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN40"><span class='Ref_to_Global_Var'>xlogreadfd</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN233"><span class='Ref_to_Parameter'>readBuf</span></a><span class='Delimiter'>, </span>XLOG_BLCKSZ<span class='Parentheses'>) </span><span class='Operator'>!= </span>XLOG_BLCKSZ<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"could not read from file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN42"><span class='Ref_to_Global_Var'>xlogfpath</span></a><span class='Delimiter'>, 
</span>               <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN239"><span class='Ref_To_Local'>targetSegNo</span></a> <span class='Operator'>== </span><a href="parsexlog.c.html#LN41"><span class='Ref_to_Global_Var'>xlogreadsegno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="parsexlog.c.html#LN234"><span class='Ref_to_Parameter'>pageTLI</span></a> <span class='Operator'>= </span><a href="pg_rewind.c.html#LN57"><span class='Ref_to_Global_Var'>targetHistory</span></a><span class='Delimiter'>[</span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="parsexlog.c.html#LN47"><span class='Ref_to_Member'>tliIndex</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/timeline.h.html#LN26"><span class='Ref_to_Member'>tli</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> XLOG_BLCKSZ<span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SimpleXLogPageRead &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract information on which blocks the current record modifies. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN318"></a><span class='Declare_Function'>extractPageInfo</span><span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN320"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>block_id</span><span class='Delimiter'>; 
</span><a name="LN321"></a>    <a href="../../include/access/rmgr.h.html#LN10"><span class='Ref_to_Typedef'>RmgrId</span></a>      <span class='Declare_Local'>rmid</span> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN216"><span class='Ref_to_Macro'>XLogRecGetRmid</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN318"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN322"></a>    <a href="../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN318"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN323"></a>    <a href="../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>rminfo</span> <span class='Operator'>= </span><a href="parsexlog.c.html#LN322"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>& ~</span><a href="../../include/access/xlogrecord.h.html#LN61"><span class='Ref_to_Const'>XLR_INFO_MASK</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Is this a special record type that I recognize? */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN321"><span class='Ref_To_Local'>rmid</span></a> <span class='Operator'>== </span>RM_DBASE_ID <span class='Operator'>&& </span><a href="parsexlog.c.html#LN323"><span class='Ref_To_Local'>rminfo</span></a> <span class='Operator'>== </span><a href="../../include/commands/dbcommands_xlog.h.html#LN20"><span class='Ref_to_Const'>XLOG_DBASE_CREATE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * New databases can be safely ignored. It won't be present in the 
         * source system, so it will be deleted. There's one corner-case, 
         * though: if a new, different, database is also created in the source 
         * system, we'll see that the files already exist and not copy them. 
         * That's OK, though; WAL replay of creating the new database, from 
         * the source systems's WAL, will re-copy the new database, 
         * overwriting the database created in the target system. 
         */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN321"><span class='Ref_To_Local'>rmid</span></a> <span class='Operator'>== </span>RM_DBASE_ID <span class='Operator'>&& </span><a href="parsexlog.c.html#LN323"><span class='Ref_To_Local'>rminfo</span></a> <span class='Operator'>== </span><a href="../../include/commands/dbcommands_xlog.h.html#LN21"><span class='Ref_to_Const'>XLOG_DBASE_DROP</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * An existing database was dropped. We'll see that the files don't 
         * exist in the target data dir, and copy them in toto from the source 
         * system. No need to do anything special here. 
         */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN321"><span class='Ref_To_Local'>rmid</span></a> <span class='Operator'>== </span>RM_SMGR_ID <span class='Operator'>&& </span><a href="parsexlog.c.html#LN323"><span class='Ref_To_Local'>rminfo</span></a> <span class='Operator'>== </span><a href="../../include/catalog/storage_xlog.h.html#LN29"><span class='Ref_to_Const'>XLOG_SMGR_CREATE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We can safely ignore these. The file will be removed from the 
         * target, if it doesn't exist in source system. If a file with same 
         * name is created in source system, too, there will be WAL records 
         * for all the blocks in it. 
         */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN321"><span class='Ref_To_Local'>rmid</span></a> <span class='Operator'>== </span>RM_SMGR_ID <span class='Operator'>&& </span><a href="parsexlog.c.html#LN323"><span class='Ref_To_Local'>rminfo</span></a> <span class='Operator'>== </span><a href="../../include/catalog/storage_xlog.h.html#LN30"><span class='Ref_to_Const'>XLOG_SMGR_TRUNCATE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We can safely ignore these. When we compare the sizes later on, 
         * we'll notice that they differ, and copy the missing tail from 
         * source system. 
         */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN322"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>& </span><a href="../../include/access/xlogrecord.h.html#LN70"><span class='Ref_to_Const'>XLR_SPECIAL_REL_UPDATE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * This record type modifies a relation file in some special way, but 
         * we don't recognize the type. That's bad - we don't know how to 
         * track that change. 
         */ 
</span>        <a href="logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"WAL record modifies a relation, but record type is not recognized\n"</span> 
                 <span class='String'>"lsn: %X/%X, rmgr: %s, info: %02X\n"</span><span class='Delimiter'>, 
</span>          <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN318"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN113"><span class='Ref_to_Member'>ReadRecPtr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="parsexlog.c.html#LN318"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN113"><span class='Ref_to_Member'>ReadRecPtr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="parsexlog.c.html#LN34"><span class='Ref_to_Global_Var'>RmgrNames</span></a><span class='Delimiter'>[</span><a href="parsexlog.c.html#LN321"><span class='Ref_To_Local'>rmid</span></a><span class='Delimiter'>], </span><a href="parsexlog.c.html#LN322"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN320"><span class='Ref_To_Local'>block_id</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="parsexlog.c.html#LN320"><span class='Ref_To_Local'>block_id</span></a> <span class='Operator'>&LT;= </span><a href="parsexlog.c.html#LN318"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN135"><span class='Ref_to_Member'>max_block_id</span></a><span class='Delimiter'>; </span><a href="parsexlog.c.html#LN320"><span class='Ref_To_Local'>block_id</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN379"></a>        <a href="../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Local'>rnode</span><span class='Delimiter'>; 
</span><a name="LN380"></a>        <a href="../../include/common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a>  <span class='Declare_Local'>forknum</span><span class='Delimiter'>; 
</span><a name="LN381"></a>        <a href="../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN318"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN320"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parsexlog.c.html#LN379"><span class='Ref_To_Local'>rnode</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parsexlog.c.html#LN380"><span class='Ref_To_Local'>forknum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="parsexlog.c.html#LN381"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We only care about the main fork; others are copied in toto */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="parsexlog.c.html#LN380"><span class='Ref_To_Local'>forknum</span></a> <span class='Operator'>!= </span><a href="../../include/common/relpath.h.html#LN26"><span class='Ref_to_EnumConst'>MAIN_FORKNUM</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="filemap.h.html#LN100"><span class='Ref_to_Proto'>process_block_change</span></a><span class='Parentheses'>(</span><a href="parsexlog.c.html#LN380"><span class='Ref_To_Local'>forknum</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN379"><span class='Ref_To_Local'>rnode</span></a><span class='Delimiter'>, </span><a href="parsexlog.c.html#LN381"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end extractPageInfo &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>