<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_upgrade\info.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_upgrade\info.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:01 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/* 
 *  info.c 
 * 
 *  information support functions 
 * 
 *  Copyright (c) 2010-2017, PostgreSQL Global Development Group 
 *  src/bin/pg_upgrade/info.c 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"pg_upgrade.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_class.h"</span> 
 
 
<a name="LN17"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>create_rel_filename_map</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>old_data</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>new_data</span><span class='Delimiter'>, 
</span><a name="LN18"></a>                        <span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_db</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new_db</span><span class='Delimiter'>, 
</span><a name="LN19"></a>                        <span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_rel</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new_rel</span><span class='Delimiter'>, 
</span><a name="LN20"></a>                        <a href="pg_upgrade.h.html#LN158"><span class='Ref_to_Typedef'>FileNameMap</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>map</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN21"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>report_unmatched_relation</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>db</span><span class='Delimiter'>, 
</span><a name="LN22"></a>                          <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_new_db</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN23"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>free_db_and_rel_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN193"><span class='Ref_to_Typedef'>DbInfoArr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>db_arr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN24"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_db_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN259"><span class='Ref_to_Typedef'>ClusterInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cluster</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN25"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_rel_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN259"><span class='Ref_to_Typedef'>ClusterInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cluster</span><span class='Delimiter'>, </span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dbinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN26"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>free_rel_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN149"><span class='Ref_to_Typedef'>RelInfoArr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel_arr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN27"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>print_db_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN193"><span class='Ref_to_Typedef'>DbInfoArr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dbinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN28"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>print_rel_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN149"><span class='Ref_to_Typedef'>RelInfoArr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel_arr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * gen_db_file_maps() 
 * 
 * generates a database mapping from "old_db" to "new_db". 
 * 
 * Returns a malloc'ed array of mappings.  The length of the array 
 * is returned into *nmaps. 
 */ 
</span><a href="pg_upgrade.h.html#LN158"><span class='Ref_to_Typedef'>FileNameMap</span></a> <span class='Operator'>* 
</span><a name="LN40"></a><span class='Declare_Function'>gen_db_file_maps</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_db</span><span class='Delimiter'>, </span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new_db</span><span class='Delimiter'>, 
</span><a name="LN41"></a>                 <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>nmaps</span><span class='Delimiter'>, 
</span><a name="LN42"></a>                 <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>old_pgdata</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>new_pgdata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN44"></a>    <a href="pg_upgrade.h.html#LN158"><span class='Ref_to_Typedef'>FileNameMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>maps</span><span class='Delimiter'>; 
</span><a name="LN45"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>old_relnum</span><span class='Delimiter'>, 
</span><a name="LN46"></a>                <span class='Declare_Local'>new_relnum</span><span class='Delimiter'>; 
</span><a name="LN47"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_maps</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN48"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>all_matched</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* There will certainly not be more mappings than there are old rels */ 
</span>    <a href="info.c.html#LN44"><span class='Ref_To_Local'>maps</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN158"><span class='Ref_to_Typedef'>FileNameMap</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN158"><span class='Ref_to_Typedef'>FileNameMap</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                                     <a href="info.c.html#LN40"><span class='Ref_to_Parameter'>old_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Each of the RelInfo arrays should be sorted by OID.  Scan through them 
     * and match them up.  If we fail to match everything, we'll abort, but 
     * first print as much info as we can about mismatches. 
     */ 
</span>    <a href="info.c.html#LN45"><span class='Ref_To_Local'>old_relnum</span></a> <span class='Operator'>= </span><a href="info.c.html#LN46"><span class='Ref_To_Local'>new_relnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="info.c.html#LN45"><span class='Ref_To_Local'>old_relnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>old_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a> <span class='Operator'>|| 
</span>           <a href="info.c.html#LN46"><span class='Ref_To_Local'>new_relnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>new_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN63"></a>        <a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>old_rel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="info.c.html#LN45"><span class='Ref_To_Local'>old_relnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>old_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a><span class='Parentheses'>) </span><span class='Operator'>? 
</span>        <span class='Operator'>&</span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>old_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN45"><span class='Ref_To_Local'>old_relnum</span></a><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN65"></a>        <a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>new_rel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="info.c.html#LN46"><span class='Ref_To_Local'>new_relnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>new_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a><span class='Parentheses'>) </span><span class='Operator'>? 
</span>        <span class='Operator'>&</span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>new_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN46"><span class='Ref_To_Local'>new_relnum</span></a><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* handle running off one array before the other */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * old_rel is unmatched.  This should never happen, because we 
             * force new rels to have TOAST tables if the old one did. 
             */ 
</span>            <a href="info.c.html#LN21"><span class='Ref_to_Proto'>report_unmatched_relation</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>old_db</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="info.c.html#LN48"><span class='Ref_To_Local'>all_matched</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="info.c.html#LN45"><span class='Ref_To_Local'>old_relnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * new_rel is unmatched.  This shouldn't really happen either, but 
             * if it's a TOAST table, we can ignore it and continue 
             * processing, assuming that the new server made a TOAST table 
             * that wasn't needed. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, </span><span class='String'>"pg_toast"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="info.c.html#LN21"><span class='Ref_to_Proto'>report_unmatched_relation</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>new_db</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="info.c.html#LN48"><span class='Ref_To_Local'>all_matched</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="info.c.html#LN46"><span class='Ref_To_Local'>new_relnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* check for mismatched OID */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN140"><span class='Ref_to_Member'>reloid</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN140"><span class='Ref_to_Member'>reloid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* old_rel is unmatched, see comment above */ 
</span>            <a href="info.c.html#LN21"><span class='Ref_to_Proto'>report_unmatched_relation</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>old_db</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="info.c.html#LN48"><span class='Ref_To_Local'>all_matched</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="info.c.html#LN45"><span class='Ref_To_Local'>old_relnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN140"><span class='Ref_to_Member'>reloid</span></a> <span class='Operator'>&GT; </span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN140"><span class='Ref_to_Member'>reloid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* new_rel is unmatched, see comment above */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, </span><span class='String'>"pg_toast"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="info.c.html#LN21"><span class='Ref_to_Proto'>report_unmatched_relation</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>new_db</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="info.c.html#LN48"><span class='Ref_To_Local'>all_matched</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="info.c.html#LN46"><span class='Ref_To_Local'>new_relnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Verify that rels of same OID have same name.  The namespace name 
         * should always match, but the relname might not match for TOAST 
         * tables (and, therefore, their indexes). 
         * 
         * TOAST table names initially match the heap pg_class oid, but 
         * pre-9.0 they can change during certain commands such as CLUSTER, so 
         * don't insist on a match if old cluster is &LT; 9.0. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>             <span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN28"><span class='Ref_to_Macro'>GET_MAJOR_VERSION</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.c.html#LN55"><span class='Ref_to_Global_Var'>old_cluster</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN271"><span class='Ref_to_Member'>major_version</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>900</span> <span class='Operator'>|| 
</span>              strcmp<span class='Parentheses'>(</span><a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, </span><span class='String'>"pg_toast"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN246"><span class='Ref_to_EnumConst'>PG_WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"Relation names for OID %u in database \"%s\" do not match: "</span> 
                   <span class='String'>"old name \"%s.%s\", new name \"%s.%s\"\n"</span><span class='Delimiter'>, 
</span>                   <a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN140"><span class='Ref_to_Member'>reloid</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>old_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Delimiter'>, 
</span>                   <a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, 
</span>                   <a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="info.c.html#LN48"><span class='Ref_To_Local'>all_matched</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="info.c.html#LN45"><span class='Ref_To_Local'>old_relnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="info.c.html#LN46"><span class='Ref_To_Local'>new_relnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* OK, create a mapping entry */ 
</span>        <a href="info.c.html#LN17"><span class='Ref_to_Proto'>create_rel_filename_map</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN42"><span class='Ref_to_Parameter'>old_pgdata</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN42"><span class='Ref_to_Parameter'>new_pgdata</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>old_db</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN40"><span class='Ref_to_Parameter'>new_db</span></a><span class='Delimiter'>, 
</span>                                <a href="info.c.html#LN63"><span class='Ref_To_Local'>old_rel</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN65"><span class='Ref_To_Local'>new_rel</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN44"><span class='Ref_To_Local'>maps</span></a> <span class='Operator'>+ </span><a href="info.c.html#LN47"><span class='Ref_To_Local'>num_maps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN47"><span class='Ref_To_Local'>num_maps</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN45"><span class='Ref_To_Local'>old_relnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN46"><span class='Ref_To_Local'>new_relnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while old_relnum&LT;old_db-&GT;re... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="info.c.html#LN48"><span class='Ref_To_Local'>all_matched</span></a><span class='Parentheses'>) 
</span>        <a href="../pg_rewind/logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"Failed to match up old and new tables in database \"%s\"\n"</span><span class='Delimiter'>, 
</span>                 <a href="info.c.html#LN40"><span class='Ref_to_Parameter'>old_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="info.c.html#LN41"><span class='Ref_to_Parameter'>nmaps</span></a> <span class='Operator'>= </span><a href="info.c.html#LN47"><span class='Ref_To_Local'>num_maps</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="info.c.html#LN44"><span class='Ref_To_Local'>maps</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gen_db_file_maps &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * create_rel_filename_map() 
 * 
 * fills a file node map structure and returns it in "map". 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN166"></a><span class='Declare_Function'>create_rel_filename_map</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>old_data</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>new_data</span><span class='Delimiter'>, 
</span><a name="LN167"></a>                        <span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_db</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new_db</span><span class='Delimiter'>, 
</span><a name="LN168"></a>                        <span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_rel</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new_rel</span><span class='Delimiter'>, 
</span><a name="LN169"></a>                        <a href="pg_upgrade.h.html#LN158"><span class='Ref_to_Typedef'>FileNameMap</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>map</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* In case old/new tablespaces don't match, do them separately. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN168"><span class='Ref_to_Parameter'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN144"><span class='Ref_to_Member'>tablespace</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * relation belongs to the default tablespace, hence relfiles should 
         * exist in the data directories. 
         */ 
</span>        <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN160"><span class='Ref_to_Member'>old_tablespace</span></a> <span class='Operator'>= </span><a href="info.c.html#LN166"><span class='Ref_to_Parameter'>old_data</span></a><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN162"><span class='Ref_to_Member'>old_tablespace_suffix</span></a> <span class='Operator'>= </span><span class='String'>"/base"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* relation belongs to a tablespace, so use the tablespace location */ 
</span>        <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN160"><span class='Ref_to_Member'>old_tablespace</span></a> <span class='Operator'>= </span><a href="info.c.html#LN168"><span class='Ref_to_Parameter'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN144"><span class='Ref_to_Member'>tablespace</span></a><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN162"><span class='Ref_to_Member'>old_tablespace_suffix</span></a> <span class='Operator'>= </span><a href="pg_upgrade.c.html#LN55"><span class='Ref_to_Global_Var'>old_cluster</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN274"><span class='Ref_to_Member'>tablespace_suffix</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Do the same for new tablespaces */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN168"><span class='Ref_to_Parameter'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN144"><span class='Ref_to_Member'>tablespace</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN161"><span class='Ref_to_Member'>new_tablespace</span></a> <span class='Operator'>= </span><a href="info.c.html#LN166"><span class='Ref_to_Parameter'>new_data</span></a><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN163"><span class='Ref_to_Member'>new_tablespace_suffix</span></a> <span class='Operator'>= </span><span class='String'>"/base"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN161"><span class='Ref_to_Member'>new_tablespace</span></a> <span class='Operator'>= </span><a href="info.c.html#LN168"><span class='Ref_to_Parameter'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN144"><span class='Ref_to_Member'>tablespace</span></a><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN163"><span class='Ref_to_Member'>new_tablespace_suffix</span></a> <span class='Operator'>= </span><a href="pg_upgrade.c.html#LN56"><span class='Ref_to_Global_Var'>new_cluster</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN274"><span class='Ref_to_Member'>tablespace_suffix</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN164"><span class='Ref_to_Member'>old_db_oid</span></a> <span class='Operator'>= </span><a href="info.c.html#LN167"><span class='Ref_to_Parameter'>old_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN183"><span class='Ref_to_Member'>db_oid</span></a><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN165"><span class='Ref_to_Member'>new_db_oid</span></a> <span class='Operator'>= </span><a href="info.c.html#LN167"><span class='Ref_to_Parameter'>new_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN183"><span class='Ref_to_Member'>db_oid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * old_relfilenode might differ from pg_class.oid (and hence 
     * new_relfilenode) because of CLUSTER, REINDEX, or VACUUM FULL. 
     */ 
</span>    <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN171"><span class='Ref_to_Member'>old_relfilenode</span></a> <span class='Operator'>= </span><a href="info.c.html#LN168"><span class='Ref_to_Parameter'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN141"><span class='Ref_to_Member'>relfilenode</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* new_relfilenode will match old and new pg_class.oid */ 
</span>    <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN172"><span class='Ref_to_Member'>new_relfilenode</span></a> <span class='Operator'>= </span><a href="info.c.html#LN168"><span class='Ref_to_Parameter'>new_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN141"><span class='Ref_to_Member'>relfilenode</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* used only for logging and error reporing, old/new are identical */ 
</span>    <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN174"><span class='Ref_to_Member'>nspname</span></a> <span class='Operator'>= </span><a href="info.c.html#LN168"><span class='Ref_to_Parameter'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN169"><span class='Ref_to_Parameter'>map</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN175"><span class='Ref_to_Member'>relname</span></a> <span class='Operator'>= </span><a href="info.c.html#LN168"><span class='Ref_to_Parameter'>old_rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end create_rel_filename_map &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Complain about a relation we couldn't match to the other database, 
 * identifying it as best we can. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN223"></a><span class='Declare_Function'>report_unmatched_relation</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>db</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_new_db</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN225"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reloid</span> <span class='Operator'>= </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN140"><span class='Ref_to_Member'>reloid</span></a><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* we might change rel below */ 
</span><a name="LN226"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>reldesc</span><span class='Delimiter'>[</span><span class='Number'>1000</span><span class='Delimiter'>]; 
</span><a name="LN227"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"\"%s.%s\""</span><span class='Delimiter'>, 
</span>             <a href="info.c.html#LN223"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN142"><span class='Ref_to_Member'>indtable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="info.c.html#LN227"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="info.c.html#LN227"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a><span class='Delimiter'>; </span><a href="info.c.html#LN227"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN235"></a>            <span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hrel</span> <span class='Operator'>= &</span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN227"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN235"><span class='Ref_To_Local'>hrel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN140"><span class='Ref_to_Member'>reloid</span></a> <span class='Operator'>== </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN142"><span class='Ref_to_Member'>indtable</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         _<span class='Parentheses'>(</span><span class='String'>" which is an index on \"%s.%s\""</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="info.c.html#LN235"><span class='Ref_To_Local'>hrel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN235"><span class='Ref_To_Local'>hrel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Shift attention to index's table for toast check */ 
</span>                <a href="info.c.html#LN223"><span class='Ref_to_Parameter'>rel</span></a> <span class='Operator'>= </span><a href="info.c.html#LN235"><span class='Ref_To_Local'>hrel</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN227"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a><span class='Parentheses'>) 
</span>            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     _<span class='Parentheses'>(</span><span class='String'>" which is an index on OID %u"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN142"><span class='Ref_to_Member'>indtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel-&GT;indtable &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN143"><span class='Ref_to_Member'>toastheap</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="info.c.html#LN227"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="info.c.html#LN227"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a><span class='Delimiter'>; </span><a href="info.c.html#LN227"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN257"></a>            <span class='Keyword'>const </span><a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>brel</span> <span class='Operator'>= &</span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN227"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN257"><span class='Ref_To_Local'>brel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN140"><span class='Ref_to_Member'>reloid</span></a> <span class='Operator'>== </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN143"><span class='Ref_to_Member'>toastheap</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         _<span class='Parentheses'>(</span><span class='String'>" which is the TOAST table for \"%s.%s\""</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="info.c.html#LN257"><span class='Ref_To_Local'>brel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN257"><span class='Ref_To_Local'>brel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN227"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a><span class='Parentheses'>) 
</span>            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  _<span class='Parentheses'>(</span><span class='String'>" which is the TOAST table for OID %u"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN143"><span class='Ref_to_Member'>toastheap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel-&GT;toastheap &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>is_new_db</span></a><span class='Parentheses'>) 
</span>        <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN246"><span class='Ref_to_EnumConst'>PG_WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"No match found in old cluster for new relation with OID %u in database \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>               <a href="info.c.html#LN225"><span class='Ref_To_Local'>reloid</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN246"><span class='Ref_to_EnumConst'>PG_WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"No match found in new cluster for old relation with OID %u in database \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>               <a href="info.c.html#LN225"><span class='Ref_To_Local'>reloid</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN223"><span class='Ref_to_Parameter'>db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN226"><span class='Ref_To_Local'>reldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end report_unmatched_relation &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN284"></a><span class='Declare_Function'>print_maps</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN158"><span class='Ref_to_Typedef'>FileNameMap</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>maps</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>n_maps</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>db_name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="util.c.html#LN17"><span class='Ref_to_Global_Var'>log_opts</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN284"><span class='Ref_to_Member'>verbose</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN288"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>mapnum</span><span class='Delimiter'>; 
</span> 
        <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN243"><span class='Ref_to_EnumConst'>PG_VERBOSE</span></a><span class='Delimiter'>, </span><span class='String'>"mappings for database \"%s\":\n"</span><span class='Delimiter'>, </span><a href="info.c.html#LN284"><span class='Ref_to_Parameter'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="info.c.html#LN288"><span class='Ref_To_Local'>mapnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="info.c.html#LN288"><span class='Ref_To_Local'>mapnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN284"><span class='Ref_to_Parameter'>n_maps</span></a><span class='Delimiter'>; </span><a href="info.c.html#LN288"><span class='Ref_To_Local'>mapnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN243"><span class='Ref_to_EnumConst'>PG_VERBOSE</span></a><span class='Delimiter'>, </span><span class='String'>"%s.%s: %u to %u\n"</span><span class='Delimiter'>, 
</span>                   <a href="info.c.html#LN284"><span class='Ref_to_Parameter'>maps</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN288"><span class='Ref_To_Local'>mapnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN174"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN284"><span class='Ref_to_Parameter'>maps</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN288"><span class='Ref_To_Local'>mapnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN175"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, 
</span>                   <a href="info.c.html#LN284"><span class='Ref_to_Parameter'>maps</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN288"><span class='Ref_To_Local'>mapnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN171"><span class='Ref_to_Member'>old_relfilenode</span></a><span class='Delimiter'>, 
</span>                   <a href="info.c.html#LN284"><span class='Ref_to_Parameter'>maps</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN288"><span class='Ref_To_Local'>mapnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN172"><span class='Ref_to_Member'>new_relfilenode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN243"><span class='Ref_to_EnumConst'>PG_VERBOSE</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_db_and_rel_infos() 
 * 
 * higher level routine to generate dbinfos for the database running 
 * on the given "port". Assumes that server is already running. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN310"></a><span class='Declare_Function'>get_db_and_rel_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN259"><span class='Ref_to_Typedef'>ClusterInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cluster</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN312"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dbnum</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN310"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="info.c.html#LN23"><span class='Ref_to_Proto'>free_db_and_rel_infos</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="info.c.html#LN310"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN24"><span class='Ref_to_Proto'>get_db_infos</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN310"><span class='Ref_to_Parameter'>cluster</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="info.c.html#LN312"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="info.c.html#LN312"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN310"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN196"><span class='Ref_to_Member'>ndbs</span></a><span class='Delimiter'>; </span><a href="info.c.html#LN312"><span class='Ref_To_Local'>dbnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="info.c.html#LN25"><span class='Ref_to_Proto'>get_rel_infos</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN310"><span class='Ref_to_Parameter'>cluster</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="info.c.html#LN310"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN312"><span class='Ref_To_Local'>dbnum</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN243"><span class='Ref_to_EnumConst'>PG_VERBOSE</span></a><span class='Delimiter'>, </span><span class='String'>"\n%s databases:\n"</span><span class='Delimiter'>, </span><a href="pg_upgrade.h.html#LN96"><span class='Ref_to_Macro'>CLUSTER_NAME</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN310"><span class='Ref_to_Parameter'>cluster</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="util.c.html#LN17"><span class='Ref_to_Global_Var'>log_opts</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN284"><span class='Ref_to_Member'>verbose</span></a><span class='Parentheses'>) 
</span>        <a href="info.c.html#LN27"><span class='Ref_to_Proto'>print_db_infos</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="info.c.html#LN310"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_db_infos() 
 * 
 * Scans pg_database system catalog and populates all user 
 * databases. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN335"></a><span class='Declare_Function'>get_db_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN259"><span class='Ref_to_Typedef'>ClusterInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cluster</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN337"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="server.c.html#LN25"><span class='Ref_to_Func'>connectToServer</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN335"><span class='Ref_to_Parameter'>cluster</span></a><span class='Delimiter'>, </span><span class='String'>"template1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN338"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN339"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ntups</span><span class='Delimiter'>; 
</span><a name="LN340"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tupnum</span><span class='Delimiter'>; 
</span><a name="LN341"></a>    <a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>dbinfos</span><span class='Delimiter'>; 
</span><a name="LN342"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i_datname</span><span class='Delimiter'>, 
</span><a name="LN343"></a>                <span class='Declare_Local'>i_oid</span><span class='Delimiter'>, 
</span><a name="LN344"></a>                <span class='Declare_Local'>i_encoding</span><span class='Delimiter'>, 
</span><a name="LN345"></a>                <span class='Declare_Local'>i_datcollate</span><span class='Delimiter'>, 
</span><a name="LN346"></a>                <span class='Declare_Local'>i_datctype</span><span class='Delimiter'>, 
</span><a name="LN347"></a>                <span class='Declare_Local'>i_spclocation</span><span class='Delimiter'>; 
</span><a name="LN348"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>query</span><span class='Delimiter'>[</span><a href="pg_upgrade.h.html#LN22"><span class='Ref_to_Const'>QUERY_ALLOC</span></a><span class='Delimiter'>]; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN348"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN348"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"SELECT d.oid, d.datname, d.encoding, d.datcollate, d.datctype, "</span> 
             <span class='String'>"%s AS spclocation "</span> 
             <span class='String'>"FROM pg_catalog.pg_database d "</span> 
             <span class='String'>" LEFT OUTER JOIN pg_catalog.pg_tablespace t "</span> 
             <span class='String'>" ON d.dattablespace = t.oid "</span> 
             <span class='String'>"WHERE d.datallowconn = true "</span> 
    <span class='Comment_Multi_Line'>/* we don't preserve pg_database.oid so we sort by name */ 
</span>             <span class='String'>"ORDER BY 2"</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* 9.2 removed the spclocation column */ 
</span>             <span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN28"><span class='Ref_to_Macro'>GET_MAJOR_VERSION</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN335"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN271"><span class='Ref_to_Member'>major_version</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>901</span><span class='Parentheses'>)</span> <span class='Operator'>? 
</span>             <span class='String'>"t.spclocation"</span> <span class='Operator'>: </span><span class='String'>"pg_catalog.pg_tablespace_location(t.oid)"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="server.c.html#LN116"><span class='Ref_to_Func'>executeQueryOrDie</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN337"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="info.c.html#LN348"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN343"><span class='Ref_To_Local'>i_oid</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"oid"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN342"><span class='Ref_To_Local'>i_datname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"datname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN344"><span class='Ref_To_Local'>i_encoding</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"encoding"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN345"><span class='Ref_To_Local'>i_datcollate</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"datcollate"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN346"><span class='Ref_To_Local'>i_datctype</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"datctype"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN347"><span class='Ref_To_Local'>i_spclocation</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"spclocation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN339"><span class='Ref_To_Local'>ntups</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN341"><span class='Ref_To_Local'>dbinfos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="info.c.html#LN339"><span class='Ref_To_Local'>ntups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN339"><span class='Ref_To_Local'>ntups</span></a><span class='Delimiter'>; </span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="info.c.html#LN341"><span class='Ref_To_Local'>dbinfos</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN183"><span class='Ref_to_Member'>db_oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN343"><span class='Ref_To_Local'>i_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN341"><span class='Ref_To_Local'>dbinfos</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN342"><span class='Ref_To_Local'>i_datname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN341"><span class='Ref_To_Local'>dbinfos</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN189"><span class='Ref_to_Member'>db_encoding</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN344"><span class='Ref_To_Local'>i_encoding</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN341"><span class='Ref_To_Local'>dbinfos</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN187"><span class='Ref_to_Member'>db_collate</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN345"><span class='Ref_To_Local'>i_datcollate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN341"><span class='Ref_To_Local'>dbinfos</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN188"><span class='Ref_to_Member'>db_ctype</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN346"><span class='Ref_To_Local'>i_datctype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN341"><span class='Ref_To_Local'>dbinfos</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN185"><span class='Ref_to_Member'>db_tablespace</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN341"><span class='Ref_To_Local'>dbinfos</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN185"><span class='Ref_to_Member'>db_tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, 
</span>                 <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN340"><span class='Ref_To_Local'>tupnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN347"><span class='Ref_To_Local'>i_spclocation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN338"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN337"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN335"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a> <span class='Operator'>= </span><a href="info.c.html#LN341"><span class='Ref_To_Local'>dbinfos</span></a><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN335"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN196"><span class='Ref_to_Member'>ndbs</span></a> <span class='Operator'>= </span><a href="info.c.html#LN339"><span class='Ref_To_Local'>ntups</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_db_infos &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * get_rel_infos() 
 * 
 * gets the relinfos for all the user tables and indexes of the database 
 * referred to by "dbinfo". 
 * 
 * Note: the resulting RelInfo array is assumed to be sorted by OID. 
 * This allows later processing to match up old and new databases efficiently. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN404"></a><span class='Declare_Function'>get_rel_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN259"><span class='Ref_to_Typedef'>ClusterInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cluster</span><span class='Delimiter'>, </span><a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dbinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN406"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="server.c.html#LN25"><span class='Ref_to_Func'>connectToServer</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN404"><span class='Ref_to_Parameter'>cluster</span></a><span class='Delimiter'>, 
</span>                                       <a href="info.c.html#LN404"><span class='Ref_to_Parameter'>dbinfo</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN408"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN409"></a>    <a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>relinfos</span><span class='Delimiter'>; 
</span><a name="LN410"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ntups</span><span class='Delimiter'>; 
</span><a name="LN411"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>relnum</span><span class='Delimiter'>; 
</span><a name="LN412"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_rels</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN413"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nspname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN414"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>relname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN415"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tablespace</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN416"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i_spclocation</span><span class='Delimiter'>, 
</span><a name="LN417"></a>                <span class='Declare_Local'>i_nspname</span><span class='Delimiter'>, 
</span><a name="LN418"></a>                <span class='Declare_Local'>i_relname</span><span class='Delimiter'>, 
</span><a name="LN419"></a>                <span class='Declare_Local'>i_reloid</span><span class='Delimiter'>, 
</span><a name="LN420"></a>                <span class='Declare_Local'>i_indtable</span><span class='Delimiter'>, 
</span><a name="LN421"></a>                <span class='Declare_Local'>i_toastheap</span><span class='Delimiter'>, 
</span><a name="LN422"></a>                <span class='Declare_Local'>i_relfilenode</span><span class='Delimiter'>, 
</span><a name="LN423"></a>                <span class='Declare_Local'>i_reltablespace</span><span class='Delimiter'>; 
</span><a name="LN424"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>query</span><span class='Delimiter'>[</span><a href="pg_upgrade.h.html#LN22"><span class='Ref_to_Const'>QUERY_ALLOC</span></a><span class='Delimiter'>]; 
</span><a name="LN425"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>last_namespace</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN426"></a>               <span class='Operator'>*</span><span class='Declare_Local'>last_tablespace</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* initialize query string to empty */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a CTE that collects OIDs of regular user tables, including 
     * matviews and sequences, but excluding toast tables and indexes.  We 
     * assume that relations with OIDs &GT;= FirstNormalObjectId belong to the 
     * user.  (That's probably redundant with the namespace-name exclusions, 
     * but let's be safe.) 
     * 
     * pg_largeobject contains user data that does not appear in pg_dump 
     * output, so we have to copy that system table.  It's easiest to do that 
     * by treating it as a user table.  Likewise for pg_largeobject_metadata, 
     * if it exists. 
     */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span> <span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"WITH regular_heap (reloid, indtable, toastheap) AS ( "</span> 
             <span class='String'>"  SELECT c.oid, 0::oid, 0::oid "</span> 
             <span class='String'>"  FROM pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n "</span> 
             <span class='String'>"         ON c.relnamespace = n.oid "</span> 
             <span class='String'>"  WHERE relkind IN ("</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>)</span> <span class='String'>", "</span> 
             <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>)</span> <span class='String'>") AND "</span> 
    <span class='Comment_Multi_Line'>/* exclude possible orphaned temp tables */ 
</span>             <span class='String'>"    ((n.nspname !~ '^pg_temp_' AND "</span> 
             <span class='String'>"      n.nspname !~ '^pg_toast_temp_' AND "</span> 
             <span class='String'>"      n.nspname NOT IN ('pg_catalog', 'information_schema', "</span> 
             <span class='String'>"                        'binary_upgrade', 'pg_toast') AND "</span> 
             <span class='String'>"      c.oid &GT;= %u::pg_catalog.oid) OR "</span> 
             <span class='String'>"     (n.nspname = 'pg_catalog' AND "</span> 
             <span class='String'>"      relname IN ('pg_largeobject'%s) ))), "</span><span class='Delimiter'>, 
</span>             <a href="../../include/access/transam.h.html#LN93"><span class='Ref_to_Const'>FirstNormalObjectId</span></a><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN28"><span class='Ref_to_Macro'>GET_MAJOR_VERSION</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.c.html#LN55"><span class='Ref_to_Global_Var'>old_cluster</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN271"><span class='Ref_to_Member'>major_version</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>900</span><span class='Parentheses'>)</span> <span class='Operator'>? 
</span>             <span class='String'>", 'pg_largeobject_metadata'"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add a CTE that collects OIDs of toast tables belonging to the tables 
     * selected by the regular_heap CTE.  (We have to do this separately 
     * because the namespace-name rules above don't work for toast tables.) 
     */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"  toast_heap (reloid, indtable, toastheap) AS ( "</span> 
             <span class='String'>"  SELECT c.reltoastrelid, 0::oid, c.oid "</span> 
             <span class='String'>"  FROM regular_heap JOIN pg_catalog.pg_class c "</span> 
             <span class='String'>"      ON regular_heap.reloid = c.oid "</span> 
             <span class='String'>"  WHERE c.reltoastrelid != 0), "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add a CTE that collects OIDs of all valid indexes on the previously 
     * selected tables.  We can ignore invalid indexes since pg_dump does. 
     * Testing indisready is necessary in 9.2, and harmless in earlier/later 
     * versions. 
     */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"  all_index (reloid, indtable, toastheap) AS ( "</span> 
             <span class='String'>"  SELECT indexrelid, indrelid, 0::oid "</span> 
             <span class='String'>"  FROM pg_catalog.pg_index "</span> 
             <span class='String'>"  WHERE indisvalid AND indisready "</span> 
             <span class='String'>"    AND indrelid IN "</span> 
             <span class='String'>"        (SELECT reloid FROM regular_heap "</span> 
             <span class='String'>"         UNION ALL "</span> 
             <span class='String'>"         SELECT reloid FROM toast_heap)) "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And now we can write the query that retrieves the data we want for each 
     * heap and index relation.  Make sure result is sorted by OID. 
     */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span> <span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"SELECT all_rels.*, n.nspname, c.relname, "</span> 
             <span class='String'>"  c.relfilenode, c.reltablespace, %s "</span> 
             <span class='String'>"FROM (SELECT * FROM regular_heap "</span> 
             <span class='String'>"      UNION ALL "</span> 
             <span class='String'>"      SELECT * FROM toast_heap "</span> 
             <span class='String'>"      UNION ALL "</span> 
             <span class='String'>"      SELECT * FROM all_index) all_rels "</span> 
             <span class='String'>"  JOIN pg_catalog.pg_class c "</span> 
             <span class='String'>"      ON all_rels.reloid = c.oid "</span> 
             <span class='String'>"  JOIN pg_catalog.pg_namespace n "</span> 
             <span class='String'>"     ON c.relnamespace = n.oid "</span> 
             <span class='String'>"  LEFT OUTER JOIN pg_catalog.pg_tablespace t "</span> 
             <span class='String'>"     ON c.reltablespace = t.oid "</span> 
             <span class='String'>"ORDER BY 1;"</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* 9.2 removed the pg_tablespace.spclocation column */ 
</span>             <span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN28"><span class='Ref_to_Macro'>GET_MAJOR_VERSION</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN404"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN271"><span class='Ref_to_Member'>major_version</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>902</span><span class='Parentheses'>)</span> <span class='Operator'>? 
</span>             <span class='String'>"pg_catalog.pg_tablespace_location(t.oid) AS spclocation"</span> <span class='Operator'>: 
</span>             <span class='String'>"t.spclocation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="server.c.html#LN116"><span class='Ref_to_Func'>executeQueryOrDie</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN406"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="info.c.html#LN424"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN410"><span class='Ref_To_Local'>ntups</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN409"><span class='Ref_To_Local'>relinfos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="info.c.html#LN410"><span class='Ref_To_Local'>ntups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN419"><span class='Ref_To_Local'>i_reloid</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"reloid"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN420"><span class='Ref_To_Local'>i_indtable</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"indtable"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN421"><span class='Ref_To_Local'>i_toastheap</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"toastheap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN417"><span class='Ref_To_Local'>i_nspname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"nspname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN418"><span class='Ref_To_Local'>i_relname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"relname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN422"><span class='Ref_To_Local'>i_relfilenode</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"relfilenode"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN423"><span class='Ref_To_Local'>i_reltablespace</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"reltablespace"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN416"><span class='Ref_To_Local'>i_spclocation</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"spclocation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN410"><span class='Ref_To_Local'>ntups</span></a><span class='Delimiter'>; </span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN530"></a>        <a href="pg_upgrade.h.html#LN135"><span class='Ref_to_Typedef'>RelInfo</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>curr</span> <span class='Operator'>= &</span><a href="info.c.html#LN409"><span class='Ref_To_Local'>relinfos</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN412"><span class='Ref_To_Local'>num_rels</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
        <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN140"><span class='Ref_to_Member'>reloid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN419"><span class='Ref_To_Local'>i_reloid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN142"><span class='Ref_to_Member'>indtable</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN420"><span class='Ref_To_Local'>i_indtable</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN143"><span class='Ref_to_Member'>toastheap</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN421"><span class='Ref_To_Local'>i_toastheap</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="info.c.html#LN413"><span class='Ref_To_Local'>nspname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN417"><span class='Ref_To_Local'>i_nspname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN145"><span class='Ref_to_Member'>nsp_alloc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Many of the namespace and tablespace strings are identical, so we 
         * try to reuse the allocated string pointers where possible to reduce 
         * memory consumption. 
         */ 
</span>        <span class='Comment_Multi_Line'>/* Can we reuse the previous string allocation? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN425"><span class='Ref_To_Local'>last_namespace</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="info.c.html#LN413"><span class='Ref_To_Local'>nspname</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN425"><span class='Ref_To_Local'>last_namespace</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a> <span class='Operator'>= </span><a href="info.c.html#LN425"><span class='Ref_To_Local'>last_namespace</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="info.c.html#LN425"><span class='Ref_To_Local'>last_namespace</span></a> <span class='Operator'>= </span><a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN413"><span class='Ref_To_Local'>nspname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN145"><span class='Ref_to_Member'>nsp_alloc</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="info.c.html#LN414"><span class='Ref_To_Local'>relname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN418"><span class='Ref_To_Local'>i_relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN414"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN141"><span class='Ref_to_Member'>relfilenode</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN422"><span class='Ref_To_Local'>i_relfilenode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN146"><span class='Ref_to_Member'>tblsp_alloc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Is the tablespace oid non-default? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN41"><span class='Ref_to_Macro'>atooid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN423"><span class='Ref_To_Local'>i_reltablespace</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * The tablespace location might be "", meaning the cluster 
             * default location, i.e. pg_default or pg_global. 
             */ 
</span>            <a href="info.c.html#LN415"><span class='Ref_To_Local'>tablespace</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN411"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN416"><span class='Ref_To_Local'>i_spclocation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Can we reuse the previous string allocation? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN426"><span class='Ref_To_Local'>last_tablespace</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="info.c.html#LN415"><span class='Ref_To_Local'>tablespace</span></a><span class='Delimiter'>, </span><a href="info.c.html#LN426"><span class='Ref_To_Local'>last_tablespace</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN144"><span class='Ref_to_Member'>tablespace</span></a> <span class='Operator'>= </span><a href="info.c.html#LN426"><span class='Ref_To_Local'>last_tablespace</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="info.c.html#LN426"><span class='Ref_To_Local'>last_tablespace</span></a> <span class='Operator'>= </span><a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN144"><span class='Ref_to_Member'>tablespace</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN415"><span class='Ref_To_Local'>tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN146"><span class='Ref_to_Member'>tblsp_alloc</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Comment_Multi_Line'>/* A zero reltablespace oid indicates the database tablespace. */ 
</span>            <a href="info.c.html#LN530"><span class='Ref_To_Local'>curr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN144"><span class='Ref_to_Member'>tablespace</span></a> <span class='Operator'>= </span><a href="info.c.html#LN404"><span class='Ref_to_Parameter'>dbinfo</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN185"><span class='Ref_to_Member'>db_tablespace</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for relnum=0;relnum&LT;ntups... &raquo; </span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN408"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN406"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="info.c.html#LN404"><span class='Ref_to_Parameter'>dbinfo</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a> <span class='Operator'>= </span><a href="info.c.html#LN409"><span class='Ref_To_Local'>relinfos</span></a><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN404"><span class='Ref_to_Parameter'>dbinfo</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a> <span class='Operator'>= </span><a href="info.c.html#LN412"><span class='Ref_To_Local'>num_rels</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_rel_infos &raquo; </span> 
 
 
<span class='Keyword'>static void 
</span><a name="LN591"></a><span class='Declare_Function'>free_db_and_rel_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN193"><span class='Ref_to_Typedef'>DbInfoArr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>db_arr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN593"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dbnum</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="info.c.html#LN593"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="info.c.html#LN593"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN591"><span class='Ref_to_Parameter'>db_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN196"><span class='Ref_to_Member'>ndbs</span></a><span class='Delimiter'>; </span><a href="info.c.html#LN593"><span class='Ref_To_Local'>dbnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="info.c.html#LN26"><span class='Ref_to_Proto'>free_rel_infos</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="info.c.html#LN591"><span class='Ref_to_Parameter'>db_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN593"><span class='Ref_To_Local'>dbnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN591"><span class='Ref_to_Parameter'>db_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN593"><span class='Ref_To_Local'>dbnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN591"><span class='Ref_to_Parameter'>db_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN591"><span class='Ref_to_Parameter'>db_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN591"><span class='Ref_to_Parameter'>db_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN196"><span class='Ref_to_Member'>ndbs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static void 
</span><a name="LN607"></a><span class='Declare_Function'>free_rel_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN149"><span class='Ref_to_Typedef'>RelInfoArr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel_arr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN609"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>relnum</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="info.c.html#LN609"><span class='Ref_To_Local'>relnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="info.c.html#LN609"><span class='Ref_To_Local'>relnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN607"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a><span class='Delimiter'>; </span><a href="info.c.html#LN609"><span class='Ref_To_Local'>relnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN607"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN609"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN145"><span class='Ref_to_Member'>nsp_alloc</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN607"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN609"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN607"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN609"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="info.c.html#LN607"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN609"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN146"><span class='Ref_to_Member'>tblsp_alloc</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN607"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN609"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN144"><span class='Ref_to_Member'>tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="info.c.html#LN607"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="info.c.html#LN607"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static void 
</span><a name="LN625"></a><span class='Declare_Function'>print_db_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN193"><span class='Ref_to_Typedef'>DbInfoArr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>db_arr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN627"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dbnum</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="info.c.html#LN627"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="info.c.html#LN627"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN625"><span class='Ref_to_Parameter'>db_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN196"><span class='Ref_to_Member'>ndbs</span></a><span class='Delimiter'>; </span><a href="info.c.html#LN627"><span class='Ref_To_Local'>dbnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN243"><span class='Ref_to_EnumConst'>PG_VERBOSE</span></a><span class='Delimiter'>, </span><span class='String'>"Database: %s\n"</span><span class='Delimiter'>, </span><a href="info.c.html#LN625"><span class='Ref_to_Parameter'>db_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN627"><span class='Ref_To_Local'>dbnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="info.c.html#LN28"><span class='Ref_to_Proto'>print_rel_infos</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="info.c.html#LN625"><span class='Ref_to_Parameter'>db_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN627"><span class='Ref_To_Local'>dbnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN190"><span class='Ref_to_Member'>rel_arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN243"><span class='Ref_to_EnumConst'>PG_VERBOSE</span></a><span class='Delimiter'>, </span><span class='String'>"\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Keyword'>static void 
</span><a name="LN639"></a><span class='Declare_Function'>print_rel_infos</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN149"><span class='Ref_to_Typedef'>RelInfoArr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel_arr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN641"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>relnum</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="info.c.html#LN641"><span class='Ref_To_Local'>relnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="info.c.html#LN641"><span class='Ref_To_Local'>relnum</span></a> <span class='Operator'>&LT; </span><a href="info.c.html#LN639"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN152"><span class='Ref_to_Member'>nrels</span></a><span class='Delimiter'>; </span><a href="info.c.html#LN641"><span class='Ref_To_Local'>relnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN243"><span class='Ref_to_EnumConst'>PG_VERBOSE</span></a><span class='Delimiter'>, </span><span class='String'>"relname: %s.%s: reloid: %u reltblspace: %s\n"</span><span class='Delimiter'>, 
</span>               <a href="info.c.html#LN639"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN641"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN138"><span class='Ref_to_Member'>nspname</span></a><span class='Delimiter'>, 
</span>               <a href="info.c.html#LN639"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN641"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN139"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, 
</span>               <a href="info.c.html#LN639"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN641"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN140"><span class='Ref_to_Member'>reloid</span></a><span class='Delimiter'>, 
</span>               <a href="info.c.html#LN639"><span class='Ref_to_Parameter'>rel_arr</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN151"><span class='Ref_to_Member'>rels</span></a><span class='Delimiter'>[</span><a href="info.c.html#LN641"><span class='Ref_To_Local'>relnum</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN144"><span class='Ref_to_Member'>tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>