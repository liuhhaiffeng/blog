<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_upgrade\version.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_upgrade\version.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:01 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/* 
 *  version.c 
 * 
 *  Postgres-version-specific routines 
 * 
 *  Copyright (c) 2010-2017, PostgreSQL Global Development Group 
 *  src/bin/pg_upgrade/version.c 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"pg_upgrade.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_class.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"fe_utils/string_utils.h"</span> 
 
 
 
<span class='Comment_Multi_Line'>/* 
 * new_9_0_populate_pg_largeobject_metadata() 
 *  new &GT;= 9.0, old &LT;= 8.4 
 *  9.0 has a new pg_largeobject permission table 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN24"></a><span class='Declare_Function'>new_9_0_populate_pg_largeobject_metadata</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN259"><span class='Ref_to_Typedef'>ClusterInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cluster</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>check_mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN26"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dbnum</span><span class='Delimiter'>; 
</span><a name="LN27"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>script</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN28"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN29"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>output_path</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
    <a href="util.c.html#LN68"><span class='Ref_to_Func'>prep_status</span></a><span class='Parentheses'>(</span><span class='String'>"Checking for large objects"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN29"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="version.c.html#LN29"><span class='Ref_To_Local'>output_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"pg_largeobject.sql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="version.c.html#LN26"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="version.c.html#LN26"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>&LT; </span><a href="version.c.html#LN24"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN196"><span class='Ref_to_Member'>ndbs</span></a><span class='Delimiter'>; </span><a href="version.c.html#LN26"><span class='Ref_To_Local'>dbnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN37"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN38"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i_count</span><span class='Delimiter'>; 
</span><a name="LN39"></a>        <a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>active_db</span> <span class='Operator'>= &</span><a href="version.c.html#LN24"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a><span class='Delimiter'>[</span><a href="version.c.html#LN26"><span class='Ref_To_Local'>dbnum</span></a><span class='Delimiter'>]; 
</span><a name="LN40"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="server.c.html#LN25"><span class='Ref_to_Func'>connectToServer</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN24"><span class='Ref_to_Parameter'>cluster</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN39"><span class='Ref_To_Local'>active_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* find if there are any large objects */ 
</span>        <a href="version.c.html#LN37"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="server.c.html#LN116"><span class='Ref_to_Func'>executeQueryOrDie</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN40"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"SELECT count(*) "</span> 
                                <span class='String'>"FROM   pg_catalog.pg_largeobject "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="version.c.html#LN38"><span class='Ref_To_Local'>i_count</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN37"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"count"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>atoi<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN37"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="version.c.html#LN38"><span class='Ref_To_Local'>i_count</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="version.c.html#LN28"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="version.c.html#LN24"><span class='Ref_to_Parameter'>check_mode</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN53"></a>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>connectbuf</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN27"><span class='Ref_To_Local'>script</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="version.c.html#LN27"><span class='Ref_To_Local'>script</span></a> <span class='Operator'>= </span><a href="file.c.html#LN319"><span class='Ref_to_Func'>fopen_priv</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN29"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                    <a href="../pg_rewind/logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\": %s\n"</span><span class='Delimiter'>, </span><a href="version.c.html#LN29"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, 
</span>                             <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="version.c.html#LN53"><span class='Ref_To_Local'>connectbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/fe_utils/string_utils.h.html#LN46"><span class='Ref_to_Proto'>appendPsqlMetaConnect</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="version.c.html#LN53"><span class='Ref_To_Local'>connectbuf</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN39"><span class='Ref_To_Local'>active_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN53"><span class='Ref_To_Local'>connectbuf</span></a><span class='Operator'>.</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN27"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="version.c.html#LN53"><span class='Ref_To_Local'>connectbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN27"><span class='Ref_To_Local'>script</span></a><span class='Delimiter'>, 
</span>                        <span class='String'>"SELECT pg_catalog.lo_create(t.loid)\n"</span> 
                        <span class='String'>"FROM (SELECT DISTINCT loid FROM pg_catalog.pg_largeobject) AS t;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if atoi(PQgetvalue(res,0... &raquo; </span> 
 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN37"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN40"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for dbnum=0;dbnum&LT;cluster... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN27"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>) 
</span>        fclose<span class='Parentheses'>(</span><a href="version.c.html#LN27"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN28"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        report_status<span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN246"><span class='Ref_to_EnumConst'>PG_WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"warning"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN24"><span class='Ref_to_Parameter'>check_mode</span></a><span class='Parentheses'>) 
</span>            <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN246"><span class='Ref_to_EnumConst'>PG_WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span> 
                   <span class='String'>"Your installation contains large objects.  The new database has an\n"</span> 
                   <span class='String'>"additional large object permission table.  After upgrading, you will be\n"</span> 
                   <span class='String'>"given a command to populate the pg_largeobject permission table with\n"</span> 
                   <span class='String'>"default permissions.\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN246"><span class='Ref_to_EnumConst'>PG_WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span> 
                   <span class='String'>"Your installation contains large objects.  The new database has an\n"</span> 
                   <span class='String'>"additional large object permission table, so default permissions must be\n"</span> 
                   <span class='String'>"defined for all large objects.  The file\n"</span> 
                   <span class='String'>"    %s\n"</span> 
                   <span class='String'>"when executed by psql by the database superuser will set the default\n"</span> 
                   <span class='String'>"permissions.\n\n"</span><span class='Delimiter'>, 
</span>                   <a href="version.c.html#LN29"><span class='Ref_To_Local'>output_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end new_9_0_populate_pg_largeobject_metadata &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * old_9_3_check_for_line_data_type_usage() 
 *  9.3 -&GT; 9.4 
 *  Fully implement the 'line' data type in 9.4, which previously returned 
 *  "not enabled" by default and was only functionally enabled with a 
 *  compile-time switch;  9.4 "line" has different binary and text 
 *  representation formats;  checks tables and indexes. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN110"></a><span class='Declare_Function'>old_9_3_check_for_line_data_type_usage</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN259"><span class='Ref_to_Typedef'>ClusterInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cluster</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN112"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dbnum</span><span class='Delimiter'>; 
</span><a name="LN113"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>script</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN114"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN115"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>output_path</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
    <a href="util.c.html#LN68"><span class='Ref_to_Func'>prep_status</span></a><span class='Parentheses'>(</span><span class='String'>"Checking for invalid \"line\" user columns"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN115"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="version.c.html#LN115"><span class='Ref_To_Local'>output_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"tables_using_line.txt"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="version.c.html#LN112"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="version.c.html#LN112"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>&LT; </span><a href="version.c.html#LN110"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN196"><span class='Ref_to_Member'>ndbs</span></a><span class='Delimiter'>; </span><a href="version.c.html#LN112"><span class='Ref_To_Local'>dbnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN123"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN124"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>db_used</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN125"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ntups</span><span class='Delimiter'>; 
</span><a name="LN126"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rowno</span><span class='Delimiter'>; 
</span><a name="LN127"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i_nspname</span><span class='Delimiter'>, 
</span><a name="LN128"></a>                    <span class='Declare_Local'>i_relname</span><span class='Delimiter'>, 
</span><a name="LN129"></a>                    <span class='Declare_Local'>i_attname</span><span class='Delimiter'>; 
</span><a name="LN130"></a>        <a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>active_db</span> <span class='Operator'>= &</span><a href="version.c.html#LN110"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a><span class='Delimiter'>[</span><a href="version.c.html#LN112"><span class='Ref_To_Local'>dbnum</span></a><span class='Delimiter'>]; 
</span><a name="LN131"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="server.c.html#LN25"><span class='Ref_to_Func'>connectToServer</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN110"><span class='Ref_to_Parameter'>cluster</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN130"><span class='Ref_To_Local'>active_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="version.c.html#LN123"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="server.c.html#LN116"><span class='Ref_to_Func'>executeQueryOrDie</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN131"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"SELECT n.nspname, c.relname, a.attname "</span> 
                                <span class='String'>"FROM   pg_catalog.pg_class c, "</span> 
                                <span class='String'>"       pg_catalog.pg_namespace n, "</span> 
                                <span class='String'>"       pg_catalog.pg_attribute a "</span> 
                                <span class='String'>"WHERE  c.oid = a.attrelid AND "</span> 
                                <span class='String'>"       NOT a.attisdropped AND "</span> 
                                <span class='String'>"       a.atttypid = 'pg_catalog.line'::pg_catalog.regtype AND "</span> 
                                <span class='String'>"       c.relnamespace = n.oid AND "</span> 
        <span class='Comment_Multi_Line'>/* exclude possible orphaned temp tables */ 
</span>                                <span class='String'>"       n.nspname !~ '^pg_temp_' AND "</span> 
                         <span class='String'>"      n.nspname !~ '^pg_toast_temp_' AND "</span> 
                                <span class='String'>"       n.nspname NOT IN ('pg_catalog', 'information_schema')"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="version.c.html#LN125"><span class='Ref_To_Local'>ntups</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN123"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="version.c.html#LN127"><span class='Ref_To_Local'>i_nspname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN123"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"nspname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="version.c.html#LN128"><span class='Ref_To_Local'>i_relname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN123"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"relname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="version.c.html#LN129"><span class='Ref_To_Local'>i_attname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN123"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"attname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="version.c.html#LN126"><span class='Ref_To_Local'>rowno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="version.c.html#LN126"><span class='Ref_To_Local'>rowno</span></a> <span class='Operator'>&LT; </span><a href="version.c.html#LN125"><span class='Ref_To_Local'>ntups</span></a><span class='Delimiter'>; </span><a href="version.c.html#LN126"><span class='Ref_To_Local'>rowno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="version.c.html#LN114"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN113"><span class='Ref_To_Local'>script</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="version.c.html#LN113"><span class='Ref_To_Local'>script</span></a> <span class='Operator'>= </span><a href="file.c.html#LN319"><span class='Ref_to_Func'>fopen_priv</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN115"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <a href="../pg_rewind/logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\": %s\n"</span><span class='Delimiter'>, </span><a href="version.c.html#LN115"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, 
</span>                         <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="version.c.html#LN124"><span class='Ref_To_Local'>db_used</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN113"><span class='Ref_To_Local'>script</span></a><span class='Delimiter'>, </span><span class='String'>"Database: %s\n"</span><span class='Delimiter'>, </span><a href="version.c.html#LN130"><span class='Ref_To_Local'>active_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="version.c.html#LN124"><span class='Ref_To_Local'>db_used</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN113"><span class='Ref_To_Local'>script</span></a><span class='Delimiter'>, </span><span class='String'>"  %s.%s.%s\n"</span><span class='Delimiter'>, 
</span>                    <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN123"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN126"><span class='Ref_To_Local'>rowno</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN127"><span class='Ref_To_Local'>i_nspname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN123"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN126"><span class='Ref_To_Local'>rowno</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN128"><span class='Ref_To_Local'>i_relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN123"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN126"><span class='Ref_To_Local'>rowno</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN129"><span class='Ref_To_Local'>i_attname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN123"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN131"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for dbnum=0;dbnum&LT;cluster... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN113"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>) 
</span>        fclose<span class='Parentheses'>(</span><a href="version.c.html#LN113"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN114"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN245"><span class='Ref_to_EnumConst'>PG_REPORT</span></a><span class='Delimiter'>, </span><span class='String'>"fatal\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_rewind/logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"Your installation contains the \"line\" data type in user tables.  This\n"</span> 
                 <span class='String'>"data type changed its internal and input/output format between your old\n"</span> 
                 <span class='String'>"and new clusters so this cluster cannot currently be upgraded.  You can\n"</span> 
                 <span class='String'>"remove the problem tables and restart the upgrade.  A list of the problem\n"</span> 
                 <span class='String'>"columns is in the file:\n"</span> 
                 <span class='String'>"    %s\n\n"</span><span class='Delimiter'>, </span><a href="version.c.html#LN115"><span class='Ref_To_Local'>output_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end old_9_3_check_for_line_data_type_usage &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * old_9_6_check_for_unknown_data_type_usage() 
 *  9.6 -&GT; 10 
 *  It's no longer allowed to create tables or views with "unknown"-type 
 *  columns.  We do not complain about views with such columns, because 
 *  they should get silently converted to "text" columns during the DDL 
 *  dump and reload; it seems unlikely to be worth making users do that 
 *  by hand.  However, if there's a table with such a column, the DDL 
 *  reload will fail, so we should pre-detect that rather than failing 
 *  mid-upgrade.  Worse, if there's a matview with such a column, the 
 *  DDL reload will silently change it to "text" which won't match the 
 *  on-disk storage (which is like "cstring").  So we *must* reject that. 
 *  Also check composite types, in case they are used for table columns. 
 *  We needn't check indexes, because "unknown" has no opclasses. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN207"></a><span class='Declare_Function'>old_9_6_check_for_unknown_data_type_usage</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN259"><span class='Ref_to_Typedef'>ClusterInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cluster</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN209"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dbnum</span><span class='Delimiter'>; 
</span><a name="LN210"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>script</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN211"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN212"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>output_path</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
    <a href="util.c.html#LN68"><span class='Ref_to_Func'>prep_status</span></a><span class='Parentheses'>(</span><span class='String'>"Checking for invalid \"unknown\" user columns"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN212"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="version.c.html#LN212"><span class='Ref_To_Local'>output_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"tables_using_unknown.txt"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="version.c.html#LN209"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="version.c.html#LN209"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>&LT; </span><a href="version.c.html#LN207"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN196"><span class='Ref_to_Member'>ndbs</span></a><span class='Delimiter'>; </span><a href="version.c.html#LN209"><span class='Ref_To_Local'>dbnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN220"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN221"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>db_used</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN222"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ntups</span><span class='Delimiter'>; 
</span><a name="LN223"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rowno</span><span class='Delimiter'>; 
</span><a name="LN224"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i_nspname</span><span class='Delimiter'>, 
</span><a name="LN225"></a>                    <span class='Declare_Local'>i_relname</span><span class='Delimiter'>, 
</span><a name="LN226"></a>                    <span class='Declare_Local'>i_attname</span><span class='Delimiter'>; 
</span><a name="LN227"></a>        <a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>active_db</span> <span class='Operator'>= &</span><a href="version.c.html#LN207"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a><span class='Delimiter'>[</span><a href="version.c.html#LN209"><span class='Ref_To_Local'>dbnum</span></a><span class='Delimiter'>]; 
</span><a name="LN228"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="server.c.html#LN25"><span class='Ref_to_Func'>connectToServer</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN207"><span class='Ref_to_Parameter'>cluster</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN227"><span class='Ref_To_Local'>active_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="version.c.html#LN220"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="server.c.html#LN116"><span class='Ref_to_Func'>executeQueryOrDie</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN228"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"SELECT n.nspname, c.relname, a.attname "</span> 
                                <span class='String'>"FROM   pg_catalog.pg_class c, "</span> 
                                <span class='String'>"       pg_catalog.pg_namespace n, "</span> 
                                <span class='String'>"       pg_catalog.pg_attribute a "</span> 
                                <span class='String'>"WHERE  c.oid = a.attrelid AND "</span> 
                                <span class='String'>"       NOT a.attisdropped AND "</span> 
                                <span class='String'>"       a.atttypid = 'pg_catalog.unknown'::pg_catalog.regtype AND "</span> 
                                <span class='String'>"       c.relkind IN ("</span> 
                                <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> 
                                <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) </span><span class='String'>", "</span> 
                                <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) </span><span class='String'>") AND "</span> 
                                <span class='String'>"       c.relnamespace = n.oid AND "</span> 
        <span class='Comment_Multi_Line'>/* exclude possible orphaned temp tables */ 
</span>                                <span class='String'>"       n.nspname !~ '^pg_temp_' AND "</span> 
                         <span class='String'>"      n.nspname !~ '^pg_toast_temp_' AND "</span> 
                                <span class='String'>"       n.nspname NOT IN ('pg_catalog', 'information_schema')"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="version.c.html#LN222"><span class='Ref_To_Local'>ntups</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN220"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="version.c.html#LN224"><span class='Ref_To_Local'>i_nspname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN220"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"nspname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="version.c.html#LN225"><span class='Ref_To_Local'>i_relname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN220"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"relname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="version.c.html#LN226"><span class='Ref_To_Local'>i_attname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN220"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"attname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="version.c.html#LN223"><span class='Ref_To_Local'>rowno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="version.c.html#LN223"><span class='Ref_To_Local'>rowno</span></a> <span class='Operator'>&LT; </span><a href="version.c.html#LN222"><span class='Ref_To_Local'>ntups</span></a><span class='Delimiter'>; </span><a href="version.c.html#LN223"><span class='Ref_To_Local'>rowno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="version.c.html#LN211"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN210"><span class='Ref_To_Local'>script</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="version.c.html#LN210"><span class='Ref_To_Local'>script</span></a> <span class='Operator'>= </span><a href="file.c.html#LN319"><span class='Ref_to_Func'>fopen_priv</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN212"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <a href="../pg_rewind/logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\": %s\n"</span><span class='Delimiter'>, </span><a href="version.c.html#LN212"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, 
</span>                         <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="version.c.html#LN221"><span class='Ref_To_Local'>db_used</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN210"><span class='Ref_To_Local'>script</span></a><span class='Delimiter'>, </span><span class='String'>"Database: %s\n"</span><span class='Delimiter'>, </span><a href="version.c.html#LN227"><span class='Ref_To_Local'>active_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="version.c.html#LN221"><span class='Ref_To_Local'>db_used</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN210"><span class='Ref_To_Local'>script</span></a><span class='Delimiter'>, </span><span class='String'>"  %s.%s.%s\n"</span><span class='Delimiter'>, 
</span>                    <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN220"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN223"><span class='Ref_To_Local'>rowno</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN224"><span class='Ref_To_Local'>i_nspname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN220"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN223"><span class='Ref_To_Local'>rowno</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN225"><span class='Ref_To_Local'>i_relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN220"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN223"><span class='Ref_To_Local'>rowno</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN226"><span class='Ref_To_Local'>i_attname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN220"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN228"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for dbnum=0;dbnum&LT;cluster... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN210"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>) 
</span>        fclose<span class='Parentheses'>(</span><a href="version.c.html#LN210"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN211"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN245"><span class='Ref_to_EnumConst'>PG_REPORT</span></a><span class='Delimiter'>, </span><span class='String'>"fatal\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../pg_rewind/logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"Your installation contains the \"unknown\" data type in user tables.  This\n"</span> 
                 <span class='String'>"data type is no longer allowed in tables, so this cluster cannot currently\n"</span> 
                 <span class='String'>"be upgraded.  You can remove the problem tables and restart the upgrade.\n"</span> 
                 <span class='String'>"A list of the problem columns is in the file:\n"</span> 
                 <span class='String'>"    %s\n\n"</span><span class='Delimiter'>, </span><a href="version.c.html#LN212"><span class='Ref_To_Local'>output_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end old_9_6_check_for_unknown_data_type_usage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * old_9_6_invalidate_hash_indexes() 
 *  9.6 -&GT; 10 
 *  Hash index binary format has changed from 9.6-&GT;10.0 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN296"></a><span class='Declare_Function'>old_9_6_invalidate_hash_indexes</span><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN259"><span class='Ref_to_Typedef'>ClusterInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cluster</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>check_mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN298"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dbnum</span><span class='Delimiter'>; 
</span><a name="LN299"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>script</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN300"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN301"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>output_path</span> <span class='Operator'>= </span><span class='String'>"reindex_hash.sql"</span><span class='Delimiter'>; 
</span> 
    <a href="util.c.html#LN68"><span class='Ref_to_Func'>prep_status</span></a><span class='Parentheses'>(</span><span class='String'>"Checking for hash indexes"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="version.c.html#LN298"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="version.c.html#LN298"><span class='Ref_To_Local'>dbnum</span></a> <span class='Operator'>&LT; </span><a href="version.c.html#LN296"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN196"><span class='Ref_to_Member'>ndbs</span></a><span class='Delimiter'>; </span><a href="version.c.html#LN298"><span class='Ref_To_Local'>dbnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN307"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN308"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>db_used</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN309"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ntups</span><span class='Delimiter'>; 
</span><a name="LN310"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rowno</span><span class='Delimiter'>; 
</span><a name="LN311"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i_nspname</span><span class='Delimiter'>, 
</span><a name="LN312"></a>                    <span class='Declare_Local'>i_relname</span><span class='Delimiter'>; 
</span><a name="LN313"></a>        <a href="pg_upgrade.h.html#LN181"><span class='Ref_to_Typedef'>DbInfo</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>active_db</span> <span class='Operator'>= &</span><a href="version.c.html#LN296"><span class='Ref_to_Parameter'>cluster</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN262"><span class='Ref_to_Member'>dbarr</span></a><span class='Operator'>.</span><a href="pg_upgrade.h.html#LN195"><span class='Ref_to_Member'>dbs</span></a><span class='Delimiter'>[</span><a href="version.c.html#LN298"><span class='Ref_To_Local'>dbnum</span></a><span class='Delimiter'>]; 
</span><a name="LN314"></a>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="server.c.html#LN25"><span class='Ref_to_Func'>connectToServer</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN296"><span class='Ref_to_Parameter'>cluster</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN313"><span class='Ref_To_Local'>active_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* find hash indexes */ 
</span>        <a href="version.c.html#LN307"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="server.c.html#LN116"><span class='Ref_to_Func'>executeQueryOrDie</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN314"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"SELECT n.nspname, c.relname "</span> 
                                <span class='String'>"FROM   pg_catalog.pg_class c, "</span> 
                                <span class='String'>"       pg_catalog.pg_index i, "</span> 
                                <span class='String'>"       pg_catalog.pg_am a, "</span> 
                                <span class='String'>"       pg_catalog.pg_namespace n "</span> 
                                <span class='String'>"WHERE  i.indexrelid = c.oid AND "</span> 
                                <span class='String'>"       c.relam = a.oid AND "</span> 
                                <span class='String'>"       c.relnamespace = n.oid AND "</span> 
                                <span class='String'>"       a.amname = 'hash'"</span> 
            <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="version.c.html#LN309"><span class='Ref_To_Local'>ntups</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN307"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="version.c.html#LN311"><span class='Ref_To_Local'>i_nspname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN307"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"nspname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="version.c.html#LN312"><span class='Ref_To_Local'>i_relname</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN477"><span class='Ref_to_Proto'>PQfnumber</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN307"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='String'>"relname"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="version.c.html#LN310"><span class='Ref_To_Local'>rowno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="version.c.html#LN310"><span class='Ref_To_Local'>rowno</span></a> <span class='Operator'>&LT; </span><a href="version.c.html#LN309"><span class='Ref_To_Local'>ntups</span></a><span class='Delimiter'>; </span><a href="version.c.html#LN310"><span class='Ref_To_Local'>rowno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="version.c.html#LN300"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="version.c.html#LN296"><span class='Ref_to_Parameter'>check_mode</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN299"><span class='Ref_To_Local'>script</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="version.c.html#LN299"><span class='Ref_To_Local'>script</span></a> <span class='Operator'>= </span><a href="file.c.html#LN319"><span class='Ref_to_Func'>fopen_priv</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN301"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                    <a href="../pg_rewind/logging.c.html#LN81"><span class='Ref_to_Func'>pg_fatal</span></a><span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\": %s\n"</span><span class='Delimiter'>, </span><a href="version.c.html#LN301"><span class='Ref_To_Local'>output_path</span></a><span class='Delimiter'>, 
</span>                             <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="version.c.html#LN308"><span class='Ref_To_Local'>db_used</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN342"></a>                    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>connectbuf</span><span class='Delimiter'>; 
</span> 
                    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="version.c.html#LN342"><span class='Ref_To_Local'>connectbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/fe_utils/string_utils.h.html#LN46"><span class='Ref_to_Proto'>appendPsqlMetaConnect</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="version.c.html#LN342"><span class='Ref_To_Local'>connectbuf</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN313"><span class='Ref_To_Local'>active_db</span></a><span class='Operator'>-&GT;</span><a href="pg_upgrade.h.html#LN184"><span class='Ref_to_Member'>db_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN342"><span class='Ref_To_Local'>connectbuf</span></a><span class='Operator'>.</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN299"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="version.c.html#LN342"><span class='Ref_To_Local'>connectbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="version.c.html#LN308"><span class='Ref_To_Local'>db_used</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN299"><span class='Ref_To_Local'>script</span></a><span class='Delimiter'>, </span><span class='String'>"REINDEX INDEX %s.%s;\n"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN307"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN310"><span class='Ref_To_Local'>rowno</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN311"><span class='Ref_To_Local'>i_nspname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN307"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN310"><span class='Ref_To_Local'>rowno</span></a><span class='Delimiter'>, </span><a href="version.c.html#LN312"><span class='Ref_To_Local'>i_relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for rowno=0;rowno&LT;ntups;r... &raquo; </span> 
 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN307"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="version.c.html#LN296"><span class='Ref_to_Parameter'>check_mode</span></a> <span class='Operator'>&& </span><a href="version.c.html#LN308"><span class='Ref_To_Local'>db_used</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* mark hash indexes as invalid */ 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="server.c.html#LN116"><span class='Ref_to_Func'>executeQueryOrDie</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN314"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, 
</span>                                      <span class='String'>"UPDATE pg_catalog.pg_index i "</span> 
                                      <span class='String'>"SET  indisvalid = false "</span> 
                                      <span class='String'>"FROM pg_catalog.pg_class c, "</span> 
                                      <span class='String'>"     pg_catalog.pg_am a, "</span> 
                                      <span class='String'>"     pg_catalog.pg_namespace n "</span> 
                                      <span class='String'>"WHERE    i.indexrelid = c.oid AND "</span> 
                                      <span class='String'>"     c.relam = a.oid AND "</span> 
                                      <span class='String'>"     c.relnamespace = n.oid AND "</span> 
                                      <span class='String'>"     a.amname = 'hash'"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="version.c.html#LN314"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for dbnum=0;dbnum&LT;cluster... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN299"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>) 
</span>        fclose<span class='Parentheses'>(</span><a href="version.c.html#LN299"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN300"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        report_status<span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN246"><span class='Ref_to_EnumConst'>PG_WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"warning"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="version.c.html#LN296"><span class='Ref_to_Parameter'>check_mode</span></a><span class='Parentheses'>) 
</span>            <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN246"><span class='Ref_to_EnumConst'>PG_WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span> 
                   <span class='String'>"Your installation contains hash indexes.  These indexes have different\n"</span> 
                   <span class='String'>"internal formats between your old and new clusters, so they must be\n"</span> 
                   <span class='String'>"reindexed with the REINDEX command.  After upgrading, you will be given\n"</span> 
                   <span class='String'>"REINDEX instructions.\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../pg_rewind/logging.c.html#LN67"><span class='Ref_to_Func'>pg_log</span></a><span class='Parentheses'>(</span><a href="pg_upgrade.h.html#LN246"><span class='Ref_to_EnumConst'>PG_WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span> 
                   <span class='String'>"Your installation contains hash indexes.  These indexes have different\n"</span> 
                   <span class='String'>"internal formats between your old and new clusters, so they must be\n"</span> 
                   <span class='String'>"reindexed with the REINDEX command.  The file:\n"</span> 
                   <span class='String'>"    %s\n"</span> 
                   <span class='String'>"when executed by psql by the database superuser will recreate all invalid\n"</span> 
              <span class='String'>"indexes; until then, none of these indexes will be used.\n\n"</span><span class='Delimiter'>, 
</span>                   <a href="version.c.html#LN301"><span class='Ref_To_Local'>output_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="util.c.html#LN170"><span class='Ref_to_Func'>check_ok</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end old_9_6_invalidate_hash_indexes &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>