<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pg_waldump\pg_waldump.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pg_waldump\pg_waldump.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:01 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_waldump.c - decode and display WAL 
 * 
 * Copyright (c) 2013-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *        src/bin/pg_waldump/pg_waldump.c 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<a name="LN11"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>FRONTEND</span> <span class='Number'>1</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;dirent.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/xlogreader.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlogrecord.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog_internal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/fe_memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"getopt_long.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rmgrdesc.h"</span> 
 
 
<a name="LN26"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>progname</span><span class='Delimiter'>; 
</span> 
<a name="LN28"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>XLogDumpPrivate</span> 
<span class='Delimiter'>{ 
</span><a name="LN30"></a>    <a href="../../include/access/xlogdefs.h.html#LN44"><span class='Ref_to_Typedef'>TimeLineID</span></a>  <span class='Declare_Member'>timeline</span><span class='Delimiter'>; 
</span><a name="LN31"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>inpath</span><span class='Delimiter'>; 
</span><a name="LN32"></a>    <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Member'>startptr</span><span class='Delimiter'>; 
</span><a name="LN33"></a>    <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Member'>endptr</span><span class='Delimiter'>; 
</span><a name="LN34"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>endptr_reached</span><span class='Delimiter'>; 
</span><a name="LN35"></a>} <span class='Declare_Typedef'>XLogDumpPrivate</span><span class='Delimiter'>; 
</span> 
<a name="LN37"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>XLogDumpConfig</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* display options */ 
</span><a name="LN40"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>bkp_details</span><span class='Delimiter'>; 
</span><a name="LN41"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>stop_after_records</span><span class='Delimiter'>; 
</span><a name="LN42"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>already_displayed_records</span><span class='Delimiter'>; 
</span><a name="LN43"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>follow</span><span class='Delimiter'>; 
</span><a name="LN44"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>stats</span><span class='Delimiter'>; 
</span><a name="LN45"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>stats_per_record</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* filter options */ 
</span><a name="LN48"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>filter_by_rmgr</span><span class='Delimiter'>; 
</span><a name="LN49"></a>    <a href="../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Member'>filter_by_xid</span><span class='Delimiter'>; 
</span><a name="LN50"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>filter_by_xid_enabled</span><span class='Delimiter'>; 
</span><a name="LN51"></a>} <span class='Declare_Typedef'>XLogDumpConfig</span><span class='Delimiter'>; 
</span> 
<a name="LN53"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>Stats</span> 
<span class='Delimiter'>{ 
</span><a name="LN55"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Member'>count</span><span class='Delimiter'>; 
</span><a name="LN56"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Member'>rec_len</span><span class='Delimiter'>; 
</span><a name="LN57"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Member'>fpi_len</span><span class='Delimiter'>; 
</span><a name="LN58"></a>} <span class='Declare_Typedef'>Stats</span><span class='Delimiter'>; 
</span> 
<a name="LN60"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_XLINFO_TYPES</span> <span class='Number'>16</span> 
 
<a name="LN62"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>XLogDumpStats</span> 
<span class='Delimiter'>{ 
</span><a name="LN64"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Member'>count</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <a href="pg_waldump.c.html#LN53"><span class='Ref_to_Struct'>Stats</span></a>       <span class='Declare_Member'>rmgr_stats</span><span class='Delimiter'>[</span><a href="../../include/access/rmgr.h.html#LN27"><span class='Ref_to_EnumConst'>RM_NEXT_ID</span></a><span class='Delimiter'>]; 
</span><a name="LN66"></a>    <a href="pg_waldump.c.html#LN53"><span class='Ref_to_Struct'>Stats</span></a>       <span class='Declare_Member'>record_stats</span><span class='Delimiter'>[</span><a href="../../include/access/rmgr.h.html#LN27"><span class='Ref_to_EnumConst'>RM_NEXT_ID</span></a><span class='Delimiter'>][</span><a href="pg_waldump.c.html#LN60"><span class='Ref_to_Const'>MAX_XLINFO_TYPES</span></a><span class='Delimiter'>]; 
</span><a name="LN67"></a>} <span class='Declare_Typedef'>XLogDumpStats</span><span class='Delimiter'>; 
</span> 
<a name="LN69"></a><span class='Keyword'>static void </span><span class='Declare_Function'>fatal_error</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) </span><a href="../../port/win32security.c.html#LN25"><span class='Ref_to_Func'>pg_attribute_printf</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Big red button to push when things go horribly wrong. 
 */ 
</span><span class='Keyword'>static void 
</span><a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><a href="pg_waldump.c.html#LN69"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN77"></a>    va_list     <span class='Declare_Local'>args</span><span class='Delimiter'>; 
</span> 
    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: FATAL:  "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN77"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN69"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN171"><span class='Ref_to_Macro'>vfprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN69"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN77"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN77"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fputc<span class='Parentheses'>(</span><span class='String'>'\n'</span><span class='Delimiter'>, </span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><a href="../psql/settings.h.html#LN150"><span class='Ref_to_Const'>EXIT_FAILURE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fatal_error &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN91"></a><span class='Declare_Function'>print_rmgr_list</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN93"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN93"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN93"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="../../include/access/rmgr.h.html#LN32"><span class='Ref_to_Const'>RM_MAX_ID</span></a><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN93"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><a href="rmgrdesc.c.html#LN37"><span class='Ref_to_Global_Var'>RmgrDescTable</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN93"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rmgrdesc.h.html#LN14"><span class='Ref_to_Member'>rm_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Check whether directory exists and whether we can open it. Keep errno set so 
 * that the caller can report errors somewhat more accurately. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN106"></a><span class='Declare_Function'>verify_directory</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>directory</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN108"></a>    <a href="../../port/dirent.c.html#LN24"><span class='Ref_to_Struct'>DIR</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>dir</span> <span class='Operator'>= </span><a href="../../include/port/win32_msvc/dirent.h.html#LN18"><span class='Ref_to_Proto'>opendir</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN106"><span class='Ref_to_Parameter'>directory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN108"><span class='Ref_To_Local'>dir</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="../../include/port/win32_msvc/dirent.h.html#LN20"><span class='Ref_to_Proto'>closedir</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN108"><span class='Ref_To_Local'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Split a pathname as dirname(1) and basename(1) would. 
 * 
 * XXX this probably doesn't do very well on Windows.  We probably need to 
 * apply canonicalize_path(), at the very least. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN123"></a><span class='Declare_Function'>split_path</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>dir</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>fname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN125"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sep</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* split filepath into directory & filename */ 
</span>    <a href="pg_waldump.c.html#LN125"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>= </span>strrchr<span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN123"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span><span class='String'>'/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* directory path */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN125"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="pg_waldump.c.html#LN123"><span class='Ref_to_Parameter'>dir</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN123"><span class='Ref_to_Parameter'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_waldump.c.html#LN123"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN125"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>- </span><a href="pg_waldump.c.html#LN123"><span class='Ref_to_Parameter'>path</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* no strndup */ 
</span>        <span class='Operator'>*</span><a href="pg_waldump.c.html#LN123"><span class='Ref_to_Parameter'>fname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN125"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* local directory */ 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="pg_waldump.c.html#LN123"><span class='Ref_to_Parameter'>dir</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pg_waldump.c.html#LN123"><span class='Ref_to_Parameter'>fname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN123"><span class='Ref_to_Parameter'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end split_path &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Try to find the file in several places: 
 * if directory == NULL: 
 *   fname 
 *   XLOGDIR / fname 
 *   $PGDATA / XLOGDIR / fname 
 * else 
 *   directory / fname 
 *   directory / XLOGDIR / fname 
 * 
 * return a read only fd 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN158"></a><span class='Declare_Function'>fuzzy_open_file</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>directory</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN160"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fd</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN161"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>fpath</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN158"><span class='Ref_to_Parameter'>directory</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN165"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>datadir</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* fname */ 
</span>        <a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN158"><span class='Ref_to_Parameter'>fname</span></a><span class='Delimiter'>, </span>O_RDONLY <span class='Operator'>| </span><a href="../../include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span>errno <span class='Operator'>!= </span>ENOENT<span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* XLOGDIR / fname */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN161"><span class='Ref_To_Local'>fpath</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, 
</span>                 <a href="../../include/access/xlog_internal.h.html#LN130"><span class='Ref_to_Const'>XLOGDIR</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN158"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN161"><span class='Ref_To_Local'>fpath</span></a><span class='Delimiter'>, </span>O_RDONLY <span class='Operator'>| </span><a href="../../include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span>errno <span class='Operator'>!= </span>ENOENT<span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_waldump.c.html#LN165"><span class='Ref_To_Local'>datadir</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGDATA"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* $PGDATA / XLOGDIR / fname */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN165"><span class='Ref_To_Local'>datadir</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN161"><span class='Ref_To_Local'>fpath</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s/%s"</span><span class='Delimiter'>, 
</span>                     <a href="pg_waldump.c.html#LN165"><span class='Ref_To_Local'>datadir</span></a><span class='Delimiter'>, </span><a href="../../include/access/xlog_internal.h.html#LN130"><span class='Ref_to_Const'>XLOGDIR</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN158"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN161"><span class='Ref_To_Local'>fpath</span></a><span class='Delimiter'>, </span>O_RDONLY <span class='Operator'>| </span><a href="../../include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span>errno <span class='Operator'>!= </span>ENOENT<span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if directory==NULL &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* directory / fname */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN161"><span class='Ref_To_Local'>fpath</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, 
</span>                 <a href="pg_waldump.c.html#LN158"><span class='Ref_to_Parameter'>directory</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN158"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN161"><span class='Ref_To_Local'>fpath</span></a><span class='Delimiter'>, </span>O_RDONLY <span class='Operator'>| </span><a href="../../include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span>errno <span class='Operator'>!= </span>ENOENT<span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* directory / XLOGDIR / fname */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN161"><span class='Ref_To_Local'>fpath</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s/%s"</span><span class='Delimiter'>, 
</span>                 <a href="pg_waldump.c.html#LN158"><span class='Ref_to_Parameter'>directory</span></a><span class='Delimiter'>, </span><a href="../../include/access/xlog_internal.h.html#LN130"><span class='Ref_to_Const'>XLOGDIR</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN158"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN289"><span class='Ref_to_Macro'>open</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN161"><span class='Ref_To_Local'>fpath</span></a><span class='Delimiter'>, </span>O_RDONLY <span class='Operator'>| </span><a href="../../include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span>errno <span class='Operator'>!= </span>ENOENT<span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pg_waldump.c.html#LN160"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fuzzy_open_file &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read count bytes from a segment file in the specified directory, for the 
 * given timeline, containing the specified record pointer; store the data in 
 * the passed buffer. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN225"></a><span class='Declare_Function'>XLogDumpXLogRead</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>directory</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN44"><span class='Ref_to_Typedef'>TimeLineID</span></a> <span class='Declare_Parameter'>timeline_id</span><span class='Delimiter'>, 
</span><a name="LN226"></a>                 <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>startptr</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>count</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN228"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN229"></a>    <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>recptr</span><span class='Delimiter'>; 
</span><a name="LN230"></a>    <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span> 
<a name="LN232"></a>    <span class='Keyword'>static int</span>  <span class='Declare_Local'>sendFile</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN233"></a>    <span class='Keyword'>static </span><a href="../../include/access/xlogdefs.h.html#LN33"><span class='Ref_to_Typedef'>XLogSegNo</span></a> <span class='Declare_Local'>sendSegNo</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN234"></a>    <span class='Keyword'>static </span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Local'>sendOff</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN228"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN226"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN229"><span class='Ref_To_Local'>recptr</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN226"><span class='Ref_to_Parameter'>startptr</span></a><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN230"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN226"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN230"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN242"></a>        <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>startoff</span><span class='Delimiter'>; 
</span><a name="LN243"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>segbytes</span><span class='Delimiter'>; 
</span><a name="LN244"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>readbytes</span><span class='Delimiter'>; 
</span> 
        <a href="pg_waldump.c.html#LN242"><span class='Ref_To_Local'>startoff</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN229"><span class='Ref_To_Local'>recptr</span></a> <span class='Operator'>% </span><a href="../../include/access/xlog_internal.h.html#LN91"><span class='Ref_to_Const'>XLogSegSize</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN232"><span class='Ref_To_Local'>sendFile</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| !</span><a href="../../include/access/xlog_internal.h.html#LN117"><span class='Ref_to_Macro'>XLByteInSeg</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN229"><span class='Ref_To_Local'>recptr</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN233"><span class='Ref_To_Local'>sendSegNo</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN250"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>fname</span><span class='Delimiter'>[</span><a href="../../include/access/xlog_internal.h.html#LN137"><span class='Ref_to_Const'>MAXFNAMELEN</span></a><span class='Delimiter'>]; 
</span><a name="LN251"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>tries</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Switch to another logfile segment */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN232"><span class='Ref_To_Local'>sendFile</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN232"><span class='Ref_To_Local'>sendFile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/xlog_internal.h.html#LN105"><span class='Ref_to_Macro'>XLByteToSeg</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN229"><span class='Ref_To_Local'>recptr</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN233"><span class='Ref_To_Local'>sendSegNo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/xlog_internal.h.html#LN142"><span class='Ref_to_Macro'>XLogFileName</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN250"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN225"><span class='Ref_to_Parameter'>timeline_id</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN233"><span class='Ref_To_Local'>sendSegNo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In follow mode there is a short period of time after the server 
             * has written the end of the previous file before the new file is 
             * available. So we loop for 5 seconds looking for the file to 
             * appear before giving up. 
             */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN251"><span class='Ref_To_Local'>tries</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN251"><span class='Ref_To_Local'>tries</span></a> <span class='Operator'>&LT; </span><span class='Number'>10</span><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN251"><span class='Ref_To_Local'>tries</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_waldump.c.html#LN232"><span class='Ref_To_Local'>sendFile</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN157"><span class='Ref_to_Func'>fuzzy_open_file</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN225"><span class='Ref_to_Parameter'>directory</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN250"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN232"><span class='Ref_To_Local'>sendFile</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN274"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* File not there yet, try again */ 
</span>                    <a href="../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><span class='Number'>500</span> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    errno <span class='Operator'>= </span><a href="pg_waldump.c.html#LN274"><span class='Ref_To_Local'>save_errno</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* Any other error, fall through and fail */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN232"><span class='Ref_To_Local'>sendFile</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not find file \"%s\": %s"</span><span class='Delimiter'>, 
</span>                            <a href="pg_waldump.c.html#LN250"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pg_waldump.c.html#LN234"><span class='Ref_To_Local'>sendOff</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if sendFile&LT;0||!XLByteIn... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Need to seek in the file? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN234"><span class='Ref_To_Local'>sendOff</span></a> <span class='Operator'>!= </span><a href="pg_waldump.c.html#LN242"><span class='Ref_To_Local'>startoff</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>lseek<span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN232"><span class='Ref_To_Local'>sendFile</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>off_t<span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN242"><span class='Ref_To_Local'>startoff</span></a><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>)</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><a name="LN297"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>err</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span><a name="LN298"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>fname</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
                <a href="../../include/access/xlog_internal.h.html#LN142"><span class='Ref_to_Macro'>XLogFileName</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN298"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN225"><span class='Ref_to_Parameter'>timeline_id</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN233"><span class='Ref_To_Local'>sendSegNo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not seek in log segment %s to offset %u: %s"</span><span class='Delimiter'>, 
</span>                            <a href="pg_waldump.c.html#LN298"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN242"><span class='Ref_To_Local'>startoff</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN297"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="pg_waldump.c.html#LN234"><span class='Ref_To_Local'>sendOff</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN242"><span class='Ref_To_Local'>startoff</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* How many bytes are within this segment? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN230"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="../../include/access/xlog_internal.h.html#LN91"><span class='Ref_to_Const'>XLogSegSize</span></a> <span class='Operator'>- </span><a href="pg_waldump.c.html#LN242"><span class='Ref_To_Local'>startoff</span></a><span class='Parentheses'>))</span> 
            <a href="pg_waldump.c.html#LN243"><span class='Ref_To_Local'>segbytes</span></a> <span class='Operator'>= </span><a href="../../include/access/xlog_internal.h.html#LN91"><span class='Ref_to_Const'>XLogSegSize</span></a> <span class='Operator'>- </span><a href="pg_waldump.c.html#LN242"><span class='Ref_To_Local'>startoff</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_waldump.c.html#LN243"><span class='Ref_To_Local'>segbytes</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN230"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_waldump.c.html#LN244"><span class='Ref_To_Local'>readbytes</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/win32.h.html#LN12"><span class='Ref_to_Macro'>read</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN232"><span class='Ref_To_Local'>sendFile</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN228"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN243"><span class='Ref_To_Local'>segbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN244"><span class='Ref_To_Local'>readbytes</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN317"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>err</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span><a name="LN318"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>fname</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
            <a href="../../include/access/xlog_internal.h.html#LN142"><span class='Ref_to_Macro'>XLogFileName</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN318"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN225"><span class='Ref_to_Parameter'>timeline_id</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN233"><span class='Ref_To_Local'>sendSegNo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not read from log segment %s, offset %d, length %d: %s"</span><span class='Delimiter'>, 
</span>                        <a href="pg_waldump.c.html#LN318"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN234"><span class='Ref_To_Local'>sendOff</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN243"><span class='Ref_To_Local'>segbytes</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN317"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Update state for read */ 
</span>        <a href="pg_waldump.c.html#LN229"><span class='Ref_To_Local'>recptr</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN244"><span class='Ref_To_Local'>readbytes</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_waldump.c.html#LN234"><span class='Ref_To_Local'>sendOff</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN244"><span class='Ref_To_Local'>readbytes</span></a><span class='Delimiter'>; 
</span>        <a href="pg_waldump.c.html#LN230"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>-= </span><a href="pg_waldump.c.html#LN244"><span class='Ref_To_Local'>readbytes</span></a><span class='Delimiter'>; 
</span>        <a href="pg_waldump.c.html#LN228"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN244"><span class='Ref_To_Local'>readbytes</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while nbytes&GT;0 &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end XLogDumpXLogRead &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * XLogReader read_page callback 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN339"></a><span class='Declare_Function'>XLogDumpReadPage</span><span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>targetPagePtr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>reqLen</span><span class='Delimiter'>, 
</span><a name="LN340"></a>                 <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>targetPtr</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>readBuff</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN44"><span class='Ref_to_Typedef'>TimeLineID</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>curFileTLI</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN342"></a>    <a href="pg_waldump.c.html#LN28"><span class='Ref_to_Struct'>XLogDumpPrivate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>private</span> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN339"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN107"><span class='Ref_to_Member'>private_data</span></a><span class='Delimiter'>; 
</span><a name="LN343"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span>XLOG_BLCKSZ<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a> <span class='Operator'>!= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN339"><span class='Ref_to_Parameter'>targetPagePtr</span></a> <span class='Operator'>+ </span>XLOG_BLCKSZ <span class='Operator'>&LT;= </span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a><span class='Parentheses'>) 
</span>            <a href="pg_waldump.c.html#LN343"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span>XLOG_BLCKSZ<span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN339"><span class='Ref_to_Parameter'>targetPagePtr</span></a> <span class='Operator'>+ </span><a href="pg_waldump.c.html#LN339"><span class='Ref_to_Parameter'>reqLen</span></a> <span class='Operator'>&LT;= </span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a><span class='Parentheses'>) 
</span>            <a href="pg_waldump.c.html#LN343"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a> <span class='Operator'>- </span><a href="pg_waldump.c.html#LN339"><span class='Ref_to_Parameter'>targetPagePtr</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN34"><span class='Ref_to_Member'>endptr_reached</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_waldump.c.html#LN224"><span class='Ref_to_Func'>XLogDumpXLogRead</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a><span class='Delimiter'>, </span><span class='Keyword'>private</span><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN30"><span class='Ref_to_Member'>timeline</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN339"><span class='Ref_to_Parameter'>targetPagePtr</span></a><span class='Delimiter'>, 
</span>                     <a href="pg_waldump.c.html#LN340"><span class='Ref_to_Parameter'>readBuff</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN343"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_waldump.c.html#LN343"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end XLogDumpReadPage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calculate the size of a record, split into !FPI and FPI parts. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN368"></a><span class='Declare_Function'>XLogDumpRecordLen</span><span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rec_len</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpi_len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN370"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>block_id</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate the amount of FPI data in the record. 
     * 
     * XXX: We peek into xlogreader's private decoded backup blocks for the 
     * bimg_len indicating the length of FPI data. It doesn't seem worth it to 
     * add an accessor macro for this. 
     */ 
</span>    <span class='Operator'>*</span><a href="pg_waldump.c.html#LN368"><span class='Ref_to_Parameter'>fpi_len</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN370"><span class='Ref_To_Local'>block_id</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN370"><span class='Ref_To_Local'>block_id</span></a> <span class='Operator'>&LT;= </span><a href="pg_waldump.c.html#LN368"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN135"><span class='Ref_to_Member'>max_block_id</span></a><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN370"><span class='Ref_To_Local'>block_id</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN224"><span class='Ref_to_Macro'>XLogRecHasBlockImage</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN368"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN370"><span class='Ref_To_Local'>block_id</span></a><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="pg_waldump.c.html#LN368"><span class='Ref_to_Parameter'>fpi_len</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN368"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN133"><span class='Ref_to_Member'>blocks</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN370"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/xlogreader.h.html#LN58"><span class='Ref_to_Member'>bimg_len</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate the length of the record as the total length - the length of 
     * all the block images. 
     */ 
</span>    <span class='Operator'>*</span><a href="pg_waldump.c.html#LN368"><span class='Ref_to_Parameter'>rec_len</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN213"><span class='Ref_to_Macro'>XLogRecGetTotalLen</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN368"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>) </span><span class='Operator'>- *</span><a href="pg_waldump.c.html#LN368"><span class='Ref_to_Parameter'>fpi_len</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end XLogDumpRecordLen &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Store per-rmgr and per-record statistics for a given record. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN397"></a><span class='Declare_Function'>XLogDumpCountRecord</span><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN37"><span class='Ref_to_Struct'>XLogDumpConfig</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>config</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN62"><span class='Ref_to_Struct'>XLogDumpStats</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stats</span><span class='Delimiter'>, 
</span><a name="LN398"></a>                    <a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN400"></a>    <a href="../../include/access/rmgr.h.html#LN10"><span class='Ref_to_Typedef'>RmgrId</span></a>      <span class='Declare_Local'>rmid</span><span class='Delimiter'>; 
</span><a name="LN401"></a>    <a href="../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>recid</span><span class='Delimiter'>; 
</span><a name="LN402"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>rec_len</span><span class='Delimiter'>; 
</span><a name="LN403"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>fpi_len</span><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN397"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN64"><span class='Ref_to_Member'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN400"><span class='Ref_To_Local'>rmid</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN216"><span class='Ref_to_Macro'>XLogRecGetRmid</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN398"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN367"><span class='Ref_to_Func'>XLogDumpRecordLen</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN398"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN402"><span class='Ref_To_Local'>rec_len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN403"><span class='Ref_To_Local'>fpi_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update per-rmgr statistics */ 
</span> 
    <a href="pg_waldump.c.html#LN397"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN65"><span class='Ref_to_Member'>rmgr_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN400"><span class='Ref_To_Local'>rmid</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN55"><span class='Ref_to_Member'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN397"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN65"><span class='Ref_to_Member'>rmgr_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN400"><span class='Ref_To_Local'>rmid</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN56"><span class='Ref_to_Member'>rec_len</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN402"><span class='Ref_To_Local'>rec_len</span></a><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN397"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN65"><span class='Ref_to_Member'>rmgr_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN400"><span class='Ref_To_Local'>rmid</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN57"><span class='Ref_to_Member'>fpi_len</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN403"><span class='Ref_To_Local'>fpi_len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update per-record statistics, where the record is identified by a 
     * combination of the RmgrId and the four bits of the xl_info field that 
     * are the rmgr's domain (resulting in sixteen possible entries per 
     * RmgrId). 
     */ 
</span> 
    <a href="pg_waldump.c.html#LN401"><span class='Ref_To_Local'>recid</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN398"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>4</span><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN397"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN66"><span class='Ref_to_Member'>record_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN400"><span class='Ref_To_Local'>rmid</span></a><span class='Delimiter'>][</span><a href="pg_waldump.c.html#LN401"><span class='Ref_To_Local'>recid</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN55"><span class='Ref_to_Member'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN397"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN66"><span class='Ref_to_Member'>record_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN400"><span class='Ref_To_Local'>rmid</span></a><span class='Delimiter'>][</span><a href="pg_waldump.c.html#LN401"><span class='Ref_To_Local'>recid</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN56"><span class='Ref_to_Member'>rec_len</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN402"><span class='Ref_To_Local'>rec_len</span></a><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN397"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN66"><span class='Ref_to_Member'>record_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN400"><span class='Ref_To_Local'>rmid</span></a><span class='Delimiter'>][</span><a href="pg_waldump.c.html#LN401"><span class='Ref_To_Local'>recid</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN57"><span class='Ref_to_Member'>fpi_len</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN403"><span class='Ref_To_Local'>fpi_len</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end XLogDumpCountRecord &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Print a record to stdout 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN435"></a><span class='Declare_Function'>XLogDumpDisplayRecord</span><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN37"><span class='Ref_to_Struct'>XLogDumpConfig</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>config</span><span class='Delimiter'>, </span><a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN437"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span><a name="LN438"></a>    <span class='Keyword'>const </span><a href="rmgrdesc.h.html#LN12"><span class='Ref_to_Struct'>RmgrDescData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>desc</span> <span class='Operator'>= &</span><a href="rmgrdesc.c.html#LN37"><span class='Ref_to_Global_Var'>RmgrDescTable</span></a><span class='Delimiter'>[</span><a href="../../include/access/xlogreader.h.html#LN216"><span class='Ref_to_Macro'>XLogRecGetRmid</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]; 
</span><a name="LN439"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>rec_len</span><span class='Delimiter'>; 
</span><a name="LN440"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>fpi_len</span><span class='Delimiter'>; 
</span><a name="LN441"></a>    <a href="../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Local'>rnode</span><span class='Delimiter'>; 
</span><a name="LN442"></a>    <a href="../../include/common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a>  <span class='Declare_Local'>forknum</span><span class='Delimiter'>; 
</span><a name="LN443"></a>    <a href="../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blk</span><span class='Delimiter'>; 
</span><a name="LN444"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>block_id</span><span class='Delimiter'>; 
</span><a name="LN445"></a>    <a href="../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN446"></a>    <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>xl_prev</span> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN214"><span class='Ref_to_Macro'>XLogRecGetPrev</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN367"><span class='Ref_to_Func'>XLogDumpRecordLen</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN439"><span class='Ref_To_Local'>rec_len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN440"><span class='Ref_To_Local'>fpi_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN437"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN438"><span class='Ref_To_Local'>desc</span></a><span class='Operator'>-&GT;</span>rm_identify<span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN445"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN437"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN437"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"UNKNOWN (%x)"</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN445"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>& ~</span><a href="../../include/access/xlogrecord.h.html#LN61"><span class='Ref_to_Const'>XLR_INFO_MASK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"rmgr: %-11s len (rec/tot): %6u/%6u, tx: %10u, lsn: %X/%08X, prev %X/%08X, "</span><span class='Delimiter'>, 
</span>           <a href="pg_waldump.c.html#LN438"><span class='Ref_To_Local'>desc</span></a><span class='Operator'>-&GT;</span><a href="rmgrdesc.h.html#LN14"><span class='Ref_to_Member'>rm_name</span></a><span class='Delimiter'>, 
</span>           <a href="pg_waldump.c.html#LN439"><span class='Ref_To_Local'>rec_len</span></a><span class='Delimiter'>, </span><a href="../../include/access/xlogreader.h.html#LN213"><span class='Ref_to_Macro'>XLogRecGetTotalLen</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../../include/access/xlogreader.h.html#LN217"><span class='Ref_to_Macro'>XLogRecGetXid</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN113"><span class='Ref_to_Member'>ReadRecPtr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN113"><span class='Ref_to_Member'>ReadRecPtr</span></a><span class='Delimiter'>, 
</span>           <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_waldump.c.html#LN446"><span class='Ref_To_Local'>xl_prev</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN446"><span class='Ref_To_Local'>xl_prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"desc: %s "</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN437"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* the desc routine will printf the description directly to stdout */ 
</span>    <a href="pg_waldump.c.html#LN438"><span class='Ref_To_Local'>desc</span></a><span class='Operator'>-&GT;</span><a href="rmgrdesc.h.html#LN15"><span class='Ref_to_Member'>rm_desc</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>config</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN40"><span class='Ref_to_Member'>bkp_details</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* print block references (short format) */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a> <span class='Operator'>&LT;= </span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN135"><span class='Ref_to_Member'>max_block_id</span></a><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xlogreader.h.html#LN222"><span class='Ref_to_Macro'>XLogRecHasBlockRef</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN442"><span class='Ref_To_Local'>forknum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN443"><span class='Ref_To_Local'>blk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN442"><span class='Ref_To_Local'>forknum</span></a> <span class='Operator'>!= </span><a href="../../include/common/relpath.h.html#LN26"><span class='Ref_to_EnumConst'>MAIN_FORKNUM</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>", blkref #%u: rel %u/%u/%u fork %s blk %u"</span><span class='Delimiter'>, 
</span>                       <a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>, 
</span>                       <a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a><span class='Delimiter'>, 
</span>                       <a href="../../common/relpath.c.html#LN33"><span class='Ref_to_Global_Var'>forkNames</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN442"><span class='Ref_To_Local'>forknum</span></a><span class='Delimiter'>], 
</span>                       <a href="pg_waldump.c.html#LN443"><span class='Ref_To_Local'>blk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>", blkref #%u: rel %u/%u/%u blk %u"</span><span class='Delimiter'>, 
</span>                       <a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>, 
</span>                       <a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a><span class='Delimiter'>, 
</span>                       <a href="pg_waldump.c.html#LN443"><span class='Ref_To_Local'>blk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN224"><span class='Ref_to_Macro'>XLogRecHasBlockImage</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN226"><span class='Ref_to_Macro'>XLogRecBlockImageApply</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>" FPW"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>" FPW for WAL verification"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for block_id=0;block_id&LT;=... &raquo; </span> 
        putchar<span class='Parentheses'>(</span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !config-&GT;bkp_details &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* print block references (detailed format) */ 
</span>        putchar<span class='Parentheses'>(</span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a> <span class='Operator'>&LT;= </span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN135"><span class='Ref_to_Member'>max_block_id</span></a><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xlogreader.h.html#LN222"><span class='Ref_to_Macro'>XLogRecHasBlockRef</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN442"><span class='Ref_To_Local'>forknum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN443"><span class='Ref_To_Local'>blk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"\tblkref #%u: rel %u/%u/%u fork %s blk %u"</span><span class='Delimiter'>, 
</span>                   <a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>, 
</span>                   <a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN441"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a><span class='Delimiter'>, 
</span>                   <a href="../../common/relpath.c.html#LN33"><span class='Ref_to_Global_Var'>forkNames</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN442"><span class='Ref_To_Local'>forknum</span></a><span class='Delimiter'>], 
</span>                   <a href="pg_waldump.c.html#LN443"><span class='Ref_To_Local'>blk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN224"><span class='Ref_to_Macro'>XLogRecHasBlockImage</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN133"><span class='Ref_to_Member'>blocks</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/xlogreader.h.html#LN59"><span class='Ref_to_Member'>bimg_info</span></a> <span class='Operator'>& 
</span>                    <a href="../../include/access/xlogrecord.h.html#LN147"><span class='Ref_to_Const'>BKPIMAGE_IS_COMPRESSED</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>" (FPW%s); hole: offset: %u, length: %u, "</span> 
                           <span class='String'>"compression saved: %u\n"</span><span class='Delimiter'>, 
</span>                           <a href="../../include/access/xlogreader.h.html#LN226"><span class='Ref_to_Macro'>XLogRecBlockImageApply</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Parentheses'>) </span><span class='Operator'>? 
</span>                           <span class='String'>""</span> <span class='Operator'>: </span><span class='String'>" for WAL verification"</span><span class='Delimiter'>, 
</span>                           <a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN133"><span class='Ref_to_Member'>blocks</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/xlogreader.h.html#LN56"><span class='Ref_to_Member'>hole_offset</span></a><span class='Delimiter'>, 
</span>                           <a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN133"><span class='Ref_to_Member'>blocks</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/xlogreader.h.html#LN57"><span class='Ref_to_Member'>hole_length</span></a><span class='Delimiter'>, 
</span>                           BLCKSZ <span class='Operator'>- 
</span>                           <a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN133"><span class='Ref_to_Member'>blocks</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/xlogreader.h.html#LN57"><span class='Ref_to_Member'>hole_length</span></a> <span class='Operator'>- 
</span>                           <a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN133"><span class='Ref_to_Member'>blocks</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/xlogreader.h.html#LN58"><span class='Ref_to_Member'>bimg_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>" (FPW%s); hole: offset: %u, length: %u\n"</span><span class='Delimiter'>, 
</span>                           <a href="../../include/access/xlogreader.h.html#LN226"><span class='Ref_to_Macro'>XLogRecBlockImageApply</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Parentheses'>) </span><span class='Operator'>? 
</span>                           <span class='String'>""</span> <span class='Operator'>: </span><span class='String'>" for WAL verification"</span><span class='Delimiter'>, 
</span>                           <a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN133"><span class='Ref_to_Member'>blocks</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/xlogreader.h.html#LN56"><span class='Ref_to_Member'>hole_offset</span></a><span class='Delimiter'>, 
</span>                           <a href="pg_waldump.c.html#LN435"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN133"><span class='Ref_to_Member'>blocks</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN444"><span class='Ref_To_Local'>block_id</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/xlogreader.h.html#LN57"><span class='Ref_to_Member'>hole_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if XLogRecHasBlockImage(... &raquo; </span> 
            putchar<span class='Parentheses'>(</span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for block_id=0;block_id&LT;=... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end XLogDumpDisplayRecord &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Display a single row of record counts and sizes for an rmgr or record. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN543"></a><span class='Declare_Function'>XLogDumpStatsRow</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, 
</span><a name="LN544"></a>                 <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>n</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>total_count</span><span class='Delimiter'>, 
</span><a name="LN545"></a>                 <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>rec_len</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>total_rec_len</span><span class='Delimiter'>, 
</span><a name="LN546"></a>                 <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>fpi_len</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>total_fpi_len</span><span class='Delimiter'>, 
</span><a name="LN547"></a>                 <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>tot_len</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>total_len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN549"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>n_pct</span><span class='Delimiter'>, 
</span><a name="LN550"></a>                <span class='Declare_Local'>rec_len_pct</span><span class='Delimiter'>, 
</span><a name="LN551"></a>                <span class='Declare_Local'>fpi_len_pct</span><span class='Delimiter'>, 
</span><a name="LN552"></a>                <span class='Declare_Local'>tot_len_pct</span><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN549"><span class='Ref_To_Local'>n_pct</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN544"><span class='Ref_to_Parameter'>total_count</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN549"><span class='Ref_To_Local'>n_pct</span></a> <span class='Operator'>= </span><span class='Number'>100</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN544"><span class='Ref_to_Parameter'>n</span></a> <span class='Operator'>/ </span><a href="pg_waldump.c.html#LN544"><span class='Ref_to_Parameter'>total_count</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN550"><span class='Ref_To_Local'>rec_len_pct</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN545"><span class='Ref_to_Parameter'>total_rec_len</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN550"><span class='Ref_To_Local'>rec_len_pct</span></a> <span class='Operator'>= </span><span class='Number'>100</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN545"><span class='Ref_to_Parameter'>rec_len</span></a> <span class='Operator'>/ </span><a href="pg_waldump.c.html#LN545"><span class='Ref_to_Parameter'>total_rec_len</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN551"><span class='Ref_To_Local'>fpi_len_pct</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN546"><span class='Ref_to_Parameter'>total_fpi_len</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN551"><span class='Ref_To_Local'>fpi_len_pct</span></a> <span class='Operator'>= </span><span class='Number'>100</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN546"><span class='Ref_to_Parameter'>fpi_len</span></a> <span class='Operator'>/ </span><a href="pg_waldump.c.html#LN546"><span class='Ref_to_Parameter'>total_fpi_len</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN552"><span class='Ref_To_Local'>tot_len_pct</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN547"><span class='Ref_to_Parameter'>total_len</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN552"><span class='Ref_To_Local'>tot_len_pct</span></a> <span class='Operator'>= </span><span class='Number'>100</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN547"><span class='Ref_to_Parameter'>tot_len</span></a> <span class='Operator'>/ </span><a href="pg_waldump.c.html#LN547"><span class='Ref_to_Parameter'>total_len</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%-27s "</span> 
           <span class='String'>"%20"</span> INT64_MODIFIER <span class='String'>"u (%6.02f) "</span> 
           <span class='String'>"%20"</span> INT64_MODIFIER <span class='String'>"u (%6.02f) "</span> 
           <span class='String'>"%20"</span> INT64_MODIFIER <span class='String'>"u (%6.02f) "</span> 
           <span class='String'>"%20"</span> INT64_MODIFIER <span class='String'>"u (%6.02f)\n"</span><span class='Delimiter'>, 
</span>           <a href="pg_waldump.c.html#LN543"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN544"><span class='Ref_to_Parameter'>n</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN549"><span class='Ref_To_Local'>n_pct</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN545"><span class='Ref_to_Parameter'>rec_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN550"><span class='Ref_To_Local'>rec_len_pct</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN546"><span class='Ref_to_Parameter'>fpi_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN551"><span class='Ref_To_Local'>fpi_len_pct</span></a><span class='Delimiter'>, 
</span>           <a href="pg_waldump.c.html#LN547"><span class='Ref_to_Parameter'>tot_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN552"><span class='Ref_To_Local'>tot_len_pct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end XLogDumpStatsRow &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Display summary statistics about the records seen so far. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN584"></a><span class='Declare_Function'>XLogDumpDisplayStats</span><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN37"><span class='Ref_to_Struct'>XLogDumpConfig</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>config</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN62"><span class='Ref_to_Struct'>XLogDumpStats</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stats</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN586"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ri</span><span class='Delimiter'>, 
</span><a name="LN587"></a>                <span class='Declare_Local'>rj</span><span class='Delimiter'>; 
</span><a name="LN588"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>total_count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN589"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>total_rec_len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN590"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>total_fpi_len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN591"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>total_len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN592"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>rec_len_pct</span><span class='Delimiter'>, 
</span><a name="LN593"></a>                <span class='Declare_Local'>fpi_len_pct</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* --- 
     * Make a first pass to calculate column totals: 
     * count(*), 
     * sum(xl_len+SizeOfXLogRecord), 
     * sum(xl_tot_len-xl_len-SizeOfXLogRecord), and 
     * sum(xl_tot_len). 
     * These are used to calculate percentages for each record type. 
     * --- 
     */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a> <span class='Operator'>&LT; </span><a href="../../include/access/rmgr.h.html#LN27"><span class='Ref_to_EnumConst'>RM_NEXT_ID</span></a><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_waldump.c.html#LN588"><span class='Ref_To_Local'>total_count</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN65"><span class='Ref_to_Member'>rmgr_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN55"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>; 
</span>        <a href="pg_waldump.c.html#LN589"><span class='Ref_To_Local'>total_rec_len</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN65"><span class='Ref_to_Member'>rmgr_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN56"><span class='Ref_to_Member'>rec_len</span></a><span class='Delimiter'>; 
</span>        <a href="pg_waldump.c.html#LN590"><span class='Ref_To_Local'>total_fpi_len</span></a> <span class='Operator'>+= </span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN65"><span class='Ref_to_Member'>rmgr_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN57"><span class='Ref_to_Member'>fpi_len</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_waldump.c.html#LN591"><span class='Ref_To_Local'>total_len</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN589"><span class='Ref_To_Local'>total_rec_len</span></a> <span class='Operator'>+ </span><a href="pg_waldump.c.html#LN590"><span class='Ref_To_Local'>total_fpi_len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 27 is strlen("Transaction/COMMIT_PREPARED"), 20 is strlen(2^64), 8 is 
     * strlen("(100.00%)") 
     */ 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%-27s %20s %8s %20s %8s %20s %8s %20s %8s\n"</span> 
           <span class='String'>"%-27s %20s %8s %20s %8s %20s %8s %20s %8s\n"</span><span class='Delimiter'>, 
</span>           <span class='String'>"Type"</span><span class='Delimiter'>, </span><span class='String'>"N"</span><span class='Delimiter'>, </span><span class='String'>"(%)"</span><span class='Delimiter'>, </span><span class='String'>"Record size"</span><span class='Delimiter'>, </span><span class='String'>"(%)"</span><span class='Delimiter'>, </span><span class='String'>"FPI size"</span><span class='Delimiter'>, </span><span class='String'>"(%)"</span><span class='Delimiter'>, </span><span class='String'>"Combined size"</span><span class='Delimiter'>, </span><span class='String'>"(%)"</span><span class='Delimiter'>, 
</span>           <span class='String'>"----"</span><span class='Delimiter'>, </span><span class='String'>"-"</span><span class='Delimiter'>, </span><span class='String'>"---"</span><span class='Delimiter'>, </span><span class='String'>"-----------"</span><span class='Delimiter'>, </span><span class='String'>"---"</span><span class='Delimiter'>, </span><span class='String'>"--------"</span><span class='Delimiter'>, </span><span class='String'>"---"</span><span class='Delimiter'>, </span><span class='String'>"-------------"</span><span class='Delimiter'>, </span><span class='String'>"---"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a> <span class='Operator'>&LT; </span><a href="../../include/access/rmgr.h.html#LN27"><span class='Ref_to_EnumConst'>RM_NEXT_ID</span></a><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN625"></a>        <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>count</span><span class='Delimiter'>, 
</span><a name="LN626"></a>                    <span class='Declare_Local'>rec_len</span><span class='Delimiter'>, 
</span><a name="LN627"></a>                    <span class='Declare_Local'>fpi_len</span><span class='Delimiter'>, 
</span><a name="LN628"></a>                    <span class='Declare_Local'>tot_len</span><span class='Delimiter'>; 
</span><a name="LN629"></a>        <span class='Keyword'>const </span><a href="rmgrdesc.h.html#LN12"><span class='Ref_to_Struct'>RmgrDescData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>desc</span> <span class='Operator'>= &</span><a href="rmgrdesc.c.html#LN37"><span class='Ref_to_Global_Var'>RmgrDescTable</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>config</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN45"><span class='Ref_to_Member'>stats_per_record</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_waldump.c.html#LN625"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN65"><span class='Ref_to_Member'>rmgr_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN55"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>; 
</span>            <a href="pg_waldump.c.html#LN626"><span class='Ref_To_Local'>rec_len</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN65"><span class='Ref_to_Member'>rmgr_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN56"><span class='Ref_to_Member'>rec_len</span></a><span class='Delimiter'>; 
</span>            <a href="pg_waldump.c.html#LN627"><span class='Ref_To_Local'>fpi_len</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN65"><span class='Ref_to_Member'>rmgr_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN57"><span class='Ref_to_Member'>fpi_len</span></a><span class='Delimiter'>; 
</span>            <a href="pg_waldump.c.html#LN628"><span class='Ref_To_Local'>tot_len</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN626"><span class='Ref_To_Local'>rec_len</span></a> <span class='Operator'>+ </span><a href="pg_waldump.c.html#LN627"><span class='Ref_To_Local'>fpi_len</span></a><span class='Delimiter'>; 
</span> 
            <a href="pg_waldump.c.html#LN542"><span class='Ref_to_Func'>XLogDumpStatsRow</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN629"><span class='Ref_To_Local'>desc</span></a><span class='Operator'>-&GT;</span><a href="rmgrdesc.h.html#LN14"><span class='Ref_to_Member'>rm_name</span></a><span class='Delimiter'>, 
</span>                             <a href="pg_waldump.c.html#LN625"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN588"><span class='Ref_To_Local'>total_count</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN626"><span class='Ref_To_Local'>rec_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN589"><span class='Ref_To_Local'>total_rec_len</span></a><span class='Delimiter'>, 
</span>                             <a href="pg_waldump.c.html#LN627"><span class='Ref_To_Local'>fpi_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN590"><span class='Ref_To_Local'>total_fpi_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN628"><span class='Ref_To_Local'>tot_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN591"><span class='Ref_To_Local'>total_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN587"><span class='Ref_To_Local'>rj</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN587"><span class='Ref_To_Local'>rj</span></a> <span class='Operator'>&LT; </span><a href="pg_waldump.c.html#LN60"><span class='Ref_to_Const'>MAX_XLINFO_TYPES</span></a><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN587"><span class='Ref_To_Local'>rj</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN646"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span> 
                <a href="pg_waldump.c.html#LN625"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN66"><span class='Ref_to_Member'>record_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Delimiter'>][</span><a href="pg_waldump.c.html#LN587"><span class='Ref_To_Local'>rj</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN55"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>; 
</span>                <a href="pg_waldump.c.html#LN626"><span class='Ref_To_Local'>rec_len</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN66"><span class='Ref_to_Member'>record_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Delimiter'>][</span><a href="pg_waldump.c.html#LN587"><span class='Ref_To_Local'>rj</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN56"><span class='Ref_to_Member'>rec_len</span></a><span class='Delimiter'>; 
</span>                <a href="pg_waldump.c.html#LN627"><span class='Ref_To_Local'>fpi_len</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN66"><span class='Ref_to_Member'>record_stats</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN586"><span class='Ref_To_Local'>ri</span></a><span class='Delimiter'>][</span><a href="pg_waldump.c.html#LN587"><span class='Ref_To_Local'>rj</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN57"><span class='Ref_to_Member'>fpi_len</span></a><span class='Delimiter'>; 
</span>                <a href="pg_waldump.c.html#LN628"><span class='Ref_To_Local'>tot_len</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN626"><span class='Ref_To_Local'>rec_len</span></a> <span class='Operator'>+ </span><a href="pg_waldump.c.html#LN627"><span class='Ref_To_Local'>fpi_len</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Skip undefined combinations and ones that didn't occur */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN625"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* the upper four bits in xl_info are the rmgr's */ 
</span>                <a href="pg_waldump.c.html#LN646"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN629"><span class='Ref_To_Local'>desc</span></a><span class='Operator'>-&GT;</span>rm_identify<span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN587"><span class='Ref_To_Local'>rj</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN646"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="pg_waldump.c.html#LN646"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"UNKNOWN (%x)"</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN587"><span class='Ref_To_Local'>rj</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pg_waldump.c.html#LN542"><span class='Ref_to_Func'>XLogDumpStatsRow</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s/%s"</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN629"><span class='Ref_To_Local'>desc</span></a><span class='Operator'>-&GT;</span><a href="rmgrdesc.h.html#LN14"><span class='Ref_to_Member'>rm_name</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN646"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="pg_waldump.c.html#LN625"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN588"><span class='Ref_To_Local'>total_count</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN626"><span class='Ref_To_Local'>rec_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN589"><span class='Ref_To_Local'>total_rec_len</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_waldump.c.html#LN627"><span class='Ref_To_Local'>fpi_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN590"><span class='Ref_To_Local'>total_fpi_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN628"><span class='Ref_To_Local'>tot_len</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN591"><span class='Ref_To_Local'>total_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for rj=0;rj&LT;MAX_XLINFO_TY... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ri=0;ri&LT;RM_NEXT_ID;ri... &raquo; </span> 
 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%-27s %20s %8s %20s %8s %20s %8s %20s\n"</span><span class='Delimiter'>, 
</span>           <span class='String'>""</span><span class='Delimiter'>, </span><span class='String'>"--------"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='String'>"--------"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='String'>"--------"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='String'>"--------"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The percentages in earlier rows were calculated against the column 
     * total, but the ones that follow are against the row total. Note that 
     * these are displayed with a % symbol to differentiate them from the 
     * earlier ones, and are thus up to 9 characters long. 
     */ 
</span> 
    <a href="pg_waldump.c.html#LN592"><span class='Ref_To_Local'>rec_len_pct</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN591"><span class='Ref_To_Local'>total_len</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN592"><span class='Ref_To_Local'>rec_len_pct</span></a> <span class='Operator'>= </span><span class='Number'>100</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN589"><span class='Ref_To_Local'>total_rec_len</span></a> <span class='Operator'>/ </span><a href="pg_waldump.c.html#LN591"><span class='Ref_To_Local'>total_len</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN593"><span class='Ref_To_Local'>fpi_len_pct</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN591"><span class='Ref_To_Local'>total_len</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN593"><span class='Ref_To_Local'>fpi_len_pct</span></a> <span class='Operator'>= </span><span class='Number'>100</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN590"><span class='Ref_To_Local'>total_fpi_len</span></a> <span class='Operator'>/ </span><a href="pg_waldump.c.html#LN591"><span class='Ref_To_Local'>total_len</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%-27s "</span> 
           <span class='String'>"%20"</span> INT64_MODIFIER <span class='String'>"u %-9s"</span> 
           <span class='String'>"%20"</span> INT64_MODIFIER <span class='String'>"u %-9s"</span> 
           <span class='String'>"%20"</span> INT64_MODIFIER <span class='String'>"u %-9s"</span> 
           <span class='String'>"%20"</span> INT64_MODIFIER <span class='String'>"u %-6s\n"</span><span class='Delimiter'>, 
</span>           <span class='String'>"Total"</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN584"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pg_waldump.c.html#LN64"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, 
</span>           <a href="pg_waldump.c.html#LN589"><span class='Ref_To_Local'>total_rec_len</span></a><span class='Delimiter'>, </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"[%.02f%%]"</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN592"><span class='Ref_To_Local'>rec_len_pct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="pg_waldump.c.html#LN590"><span class='Ref_To_Local'>total_fpi_len</span></a><span class='Delimiter'>, </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"[%.02f%%]"</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN593"><span class='Ref_To_Local'>fpi_len_pct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="pg_waldump.c.html#LN591"><span class='Ref_To_Local'>total_len</span></a><span class='Delimiter'>, </span><span class='String'>"[100%]"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end XLogDumpDisplayStats &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN699"></a><span class='Declare_Function'>usage</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"%s decodes and displays PostgreSQL write-ahead logs for debugging.\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Usage:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  %s [OPTION]... [STARTSEG [ENDSEG]]\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\nOptions:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -b, --bkp-details      output detailed information about backup blocks\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -e, --end=RECPTR       stop reading at WAL location RECPTR\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -f, --follow           keep retrying after reaching end of WAL\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -n, --limit=N          number of records to display\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -p, --path=PATH        directory in which to find log segment files or a\n"</span> 
             <span class='String'>"                         directory with a ./pg_wal that contains such files\n"</span> 
             <span class='String'>"                         (default: current directory, ./pg_wal, PGDATA/pg_wal)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -r, --rmgr=RMGR        only show records generated by resource manager RMGR\n"</span> 
             <span class='String'>"                         use --rmgr=list to list valid resource manager names\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -s, --start=RECPTR     start reading at WAL location RECPTR\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -t, --timeline=TLI     timeline from which to read log records\n"</span> 
    <span class='String'>"                         (default: 1 or the value used in STARTSEG)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -V, --version          output version information, then exit\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -x, --xid=XID          only show records with TransactionId XID\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -z, --stats[=record]   show statistics instead of records\n"</span> 
     <span class='String'>"                         (optionally, show per-record statistics)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  -?, --help             show this help, then exit\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end usage &raquo; </span> 
 
<span class='Keyword'>int 
</span><a name="LN726"></a><span class='Declare_Function'>main</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>argv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN728"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>xlogid</span><span class='Delimiter'>; 
</span><a name="LN729"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>xrecoff</span><span class='Delimiter'>; 
</span><a name="LN730"></a>    <a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlogreader_state</span><span class='Delimiter'>; 
</span><a name="LN731"></a>    <a href="pg_waldump.c.html#LN28"><span class='Ref_to_Struct'>XLogDumpPrivate</span></a> <span class='Declare_Local'>private</span><span class='Delimiter'>; 
</span><a name="LN732"></a>    <a href="pg_waldump.c.html#LN37"><span class='Ref_to_Struct'>XLogDumpConfig</span></a> <span class='Declare_Local'>config</span><span class='Delimiter'>; 
</span><a name="LN733"></a>    <a href="pg_waldump.c.html#LN62"><span class='Ref_to_Struct'>XLogDumpStats</span></a> <span class='Declare_Local'>stats</span><span class='Delimiter'>; 
</span><a name="LN734"></a>    <a href="../../include/access/xlogrecord.h.html#LN40"><span class='Ref_to_Struct'>XLogRecord</span></a> <span class='Operator'>*</span><span class='Declare_Local'>record</span><span class='Delimiter'>; 
</span><a name="LN735"></a>    <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>first_record</span><span class='Delimiter'>; 
</span><a name="LN736"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>errormsg</span><span class='Delimiter'>; 
</span> 
<a name="LN738"></a>    <span class='Keyword'>static </span><span class='Control'>struct</span> <a href="pg_waldump.c.html#LN754"><span class='Ref_To_Local'>option</span></a> <span class='Declare_Local'>long_options</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"bkp-details"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"end"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'e'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"follow"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'f'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"help"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'?'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"limit"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'n'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"path"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'p'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"rmgr"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'r'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"start"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'s'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"timeline"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'t'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"xid"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'x'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"version"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'V'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"stats"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN25"><span class='Ref_to_Const'>optional_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'z'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
<a name="LN754"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span><a name="LN755"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>optindex</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN93"><span class='Ref_to_Proto'>set_pglocale_pgservice</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="../../include/c.h.html#LN1009"><span class='Ref_to_Macro'>PG_TEXTDOMAIN</span></a><span class='Parentheses'>(</span><span class='String'>"pg_waldump"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN49"><span class='Ref_to_Proto'>get_progname</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>private</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN28"><span class='Ref_to_Struct'>XLogDumpPrivate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN37"><span class='Ref_to_Struct'>XLogDumpConfig</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN733"><span class='Ref_To_Local'>stats</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN62"><span class='Ref_to_Struct'>XLogDumpStats</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN30"><span class='Ref_to_Member'>timeline</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span>    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span>    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN34"><span class='Ref_to_Member'>endptr_reached</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN40"><span class='Ref_to_Member'>bkp_details</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN41"><span class='Ref_to_Member'>stop_after_records</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN42"><span class='Ref_to_Member'>already_displayed_records</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN43"><span class='Ref_to_Member'>follow</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN48"><span class='Ref_to_Member'>filter_by_rmgr</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN49"><span class='Ref_to_Member'>filter_by_xid</span></a> <span class='Operator'>= </span><a href="../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN50"><span class='Ref_to_Member'>filter_by_xid_enabled</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN44"><span class='Ref_to_Member'>stats</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN45"><span class='Ref_to_Member'>stats_per_record</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: no arguments specified\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_waldump.c.html#LN754"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>= </span><a href="../../include/getopt_long.h.html#LN30"><span class='Ref_to_Proto'>getopt_long</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>, </span><span class='String'>"be:?fn:p:r:s:t:Vx:z"</span><span class='Delimiter'>, 
</span>                                 <a href="pg_waldump.c.html#LN738"><span class='Ref_To_Local'>long_options</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN755"><span class='Ref_To_Local'>optindex</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN754"><span class='Ref_To_Local'>option</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>: 
</span>                <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN40"><span class='Ref_to_Member'>bkp_details</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'e'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>sscanf<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"%X/%X"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN728"><span class='Ref_To_Local'>xlogid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN729"><span class='Ref_To_Local'>xrecoff</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not parse end WAL location \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN728"><span class='Ref_To_Local'>xlogid</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>32</span> <span class='Operator'>| </span><a href="pg_waldump.c.html#LN729"><span class='Ref_To_Local'>xrecoff</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>: 
</span>                <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN43"><span class='Ref_to_Member'>follow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'?'</span><span class='Operator'>: 
</span>                <a href="../psql/help.h.html#LN10"><span class='Ref_to_Proto'>usage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><a href="../psql/settings.h.html#LN146"><span class='Ref_to_Const'>EXIT_SUCCESS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>sscanf<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN41"><span class='Ref_to_Member'>stop_after_records</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not parse limit \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>: 
</span>                <span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'r'</span><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN822"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"list"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="pg_waldump.c.html#LN90"><span class='Ref_to_Func'>print_rmgr_list</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><a href="../psql/settings.h.html#LN146"><span class='Ref_to_Const'>EXIT_SUCCESS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN822"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN822"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="../../include/access/rmgr.h.html#LN32"><span class='Ref_to_Const'>RM_MAX_ID</span></a><span class='Delimiter'>; </span><a href="pg_waldump.c.html#LN822"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="rmgrdesc.c.html#LN37"><span class='Ref_to_Global_Var'>RmgrDescTable</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN822"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rmgrdesc.h.html#LN14"><span class='Ref_to_Member'>rm_name</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN48"><span class='Ref_to_Member'>filter_by_rmgr</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN822"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN48"><span class='Ref_to_Member'>filter_by_rmgr</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: resource manager \"%s\" does not exist\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>sscanf<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"%X/%X"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN728"><span class='Ref_To_Local'>xlogid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN729"><span class='Ref_To_Local'>xrecoff</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not parse start WAL location \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN728"><span class='Ref_To_Local'>xlogid</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>32</span> <span class='Operator'>| </span><a href="pg_waldump.c.html#LN729"><span class='Ref_To_Local'>xrecoff</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>sscanf<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN30"><span class='Ref_to_Member'>timeline</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not parse timeline \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'V'</span><span class='Operator'>: 
</span>                puts<span class='Parentheses'>(</span><span class='String'>"pg_waldump (PostgreSQL) "</span> PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><a href="../psql/settings.h.html#LN146"><span class='Ref_to_Const'>EXIT_SUCCESS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'x'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>sscanf<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"%u"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN49"><span class='Ref_to_Member'>filter_by_xid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not parse \"%s\" as a valid xid\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN50"><span class='Ref_to_Member'>filter_by_xid_enabled</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'z'</span><span class='Operator'>: 
</span>                <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN44"><span class='Ref_to_Member'>stats</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN45"><span class='Ref_to_Member'>stats_per_record</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"record"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN45"><span class='Ref_to_Member'>stats_per_record</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"rmgr"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: unrecognized argument to --stats: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch option &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (option=getopt_long(a... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argc</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: too many command-line arguments (first is \"%s\")\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* validate path points to directory */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_waldump.c.html#LN105"><span class='Ref_to_Func'>verify_directory</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    _<span class='Parentheses'>(</span><span class='String'>"%s: path \"%s\" cannot be opened: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* parse files as start/end boundaries, extract path if not specified */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>&LT; </span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN921"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>directory</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN922"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN923"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>fd</span><span class='Delimiter'>; 
</span><a name="LN924"></a>        <a href="../../include/access/xlogdefs.h.html#LN33"><span class='Ref_to_Typedef'>XLogSegNo</span></a>   <span class='Declare_Local'>segno</span><span class='Delimiter'>; 
</span> 
        <a href="pg_waldump.c.html#LN122"><span class='Ref_to_Func'>split_path</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN921"><span class='Ref_To_Local'>directory</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN922"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="pg_waldump.c.html#LN921"><span class='Ref_To_Local'>directory</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN921"><span class='Ref_To_Local'>directory</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_waldump.c.html#LN105"><span class='Ref_to_Func'>verify_directory</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a><span class='Parentheses'>))</span> 
                <a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='String'>"cannot open directory \"%s\": %s"</span><span class='Delimiter'>, 
</span>                            <span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_waldump.c.html#LN923"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN157"><span class='Ref_to_Func'>fuzzy_open_file</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN922"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN923"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\""</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN922"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN923"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* parse position from file */ 
</span>        <a href="../../include/access/xlog_internal.h.html#LN164"><span class='Ref_to_Macro'>XLogFromFileName</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN922"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN30"><span class='Ref_to_Member'>timeline</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN924"><span class='Ref_To_Local'>segno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xlogdefs.h.html#LN28"><span class='Ref_to_Macro'>XLogRecPtrIsInvalid</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/access/xlog_internal.h.html#LN94"><span class='Ref_to_Macro'>XLogSegNoOffsetToRecPtr</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN924"><span class='Ref_To_Local'>segno</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xlog_internal.h.html#LN117"><span class='Ref_to_Macro'>XLByteInSeg</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN924"><span class='Ref_To_Local'>segno</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>               _<span class='Parentheses'>(</span><span class='String'>"%s: start WAL location %X/%X is not inside file \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a><span class='Delimiter'>, 
</span>                    <a href="pg_waldump.c.html#LN922"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* no second file specified, set end position */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argc</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../include/access/xlogdefs.h.html#LN28"><span class='Ref_to_Macro'>XLogRecPtrIsInvalid</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/access/xlog_internal.h.html#LN94"><span class='Ref_to_Macro'>XLogSegNoOffsetToRecPtr</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN924"><span class='Ref_To_Local'>segno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* parse ENDSEG if passed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN965"></a>            <a href="../../include/access/xlogdefs.h.html#LN33"><span class='Ref_to_Typedef'>XLogSegNo</span></a>   <span class='Declare_Local'>endsegno</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ignore directory, already have that */ 
</span>            <a href="pg_waldump.c.html#LN122"><span class='Ref_to_Func'>split_path</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN921"><span class='Ref_To_Local'>directory</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN922"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_waldump.c.html#LN923"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN157"><span class='Ref_to_Func'>fuzzy_open_file</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN31"><span class='Ref_to_Member'>inpath</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN922"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN923"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\""</span><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN922"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/win32.h.html#LN11"><span class='Ref_to_Macro'>close</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN923"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* parse position from file */ 
</span>            <a href="../../include/access/xlog_internal.h.html#LN164"><span class='Ref_to_Macro'>XLogFromFileName</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN922"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN30"><span class='Ref_to_Member'>timeline</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN965"><span class='Ref_To_Local'>endsegno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN965"><span class='Ref_To_Local'>endsegno</span></a> <span class='Operator'>&LT; </span><a href="pg_waldump.c.html#LN924"><span class='Ref_To_Local'>segno</span></a><span class='Parentheses'>) 
</span>                <a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='String'>"ENDSEG %s is before STARTSEG %s"</span><span class='Delimiter'>, 
</span>                            <a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xlogdefs.h.html#LN28"><span class='Ref_to_Macro'>XLogRecPtrIsInvalid</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/access/xlog_internal.h.html#LN94"><span class='Ref_to_Macro'>XLogSegNoOffsetToRecPtr</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN965"><span class='Ref_To_Local'>endsegno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* set segno to endsegno for check of --end */ 
</span>            <a href="pg_waldump.c.html#LN924"><span class='Ref_To_Local'>segno</span></a> <span class='Operator'>= </span><a href="pg_waldump.c.html#LN965"><span class='Ref_To_Local'>endsegno</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if optind+1&LT;argc &raquo; </span> 
 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xlog_internal.h.html#LN117"><span class='Ref_to_Macro'>XLByteInSeg</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN924"><span class='Ref_To_Local'>segno</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN924"><span class='Ref_To_Local'>segno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../include/access/xlog_internal.h.html#LN91"><span class='Ref_to_Const'>XLogSegSize</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                 _<span class='Parentheses'>(</span><span class='String'>"%s: end WAL location %X/%X is not inside file \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN33"><span class='Ref_to_Member'>endptr</span></a><span class='Delimiter'>, 
</span>                    <a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="pg_waldump.c.html#LN726"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if optind&LT;argc &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* we don't know what to print */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xlogdefs.h.html#LN28"><span class='Ref_to_Macro'>XLogRecPtrIsInvalid</span></a><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: no start WAL location given\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_waldump.c.html#LN1089"><span class='Ref_to_Label'>bad_argument</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* done with argument parsing, do the actual work */ 
</span> 
    <span class='Comment_Multi_Line'>/* we have everything we need, start reading */ 
</span>    <a href="pg_waldump.c.html#LN730"><span class='Ref_To_Local'>xlogreader_state</span></a> <span class='Operator'>= </span><a href="../../backend/access/transam/xlogreader.c.html#LN65"><span class='Ref_to_Func'>XLogReaderAllocate</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN338"><span class='Ref_to_Func'>XLogDumpReadPage</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>private</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_waldump.c.html#LN730"><span class='Ref_To_Local'>xlogreader_state</span></a><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* first find a valid recptr to start from */ 
</span>    <a href="pg_waldump.c.html#LN735"><span class='Ref_To_Local'>first_record</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN205"><span class='Ref_to_Proto'>XLogFindNextRecord</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN730"><span class='Ref_To_Local'>xlogreader_state</span></a><span class='Delimiter'>, </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN735"><span class='Ref_To_Local'>first_record</span></a> <span class='Operator'>== </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not find a valid record after %X/%X"</span><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Display a message that we're skipping data if `from` wasn't a pointer 
     * to the start of a record and also wasn't a pointer to the beginning of 
     * a segment (e.g. we were used in file mode). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN735"><span class='Ref_To_Local'>first_record</span></a> <span class='Operator'>!= </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a> <span class='Operator'>% </span><a href="../../include/access/xlog_internal.h.html#LN91"><span class='Ref_to_Const'>XLogSegSize</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"first record is after %X/%X, at %X/%X, skipping over %u bytes\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a><span class='Delimiter'>, 
</span>               <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_waldump.c.html#LN735"><span class='Ref_To_Local'>first_record</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN735"><span class='Ref_To_Local'>first_record</span></a><span class='Delimiter'>, 
</span>               <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_waldump.c.html#LN735"><span class='Ref_To_Local'>first_record</span></a> <span class='Operator'>- </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN32"><span class='Ref_to_Member'>startptr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* try to read the next record */ 
</span>        <a href="pg_waldump.c.html#LN734"><span class='Ref_To_Local'>record</span></a> <span class='Operator'>= </span><a href="../../backend/access/transam/xlogreader.c.html#LN191"><span class='Ref_to_Func'>XLogReadRecord</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN730"><span class='Ref_To_Local'>xlogreader_state</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN735"><span class='Ref_To_Local'>first_record</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN736"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_waldump.c.html#LN734"><span class='Ref_To_Local'>record</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN43"><span class='Ref_to_Member'>follow</span></a> <span class='Operator'>|| </span><span class='Keyword'>private</span><span class='Operator'>.</span><a href="pg_waldump.c.html#LN34"><span class='Ref_to_Member'>endptr_reached</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><span class='Number'>1000000L</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* 1 second */ 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* after reading the first record, continue at next one */ 
</span>        <a href="pg_waldump.c.html#LN735"><span class='Ref_To_Local'>first_record</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* apply all specified filters */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN48"><span class='Ref_to_Member'>filter_by_rmgr</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span> <span class='Operator'>&& 
</span>            <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN48"><span class='Ref_to_Member'>filter_by_rmgr</span></a> <span class='Operator'>!= </span><a href="pg_waldump.c.html#LN734"><span class='Ref_To_Local'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogrecord.h.html#LN46"><span class='Ref_to_Member'>xl_rmid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN50"><span class='Ref_to_Member'>filter_by_xid_enabled</span></a> <span class='Operator'>&& 
</span>            <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN49"><span class='Ref_to_Member'>filter_by_xid</span></a> <span class='Operator'>!= </span><a href="pg_waldump.c.html#LN734"><span class='Ref_To_Local'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogrecord.h.html#LN43"><span class='Ref_to_Member'>xl_xid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* process the record */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN44"><span class='Ref_to_Member'>stats</span></a> <span class='Operator'>== </span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>            <a href="pg_waldump.c.html#LN396"><span class='Ref_to_Func'>XLogDumpCountRecord</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN733"><span class='Ref_To_Local'>stats</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN730"><span class='Ref_To_Local'>xlogreader_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_waldump.c.html#LN434"><span class='Ref_to_Func'>XLogDumpDisplayRecord</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Delimiter'>, </span><a href="pg_waldump.c.html#LN730"><span class='Ref_To_Local'>xlogreader_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check whether we printed enough */ 
</span>        <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN42"><span class='Ref_to_Member'>already_displayed_records</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN41"><span class='Ref_to_Member'>stop_after_records</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN42"><span class='Ref_to_Member'>already_displayed_records</span></a> <span class='Operator'>&GT;= </span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN41"><span class='Ref_to_Member'>stop_after_records</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Operator'>.</span><a href="pg_waldump.c.html#LN44"><span class='Ref_to_Member'>stats</span></a> <span class='Operator'>== </span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN583"><span class='Ref_to_Func'>XLogDumpDisplayStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN732"><span class='Ref_To_Local'>config</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_waldump.c.html#LN733"><span class='Ref_To_Local'>stats</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN736"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>) 
</span>        <a href="pg_waldump.c.html#LN69"><span class='Ref_to_Func'>fatal_error</span></a><span class='Parentheses'>(</span><span class='String'>"error in WAL record at %X/%X: %s"</span><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="pg_waldump.c.html#LN730"><span class='Ref_To_Local'>xlogreader_state</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN113"><span class='Ref_to_Member'>ReadRecPtr</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_waldump.c.html#LN730"><span class='Ref_To_Local'>xlogreader_state</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN113"><span class='Ref_to_Member'>ReadRecPtr</span></a><span class='Delimiter'>, 
</span>                    <a href="pg_waldump.c.html#LN736"><span class='Ref_To_Local'>errormsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../backend/access/transam/xlogreader.c.html#LN123"><span class='Ref_to_Func'>XLogReaderFree</span></a><span class='Parentheses'>(</span><a href="pg_waldump.c.html#LN730"><span class='Ref_To_Local'>xlogreader_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../psql/settings.h.html#LN146"><span class='Ref_to_Const'>EXIT_SUCCESS</span></a><span class='Delimiter'>; 
</span> 
<a name="LN1089"></a><span class='Label'>bad_argument</span><span class='Operator'>: 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../psql/settings.h.html#LN150"><span class='Ref_to_Const'>EXIT_FAILURE</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end main &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>