<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\pgbench\pgbench.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\pgbench\pgbench.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:59 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/* 
 * pgbench.c 
 * 
 * A simple benchmark program for PostgreSQL 
 * Originally written by Tatsuo Ishii and enhanced by many contributors. 
 * 
 * src/bin/pgbench/pgbench.c 
 * Copyright (c) 2000-2017, PostgreSQL Global Development Group 
 * ALL RIGHTS RESERVED; 
 * 
 * Permission to use, copy, modify, and distribute this software and its 
 * documentation for any purpose, without fee, and without a written agreement 
 * is hereby granted, provided that the above copyright notice and this 
 * paragraph and the following two paragraphs appear in all copies. 
 * 
 * IN NO EVENT SHALL THE AUTHOR OR DISTRIBUTORS BE LIABLE TO ANY PARTY FOR 
 * DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING 
 * LOST PROFITS, ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS 
 * DOCUMENTATION, EVEN IF THE AUTHOR OR DISTRIBUTORS HAVE BEEN ADVISED OF THE 
 * POSSIBILITY OF SUCH DAMAGE. 
 * 
 * THE AUTHOR AND DISTRIBUTORS SPECIFICALLY DISCLAIMS ANY WARRANTIES, 
 * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE.  THE SOFTWARE PROVIDED HEREUNDER IS 
 * ON AN "AS IS" BASIS, AND THE AUTHOR AND DISTRIBUTORS HAS NO OBLIGATIONS TO 
 * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS. 
 * 
 */ 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN30"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>FD_SETSIZE</span> <span class='Number'>1024</span>         <span class='Comment_Single_Line'>/* set before winsock2.h is included */ 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* ! WIN32 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"getopt_long.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq-fe.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"portability/instr_time.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;float.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;signal.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;time.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/time.h&GT;</span> 
<span class='Directive'>#ifdef</span> HAVE_SYS_SELECT_H 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/select.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifdef</span> HAVE_SYS_RESOURCE_H 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/resource.h&GT;</span>       <span class='Comment_Single_Line'>/* for getrlimit */ 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifndef</span> <a href="../../../contrib/earthdistance/earthdistance.c.html#LN9"><span class='Ref_to_Const'>M_PI</span></a> 
<a name="LN55"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>M_PI</span> <span class='Number'>3</span><span class='Operator'>.</span><span class='Number'>14159265358979323846</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"pgbench.h"</span> 
 
<a name="LN60"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ERRCODE_UNDEFINED_TABLE</span>  <span class='String'>"42P01"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Multi-platform pthread implementations 
 */ 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Comment_Multi_Line'>/* Use native win32 threads on Windows */ 
</span><a name="LN68"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <a href="pgbench.c.html#LN4763"><span class='Ref_to_Struct'>win32_pthread</span></a> <span class='Operator'>*</span><span class='Declare_Typedef'>pthread_t</span><span class='Delimiter'>; 
</span><a name="LN69"></a><span class='Control'>typedef</span> <span class='Keyword'>int </span><span class='Declare_Typedef'>pthread_attr_t</span><span class='Delimiter'>; 
</span> 
<a name="LN71"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>pthread_create</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN68"><span class='Ref_to_Typedef'>pthread_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN69"><span class='Ref_to_Typedef'>pthread_attr_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attr</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>*</span>start_routine<span class='Parentheses'>) (</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>pthread_join</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN68"><span class='Ref_to_Typedef'>pthread_t</span></a> <span class='Declare_Parameter'>th</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>thread_return</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#elif</span> defined<span class='Parentheses'>(</span>ENABLE_THREAD_SAFETY<span class='Parentheses'>) 
</span><span class='Comment_Multi_Line'>/* Use platform-dependent pthread capability */ 
</span><span class='Keyword'>#include </span><span class='String'>&LT;pthread.h&GT;</span> 
<span class='Directive'>#else</span> 
<span class='Comment_Multi_Line'>/* No threads implementation, use none (-j 1) */ 
</span><a name="LN78"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>pthread_t</span> <span class='Keyword'>void </span><span class='Operator'>* 
</span><span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/******************************************************************** 
 * some configurable parameters */ 
</span> 
<span class='Comment_Multi_Line'>/* max number of clients allowed */ 
</span><span class='Directive'>#ifdef</span> <a href="pgbench.c.html#LN30"><span class='Ref_to_Const'>FD_SETSIZE</span></a> 
<a name="LN87"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAXCLIENTS</span>  <span class='Parentheses'>(</span><a href="pgbench.c.html#LN30"><span class='Ref_to_Const'>FD_SETSIZE</span></a> <span class='Operator'>- </span><span class='Number'>10</span><span class='Parentheses'>) 
</span><span class='Directive'>#else</span> 
<a name="LN89"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAXCLIENTS</span>  <span class='Number'>1024</span> 
<span class='Directive'>#endif</span> 
 
<a name="LN92"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LOG_STEP_SECONDS</span>    <span class='Number'>5</span>   <span class='Comment_Single_Line'>/* seconds between log messages */ 
</span><a name="LN93"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEFAULT_NXACTS</span>  <span class='Number'>10</span>      <span class='Comment_Single_Line'>/* default nxacts */ 
</span> 
<a name="LN95"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MIN_GAUSSIAN_PARAM</span>      <span class='Number'>2</span><span class='Operator'>.</span><span class='Number'>0</span>     <span class='Comment_Single_Line'>/* minimum parameter for gauss */ 
</span> 
<a name="LN97"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>nxacts</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* number of transactions per client */ 
</span><a name="LN98"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>duration</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* duration in seconds */ 
</span><a name="LN99"></a><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Var'>end_time</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* when to stop in micro seconds, under -T */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * scaling factor. for example, scale = 10 will make 1000000 tuples in 
 * pgbench_accounts table. 
 */ 
</span><a name="LN105"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>scale</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * fillfactor. for example, fillfactor = 90 will use only 90 percent 
 * space during inserts and leave 10 percent free. 
 */ 
</span><a name="LN111"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>fillfactor</span> <span class='Operator'>= </span><span class='Number'>100</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * create foreign key constraints on the tables? 
 */ 
</span><a name="LN116"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>foreign_keys</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * use unlogged tables? 
 */ 
</span><a name="LN121"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>unlogged_tables</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * log sampling rate (1.0 = log everything, 0.0 = option not given) 
 */ 
</span><a name="LN126"></a><span class='Keyword'>double</span>      <span class='Declare_Var'>sample_rate</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * When threads are throttled to a given rate limit, this is the target delay 
 * to reach that rate in usec.  0 is the default and means no throttling. 
 */ 
</span><a name="LN132"></a><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Var'>throttle_delay</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Transactions which take longer than this limit (in usec) are counted as 
 * late, and reported as such, although they are completed anyway. When 
 * throttling is enabled, execution time slots that are more than this late 
 * are skipped altogether, and counted separately. 
 */ 
</span><a name="LN140"></a><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Var'>latency_limit</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * tablespace selection 
 */ 
</span><a name="LN145"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>tablespace</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN146"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>index_tablespace</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * end of configurable parameters 
 *********************************************************************/ 
</span> 
<a name="LN152"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>nbranches</span>   <span class='Number'>1</span>           <span class='Comment_Multi_Line'>/* Makes little sense to change this.  Change 
                                 * -s instead */ 
</span><a name="LN154"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ntellers</span>    <span class='Number'>10</span> 
<a name="LN155"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>naccounts</span>   <span class='Number'>100000</span> 
 
<span class='Comment_Multi_Line'>/* 
 * The scale factor at/beyond which 32bit integers are incapable of storing 
 * 64bit values. 
 * 
 * Although the actual threshold is 21474, we use 20000 because it is easier to 
 * document and remember, and isn't that far away from the real threshold. 
 */ 
</span><a name="LN164"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>SCALE_32BIT_THRESHOLD</span> <span class='Number'>20000</span> 
 
<a name="LN166"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>use_log</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* log transaction latencies to a file */ 
</span><a name="LN167"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>use_quiet</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* quiet logging onto stderr */ 
</span><a name="LN168"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>agg_interval</span><span class='Delimiter'>;</span>       <span class='Comment_Multi_Line'>/* log aggregates instead of individual 
                                 * transactions */ 
</span><a name="LN170"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>per_script_stats</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* whether to collect stats per script */ 
</span><a name="LN171"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>progress</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* thread progress report every this seconds */ 
</span><a name="LN172"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>progress_timestamp</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* progress report with Unix time */ 
</span><a name="LN173"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>nclients</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* number of clients */ 
</span><a name="LN174"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>nthreads</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* number of threads */ 
</span><a name="LN175"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>is_connect</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* establish connection for each transaction */ 
</span><a name="LN176"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>is_latencies</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* report per-command latencies */ 
</span><a name="LN177"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>main_pid</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* main process id used in log filename */ 
</span> 
<a name="LN179"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>pghost</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN180"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>pgport</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN181"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>login</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN182"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>dbName</span><span class='Delimiter'>; 
</span><a name="LN183"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>logfile_prefix</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN184"></a><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Var'>progname</span><span class='Delimiter'>; 
</span> 
<a name="LN186"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>WSEP</span> <span class='String'>'@'</span>                <span class='Comment_Single_Line'>/* weight separator */ 
</span> 
<a name="LN188"></a><span class='Keyword'>volatile bool </span><span class='Declare_Var'>timer_exceeded</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* flag from signal handler */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Variable definitions.  If a variable has a string value, "value" is that 
 * value, is_numeric is false, and num_value is undefined.  If the value is 
 * known to be numeric, is_numeric is true and num_value contains the value 
 * (in any permitted numeric variant).  In this case "value" contains the 
 * string equivalent of the number, if we've had occasion to compute that, 
 * or NULL if we haven't. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN200"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>name</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* variable's name */ 
</span><a name="LN201"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>value</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* its value in string form, if known */ 
</span><a name="LN202"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>is_numeric</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* is numeric value known? */ 
</span><a name="LN203"></a>    <a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Declare_Member'>num_value</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* variable's value in numeric form */ 
</span><a name="LN204"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>Variable</span><span class='Delimiter'>; 
</span> 
<a name="LN206"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_SCRIPTS</span>     <span class='Number'>128</span>     <span class='Comment_Single_Line'>/* max number of SQL scripts allowed */ 
</span><a name="LN207"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>SHELL_COMMAND_SIZE</span>  <span class='Number'>256</span> <span class='Comment_Single_Line'>/* maximum size allowed for shell command */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Simple data structure to keep stats about something. 
 * 
 * XXX probably the first value should be kept and used as an offset for 
 * better numerical stability... 
 */ 
</span><a name="LN215"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>SimpleStats</span> 
<span class='Delimiter'>{ 
</span><a name="LN217"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>count</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* how many values were encountered */ 
</span><a name="LN218"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>min</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* the minimum seen */ 
</span><a name="LN219"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>max</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* the maximum seen */ 
</span><a name="LN220"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>sum</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* sum of values */ 
</span><a name="LN221"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>sum2</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* sum of squared values */ 
</span><a name="LN222"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>SimpleStats</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Data structure to hold various statistics: per-thread and per-script stats 
 * are maintained and merged together. 
 */ 
</span><a name="LN228"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>StatsData</span> 
<span class='Delimiter'>{ 
</span><a name="LN230"></a>    time_t      <span class='Declare_Member'>start_time</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* interval start time, for aggregates */ 
</span><a name="LN231"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>cnt</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* number of transactions */ 
</span><a name="LN232"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>skipped</span><span class='Delimiter'>;</span>        <span class='Comment_Multi_Line'>/* number of transactions skipped under --rate 
                                 * and --latency-limit */ 
</span><a name="LN234"></a>    <a href="pgbench.c.html#LN215"><span class='Ref_to_Struct'>SimpleStats</span></a> <span class='Declare_Member'>latency</span><span class='Delimiter'>; 
</span><a name="LN235"></a>    <a href="pgbench.c.html#LN215"><span class='Ref_to_Struct'>SimpleStats</span></a> <span class='Declare_Member'>lag</span><span class='Delimiter'>; 
</span><a name="LN236"></a>} <span class='Declare_Typedef'>StatsData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Connection state machine states. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * The client must first choose a script to execute.  Once chosen, it can 
     * either be throttled (state CSTATE_START_THROTTLE under --rate) or start 
     * right away (state CSTATE_START_TX). 
     */ 
</span><a name="LN248"></a>    <span class='Declare_Enum_Const'>CSTATE_CHOOSE_SCRIPT</span><span class='Delimiter'>, 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In CSTATE_START_THROTTLE state, we calculate when to begin the next 
     * transaction, and advance to CSTATE_THROTTLE.  CSTATE_THROTTLE state 
     * sleeps until that moment.  (If throttling is not enabled, doCustom() 
     * falls directly through from CSTATE_START_THROTTLE to CSTATE_START_TX.) 
     */ 
</span><a name="LN256"></a>    <span class='Declare_Enum_Const'>CSTATE_START_THROTTLE</span><span class='Delimiter'>, 
</span><a name="LN257"></a>    <span class='Declare_Enum_Const'>CSTATE_THROTTLE</span><span class='Delimiter'>, 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * CSTATE_START_TX performs start-of-transaction processing.  Establishes 
     * a new connection for the transaction, in --connect mode, and records 
     * the transaction start time. 
     */ 
</span><a name="LN264"></a>    <span class='Declare_Enum_Const'>CSTATE_START_TX</span><span class='Delimiter'>, 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We loop through these states, to process each command in the script: 
     * 
     * CSTATE_START_COMMAND starts the execution of a command.  On a SQL 
     * command, the command is sent to the server, and we move to 
     * CSTATE_WAIT_RESULT state.  On a \sleep meta-command, the timer is set, 
     * and we enter the CSTATE_SLEEP state to wait for it to expire. Other 
     * meta-commands are executed immediately. 
     * 
     * CSTATE_WAIT_RESULT waits until we get a result set back from the server 
     * for the current command. 
     * 
     * CSTATE_SLEEP waits until the end of \sleep. 
     * 
     * CSTATE_END_COMMAND records the end-of-command timestamp, increments the 
     * command counter, and loops back to CSTATE_START_COMMAND state. 
     */ 
</span><a name="LN283"></a>    <span class='Declare_Enum_Const'>CSTATE_START_COMMAND</span><span class='Delimiter'>, 
</span><a name="LN284"></a>    <span class='Declare_Enum_Const'>CSTATE_WAIT_RESULT</span><span class='Delimiter'>, 
</span><a name="LN285"></a>    <span class='Declare_Enum_Const'>CSTATE_SLEEP</span><span class='Delimiter'>, 
</span><a name="LN286"></a>    <span class='Declare_Enum_Const'>CSTATE_END_COMMAND</span><span class='Delimiter'>, 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * CSTATE_END_TX performs end-of-transaction processing.  Calculates 
     * latency, and logs the transaction.  In --connect mode, closes the 
     * current connection.  Chooses the next script to execute and starts over 
     * in CSTATE_START_THROTTLE state, or enters CSTATE_FINISHED if we have no 
     * more work to do. 
     */ 
</span><a name="LN295"></a>    <span class='Declare_Enum_Const'>CSTATE_END_TX</span><span class='Delimiter'>, 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Final states.  CSTATE_ABORTED means that the script execution was 
     * aborted because a command failed, CSTATE_FINISHED means success. 
     */ 
</span><a name="LN301"></a>    <span class='Declare_Enum_Const'>CSTATE_ABORTED</span><span class='Delimiter'>, 
</span><a name="LN302"></a>    <span class='Declare_Enum_Const'>CSTATE_FINISHED</span> 
<a name="LN303"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ConnectionStateEnum</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Connection state. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN310"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Member'>con</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* connection handle to DB */ 
</span><a name="LN311"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>id</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* client No. */ 
</span><a name="LN312"></a>    <a href="pgbench.c.html#LN241"><span class='Ref_to_Typedef'>ConnectionStateEnum</span></a> <span class='Declare_Member'>state</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* state machine's current state. */ 
</span> 
<a name="LN314"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>use_file</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* index in sql_script for this client */ 
</span><a name="LN315"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>command</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* command number in script */ 
</span> 
    <span class='Comment_Multi_Line'>/* client variables */ 
</span><a name="LN318"></a>    <a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>variables</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* array of variable definitions */ 
</span><a name="LN319"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nvariables</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* number of variables */ 
</span><a name="LN320"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>vars_sorted</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* are variables sorted by name? */ 
</span> 
    <span class='Comment_Multi_Line'>/* various times about current transaction */ 
</span><a name="LN323"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>txn_scheduled</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* scheduled start time of transaction (usec) */ 
</span><a name="LN324"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>sleep_until</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* scheduled start time of next cmd (usec) */ 
</span><a name="LN325"></a>    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Member'>txn_begin</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* used for measuring schedule lag times */ 
</span><a name="LN326"></a>    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Member'>stmt_begin</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* used for measuring statement latencies */ 
</span> 
<a name="LN328"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>prepared</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN206"><span class='Ref_to_Const'>MAX_SCRIPTS</span></a><span class='Delimiter'>];</span>  <span class='Comment_Single_Line'>/* whether client prepared the script */ 
</span> 
    <span class='Comment_Multi_Line'>/* per client collected stats */ 
</span><a name="LN331"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>cnt</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* transaction count */ 
</span><a name="LN332"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>ecnt</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* error count */ 
</span><a name="LN333"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end {anonCState} &raquo; </span> <span class='Declare_Typedef'>CState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Thread state 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN340"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>tid</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* thread id */ 
</span><a name="LN341"></a>    <a href="pgbench.c.html#LN68"><span class='Ref_to_Typedef'>pthread_t</span></a>   <span class='Declare_Member'>thread</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* thread handle */ 
</span><a name="LN342"></a>    <a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a>     <span class='Operator'>*</span><span class='Declare_Member'>state</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* array of CState */ 
</span><a name="LN343"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nstate</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* length of state[] */ 
</span><a name="LN344"></a>    <span class='Keyword'>unsigned short </span><span class='Declare_Member'>random_state</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>];</span>     <span class='Comment_Single_Line'>/* separate randomness for each thread */ 
</span><a name="LN345"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>throttle_trigger</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* previous/next throttling (us) */ 
</span><a name="LN346"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Member'>logfile</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* where to log, or NULL */ 
</span> 
    <span class='Comment_Multi_Line'>/* per thread collected stats */ 
</span><a name="LN349"></a>    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Member'>start_time</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* thread start time */ 
</span><a name="LN350"></a>    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Member'>conn_time</span><span class='Delimiter'>; 
</span><a name="LN351"></a>    <a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a>   <span class='Declare_Member'>stats</span><span class='Delimiter'>; 
</span><a name="LN352"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>latency_late</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* executed but late transactions */ 
</span><a name="LN353"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>TState</span><span class='Delimiter'>; 
</span> 
<a name="LN355"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>INVALID_THREAD</span>      <span class='Parentheses'>((</span><a href="pgbench.c.html#LN68"><span class='Ref_to_Typedef'>pthread_t</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * queries read from files 
 */ 
</span><a name="LN360"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>SQL_COMMAND</span>     <span class='Number'>1</span> 
<a name="LN361"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>META_COMMAND</span>    <span class='Number'>2</span> 
<a name="LN362"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_ARGS</span>        <span class='Number'>10</span> 
 
<a name="LN364"></a><span class='Control'>typedef</span> <span class='Control'>enum</span> <span class='Declare_Enum'>QueryMode</span> 
<span class='Delimiter'>{ 
</span><a name="LN366"></a>    <span class='Declare_Enum_Const'>QUERY_SIMPLE</span><span class='Delimiter'>,</span>               <span class='Comment_Single_Line'>/* simple query */ 
</span><a name="LN367"></a>    <span class='Declare_Enum_Const'>QUERY_EXTENDED</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* extended query */ 
</span><a name="LN368"></a>    <span class='Declare_Enum_Const'>QUERY_PREPARED</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* extended query with prepared statements */ 
</span><a name="LN369"></a>    <span class='Declare_Enum_Const'>NUM_QUERYMODE</span> 
<a name="LN370"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>QueryMode</span><span class='Delimiter'>; 
</span> 
<a name="LN372"></a><span class='Keyword'>static </span><a href="pgbench.c.html#LN364"><span class='Ref_to_Enum'>QueryMode</span></a> <span class='Declare_Var'>querymode</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN366"><span class='Ref_to_EnumConst'>QUERY_SIMPLE</span></a><span class='Delimiter'>; 
</span><a name="LN373"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>QUERYMODE</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='String'>"simple"</span><span class='Delimiter'>, </span><span class='String'>"extended"</span><span class='Delimiter'>, </span><span class='String'>"prepared"</span><span class='Delimiter'>}; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN377"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>line</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* text of command line */ 
</span><a name="LN378"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>command_num</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* unique index of this Command struct */ 
</span><a name="LN379"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>type</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* command type (SQL_COMMAND or META_COMMAND) */ 
</span><a name="LN380"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>argc</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* number of command words */ 
</span><a name="LN381"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>argv</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN362"><span class='Ref_to_Const'>MAX_ARGS</span></a><span class='Delimiter'>]; </span><span class='Comment_Single_Line'>/* command word list */ 
</span><a name="LN382"></a>    <a href="pgbench.h.html#LN84"><span class='Ref_to_Struct'>PgBenchExpr</span></a> <span class='Operator'>*</span><span class='Declare_Member'>expr</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* parsed expression, if needed */ 
</span><a name="LN383"></a>    <a href="pgbench.c.html#LN215"><span class='Ref_to_Struct'>SimpleStats</span></a> <span class='Declare_Member'>stats</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* time spent in this command */ 
</span><a name="LN384"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>Command</span><span class='Delimiter'>; 
</span> 
<a name="LN386"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ParsedScript</span> 
<span class='Delimiter'>{ 
</span><a name="LN388"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>desc</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* script descriptor (eg, file name) */ 
</span><a name="LN389"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>weight</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* selection weight */ 
</span><a name="LN390"></a>    <a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a>   <span class='Operator'>**</span><span class='Declare_Member'>commands</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* NULL-terminated array of Commands */ 
</span><a name="LN391"></a>    <a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a>   <span class='Declare_Member'>stats</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* total time spent in script */ 
</span><a name="LN392"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ParsedScript</span><span class='Delimiter'>; 
</span> 
<a name="LN394"></a><span class='Keyword'>static </span><a href="pgbench.c.html#LN386"><span class='Ref_to_Struct'>ParsedScript</span></a> <span class='Declare_Var'>sql_script</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN206"><span class='Ref_to_Const'>MAX_SCRIPTS</span></a><span class='Delimiter'>];</span>    <span class='Comment_Single_Line'>/* SQL script files */ 
</span><a name="LN395"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>num_scripts</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* number of scripts in sql_script[] */ 
</span><a name="LN396"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>num_commands</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* total number of Command structs */ 
</span><a name="LN397"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Var'>total_weight</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<a name="LN399"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>debug</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* debug flag */ 
</span> 
<span class='Comment_Multi_Line'>/* Builtin test scripts */ 
</span><a name="LN402"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>BuiltinScript</span> 
<span class='Delimiter'>{ 
</span><a name="LN404"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>name</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* very short name for -b ... */ 
</span><a name="LN405"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>desc</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* short description */ 
</span><a name="LN406"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>script</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* actual pgbench script */ 
</span><a name="LN407"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>BuiltinScript</span><span class='Delimiter'>; 
</span> 
<a name="LN409"></a><span class='Keyword'>static const </span><a href="pgbench.c.html#LN402"><span class='Ref_to_Struct'>BuiltinScript</span></a> <span class='Declare_Var'>builtin_script</span><span class='Delimiter'>[] </span><span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"tpcb-like"</span><span class='Delimiter'>, 
</span>        <span class='String'>"&LT;builtin: TPC-B (sort of)&GT;"</span><span class='Delimiter'>, 
</span>        <span class='String'>"\\set aid random(1, "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a><span class='Parentheses'>) </span><span class='String'>" * :scale)\n"</span> 
        <span class='String'>"\\set bid random(1, "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN152"><span class='Ref_to_Const'>nbranches</span></a><span class='Parentheses'>) </span><span class='String'>" * :scale)\n"</span> 
        <span class='String'>"\\set tid random(1, "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN154"><span class='Ref_to_Const'>ntellers</span></a><span class='Parentheses'>) </span><span class='String'>" * :scale)\n"</span> 
        <span class='String'>"\\set delta random(-5000, 5000)\n"</span> 
        <span class='String'>"BEGIN;\n"</span> 
        <span class='String'>"UPDATE pgbench_accounts SET abalance = abalance + :delta WHERE aid = :aid;\n"</span> 
        <span class='String'>"SELECT abalance FROM pgbench_accounts WHERE aid = :aid;\n"</span> 
        <span class='String'>"UPDATE pgbench_tellers SET tbalance = tbalance + :delta WHERE tid = :tid;\n"</span> 
        <span class='String'>"UPDATE pgbench_branches SET bbalance = bbalance + :delta WHERE bid = :bid;\n"</span> 
        <span class='String'>"INSERT INTO pgbench_history (tid, bid, aid, delta, mtime) VALUES (:tid, :bid, :aid, :delta, CURRENT_TIMESTAMP);\n"</span> 
        <span class='String'>"END;\n"</span> 
    <span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"simple-update"</span><span class='Delimiter'>, 
</span>        <span class='String'>"&LT;builtin: simple update&GT;"</span><span class='Delimiter'>, 
</span>        <span class='String'>"\\set aid random(1, "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a><span class='Parentheses'>) </span><span class='String'>" * :scale)\n"</span> 
        <span class='String'>"\\set bid random(1, "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN152"><span class='Ref_to_Const'>nbranches</span></a><span class='Parentheses'>) </span><span class='String'>" * :scale)\n"</span> 
        <span class='String'>"\\set tid random(1, "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN154"><span class='Ref_to_Const'>ntellers</span></a><span class='Parentheses'>) </span><span class='String'>" * :scale)\n"</span> 
        <span class='String'>"\\set delta random(-5000, 5000)\n"</span> 
        <span class='String'>"BEGIN;\n"</span> 
        <span class='String'>"UPDATE pgbench_accounts SET abalance = abalance + :delta WHERE aid = :aid;\n"</span> 
        <span class='String'>"SELECT abalance FROM pgbench_accounts WHERE aid = :aid;\n"</span> 
        <span class='String'>"INSERT INTO pgbench_history (tid, bid, aid, delta, mtime) VALUES (:tid, :bid, :aid, :delta, CURRENT_TIMESTAMP);\n"</span> 
        <span class='String'>"END;\n"</span> 
    <span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"select-only"</span><span class='Delimiter'>, 
</span>        <span class='String'>"&LT;builtin: select only&GT;"</span><span class='Delimiter'>, 
</span>        <span class='String'>"\\set aid random(1, "</span> <a href="../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a><span class='Parentheses'>) </span><span class='String'>" * :scale)\n"</span> 
        <span class='String'>"SELECT abalance FROM pgbench_accounts WHERE aid = :aid;\n"</span> 
    <span class='Delimiter'>} 
}; 
</span> 
 
<span class='Comment_Multi_Line'>/* Function prototypes */ 
</span><a name="LN449"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setIntValue</span><span class='Parentheses'>(</span><a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pv</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>ival</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN450"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setDoubleValue</span><span class='Parentheses'>(</span><a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pv</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>dval</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN451"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>evaluateExpr</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>TState</span> <span class='Operator'>*</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>CState</span> <span class='Operator'>*</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>PgBenchExpr</span> <span class='Operator'>*</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>PgBenchValue</span> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN452"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>doLog</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, 
</span><a name="LN453"></a>      <a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>agg</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>skipped</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>latency</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>lag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN454"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>processXactStats</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>now</span><span class='Delimiter'>, 
</span><a name="LN455"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>skipped</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>agg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN456"></a><span class='Keyword'>static void </span><a href="pgbench.c.html#LN2895"><span class='Ref_to_Func'>pgbench_error</span></a><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span>fmt<span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) </span><span class='Declare_Var'>pg_attribute_printf</span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN457"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>addScript</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN386"><span class='Ref_to_Struct'>ParsedScript</span></a> <span class='Declare_Parameter'>script</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN458"></a><span class='Keyword'>static void </span><span class='Operator'>*</span><span class='Declare_Prototype'>threadRun</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN459"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setalarm</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>seconds</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* callback functions for our flex lexer */ 
</span><a name="LN463"></a><span class='Keyword'>static const </span><a href="../../include/fe_utils/psqlscan.h.html#LN60"><span class='Ref_to_Struct'>PsqlScanCallbacks</span></a> <span class='Declare_Var'>pgbench_callbacks</span> <span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>                       <span class='Comment_Single_Line'>/* don't need get_variable functionality */ 
</span>    <a href="pgbench.c.html#LN2895"><span class='Ref_to_Func'>pgbench_error</span></a> 
<span class='Delimiter'>}; 
</span> 
 
<span class='Keyword'>static void 
</span><a name="LN470"></a><span class='Declare_Function'>usage</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%s is a benchmarking tool for PostgreSQL.\n\n"</span> 
           <span class='String'>"Usage:\n"</span> 
           <span class='String'>"  %s [OPTION]... [DBNAME]\n"</span> 
           <span class='String'>"\nInitialization options:\n"</span> 
           <span class='String'>"  -i, --initialize         invokes initialization mode\n"</span> 
           <span class='String'>"  -F, --fillfactor=NUM     set fill factor\n"</span> 
        <span class='String'>"  -n, --no-vacuum          do not run VACUUM after initialization\n"</span> 
    <span class='String'>"  -q, --quiet              quiet logging (one message each 5 seconds)\n"</span> 
           <span class='String'>"  -s, --scale=NUM          scaling factor\n"</span> 
           <span class='String'>"  --foreign-keys           create foreign key constraints between tables\n"</span> 
           <span class='String'>"  --index-tablespace=TABLESPACE\n"</span> 
    <span class='String'>"                           create indexes in the specified tablespace\n"</span> 
     <span class='String'>"  --tablespace=TABLESPACE  create tables in the specified tablespace\n"</span> 
           <span class='String'>"  --unlogged-tables        create tables as unlogged tables\n"</span> 
           <span class='String'>"\nOptions to select what to run:\n"</span> 
           <span class='String'>"  -b, --builtin=NAME[@W]   add builtin script NAME weighted at W (default: 1)\n"</span> 
    <span class='String'>"                           (use \"-b list\" to list available scripts)\n"</span> 
           <span class='String'>"  -f, --file=FILENAME[@W]  add script FILENAME weighted at W (default: 1)\n"</span> 
           <span class='String'>"  -N, --skip-some-updates  skip updates of pgbench_tellers and pgbench_branches\n"</span> 
           <span class='String'>"                           (same as \"-b simple-update\")\n"</span> 
           <span class='String'>"  -S, --select-only        perform SELECT-only transactions\n"</span> 
           <span class='String'>"                           (same as \"-b select-only\")\n"</span> 
           <span class='String'>"\nBenchmarking options:\n"</span> 
           <span class='String'>"  -c, --client=NUM         number of concurrent database clients (default: 1)\n"</span> 
           <span class='String'>"  -C, --connect            establish new connection for each transaction\n"</span> 
           <span class='String'>"  -D, --define=VARNAME=VALUE\n"</span> 
      <span class='String'>"                           define variable for use by custom script\n"</span> 
           <span class='String'>"  -j, --jobs=NUM           number of threads (default: 1)\n"</span> 
           <span class='String'>"  -l, --log                write transaction times to log file\n"</span> 
           <span class='String'>"  -L, --latency-limit=NUM  count transactions lasting more than NUM ms as late\n"</span> 
           <span class='String'>"  -M, --protocol=simple|extended|prepared\n"</span> 
           <span class='String'>"                           protocol for submitting queries (default: simple)\n"</span> 
           <span class='String'>"  -n, --no-vacuum          do not run VACUUM before tests\n"</span> 
           <span class='String'>"  -P, --progress=NUM       show thread progress report every NUM seconds\n"</span> 
           <span class='String'>"  -r, --report-latencies   report average latency per command\n"</span> 
        <span class='String'>"  -R, --rate=NUM           target rate in transactions per second\n"</span> 
           <span class='String'>"  -s, --scale=NUM          report this scale factor in output\n"</span> 
           <span class='String'>"  -t, --transactions=NUM   number of transactions each client runs (default: 10)\n"</span> 
         <span class='String'>"  -T, --time=NUM           duration of benchmark test in seconds\n"</span> 
           <span class='String'>"  -v, --vacuum-all         vacuum all four standard tables before tests\n"</span> 
           <span class='String'>"  --aggregate-interval=NUM aggregate data over NUM seconds\n"</span> 
           <span class='String'>"  --log-prefix=PREFIX      prefix for transaction time log file\n"</span> 
           <span class='String'>"                           (default: \"pgbench_log\")\n"</span> 
        <span class='String'>"  --progress-timestamp     use Unix epoch timestamps for progress\n"</span> 
           <span class='String'>"  --sampling-rate=NUM      fraction of transactions to log (e.g., 0.01 for 1%%)\n"</span> 
           <span class='String'>"\nCommon options:\n"</span> 
           <span class='String'>"  -d, --debug              print debugging output\n"</span> 
      <span class='String'>"  -h, --host=HOSTNAME      database server host or socket directory\n"</span> 
           <span class='String'>"  -p, --port=PORT          database server port number\n"</span> 
           <span class='String'>"  -U, --username=USERNAME  connect as specified database user\n"</span> 
         <span class='String'>"  -V, --version            output version information, then exit\n"</span> 
           <span class='String'>"  -?, --help               show this help, then exit\n"</span> 
           <span class='String'>"\n"</span> 
           <span class='String'>"Report bugs to &LT;pgsql-bugs@postgresql.org&GT;.\n"</span><span class='Delimiter'>, 
</span>           <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end usage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* return whether str matches "^\s*[-+]?[0-9]+$" */ 
</span><span class='Keyword'>static bool 
</span><a name="LN531"></a><span class='Declare_Function'>is_an_int</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN533"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN531"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* skip leading spaces; cast is consistent with strtoint64 */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span> 
        <a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* skip sign */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>== </span><span class='String'>'+'</span> <span class='Operator'>|| *</span><a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* at least one digit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&& !</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* eat all digits */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&& </span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span> 
        <a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* must have reached end of string */ 
</span>    <span class='Control'>return</span> <span class='Operator'>*</span><a href="pgbench.c.html#LN533"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end is_an_int &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * strtoint64 -- convert a string to 64-bit integer 
 * 
 * This function is a modified version of scanint8() from 
 * src/backend/utils/adt/int8.c. 
 */ 
</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN563"></a><span class='Declare_Function'>strtoint64</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN565"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN563"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span><a name="LN566"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN567"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sign</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do our own scan, rather than relying on sscanf which might be broken 
     * for long long. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* skip leading spaces */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span> 
        <a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* handle sign */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Do an explicit check for INT64_MIN.  Ugly though this is, it's 
         * cleaner than trying to get the loop below to handle it portably. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><span class='String'>"9223372036854775808"</span><span class='Delimiter'>, </span><span class='Number'>19</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pgbench.c.html#LN566"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN341"><span class='Ref_to_Const'>PG_INT64_MIN</span></a><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Number'>19</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgbench.c.html#LN612"><span class='Ref_to_Label'>gotdigits</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pgbench.c.html#LN567"><span class='Ref_To_Local'>sign</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>== </span><span class='String'>'+'</span><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* require at least one digit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid input syntax for integer: \"%s\"\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN563"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* process digits */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&& </span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN605"></a>        <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>tmp</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN566"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>* </span><span class='Number'>10</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ - </span><span class='String'>'0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN605"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pgbench.c.html#LN566"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* overflow? */ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"value \"%s\" is out of range for type bigint\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN563"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN566"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN605"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
<a name="LN612"></a><span class='Label'>gotdigits</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* allow trailing whitespace, but not other trailing chars */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span> 
        <a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid input syntax for integer: \"%s\"\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN563"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN567"><span class='Ref_To_Local'>sign</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? -</span><a href="pgbench.c.html#LN566"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>: </span><a href="pgbench.c.html#LN566"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end strtoint64 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* random number generator: uniform distribution from min to max inclusive */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN626"></a><span class='Declare_Function'>getrand</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>min</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>max</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Odd coding is so that min and max have approximately the same chance of 
     * being selected as do numbers between them. 
     * 
     * pg_erand48() is thread-safe and concurrent, which is why we use it 
     * rather than random(), which in glibc is non-reentrant, and therefore 
     * protected by a mutex, and therefore a bottleneck on machines with many 
     * CPUs. 
     */ 
</span>    <span class='Control'>return</span> <a href="pgbench.c.html#LN626"><span class='Ref_to_Parameter'>min</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) ((</span><a href="pgbench.c.html#LN626"><span class='Ref_to_Parameter'>max</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN626"><span class='Ref_to_Parameter'>min</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../port/erand48.c.html#LN77"><span class='Ref_to_Func'>pg_erand48</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN626"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN344"><span class='Ref_to_Member'>random_state</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * random number generator: exponential distribution from min to max inclusive. 
 * the parameter is so that the density of probability for the last cut-off max 
 * value is exp(-parameter). 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN646"></a><span class='Declare_Function'>getExponentialRand</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>min</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>max</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>parameter</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN648"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>cut</span><span class='Delimiter'>, 
</span><a name="LN649"></a>                <span class='Declare_Local'>uniform</span><span class='Delimiter'>, 
</span><a name="LN650"></a>                <span class='Declare_Local'>rand</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* abort if wrong parameter, but must really be checked beforehand */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN646"><span class='Ref_to_Parameter'>parameter</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN648"><span class='Ref_To_Local'>cut</span></a> <span class='Operator'>= </span>exp<span class='Parentheses'>(</span><span class='Operator'>-</span><a href="pgbench.c.html#LN646"><span class='Ref_to_Parameter'>parameter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* erand in [0, 1), uniform in (0, 1] */ 
</span>    <a href="pgbench.c.html#LN649"><span class='Ref_To_Local'>uniform</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="../../port/erand48.c.html#LN77"><span class='Ref_to_Func'>pg_erand48</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN646"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN344"><span class='Ref_to_Member'>random_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * inner expression in (cut, 1] (if parameter &GT; 0), rand in [0, 1) 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>((</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="pgbench.c.html#LN648"><span class='Ref_To_Local'>cut</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN650"><span class='Ref_To_Local'>rand</span></a> <span class='Operator'>= -</span>log<span class='Parentheses'>(</span><a href="pgbench.c.html#LN648"><span class='Ref_To_Local'>cut</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="pgbench.c.html#LN648"><span class='Ref_To_Local'>cut</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pgbench.c.html#LN649"><span class='Ref_To_Local'>uniform</span></a><span class='Parentheses'>)</span> <span class='Operator'>/ </span><a href="pgbench.c.html#LN646"><span class='Ref_to_Parameter'>parameter</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* return int64 random number within between min and max */ 
</span>    <span class='Control'>return</span> <a href="pgbench.c.html#LN646"><span class='Ref_to_Parameter'>min</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) ((</span><a href="pgbench.c.html#LN646"><span class='Ref_to_Parameter'>max</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN646"><span class='Ref_to_Parameter'>min</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pgbench.c.html#LN650"><span class='Ref_To_Local'>rand</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getExponentialRand &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* random number generator: gaussian distribution from min to max inclusive */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN669"></a><span class='Declare_Function'>getGaussianRand</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>min</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>max</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>parameter</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN671"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>stdev</span><span class='Delimiter'>; 
</span><a name="LN672"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>rand</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* abort if parameter is too low, but must really be checked beforehand */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN669"><span class='Ref_to_Parameter'>parameter</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN95"><span class='Ref_to_Const'>MIN_GAUSSIAN_PARAM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get user specified random number from this loop, with -parameter &LT; 
     * stdev &LT;= parameter 
     * 
     * This loop is executed until the number is in the expected range. 
     * 
     * As the minimum parameter is 2.0, the probability of looping is low: 
     * sqrt(-2 ln(r)) &LT;= 2 =&GT; r &GT;= e^{-2} ~ 0.135, then when taking the 
     * average sinus multiplier as 2/pi, we have a 8.6% looping probability in 
     * the worst case. For a parameter value of 5.0, the looping probability 
     * is about e^{-5} * 2 / pi ~ 0.43%. 
     */ 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * pg_erand48 generates [0,1), but for the basic version of the 
         * Box-Muller transform the two uniformly distributed random numbers 
         * are expected in (0, 1] (see 
         * http://en.wikipedia.org/wiki/Box_muller) 
         */ 
</span><a name="LN697"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>rand1</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="../../port/erand48.c.html#LN77"><span class='Ref_to_Func'>pg_erand48</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN669"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN344"><span class='Ref_to_Member'>random_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN698"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>rand2</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="../../port/erand48.c.html#LN77"><span class='Ref_to_Func'>pg_erand48</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN669"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN344"><span class='Ref_to_Member'>random_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Box-Muller basic form transform */ 
</span><a name="LN701"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>var_sqrt</span> <span class='Operator'>= </span>sqrt<span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>2</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span>log<span class='Parentheses'>(</span><a href="pgbench.c.html#LN697"><span class='Ref_To_Local'>rand1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN671"><span class='Ref_To_Local'>stdev</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN701"><span class='Ref_To_Local'>var_sqrt</span></a> <span class='Operator'>* </span>sin<span class='Parentheses'>(</span><span class='Number'>2</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><a href="../../../contrib/earthdistance/earthdistance.c.html#LN9"><span class='Ref_to_Const'>M_PI</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN698"><span class='Ref_To_Local'>rand2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * we may try with cos, but there may be a bias induced if the 
         * previous value fails the test. To be on the safe side, let us try 
         * over. 
         */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN671"><span class='Ref_To_Local'>stdev</span></a> <span class='Operator'>&LT; -</span><a href="pgbench.c.html#LN669"><span class='Ref_to_Parameter'>parameter</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN671"><span class='Ref_To_Local'>stdev</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN669"><span class='Ref_to_Parameter'>parameter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* stdev is in [-parameter, parameter), normalization to [0,1) */ 
</span>    <a href="pgbench.c.html#LN672"><span class='Ref_To_Local'>rand</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN671"><span class='Ref_To_Local'>stdev</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN669"><span class='Ref_to_Parameter'>parameter</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN669"><span class='Ref_to_Parameter'>parameter</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* return int64 random number within between min and max */ 
</span>    <span class='Control'>return</span> <a href="pgbench.c.html#LN669"><span class='Ref_to_Parameter'>min</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) ((</span><a href="pgbench.c.html#LN669"><span class='Ref_to_Parameter'>max</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN669"><span class='Ref_to_Parameter'>min</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pgbench.c.html#LN672"><span class='Ref_To_Local'>rand</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getGaussianRand &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * random number generator: generate a value, such that the series of values 
 * will approximate a Poisson distribution centered on the given value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN725"></a><span class='Declare_Function'>getPoissonRand</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>center</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Use inverse transform sampling to generate a value &GT; 0, such that the 
     * expected (i.e. average) value is the given argument. 
     */ 
</span><a name="LN731"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>uniform</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* erand in [0, 1), uniform in (0, 1] */ 
</span>    <a href="pgbench.c.html#LN731"><span class='Ref_To_Local'>uniform</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="../../port/erand48.c.html#LN77"><span class='Ref_to_Func'>pg_erand48</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN725"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN344"><span class='Ref_to_Member'>random_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) (</span><span class='Operator'>-</span>log<span class='Parentheses'>(</span><a href="pgbench.c.html#LN731"><span class='Ref_To_Local'>uniform</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN725"><span class='Ref_to_Parameter'>center</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Initialize the given SimpleStats struct to all zeroes 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN743"></a><span class='Declare_Function'>initSimpleStats</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN215"><span class='Ref_to_Struct'>SimpleStats</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ss</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    memset<span class='Parentheses'>(</span><a href="pgbench.c.html#LN743"><span class='Ref_to_Parameter'>ss</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN215"><span class='Ref_to_Struct'>SimpleStats</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Accumulate one value into a SimpleStats struct. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN752"></a><span class='Declare_Function'>addToSimpleStats</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN215"><span class='Ref_to_Struct'>SimpleStats</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ss</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN217"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN218"><span class='Ref_to_Member'>min</span></a><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN218"><span class='Ref_to_Member'>min</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN217"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>&GT; </span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN219"><span class='Ref_to_Member'>max</span></a><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN219"><span class='Ref_to_Member'>max</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN217"><span class='Ref_to_Member'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN221"><span class='Ref_to_Member'>sum2</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN752"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Merge two SimpleStats objects 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN767"></a><span class='Declare_Function'>mergeSimpleStats</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN215"><span class='Ref_to_Struct'>SimpleStats</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acc</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN215"><span class='Ref_to_Struct'>SimpleStats</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ss</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>acc</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN217"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN218"><span class='Ref_to_Member'>min</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>acc</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN218"><span class='Ref_to_Member'>min</span></a><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>acc</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN218"><span class='Ref_to_Member'>min</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN218"><span class='Ref_to_Member'>min</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>acc</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN217"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN219"><span class='Ref_to_Member'>max</span></a> <span class='Operator'>&GT; </span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>acc</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN219"><span class='Ref_to_Member'>max</span></a><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>acc</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN219"><span class='Ref_to_Member'>max</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN219"><span class='Ref_to_Member'>max</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>acc</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN217"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN217"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>acc</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>acc</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN221"><span class='Ref_to_Member'>sum2</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN767"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN221"><span class='Ref_to_Member'>sum2</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Initialize a StatsData struct to mostly zeroes, with its start time set to 
 * the given value. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN783"></a><span class='Declare_Function'>initStats</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sd</span><span class='Delimiter'>, </span>time_t <span class='Declare_Parameter'>start_time</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pgbench.c.html#LN783"><span class='Ref_to_Parameter'>sd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN230"><span class='Ref_to_Member'>start_time</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN783"><span class='Ref_to_Parameter'>start_time</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN783"><span class='Ref_to_Parameter'>sd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN783"><span class='Ref_to_Parameter'>sd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN742"><span class='Ref_to_Func'>initSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN783"><span class='Ref_to_Parameter'>sd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN742"><span class='Ref_to_Func'>initSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN783"><span class='Ref_to_Parameter'>sd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Accumulate one additional item into the given stats object. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN796"></a><span class='Declare_Function'>accumStats</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stats</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>skipped</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>lat</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>lag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pgbench.c.html#LN796"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN796"><span class='Ref_to_Parameter'>skipped</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* no latency to record on skipped transactions */ 
</span>        <a href="pgbench.c.html#LN796"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN751"><span class='Ref_to_Func'>addToSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN796"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN796"><span class='Ref_to_Parameter'>lat</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* and possibly the same for schedule lag */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN751"><span class='Ref_to_Func'>addToSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN796"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN796"><span class='Ref_to_Parameter'>lag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* call PQexec() and exit() on failure */ 
</span><span class='Keyword'>static void 
</span><a name="LN817"></a><span class='Declare_Function'>executeStatement</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>con</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sql</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN819"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN819"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN817"><span class='Ref_to_Parameter'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN817"><span class='Ref_to_Parameter'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN819"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN817"><span class='Ref_to_Parameter'>con</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN819"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* call PQexec() and complain, but without exiting, on failure */ 
</span><span class='Keyword'>static void 
</span><a name="LN832"></a><span class='Declare_Function'>tryExecuteStatement</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>con</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sql</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN834"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN834"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN832"><span class='Ref_to_Parameter'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN832"><span class='Ref_to_Parameter'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN834"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN832"><span class='Ref_to_Parameter'>con</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"(ignoring this error and continuing anyway)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN834"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* set up a connection to the backend */ 
</span><span class='Keyword'>static </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>* 
</span><a name="LN847"></a><span class='Declare_Function'>doConnect</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN849"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span><a name="LN850"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_pass</span><span class='Delimiter'>; 
</span><a name="LN851"></a>    <span class='Keyword'>static bool </span><span class='Declare_Local'>have_password</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN852"></a>    <span class='Keyword'>static char </span><span class='Declare_Local'>password</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start the connection.  Loop until we have a password if requested by 
     * backend. 
     */ 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span><a name="LN860"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PARAMS_ARRAY_SIZE</span>   <span class='Number'>7</span> 
 
<a name="LN862"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>keywords</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN860"><span class='Ref_to_Const'>PARAMS_ARRAY_SIZE</span></a><span class='Delimiter'>]; 
</span><a name="LN863"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN860"><span class='Ref_to_Const'>PARAMS_ARRAY_SIZE</span></a><span class='Delimiter'>]; 
</span> 
        <a href="pgbench.c.html#LN862"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"host"</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN863"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN179"><span class='Ref_to_Global_Var'>pghost</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN862"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"port"</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN863"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN180"><span class='Ref_to_Global_Var'>pgport</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN862"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"user"</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN863"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN181"><span class='Ref_to_Global_Var'>login</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN862"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"password"</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN863"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN851"><span class='Ref_To_Local'>have_password</span></a> <span class='Operator'>? </span><a href="pgbench.c.html#LN852"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN862"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"dbname"</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN863"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN862"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"fallback_application_name"</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN863"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN862"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>[</span><span class='Number'>6</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN863"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>6</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN850"><span class='Ref_To_Local'>new_pass</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN849"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN261"><span class='Ref_to_Proto'>PQconnectdbParams</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN862"><span class='Ref_To_Local'>keywords</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN863"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN849"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"connection to database \"%s\" failed\n"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN317"><span class='Ref_to_Proto'>PQstatus</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN849"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a> <span class='Operator'>&& 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN326"><span class='Ref_to_Proto'>PQconnectionNeedsPassword</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN849"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="pgbench.c.html#LN851"><span class='Ref_To_Local'>have_password</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN849"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../port/sprompt.c.html#LN35"><span class='Ref_to_Func'>simple_prompt</span></a><span class='Parentheses'>(</span><span class='String'>"Password: "</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN852"><span class='Ref_To_Local'>password</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN852"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN851"><span class='Ref_To_Local'>have_password</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN850"><span class='Ref_To_Local'>new_pass</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN850"><span class='Ref_To_Local'>new_pass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check to see that the backend connection was successfully made */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN317"><span class='Ref_to_Proto'>PQstatus</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN849"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"connection to database \"%s\" failed:\n%s"</span><span class='Delimiter'>, 
</span>                <a href="pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN849"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN849"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pgbench.c.html#LN849"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end doConnect &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* throw away response from backend */ 
</span><span class='Keyword'>static void 
</span><a name="LN916"></a><span class='Declare_Function'>discard_response</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN918"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN918"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN916"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN918"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN918"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN918"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* qsort comparator for Variable array */ 
</span><span class='Keyword'>static int 
</span><a name="LN930"></a><span class='Declare_Function'>compareVariableNames</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>v1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>v2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> strcmp<span class='Parentheses'>(((</span><span class='Keyword'>const </span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN930"><span class='Ref_to_Parameter'>v1</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>name<span class='Delimiter'>, 
</span>                  <span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN930"><span class='Ref_to_Parameter'>v2</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>name<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Locate a variable by name; returns NULL if unknown */ 
</span><span class='Keyword'>static </span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a> <span class='Operator'>* 
</span><a name="LN938"></a><span class='Declare_Function'>lookupVariable</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN940"></a>    <a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a>    <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* On some versions of Solaris, bsearch of zero items dumps core */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN938"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN319"><span class='Ref_to_Member'>nvariables</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Sort if we have to */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN938"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN320"><span class='Ref_to_Member'>vars_sorted</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN938"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN318"><span class='Ref_to_Member'>variables</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN938"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN319"><span class='Ref_to_Member'>nvariables</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="pgbench.c.html#LN929"><span class='Ref_to_Func'>compareVariableNames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN938"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN320"><span class='Ref_to_Member'>vars_sorted</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now we can search */ 
</span>    <a href="pgbench.c.html#LN940"><span class='Ref_To_Local'>key</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN200"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN938"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>bsearch<span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pgbench.c.html#LN940"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN938"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN318"><span class='Ref_to_Member'>variables</span></a><span class='Delimiter'>, 
</span>                                <a href="pgbench.c.html#LN938"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN319"><span class='Ref_to_Member'>nvariables</span></a><span class='Delimiter'>, 
</span>                                <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="pgbench.c.html#LN929"><span class='Ref_to_Func'>compareVariableNames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end lookupVariable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Get the value of a variable, in string form; returns NULL if unknown */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN965"></a><span class='Declare_Function'>getVariable</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN967"></a>    <a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN968"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>stringform</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span> 
    <a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN937"><span class='Ref_to_Func'>lookupVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN965"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN965"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* not found */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* we have it in string form */ 
</span> 
    <span class='Comment_Multi_Line'>/* We need to produce a string equivalent of the numeric value */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN202"><span class='Ref_to_Member'>is_numeric</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN203"><span class='Ref_to_Member'>num_value</span></a><span class='Operator'>.</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN35"><span class='Ref_to_EnumConst'>PGBT_INT</span></a><span class='Parentheses'>) 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN968"><span class='Ref_To_Local'>stringform</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN968"><span class='Ref_To_Local'>stringform</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN203"><span class='Ref_to_Member'>num_value</span></a><span class='Operator'>.</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>ival<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN203"><span class='Ref_to_Member'>num_value</span></a><span class='Operator'>.</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN36"><span class='Ref_to_EnumConst'>PGBT_DOUBLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN968"><span class='Ref_To_Local'>stringform</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN968"><span class='Ref_To_Local'>stringform</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"%.*g"</span><span class='Delimiter'>, </span>DBL_DIG<span class='Delimiter'>, </span><a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN203"><span class='Ref_to_Member'>num_value</span></a><span class='Operator'>.</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>dval<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN968"><span class='Ref_To_Local'>stringform</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgbench.c.html#LN967"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getVariable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Try to convert variable to numeric form; return false on failure */ 
</span><span class='Keyword'>static bool 
</span><a name="LN994"></a><span class='Declare_Function'>makeVariableNumeric</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN994"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN202"><span class='Ref_to_Member'>is_numeric</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* no work */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN530"><span class='Ref_to_Func'>is_an_int</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN994"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN994"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN203"><span class='Ref_to_Member'>num_value</span></a><span class='Delimiter'>, </span><a href="pgbench.h.html#LN137"><span class='Ref_to_Proto'>strtoint64</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN994"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN994"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN202"><span class='Ref_to_Member'>is_numeric</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* type should be double */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1006"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>dv</span><span class='Delimiter'>; 
</span><a name="LN1007"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>xs</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>sscanf<span class='Parentheses'>(</span><a href="pgbench.c.html#LN994"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='String'>"%lf%c"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1006"><span class='Ref_To_Local'>dv</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1007"><span class='Ref_To_Local'>xs</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    <span class='String'>"malformed variable \"%s\" value: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN994"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN200"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN994"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pgbench.c.html#LN450"><span class='Ref_to_Proto'>setDoubleValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN994"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN203"><span class='Ref_to_Member'>num_value</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1006"><span class='Ref_To_Local'>dv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN994"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN202"><span class='Ref_to_Member'>is_numeric</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeVariableNumeric &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* check whether the name consists of alphabets, numerals and underscores. */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1024"></a><span class='Declare_Function'>isLegalVariableName</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1026"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1026"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1024"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1026"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1026"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isalnum<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN1024"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1026"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN1024"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1026"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'_'</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1026"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* must be non-empty */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Lookup a variable by name, creating it if need be. 
 * Caller is expected to assign a value to the variable. 
 * Returns NULL on failure (bad name). 
 */ 
</span><span class='Keyword'>static </span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a> <span class='Operator'>* 
</span><a name="LN1043"></a><span class='Declare_Function'>lookupCreateVariable</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1045"></a>    <a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN1045"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN937"><span class='Ref_to_Func'>lookupVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1045"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1050"></a>        <a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newvars</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check for the name only when declaring a new variable to avoid 
         * overhead. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1023"><span class='Ref_to_Func'>isLegalVariableName</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: invalid variable name: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Create variable at the end of the array */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN318"><span class='Ref_to_Member'>variables</span></a><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN1050"><span class='Ref_To_Local'>newvars</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN28"><span class='Ref_to_Proto'>pg_realloc</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN318"><span class='Ref_to_Member'>variables</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN319"><span class='Ref_to_Member'>nvariables</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pgbench.c.html#LN1050"><span class='Ref_To_Local'>newvars</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN318"><span class='Ref_to_Member'>variables</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1050"><span class='Ref_To_Local'>newvars</span></a><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN1045"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= &</span><a href="pgbench.c.html#LN1050"><span class='Ref_To_Local'>newvars</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN319"><span class='Ref_to_Member'>nvariables</span></a><span class='Delimiter'>]; 
</span> 
        <a href="pgbench.c.html#LN1045"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN200"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN1045"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* caller is expected to initialize remaining fields */ 
</span> 
        <a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN319"><span class='Ref_to_Member'>nvariables</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* we don't re-sort the array till we have to */ 
</span>        <a href="pgbench.c.html#LN1043"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN320"><span class='Ref_to_Member'>vars_sorted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if var==NULL &raquo; </span> 
 
    <span class='Control'>return</span> <a href="pgbench.c.html#LN1045"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end lookupCreateVariable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Assign a string value to a variable, creating it if need be */ 
/* Returns false on failure (bad name) */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1089"></a><span class='Declare_Function'>putVariable</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1091"></a>    <a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN1092"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN1091"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1042"><span class='Ref_to_Func'>lookupCreateVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1089"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1089"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1089"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1091"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dup then free, in case value is pointing at this variable */ 
</span>    <a href="pgbench.c.html#LN1092"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1091"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1091"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN1091"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="pgbench.c.html#LN1092"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN1091"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN202"><span class='Ref_to_Member'>is_numeric</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end putVariable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Assign a numeric value to a variable, creating it if need be */ 
/* Returns false on failure (bad name) */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1112"></a><span class='Declare_Function'>putVariableNumber</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, 
</span><a name="LN1113"></a>                  <span class='Keyword'>const </span><a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1115"></a>    <a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN1115"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1042"><span class='Ref_to_Func'>lookupCreateVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1112"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1112"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1112"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1115"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1115"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1115"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN1115"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN1115"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN202"><span class='Ref_to_Member'>is_numeric</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN1115"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN203"><span class='Ref_to_Member'>num_value</span></a> <span class='Operator'>= *</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Assign an integer value to a variable, creating it if need be */ 
/* Returns false on failure (bad name) */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1133"></a><span class='Declare_Function'>putVariableInt</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1135"></a>    <a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1135"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgbench.c.html#LN1111"><span class='Ref_to_Func'>putVariableNumber</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1133"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1133"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1133"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1135"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN1142"></a><span class='Declare_Function'>parseVariable</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sql</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>eaten</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1144"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1145"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN1144"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span>isalnum<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN1142"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1144"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>|| </span><a href="pgbench.c.html#LN1142"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1144"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'_'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1144"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN1145"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1144"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1145"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1142"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="pgbench.c.html#LN1144"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN1145"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1144"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="pgbench.c.html#LN1142"><span class='Ref_to_Parameter'>eaten</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1144"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgbench.c.html#LN1145"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parseVariable &raquo; </span> 
 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN1163"></a><span class='Declare_Function'>replaceVariable</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>sql</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>param</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1165"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>valueln</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1165"><span class='Ref_To_Local'>valueln</span></a> <span class='Operator'>&GT; </span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1169"></a>        size_t      <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>param</span></a> <span class='Operator'>- *</span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>; 
</span> 
        <span class='Operator'>*</span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>sql</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN28"><span class='Ref_to_Proto'>pg_realloc</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>sql</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN1165"><span class='Ref_To_Local'>valueln</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>param</span></a> <span class='Operator'>= *</span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>sql</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN1169"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1165"><span class='Ref_To_Local'>valueln</span></a> <span class='Operator'>!= </span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>param</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN1165"><span class='Ref_To_Local'>valueln</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>param</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>param</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>param</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1165"><span class='Ref_To_Local'>valueln</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgbench.c.html#LN1163"><span class='Ref_to_Parameter'>param</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN1165"><span class='Ref_To_Local'>valueln</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN1183"></a><span class='Declare_Function'>assignVariables</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sql</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1185"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>, 
</span><a name="LN1186"></a>               <span class='Operator'>*</span><span class='Declare_Local'>name</span><span class='Delimiter'>, 
</span><a name="LN1187"></a>               <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN1185"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1183"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN1185"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1185"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='String'>':'</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1192"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>eaten</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN1186"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1141"><span class='Ref_to_Func'>parseVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1185"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1192"><span class='Ref_To_Local'>eaten</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1186"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN1185"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pgbench.c.html#LN1185"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pgbench.c.html#LN1187"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN964"><span class='Ref_to_Func'>getVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1183"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1186"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1186"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1187"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pgbench.c.html#LN1185"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pgbench.c.html#LN1185"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1162"><span class='Ref_to_Func'>replaceVariable</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1183"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1185"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1192"><span class='Ref_To_Local'>eaten</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1187"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (p=strchr(p,':'))!=NU... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="pgbench.c.html#LN1183"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end assignVariables &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1219"></a><span class='Declare_Function'>getQueryParams</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>command</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>params</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1221"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1221"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1221"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN1219"><span class='Ref_to_Parameter'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1221"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN1219"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1221"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN964"><span class='Ref_to_Func'>getVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1219"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1219"><span class='Ref_to_Parameter'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1221"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* get a value as an int, tell if there is a problem */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1229"></a><span class='Declare_Function'>coerceToInt</span><span class='Parentheses'>(</span><a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pval</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ival</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1229"><span class='Ref_to_Parameter'>pval</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN35"><span class='Ref_to_EnumConst'>PGBT_INT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="pgbench.c.html#LN1229"><span class='Ref_to_Parameter'>ival</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1229"><span class='Ref_to_Parameter'>pval</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>ival<span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1238"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>dval</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1229"><span class='Ref_to_Parameter'>pval</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>dval<span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1229"><span class='Ref_to_Parameter'>pval</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN36"><span class='Ref_to_EnumConst'>PGBT_DOUBLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1238"><span class='Ref_To_Local'>dval</span></a> <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN341"><span class='Ref_to_Const'>PG_INT64_MIN</span></a> <span class='Operator'>|| </span><a href="../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN1238"><span class='Ref_To_Local'>dval</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"double to int overflow for %f\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1238"><span class='Ref_To_Local'>dval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="pgbench.c.html#LN1229"><span class='Ref_to_Parameter'>ival</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pgbench.c.html#LN1238"><span class='Ref_To_Local'>dval</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end coerceToInt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* get a value as a double, or tell if there is a problem */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1253"></a><span class='Declare_Function'>coerceToDouble</span><span class='Parentheses'>(</span><a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pval</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>dval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1253"><span class='Ref_to_Parameter'>pval</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN36"><span class='Ref_to_EnumConst'>PGBT_DOUBLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="pgbench.c.html#LN1253"><span class='Ref_to_Parameter'>dval</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1253"><span class='Ref_to_Parameter'>pval</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>dval<span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1253"><span class='Ref_to_Parameter'>pval</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN35"><span class='Ref_to_EnumConst'>PGBT_INT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pgbench.c.html#LN1253"><span class='Ref_to_Parameter'>dval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN1253"><span class='Ref_to_Parameter'>pval</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>ival<span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* assign an integer value */ 
</span><span class='Keyword'>static void 
</span><a name="LN1270"></a><span class='Declare_Function'>setIntValue</span><span class='Parentheses'>(</span><a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pv</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>ival</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pgbench.c.html#LN1270"><span class='Ref_to_Parameter'>pv</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="pgbench.h.html#LN35"><span class='Ref_to_EnumConst'>PGBT_INT</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN1270"><span class='Ref_to_Parameter'>pv</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>ival <span class='Operator'>= </span><a href="pgbench.c.html#LN1270"><span class='Ref_to_Parameter'>ival</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* assign a double value */ 
</span><span class='Keyword'>static void 
</span><a name="LN1278"></a><span class='Declare_Function'>setDoubleValue</span><span class='Parentheses'>(</span><a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pv</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>dval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pgbench.c.html#LN1278"><span class='Ref_to_Parameter'>pv</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="pgbench.h.html#LN36"><span class='Ref_to_EnumConst'>PGBT_DOUBLE</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN1278"><span class='Ref_to_Parameter'>pv</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>dval <span class='Operator'>= </span><a href="pgbench.c.html#LN1278"><span class='Ref_to_Parameter'>dval</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* maximum number of function arguments */ 
</span><a name="LN1285"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_FARGS</span> <span class='Number'>16</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Recursive evaluation of functions 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1291"></a><span class='Declare_Function'>evalFunc</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, 
</span><a name="LN1292"></a>         <a href="pgbench.h.html#LN60"><span class='Ref_to_Enum'>PgBenchFunction</span></a> <span class='Declare_Parameter'>func</span><span class='Delimiter'>, </span><a href="pgbench.h.html#LN103"><span class='Ref_to_Struct'>PgBenchExprLink</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Delimiter'>, </span><a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>retval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* evaluate all function arguments */ 
</span><a name="LN1295"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nargs</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1296"></a>    <a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Declare_Local'>vargs</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1285"><span class='Ref_to_Const'>MAX_FARGS</span></a><span class='Delimiter'>]; 
</span><a name="LN1297"></a>    <a href="pgbench.h.html#LN103"><span class='Ref_to_Struct'>PgBenchExprLink</span></a> <span class='Operator'>*</span><span class='Declare_Local'>l</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN1285"><span class='Ref_to_Const'>MAX_FARGS</span></a> <span class='Operator'>&& </span><a href="pgbench.c.html#LN1297"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1297"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1297"><span class='Ref_To_Local'>l</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN106"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN451"><span class='Ref_to_Proto'>evaluateExpr</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1291"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1291"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1297"><span class='Ref_To_Local'>l</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN105"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1297"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                <span class='String'>"too many function arguments, maximum is %d\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1285"><span class='Ref_to_Const'>MAX_FARGS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* then evaluate function */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* overloaded operators */ 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN62"><span class='Ref_to_EnumConst'>PGBENCH_ADD</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN63"><span class='Ref_to_EnumConst'>PGBENCH_SUB</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN64"><span class='Ref_to_EnumConst'>PGBENCH_MUL</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN65"><span class='Ref_to_EnumConst'>PGBENCH_DIV</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN66"><span class='Ref_to_EnumConst'>PGBENCH_MOD</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1320"></a>                <a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lval</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span><a name="LN1321"></a>                           <span class='Operator'>*</span><span class='Declare_Local'>rval</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* overloaded type management, double if some double */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN1320"><span class='Ref_To_Local'>lval</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN36"><span class='Ref_to_EnumConst'>PGBT_DOUBLE</span></a> <span class='Operator'>|| 
</span>                     <a href="pgbench.c.html#LN1321"><span class='Ref_To_Local'>rval</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN36"><span class='Ref_to_EnumConst'>PGBT_DOUBLE</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a> <span class='Operator'>!= </span><a href="pgbench.h.html#LN66"><span class='Ref_to_EnumConst'>PGBENCH_MOD</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span><a name="LN1329"></a>                    <span class='Keyword'>double</span>      <span class='Declare_Local'>ld</span><span class='Delimiter'>, 
</span><a name="LN1330"></a>                                <span class='Declare_Local'>rd</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1252"><span class='Ref_to_Func'>coerceToDouble</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1320"><span class='Ref_To_Local'>lval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1329"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                        <span class='Operator'>!</span><a href="pgbench.c.html#LN1252"><span class='Ref_to_Func'>coerceToDouble</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1321"><span class='Ref_To_Local'>rval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1330"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <a href="pgbench.h.html#LN62"><span class='Ref_to_EnumConst'>PGBENCH_ADD</span></a><span class='Operator'>: 
</span>                            <a href="pgbench.c.html#LN450"><span class='Ref_to_Proto'>setDoubleValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1329"><span class='Ref_To_Local'>ld</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN1330"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="pgbench.h.html#LN63"><span class='Ref_to_EnumConst'>PGBENCH_SUB</span></a><span class='Operator'>: 
</span>                            <a href="pgbench.c.html#LN450"><span class='Ref_to_Proto'>setDoubleValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1329"><span class='Ref_To_Local'>ld</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN1330"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="pgbench.h.html#LN64"><span class='Ref_to_EnumConst'>PGBENCH_MUL</span></a><span class='Operator'>: 
</span>                            <a href="pgbench.c.html#LN450"><span class='Ref_to_Proto'>setDoubleValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1329"><span class='Ref_To_Local'>ld</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN1330"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="pgbench.h.html#LN65"><span class='Ref_to_EnumConst'>PGBENCH_DIV</span></a><span class='Operator'>: 
</span>                            <a href="pgbench.c.html#LN450"><span class='Ref_to_Proto'>setDoubleValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1329"><span class='Ref_To_Local'>ld</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN1330"><span class='Ref_To_Local'>rd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <span class='Comment_Multi_Line'>/* cannot get here */ 
</span>                            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch func &raquo; </span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (lval-&GT;type==PGBT_DOU... &raquo; </span> 
                <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* we have integer operands, or % */ 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1361"></a>                    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>li</span><span class='Delimiter'>, 
</span><a name="LN1362"></a>                                <span class='Declare_Local'>ri</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1228"><span class='Ref_to_Func'>coerceToInt</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1320"><span class='Ref_To_Local'>lval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1361"><span class='Ref_To_Local'>li</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                        <span class='Operator'>!</span><a href="pgbench.c.html#LN1228"><span class='Ref_to_Func'>coerceToInt</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1321"><span class='Ref_To_Local'>rval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1362"><span class='Ref_To_Local'>ri</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <a href="pgbench.h.html#LN62"><span class='Ref_to_EnumConst'>PGBENCH_ADD</span></a><span class='Operator'>: 
</span>                            <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1361"><span class='Ref_To_Local'>li</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN1362"><span class='Ref_To_Local'>ri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="pgbench.h.html#LN63"><span class='Ref_to_EnumConst'>PGBENCH_SUB</span></a><span class='Operator'>: 
</span>                            <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1361"><span class='Ref_To_Local'>li</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN1362"><span class='Ref_To_Local'>ri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="pgbench.h.html#LN64"><span class='Ref_to_EnumConst'>PGBENCH_MUL</span></a><span class='Operator'>: 
</span>                            <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1361"><span class='Ref_To_Local'>li</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN1362"><span class='Ref_To_Local'>ri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="pgbench.h.html#LN65"><span class='Ref_to_EnumConst'>PGBENCH_DIV</span></a><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="pgbench.h.html#LN66"><span class='Ref_to_EnumConst'>PGBENCH_MOD</span></a><span class='Operator'>: 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1362"><span class='Ref_To_Local'>ri</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"division by zero\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Comment_Multi_Line'>/* special handling of -1 divisor */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1362"><span class='Ref_To_Local'>ri</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                            <span class='Delimiter'>{ 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN65"><span class='Ref_to_EnumConst'>PGBENCH_DIV</span></a><span class='Parentheses'>) 
</span>                                <span class='Delimiter'>{ 
</span>                                    <span class='Comment_Multi_Line'>/* overflow check (needed for INT64_MIN) */ 
</span>                                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1361"><span class='Ref_To_Local'>li</span></a> <span class='Operator'>== </span><a href="../../include/c.h.html#LN341"><span class='Ref_to_Const'>PG_INT64_MIN</span></a><span class='Parentheses'>) 
</span>                                    <span class='Delimiter'>{ 
</span>                                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"bigint out of range\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                                    <span class='Delimiter'>} 
</span>                                    <span class='Control'>else</span> 
                                        <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="pgbench.c.html#LN1361"><span class='Ref_To_Local'>li</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Delimiter'>} 
</span>                                <span class='Control'>else</span> 
                                    <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Comment_Multi_Line'>/* else divisor is not -1 */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN65"><span class='Ref_to_EnumConst'>PGBENCH_DIV</span></a><span class='Parentheses'>) 
</span>                                <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1361"><span class='Ref_To_Local'>li</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN1362"><span class='Ref_To_Local'>ri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* func == PGBENCH_MOD */ 
</span>                                <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1361"><span class='Ref_To_Local'>li</span></a> <span class='Operator'>% </span><a href="pgbench.c.html#LN1362"><span class='Ref_To_Local'>ri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <span class='Comment_Multi_Line'>/* cannot get here */ 
</span>                            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch func &raquo; </span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* no arguments */ 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN73"><span class='Ref_to_EnumConst'>PGBENCH_PI</span></a><span class='Operator'>: 
</span>            <a href="pgbench.c.html#LN450"><span class='Ref_to_Proto'>setDoubleValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="../../../contrib/earthdistance/earthdistance.c.html#LN9"><span class='Ref_to_Const'>M_PI</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 1 overloaded argument */ 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN68"><span class='Ref_to_EnumConst'>PGBENCH_ABS</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1430"></a>                <a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>varg</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1430"><span class='Ref_To_Local'>varg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN35"><span class='Ref_to_EnumConst'>PGBT_INT</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1436"></a>                    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>i</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1430"><span class='Ref_To_Local'>varg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>ival<span class='Delimiter'>; 
</span> 
                    <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1436"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>? -</span><a href="pgbench.c.html#LN1436"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>: </span><a href="pgbench.c.html#LN1436"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span><a name="LN1442"></a>                    <span class='Keyword'>double</span>      <span class='Declare_Local'>d</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1430"><span class='Ref_To_Local'>varg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>dval<span class='Delimiter'>; 
</span> 
                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1430"><span class='Ref_To_Local'>varg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN36"><span class='Ref_to_EnumConst'>PGBT_DOUBLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN450"><span class='Ref_to_Proto'>setDoubleValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1442"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>? -</span><a href="pgbench.c.html#LN1442"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>: </span><a href="pgbench.c.html#LN1442"><span class='Ref_To_Local'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="pgbench.h.html#LN67"><span class='Ref_to_EnumConst'>PGBENCH_DEBUG</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1453"></a>                <a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>varg</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"debug(script=%d,command=%d): "</span><span class='Delimiter'>, 
</span>                        <a href="pgbench.c.html#LN1291"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1291"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN315"><span class='Ref_to_Member'>command</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1453"><span class='Ref_To_Local'>varg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN35"><span class='Ref_to_EnumConst'>PGBT_INT</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"int "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>"\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1453"><span class='Ref_To_Local'>varg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>ival<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1453"><span class='Ref_To_Local'>varg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN36"><span class='Ref_to_EnumConst'>PGBT_DOUBLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"double %.*g\n"</span><span class='Delimiter'>, </span>DBL_DIG<span class='Delimiter'>, </span><a href="pgbench.c.html#LN1453"><span class='Ref_To_Local'>varg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN48"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>dval<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Operator'>*</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a> <span class='Operator'>= *</span><a href="pgbench.c.html#LN1453"><span class='Ref_To_Local'>varg</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 1 double argument */ 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN72"><span class='Ref_to_EnumConst'>PGBENCH_DOUBLE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN74"><span class='Ref_to_EnumConst'>PGBENCH_SQRT</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1477"></a>                <span class='Keyword'>double</span>      <span class='Declare_Local'>dval</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1252"><span class='Ref_to_Func'>coerceToDouble</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1477"><span class='Ref_To_Local'>dval</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN74"><span class='Ref_to_EnumConst'>PGBENCH_SQRT</span></a><span class='Parentheses'>) 
</span>                    <a href="pgbench.c.html#LN1477"><span class='Ref_To_Local'>dval</span></a> <span class='Operator'>= </span>sqrt<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1477"><span class='Ref_To_Local'>dval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pgbench.c.html#LN450"><span class='Ref_to_Proto'>setDoubleValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1477"><span class='Ref_To_Local'>dval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 1 int argument */ 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN71"><span class='Ref_to_EnumConst'>PGBENCH_INT</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1494"></a>                <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>ival</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1228"><span class='Ref_to_Func'>coerceToInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1494"><span class='Ref_To_Local'>ival</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1494"><span class='Ref_To_Local'>ival</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* variable number of arguments */ 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN69"><span class='Ref_to_EnumConst'>PGBENCH_LEAST</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN70"><span class='Ref_to_EnumConst'>PGBENCH_GREATEST</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1509"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>havedouble</span><span class='Delimiter'>; 
</span><a name="LN1510"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* need double result if any input is double */ 
</span>                <a href="pgbench.c.html#LN1509"><span class='Ref_To_Local'>havedouble</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.h.html#LN42"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN36"><span class='Ref_to_EnumConst'>PGBT_DOUBLE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="pgbench.c.html#LN1509"><span class='Ref_To_Local'>havedouble</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1509"><span class='Ref_To_Local'>havedouble</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1526"></a>                    <span class='Keyword'>double</span>      <span class='Declare_Local'>extremum</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1252"><span class='Ref_to_Func'>coerceToDouble</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1526"><span class='Ref_To_Local'>extremum</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN1532"></a>                        <span class='Keyword'>double</span>      <span class='Declare_Local'>dval</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1252"><span class='Ref_to_Func'>coerceToDouble</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1532"><span class='Ref_To_Local'>dval</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN69"><span class='Ref_to_EnumConst'>PGBENCH_LEAST</span></a><span class='Parentheses'>) 
</span>                            <a href="pgbench.c.html#LN1526"><span class='Ref_To_Local'>extremum</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1526"><span class='Ref_To_Local'>extremum</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1532"><span class='Ref_To_Local'>dval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="pgbench.c.html#LN1526"><span class='Ref_To_Local'>extremum</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1526"><span class='Ref_To_Local'>extremum</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1532"><span class='Ref_To_Local'>dval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="pgbench.c.html#LN450"><span class='Ref_to_Proto'>setDoubleValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1526"><span class='Ref_To_Local'>extremum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span><a name="LN1545"></a>                    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>extremum</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1228"><span class='Ref_to_Func'>coerceToInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1545"><span class='Ref_To_Local'>extremum</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN1551"></a>                        <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>ival</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1228"><span class='Ref_to_Func'>coerceToInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1510"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1551"><span class='Ref_To_Local'>ival</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN69"><span class='Ref_to_EnumConst'>PGBENCH_LEAST</span></a><span class='Parentheses'>) 
</span>                            <a href="pgbench.c.html#LN1545"><span class='Ref_To_Local'>extremum</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1545"><span class='Ref_To_Local'>extremum</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1551"><span class='Ref_To_Local'>ival</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="pgbench.c.html#LN1545"><span class='Ref_To_Local'>extremum</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1545"><span class='Ref_To_Local'>extremum</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1551"><span class='Ref_To_Local'>ival</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1545"><span class='Ref_To_Local'>extremum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* random functions */ 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN75"><span class='Ref_to_EnumConst'>PGBENCH_RANDOM</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN77"><span class='Ref_to_EnumConst'>PGBENCH_RANDOM_EXPONENTIAL</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN76"><span class='Ref_to_EnumConst'>PGBENCH_RANDOM_GAUSSIAN</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1570"></a>                <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>imin</span><span class='Delimiter'>, 
</span><a name="LN1571"></a>                            <span class='Declare_Local'>imax</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>&GT;= </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1228"><span class='Ref_to_Func'>coerceToInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1570"><span class='Ref_To_Local'>imin</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                    <span class='Operator'>!</span><a href="pgbench.c.html#LN1228"><span class='Ref_to_Func'>coerceToInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1571"><span class='Ref_To_Local'>imax</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* check random range */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1570"><span class='Ref_To_Local'>imin</span></a> <span class='Operator'>&GT; </span><a href="pgbench.c.html#LN1571"><span class='Ref_To_Local'>imax</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"empty range given to random\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1571"><span class='Ref_To_Local'>imax</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN1570"><span class='Ref_To_Local'>imin</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1571"><span class='Ref_To_Local'>imax</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN1570"><span class='Ref_To_Local'>imin</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* prevent int overflows in random functions */ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"random range is too large\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN75"><span class='Ref_to_EnumConst'>PGBENCH_RANDOM</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN625"><span class='Ref_to_Func'>getrand</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1291"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1570"><span class='Ref_To_Local'>imin</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1571"><span class='Ref_To_Local'>imax</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* gaussian & exponential */ 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1599"></a>                    <span class='Keyword'>double</span>      <span class='Declare_Local'>param</span><span class='Delimiter'>; 
</span> 
                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1295"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1252"><span class='Ref_to_Func'>coerceToDouble</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1296"><span class='Ref_To_Local'>vargs</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1599"><span class='Ref_To_Local'>param</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>func</span></a> <span class='Operator'>== </span><a href="pgbench.h.html#LN76"><span class='Ref_to_EnumConst'>PGBENCH_RANDOM_GAUSSIAN</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1599"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN95"><span class='Ref_to_Const'>MIN_GAUSSIAN_PARAM</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                                    <span class='String'>"gaussian parameter must be at least %f "</span> 
                                    <span class='String'>"(not %f)\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN95"><span class='Ref_to_Const'>MIN_GAUSSIAN_PARAM</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1599"><span class='Ref_To_Local'>param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, 
</span>                                 <a href="pgbench.c.html#LN668"><span class='Ref_to_Func'>getGaussianRand</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1291"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1570"><span class='Ref_To_Local'>imin</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1571"><span class='Ref_To_Local'>imax</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1599"><span class='Ref_To_Local'>param</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* exponential */ 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1599"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                            <span class='String'>"exponential parameter must be greater than zero"</span> 
                                    <span class='String'>" (got %f)\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1599"><span class='Ref_To_Local'>param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <a href="pgbench.c.html#LN449"><span class='Ref_to_Proto'>setIntValue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1292"><span class='Ref_to_Parameter'>retval</span></a><span class='Delimiter'>, 
</span>                              <a href="pgbench.c.html#LN645"><span class='Ref_to_Func'>getExponentialRand</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1291"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1570"><span class='Ref_To_Local'>imin</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1571"><span class='Ref_To_Local'>imax</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1599"><span class='Ref_To_Local'>param</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* cannot get here */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* dead code to avoid a compiler warning */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch func &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end evalFunc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Recursive evaluation of an expression in a pgbench script 
 * using the current state of variables. 
 * Returns whether the evaluation was ok, 
 * the value itself is returned through the retval pointer. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1652"></a><span class='Declare_Function'>evaluateExpr</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><a href="pgbench.h.html#LN84"><span class='Ref_to_Struct'>PgBenchExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>retval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN86"><span class='Ref_to_Member'>etype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="pgbench.h.html#LN54"><span class='Ref_to_EnumConst'>ENODE_CONSTANT</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>retval</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN99"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>constant<span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="pgbench.h.html#LN55"><span class='Ref_to_EnumConst'>ENODE_VARIABLE</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1664"></a>                <a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN1664"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN937"><span class='Ref_to_Func'>lookupVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN99"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>variable<span class='Operator'>.</span>varname<span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"undefined variable \"%s\"\n"</span><span class='Delimiter'>, 
</span>                            <a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN99"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>variable<span class='Operator'>.</span>varname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN993"><span class='Ref_to_Func'>makeVariableNumeric</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1664"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Operator'>*</span><a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>retval</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1664"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN203"><span class='Ref_to_Member'>num_value</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="pgbench.h.html#LN56"><span class='Ref_to_EnumConst'>ENODE_FUNCTION</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="pgbench.c.html#LN1290"><span class='Ref_to_Func'>evalFunc</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, 
</span>                            <a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN99"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>function<span class='Operator'>.</span>function<span class='Delimiter'>, 
</span>                            <a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN99"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>function<span class='Operator'>.</span>args<span class='Delimiter'>, 
</span>                            <a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* internal error which should never occur */ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"unexpected enode type in evaluation: %d\n"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN1652"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="pgbench.h.html#LN86"><span class='Ref_to_Member'>etype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch expr-&GT;etype &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end evaluateExpr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Run a shell command. The result is assigned to the variable if not NULL. 
 * Return true if succeeded, or false on error. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1699"></a><span class='Declare_Function'>runShellCommand</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>variable</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>argv</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1701"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>command</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN207"><span class='Ref_to_Const'>SHELL_COMMAND_SIZE</span></a><span class='Delimiter'>]; 
</span><a name="LN1702"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1703"></a>                <span class='Declare_Local'>len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1704"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>fp</span><span class='Delimiter'>; 
</span><a name="LN1705"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>res</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span><a name="LN1706"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span><a name="LN1707"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * Join arguments with whitespace separators. Arguments starting with 
     * exactly one colon are treated as variables: 
     *  name - append a string "name" 
     *  :var - append a variable named 'var' 
     *  ::name - append a string ":name" 
     *---------- 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1719"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN1720"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>arglen</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pgbench.c.html#LN1719"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>];</span>      <span class='Comment_Single_Line'>/* a string literal */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pgbench.c.html#LN1719"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* a string literal starting with colons */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN1719"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN964"><span class='Ref_to_Func'>getVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: undefined variable \"%s\"\n"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pgbench.c.html#LN1720"><span class='Ref_To_Local'>arglen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1719"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1703"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN1720"><span class='Ref_To_Local'>arglen</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN207"><span class='Ref_to_Const'>SHELL_COMMAND_SIZE</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: shell command is too long\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1702"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN1701"><span class='Ref_To_Local'>command</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1703"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1701"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN1703"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1719"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1720"><span class='Ref_To_Local'>arglen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN1703"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN1720"><span class='Ref_To_Local'>arglen</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;argc;i++ &raquo; </span> 
 
    <a href="pgbench.c.html#LN1701"><span class='Ref_To_Local'>command</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1703"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fast path for non-assignment case */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>variable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1701"><span class='Ref_To_Local'>command</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN188"><span class='Ref_to_Global_Var'>timer_exceeded</span></a><span class='Parentheses'>) 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: could not launch shell command\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Execute the command with pipe and read the standard output. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN1704"><span class='Ref_To_Local'>fp</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN313"><span class='Ref_to_Macro'>popen</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1701"><span class='Ref_To_Local'>command</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: could not launch shell command\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fgets<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1705"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1705"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1704"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN188"><span class='Ref_to_Global_Var'>timer_exceeded</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: could not read result of shell command\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/port.h.html#LN314"><span class='Ref_to_Macro'>pclose</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1704"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN314"><span class='Ref_to_Macro'>pclose</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1704"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: could not close shell command\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Check whether the result is an integer and assign it to the variable */ 
</span>    <a href="pgbench.c.html#LN1707"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>strtol<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1705"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1706"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN1706"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pgbench.c.html#LN1706"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>))</span> 
        <a href="pgbench.c.html#LN1706"><span class='Ref_To_Local'>endptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN1705"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| *</span><a href="pgbench.c.html#LN1706"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: shell command must return an integer (not \"%s\")\n"</span><span class='Delimiter'>, 
</span>                <a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="pgbench.c.html#LN1705"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1132"><span class='Ref_to_Func'>putVariableInt</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><span class='String'>"setshell"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>variable</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1707"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> DEBUG 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"shell parameter name: \"%s\", value: \"%s\"\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1699"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="pgbench.c.html#LN1705"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end runShellCommand &raquo; </span> 
 
<a name="LN1802"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_PREPARE_NAME</span>        <span class='Number'>32</span> 
<span class='Keyword'>static void 
</span><a name="LN1804"></a><span class='Declare_Function'>preparedStatementName</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>file</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1804"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='String'>"P%d_%d"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1804"><span class='Ref_to_Parameter'>file</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1804"><span class='Ref_to_Parameter'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1810"></a><span class='Declare_Function'>commandFailed</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>message</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>            <span class='String'>"client %d aborted in command %d of script %d; %s\n"</span><span class='Delimiter'>, 
</span>            <a href="pgbench.c.html#LN1810"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1810"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN315"><span class='Ref_to_Member'>command</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1810"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1810"><span class='Ref_to_Parameter'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* return a script number with a weighted choice. */ 
</span><span class='Keyword'>static int 
</span><a name="LN1819"></a><span class='Declare_Function'>chooseScript</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1821"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1822"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>w</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN1822"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN625"><span class='Ref_to_Func'>getrand</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1819"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN397"><span class='Ref_to_Global_Var'>total_weight</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN1822"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>-= </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1821"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN389"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1822"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgbench.c.html#LN1821"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Send a SQL command, using the chosen querymode */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1838"></a><span class='Declare_Function'>sendCommand</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>command</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1840"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN372"><span class='Ref_to_Global_Var'>querymode</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN366"><span class='Ref_to_EnumConst'>QUERY_SIMPLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1844"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sql</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN1844"><span class='Ref_To_Local'>sql</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN1844"><span class='Ref_To_Local'>sql</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1182"><span class='Ref_to_Func'>assignVariables</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1844"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"client %d sending %s\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1844"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN1840"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN401"><span class='Ref_to_Proto'>PQsendQuery</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1844"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1844"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN372"><span class='Ref_to_Global_Var'>querymode</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN367"><span class='Ref_to_EnumConst'>QUERY_EXTENDED</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1856"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>sql</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span><a name="LN1857"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>params</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN362"><span class='Ref_to_Const'>MAX_ARGS</span></a><span class='Delimiter'>]; 
</span> 
        <a href="pgbench.c.html#LN1218"><span class='Ref_to_Func'>getQueryParams</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>command</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1857"><span class='Ref_To_Local'>params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"client %d sending %s\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1856"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN1840"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN402"><span class='Ref_to_Proto'>PQsendQueryParams</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1856"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1857"><span class='Ref_To_Local'>params</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN372"><span class='Ref_to_Global_Var'>querymode</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN368"><span class='Ref_to_EnumConst'>QUERY_PREPARED</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1868"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>name</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1802"><span class='Ref_to_Const'>MAX_PREPARE_NAME</span></a><span class='Delimiter'>]; 
</span><a name="LN1869"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>params</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN362"><span class='Ref_to_Const'>MAX_ARGS</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN328"><span class='Ref_to_Member'>prepared</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1873"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN1874"></a>            <a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a>   <span class='Operator'>**</span><span class='Declare_Local'>commands</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1873"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1874"><span class='Ref_To_Local'>commands</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1873"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN1873"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1878"></a>                <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1879"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>name</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1802"><span class='Ref_to_Const'>MAX_PREPARE_NAME</span></a><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1874"><span class='Ref_To_Local'>commands</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1873"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN379"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="pgbench.c.html#LN360"><span class='Ref_to_Const'>SQL_COMMAND</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN1803"><span class='Ref_to_Func'>preparedStatementName</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1879"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1873"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN1878"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN389"><span class='Ref_to_Proto'>PQprepare</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1879"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, 
</span>                          <a href="pgbench.c.html#LN1874"><span class='Ref_To_Local'>commands</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1873"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="pgbench.c.html#LN1874"><span class='Ref_To_Local'>commands</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1873"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1878"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1878"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN328"><span class='Ref_to_Member'>prepared</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !st-&GT;prepared[st-&GT;use... &raquo; </span> 
 
        <a href="pgbench.c.html#LN1218"><span class='Ref_to_Func'>getQueryParams</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>command</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1869"><span class='Ref_To_Local'>params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN1803"><span class='Ref_to_Func'>preparedStatementName</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1868"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN315"><span class='Ref_to_Member'>command</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"client %d sending %s\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1868"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN1840"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN413"><span class='Ref_to_Proto'>PQsendQueryPrepared</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1868"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                <a href="pgbench.c.html#LN1869"><span class='Ref_To_Local'>params</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if querymode==QUERY_PREP... &raquo; </span> 
    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* unknown sql mode */ 
</span>        <a href="pgbench.c.html#LN1840"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1840"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"client %d could not send %s\n"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN1838"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN332"><span class='Ref_to_Member'>ecnt</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end sendCommand &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse the argument to a \sleep command, and return the requested amount 
 * of delay, in microseconds.  Returns true on success, false on error. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1921"></a><span class='Declare_Function'>evaluateSleep</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>argv</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>usecs</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1923"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN1924"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>usec</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN1921"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN1923"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN964"><span class='Ref_to_Func'>getVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1921"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1921"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: undefined variable \"%s\"\n"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN1921"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="pgbench.c.html#LN1921"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pgbench.c.html#LN1924"><span class='Ref_To_Local'>usec</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1923"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pgbench.c.html#LN1924"><span class='Ref_To_Local'>usec</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1921"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1921"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1921"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], </span><span class='String'>"ms"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pgbench.c.html#LN1924"><span class='Ref_To_Local'>usec</span></a> <span class='Operator'>*= </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1921"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], </span><span class='String'>"s"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pgbench.c.html#LN1924"><span class='Ref_To_Local'>usec</span></a> <span class='Operator'>*= </span><span class='Number'>1000000</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pgbench.c.html#LN1924"><span class='Ref_To_Local'>usec</span></a> <span class='Operator'>*= </span><span class='Number'>1000000</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="pgbench.c.html#LN1921"><span class='Ref_to_Parameter'>usecs</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1924"><span class='Ref_To_Local'>usec</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end evaluateSleep &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Advance the state machine of a connection, if possible. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1957"></a><span class='Declare_Function'>doCustom</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>agg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1959"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1960"></a>    <a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>command</span><span class='Delimiter'>; 
</span><a name="LN1961"></a>    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>now</span><span class='Delimiter'>; 
</span><a name="LN1962"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>end_tx_processed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1963"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>wait</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * gettimeofday() isn't free, so we get the current timestamp lazily the 
     * first time it's needed, and reuse the same value throughout this 
     * function after that.  This also ensures that e.g. the calculated 
     * latency reported in the log file and in the totals are the same. Zero 
     * means "not set yet".  Reset "now" when we execute shell commands or 
     * expressions, which might take a non-negligible amount of time, though. 
     */ 
</span>    <a href="../../include/portability/instr_time.h.html#LN86"><span class='Ref_to_Macro'>INSTR_TIME_SET_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Loop in the state machine, until we have to wait for a result from the 
     * server (or have to sleep, for throttling or for \sleep). 
     * 
     * Note: In the switch-statement below, 'break' will loop back here, 
     * meaning "continue in the state machine".  Return is used to return to 
     * the caller. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Select transaction to run. 
                 */ 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN248"><span class='Ref_to_EnumConst'>CSTATE_CHOOSE_SCRIPT</span></a><span class='Operator'>: 
</span> 
                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1818"><span class='Ref_to_Func'>chooseScript</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"client %d executing script \"%s\"\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, 
</span>                            <a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN388"><span class='Ref_to_Member'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN256"><span class='Ref_to_EnumConst'>CSTATE_START_THROTTLE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN264"><span class='Ref_to_EnumConst'>CSTATE_START_TX</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Handle throttling once per transaction by sleeping. 
                 */ 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN256"><span class='Ref_to_EnumConst'>CSTATE_START_THROTTLE</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Generate a delay such that the series of delays will 
                 * approximate a Poisson distribution centered on the 
                 * throttle_delay time. 
                 * 
                 * If transactions are too slow or a given wait is shorter 
                 * than a transaction, the next transaction will start right 
                 * away. 
                 */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN1963"><span class='Ref_To_Local'>wait</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN724"><span class='Ref_to_Func'>getPoissonRand</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN345"><span class='Ref_to_Member'>throttle_trigger</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN1963"><span class='Ref_To_Local'>wait</span></a><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN323"><span class='Ref_to_Member'>txn_scheduled</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN345"><span class='Ref_to_Member'>throttle_trigger</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * stop client if next transaction is beyond pgbench end of 
                 * execution 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN323"><span class='Ref_to_Member'>txn_scheduled</span></a> <span class='Operator'>&GT; </span><a href="pgbench.c.html#LN99"><span class='Ref_to_Global_Var'>end_time</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN302"><span class='Ref_to_EnumConst'>CSTATE_FINISHED</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If this --latency-limit is used, and this slot is already 
                 * late so that the transaction will miss the latency limit 
                 * even if it completed immediately, we skip this time slot 
                 * and iterate till the next slot that isn't late yet. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2042"></a>                    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>now_us</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN84"><span class='Ref_to_Macro'>INSTR_TIME_IS_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN2042"><span class='Ref_To_Local'>now_us</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN345"><span class='Ref_to_Member'>throttle_trigger</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN2042"><span class='Ref_To_Local'>now_us</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="pgbench.c.html#LN454"><span class='Ref_to_Proto'>processXactStats</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>agg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* next rendez-vous */ 
</span>                        <a href="pgbench.c.html#LN1963"><span class='Ref_To_Local'>wait</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN724"><span class='Ref_to_Func'>getPoissonRand</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN345"><span class='Ref_to_Member'>throttle_trigger</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN1963"><span class='Ref_To_Local'>wait</span></a><span class='Delimiter'>; 
</span>                        <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN323"><span class='Ref_to_Member'>txn_scheduled</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN345"><span class='Ref_to_Member'>throttle_trigger</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN257"><span class='Ref_to_EnumConst'>CSTATE_THROTTLE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"client %d throttling "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" us\n"</span><span class='Delimiter'>, 
</span>                            <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1963"><span class='Ref_To_Local'>wait</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Wait until it's time to start next transaction. 
                 */ 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN257"><span class='Ref_to_EnumConst'>CSTATE_THROTTLE</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN84"><span class='Ref_to_Macro'>INSTR_TIME_IS_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN323"><span class='Ref_to_Member'>txn_scheduled</span></a><span class='Parentheses'>)</span> 
                    <span class='Control'>return</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Still sleeping, nothing to do here */ 
</span> 
                <span class='Comment_Multi_Line'>/* Else done sleeping, start the transaction */ 
</span>                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN264"><span class='Ref_to_EnumConst'>CSTATE_START_TX</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Start new transaction */ 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN264"><span class='Ref_to_EnumConst'>CSTATE_START_TX</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Establish connection on first call, or if is_connect is 
                 * true. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2085"></a>                    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>start</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN84"><span class='Ref_to_Macro'>INSTR_TIME_IS_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN2085"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN846"><span class='Ref_to_Func'>doConnect</span></a><span class='Parentheses'>())</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"client %d aborted while establishing connection\n"</span><span class='Delimiter'>, 
</span>                                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/portability/instr_time.h.html#LN114"><span class='Ref_to_Macro'>INSTR_TIME_ACCUM_DIFF</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN350"><span class='Ref_to_Member'>conn_time</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2085"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Reset session-local state */ 
</span>                    memset<span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN328"><span class='Ref_to_Member'>prepared</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN328"><span class='Ref_to_Member'>prepared</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if st-&GT;con==NULL &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * Record transaction start time under logging, progress or 
                 * throttling. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN166"><span class='Ref_to_Global_Var'>use_log</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN171"><span class='Ref_to_Global_Var'>progress</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a> <span class='Operator'>|| 
</span>                    <a href="pgbench.c.html#LN170"><span class='Ref_to_Global_Var'>per_script_stats</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN84"><span class='Ref_to_Macro'>INSTR_TIME_IS_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN325"><span class='Ref_to_Member'>txn_begin</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * When not throttling, this is also the transaction's 
                     * scheduled start time. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a><span class='Parentheses'>) 
</span>                        <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN323"><span class='Ref_to_Member'>txn_scheduled</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* Begin with the first command */ 
</span>                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN315"><span class='Ref_to_Member'>command</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN283"><span class='Ref_to_EnumConst'>CSTATE_START_COMMAND</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Send a command to server (or execute a meta-command) 
                 */ 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN283"><span class='Ref_to_EnumConst'>CSTATE_START_COMMAND</span></a><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN315"><span class='Ref_to_Member'>command</span></a><span class='Delimiter'>]; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we reached the end of the script, move to end-of-xact 
                 * processing. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN295"><span class='Ref_to_EnumConst'>CSTATE_END_TX</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Record statement start time if per-command latencies are 
                 * requested 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN176"><span class='Ref_to_Global_Var'>is_latencies</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN84"><span class='Ref_to_Macro'>INSTR_TIME_IS_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN326"><span class='Ref_to_Member'>stmt_begin</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN379"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN360"><span class='Ref_to_Const'>SQL_COMMAND</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1837"><span class='Ref_to_Func'>sendCommand</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Failed. Stay in CSTATE_START_COMMAND state, to 
                         * retry. ??? What the point or retrying? Should 
                         * rather abort? 
                         */ 
</span>                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN284"><span class='Ref_to_EnumConst'>CSTATE_WAIT_RESULT</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN379"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN361"><span class='Ref_to_Const'>META_COMMAND</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2171"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>argc</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a><span class='Delimiter'>, 
</span><a name="LN2172"></a>                                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2173"></a>                    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>argv</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"client %d executing \\%s"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2172"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2172"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN2171"><span class='Ref_To_Local'>argc</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2172"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>" %s"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN2172"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"sleep"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * A \sleep doesn't execute anything, we just get the 
                         * delay from the argument, and enter the CSTATE_SLEEP 
                         * state.  (The per-command latency will be recorded 
                         * in CSTATE_SLEEP state, not here, after the delay 
                         * has elapsed.) 
                         */ 
</span><a name="LN2192"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>usec</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1920"><span class='Ref_to_Func'>evaluateSleep</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2171"><span class='Ref_To_Local'>argc</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN2192"><span class='Ref_To_Local'>usec</span></a><span class='Parentheses'>))</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="pgbench.c.html#LN1809"><span class='Ref_to_Func'>commandFailed</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><span class='String'>"execution of meta-command 'sleep' failed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN84"><span class='Ref_to_Macro'>INSTR_TIME_IS_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                            <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN324"><span class='Ref_to_Member'>sleep_until</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="pgbench.c.html#LN2192"><span class='Ref_To_Local'>usec</span></a><span class='Delimiter'>; 
</span>                        <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN285"><span class='Ref_to_EnumConst'>CSTATE_SLEEP</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_strcasecmp(argv[0]... &raquo; </span> 
                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"set"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span><a name="LN2211"></a>                            <a href="pgbench.h.html#LN84"><span class='Ref_to_Struct'>PgBenchExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN382"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span><a name="LN2212"></a>                            <a href="pgbench.h.html#LN40"><span class='Ref_to_Typedef'>PgBenchValue</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN451"><span class='Ref_to_Proto'>evaluateExpr</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2211"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN2212"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
                            <span class='Delimiter'>{ 
</span>                                <a href="pgbench.c.html#LN1809"><span class='Ref_to_Func'>commandFailed</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><span class='String'>"evaluation of meta-command 'set' failed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span> 
                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1111"><span class='Ref_to_Func'>putVariableNumber</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pgbench.c.html#LN2212"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
                            <span class='Delimiter'>{ 
</span>                                <a href="pgbench.c.html#LN1809"><span class='Ref_to_Func'>commandFailed</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><span class='String'>"assignment of meta-command 'set' failed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"setshell"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span><a name="LN2230"></a>                            <span class='Keyword'>bool</span>        <span class='Declare_Local'>ret</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1698"><span class='Ref_to_Func'>runShellCommand</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2171"><span class='Ref_To_Local'>argc</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN188"><span class='Ref_to_Global_Var'>timer_exceeded</span></a><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* timeout */ 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN302"><span class='Ref_to_EnumConst'>CSTATE_FINISHED</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN2230"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* on error */ 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="pgbench.c.html#LN1809"><span class='Ref_to_Func'>commandFailed</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><span class='String'>"execution of meta-command 'setshell' failed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>else</span> 
                            <span class='Delimiter'>{ 
</span>                                <span class='Comment_Multi_Line'>/* succeeded */ 
</span>                            <span class='Delimiter'>} 
</span>                        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_strcasecmp(argv[0]... &raquo; </span> 
                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"shell"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span><a name="LN2250"></a>                            <span class='Keyword'>bool</span>        <span class='Declare_Local'>ret</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN1698"><span class='Ref_to_Func'>runShellCommand</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2173"><span class='Ref_To_Local'>argv</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2171"><span class='Ref_To_Local'>argc</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN188"><span class='Ref_to_Global_Var'>timer_exceeded</span></a><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* timeout */ 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN302"><span class='Ref_to_EnumConst'>CSTATE_FINISHED</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN2250"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* on error */ 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="pgbench.c.html#LN1809"><span class='Ref_to_Func'>commandFailed</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><span class='String'>"execution of meta-command 'shell' failed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>else</span> 
                            <span class='Delimiter'>{ 
</span>                                <span class='Comment_Multi_Line'>/* succeeded */ 
</span>                            <span class='Delimiter'>} 
</span>                        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_strcasecmp(argv[0]... &raquo; </span> 
 
                        <span class='Comment_Multi_Line'>/* 
                         * executing the expression or shell command might 
                         * take a non-negligible amount of time, so reset 
                         * 'now' 
                         */ 
</span>                        <a href="../../include/portability/instr_time.h.html#LN86"><span class='Ref_to_Macro'>INSTR_TIME_SET_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN286"><span class='Ref_to_EnumConst'>CSTATE_END_COMMAND</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if command-&GT;type==META_C... &raquo; </span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Wait for the current SQL command to complete 
                 */ 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN284"><span class='Ref_to_EnumConst'>CSTATE_WAIT_RESULT</span></a><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN315"><span class='Ref_to_Member'>command</span></a><span class='Delimiter'>]; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"client %d receiving\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN425"><span class='Ref_to_Proto'>PQconsumeInput</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{</span>               <span class='Comment_Single_Line'>/* there's something wrong */ 
</span>                    <a href="pgbench.c.html#LN1809"><span class='Ref_to_Func'>commandFailed</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><span class='String'>"perhaps the backend died while processing"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN424"><span class='Ref_to_Proto'>PQisBusy</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* don't have the whole result yet */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Read and discard the query result; 
                 */ 
</span>                <a href="pgbench.c.html#LN1959"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1959"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN83"><span class='Ref_to_EnumConst'>PGRES_EMPTY_QUERY</span></a><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* OK */ 
</span>                        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1959"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pgbench.c.html#LN915"><span class='Ref_to_Func'>discard_response</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN286"><span class='Ref_to_EnumConst'>CSTATE_END_COMMAND</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <a href="pgbench.c.html#LN1809"><span class='Ref_to_Func'>commandFailed</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1959"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Wait until sleep is done. This state is entered after a 
                 * \sleep metacommand. The behavior is similar to 
                 * CSTATE_THROTTLE, but proceeds to CSTATE_START_COMMAND 
                 * instead of CSTATE_START_TX. 
                 */ 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN285"><span class='Ref_to_EnumConst'>CSTATE_SLEEP</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN84"><span class='Ref_to_Macro'>INSTR_TIME_IS_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN324"><span class='Ref_to_Member'>sleep_until</span></a><span class='Parentheses'>)</span> 
                    <span class='Control'>return</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Still sleeping, nothing to do here */ 
</span>                <span class='Comment_Multi_Line'>/* Else done sleeping. */ 
</span>                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN286"><span class='Ref_to_EnumConst'>CSTATE_END_COMMAND</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * End of command: record stats and proceed to next command. 
                 */ 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN286"><span class='Ref_to_EnumConst'>CSTATE_END_COMMAND</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * command completed: accumulate per-command execution times 
                 * in thread-local data structure, if per-command latencies 
                 * are requested. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN176"><span class='Ref_to_Global_Var'>is_latencies</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN84"><span class='Ref_to_Macro'>INSTR_TIME_IS_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* XXX could use a mutex here, but we choose not to */ 
</span>                    <a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN315"><span class='Ref_to_Member'>command</span></a><span class='Delimiter'>]; 
</span>                    <a href="pgbench.c.html#LN751"><span class='Ref_to_Func'>addToSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN1960"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN383"><span class='Ref_to_Member'>stats</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/portability/instr_time.h.html#LN131"><span class='Ref_to_Macro'>INSTR_TIME_GET_DOUBLE</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>) </span><span class='Operator'>- 
</span>                                     <a href="../../include/portability/instr_time.h.html#LN131"><span class='Ref_to_Macro'>INSTR_TIME_GET_DOUBLE</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN326"><span class='Ref_to_Member'>stmt_begin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* Go ahead with next command */ 
</span>                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN315"><span class='Ref_to_Member'>command</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN283"><span class='Ref_to_EnumConst'>CSTATE_START_COMMAND</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * End of transaction. 
                 */ 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN295"><span class='Ref_to_EnumConst'>CSTATE_END_TX</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * transaction finished: calculate latency and log the 
                 * transaction 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN171"><span class='Ref_to_Global_Var'>progress</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a> <span class='Operator'>|| 
</span>                    <a href="pgbench.c.html#LN170"><span class='Ref_to_Global_Var'>per_script_stats</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN166"><span class='Ref_to_Global_Var'>use_log</span></a><span class='Parentheses'>) 
</span>                    <a href="pgbench.c.html#LN454"><span class='Ref_to_Proto'>processXactStats</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>agg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN175"><span class='Ref_to_Global_Var'>is_connect</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <a href="../../include/portability/instr_time.h.html#LN86"><span class='Ref_to_Macro'>INSTR_TIME_SET_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1961"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Operator'>++</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN331"><span class='Ref_to_Member'>cnt</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN331"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN97"><span class='Ref_to_Global_Var'>nxacts</span></a> <span class='Operator'>&& </span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="pgbench.c.html#LN188"><span class='Ref_to_Global_Var'>timer_exceeded</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* exit success */ 
</span>                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN302"><span class='Ref_to_EnumConst'>CSTATE_FINISHED</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * No transaction is underway anymore. 
                 */ 
</span>                <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN248"><span class='Ref_to_EnumConst'>CSTATE_CHOOSE_SCRIPT</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we paced through all commands in the script in this 
                 * loop, without returning to the caller even once, do it now. 
                 * This gives the thread a chance to process other 
                 * connections, and to do progress reporting.  This can 
                 * currently only happen if the script consists entirely of 
                 * meta-commands. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1962"><span class='Ref_To_Local'>end_tx_processed</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pgbench.c.html#LN1962"><span class='Ref_To_Local'>end_tx_processed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Final states.  Close the connection if it's still open. 
                 */ 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="pgbench.c.html#LN302"><span class='Ref_to_EnumConst'>CSTATE_FINISHED</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN1957"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch st-&GT;state &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end doCustom &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Print log entry after completing one transaction. 
 * 
 * We print Unix-epoch timestamps in the log, so that entries can be 
 * correlated against other logs.  On some platforms this could be obtained 
 * from the instr_time reading the caller has, but rather than get entangled 
 * with that, we just eat the cost of an extra syscall in all cases. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2436"></a><span class='Declare_Function'>doLog</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, 
</span><a name="LN2437"></a>      <a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>agg</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>skipped</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>latency</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>lag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2439"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>logfile</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN2436"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN346"><span class='Ref_to_Member'>logfile</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN166"><span class='Ref_to_Global_Var'>use_log</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Skip the log entry if sampling is enabled and this row doesn't belong 
     * to the random sample. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN126"><span class='Ref_to_Global_Var'>sample_rate</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="../../port/erand48.c.html#LN77"><span class='Ref_to_Func'>pg_erand48</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2436"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN344"><span class='Ref_to_Member'>random_state</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="pgbench.c.html#LN126"><span class='Ref_to_Global_Var'>sample_rate</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* should we aggregate the results or not? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Loop until we reach the interval of the current moment, and print 
         * any empty intervals in between (this may happen with very low tps, 
         * e.g. --rate=0.1). 
         */ 
</span><a name="LN2459"></a>        time_t      <span class='Declare_Local'>now</span> <span class='Operator'>= </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN230"><span class='Ref_to_Member'>start_time</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a> <span class='Operator'>&LT;= </span><a href="pgbench.c.html#LN2459"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* print aggregated report to logfile */ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2439"><span class='Ref_To_Local'>logfile</span></a><span class='Delimiter'>, </span><span class='String'>"%ld "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" %.0f %.0f %.0f %.0f"</span><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN230"><span class='Ref_to_Member'>start_time</span></a><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN221"><span class='Ref_to_Member'>sum2</span></a><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN218"><span class='Ref_to_Member'>min</span></a><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN219"><span class='Ref_to_Member'>max</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2439"><span class='Ref_To_Local'>logfile</span></a><span class='Delimiter'>, </span><span class='String'>" %.0f %.0f %.0f %.0f"</span><span class='Delimiter'>, 
</span>                        <a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a><span class='Delimiter'>, 
</span>                        <a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN221"><span class='Ref_to_Member'>sum2</span></a><span class='Delimiter'>, 
</span>                        <a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN218"><span class='Ref_to_Member'>min</span></a><span class='Delimiter'>, 
</span>                        <a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN219"><span class='Ref_to_Member'>max</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2439"><span class='Ref_To_Local'>logfile</span></a><span class='Delimiter'>, </span><span class='String'>" "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            fputc<span class='Parentheses'>(</span><span class='String'>'\n'</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2439"><span class='Ref_To_Local'>logfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* reset data and move to next interval */ 
</span>            <a href="pgbench.c.html#LN782"><span class='Ref_to_Func'>initStats</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN230"><span class='Ref_to_Member'>start_time</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while agg-&GT;start_time+agg_i... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* accumulate the current transaction */ 
</span>        <a href="pgbench.c.html#LN795"><span class='Ref_to_Func'>accumStats</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>agg</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>skipped</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>latency</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>lag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if agg_interval&GT;0 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* no, print raw transactions */ 
</span><a name="LN2493"></a>        <span class='Control'>struct</span> timeval <span class='Declare_Local'>tv</span><span class='Delimiter'>; 
</span> 
        <a href="../../port/gettimeofday.c.html#LN103"><span class='Ref_to_Func'>gettimeofday</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN2493"><span class='Ref_To_Local'>tv</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>skipped</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2439"><span class='Ref_To_Local'>logfile</span></a><span class='Delimiter'>, </span><span class='String'>"%d "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" skipped %d %ld %ld"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN2436"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2436"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN331"><span class='Ref_to_Member'>cnt</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2436"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN2493"><span class='Ref_To_Local'>tv</span></a><span class='Operator'>.</span>tv_sec<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN2493"><span class='Ref_To_Local'>tv</span></a><span class='Operator'>.</span>tv_usec<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2439"><span class='Ref_To_Local'>logfile</span></a><span class='Delimiter'>, </span><span class='String'>"%d "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" %.0f %d %ld %ld"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN2436"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2436"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN331"><span class='Ref_to_Member'>cnt</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>latency</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2436"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN2493"><span class='Ref_To_Local'>tv</span></a><span class='Operator'>.</span>tv_sec<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN2493"><span class='Ref_To_Local'>tv</span></a><span class='Operator'>.</span>tv_usec<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2439"><span class='Ref_To_Local'>logfile</span></a><span class='Delimiter'>, </span><span class='String'>" %.0f"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2437"><span class='Ref_to_Parameter'>lag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fputc<span class='Parentheses'>(</span><span class='String'>'\n'</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2439"><span class='Ref_To_Local'>logfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end doLog &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Accumulate and report statistics at end of a transaction. 
 * 
 * (This is also called when a transaction is late and thus skipped.) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2516"></a><span class='Declare_Function'>processXactStats</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>now</span><span class='Delimiter'>, 
</span><a name="LN2517"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>skipped</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>agg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2519"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>latency</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN2520"></a>                <span class='Declare_Local'>lag</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>!</span><a href="pgbench.c.html#LN2517"><span class='Ref_to_Parameter'>skipped</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../include/portability/instr_time.h.html#LN84"><span class='Ref_to_Macro'>INSTR_TIME_IS_ZERO</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>now</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN2517"><span class='Ref_to_Parameter'>skipped</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* compute latency & lag */ 
</span>        <a href="pgbench.c.html#LN2519"><span class='Ref_To_Local'>latency</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>now</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN323"><span class='Ref_to_Member'>txn_scheduled</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN2520"><span class='Ref_To_Local'>lag</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN325"><span class='Ref_to_Member'>txn_begin</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN323"><span class='Ref_to_Member'>txn_scheduled</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN171"><span class='Ref_to_Global_Var'>progress</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN795"><span class='Ref_to_Func'>accumStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2517"><span class='Ref_to_Parameter'>skipped</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2519"><span class='Ref_To_Local'>latency</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2520"><span class='Ref_To_Local'>lag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* count transactions over the latency limit, if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a> <span class='Operator'>&& </span><a href="pgbench.c.html#LN2519"><span class='Ref_To_Local'>latency</span></a> <span class='Operator'>&GT; </span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN352"><span class='Ref_to_Member'>latency_late</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN166"><span class='Ref_to_Global_Var'>use_log</span></a><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN452"><span class='Ref_to_Proto'>doLog</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2517"><span class='Ref_to_Parameter'>agg</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2517"><span class='Ref_to_Parameter'>skipped</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2519"><span class='Ref_To_Local'>latency</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2520"><span class='Ref_To_Local'>lag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XXX could use a mutex here, but we choose not to */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN170"><span class='Ref_to_Global_Var'>per_script_stats</span></a><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN795"><span class='Ref_to_Func'>accumStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN2516"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN314"><span class='Ref_to_Member'>use_file</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN391"><span class='Ref_to_Member'>stats</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2517"><span class='Ref_to_Parameter'>skipped</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2519"><span class='Ref_To_Local'>latency</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2520"><span class='Ref_To_Local'>lag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end processXactStats &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* discard connections */ 
</span><span class='Keyword'>static void 
</span><a name="LN2554"></a><span class='Declare_Function'>disconnect_all</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>length</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2556"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2556"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2556"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN2554"><span class='Ref_to_Parameter'>length</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2556"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2554"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN2556"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2554"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN2556"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN2554"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN2556"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* create tables and setup data */ 
</span><span class='Keyword'>static void 
</span><a name="LN2570"></a><span class='Declare_Function'>init</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_no_vacuum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Comment_Multi_Line'>/* 
 * The scale factor at/beyond which 32-bit integers are insufficient for 
 * storing TPC-B account IDs. 
 * 
 * Although the actual threshold is 21474, we use 20000 because it is easier to 
 * document and remember, and isn't that far away from the real threshold. 
 */ 
</span><a name="LN2579"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>SCALE_32BIT_THRESHOLD</span> <span class='Number'>20000</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Note: TPC-B requires at least 100 bytes per row, and the "filler" 
     * fields in these table declarations were intended to comply with that. 
     * The pgbench_accounts table complies with that because the "filler" 
     * column is set to blank-padded empty string. But for all other tables 
     * the columns default to NULL and so don't actually take any space.  We 
     * could fix that by giving them non-null default values.  However, that 
     * would completely break comparability of pgbench results with prior 
     * versions. Since pgbench has never pretended to be fully TPC-B compliant 
     * anyway, we stick with the historical behavior. 
     */ 
</span><a name="LN2592"></a>    <span class='Control'>struct</span> <span class='Declare_Local'>ddlinfo</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2594"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>table</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* table name */ 
</span><a name="LN2595"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>smcols</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* column decls if accountIDs are 32 bits */ 
</span><a name="LN2596"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>bigcols</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* column decls if accountIDs are 64 bits */ 
</span><a name="LN2597"></a>        <span class='Keyword'>int</span>         <span class='Declare_Member'>declare_fillfactor</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}; 
</span><a name="LN2599"></a>    <span class='Keyword'>static const </span><span class='Control'>struct</span> <a href="pgbench.c.html#LN2592"><span class='Ref_to_Struct'>ddlinfo</span></a> <span class='Declare_Local'>DDLs</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='String'>"pgbench_history"</span><span class='Delimiter'>, 
</span>            <span class='String'>"tid int,bid int,aid    int,delta int,mtime timestamp,filler char(22)"</span><span class='Delimiter'>, 
</span>            <span class='String'>"tid int,bid int,aid bigint,delta int,mtime timestamp,filler char(22)"</span><span class='Delimiter'>, 
</span>            <span class='Number'>0</span> 
        <span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{ 
</span>            <span class='String'>"pgbench_tellers"</span><span class='Delimiter'>, 
</span>            <span class='String'>"tid int not null,bid int,tbalance int,filler char(84)"</span><span class='Delimiter'>, 
</span>            <span class='String'>"tid int not null,bid int,tbalance int,filler char(84)"</span><span class='Delimiter'>, 
</span>            <span class='Number'>1</span> 
        <span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{ 
</span>            <span class='String'>"pgbench_accounts"</span><span class='Delimiter'>, 
</span>            <span class='String'>"aid    int not null,bid int,abalance int,filler char(84)"</span><span class='Delimiter'>, 
</span>            <span class='String'>"aid bigint not null,bid int,abalance int,filler char(84)"</span><span class='Delimiter'>, 
</span>            <span class='Number'>1</span> 
        <span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{ 
</span>            <span class='String'>"pgbench_branches"</span><span class='Delimiter'>, 
</span>            <span class='String'>"bid int not null,bbalance int,filler char(88)"</span><span class='Delimiter'>, 
</span>            <span class='String'>"bid int not null,bbalance int,filler char(88)"</span><span class='Delimiter'>, 
</span>            <span class='Number'>1</span> 
        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span><a name="LN2625"></a>    <span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Local'>DDLINDEXes</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='String'>"alter table pgbench_branches add primary key (bid)"</span><span class='Delimiter'>, 
</span>        <span class='String'>"alter table pgbench_tellers add primary key (tid)"</span><span class='Delimiter'>, 
</span>        <span class='String'>"alter table pgbench_accounts add primary key (aid)"</span> 
    <span class='Delimiter'>}; 
</span><a name="LN2630"></a>    <span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Local'>DDLKEYs</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='String'>"alter table pgbench_tellers add foreign key (bid) references pgbench_branches"</span><span class='Delimiter'>, 
</span>        <span class='String'>"alter table pgbench_accounts add foreign key (bid) references pgbench_branches"</span><span class='Delimiter'>, 
</span>        <span class='String'>"alter table pgbench_history add foreign key (bid) references pgbench_branches"</span><span class='Delimiter'>, 
</span>        <span class='String'>"alter table pgbench_history add foreign key (tid) references pgbench_tellers"</span><span class='Delimiter'>, 
</span>        <span class='String'>"alter table pgbench_history add foreign key (aid) references pgbench_accounts"</span> 
    <span class='Delimiter'>}; 
</span> 
<a name="LN2638"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>con</span><span class='Delimiter'>; 
</span><a name="LN2639"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2640"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sql</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span><a name="LN2641"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2642"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>k</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* used to track elapsed time and estimate of the remaining time */ 
</span><a name="LN2645"></a>    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>start</span><span class='Delimiter'>, 
</span><a name="LN2646"></a>                <span class='Declare_Local'>diff</span><span class='Delimiter'>; 
</span><a name="LN2647"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>elapsed_sec</span><span class='Delimiter'>, 
</span><a name="LN2648"></a>                <span class='Declare_Local'>remaining_sec</span><span class='Delimiter'>; 
</span><a name="LN2649"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>log_interval</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN846"><span class='Ref_to_Func'>doConnect</span></a><span class='Parentheses'>())</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN561"><span class='Ref_to_Macro'>lengthof</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2599"><span class='Ref_To_Local'>DDLs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2656"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>opts</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span><a name="LN2657"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>buffer</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span><a name="LN2658"></a>        <span class='Keyword'>const </span><span class='Control'>struct</span> <a href="pgbench.c.html#LN2592"><span class='Ref_to_Struct'>ddlinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ddl</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN2599"><span class='Ref_To_Local'>DDLs</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN2659"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>cols</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Remove old table, if it exists. */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2657"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2657"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"drop table if exists %s"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2658"><span class='Ref_To_Local'>ddl</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN2594"><span class='Ref_to_Member'>table</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2657"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Construct new create table statement. */ 
</span>        <a href="pgbench.c.html#LN2656"><span class='Ref_To_Local'>opts</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2658"><span class='Ref_To_Local'>ddl</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN2597"><span class='Ref_to_Member'>declare_fillfactor</span></a><span class='Parentheses'>) 
</span>            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2656"><span class='Ref_To_Local'>opts</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2656"><span class='Ref_To_Local'>opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2656"><span class='Ref_To_Local'>opts</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2656"><span class='Ref_To_Local'>opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='String'>" with (fillfactor=%d)"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN111"><span class='Ref_to_Global_Var'>fillfactor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN145"><span class='Ref_to_Global_Var'>tablespace</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2672"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>escape_tablespace</span><span class='Delimiter'>; 
</span> 
            <a href="pgbench.c.html#LN2672"><span class='Ref_To_Local'>escape_tablespace</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN525"><span class='Ref_to_Proto'>PQescapeIdentifier</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN145"><span class='Ref_to_Global_Var'>tablespace</span></a><span class='Delimiter'>, 
</span>                                                   strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN145"><span class='Ref_to_Global_Var'>tablespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2656"><span class='Ref_To_Local'>opts</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2656"><span class='Ref_To_Local'>opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2656"><span class='Ref_To_Local'>opts</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2656"><span class='Ref_To_Local'>opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='String'>" tablespace %s"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2672"><span class='Ref_To_Local'>escape_tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN504"><span class='Ref_to_Proto'>PQfreemem</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2672"><span class='Ref_To_Local'>escape_tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pgbench.c.html#LN2659"><span class='Ref_To_Local'>cols</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN164"><span class='Ref_to_Const'>SCALE_32BIT_THRESHOLD</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="pgbench.c.html#LN2658"><span class='Ref_To_Local'>ddl</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN2596"><span class='Ref_to_Member'>bigcols</span></a> <span class='Operator'>: </span><a href="pgbench.c.html#LN2658"><span class='Ref_To_Local'>ddl</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN2595"><span class='Ref_to_Member'>smcols</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2657"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2657"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"create%s table %s(%s)%s"</span><span class='Delimiter'>, 
</span>                 <a href="pgbench.c.html#LN121"><span class='Ref_to_Global_Var'>unlogged_tables</span></a> <span class='Operator'>? </span><span class='String'>" unlogged"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pgbench.c.html#LN2658"><span class='Ref_To_Local'>ddl</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN2594"><span class='Ref_to_Member'>table</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2659"><span class='Ref_To_Local'>cols</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2656"><span class='Ref_To_Local'>opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2657"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;lengthof(DDLs);... &raquo; </span> 
 
    <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"begin"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN152"><span class='Ref_to_Const'>nbranches</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* "filler" column defaults to NULL */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2640"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2640"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"insert into pgbench_branches(bid,bbalance) values(%d,0)"</span><span class='Delimiter'>, 
</span>                 <a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2640"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN154"><span class='Ref_to_Const'>ntellers</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* "filler" column defaults to NULL */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2640"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2640"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <span class='String'>"insert into pgbench_tellers(tid,bid,tbalance) values (%d,%d,0)"</span><span class='Delimiter'>, 
</span>                 <a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN154"><span class='Ref_to_Const'>ntellers</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2640"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"commit"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * fill the pgbench_accounts table with some data 
     */ 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"creating tables...\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"begin"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"truncate pgbench_accounts"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN2639"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"copy pgbench_accounts from stdin"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2639"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN91"><span class='Ref_to_EnumConst'>PGRES_COPY_IN</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2639"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2645"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2642"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2642"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2642"><span class='Ref_To_Local'>k</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2732"></a>        <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>j</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN2642"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* "filler" column defaults to blank padded empty string */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2640"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2640"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>"\t"</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>"\t%d\t\n"</span><span class='Delimiter'>, 
</span>                 <a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2642"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN437"><span class='Ref_to_Proto'>PQputline</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2640"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"PQputline failed\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we want to stick with the original logging, print a message each 
         * 100k inserted rows. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>!</span><a href="pgbench.c.html#LN167"><span class='Ref_to_Global_Var'>use_quiet</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>% </span><span class='Number'>100000</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2646"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/portability/instr_time.h.html#LN102"><span class='Ref_to_Macro'>INSTR_TIME_SUBTRACT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2646"><span class='Ref_To_Local'>diff</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2645"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pgbench.c.html#LN2647"><span class='Ref_To_Local'>elapsed_sec</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN131"><span class='Ref_to_Macro'>INSTR_TIME_GET_DOUBLE</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2646"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN2648"><span class='Ref_To_Local'>remaining_sec</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN2647"><span class='Ref_To_Local'>elapsed_sec</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" of "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" tuples (%d%%) done (elapsed %.2f s, remaining %.2f s)\n"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>)</span> <a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Parentheses'>(((</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>* </span><span class='Number'>100</span><span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN2647"><span class='Ref_To_Local'>elapsed_sec</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2648"><span class='Ref_To_Local'>remaining_sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* let's not call the timing for each row, but only each 100 rows */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN167"><span class='Ref_to_Global_Var'>use_quiet</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>% </span><span class='Number'>100</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2646"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/portability/instr_time.h.html#LN102"><span class='Ref_to_Macro'>INSTR_TIME_SUBTRACT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2646"><span class='Ref_To_Local'>diff</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2645"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pgbench.c.html#LN2647"><span class='Ref_To_Local'>elapsed_sec</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN131"><span class='Ref_to_Macro'>INSTR_TIME_GET_DOUBLE</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2646"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN2648"><span class='Ref_To_Local'>remaining_sec</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN2647"><span class='Ref_To_Local'>elapsed_sec</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* have we reached the next interval (or end)? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2647"><span class='Ref_To_Local'>elapsed_sec</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN2649"><span class='Ref_To_Local'>log_interval</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN92"><span class='Ref_to_Const'>LOG_STEP_SECONDS</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" of "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" tuples (%d%%) done (elapsed %.2f s, remaining %.2f s)\n"</span><span class='Delimiter'>, 
</span>                        <a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>)</span> <a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Parentheses'>(((</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pgbench.c.html#LN2732"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>* </span><span class='Number'>100</span><span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN155"><span class='Ref_to_Const'>naccounts</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2647"><span class='Ref_To_Local'>elapsed_sec</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2648"><span class='Ref_To_Local'>remaining_sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* skip to the next interval */ 
</span>                <a href="pgbench.c.html#LN2649"><span class='Ref_To_Local'>log_interval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>ceil<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2647"><span class='Ref_To_Local'>elapsed_sec</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN92"><span class='Ref_to_Const'>LOG_STEP_SECONDS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for k=0;k&LT;(int64)naccount... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN437"><span class='Ref_to_Proto'>PQputline</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"\\.\n"</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"very last PQputline failed\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN440"><span class='Ref_to_Proto'>PQendcopy</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"PQendcopy failed\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"commit"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* vacuum */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN2570"><span class='Ref_to_Parameter'>is_no_vacuum</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"vacuum...\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"vacuum analyze pgbench_branches"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"vacuum analyze pgbench_tellers"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"vacuum analyze pgbench_accounts"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"vacuum analyze pgbench_history"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create indexes 
     */ 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"set primary keys...\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN561"><span class='Ref_to_Macro'>lengthof</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2625"><span class='Ref_To_Local'>DDLINDEXes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2811"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>buffer</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span> 
        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2811"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2625"><span class='Ref_To_Local'>DDLINDEXes</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2811"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN146"><span class='Ref_to_Global_Var'>index_tablespace</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2817"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>escape_tablespace</span><span class='Delimiter'>; 
</span> 
            <a href="pgbench.c.html#LN2817"><span class='Ref_To_Local'>escape_tablespace</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN525"><span class='Ref_to_Proto'>PQescapeIdentifier</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN146"><span class='Ref_to_Global_Var'>index_tablespace</span></a><span class='Delimiter'>, 
</span>                                                   strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN146"><span class='Ref_to_Global_Var'>index_tablespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2811"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2811"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2811"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2811"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='String'>" using index tablespace %s"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2817"><span class='Ref_To_Local'>escape_tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN504"><span class='Ref_to_Proto'>PQfreemem</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2817"><span class='Ref_To_Local'>escape_tablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2811"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create foreign keys 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN116"><span class='Ref_to_Global_Var'>foreign_keys</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"set foreign keys...\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN561"><span class='Ref_to_Macro'>lengthof</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2630"><span class='Ref_To_Local'>DDLKEYs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pgbench.c.html#LN816"><span class='Ref_to_Func'>executeStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2630"><span class='Ref_To_Local'>DDLKEYs</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN2641"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"done.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2638"><span class='Ref_To_Local'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end init &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse the raw sql and replace :param to $n. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2849"></a><span class='Declare_Function'>parseQuery</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>raw_sql</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2851"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sql</span><span class='Delimiter'>, 
</span><a name="LN2852"></a>               <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN2851"><span class='Ref_To_Local'>sql</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2849"><span class='Ref_to_Parameter'>raw_sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN2849"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN2852"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN2851"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN2852"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2852"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='String'>':'</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2860"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>var</span><span class='Delimiter'>[</span><span class='Number'>12</span><span class='Delimiter'>]; 
</span><a name="LN2861"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span><span class='Delimiter'>; 
</span><a name="LN2862"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>eaten</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN2861"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1141"><span class='Ref_to_Func'>parseVariable</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2852"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN2862"><span class='Ref_To_Local'>eaten</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2861"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN2852"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pgbench.c.html#LN2852"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2849"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN362"><span class='Ref_to_Const'>MAX_ARGS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"statement has too many arguments (maximum is %d): %s\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN362"><span class='Ref_to_Const'>MAX_ARGS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2849"><span class='Ref_to_Parameter'>raw_sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2861"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2860"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='String'>"$%d"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2849"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN2852"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN1162"><span class='Ref_to_Func'>replaceVariable</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN2851"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2852"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2862"><span class='Ref_To_Local'>eaten</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2860"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN2849"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN2849"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN2861"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN2849"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (p=strchr(p,':'))!=NU... &raquo; </span> 
 
    <a href="pgbench.c.html#LN2849"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN2851"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parseQuery &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Simple error-printing function, might be needed by lexer 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2896"></a><span class='Declare_Function'>pgbench_error</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2898"></a>    va_list     <span class='Declare_Local'>ap</span><span class='Delimiter'>; 
</span> 
    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2898"><span class='Ref_To_Local'>ap</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2896"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN171"><span class='Ref_to_Macro'>vfprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2896"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2898"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2898"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * syntax error while parsing a script (in practice, while parsing a 
 * backslash command, because we don't detect syntax errors in SQL) 
 * 
 * source: source of script (filename or builtin-script ID) 
 * lineno: line number within script (count from 1) 
 * line: whole line of backslash command, if available 
 * command: backslash command name, if available 
 * msg: the actual error message 
 * more: optional extra message 
 * column: zero-based column number, or -1 if unknown 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2919"></a><span class='Declare_Function'>syntax_error</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>source</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lineno</span><span class='Delimiter'>, 
</span><a name="LN2920"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>line</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>command</span><span class='Delimiter'>, 
</span><a name="LN2921"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>more</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>column</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s:%d: %s"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2919"><span class='Ref_to_Parameter'>source</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2919"><span class='Ref_to_Parameter'>lineno</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2921"><span class='Ref_to_Parameter'>msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2921"><span class='Ref_to_Parameter'>more</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>" (%s)"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2921"><span class='Ref_to_Parameter'>more</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2921"><span class='Ref_to_Parameter'>column</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN2920"><span class='Ref_to_Parameter'>line</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>" at column %d"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2921"><span class='Ref_to_Parameter'>column</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2920"><span class='Ref_to_Parameter'>command</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>" in command \"%s\""</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2920"><span class='Ref_to_Parameter'>command</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2920"><span class='Ref_to_Parameter'>line</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2920"><span class='Ref_to_Parameter'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2921"><span class='Ref_to_Parameter'>column</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2936"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2936"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2936"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN2921"><span class='Ref_to_Parameter'>column</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN2936"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>" "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"^ error found here\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end syntax_error &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse a SQL command; return a Command struct, or NULL if it's a comment 
 * 
 * On entry, psqlscan.l has collected the command into "buf", so we don't 
 * really need to do much here except check for comment and set up a 
 * Command struct. 
 */ 
</span><span class='Keyword'>static </span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>* 
</span><a name="LN2954"></a><span class='Declare_Function'>process_sql_command</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2956"></a>    <a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>my_command</span><span class='Delimiter'>; 
</span><a name="LN2957"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN2958"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nlpos</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip any leading whitespace, as well as "--" style comments */ 
</span>    <a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN2954"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
            <a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='String'>"--"</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If there's nothing but whitespace and comments, we're done */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate and initialize Command structure */ 
</span>    <a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN378"><span class='Ref_to_Member'>command_num</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN396"><span class='Ref_to_Global_Var'>num_commands</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN379"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN360"><span class='Ref_to_Const'>SQL_COMMAND</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN742"><span class='Ref_to_Func'>initSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN383"><span class='Ref_to_Member'>stats</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If SQL command is multi-line, we only want to save the first line as 
     * the "line" label. 
     */ 
</span>    <a href="pgbench.c.html#LN2958"><span class='Ref_To_Local'>nlpos</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN2958"><span class='Ref_To_Local'>nlpos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2958"><span class='Ref_To_Local'>nlpos</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2958"><span class='Ref_To_Local'>nlpos</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN2958"><span class='Ref_To_Local'>nlpos</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN372"><span class='Ref_to_Global_Var'>querymode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="pgbench.c.html#LN366"><span class='Ref_to_EnumConst'>QUERY_SIMPLE</span></a><span class='Operator'>: 
</span>            <a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pgbench.c.html#LN367"><span class='Ref_to_EnumConst'>QUERY_EXTENDED</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pgbench.c.html#LN368"><span class='Ref_to_EnumConst'>QUERY_PREPARED</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN2848"><span class='Ref_to_Func'>parseQuery</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN2957"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pgbench.c.html#LN2956"><span class='Ref_To_Local'>my_command</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end process_sql_command &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse a backslash command; return a Command struct, or NULL if comment 
 * 
 * At call, we have scanned only the initial backslash. 
 */ 
</span><span class='Keyword'>static </span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>* 
</span><a name="LN3026"></a><span class='Declare_Function'>process_backslash_command</span><span class='Parentheses'>(</span><a href="../../include/fe_utils/psqlscan.h.html#LN26"><span class='Ref_to_Typedef'>PsqlScanState</span></a> <span class='Declare_Parameter'>sstate</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3028"></a>    <a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>my_command</span><span class='Delimiter'>; 
</span><a name="LN3029"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>word_buf</span><span class='Delimiter'>; 
</span><a name="LN3030"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>word_offset</span><span class='Delimiter'>; 
</span><a name="LN3031"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>offsets</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN362"><span class='Ref_to_Const'>MAX_ARGS</span></a><span class='Delimiter'>];</span>      <span class='Comment_Single_Line'>/* offsets of argument words */ 
</span><a name="LN3032"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>start_offset</span><span class='Delimiter'>, 
</span><a name="LN3033"></a>                <span class='Declare_Local'>end_offset</span><span class='Delimiter'>; 
</span><a name="LN3034"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lineno</span><span class='Delimiter'>; 
</span><a name="LN3035"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3029"><span class='Ref_To_Local'>word_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remember location of the backslash */ 
</span>    <a href="pgbench.c.html#LN3032"><span class='Ref_To_Local'>start_offset</span></a> <span class='Operator'>= </span><a href="pgbench.h.html#LN128"><span class='Ref_to_Proto'>expr_scanner_offset</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>sstate</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3034"><span class='Ref_To_Local'>lineno</span></a> <span class='Operator'>= </span><a href="pgbench.h.html#LN131"><span class='Ref_to_Proto'>expr_scanner_get_lineno</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>sstate</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3032"><span class='Ref_To_Local'>start_offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Collect first word of command */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.h.html#LN122"><span class='Ref_to_Proto'>expr_lex_one_word</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>sstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3029"><span class='Ref_To_Local'>word_buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3030"><span class='Ref_To_Local'>word_offset</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3029"><span class='Ref_To_Local'>word_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate and initialize Command structure */ 
</span>    <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN378"><span class='Ref_to_Member'>command_num</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN396"><span class='Ref_to_Global_Var'>num_commands</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN379"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN361"><span class='Ref_to_Const'>META_COMMAND</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN742"><span class='Ref_to_Func'>initSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN383"><span class='Ref_to_Member'>stats</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save first word (command name) */ 
</span>    <a href="pgbench.c.html#LN3035"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3031"><span class='Ref_To_Local'>offsets</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3035"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN3030"><span class='Ref_To_Local'>word_offset</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3035"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3029"><span class='Ref_To_Local'>word_buf</span></a><span class='Operator'>.</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"set"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* For \set, collect var name, then lex the expression. */ 
</span><a name="LN3066"></a>        <a href="pgbench.h.html#LN22"><span class='Ref_to_Const'>yyscan_t</span></a>    <span class='Declare_Local'>yyscanner</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.h.html#LN122"><span class='Ref_to_Proto'>expr_lex_one_word</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>sstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3029"><span class='Ref_To_Local'>word_buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3030"><span class='Ref_To_Local'>word_offset</span></a><span class='Parentheses'>))</span> 
            <a href="pgbench.c.html#LN2918"><span class='Ref_to_Func'>syntax_error</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>source</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3034"><span class='Ref_To_Local'>lineno</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                         <span class='String'>"missing argument"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN3031"><span class='Ref_To_Local'>offsets</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3035"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN3030"><span class='Ref_To_Local'>word_offset</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3035"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3029"><span class='Ref_To_Local'>word_buf</span></a><span class='Operator'>.</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN3066"><span class='Ref_To_Local'>yyscanner</span></a> <span class='Operator'>= </span><a href="pgbench.h.html#LN124"><span class='Ref_to_Proto'>expr_scanner_init</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>sstate</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>source</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3034"><span class='Ref_To_Local'>lineno</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3032"><span class='Ref_To_Local'>start_offset</span></a><span class='Delimiter'>, 
</span>                                      <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.h.html#LN117"><span class='Ref_to_Proto'>expr_yyparse</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3066"><span class='Ref_To_Local'>yyscanner</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* dead code: exit done from syntax_error called by yyerror */ 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN382"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><a href="exprparse.y.html#LN18"><span class='Ref_to_Global_Var'>expr_parse_result</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get location of the ending newline */ 
</span>        <a href="pgbench.c.html#LN3033"><span class='Ref_To_Local'>end_offset</span></a> <span class='Operator'>= </span><a href="pgbench.h.html#LN128"><span class='Ref_to_Proto'>expr_scanner_offset</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>sstate</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Save line */ 
</span>        <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a> <span class='Operator'>= </span><a href="pgbench.h.html#LN129"><span class='Ref_to_Proto'>expr_scanner_get_substring</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>sstate</span></a><span class='Delimiter'>, 
</span>                                                      <a href="pgbench.c.html#LN3032"><span class='Ref_To_Local'>start_offset</span></a><span class='Delimiter'>, 
</span>                                                      <a href="pgbench.c.html#LN3033"><span class='Ref_To_Local'>end_offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.h.html#LN127"><span class='Ref_to_Proto'>expr_scanner_finish</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3066"><span class='Ref_To_Local'>yyscanner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3029"><span class='Ref_To_Local'>word_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_strcasecmp(my_comm... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* For all other commands, collect remaining words. */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgbench.h.html#LN122"><span class='Ref_to_Proto'>expr_lex_one_word</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>sstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3029"><span class='Ref_To_Local'>word_buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3030"><span class='Ref_To_Local'>word_offset</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3035"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN362"><span class='Ref_to_Const'>MAX_ARGS</span></a><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN2918"><span class='Ref_to_Func'>syntax_error</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>source</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3034"><span class='Ref_To_Local'>lineno</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                         <span class='String'>"too many arguments"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN3031"><span class='Ref_To_Local'>offsets</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3035"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN3030"><span class='Ref_To_Local'>word_offset</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3035"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3029"><span class='Ref_To_Local'>word_buf</span></a><span class='Operator'>.</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get location of the ending newline */ 
</span>    <a href="pgbench.c.html#LN3033"><span class='Ref_To_Local'>end_offset</span></a> <span class='Operator'>= </span><a href="pgbench.h.html#LN128"><span class='Ref_to_Proto'>expr_scanner_offset</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>sstate</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save line */ 
</span>    <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a> <span class='Operator'>= </span><a href="pgbench.h.html#LN129"><span class='Ref_to_Proto'>expr_scanner_get_substring</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>sstate</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pgbench.c.html#LN3032"><span class='Ref_To_Local'>start_offset</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pgbench.c.html#LN3033"><span class='Ref_To_Local'>end_offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"sleep"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN2918"><span class='Ref_to_Func'>syntax_error</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>source</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3034"><span class='Ref_To_Local'>lineno</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                         <span class='String'>"missing argument"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>&GT; </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN2918"><span class='Ref_to_Func'>syntax_error</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>source</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3034"><span class='Ref_To_Local'>lineno</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                         <span class='String'>"too many arguments"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                         <a href="pgbench.c.html#LN3031"><span class='Ref_To_Local'>offsets</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="pgbench.c.html#LN3032"><span class='Ref_To_Local'>start_offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Split argument into number and unit to allow "sleep 1ms" etc. We 
         * don't have to terminate the number argument with null because it 
         * will be parsed with atoi, which ignores trailing non-digit 
         * characters. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>== </span><span class='Number'>2</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3141"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>c</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pgbench.c.html#LN3141"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>))</span> 
                <a href="pgbench.c.html#LN3141"><span class='Ref_To_Local'>c</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN3141"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN3141"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3031"><span class='Ref_To_Local'>offsets</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN3031"><span class='Ref_To_Local'>offsets</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3141"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], </span><span class='String'>"us"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], </span><span class='String'>"ms"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], </span><span class='String'>"s"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="pgbench.c.html#LN2918"><span class='Ref_to_Func'>syntax_error</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>source</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3034"><span class='Ref_To_Local'>lineno</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                             <span class='String'>"unrecognized time unit, must be us, ms or s"</span><span class='Delimiter'>, 
</span>                             <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], </span><a href="pgbench.c.html#LN3031"><span class='Ref_To_Local'>offsets</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="pgbench.c.html#LN3032"><span class='Ref_To_Local'>start_offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_strcasecmp(my_comm... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"setshell"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN2918"><span class='Ref_to_Func'>syntax_error</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>source</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3034"><span class='Ref_To_Local'>lineno</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                         <span class='String'>"missing argument"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"shell"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN380"><span class='Ref_to_Member'>argc</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN2918"><span class='Ref_to_Func'>syntax_error</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>source</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3034"><span class='Ref_To_Local'>lineno</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                         <span class='String'>"missing command"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN2918"><span class='Ref_to_Func'>syntax_error</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3026"><span class='Ref_to_Parameter'>source</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3034"><span class='Ref_To_Local'>lineno</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN377"><span class='Ref_to_Member'>line</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN381"><span class='Ref_to_Member'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                     <span class='String'>"invalid command"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3029"><span class='Ref_To_Local'>word_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgbench.c.html#LN3028"><span class='Ref_To_Local'>my_command</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end process_backslash_command &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse a script (either the contents of a file, or a built-in script) 
 * and add it to the list of scripts. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3191"></a><span class='Declare_Function'>ParseScript</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>script</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>weight</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3193"></a>    <a href="pgbench.c.html#LN386"><span class='Ref_to_Struct'>ParsedScript</span></a> <span class='Declare_Local'>ps</span><span class='Delimiter'>; 
</span><a name="LN3194"></a>    <a href="../../include/fe_utils/psqlscan.h.html#LN26"><span class='Ref_to_Typedef'>PsqlScanState</span></a> <span class='Declare_Local'>sstate</span><span class='Delimiter'>; 
</span><a name="LN3195"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>line_buf</span><span class='Delimiter'>; 
</span><a name="LN3196"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>alloc_num</span><span class='Delimiter'>; 
</span><a name="LN3197"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>index</span><span class='Delimiter'>; 
</span> 
<a name="LN3199"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>COMMANDS_ALLOC_NUM</span> <span class='Number'>128</span> 
    <a href="pgbench.c.html#LN3196"><span class='Ref_To_Local'>alloc_num</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3199"><span class='Ref_to_Const'>COMMANDS_ALLOC_NUM</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize all fields of ps */ 
</span>    <a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN388"><span class='Ref_to_Member'>desc</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3191"><span class='Ref_to_Parameter'>desc</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN389"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3191"><span class='Ref_to_Parameter'>weight</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pgbench.c.html#LN3196"><span class='Ref_To_Local'>alloc_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN782"><span class='Ref_to_Func'>initStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN391"><span class='Ref_to_Member'>stats</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare to parse script */ 
</span>    <a href="pgbench.c.html#LN3194"><span class='Ref_To_Local'>sstate</span></a> <span class='Operator'>= </span><a href="../../include/fe_utils/psqlscan.h.html#LN76"><span class='Ref_to_Proto'>psql_scan_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN463"><span class='Ref_to_Global_Var'>pgbench_callbacks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ideally, we'd scan scripts using the encoding and stdstrings settings 
     * we get from a DB connection.  However, without major rearrangement of 
     * pgbench's argument parsing, we can't have a DB connection at the time 
     * we parse scripts.  Using SQL_ASCII (encoding 0) should work well enough 
     * with any backend-safe encoding, though conceivably we could be fooled 
     * if a script file uses a client-only encoding.  We also assume that 
     * stdstrings should be true, which is a bit riskier. 
     */ 
</span>    <a href="../../include/fe_utils/psqlscan.h.html#LN81"><span class='Ref_to_Proto'>psql_scan_setup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3194"><span class='Ref_To_Local'>sstate</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3191"><span class='Ref_to_Parameter'>script</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3191"><span class='Ref_to_Parameter'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3195"><span class='Ref_To_Local'>line_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN3197"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3228"></a>        <a href="../../include/fe_utils/psqlscan.h.html#LN29"><span class='Ref_to_Typedef'>PsqlScanResult</span></a> <span class='Declare_Local'>sr</span><span class='Delimiter'>; 
</span><a name="LN3229"></a>        <a href="../../include/fe_utils/psqlscan.h.html#LN38"><span class='Ref_to_Typedef'>promptStatus_t</span></a> <span class='Declare_Local'>prompt</span><span class='Delimiter'>; 
</span><a name="LN3230"></a>        <a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>command</span><span class='Delimiter'>; 
</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3195"><span class='Ref_To_Local'>line_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN3228"><span class='Ref_To_Local'>sr</span></a> <span class='Operator'>= </span><a href="../../include/fe_utils/psqlscan.h.html#LN86"><span class='Ref_to_Proto'>psql_scan</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3194"><span class='Ref_To_Local'>sstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3195"><span class='Ref_To_Local'>line_buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3229"><span class='Ref_To_Local'>prompt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If we collected a SQL command, process that */ 
</span>        <a href="pgbench.c.html#LN3230"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN2953"><span class='Ref_to_Func'>process_sql_command</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3195"><span class='Ref_To_Local'>line_buf</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3191"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3230"><span class='Ref_To_Local'>command</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3197"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN3230"><span class='Ref_To_Local'>command</span></a><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN3197"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3197"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN3196"><span class='Ref_To_Local'>alloc_num</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pgbench.c.html#LN3196"><span class='Ref_To_Local'>alloc_num</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN3199"><span class='Ref_to_Const'>COMMANDS_ALLOC_NUM</span></a><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>                    <a href="../../include/common/fe_memutils.h.html#LN28"><span class='Ref_to_Proto'>pg_realloc</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pgbench.c.html#LN3196"><span class='Ref_To_Local'>alloc_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* If we reached a backslash, process that */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3228"><span class='Ref_To_Local'>sr</span></a> <span class='Operator'>== </span><a href="../../include/fe_utils/psqlscan.h.html#LN32"><span class='Ref_to_EnumConst'>PSCAN_BACKSLASH</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pgbench.c.html#LN3230"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3025"><span class='Ref_to_Func'>process_backslash_command</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3194"><span class='Ref_To_Local'>sstate</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3191"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3230"><span class='Ref_To_Local'>command</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3197"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN3230"><span class='Ref_To_Local'>command</span></a><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3197"><span class='Ref_To_Local'>index</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3197"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN3196"><span class='Ref_To_Local'>alloc_num</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pgbench.c.html#LN3196"><span class='Ref_To_Local'>alloc_num</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN3199"><span class='Ref_to_Const'>COMMANDS_ALLOC_NUM</span></a><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>                        <a href="../../include/common/fe_memutils.h.html#LN28"><span class='Ref_to_Proto'>pg_realloc</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pgbench.c.html#LN3196"><span class='Ref_To_Local'>alloc_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Done if we reached EOF */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3228"><span class='Ref_To_Local'>sr</span></a> <span class='Operator'>== </span><a href="../../include/fe_utils/psqlscan.h.html#LN33"><span class='Ref_to_EnumConst'>PSCAN_INCOMPLETE</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN3228"><span class='Ref_To_Local'>sr</span></a> <span class='Operator'>== </span><a href="../../include/fe_utils/psqlscan.h.html#LN34"><span class='Ref_to_EnumConst'>PSCAN_EOL</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3197"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN457"><span class='Ref_to_Proto'>addScript</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3193"><span class='Ref_To_Local'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3195"><span class='Ref_To_Local'>line_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/fe_utils/psqlscan.h.html#LN84"><span class='Ref_to_Proto'>psql_scan_finish</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3194"><span class='Ref_To_Local'>sstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/fe_utils/psqlscan.h.html#LN77"><span class='Ref_to_Proto'>psql_scan_destroy</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3194"><span class='Ref_To_Local'>sstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ParseScript &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read the entire contents of file fd, and return it in a malloc'd buffer. 
 * 
 * The buffer will typically be larger than necessary, but we don't care 
 * in this program, because we'll free it as soon as we've parsed the script. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN3290"></a><span class='Declare_Function'>read_file_contents</span><span class='Parentheses'>(</span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>fd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3292"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN3293"></a>    size_t      <span class='Declare_Local'>buflen</span> <span class='Operator'>= </span>BUFSIZ<span class='Delimiter'>; 
</span><a name="LN3294"></a>    size_t      <span class='Declare_Local'>used</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN3292"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3293"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3300"></a>        size_t      <span class='Declare_Local'>nread</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN3300"><span class='Ref_To_Local'>nread</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3292"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN3294"><span class='Ref_To_Local'>used</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span>BUFSIZ<span class='Delimiter'>, </span><a href="pgbench.c.html#LN3290"><span class='Ref_to_Parameter'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3294"><span class='Ref_To_Local'>used</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN3300"><span class='Ref_To_Local'>nread</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* If fread() read less than requested, must be EOF or error */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3300"><span class='Ref_To_Local'>nread</span></a> <span class='Operator'>&LT; </span>BUFSIZ<span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Enlarge buf so we can read some more */ 
</span>        <a href="pgbench.c.html#LN3293"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>+= </span>BUFSIZ<span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3292"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN28"><span class='Ref_to_Proto'>pg_realloc</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3292"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3293"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* There is surely room for a terminator */ 
</span>    <a href="pgbench.c.html#LN3292"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3294"><span class='Ref_To_Local'>used</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgbench.c.html#LN3292"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end read_file_contents &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a file name, read it and add its script to the list. 
 * "-" means to read stdin. 
 * NB: filename must be storage that won't disappear. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3323"></a><span class='Declare_Function'>process_file</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>weight</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3325"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>fd</span><span class='Delimiter'>; 
</span><a name="LN3326"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Slurp the file contents into "buf" */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3323"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><span class='String'>"-"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgbench.c.html#LN3325"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span>stdin<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN3325"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3323"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not open file \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                <a href="pgbench.c.html#LN3323"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pgbench.c.html#LN3326"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3289"><span class='Ref_to_Func'>read_file_contents</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3325"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>ferror<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3325"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not read file \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                <a href="pgbench.c.html#LN3323"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3325"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>!= </span>stdin<span class='Parentheses'>) 
</span>        fclose<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3325"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN3190"><span class='Ref_to_Func'>ParseScript</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3326"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3323"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3323"><span class='Ref_to_Parameter'>weight</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3326"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end process_file &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Parse the given builtin script and add it to the list. */ 
</span><span class='Keyword'>static void 
</span><a name="LN3357"></a><span class='Declare_Function'>process_builtin</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="pgbench.c.html#LN402"><span class='Ref_to_Struct'>BuiltinScript</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bi</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>weight</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pgbench.c.html#LN3190"><span class='Ref_to_Func'>ParseScript</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3357"><span class='Ref_to_Parameter'>bi</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN406"><span class='Ref_to_Member'>script</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3357"><span class='Ref_to_Parameter'>bi</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN405"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3357"><span class='Ref_to_Parameter'>weight</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* show available builtin scripts */ 
</span><span class='Keyword'>static void 
</span><a name="LN3364"></a><span class='Declare_Function'>listAvailableScripts</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3366"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"Available builtin scripts:\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3366"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3366"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN561"><span class='Ref_to_Macro'>lengthof</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN409"><span class='Ref_to_Global_Var'>builtin_script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3366"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"\t%s\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN409"><span class='Ref_to_Global_Var'>builtin_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3366"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN404"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* return builtin script "name" if unambiguous, fails if not found */ 
</span><span class='Keyword'>static const </span><a href="pgbench.c.html#LN402"><span class='Ref_to_Struct'>BuiltinScript</span></a> <span class='Operator'>* 
</span><a name="LN3376"></a><span class='Declare_Function'>findBuiltin</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3378"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN3379"></a>                <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN3380"></a>                <span class='Declare_Local'>len</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3376"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3381"></a>    <span class='Keyword'>const </span><a href="pgbench.c.html#LN402"><span class='Ref_to_Struct'>BuiltinScript</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3378"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3378"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN561"><span class='Ref_to_Macro'>lengthof</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN409"><span class='Ref_to_Global_Var'>builtin_script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3378"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pgbench.c.html#LN409"><span class='Ref_to_Global_Var'>builtin_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3378"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN404"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3376"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3380"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pgbench.c.html#LN3381"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= &</span><a href="pgbench.c.html#LN409"><span class='Ref_to_Global_Var'>builtin_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3378"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="pgbench.c.html#LN3379"><span class='Ref_To_Local'>found</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* ok, unambiguous result */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3379"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgbench.c.html#LN3381"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* error cases */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3379"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"no builtin script found for name \"%s\"\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3376"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* found &GT; 1 */ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                <span class='String'>"ambiguous builtin name: %d builtin scripts found for prefix \"%s\"\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3379"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3376"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN3363"><span class='Ref_to_Func'>listAvailableScripts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findBuiltin &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Determine the weight specification from a script option (-b, -f), if any, 
 * and return it as an integer (1 is returned if there's no weight).  The 
 * script name is returned in *script as a malloc'd string. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3413"></a><span class='Declare_Function'>parseScriptWeight</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>option</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>script</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3415"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sep</span><span class='Delimiter'>; 
</span><a name="LN3416"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>weight</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN3415"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>= </span>strrchr<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3413"><span class='Ref_to_Parameter'>option</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN186"><span class='Ref_to_Const'>WSEP</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3420"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>namelen</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN3415"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN3413"><span class='Ref_to_Parameter'>option</span></a><span class='Delimiter'>; 
</span><a name="LN3421"></a>        <span class='Keyword'>long</span>        <span class='Declare_Local'>wtmp</span><span class='Delimiter'>; 
</span><a name="LN3422"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>badp</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* generate the script name */ 
</span>        <span class='Operator'>*</span><a href="pgbench.c.html#LN3413"><span class='Ref_to_Parameter'>script</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3420"><span class='Ref_To_Local'>namelen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        strncpy<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN3413"><span class='Ref_to_Parameter'>script</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3413"><span class='Ref_to_Parameter'>option</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3420"><span class='Ref_To_Local'>namelen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN3413"><span class='Ref_to_Parameter'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3420"><span class='Ref_To_Local'>namelen</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* process digits of the weight spec */ 
</span>        errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3421"><span class='Ref_To_Local'>wtmp</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3415"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3422"><span class='Ref_To_Local'>badp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgbench.c.html#LN3422"><span class='Ref_To_Local'>badp</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN3415"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>|| *</span><a href="pgbench.c.html#LN3422"><span class='Ref_To_Local'>badp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid weight specification: %s\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3415"><span class='Ref_To_Local'>sep</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3421"><span class='Ref_To_Local'>wtmp</span></a> <span class='Operator'>&GT; </span>INT_MAX <span class='Operator'>|| </span><a href="pgbench.c.html#LN3421"><span class='Ref_To_Local'>wtmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>            <span class='String'>"weight specification out of range (0 .. %u): "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>"\n"</span><span class='Delimiter'>, 
</span>                    INT_MAX<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pgbench.c.html#LN3421"><span class='Ref_To_Local'>wtmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pgbench.c.html#LN3416"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3421"><span class='Ref_To_Local'>wtmp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (sep=strrchr(option,W... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="pgbench.c.html#LN3413"><span class='Ref_to_Parameter'>script</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3413"><span class='Ref_to_Parameter'>option</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3416"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pgbench.c.html#LN3416"><span class='Ref_To_Local'>weight</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parseScriptWeight &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* append a script to the list of scripts to process */ 
</span><span class='Keyword'>static void 
</span><a name="LN3457"></a><span class='Declare_Function'>addScript</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN386"><span class='Ref_to_Struct'>ParsedScript</span></a> <span class='Declare_Parameter'>script</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3457"><span class='Ref_to_Parameter'>script</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="pgbench.c.html#LN3457"><span class='Ref_to_Parameter'>script</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"empty command list for script \"%s\"\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3457"><span class='Ref_to_Parameter'>script</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN388"><span class='Ref_to_Member'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN206"><span class='Ref_to_Const'>MAX_SCRIPTS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"at most %d SQL scripts are allowed\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN206"><span class='Ref_to_Const'>MAX_SCRIPTS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgbench.c.html#LN3457"><span class='Ref_to_Parameter'>script</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3476"></a><span class='Declare_Function'>printSimpleStats</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>prefix</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN215"><span class='Ref_to_Struct'>SimpleStats</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ss</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* print NaN if no transactions where executed */ 
</span><a name="LN3479"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>latency</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN3476"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN3476"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN217"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>; 
</span><a name="LN3480"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>stddev</span> <span class='Operator'>= </span>sqrt<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3476"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN221"><span class='Ref_to_Member'>sum2</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN3476"><span class='Ref_to_Parameter'>ss</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN217"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN3479"><span class='Ref_To_Local'>latency</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN3479"><span class='Ref_To_Local'>latency</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%s average = %.3f ms\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3476"><span class='Ref_to_Parameter'>prefix</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>001</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN3479"><span class='Ref_To_Local'>latency</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%s stddev = %.3f ms\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3476"><span class='Ref_to_Parameter'>prefix</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>001</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN3480"><span class='Ref_To_Local'>stddev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* print out results */ 
</span><span class='Keyword'>static void 
</span><a name="LN3488"></a><span class='Declare_Function'>printResults</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>threads</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>total</span><span class='Delimiter'>, </span><a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a> <span class='Declare_Parameter'>total_time</span><span class='Delimiter'>, 
</span><a name="LN3489"></a>             <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a> <span class='Declare_Parameter'>conn_total_time</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>latency_late</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3491"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>time_include</span><span class='Delimiter'>, 
</span><a name="LN3492"></a>                <span class='Declare_Local'>tps_include</span><span class='Delimiter'>, 
</span><a name="LN3493"></a>                <span class='Declare_Local'>tps_exclude</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN3491"><span class='Ref_To_Local'>time_include</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN131"><span class='Ref_to_Macro'>INSTR_TIME_GET_DOUBLE</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3492"><span class='Ref_To_Local'>tps_include</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN3491"><span class='Ref_To_Local'>time_include</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3493"><span class='Ref_To_Local'>tps_exclude</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3491"><span class='Ref_To_Local'>time_include</span></a> <span class='Operator'>- 
</span>                        <span class='Parentheses'>(</span><a href="../../include/portability/instr_time.h.html#LN131"><span class='Ref_to_Macro'>INSTR_TIME_GET_DOUBLE</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3489"><span class='Ref_to_Parameter'>conn_total_time</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Report test parameters. */ 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"transaction type: %s\n"</span><span class='Delimiter'>, 
</span>           <a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>? </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN388"><span class='Ref_to_Member'>desc</span></a> <span class='Operator'>: </span><span class='String'>"multiple scripts"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"scaling factor: %d\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"query mode: %s\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN373"><span class='Ref_to_Global_Var'>QUERYMODE</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN372"><span class='Ref_to_Global_Var'>querymode</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"number of clients: %d\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"number of threads: %d\n"</span><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"number of transactions per client: %d\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN97"><span class='Ref_to_Global_Var'>nxacts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"number of transactions actually processed: "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>"/%d\n"</span><span class='Delimiter'>, 
</span>               <a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN97"><span class='Ref_to_Global_Var'>nxacts</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"duration: %d s\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"number of transactions actually processed: "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>"\n"</span><span class='Delimiter'>, 
</span>               <a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Remaining stats are nonsensical if we failed to execute any xacts */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a> <span class='Operator'>&& </span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"number of transactions skipped: "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" (%.3f %%)\n"</span><span class='Delimiter'>, 
</span>               <a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a><span class='Delimiter'>, 
</span>               <span class='Number'>100</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"number of transactions above the %.1f ms latency limit: %d (%.3f %%)\n"</span><span class='Delimiter'>, 
</span>               <a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3489"><span class='Ref_to_Parameter'>latency_late</span></a><span class='Delimiter'>, 
</span>               <span class='Number'>100</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN3489"><span class='Ref_to_Parameter'>latency_late</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN171"><span class='Ref_to_Global_Var'>progress</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN3475"><span class='Ref_to_Func'>printSimpleStats</span></a><span class='Parentheses'>(</span><span class='String'>"latency"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* no measurement, show average latency computed from run time */ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"latency average = %.3f ms\n"</span><span class='Delimiter'>, 
</span>               <span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN3491"><span class='Ref_To_Local'>time_include</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Report average transaction lag under rate limit throttling.  This 
         * is the delay between scheduled and actual start times for the 
         * transaction.  The measured lag may be caused by thread/client load, 
         * the database load, or the Poisson throttling process. 
         */ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"rate limit schedule lag: avg %.3f (max %.3f) ms\n"</span><span class='Delimiter'>, 
</span>               <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>001</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>001</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN219"><span class='Ref_to_Member'>max</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"tps = %f (including connections establishing)\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3492"><span class='Ref_To_Local'>tps_include</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"tps = %f (excluding connections establishing)\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3493"><span class='Ref_To_Local'>tps_exclude</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Report per-script/command statistics */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN170"><span class='Ref_to_Global_Var'>per_script_stats</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN176"><span class='Ref_to_Global_Var'>is_latencies</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3561"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"SQL script %d: %s\n"</span> 
                       <span class='String'>" - weight: %d (targets %.1f%% of total)\n"</span> 
                       <span class='String'>" - "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" transactions (%.1f%% of total, tps = %f)\n"</span><span class='Delimiter'>, 
</span>                       <a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN388"><span class='Ref_to_Member'>desc</span></a><span class='Delimiter'>, 
</span>                       <a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN389"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>, 
</span>                       <span class='Number'>100</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN389"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN397"><span class='Ref_to_Global_Var'>total_weight</span></a><span class='Delimiter'>, 
</span>                       <a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN391"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Delimiter'>, 
</span>                       <span class='Number'>100</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN391"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN3488"><span class='Ref_to_Parameter'>total</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Delimiter'>, 
</span>                       <a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN391"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>/ </span><a href="pgbench.c.html#LN3491"><span class='Ref_To_Local'>time_include</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"script statistics:\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>" - number of transactions skipped: "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" (%.3f%%)\n"</span><span class='Delimiter'>, 
</span>                       <a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN391"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a><span class='Delimiter'>, 
</span>                       <span class='Number'>100</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN391"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a> <span class='Operator'>/ 
</span>                    <span class='Parentheses'>(</span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN391"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a> <span class='Operator'>+ </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN391"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="pgbench.c.html#LN3475"><span class='Ref_to_Func'>printSimpleStats</span></a><span class='Parentheses'>(</span><span class='String'>" - latency"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN391"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Report per-command latencies */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN176"><span class='Ref_to_Global_Var'>is_latencies</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3590"></a>                <a href="pgbench.c.html#LN375"><span class='Ref_to_Typedef'>Command</span></a>   <span class='Operator'>**</span><span class='Declare_Local'>commands</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>" - statement latencies in milliseconds:\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3590"><span class='Ref_To_Local'>commands</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3561"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN390"><span class='Ref_to_Member'>commands</span></a><span class='Delimiter'>; 
</span>                     <span class='Operator'>*</span><a href="pgbench.c.html#LN3590"><span class='Ref_To_Local'>commands</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                     <a href="pgbench.c.html#LN3590"><span class='Ref_To_Local'>commands</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"   %11.3f  %s\n"</span><span class='Delimiter'>, 
</span>                           <span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN3590"><span class='Ref_To_Local'>commands</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>stats<span class='Operator'>.</span>sum <span class='Operator'>/ 
</span>                           <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN3590"><span class='Ref_To_Local'>commands</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>stats<span class='Operator'>.</span>count<span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgbench.c.html#LN3590"><span class='Ref_To_Local'>commands</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>line<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;num_scripts;i++ &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if per_script_stats||lat... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end printResults &raquo; </span> 
 
 
<span class='Keyword'>int 
</span><a name="LN3608"></a><span class='Declare_Function'>main</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>argv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3610"></a>    <span class='Keyword'>static </span><span class='Control'>struct</span> <a href="../../include/getopt_long.h.html#LN15"><span class='Ref_to_Struct'>option</span></a> <span class='Declare_Local'>long_options</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* systematic long/short named options */ 
</span>        <span class='Delimiter'>{</span><span class='String'>"builtin"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"client"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"connect"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'C'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"debug"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"define"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'D'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"file"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'f'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"fillfactor"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'F'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"host"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'h'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"initialize"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"jobs"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'j'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"log"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'l'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"latency-limit"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'L'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-vacuum"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'n'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"port"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'p'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"progress"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'P'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"protocol"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'M'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"quiet"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'q'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"report-latencies"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'r'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"rate"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'R'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"scale"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'s'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"select-only"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'S'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"skip-some-updates"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'N'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"time"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'T'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"transactions"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'t'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"username"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'U'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"vacuum-all"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'v'</span><span class='Delimiter'>}, 
</span>        <span class='Comment_Multi_Line'>/* long-named only options */ 
</span>        <span class='Delimiter'>{</span><span class='String'>"foreign-keys"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN116"><span class='Ref_to_Global_Var'>foreign_keys</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"index-tablespace"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"tablespace"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"unlogged-tables"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN121"><span class='Ref_to_Global_Var'>unlogged_tables</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"sampling-rate"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"aggregate-interval"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"progress-timestamp"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"log-prefix"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
<a name="LN3650"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN3651"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>is_init_mode</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* initialize mode? */ 
</span><a name="LN3652"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>is_no_vacuum</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* no vacuum at all before testing? */ 
</span><a name="LN3653"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>do_vacuum_accounts</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* do vacuum accounts before testing? */ 
</span><a name="LN3654"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>optindex</span><span class='Delimiter'>; 
</span><a name="LN3655"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>scale_given</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN3657"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>benchmarking_option_set</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3658"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>initialization_option_set</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3659"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>internal_script_used</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN3661"></a>    <a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* status of clients */ 
</span><a name="LN3662"></a>    <a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>threads</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* array of thread */ 
</span> 
<a name="LN3664"></a>    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>start_time</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* start up time */ 
</span><a name="LN3665"></a>    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>total_time</span><span class='Delimiter'>; 
</span><a name="LN3666"></a>    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>conn_total_time</span><span class='Delimiter'>; 
</span><a name="LN3667"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>latency_late</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN3668"></a>    <a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a>   <span class='Declare_Local'>stats</span><span class='Delimiter'>; 
</span><a name="LN3669"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>weight</span><span class='Delimiter'>; 
</span> 
<a name="LN3671"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3672"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nclients_dealt</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_GETRLIMIT 
<a name="LN3675"></a>    <span class='Control'>struct</span> rlimit <span class='Declare_Local'>rlim</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<a name="LN3678"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>con</span><span class='Delimiter'>; 
</span><a name="LN3679"></a>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN3680"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>env</span><span class='Delimiter'>; 
</span> 
    <a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN49"><span class='Ref_to_Proto'>get_progname</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3608"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3608"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3608"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--help"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3608"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"-?"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../psql/help.h.html#LN10"><span class='Ref_to_Proto'>usage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3608"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"--version"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3608"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='String'>"-V"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            puts<span class='Parentheses'>(</span><span class='String'>"pgbench (PostgreSQL) "</span> PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Comment_Multi_Line'>/* stderr is buffered on Win32. */ 
</span>    setvbuf<span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span>_IONBF<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGHOST"</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& *</span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
        <a href="pgbench.c.html#LN179"><span class='Ref_to_Global_Var'>pghost</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGPORT"</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& *</span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
        <a href="pgbench.c.html#LN180"><span class='Ref_to_Global_Var'>pgport</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGUSER"</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& *</span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
        <a href="pgbench.c.html#LN181"><span class='Ref_to_Global_Var'>login</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN3650"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="../../include/getopt_long.h.html#LN30"><span class='Ref_to_Proto'>getopt_long</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3608"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3608"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>, </span><span class='String'>"ih:nvp:dqb:SNc:j:Crs:t:T:U:lf:D:F:M:P:R:L:"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3610"><span class='Ref_To_Local'>long_options</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3654"><span class='Ref_To_Local'>optindex</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3715"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>script</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3650"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'i'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3651"><span class='Ref_To_Local'>is_init_mode</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'h'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN179"><span class='Ref_to_Global_Var'>pghost</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3652"><span class='Ref_To_Local'>is_no_vacuum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'v'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3653"><span class='Ref_To_Local'>do_vacuum_accounts</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN180"><span class='Ref_to_Global_Var'>pgport</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>                <a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a> <span class='Operator'>&GT; </span><a href="pgbench.c.html#LN87"><span class='Ref_to_Const'>MAXCLIENTS</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid number of clients: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                            <a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span><span class='Directive'>#ifdef</span> HAVE_GETRLIMIT 
<span class='Directive'>#ifdef</span> RLIMIT_NOFILE            <span class='Comment_Single_Line'>/* most platforms use RLIMIT_NOFILE */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>getrlimit<span class='Parentheses'>(</span>RLIMIT_NOFILE<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3675"><span class='Ref_To_Local'>rlim</span></a><span class='Parentheses'>) </span><span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
<span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* but BSD doesn't ... */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>getrlimit<span class='Parentheses'>(</span>RLIMIT_OFILE<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3675"><span class='Ref_To_Local'>rlim</span></a><span class='Parentheses'>) </span><span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* RLIMIT_NOFILE */ 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"getrlimit failed: %s\n"</span><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3675"><span class='Ref_To_Local'>rlim</span></a><span class='Operator'>.</span>rlim_cur <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"need at least %d open files, but system limit is %ld\n"</span><span class='Delimiter'>, 
</span>                            <a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN3675"><span class='Ref_To_Local'>rlim</span></a><span class='Operator'>.</span>rlim_cur<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"Reduce number of clients, or use limit/ulimit to increase the system limit.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_GETRLIMIT */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'j'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* jobs */ 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid number of threads: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                            <a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span><span class='Directive'>#ifndef</span> ENABLE_THREAD_SAFETY 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"threads are not supported on this platform; use -j1\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* !ENABLE_THREAD_SAFETY */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN175"><span class='Ref_to_Global_Var'>is_connect</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'r'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN170"><span class='Ref_to_Global_Var'>per_script_stats</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN176"><span class='Ref_to_Global_Var'>is_latencies</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3655"><span class='Ref_To_Local'>scale_given</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid scaling factor: \"%s\"\n"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"specify either a number of transactions (-t) or a duration (-T), not both\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pgbench.c.html#LN97"><span class='Ref_to_Global_Var'>nxacts</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN97"><span class='Ref_to_Global_Var'>nxacts</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid number of transactions: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                            <a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'T'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN97"><span class='Ref_to_Global_Var'>nxacts</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"specify either a number of transactions (-t) or a duration (-T), not both\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid duration: \"%s\"\n"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'U'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN181"><span class='Ref_to_Global_Var'>login</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'l'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN166"><span class='Ref_to_Global_Var'>use_log</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'q'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3658"><span class='Ref_To_Local'>initialization_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN167"><span class='Ref_to_Global_Var'>use_quiet</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>"list"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pgbench.c.html#LN3363"><span class='Ref_to_Func'>listAvailableScripts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="pgbench.c.html#LN3669"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3412"><span class='Ref_to_Func'>parseScriptWeight</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3715"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3356"><span class='Ref_to_Func'>process_builtin</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3375"><span class='Ref_to_Func'>findBuiltin</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3715"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3669"><span class='Ref_To_Local'>weight</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3659"><span class='Ref_To_Local'>internal_script_used</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3356"><span class='Ref_to_Func'>process_builtin</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3375"><span class='Ref_to_Func'>findBuiltin</span></a><span class='Parentheses'>(</span><span class='String'>"select-only"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3659"><span class='Ref_To_Local'>internal_script_used</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'N'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3356"><span class='Ref_to_Func'>process_builtin</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3375"><span class='Ref_to_Func'>findBuiltin</span></a><span class='Parentheses'>(</span><span class='String'>"simple-update"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3659"><span class='Ref_To_Local'>internal_script_used</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3669"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3412"><span class='Ref_to_Func'>parseScriptWeight</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3715"><span class='Ref_To_Local'>script</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../psql/command.h.html#LN32"><span class='Ref_to_Proto'>process_file</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3715"><span class='Ref_To_Local'>script</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3669"><span class='Ref_To_Local'>weight</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN3871"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
                    <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN3871"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>'='</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="pgbench.c.html#LN3871"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a> <span class='Operator'>|| *</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3871"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid variable definition: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                                <a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Operator'>*</span><a href="pgbench.c.html#LN3871"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1088"><span class='Ref_to_Func'>putVariable</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"option"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3871"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
                        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'F'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3658"><span class='Ref_To_Local'>initialization_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN111"><span class='Ref_to_Global_Var'>fillfactor</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN111"><span class='Ref_to_Global_Var'>fillfactor</span></a> <span class='Operator'>&LT; </span><span class='Number'>10</span> <span class='Operator'>|| </span><a href="pgbench.c.html#LN111"><span class='Ref_to_Global_Var'>fillfactor</span></a> <span class='Operator'>&GT; </span><span class='Number'>100</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid fillfactor: \"%s\"\n"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'M'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"query mode (-M) should be specified before any transaction scripts (-f or -b)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN372"><span class='Ref_to_Global_Var'>querymode</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN372"><span class='Ref_to_Global_Var'>querymode</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN369"><span class='Ref_to_EnumConst'>NUM_QUERYMODE</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN372"><span class='Ref_to_Global_Var'>querymode</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN373"><span class='Ref_to_Global_Var'>QUERYMODE</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN372"><span class='Ref_to_Global_Var'>querymode</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN372"><span class='Ref_to_Global_Var'>querymode</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN369"><span class='Ref_to_EnumConst'>NUM_QUERYMODE</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid query mode (-M): \"%s\"\n"</span><span class='Delimiter'>, 
</span>                            <a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN171"><span class='Ref_to_Global_Var'>progress</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN171"><span class='Ref_to_Global_Var'>progress</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid thread progress delay: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                            <a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'R'</span><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* get a double from the beginning of option value */ 
</span><a name="LN3926"></a>                    <span class='Keyword'>double</span>      <span class='Declare_Local'>throttle_value</span> <span class='Operator'>= </span>atof<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3926"><span class='Ref_To_Local'>throttle_value</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid rate limit: \"%s\"\n"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* Invert rate limit into a time offset */ 
</span>                    <a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) (</span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>/ </span><a href="pgbench.c.html#LN3926"><span class='Ref_To_Local'>throttle_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'L'</span><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN3941"></a>                    <span class='Keyword'>double</span>      <span class='Declare_Local'>limit_ms</span> <span class='Operator'>= </span>atof<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3941"><span class='Ref_To_Local'>limit_ms</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid latency limit: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                                <a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) (</span><a href="pgbench.c.html#LN3941"><span class='Ref_To_Local'>limit_ms</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* This covers long options which take no argument. */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN116"><span class='Ref_to_Global_Var'>foreign_keys</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN121"><span class='Ref_to_Global_Var'>unlogged_tables</span></a><span class='Parentheses'>) 
</span>                    <a href="pgbench.c.html#LN3658"><span class='Ref_To_Local'>initialization_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* tablespace */ 
</span>                <a href="pgbench.c.html#LN3658"><span class='Ref_To_Local'>initialization_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN145"><span class='Ref_to_Global_Var'>tablespace</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* index-tablespace */ 
</span>                <a href="pgbench.c.html#LN3658"><span class='Ref_To_Local'>initialization_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN146"><span class='Ref_to_Global_Var'>index_tablespace</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN126"><span class='Ref_to_Global_Var'>sample_rate</span></a> <span class='Operator'>= </span>atof<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN126"><span class='Ref_to_Global_Var'>sample_rate</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgbench.c.html#LN126"><span class='Ref_to_Global_Var'>sample_rate</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid sampling rate: \"%s\"\n"</span><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>5</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid number of seconds for aggregation: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                            <a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>6</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN172"><span class='Ref_to_Global_Var'>progress_timestamp</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>7</span><span class='Operator'>: 
</span>                <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN183"><span class='Ref_to_Global_Var'>logfile_prefix</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Try \"%s --help\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch c &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (c=getopt_long(argc,a... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* set default script if none */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="pgbench.c.html#LN3651"><span class='Ref_To_Local'>is_init_mode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN3356"><span class='Ref_to_Func'>process_builtin</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3375"><span class='Ref_to_Func'>findBuiltin</span></a><span class='Parentheses'>(</span><span class='String'>"tpcb-like"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3659"><span class='Ref_To_Local'>internal_script_used</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* compute total_weight */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Comment_Multi_Line'>/* cannot overflow: weight is 32b, total_weight 64b */ 
</span>        <a href="pgbench.c.html#LN397"><span class='Ref_to_Global_Var'>total_weight</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN394"><span class='Ref_to_Global_Var'>sql_script</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN389"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN397"><span class='Ref_to_Global_Var'>total_weight</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="pgbench.c.html#LN3651"><span class='Ref_To_Local'>is_init_mode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"total script weight must not be zero\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* show per script stats if several scripts are used */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN395"><span class='Ref_to_Global_Var'>num_scripts</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN170"><span class='Ref_to_Global_Var'>per_script_stats</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't need more threads than there are clients.  (This is not merely an 
     * optimization; throttle_delay is calculated incorrectly below if some 
     * threads have no clients assigned to them.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a> <span class='Operator'>&GT; </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* compute a per thread delay */ 
</span>    <a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a> <span class='Operator'>*= </span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3608"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>&GT; </span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3608"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGDATABASE"</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& *</span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
            <a href="pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3680"><span class='Ref_To_Local'>env</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN181"><span class='Ref_to_Global_Var'>login</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& *</span><a href="pgbench.c.html#LN181"><span class='Ref_to_Global_Var'>login</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN181"><span class='Ref_to_Global_Var'>login</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3651"><span class='Ref_To_Local'>is_init_mode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3657"><span class='Ref_To_Local'>benchmarking_option_set</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"some of the specified options cannot be used in initialization (-i) mode\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pgbench.c.html#LN2569"><span class='Ref_to_Func'>init</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3652"><span class='Ref_To_Local'>is_no_vacuum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3658"><span class='Ref_To_Local'>initialization_option_set</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"some of the specified options cannot be used in benchmarking mode\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Use DEFAULT_NXACTS if neither nxacts nor duration is specified. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN97"><span class='Ref_to_Global_Var'>nxacts</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN97"><span class='Ref_to_Global_Var'>nxacts</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN93"><span class='Ref_to_Const'>DEFAULT_NXACTS</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* --sampling-rate may be used only with -l */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN126"><span class='Ref_to_Global_Var'>sample_rate</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="pgbench.c.html#LN166"><span class='Ref_to_Global_Var'>use_log</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"log sampling (--sampling-rate) is allowed only when logging transactions (-l)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* --sampling-rate may not be used with --aggregate-interval */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN126"><span class='Ref_to_Global_Var'>sample_rate</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"log sampling (--sampling-rate) and aggregation (--aggregate-interval) cannot be used at the same time\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="pgbench.c.html#LN166"><span class='Ref_to_Global_Var'>use_log</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"log aggregation is allowed only when actually logging transactions\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN166"><span class='Ref_to_Global_Var'>use_log</span></a> <span class='Operator'>&& </span><a href="pgbench.c.html#LN183"><span class='Ref_to_Global_Var'>logfile_prefix</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"log file prefix (--log-prefix) is allowed only when logging transactions (-l)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a> <span class='Operator'>&GT; </span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"number of seconds for aggregation (%d) must not be higher than test duration (%d)\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>% </span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"duration (%d) must be a multiple of aggregation interval (%d)\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * save main process id in the global variable because process id will be 
     * changed after fork. 
     */ 
</span>    <a href="pgbench.c.html#LN177"><span class='Ref_to_Global_Var'>main_pid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>getpid<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN28"><span class='Ref_to_Proto'>pg_realloc</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* copy any -D switch values to all clients */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4122"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
            <a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN311"><span class='Ref_to_Member'>id</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4122"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4122"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN319"><span class='Ref_to_Member'>nvariables</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4122"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4127"></a>                <a href="pgbench.c.html#LN198"><span class='Ref_to_Typedef'>Variable</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN318"><span class='Ref_to_Member'>variables</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN4122"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4127"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN202"><span class='Ref_to_Member'>is_numeric</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1111"><span class='Ref_to_Func'>putVariableNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>"startup"</span><span class='Delimiter'>, 
</span>                                           <a href="pgbench.c.html#LN4127"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN200"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4127"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN203"><span class='Ref_to_Member'>num_value</span></a><span class='Parentheses'>))</span> 
                        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1088"><span class='Ref_to_Func'>putVariable</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>"startup"</span><span class='Delimiter'>, 
</span>                                     <a href="pgbench.c.html#LN4127"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN200"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4127"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>))</span> 
                        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;nclients;i++ &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nclients&GT;1 &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"pghost: %s pgport: %s nclients: %d nxacts: %d dbName: %s\n"</span><span class='Delimiter'>, 
</span>                   <a href="pgbench.c.html#LN179"><span class='Ref_to_Global_Var'>pghost</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN180"><span class='Ref_to_Global_Var'>pgport</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN97"><span class='Ref_to_Global_Var'>nxacts</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"pghost: %s pgport: %s nclients: %d duration: %d dbName: %s\n"</span><span class='Delimiter'>, 
</span>                   <a href="pgbench.c.html#LN179"><span class='Ref_to_Global_Var'>pghost</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN180"><span class='Ref_to_Global_Var'>pgport</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* opening connection... */ 
</span>    <a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN846"><span class='Ref_to_Func'>doConnect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN317"><span class='Ref_to_Proto'>PQstatus</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"connection to database \"%s\" failed\n"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3659"><span class='Ref_To_Local'>internal_script_used</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * get the scaling factor that should be same as count(*) from 
         * pgbench_branches if this is not a custom query 
         */ 
</span>        <a href="pgbench.c.html#LN3679"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"select count(*) from pgbench_branches"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3679"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN4176"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sqlState</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3679"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN56"><span class='Ref_to_Const'>PG_DIAG_SQLSTATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4176"><span class='Ref_To_Local'>sqlState</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgbench.c.html#LN4176"><span class='Ref_To_Local'>sqlState</span></a><span class='Delimiter'>, </span><a href="../scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"Perhaps you need to do initialization (\"pgbench -i\") in database \"%s\"\n"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN310"><span class='Ref_to_Proto'>PQdb</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3679"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid count(*) from pgbench_branches: \"%s\"\n"</span><span class='Delimiter'>, 
</span>                    <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3679"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3679"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* warn if we override user-given -s switch */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3655"><span class='Ref_To_Local'>scale_given</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                    <span class='String'>"scale option ignored, using count from pgbench_branches table (%d)\n"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if internal_script_used &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * :scale variables normally get -s or database scale, but don't override 
     * an explicit -D switch 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN937"><span class='Ref_to_Func'>lookupVariable</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"scale"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1132"><span class='Ref_to_Func'>putVariableInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>"startup"</span><span class='Delimiter'>, </span><span class='String'>"scale"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN105"><span class='Ref_to_Global_Var'>scale</span></a><span class='Parentheses'>))</span> 
                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Define a :client_id variable that is unique per connection. But don't 
     * override an explicit -D switch. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN937"><span class='Ref_to_Func'>lookupVariable</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>"client_id"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN1132"><span class='Ref_to_Func'>putVariableInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>"startup"</span><span class='Delimiter'>, </span><span class='String'>"client_id"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN3652"><span class='Ref_To_Local'>is_no_vacuum</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"starting vacuum..."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN831"><span class='Ref_to_Func'>tryExecuteStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"vacuum pgbench_branches"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN831"><span class='Ref_to_Func'>tryExecuteStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"vacuum pgbench_tellers"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN831"><span class='Ref_to_Func'>tryExecuteStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"truncate pgbench_history"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"end.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3653"><span class='Ref_To_Local'>do_vacuum_accounts</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"starting vacuum pgbench_accounts..."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN831"><span class='Ref_to_Func'>tryExecuteStatement</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a><span class='Delimiter'>, </span><span class='String'>"vacuum analyze pgbench_accounts"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"end.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3678"><span class='Ref_To_Local'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set random seed */ 
</span>    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3664"><span class='Ref_To_Local'>start_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../port/srandom.c.html#LN20"><span class='Ref_to_Func'>srandom</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned int</span><span class='Parentheses'>) </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3664"><span class='Ref_To_Local'>start_time</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up thread data structures */ 
</span>    <a href="pgbench.c.html#LN3662"><span class='Ref_To_Local'>threads</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3672"><span class='Ref_To_Local'>nclients_dealt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4255"></a>        <a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>thread</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN3662"><span class='Ref_To_Local'>threads</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <a href="pgbench.c.html#LN4255"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN340"><span class='Ref_to_Member'>tid</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN4255"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN342"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= &</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3672"><span class='Ref_To_Local'>nclients_dealt</span></a><span class='Delimiter'>]; 
</span>        <a href="pgbench.c.html#LN4255"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN343"><span class='Ref_to_Member'>nstate</span></a> <span class='Operator'>= 
</span>            <span class='Parentheses'>(</span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN3672"><span class='Ref_To_Local'>nclients_dealt</span></a> <span class='Operator'>+ </span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN4255"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN344"><span class='Ref_to_Member'>random_state</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../port/random.c.html#LN20"><span class='Ref_to_Func'>random</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN4255"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN344"><span class='Ref_to_Member'>random_state</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../port/random.c.html#LN20"><span class='Ref_to_Func'>random</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN4255"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN344"><span class='Ref_to_Member'>random_state</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../port/random.c.html#LN20"><span class='Ref_to_Func'>random</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN4255"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN346"><span class='Ref_to_Member'>logfile</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* filled in later */ 
</span>        <a href="pgbench.c.html#LN4255"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN352"><span class='Ref_to_Member'>latency_late</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN782"><span class='Ref_to_Func'>initStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN4255"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN3672"><span class='Ref_To_Local'>nclients_dealt</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN4255"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN343"><span class='Ref_to_Member'>nstate</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* all clients must be assigned to a thread */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3672"><span class='Ref_To_Local'>nclients_dealt</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get start up time */ 
</span>    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3664"><span class='Ref_To_Local'>start_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set alarm if duration is specified. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN459"><span class='Ref_to_Proto'>setalarm</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* start threads */ 
</span><span class='Directive'>#ifdef</span> ENABLE_THREAD_SAFETY 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4285"></a>        <a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>thread</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN3662"><span class='Ref_To_Local'>threads</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4285"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN349"><span class='Ref_to_Member'>start_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* compute when to stop */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pgbench.c.html#LN99"><span class='Ref_to_Global_Var'>end_time</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4285"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN349"><span class='Ref_to_Member'>start_time</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Number'>1000000</span> <span class='Operator'>*</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* the first thread (i = 0) is executed by main thread */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4297"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>err</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN71"><span class='Ref_to_Proto'>pthread_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN4285"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN341"><span class='Ref_to_Member'>thread</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN458"><span class='Ref_to_Proto'>threadRun</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4285"><span class='Ref_To_Local'>thread</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4297"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgbench.c.html#LN4285"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN341"><span class='Ref_to_Member'>thread</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN355"><span class='Ref_to_Const'>INVALID_THREAD</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not create thread: %s\n"</span><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4297"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pgbench.c.html#LN4285"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN341"><span class='Ref_to_Member'>thread</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN355"><span class='Ref_to_Const'>INVALID_THREAD</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nthreads;i++ &raquo; </span> 
<span class='Directive'>#else</span> 
    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3662"><span class='Ref_To_Local'>threads</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN349"><span class='Ref_to_Member'>start_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* compute when to stop */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pgbench.c.html#LN99"><span class='Ref_to_Global_Var'>end_time</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3662"><span class='Ref_To_Local'>threads</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN349"><span class='Ref_to_Member'>start_time</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>            <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Number'>1000000</span> <span class='Operator'>*</span><a href="pgbench.c.html#LN98"><span class='Ref_to_Global_Var'>duration</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3662"><span class='Ref_To_Local'>threads</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN341"><span class='Ref_to_Member'>thread</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN355"><span class='Ref_to_Const'>INVALID_THREAD</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* ENABLE_THREAD_SAFETY */ 
</span> 
    <span class='Comment_Multi_Line'>/* wait for threads and accumulate results */ 
</span>    <a href="pgbench.c.html#LN782"><span class='Ref_to_Func'>initStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3668"><span class='Ref_To_Local'>stats</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/portability/instr_time.h.html#LN86"><span class='Ref_to_Macro'>INSTR_TIME_SET_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3666"><span class='Ref_To_Local'>conn_total_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4324"></a>        <a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>thread</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN3662"><span class='Ref_To_Local'>threads</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
<span class='Directive'>#ifdef</span> ENABLE_THREAD_SAFETY 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN3662"><span class='Ref_To_Local'>threads</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN3671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN341"><span class='Ref_to_Member'>thread</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN355"><span class='Ref_to_Const'>INVALID_THREAD</span></a><span class='Parentheses'>) 
</span>            <span class='Comment_Multi_Line'>/* actually run this thread directly in the main thread */ 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN458"><span class='Ref_to_Proto'>threadRun</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4324"><span class='Ref_To_Local'>thread</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Comment_Multi_Line'>/* wait of other threads. should check that 0 is returned? */ 
</span>            <a href="pgbench.c.html#LN72"><span class='Ref_to_Proto'>pthread_join</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4324"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN341"><span class='Ref_to_Member'>thread</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN458"><span class='Ref_to_Proto'>threadRun</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4324"><span class='Ref_To_Local'>thread</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* ENABLE_THREAD_SAFETY */ 
</span> 
        <span class='Comment_Multi_Line'>/* aggregate thread level stats */ 
</span>        <a href="pgbench.c.html#LN766"><span class='Ref_to_Func'>mergeSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3668"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4324"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN766"><span class='Ref_to_Func'>mergeSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN3668"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4324"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3668"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN4324"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3668"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN4324"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN3667"><span class='Ref_To_Local'>latency_late</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN4324"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN352"><span class='Ref_to_Member'>latency_late</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/portability/instr_time.h.html#LN90"><span class='Ref_to_Macro'>INSTR_TIME_ADD</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3666"><span class='Ref_To_Local'>conn_total_time</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4324"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN350"><span class='Ref_to_Member'>conn_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nthreads;i++ &raquo; </span> 
    <a href="pgbench.c.html#LN2553"><span class='Ref_to_Func'>disconnect_all</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3661"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN173"><span class='Ref_to_Global_Var'>nclients</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XXX We compute results as though every client of every thread started 
     * and finished at the same time.  That model can diverge noticeably from 
     * reality for a short benchmark run involving relatively many threads. 
     * The first thread may process notably many transactions before the last 
     * thread begins.  Improving the model alone would bring limited benefit, 
     * because performance during those periods of partial thread count can 
     * easily exceed steady state performance.  This is one of the many ways 
     * short runs convey deceptive performance figures. 
     */ 
</span>    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3665"><span class='Ref_To_Local'>total_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/portability/instr_time.h.html#LN102"><span class='Ref_to_Macro'>INSTR_TIME_SUBTRACT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3665"><span class='Ref_To_Local'>total_time</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3664"><span class='Ref_To_Local'>start_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN3487"><span class='Ref_to_Func'>printResults</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN3662"><span class='Ref_To_Local'>threads</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN3668"><span class='Ref_To_Local'>stats</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3665"><span class='Ref_To_Local'>total_time</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3666"><span class='Ref_To_Local'>conn_total_time</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN3667"><span class='Ref_To_Local'>latency_late</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end main &raquo; </span> 
 
<span class='Keyword'>static void </span><span class='Operator'>* 
</span><a name="LN4365"></a><span class='Declare_Function'>threadRun</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4367"></a>    <a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>thread</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN338"><span class='Ref_to_Typedef'>TState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN4365"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN4368"></a>    <a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN342"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span><a name="LN4369"></a>    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>start</span><span class='Delimiter'>, 
</span><a name="LN4370"></a>                <span class='Declare_Local'>end</span><span class='Delimiter'>; 
</span><a name="LN4371"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nstate</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN343"><span class='Ref_to_Member'>nstate</span></a><span class='Delimiter'>; 
</span><a name="LN4372"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>remains</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN4371"><span class='Ref_To_Local'>nstate</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* number of remaining clients */ 
</span><a name="LN4373"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* for reporting progress: */ 
</span><a name="LN4376"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>thread_start</span> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN349"><span class='Ref_to_Member'>start_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4377"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>last_report</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN4376"><span class='Ref_To_Local'>thread_start</span></a><span class='Delimiter'>; 
</span><a name="LN4378"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>next_report</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN4377"><span class='Ref_To_Local'>last_report</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pgbench.c.html#LN171"><span class='Ref_to_Global_Var'>progress</span></a> <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Delimiter'>; 
</span><a name="LN4379"></a>    <a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a>   <span class='Declare_Local'>last</span><span class='Delimiter'>, 
</span><a name="LN4380"></a>                <span class='Declare_Local'>aggs</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize throttling rate target for all of the thread's clients.  It 
     * might be a little more accurate to reset thread-&GT;start_time here too. 
     * The possible drift seems too small relative to typical throttle delay 
     * times to worry about it. 
     */ 
</span>    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4369"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN345"><span class='Ref_to_Member'>throttle_trigger</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4369"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/portability/instr_time.h.html#LN86"><span class='Ref_to_Macro'>INSTR_TIME_SET_ZERO</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN350"><span class='Ref_to_Member'>conn_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN782"><span class='Ref_to_Func'>initStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN4380"><span class='Ref_To_Local'>aggs</span></a><span class='Delimiter'>, </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN4379"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN4380"><span class='Ref_To_Local'>aggs</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* open log file if requested */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN166"><span class='Ref_to_Global_Var'>use_log</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4399"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>logpath</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN4400"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>prefix</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN183"><span class='Ref_to_Global_Var'>logfile_prefix</span></a> <span class='Operator'>? </span><a href="pgbench.c.html#LN183"><span class='Ref_to_Global_Var'>logfile_prefix</span></a> <span class='Operator'>: </span><span class='String'>"pgbench_log"</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN340"><span class='Ref_to_Member'>tid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4399"><span class='Ref_To_Local'>logpath</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4399"><span class='Ref_To_Local'>logpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s.%d"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4400"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN177"><span class='Ref_to_Global_Var'>main_pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4399"><span class='Ref_To_Local'>logpath</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4399"><span class='Ref_To_Local'>logpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s.%d.%d"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4400"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN177"><span class='Ref_to_Global_Var'>main_pid</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN340"><span class='Ref_to_Member'>tid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN346"><span class='Ref_to_Member'>logfile</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4399"><span class='Ref_To_Local'>logpath</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN346"><span class='Ref_to_Member'>logfile</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"could not open logfile \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                    <a href="pgbench.c.html#LN4399"><span class='Ref_To_Local'>logpath</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgbench.c.html#LN4698"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgbench.c.html#LN175"><span class='Ref_to_Global_Var'>is_connect</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* make connections to the database */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN4371"><span class='Ref_To_Local'>nstate</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN4368"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN846"><span class='Ref_to_Func'>doConnect</span></a><span class='Parentheses'>())</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgbench.c.html#LN4698"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* time after thread and connections set up */ 
</span>    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN350"><span class='Ref_to_Member'>conn_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/portability/instr_time.h.html#LN102"><span class='Ref_to_Macro'>INSTR_TIME_SUBTRACT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN350"><span class='Ref_to_Member'>conn_time</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN349"><span class='Ref_to_Member'>start_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* explicitly initialize the state machines */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN4371"><span class='Ref_To_Local'>nstate</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN4368"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN248"><span class='Ref_to_EnumConst'>CSTATE_CHOOSE_SCRIPT</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* loop till all clients have terminated */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4372"><span class='Ref_To_Local'>remains</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4440"></a>        fd_set      <span class='Declare_Local'>input_mask</span><span class='Delimiter'>; 
</span><a name="LN4441"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>maxsock</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* max socket number to be waited for */ 
</span><a name="LN4442"></a>        <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>min_usec</span><span class='Delimiter'>; 
</span><a name="LN4443"></a>        <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>now_usec</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* set this only if needed */ 
</span> 
        <span class='Comment_Multi_Line'>/* identify which client sockets should be checked for input */ 
</span>        FD_ZERO<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN4440"><span class='Ref_To_Local'>input_mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN4441"><span class='Ref_To_Local'>maxsock</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN4371"><span class='Ref_To_Local'>nstate</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4451"></a>            <a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>st</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN4368"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN257"><span class='Ref_to_EnumConst'>CSTATE_THROTTLE</span></a> <span class='Operator'>&& </span><a href="pgbench.c.html#LN188"><span class='Ref_to_Global_Var'>timer_exceeded</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* interrupt client that has not started a transaction */ 
</span>                <a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN302"><span class='Ref_to_EnumConst'>CSTATE_FINISHED</span></a><span class='Delimiter'>; 
</span>                <a href="../../interfaces/libpq/libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4372"><span class='Ref_To_Local'>remains</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN285"><span class='Ref_to_EnumConst'>CSTATE_SLEEP</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN257"><span class='Ref_to_EnumConst'>CSTATE_THROTTLE</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* a nap from the script, or under throttling */ 
</span><a name="LN4464"></a>                <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>this_usec</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* get current time if needed */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4443"><span class='Ref_To_Local'>now_usec</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN4469"></a>                    <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>now</span><span class='Delimiter'>; 
</span> 
                    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4469"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN4443"><span class='Ref_To_Local'>now_usec</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4469"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* min_usec should be the minimum delay across all clients */ 
</span>                <a href="pgbench.c.html#LN4464"><span class='Ref_To_Local'>this_usec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN285"><span class='Ref_to_EnumConst'>CSTATE_SLEEP</span></a> <span class='Operator'>? 
</span>                             <a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN324"><span class='Ref_to_Member'>sleep_until</span></a> <span class='Operator'>: </span><a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN323"><span class='Ref_to_Member'>txn_scheduled</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="pgbench.c.html#LN4443"><span class='Ref_To_Local'>now_usec</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>&GT; </span><a href="pgbench.c.html#LN4464"><span class='Ref_To_Local'>this_usec</span></a><span class='Parentheses'>) 
</span>                    <a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN4464"><span class='Ref_To_Local'>this_usec</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if st-&GT;state==CSTATE_SLE... &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN284"><span class='Ref_to_EnumConst'>CSTATE_WAIT_RESULT</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * waiting for result from server - nothing to do unless the 
                 * socket is readable 
                 */ 
</span><a name="LN4487"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>sock</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN324"><span class='Ref_to_Proto'>PQsocket</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4487"><span class='Ref_To_Local'>sock</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid socket: %s"</span><span class='Delimiter'>, 
</span>                            <a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgbench.c.html#LN4698"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                FD_SET<span class='Parentheses'>(</span><a href="pgbench.c.html#LN4487"><span class='Ref_To_Local'>sock</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4440"><span class='Ref_To_Local'>input_mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4441"><span class='Ref_To_Local'>maxsock</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN4487"><span class='Ref_To_Local'>sock</span></a><span class='Parentheses'>) 
</span>                    <a href="pgbench.c.html#LN4441"><span class='Ref_To_Local'>maxsock</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN4487"><span class='Ref_To_Local'>sock</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>!= </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a> <span class='Operator'>&& 
</span>                     <a href="pgbench.c.html#LN4451"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>!= </span><a href="pgbench.c.html#LN302"><span class='Ref_to_EnumConst'>CSTATE_FINISHED</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * This client thread is ready to do something, so we don't 
                 * want to wait.  No need to examine additional clients. 
                 */ 
</span>                <a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nstate;i++ &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* also wake up to print the next progress report on time */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN171"><span class='Ref_to_Global_Var'>progress</span></a> <span class='Operator'>&& </span><a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN340"><span class='Ref_to_Member'>tid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* get current time if needed */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4443"><span class='Ref_To_Local'>now_usec</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4518"></a>                <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>now</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4518"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4443"><span class='Ref_To_Local'>now_usec</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4518"><span class='Ref_To_Local'>now</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4443"><span class='Ref_To_Local'>now_usec</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN4378"><span class='Ref_To_Local'>next_report</span></a><span class='Parentheses'>) 
</span>                <a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pgbench.c.html#LN4378"><span class='Ref_To_Local'>next_report</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4443"><span class='Ref_To_Local'>now_usec</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a><span class='Parentheses'>)</span> 
                <a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN4378"><span class='Ref_To_Local'>next_report</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4443"><span class='Ref_To_Local'>now_usec</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If no clients are ready to execute actions, sleep until we receive 
         * data from the server, or a nap-time specified in the script ends, 
         * or it's time to print a progress report.  Update input_mask to show 
         * which client(s) received data. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgbench.c.html#LN4441"><span class='Ref_To_Local'>maxsock</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4538"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>nsocks</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* return from select(2) */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>!= </span><a href="../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4542"></a>                <span class='Control'>struct</span> timeval <span class='Declare_Local'>timeout</span><span class='Delimiter'>; 
</span> 
                <a href="pgbench.c.html#LN4542"><span class='Ref_To_Local'>timeout</span></a><span class='Operator'>.</span>tv_sec <span class='Operator'>= </span><a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4542"><span class='Ref_To_Local'>timeout</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>= </span><a href="pgbench.c.html#LN4442"><span class='Ref_To_Local'>min_usec</span></a> <span class='Operator'>% </span><span class='Number'>1000000</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4538"><span class='Ref_To_Local'>nsocks</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN373"><span class='Ref_to_Macro'>select</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4441"><span class='Ref_To_Local'>maxsock</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4440"><span class='Ref_To_Local'>input_mask</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4542"><span class='Ref_To_Local'>timeout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="pgbench.c.html#LN4538"><span class='Ref_To_Local'>nsocks</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN373"><span class='Ref_to_Macro'>select</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4441"><span class='Ref_To_Local'>maxsock</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4440"><span class='Ref_To_Local'>input_mask</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4538"><span class='Ref_To_Local'>nsocks</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span><a href="../../interfaces/libpq/win32.h.html#LN17"><span class='Ref_to_Const'>EINTR</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* On EINTR, go back to top of loop */ 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* must be something wrong */ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"select() failed: %s\n"</span><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgbench.c.html#LN4698"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if min_usec&GT;0&&maxsock!=... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* If we didn't call select(), don't try to read any data */ 
</span>            FD_ZERO<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN4440"><span class='Ref_To_Local'>input_mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* ok, advance the state machine of each connection */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgbench.c.html#LN4371"><span class='Ref_To_Local'>nstate</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4571"></a>            <a href="pgbench.c.html#LN308"><span class='Ref_to_Typedef'>CState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>st</span> <span class='Operator'>= &</span><a href="pgbench.c.html#LN4368"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4571"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN284"><span class='Ref_to_EnumConst'>CSTATE_WAIT_RESULT</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* don't call doCustom unless data is available */ 
</span><a name="LN4576"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>sock</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN324"><span class='Ref_to_Proto'>PQsocket</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4571"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4576"><span class='Ref_To_Local'>sock</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"invalid socket: %s"</span><span class='Delimiter'>, 
</span>                            <a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4571"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN310"><span class='Ref_to_Member'>con</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgbench.c.html#LN4698"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>FD_ISSET<span class='Parentheses'>(</span><a href="pgbench.c.html#LN4576"><span class='Ref_To_Local'>sock</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4440"><span class='Ref_To_Local'>input_mask</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4571"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN302"><span class='Ref_to_EnumConst'>CSTATE_FINISHED</span></a> <span class='Operator'>|| 
</span>                     <a href="pgbench.c.html#LN4571"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* this client is done, no need to consider it anymore */ 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="pgbench.c.html#LN1956"><span class='Ref_to_Func'>doCustom</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4571"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4380"><span class='Ref_To_Local'>aggs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If doCustom changed client to finished state, reduce remains */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4571"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN302"><span class='Ref_to_EnumConst'>CSTATE_FINISHED</span></a> <span class='Operator'>|| </span><a href="pgbench.c.html#LN4571"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN312"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="pgbench.c.html#LN301"><span class='Ref_to_EnumConst'>CSTATE_ABORTED</span></a><span class='Parentheses'>) 
</span>                <a href="pgbench.c.html#LN4372"><span class='Ref_To_Local'>remains</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nstate;i++ &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* progress report is made by thread 0 for all threads */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN171"><span class='Ref_to_Global_Var'>progress</span></a> <span class='Operator'>&& </span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN340"><span class='Ref_to_Member'>tid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4605"></a>            <a href="../../include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>now_time</span><span class='Delimiter'>; 
</span><a name="LN4606"></a>            <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>now</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4605"><span class='Ref_To_Local'>now_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgbench.c.html#LN4606"><span class='Ref_To_Local'>now</span></a> <span class='Operator'>= </span><a href="../../include/portability/instr_time.h.html#LN137"><span class='Ref_to_Macro'>INSTR_TIME_GET_MICROSEC</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4605"><span class='Ref_To_Local'>now_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4606"><span class='Ref_To_Local'>now</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN4378"><span class='Ref_To_Local'>next_report</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* generate and show report */ 
</span><a name="LN4613"></a>                <a href="pgbench.c.html#LN228"><span class='Ref_to_Struct'>StatsData</span></a>   <span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span><a name="LN4614"></a>                <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>run</span> <span class='Operator'>= </span><a href="pgbench.c.html#LN4606"><span class='Ref_To_Local'>now</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4377"><span class='Ref_To_Local'>last_report</span></a><span class='Delimiter'>; 
</span><a name="LN4615"></a>                <span class='Keyword'>double</span>      <span class='Declare_Local'>tps</span><span class='Delimiter'>, 
</span><a name="LN4616"></a>                            <span class='Declare_Local'>total_run</span><span class='Delimiter'>, 
</span><a name="LN4617"></a>                            <span class='Declare_Local'>latency</span><span class='Delimiter'>, 
</span><a name="LN4618"></a>                            <span class='Declare_Local'>sqlat</span><span class='Delimiter'>, 
</span><a name="LN4619"></a>                            <span class='Declare_Local'>lag</span><span class='Delimiter'>, 
</span><a name="LN4620"></a>                            <span class='Declare_Local'>stdev</span><span class='Delimiter'>; 
</span><a name="LN4621"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>tbuf</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Add up the statistics of all threads. 
                 * 
                 * XXX: No locking. There is no guarantee that we get an 
                 * atomic snapshot of the transaction count and latencies, so 
                 * these figures can well be off by a small amount. The 
                 * progress is report's purpose is to give a quick overview of 
                 * how the test is going, so that shouldn't matter too much. 
                 * (If a read from a 64-bit integer is not atomic, you might 
                 * get a "torn" read and completely bogus latencies though!) 
                 */ 
</span>                <a href="pgbench.c.html#LN782"><span class='Ref_to_Func'>initStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/ecpg/test/expected/thread-thread.c.html#LN43"><span class='Ref_to_Global_Var'>nthreads</span></a><span class='Delimiter'>; </span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pgbench.c.html#LN766"><span class='Ref_to_Func'>mergeSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN766"><span class='Ref_to_Func'>mergeSimpleStats</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Delimiter'>; 
</span>                    <a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a> <span class='Operator'>+= </span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Delimiter'>[</span><a href="pgbench.c.html#LN4373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pgbench.c.html#LN351"><span class='Ref_to_Member'>stats</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="pgbench.c.html#LN4616"><span class='Ref_To_Local'>total_run</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4606"><span class='Ref_To_Local'>now</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4376"><span class='Ref_To_Local'>thread_start</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4615"><span class='Ref_To_Local'>tps</span></a> <span class='Operator'>= </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4379"><span class='Ref_To_Local'>last</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="pgbench.c.html#LN4614"><span class='Ref_To_Local'>run</span></a><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4617"><span class='Ref_To_Local'>latency</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>001</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4379"><span class='Ref_To_Local'>last</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a><span class='Parentheses'>) </span><span class='Operator'>/ 
</span>                    <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4379"><span class='Ref_To_Local'>last</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4618"><span class='Ref_To_Local'>sqlat</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN221"><span class='Ref_to_Member'>sum2</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4379"><span class='Ref_To_Local'>last</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN234"><span class='Ref_to_Member'>latency</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN221"><span class='Ref_to_Member'>sum2</span></a><span class='Parentheses'>) 
</span>                    <span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4379"><span class='Ref_To_Local'>last</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4620"><span class='Ref_To_Local'>stdev</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>001</span> <span class='Operator'>* </span>sqrt<span class='Parentheses'>(</span><a href="pgbench.c.html#LN4618"><span class='Ref_To_Local'>sqlat</span></a> <span class='Operator'>- </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>* </span><a href="pgbench.c.html#LN4617"><span class='Ref_To_Local'>latency</span></a> <span class='Operator'>* </span><a href="pgbench.c.html#LN4617"><span class='Ref_To_Local'>latency</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4619"><span class='Ref_To_Local'>lag</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>001</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4379"><span class='Ref_To_Local'>last</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN235"><span class='Ref_to_Member'>lag</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN220"><span class='Ref_to_Member'>sum</span></a><span class='Parentheses'>) </span><span class='Operator'>/ 
</span>                    <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4379"><span class='Ref_To_Local'>last</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN231"><span class='Ref_to_Member'>cnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN172"><span class='Ref_to_Global_Var'>progress_timestamp</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * On some platforms the current system timestamp is 
                     * available in now_time, but rather than get entangled 
                     * with that, we just eat the cost of an extra syscall in 
                     * all cases. 
                     */ 
</span><a name="LN4661"></a>                    <span class='Control'>struct</span> timeval <span class='Declare_Local'>tv</span><span class='Delimiter'>; 
</span> 
                    <a href="../../port/gettimeofday.c.html#LN103"><span class='Ref_to_Func'>gettimeofday</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN4661"><span class='Ref_To_Local'>tv</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4621"><span class='Ref_To_Local'>tbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4621"><span class='Ref_To_Local'>tbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%ld.%03ld s"</span><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN4661"><span class='Ref_To_Local'>tv</span></a><span class='Operator'>.</span>tv_sec<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="pgbench.c.html#LN4661"><span class='Ref_To_Local'>tv</span></a><span class='Operator'>.</span>tv_usec <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4621"><span class='Ref_To_Local'>tbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4621"><span class='Ref_To_Local'>tbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%.1f s"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4616"><span class='Ref_To_Local'>total_run</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                        <span class='String'>"progress: %s, %.1f tps, lat %.3f ms stddev %.3f"</span><span class='Delimiter'>, 
</span>                        <a href="pgbench.c.html#LN4621"><span class='Ref_To_Local'>tbuf</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4615"><span class='Ref_To_Local'>tps</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4617"><span class='Ref_To_Local'>latency</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4620"><span class='Ref_To_Local'>stdev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN132"><span class='Ref_to_Global_Var'>throttle_delay</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>", lag %.3f ms"</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4619"><span class='Ref_To_Local'>lag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN140"><span class='Ref_to_Global_Var'>latency_limit</span></a><span class='Parentheses'>) 
</span>                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>", "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" skipped"</span><span class='Delimiter'>, 
</span>                                <a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a> <span class='Operator'>- </span><a href="pgbench.c.html#LN4379"><span class='Ref_To_Local'>last</span></a><span class='Operator'>.</span><a href="pgbench.c.html#LN232"><span class='Ref_to_Member'>skipped</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pgbench.c.html#LN4379"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN4613"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span>                <a href="pgbench.c.html#LN4377"><span class='Ref_To_Local'>last_report</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN4606"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Ensure that the next report is in the future, in case 
                 * pgbench/postgres got stuck somewhere. 
                 */ 
</span>                <span class='Control'>do</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pgbench.c.html#LN4378"><span class='Ref_To_Local'>next_report</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="pgbench.c.html#LN171"><span class='Ref_to_Global_Var'>progress</span></a> <span class='Operator'>*</span><span class='Number'>1000000</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4606"><span class='Ref_To_Local'>now</span></a> <span class='Operator'>&GT;= </span><a href="pgbench.c.html#LN4378"><span class='Ref_To_Local'>next_report</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if now&GT;=next_report &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if progress&&thread-&GT;tid... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while remains&GT;0 &raquo; </span> 
 
<a name="LN4698"></a><span class='Label'>done</span><span class='Operator'>: 
</span>    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4369"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN2553"><span class='Ref_to_Func'>disconnect_all</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4368"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4371"><span class='Ref_To_Local'>nstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4370"><span class='Ref_To_Local'>end</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/portability/instr_time.h.html#LN114"><span class='Ref_to_Macro'>INSTR_TIME_ACCUM_DIFF</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN350"><span class='Ref_to_Member'>conn_time</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4370"><span class='Ref_To_Local'>end</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4369"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN346"><span class='Ref_to_Member'>logfile</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN168"><span class='Ref_to_Global_Var'>agg_interval</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* log aggregated but not yet reported transactions */ 
</span>            <a href="pgbench.c.html#LN452"><span class='Ref_to_Proto'>doLog</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4368"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgbench.c.html#LN4380"><span class='Ref_To_Local'>aggs</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        fclose<span class='Parentheses'>(</span><a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN346"><span class='Ref_to_Member'>logfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgbench.c.html#LN4367"><span class='Ref_To_Local'>thread</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN346"><span class='Ref_to_Member'>logfile</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end threadRun &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Support for duration option: set timer_exceeded after so many seconds. 
 */ 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
<span class='Keyword'>static void 
</span><a name="LN4723"></a><span class='Declare_Function'>handle_sig_alarm</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN1078"><span class='Ref_to_Const'>SIGNAL_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pgbench.c.html#LN188"><span class='Ref_to_Global_Var'>timer_exceeded</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN4729"></a><span class='Declare_Function'>setalarm</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>seconds</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN193"><span class='Ref_to_Const'>SIGALRM</span></a><span class='Delimiter'>, </span><a href="../../backend/utils/misc/timeout.c.html#LN257"><span class='Ref_to_Func'>handle_sig_alarm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    alarm<span class='Parentheses'>(</span><a href="pgbench.c.html#LN4729"><span class='Ref_to_Parameter'>seconds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
<span class='Keyword'>static VOID </span>CALLBACK 
<a name="LN4738"></a><span class='Declare_Function'>win32_timer_callback</span><span class='Parentheses'>(</span>PVOID <span class='Declare_Parameter'>lpParameter</span><span class='Delimiter'>, </span>BOOLEAN <span class='Declare_Parameter'>TimerOrWaitFired</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pgbench.c.html#LN188"><span class='Ref_to_Global_Var'>timer_exceeded</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN4744"></a><span class='Declare_Function'>setalarm</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>seconds</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4746"></a>    HANDLE      <span class='Declare_Local'>queue</span><span class='Delimiter'>; 
</span><a name="LN4747"></a>    HANDLE      <span class='Declare_Local'>timer</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This function will be called at most once, so we can cheat a bit. */ 
</span>    <a href="pgbench.c.html#LN4746"><span class='Ref_To_Local'>queue</span></a> <span class='Operator'>= </span>CreateTimerQueue<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4744"><span class='Ref_to_Parameter'>seconds</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>((</span><span class='Keyword'>DWORD</span><span class='Parentheses'>) </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Number'>1000</span> <span class='Operator'>|| 
</span>        <span class='Operator'>!</span>CreateTimerQueueTimer<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgbench.c.html#LN4747"><span class='Ref_To_Local'>timer</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4746"><span class='Ref_To_Local'>queue</span></a><span class='Delimiter'>, 
</span>                               <a href="pgbench.c.html#LN4737"><span class='Ref_to_Func'>win32_timer_callback</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4744"><span class='Ref_to_Parameter'>seconds</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                               WT_EXECUTEINTIMERTHREAD <span class='Operator'>| </span>WT_EXECUTEONLYONCE<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"failed to set timer\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../test/isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* partial pthread implementation for Windows */ 
</span> 
<a name="LN4763"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>win32_pthread</span> 
<span class='Delimiter'>{ 
</span><a name="LN4765"></a>    HANDLE      <span class='Declare_Member'>handle</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>*</span>routine<span class='Parentheses'>) (</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4767"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>arg</span><span class='Delimiter'>; 
</span><a name="LN4768"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>result</span><span class='Delimiter'>; 
</span><a name="LN4769"></a>} <span class='Declare_Typedef'>win32_pthread</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static unsigned </span>__stdcall 
<a name="LN4772"></a><span class='Declare_Function'>win32_pthread_run</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4774"></a>    <a href="pgbench.c.html#LN4763"><span class='Ref_to_Struct'>win32_pthread</span></a> <span class='Operator'>*</span><span class='Declare_Local'>th</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4763"><span class='Ref_to_Struct'>win32_pthread</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pgbench.c.html#LN4772"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN4774"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN4768"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN4774"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span>routine<span class='Parentheses'>(</span><a href="pgbench.c.html#LN4774"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN4767"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN4782"></a><span class='Declare_Function'>pthread_create</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN68"><span class='Ref_to_Typedef'>pthread_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>thread</span><span class='Delimiter'>, 
</span><a name="LN4783"></a>               <a href="pgbench.c.html#LN69"><span class='Ref_to_Typedef'>pthread_attr_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attr</span><span class='Delimiter'>, 
</span>               <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>*</span>start_routine<span class='Parentheses'>) (</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN4785"></a>               <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span> 
<span class='Delimiter'>{ 
</span><a name="LN4787"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span><span class='Delimiter'>; 
</span><a name="LN4788"></a>    <a href="pgbench.c.html#LN4763"><span class='Ref_to_Struct'>win32_pthread</span></a> <span class='Operator'>*</span><span class='Declare_Local'>th</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN4788"><span class='Ref_To_Local'>th</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4763"><span class='Ref_to_Struct'>win32_pthread</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4763"><span class='Ref_to_Struct'>win32_pthread</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN4788"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span>routine <span class='Operator'>= </span>start_routine<span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN4788"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN4767"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN4785"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span>    <a href="pgbench.c.html#LN4788"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN4768"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pgbench.c.html#LN4788"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN4765"><span class='Ref_to_Member'>handle</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>HANDLE<span class='Parentheses'>) </span>_beginthreadex<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4771"><span class='Ref_to_Func'>win32_pthread_run</span></a><span class='Delimiter'>, </span><a href="pgbench.c.html#LN4788"><span class='Ref_To_Local'>th</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4788"><span class='Ref_To_Local'>th</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN4765"><span class='Ref_to_Member'>handle</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgbench.c.html#LN4787"><span class='Ref_To_Local'>save_errno</span></a> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4788"><span class='Ref_To_Local'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="pgbench.c.html#LN4787"><span class='Ref_To_Local'>save_errno</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="pgbench.c.html#LN4782"><span class='Ref_to_Parameter'>thread</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN4788"><span class='Ref_To_Local'>th</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pthread_create &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN4808"></a><span class='Declare_Function'>pthread_join</span><span class='Parentheses'>(</span><a href="pgbench.c.html#LN68"><span class='Ref_to_Typedef'>pthread_t</span></a> <span class='Declare_Parameter'>th</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>thread_return</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4808"><span class='Ref_to_Parameter'>th</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="pgbench.c.html#LN4808"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN4765"><span class='Ref_to_Member'>handle</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> errno <span class='Operator'>= </span>EINVAL<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>WaitForSingleObject<span class='Parentheses'>(</span><a href="pgbench.c.html#LN4808"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN4765"><span class='Ref_to_Member'>handle</span></a><span class='Delimiter'>, </span>INFINITE<span class='Parentheses'>) </span><span class='Operator'>!= </span>WAIT_OBJECT_0<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../port/win32error.c.html#LN169"><span class='Ref_to_Func'>_dosmaperr</span></a><span class='Parentheses'>(</span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> errno<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgbench.c.html#LN4808"><span class='Ref_to_Parameter'>thread_return</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="pgbench.c.html#LN4808"><span class='Ref_to_Parameter'>thread_return</span></a> <span class='Operator'>= </span><a href="pgbench.c.html#LN4808"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN4768"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>; 
</span> 
    CloseHandle<span class='Parentheses'>(</span><a href="pgbench.c.html#LN4808"><span class='Ref_to_Parameter'>th</span></a><span class='Operator'>-&GT;</span><a href="pgbench.c.html#LN4765"><span class='Ref_to_Member'>handle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pgbench.c.html#LN4808"><span class='Ref_to_Parameter'>th</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>