<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\psql\copy.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\psql\copy.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:02 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/* 
 * psql - the PostgreSQL interactive terminal 
 * 
 * Copyright (c) 2000-2017, PostgreSQL Global Development Group 
 * 
 * src/bin/psql/copy.c 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"copy.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;signal.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span>             <span class='Comment_Single_Line'>/* for isatty */ 
</span><span class='Directive'>#else</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;io.h&GT;</span>                 <span class='Comment_Single_Line'>/* I think */ 
</span><span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"libpq-fe.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pqexpbuffer.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"settings.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"prompt.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"stringutils.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * parse_slash_copy 
 * -- parses \copy command line 
 * 
 * The documented syntax is: 
 *  \copy tablename [(columnlist)] from|to filename [options] 
 *  \copy ( query stmt ) to filename [options] 
 * 
 * where 'filename' can be one of the following: 
 *  '&LT;file path&GT;' | PROGRAM '&LT;command&GT;' | stdin | stdout | pstdout | pstdout 
 * and 'query' can be one of the following: 
 *  SELECT | UPDATE | INSERT | DELETE 
 * 
 * An undocumented fact is that you can still write BINARY before the 
 * tablename; this is a hangover from the pre-7.3 syntax.  The options 
 * syntax varies across backend versions, but we avoid all that mess 
 * by just transmitting the stuff after the filename literally. 
 * 
 * table name can be double-quoted and can have a schema part. 
 * column names can be double-quoted. 
 * filename can be single-quoted like SQL literals. 
 * command must be single-quoted like SQL literals. 
 * 
 * returns a malloc'ed structure with the options, or NULL on parsing error 
 */ 
</span> 
<a name="LN53"></a><span class='Control'>struct</span> <span class='Declare_Struct'>copy_options</span> 
<span class='Delimiter'>{ 
</span><a name="LN55"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>before_tofrom</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* COPY string before TO/FROM */ 
</span><a name="LN56"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>after_tofrom</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* COPY string after TO/FROM filename */ 
</span><a name="LN57"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>file</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* NULL = stdin/stdout */ 
</span><a name="LN58"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>program</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* is 'file' a program to popen? */ 
</span><a name="LN59"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>psql_inout</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* true = use psql stdin/stdout */ 
</span><a name="LN60"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>from</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* true = FROM, false = TO */ 
</span><span class='Delimiter'>}; 
</span> 
 
<span class='Keyword'>static void 
</span><a name="LN65"></a><span class='Declare_Function'>free_copy_options</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="copy.c.html#LN53"><span class='Ref_to_Struct'>copy_options</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN65"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN65"><span class='Ref_to_Parameter'>ptr</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN65"><span class='Ref_to_Parameter'>ptr</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN56"><span class='Ref_to_Member'>after_tofrom</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN65"><span class='Ref_to_Parameter'>ptr</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN65"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* concatenate "more" onto "var", freeing the original value of *var */ 
</span><span class='Keyword'>static void 
</span><a name="LN78"></a><span class='Declare_Function'>xstrcat</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>more</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN80"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>newvar</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN80"><span class='Ref_To_Local'>newvar</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s%s"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="copy.c.html#LN78"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN78"><span class='Ref_to_Parameter'>more</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="copy.c.html#LN78"><span class='Ref_to_Parameter'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="copy.c.html#LN78"><span class='Ref_to_Parameter'>var</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN80"><span class='Ref_To_Local'>newvar</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static </span><span class='Control'>struct</span> <a href="copy.c.html#LN53"><span class='Ref_to_Struct'>copy_options</span></a> <span class='Operator'>* 
</span><a name="LN89"></a><span class='Declare_Function'>parse_slash_copy</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN91"></a>    <span class='Control'>struct</span> <a href="copy.c.html#LN53"><span class='Ref_to_Struct'>copy_options</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN92"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>token</span><span class='Delimiter'>; 
</span><a name="LN93"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>whitespace</span> <span class='Operator'>= </span><span class='String'>" \t\n\r"</span><span class='Delimiter'>; 
</span><a name="LN94"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>nonstd_backslash</span> <span class='Operator'>= </span><a href="common.h.html#LN41"><span class='Ref_to_Proto'>standard_strings</span></a><span class='Parentheses'>() </span><span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN89"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\copy: arguments required\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="copy.c.html#LN53"><span class='Ref_to_Struct'>copy_options</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* initialize for appending */ 
</span> 
    <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN89"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN93"><span class='Ref_To_Local'>whitespace</span></a><span class='Delimiter'>, </span><span class='String'>".,()"</span><span class='Delimiter'>, </span><span class='String'>"\""</span><span class='Delimiter'>, 
</span>                    <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* The following can be removed when we drop 7.3 syntax support */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"binary"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN93"><span class='Ref_To_Local'>whitespace</span></a><span class='Delimiter'>, </span><span class='String'>".,()"</span><span class='Delimiter'>, </span><span class='String'>"\""</span><span class='Delimiter'>, 
</span>                        <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Handle COPY (query) case */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'('</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN124"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>parens</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN124"><span class='Ref_To_Local'>parens</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><span class='String'>" "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN93"><span class='Ref_To_Local'>whitespace</span></a><span class='Delimiter'>, </span><span class='String'>"()"</span><span class='Delimiter'>, </span><span class='String'>"\"'"</span><span class='Delimiter'>, 
</span>                            <a href="copy.c.html#LN94"><span class='Ref_To_Local'>nonstd_backslash</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'('</span><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN124"><span class='Ref_To_Local'>parens</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>')'</span><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN124"><span class='Ref_To_Local'>parens</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><span class='String'>" "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN93"><span class='Ref_To_Local'>whitespace</span></a><span class='Delimiter'>, </span><span class='String'>".,()"</span><span class='Delimiter'>, </span><span class='String'>"\""</span><span class='Delimiter'>, 
</span>                    <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * strtokx() will not have returned a multi-character token starting with 
     * '.', so we don't need strcmp() here.  Likewise for '(', etc, below. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* handle schema . table */ 
</span>        <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN93"><span class='Ref_To_Local'>whitespace</span></a><span class='Delimiter'>, </span><span class='String'>".,()"</span><span class='Delimiter'>, </span><span class='String'>"\""</span><span class='Delimiter'>, 
</span>                        <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN93"><span class='Ref_To_Local'>whitespace</span></a><span class='Delimiter'>, </span><span class='String'>".,()"</span><span class='Delimiter'>, </span><span class='String'>"\""</span><span class='Delimiter'>, 
</span>                        <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'('</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* handle parenthesized column list */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><span class='String'>" "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN93"><span class='Ref_To_Local'>whitespace</span></a><span class='Delimiter'>, </span><span class='String'>"()"</span><span class='Delimiter'>, </span><span class='String'>"\""</span><span class='Delimiter'>, 
</span>                            <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>')'</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><span class='String'>" "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN77"><span class='Ref_to_Func'>xstrcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN93"><span class='Ref_To_Local'>whitespace</span></a><span class='Delimiter'>, </span><span class='String'>".,()"</span><span class='Delimiter'>, </span><span class='String'>"\""</span><span class='Delimiter'>, 
</span>                        <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if token[0]=='(' &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"from"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN60"><span class='Ref_to_Member'>from</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"to"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN60"><span class='Ref_to_Member'>from</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* { 'filename' | PROGRAM 'command' | STDIN | STDOUT | PSTDIN | PSTDOUT } */ 
</span>    <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN93"><span class='Ref_To_Local'>whitespace</span></a><span class='Delimiter'>, </span><span class='String'>";"</span><span class='Delimiter'>, </span><span class='String'>"'"</span><span class='Delimiter'>, 
</span>                    <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"program"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN204"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>toklen</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN93"><span class='Ref_To_Local'>whitespace</span></a><span class='Delimiter'>, </span><span class='String'>";"</span><span class='Delimiter'>, </span><span class='String'>"'"</span><span class='Delimiter'>, 
</span>                        <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The shell command must be quoted. This isn't fool-proof, but 
         * catches most quoting errors. 
         */ 
</span>        <a href="copy.c.html#LN204"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\''</span> <span class='Operator'>|| </span><a href="copy.c.html#LN204"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span> <span class='Operator'>|| </span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN204"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\''</span><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN251"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
        <a href="stringutils.h.html#LN21"><span class='Ref_to_Proto'>strip_quotes</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN58"><span class='Ref_to_Member'>program</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_strcasecmp(token,"... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"stdin"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>             <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"stdout"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"pstdin"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>             <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>"pstdout"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN59"><span class='Ref_to_Member'>psql_inout</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* filename can be optionally quoted */ 
</span>        <a href="stringutils.h.html#LN21"><span class='Ref_to_Proto'>strip_quotes</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="common.h.html#LN44"><span class='Ref_to_Proto'>expand_tilde</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Collect the rest of the line (COPY options) */ 
</span>    <a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="stringutils.h.html#LN12"><span class='Ref_to_Proto'>strtokx</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                    <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN56"><span class='Ref_to_Member'>after_tofrom</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
<a name="LN251"></a><span class='Label'>error</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>        <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\copy: parse error at \"%s\"\n"</span><span class='Delimiter'>, </span><a href="copy.c.html#LN92"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\copy: parse error at end of line\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN64"><span class='Ref_to_Func'>free_copy_options</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN91"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_slash_copy &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Execute a \copy command (frontend copy). We have to open a file (or execute 
 * a command), then submit a COPY query to the backend and either feed it data 
 * from the file or route its response into the file. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN268"></a><span class='Declare_Function'>do_copy</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN270"></a>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN271"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>copystream</span><span class='Delimiter'>; 
</span><a name="LN272"></a>    <span class='Control'>struct</span> <a href="copy.c.html#LN53"><span class='Ref_to_Struct'>copy_options</span></a> <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span><a name="LN273"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>success</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* parse options */ 
</span>    <a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN88"><span class='Ref_to_Func'>parse_slash_copy</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN268"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* prepare to read or write the target file */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a> <span class='Operator'>&& !</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN58"><span class='Ref_to_Member'>program</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN60"><span class='Ref_to_Member'>from</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN58"><span class='Ref_to_Member'>program</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN313"><span class='Ref_to_Macro'>popen</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Delimiter'>, </span><a href="../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Delimiter'>, </span><a href="../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN59"><span class='Ref_to_Member'>psql_inout</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a> <span class='Operator'>= </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN102"><span class='Ref_to_Member'>cur_cmd_source</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a> <span class='Operator'>= </span>stdin<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN58"><span class='Ref_to_Member'>program</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="../../include/fe_utils/print.h.html#LN182"><span class='Ref_to_Proto'>disable_sigpipe_trap</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN313"><span class='Ref_to_Macro'>popen</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN59"><span class='Ref_to_Member'>psql_inout</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a> <span class='Operator'>= </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN83"><span class='Ref_to_Member'>queryFout</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a> <span class='Operator'>= </span>stdout<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN58"><span class='Ref_to_Member'>program</span></a><span class='Parentheses'>) 
</span>            <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not execute command \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"%s: %s\n"</span><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN64"><span class='Ref_to_Func'>free_copy_options</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN58"><span class='Ref_to_Member'>program</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN339"></a>        <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>st</span><span class='Delimiter'>; 
</span><a name="LN340"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* make sure the specified file is not a directory */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="copy.c.html#LN340"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>fstat<span class='Parentheses'>(</span>fileno<span class='Parentheses'>(</span><a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN339"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not stat file \"%s\": %s\n"</span><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN340"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="../../include/port/win32.h.html#LN429"><span class='Ref_to_Macro'>S_ISDIR</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN339"><span class='Ref_To_Local'>st</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
            <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"%s: cannot copy from/to a directory\n"</span><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN340"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../include/port/win32.h.html#LN429"><span class='Ref_to_Macro'>S_ISDIR</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN339"><span class='Ref_To_Local'>st</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            fclose<span class='Parentheses'>(</span><a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN64"><span class='Ref_to_Func'>free_copy_options</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !options-&GT;program &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* build the command we will send to the backend */ 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN270"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN270"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"COPY "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN270"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN55"><span class='Ref_to_Member'>before_tofrom</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN60"><span class='Ref_to_Member'>from</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN270"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>" FROM STDIN "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN270"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>" TO STDOUT "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN56"><span class='Ref_to_Member'>after_tofrom</span></a><span class='Parentheses'>) 
</span>        <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN270"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN56"><span class='Ref_to_Member'>after_tofrom</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* run it like a user command, but with copystream as data source/sink */ 
</span>    <a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN86"><span class='Ref_to_Member'>copyStream</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN273"><span class='Ref_To_Local'>success</span></a> <span class='Operator'>= </span><a href="common.h.html#LN38"><span class='Ref_to_Proto'>SendQuery</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN270"><span class='Ref_To_Local'>query</span></a><span class='Operator'>.</span><a href="../../interfaces/libpq/pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN86"><span class='Ref_to_Member'>copyStream</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../interfaces/libpq/pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN270"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN58"><span class='Ref_to_Member'>program</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN380"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>pclose_rc</span> <span class='Operator'>= </span><a href="../../include/port.h.html#LN314"><span class='Ref_to_Macro'>pclose</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN380"><span class='Ref_To_Local'>pclose_rc</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN380"><span class='Ref_To_Local'>pclose_rc</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not close pipe to external command: %s\n"</span><span class='Delimiter'>, 
</span>                               <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span><a name="LN389"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>reason</span> <span class='Operator'>= </span><a href="../../common/wait_error.c.html#LN30"><span class='Ref_to_Func'>wait_result_to_str</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN380"><span class='Ref_To_Local'>pclose_rc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"%s: %s\n"</span><span class='Delimiter'>, </span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Delimiter'>, 
</span>                               <a href="copy.c.html#LN389"><span class='Ref_To_Local'>reason</span></a> <span class='Operator'>? </span><a href="copy.c.html#LN389"><span class='Ref_To_Local'>reason</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN389"><span class='Ref_To_Local'>reason</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN389"><span class='Ref_To_Local'>reason</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="copy.c.html#LN273"><span class='Ref_To_Local'>success</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../include/fe_utils/print.h.html#LN183"><span class='Ref_to_Proto'>restore_sigpipe_trap</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if options-&GT;program &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="copy.c.html#LN271"><span class='Ref_To_Local'>copystream</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"%s: %s\n"</span><span class='Delimiter'>, </span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN57"><span class='Ref_to_Member'>file</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN273"><span class='Ref_To_Local'>success</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if options-&GT;file!=NULL &raquo; </span> 
    <a href="copy.c.html#LN64"><span class='Ref_to_Func'>free_copy_options</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN272"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="copy.c.html#LN273"><span class='Ref_To_Local'>success</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end do_copy &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Functions for handling COPY IN/OUT data transfer. 
 * 
 * If you want to use COPY TO STDOUT/FROM STDIN in your application, 
 * this is the code to steal ;) 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * handleCopyOut 
 * receives data as a result of a COPY ... TO STDOUT command 
 * 
 * conn should be a database connection that you just issued COPY TO on 
 * and got back a PGRES_COPY_OUT result. 
 * copystream is the file stream for the data to go to. 
 * The final status for the COPY is returned into *res (but note 
 * we already reported the error, if it's not a success result). 
 * 
 * result is true if successful, false if not. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN434"></a><span class='Declare_Function'>handleCopyOut</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>copystream</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>res</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN436"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>OK</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN437"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN438"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN438"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN433"><span class='Ref_to_Proto'>PQgetCopyData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN434"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN437"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN438"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* done or server/connection error */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN437"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN436"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>&& </span>fwrite<span class='Parentheses'>(</span><a href="copy.c.html#LN437"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="copy.c.html#LN438"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN434"><span class='Ref_to_Parameter'>copystream</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="copy.c.html#LN438"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not write COPY data: %s\n"</span><span class='Delimiter'>, 
</span>                           <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* complain only once, keep reading data from server */ 
</span>                <a href="copy.c.html#LN436"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN504"><span class='Ref_to_Proto'>PQfreemem</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN437"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN436"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>&& </span>fflush<span class='Parentheses'>(</span><a href="copy.c.html#LN434"><span class='Ref_to_Parameter'>copystream</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"could not write COPY data: %s\n"</span><span class='Delimiter'>, 
</span>                   <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN436"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN438"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== -</span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"COPY data transfer failed: %s"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN434"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN436"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check command status and return to normal libpq state. 
     * 
     * If for some reason libpq is still reporting PGRES_COPY_OUT state, we 
     * would like to forcibly exit that state, since our caller would be 
     * unable to distinguish that situation from reaching the next COPY in a 
     * command string that happened to contain two consecutive COPY TO STDOUT 
     * commands.  However, libpq provides no API for doing that, and in 
     * principle it's a libpq bug anyway if PQgetCopyData() returns -1 or -2 
     * but hasn't exited COPY_OUT state internally.  So we ignore the 
     * possibility here. 
     */ 
</span>    <span class='Operator'>*</span><a href="copy.c.html#LN434"><span class='Ref_to_Parameter'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN434"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="copy.c.html#LN434"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN434"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN436"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN436"><span class='Ref_To_Local'>OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end handleCopyOut &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * handleCopyIn 
 * sends data to complete a COPY ... FROM STDIN command 
 * 
 * conn should be a database connection that you just issued COPY FROM on 
 * and got back a PGRES_COPY_IN result. 
 * copystream is the file stream to read the data from. 
 * isbinary can be set from PQbinaryTuples(). 
 * The final status for the COPY is returned into *res (but note 
 * we already reported the error, if it's not a success result). 
 * 
 * result is true if successful, false if not. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* read chunk size for COPY IN - size is not critical */ 
</span><a name="LN510"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>COPYBUFSIZ</span> <span class='Number'>8192</span> 
 
<span class='Keyword'>bool 
</span><a name="LN513"></a><span class='Declare_Function'>handleCopyIn</span><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>copystream</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isbinary</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>res</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN515"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>OK</span><span class='Delimiter'>; 
</span><a name="LN516"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="copy.c.html#LN510"><span class='Ref_to_Const'>COPYBUFSIZ</span></a><span class='Delimiter'>]; 
</span><a name="LN517"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>showprompt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Establish longjmp destination for exiting from wait-for-input. (This is 
     * only effective while sigint_interrupt_enabled is TRUE.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN1088"><span class='Ref_to_Macro'>sigsetjmp</span></a><span class='Parentheses'>(</span><a href="common.c.html#LN274"><span class='Ref_to_Global_Var'>sigint_interrupt_jmp</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* got here with longjmp */ 
</span> 
        <span class='Comment_Multi_Line'>/* Terminate data transfer */ 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN432"><span class='Ref_to_Proto'>PQputCopyEnd</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN321"><span class='Ref_to_Proto'>PQprotocolVersion</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>                     _<span class='Parentheses'>(</span><span class='String'>"canceled by user"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN515"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN673"><span class='Ref_to_Label'>copyin_cleanup</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Prompt if interactive input */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>isatty<span class='Parentheses'>(</span>fileno<span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>copystream</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN517"><span class='Ref_To_Local'>showprompt</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN124"><span class='Ref_to_Member'>quiet</span></a><span class='Parentheses'>) 
</span>            puts<span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Enter data to be copied followed by a newline.\n"</span> 
                   <span class='String'>"End with a backslash and a period on a line by itself, or an EOF signal."</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="copy.c.html#LN517"><span class='Ref_To_Local'>showprompt</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN515"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>isbinary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* interactive input probably silly, but give one prompt anyway */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN517"><span class='Ref_To_Local'>showprompt</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN554"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>prompt</span> <span class='Operator'>= </span><a href="prompt.h.html#LN14"><span class='Ref_to_Proto'>get_prompt</span></a><span class='Parentheses'>(</span><a href="../../include/fe_utils/psqlscan.h.html#LN47"><span class='Ref_to_EnumConst'>PROMPT_COPY</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN554"><span class='Ref_To_Local'>prompt</span></a><span class='Delimiter'>, </span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN562"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>buflen</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* enable longjmp while waiting for input */ 
</span>            <a href="common.c.html#LN272"><span class='Ref_to_Global_Var'>sigint_interrupt_enabled</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN562"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><a href="copy.c.html#LN516"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="copy.c.html#LN510"><span class='Ref_to_Const'>COPYBUFSIZ</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>copystream</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="common.c.html#LN272"><span class='Ref_to_Global_Var'>sigint_interrupt_enabled</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN562"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN431"><span class='Ref_to_Proto'>PQputCopyData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN516"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN562"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN515"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if isbinary &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN583"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>copydone</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN583"><span class='Ref_To_Local'>copydone</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{</span>                       <span class='Comment_Single_Line'>/* for each input line ... */ 
</span><a name="LN587"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>firstload</span><span class='Delimiter'>; 
</span><a name="LN588"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>linedone</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN517"><span class='Ref_To_Local'>showprompt</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN592"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>prompt</span> <span class='Operator'>= </span><a href="prompt.h.html#LN14"><span class='Ref_to_Proto'>get_prompt</span></a><span class='Parentheses'>(</span><a href="../../include/fe_utils/psqlscan.h.html#LN47"><span class='Ref_to_EnumConst'>PROMPT_COPY</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN592"><span class='Ref_To_Local'>prompt</span></a><span class='Delimiter'>, </span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="copy.c.html#LN587"><span class='Ref_To_Local'>firstload</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN588"><span class='Ref_To_Local'>linedone</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN588"><span class='Ref_To_Local'>linedone</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{</span>                   <span class='Comment_Single_Line'>/* for each bufferload in line ... */ 
</span><a name="LN603"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>linelen</span><span class='Delimiter'>; 
</span><a name="LN604"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fgresult</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* enable longjmp while waiting for input */ 
</span>                <a href="common.c.html#LN272"><span class='Ref_to_Global_Var'>sigint_interrupt_enabled</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <a href="copy.c.html#LN604"><span class='Ref_To_Local'>fgresult</span></a> <span class='Operator'>= </span>fgets<span class='Parentheses'>(</span><a href="copy.c.html#LN516"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN516"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>copystream</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="common.c.html#LN272"><span class='Ref_to_Global_Var'>sigint_interrupt_enabled</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN604"><span class='Ref_To_Local'>fgresult</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="copy.c.html#LN583"><span class='Ref_To_Local'>copydone</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="copy.c.html#LN603"><span class='Ref_To_Local'>linelen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN516"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* current line is done? */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN603"><span class='Ref_To_Local'>linelen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="copy.c.html#LN516"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN603"><span class='Ref_To_Local'>linelen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>                    <a href="copy.c.html#LN588"><span class='Ref_To_Local'>linedone</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* check for EOF marker, but not on a partial line */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN587"><span class='Ref_To_Local'>firstload</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * This code erroneously assumes '\.' on a line alone 
                     * inside a quoted CSV string terminates the \copy. 
                     * http://www.postgresql.org/message-id/E1TdNVQ-0001ju-GO@w 
                     * rigleys.postgresql.org 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN516"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\.\n"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                        strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN516"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\.\r\n"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="copy.c.html#LN583"><span class='Ref_To_Local'>copydone</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <a href="copy.c.html#LN587"><span class='Ref_To_Local'>firstload</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN431"><span class='Ref_to_Proto'>PQputCopyData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN516"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN603"><span class='Ref_To_Local'>linelen</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="copy.c.html#LN515"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <a href="copy.c.html#LN583"><span class='Ref_To_Local'>copydone</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !linedone &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>copystream</span></a> <span class='Operator'>== </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN102"><span class='Ref_to_Member'>cur_cmd_source</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN108"><span class='Ref_to_Member'>lineno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN109"><span class='Ref_to_Member'>stmt_lineno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !copydone &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Check for read error */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>ferror<span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>copystream</span></a><span class='Parentheses'>))</span> 
        <a href="copy.c.html#LN515"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Terminate data transfer.  We can't send an error message if we're using 
     * protocol version 2. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN432"><span class='Ref_to_Proto'>PQputCopyEnd</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><a href="copy.c.html#LN515"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>|| </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN321"><span class='Ref_to_Proto'>PQprotocolVersion</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>                     _<span class='Parentheses'>(</span><span class='String'>"aborted because of read failure"</span><span class='Parentheses'>))</span> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="copy.c.html#LN515"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN673"></a><span class='Label'>copyin_cleanup</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clear the EOF flag on the stream, in case copying ended due to an EOF 
     * signal.  This allows an interactive TTY session to perform another COPY 
     * FROM STDIN later.  (In non-STDIN cases, we're about to close the file 
     * anyway, so it doesn't matter.)  Although we don't ever test the flag 
     * with feof(), some fread() implementations won't read more data if it's 
     * set.  This also clears the error flag, but we already checked that. 
     */ 
</span>    clearerr<span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>copystream</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check command status and return to normal libpq state. 
     * 
     * We do not want to return with the status still PGRES_COPY_IN: our 
     * caller would be unable to distinguish that situation from reaching the 
     * next COPY in a command string that happened to contain two consecutive 
     * COPY FROM STDIN commands.  We keep trying PQputCopyEnd() in the hope 
     * it'll work eventually.  (What's actually likely to happen is that in 
     * attempting to flush the data, libpq will eventually realize that the 
     * connection is lost.  But that's fine; it will get us out of COPY_IN 
     * state, which is what we need.) 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>res</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN91"><span class='Ref_to_EnumConst'>PGRES_COPY_IN</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN515"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* We can't send an error message if we're using protocol version 2 */ 
</span>        <a href="../../interfaces/libpq/libpq-fe.h.html#LN432"><span class='Ref_to_Proto'>PQputCopyEnd</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN321"><span class='Ref_to_Proto'>PQprotocolVersion</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>                     _<span class='Parentheses'>(</span><span class='String'>"trying to exit copy mode"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN323"><span class='Ref_to_Proto'>PQerrorMessage</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN513"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN515"><span class='Ref_To_Local'>OK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN515"><span class='Ref_To_Local'>OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end handleCopyIn &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>