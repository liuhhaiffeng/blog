<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\psql\crosstabview.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\psql\crosstabview.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:02 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/* 
 * psql - the PostgreSQL interactive terminal 
 * 
 * Copyright (c) 2000-2017, PostgreSQL Global Development Group 
 * 
 * src/bin/psql/crosstabview.c 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"common.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"crosstabview.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pqexpbuffer.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"psqlscanslash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"settings.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Value/position from the resultset that goes into the horizontal or vertical 
 * crosstabview header. 
 */ 
</span><a name="LN20"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>_pivot_field</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Pointer obtained from PQgetvalue() for colV or colH. Each distinct 
     * value becomes an entry in the vertical header (colV), or horizontal 
     * header (colH). A Null value is represented by a NULL pointer. 
     */ 
</span><a name="LN27"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>name</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When a sort is requested on an alternative column, this holds 
     * PQgetvalue() for the sort column corresponding to &LT;name&GT;. If &LT;name&GT; 
     * appear multiple times, it's the first value in the order of the results 
     * that is kept. A Null value is represented by a NULL pointer. 
     */ 
</span><a name="LN35"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>sort_value</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Rank of this value, starting at 0. Initially, it's the relative 
     * position of the first appearance of &LT;name&GT; in the resultset. For 
     * example, if successive rows contain B,A,C,A,D then it's B:0,A:1,C:2,D:3 
     * When a sort column is specified, ranks get updated in a final pass to 
     * reflect the desired order. 
     */ 
</span><a name="LN44"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>rank</span><span class='Delimiter'>; 
</span><a name="LN45"></a>}<span class='Auto_Annotations'> &laquo; end _pivot_field &raquo; </span> <span class='Declare_Typedef'>pivot_field</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Node in avl_tree */ 
</span><a name="LN48"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>_avl_node</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Node contents */ 
</span><a name="LN51"></a>    <a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Declare_Member'>field</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Height of this node in the tree (number of nodes on the longest path to 
     * a leaf). 
     */ 
</span><a name="LN57"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>height</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Child nodes. [0] points to left subtree, [1] to right subtree. Never 
     * NULL, points to the empty node avl_tree.end when no left or right 
     * value. 
     */ 
</span><a name="LN64"></a>    <span class='Control'>struct</span> <a href="crosstabview.c.html#LN48"><span class='Ref_to_Struct'>_avl_node</span></a> <span class='Operator'>*</span><span class='Declare_Member'>children</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN65"></a>} <span class='Declare_Typedef'>avl_node</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Control structure for the AVL tree (binary search tree kept 
 * balanced with the AVL algorithm) 
 */ 
</span><a name="LN71"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>_avl_tree</span> 
<span class='Delimiter'>{ 
</span><a name="LN73"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>count</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* Total number of nodes */ 
</span><a name="LN74"></a>    <a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* root of the tree */ 
</span><a name="LN75"></a>    <a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>end</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* Immutable dereferenceable empty tree */ 
</span><a name="LN76"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>avl_tree</span><span class='Delimiter'>; 
</span> 
 
<a name="LN79"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>printCrosstab</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>results</span><span class='Delimiter'>, 
</span><a name="LN80"></a>            <span class='Keyword'>int </span><span class='Declare_Parameter'>num_columns</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>piv_columns</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>field_for_columns</span><span class='Delimiter'>, 
</span><a name="LN81"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>num_rows</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>piv_rows</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>field_for_rows</span><span class='Delimiter'>, 
</span><a name="LN82"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>field_for_data</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN83"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>avlInit</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tree</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>avlMergeValue</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tree</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sort_value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN85"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>avlCollectFields</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tree</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN86"></a>                 <a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fields</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>idx</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN87"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>avlFree</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tree</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>rankSort</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>num_columns</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>piv_columns</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>indexOfColumn</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN90"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>pivotFieldCompare</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN91"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>rankCompare</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Main entry point to this module. 
 * 
 * Process the data from *res according to the options in pset (global), 
 * to generate the horizontal and vertical headers contents, 
 * then call printCrosstab() for the actual output. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN102"></a><span class='Declare_Function'>PrintResultsInCrosstab</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN104"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>retval</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN105"></a>    <a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a>    <span class='Declare_Local'>piv_columns</span><span class='Delimiter'>; 
</span><a name="LN106"></a>    <a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a>    <span class='Declare_Local'>piv_rows</span><span class='Delimiter'>; 
</span><a name="LN107"></a>    <a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array_columns</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN108"></a>    <a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array_rows</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN109"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_columns</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN110"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_rows</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN111"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>field_for_rows</span><span class='Delimiter'>; 
</span><a name="LN112"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>field_for_columns</span><span class='Delimiter'>; 
</span><a name="LN113"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>field_for_data</span><span class='Delimiter'>; 
</span><a name="LN114"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sort_field_for_columns</span><span class='Delimiter'>; 
</span><a name="LN115"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rn</span><span class='Delimiter'>; 
</span> 
    <a href="crosstabview.c.html#LN83"><span class='Ref_to_Proto'>avlInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN106"><span class='Ref_To_Local'>piv_rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN83"><span class='Ref_to_Proto'>avlInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN105"><span class='Ref_To_Local'>piv_columns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\crosstabview: statement did not return a result set\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="crosstabview.c.html#LN270"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\crosstabview: query must return at least three columns\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="crosstabview.c.html#LN270"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Process first optional arg (vertical header column) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN97"><span class='Ref_to_Member'>ctv_args</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="crosstabview.c.html#LN111"><span class='Ref_To_Local'>field_for_rows</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="crosstabview.c.html#LN111"><span class='Ref_To_Local'>field_for_rows</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN89"><span class='Ref_to_Proto'>indexOfColumn</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN97"><span class='Ref_to_Member'>ctv_args</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN111"><span class='Ref_To_Local'>field_for_rows</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="crosstabview.c.html#LN270"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Process second optional arg (horizontal header column) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN97"><span class='Ref_to_Member'>ctv_args</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="crosstabview.c.html#LN112"><span class='Ref_To_Local'>field_for_columns</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="crosstabview.c.html#LN112"><span class='Ref_To_Local'>field_for_columns</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN89"><span class='Ref_to_Proto'>indexOfColumn</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN97"><span class='Ref_to_Member'>ctv_args</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN112"><span class='Ref_To_Local'>field_for_columns</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="crosstabview.c.html#LN270"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Insist that header columns be distinct */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN112"><span class='Ref_To_Local'>field_for_columns</span></a> <span class='Operator'>== </span><a href="crosstabview.c.html#LN111"><span class='Ref_To_Local'>field_for_rows</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\crosstabview: vertical and horizontal headers must be different columns\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="crosstabview.c.html#LN270"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Process third optional arg (data column) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN97"><span class='Ref_to_Member'>ctv_args</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN162"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the data column was not specified, we search for the one not 
         * used as either vertical or horizontal headers.  Must be exactly 
         * three columns, or this won't be unique. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\crosstabview: data column must be specified when query returns more than three columns\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="crosstabview.c.html#LN270"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="crosstabview.c.html#LN113"><span class='Ref_To_Local'>field_for_data</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>!= </span><a href="crosstabview.c.html#LN111"><span class='Ref_To_Local'>field_for_rows</span></a> <span class='Operator'>&& </span><a href="crosstabview.c.html#LN162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>!= </span><a href="crosstabview.c.html#LN112"><span class='Ref_To_Local'>field_for_columns</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="crosstabview.c.html#LN113"><span class='Ref_To_Local'>field_for_data</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN113"><span class='Ref_To_Local'>field_for_data</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pset.ctv_args[2]==NUL... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="crosstabview.c.html#LN113"><span class='Ref_To_Local'>field_for_data</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN89"><span class='Ref_to_Proto'>indexOfColumn</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN97"><span class='Ref_to_Member'>ctv_args</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], </span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN113"><span class='Ref_To_Local'>field_for_data</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="crosstabview.c.html#LN270"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Process fourth optional arg (horizontal header sort column) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN97"><span class='Ref_to_Member'>ctv_args</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="crosstabview.c.html#LN114"><span class='Ref_To_Local'>sort_field_for_columns</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* no sort column */ 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="crosstabview.c.html#LN114"><span class='Ref_To_Local'>sort_field_for_columns</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN89"><span class='Ref_to_Proto'>indexOfColumn</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN97"><span class='Ref_to_Member'>ctv_args</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>], </span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN114"><span class='Ref_To_Local'>sort_field_for_columns</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="crosstabview.c.html#LN270"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First part: accumulate the names that go into the vertical and 
     * horizontal headers, each into an AVL binary tree to build the set of 
     * DISTINCT values. 
     */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN115"><span class='Ref_To_Local'>rn</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN115"><span class='Ref_To_Local'>rn</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN115"><span class='Ref_To_Local'>rn</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN211"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN212"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* horizontal */ 
</span>        <a href="crosstabview.c.html#LN211"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN115"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN112"><span class='Ref_To_Local'>field_for_columns</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN115"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN112"><span class='Ref_To_Local'>field_for_columns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="crosstabview.c.html#LN212"><span class='Ref_To_Local'>val1</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN114"><span class='Ref_To_Local'>sort_field_for_columns</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN115"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN114"><span class='Ref_To_Local'>sort_field_for_columns</span></a><span class='Parentheses'>))</span> 
            <a href="crosstabview.c.html#LN212"><span class='Ref_To_Local'>val1</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN115"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN114"><span class='Ref_To_Local'>sort_field_for_columns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="crosstabview.c.html#LN84"><span class='Ref_to_Proto'>avlMergeValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN105"><span class='Ref_To_Local'>piv_columns</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN211"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN212"><span class='Ref_To_Local'>val1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN105"><span class='Ref_To_Local'>piv_columns</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN73"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>&GT; </span><a href="crosstabview.h.html#LN21"><span class='Ref_to_Const'>CROSSTABVIEW_MAX_COLUMNS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\crosstabview: maximum number of columns (%d) exceeded\n"</span><span class='Delimiter'>, 
</span>                       <a href="crosstabview.h.html#LN21"><span class='Ref_to_Const'>CROSSTABVIEW_MAX_COLUMNS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="crosstabview.c.html#LN270"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* vertical */ 
</span>        <a href="crosstabview.c.html#LN211"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN115"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN111"><span class='Ref_To_Local'>field_for_rows</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>            <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN115"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN111"><span class='Ref_To_Local'>field_for_rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="crosstabview.c.html#LN84"><span class='Ref_to_Proto'>avlMergeValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN106"><span class='Ref_To_Local'>piv_rows</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN211"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for rn=0;rn&LT;PQntuples(res... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Second part: Generate sorted arrays from the AVL trees. 
     */ 
</span> 
    <a href="crosstabview.c.html#LN109"><span class='Ref_To_Local'>num_columns</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN105"><span class='Ref_To_Local'>piv_columns</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN73"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN110"><span class='Ref_To_Local'>num_rows</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN106"><span class='Ref_To_Local'>piv_rows</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN73"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>; 
</span> 
    <a href="crosstabview.c.html#LN107"><span class='Ref_To_Local'>array_columns</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="crosstabview.c.html#LN109"><span class='Ref_To_Local'>num_columns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="crosstabview.c.html#LN108"><span class='Ref_To_Local'>array_rows</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="crosstabview.c.html#LN110"><span class='Ref_To_Local'>num_rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="crosstabview.c.html#LN85"><span class='Ref_to_Proto'>avlCollectFields</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN105"><span class='Ref_To_Local'>piv_columns</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN105"><span class='Ref_To_Local'>piv_columns</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN74"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN107"><span class='Ref_To_Local'>array_columns</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN85"><span class='Ref_to_Proto'>avlCollectFields</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN106"><span class='Ref_To_Local'>piv_rows</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN106"><span class='Ref_To_Local'>piv_rows</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN74"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN108"><span class='Ref_To_Local'>array_rows</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Third part: optionally, process the ranking data for the horizontal 
     * header 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN114"><span class='Ref_To_Local'>sort_field_for_columns</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="crosstabview.c.html#LN88"><span class='Ref_to_Proto'>rankSort</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN109"><span class='Ref_To_Local'>num_columns</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN107"><span class='Ref_To_Local'>array_columns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fourth part: print the crosstab'ed results. 
     */ 
</span>    <a href="crosstabview.c.html#LN104"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN79"><span class='Ref_to_Proto'>printCrosstab</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN102"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, 
</span>                           <a href="crosstabview.c.html#LN109"><span class='Ref_To_Local'>num_columns</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN107"><span class='Ref_To_Local'>array_columns</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN112"><span class='Ref_To_Local'>field_for_columns</span></a><span class='Delimiter'>, 
</span>                           <a href="crosstabview.c.html#LN110"><span class='Ref_To_Local'>num_rows</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN108"><span class='Ref_To_Local'>array_rows</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN111"><span class='Ref_To_Local'>field_for_rows</span></a><span class='Delimiter'>, 
</span>                           <a href="crosstabview.c.html#LN113"><span class='Ref_To_Local'>field_for_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN270"></a><span class='Label'>error_return</span><span class='Operator'>: 
</span>    <a href="crosstabview.c.html#LN87"><span class='Ref_to_Proto'>avlFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN105"><span class='Ref_To_Local'>piv_columns</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN105"><span class='Ref_To_Local'>piv_columns</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN74"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN87"><span class='Ref_to_Proto'>avlFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN106"><span class='Ref_To_Local'>piv_rows</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN106"><span class='Ref_To_Local'>piv_rows</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN74"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN107"><span class='Ref_To_Local'>array_columns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN108"><span class='Ref_To_Local'>array_rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="crosstabview.c.html#LN104"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PrintResultsInCrosstab &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Output the pivoted resultset with the printTable* functions.  Return true 
 * if successful, false otherwise. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN284"></a><span class='Declare_Function'>printCrosstab</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>results</span><span class='Delimiter'>, 
</span><a name="LN285"></a>            <span class='Keyword'>int </span><span class='Declare_Parameter'>num_columns</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>piv_columns</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>field_for_columns</span><span class='Delimiter'>, 
</span><a name="LN286"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>num_rows</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>piv_rows</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>field_for_rows</span><span class='Delimiter'>, 
</span><a name="LN287"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>field_for_data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN289"></a>    <a href="../../include/fe_utils/print.h.html#LN162"><span class='Ref_to_Struct'>printQueryOpt</span></a> <span class='Declare_Local'>popt</span> <span class='Operator'>= </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN90"><span class='Ref_to_Member'>popt</span></a><span class='Delimiter'>; 
</span><a name="LN290"></a>    <a href="../../include/fe_utils/print.h.html#LN142"><span class='Ref_to_Struct'>printTableContent</span></a> <span class='Declare_Local'>cont</span><span class='Delimiter'>; 
</span><a name="LN291"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN292"></a>                <span class='Declare_Local'>rn</span><span class='Delimiter'>; 
</span><a name="LN293"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>col_align</span><span class='Delimiter'>; 
</span><a name="LN294"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>horiz_map</span><span class='Delimiter'>; 
</span><a name="LN295"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>retval</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fe_utils/print.h.html#LN191"><span class='Ref_to_Proto'>printTableInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN164"><span class='Ref_to_Member'>topt</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN166"><span class='Ref_to_Member'>title</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>num_columns</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>num_rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Step 1: set target column names (horizontal header) */ 
</span> 
    <span class='Comment_Multi_Line'>/* The name of the first column is kept unchanged by the pivoting */ 
</span>    <a href="../../include/fe_utils/print.h.html#LN194"><span class='Ref_to_Proto'>printTableAddHeader</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Delimiter'>, 
</span>                        <a href="../../interfaces/libpq/libpq-fe.h.html#LN476"><span class='Ref_to_Proto'>PQfname</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN284"><span class='Ref_to_Parameter'>results</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>field_for_rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                        <a href="../../include/fe_utils/print.h.html#LN208"><span class='Ref_to_Proto'>column_type_alignment</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN481"><span class='Ref_to_Proto'>PQftype</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN284"><span class='Ref_to_Parameter'>results</span></a><span class='Delimiter'>, 
</span>                                                      <a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>field_for_rows</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * To iterate over piv_columns[] by piv_columns[].rank, create a reverse 
     * map associating each piv_columns[].rank to its index in piv_columns. 
     * This avoids an O(N^2) loop later. 
     */ 
</span>    <a href="crosstabview.c.html#LN294"><span class='Ref_To_Local'>horiz_map</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>num_columns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>num_columns</span></a><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="crosstabview.c.html#LN294"><span class='Ref_To_Local'>horiz_map</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>piv_columns</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="crosstabview.c.html#LN44"><span class='Ref_to_Member'>rank</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The display alignment depends on its PQftype(). 
     */ 
</span>    <a href="crosstabview.c.html#LN293"><span class='Ref_To_Local'>col_align</span></a> <span class='Operator'>= </span><a href="../../include/fe_utils/print.h.html#LN208"><span class='Ref_to_Proto'>column_type_alignment</span></a><span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN481"><span class='Ref_to_Proto'>PQftype</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN284"><span class='Ref_to_Parameter'>results</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN287"><span class='Ref_to_Parameter'>field_for_data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>num_columns</span></a><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN324"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colname</span><span class='Delimiter'>; 
</span> 
        <a href="crosstabview.c.html#LN324"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>piv_columns</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN294"><span class='Ref_To_Local'>horiz_map</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]]</span><span class='Operator'>.</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>? 
</span>            <a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>piv_columns</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN294"><span class='Ref_To_Local'>horiz_map</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]]</span><span class='Operator'>.</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>: 
</span>            <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN165"><span class='Ref_to_Member'>nullPrint</span></a> <span class='Operator'>? </span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN165"><span class='Ref_to_Member'>nullPrint</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/fe_utils/print.h.html#LN194"><span class='Ref_to_Proto'>printTableAddHeader</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN324"><span class='Ref_To_Local'>colname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN293"><span class='Ref_To_Local'>col_align</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN294"><span class='Ref_To_Local'>horiz_map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Step 2: set row names in the first output column (vertical header) */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>num_rows</span></a><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN337"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>k</span> <span class='Operator'>= </span><a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>piv_rows</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="crosstabview.c.html#LN44"><span class='Ref_to_Member'>rank</span></a><span class='Delimiter'>; 
</span> 
        <a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN150"><span class='Ref_to_Member'>cells</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN337"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>num_columns</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>piv_rows</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>? 
</span>            <a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>piv_rows</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>: 
</span>            <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN165"><span class='Ref_to_Member'>nullPrint</span></a> <span class='Operator'>? </span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN165"><span class='Ref_to_Member'>nullPrint</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN153"><span class='Ref_to_Member'>cellsadded</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>num_rows</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>num_columns</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Step 3: fill in the content cells. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN292"><span class='Ref_To_Local'>rn</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN292"><span class='Ref_To_Local'>rn</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN284"><span class='Ref_to_Parameter'>results</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN292"><span class='Ref_To_Local'>rn</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN350"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>row_number</span><span class='Delimiter'>; 
</span><a name="LN351"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>col_number</span><span class='Delimiter'>; 
</span><a name="LN352"></a>        <a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rp</span><span class='Delimiter'>, 
</span><a name="LN353"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN354"></a>        <a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Declare_Local'>elt</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find target row */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN284"><span class='Ref_to_Parameter'>results</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN292"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>field_for_rows</span></a><span class='Parentheses'>))</span> 
            <a href="crosstabview.c.html#LN354"><span class='Ref_To_Local'>elt</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN284"><span class='Ref_to_Parameter'>results</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN292"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>field_for_rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="crosstabview.c.html#LN354"><span class='Ref_To_Local'>elt</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="crosstabview.c.html#LN352"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>bsearch<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN354"><span class='Ref_To_Local'>elt</span></a><span class='Delimiter'>, 
</span>                                     <a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>piv_rows</span></a><span class='Delimiter'>, 
</span>                                     <a href="crosstabview.c.html#LN286"><span class='Ref_to_Parameter'>num_rows</span></a><span class='Delimiter'>, 
</span>                                     <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="crosstabview.c.html#LN90"><span class='Ref_to_Proto'>pivotFieldCompare</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN352"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="crosstabview.c.html#LN350"><span class='Ref_To_Local'>row_number</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN352"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN44"><span class='Ref_to_Member'>rank</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find target column */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN284"><span class='Ref_to_Parameter'>results</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN292"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>field_for_columns</span></a><span class='Parentheses'>))</span> 
            <a href="crosstabview.c.html#LN354"><span class='Ref_To_Local'>elt</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN284"><span class='Ref_to_Parameter'>results</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN292"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>field_for_columns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="crosstabview.c.html#LN354"><span class='Ref_To_Local'>elt</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="crosstabview.c.html#LN353"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>bsearch<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN354"><span class='Ref_To_Local'>elt</span></a><span class='Delimiter'>, 
</span>                                     <a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>piv_columns</span></a><span class='Delimiter'>, 
</span>                                     <a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>num_columns</span></a><span class='Delimiter'>, 
</span>                                     <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="crosstabview.c.html#LN90"><span class='Ref_to_Proto'>pivotFieldCompare</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN353"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="crosstabview.c.html#LN351"><span class='Ref_To_Local'>col_number</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN353"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN44"><span class='Ref_to_Member'>rank</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Place value into cell */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN351"><span class='Ref_To_Local'>col_number</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="crosstabview.c.html#LN350"><span class='Ref_To_Local'>row_number</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN386"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>idx</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* index into the cont.cells array */ 
</span>            <a href="crosstabview.c.html#LN386"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="crosstabview.c.html#LN351"><span class='Ref_To_Local'>col_number</span></a> <span class='Operator'>+ </span><a href="crosstabview.c.html#LN350"><span class='Ref_To_Local'>row_number</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN285"><span class='Ref_to_Parameter'>num_columns</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If the cell already contains a value, raise an error. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN150"><span class='Ref_to_Member'>cells</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN386"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\crosstabview: query result contains multiple data values for row \"%s\", column \"%s\"\n"</span><span class='Delimiter'>, 
</span>                           <a href="crosstabview.c.html#LN352"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>? </span><a href="crosstabview.c.html#LN352"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>: 
</span>                           <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN165"><span class='Ref_to_Member'>nullPrint</span></a> <span class='Operator'>? </span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN165"><span class='Ref_to_Member'>nullPrint</span></a> <span class='Operator'>: </span><span class='String'>"(null)"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="crosstabview.c.html#LN353"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>? </span><a href="crosstabview.c.html#LN353"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>: 
</span>                           <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN165"><span class='Ref_to_Member'>nullPrint</span></a> <span class='Operator'>? </span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN165"><span class='Ref_to_Member'>nullPrint</span></a> <span class='Operator'>: </span><span class='String'>"(null)"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="crosstabview.c.html#LN423"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN150"><span class='Ref_to_Member'>cells</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN386"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= !</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN284"><span class='Ref_to_Parameter'>results</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN292"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN287"><span class='Ref_to_Parameter'>field_for_data</span></a><span class='Parentheses'>) </span><span class='Operator'>? 
</span>                <a href="../../interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN284"><span class='Ref_to_Parameter'>results</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN292"><span class='Ref_To_Local'>rn</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN287"><span class='Ref_to_Parameter'>field_for_data</span></a><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN165"><span class='Ref_to_Member'>nullPrint</span></a> <span class='Operator'>? </span><a href="crosstabview.c.html#LN289"><span class='Ref_To_Local'>popt</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN165"><span class='Ref_to_Member'>nullPrint</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if col_number&GT;=0&&row_nu... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for rn=0;rn&LT;PQntuples(res... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * The non-initialized cells must be set to an empty string for the print 
     * functions 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN153"><span class='Ref_to_Member'>cellsadded</span></a><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN150"><span class='Ref_to_Member'>cells</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Operator'>.</span><a href="../../include/fe_utils/print.h.html#LN150"><span class='Ref_to_Member'>cells</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN291"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/fe_utils/print.h.html#LN203"><span class='Ref_to_Proto'>printTable</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN83"><span class='Ref_to_Member'>queryFout</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN113"><span class='Ref_to_Member'>logfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN295"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<a name="LN423"></a><span class='Label'>error</span><span class='Operator'>: 
</span>    <a href="../../include/fe_utils/print.h.html#LN202"><span class='Ref_to_Proto'>printTableCleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN290"><span class='Ref_To_Local'>cont</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="crosstabview.c.html#LN295"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end printCrosstab &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The avl* functions below provide a minimalistic implementation of AVL binary 
 * trees, to efficiently collect the distinct values that will form the horizontal 
 * and vertical headers. It only supports adding new values, no removal or even 
 * search. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN436"></a><span class='Declare_Function'>avlInit</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tree</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="crosstabview.c.html#LN436"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN26"><span class='Ref_to_Proto'>pg_malloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN436"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN436"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN436"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN436"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN73"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN436"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN74"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN436"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Deallocate recursively an AVL tree, starting from node */ 
</span><span class='Keyword'>static void 
</span><a name="LN446"></a><span class='Declare_Function'>avlFree</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tree</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="crosstabview.c.html#LN87"><span class='Ref_to_Proto'>avlFree</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>tree</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="crosstabview.c.html#LN87"><span class='Ref_to_Proto'>avlFree</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>tree</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN74"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* free the root separately as it's not child of anything */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>!= </span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* free the tree-&GT;end struct only once and when all else is freed */ 
</span>        <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN446"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end avlFree &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Set the height to 1 plus the greatest of left and right heights */ 
</span><span class='Keyword'>static void 
</span><a name="LN470"></a><span class='Declare_Function'>avlUpdateHeight</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="crosstabview.c.html#LN470"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN57"><span class='Ref_to_Member'>height</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN470"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN57"><span class='Ref_to_Member'>height</span></a> <span class='Operator'>&GT; </span><a href="crosstabview.c.html#LN470"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN57"><span class='Ref_to_Member'>height</span></a> <span class='Operator'>? 
</span>                     <a href="crosstabview.c.html#LN470"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN57"><span class='Ref_to_Member'>height</span></a> <span class='Operator'>: 
</span>                     <a href="crosstabview.c.html#LN470"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN57"><span class='Ref_to_Member'>height</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Rotate a subtree left (dir=0) or right (dir=1). Not recursive */ 
</span><span class='Keyword'>static </span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>* 
</span><a name="LN479"></a><span class='Declare_Function'>avlRotate</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>current</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN481"></a>    <a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>before</span> <span class='Operator'>= *</span><a href="crosstabview.c.html#LN479"><span class='Ref_to_Parameter'>current</span></a><span class='Delimiter'>; 
</span><a name="LN482"></a>    <a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>after</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="crosstabview.c.html#LN479"><span class='Ref_to_Parameter'>current</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN479"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Operator'>*</span><a href="crosstabview.c.html#LN479"><span class='Ref_to_Parameter'>current</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN482"><span class='Ref_To_Local'>after</span></a><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN481"><span class='Ref_To_Local'>before</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN479"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN482"><span class='Ref_To_Local'>after</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Operator'>!</span><a href="crosstabview.c.html#LN479"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>]; 
</span>    <a href="crosstabview.c.html#LN469"><span class='Ref_to_Func'>avlUpdateHeight</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN481"><span class='Ref_To_Local'>before</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN482"><span class='Ref_To_Local'>after</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Operator'>!</span><a href="crosstabview.c.html#LN479"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN481"><span class='Ref_To_Local'>before</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="crosstabview.c.html#LN482"><span class='Ref_To_Local'>after</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN493"></a><span class='Declare_Function'>avlBalance</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="crosstabview.c.html#LN493"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN57"><span class='Ref_to_Member'>height</span></a> <span class='Operator'>- </span><a href="crosstabview.c.html#LN493"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN57"><span class='Ref_to_Member'>height</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * After an insertion, possibly rebalance the tree so that the left and right 
 * node heights don't differ by more than 1. 
 * May update *node. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN504"></a><span class='Declare_Function'>avlAdjustBalance</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tree</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN506"></a>    <a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>current</span> <span class='Operator'>= *</span><a href="crosstabview.c.html#LN504"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN507"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>b</span> <span class='Operator'>= </span><a href="crosstabview.c.html#LN492"><span class='Ref_to_Func'>avlBalance</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN506"><span class='Ref_To_Local'>current</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN507"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN511"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>dir</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>- </span><a href="crosstabview.c.html#LN507"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN492"><span class='Ref_to_Func'>avlBalance</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN506"><span class='Ref_To_Local'>current</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN511"><span class='Ref_To_Local'>dir</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>== -</span><a href="crosstabview.c.html#LN507"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span> 
            <a href="crosstabview.c.html#LN478"><span class='Ref_to_Func'>avlRotate</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN506"><span class='Ref_To_Local'>current</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN511"><span class='Ref_To_Local'>dir</span></a><span class='Delimiter'>], </span><span class='Operator'>!</span><a href="crosstabview.c.html#LN511"><span class='Ref_To_Local'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="crosstabview.c.html#LN506"><span class='Ref_To_Local'>current</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN478"><span class='Ref_to_Func'>avlRotate</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN504"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN511"><span class='Ref_To_Local'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN506"><span class='Ref_To_Local'>current</span></a> <span class='Operator'>!= </span><a href="crosstabview.c.html#LN504"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Parentheses'>) 
</span>        <a href="crosstabview.c.html#LN469"><span class='Ref_to_Func'>avlUpdateHeight</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN506"><span class='Ref_To_Local'>current</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Insert a new value/field, starting from *node, reaching the correct position 
 * in the tree by recursion.  Possibly rebalance the tree and possibly update 
 * *node.  Do nothing if the value is already present in the tree. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN527"></a><span class='Declare_Function'>avlInsertNode</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tree</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Declare_Parameter'>field</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN529"></a>    <a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>current</span> <span class='Operator'>= *</span><a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN529"><span class='Ref_To_Local'>current</span></a> <span class='Operator'>== </span><a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN533"></a>        <a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>new_node</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="crosstabview.c.html#LN533"><span class='Ref_To_Local'>new_node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN57"><span class='Ref_to_Member'>height</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="crosstabview.c.html#LN533"><span class='Ref_To_Local'>new_node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN51"><span class='Ref_to_Member'>field</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>; 
</span>        <a href="crosstabview.c.html#LN533"><span class='Ref_To_Local'>new_node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN533"><span class='Ref_To_Local'>new_node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Delimiter'>; 
</span>        <a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN73"><span class='Ref_to_Member'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN533"><span class='Ref_To_Local'>new_node</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN544"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span> <span class='Operator'>= </span><a href="crosstabview.c.html#LN90"><span class='Ref_to_Proto'>pivotFieldCompare</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="crosstabview.c.html#LN529"><span class='Ref_To_Local'>current</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN51"><span class='Ref_to_Member'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN544"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="crosstabview.c.html#LN526"><span class='Ref_to_Func'>avlInsertNode</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>tree</span></a><span class='Delimiter'>, 
</span>                     <a href="crosstabview.c.html#LN544"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? &</span><a href="crosstabview.c.html#LN529"><span class='Ref_To_Local'>current</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>: &</span><a href="crosstabview.c.html#LN529"><span class='Ref_To_Local'>current</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                          <a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="crosstabview.c.html#LN503"><span class='Ref_to_Func'>avlAdjustBalance</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>tree</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN527"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end avlInsertNode &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Insert the value into the AVL tree, if it does not preexist */ 
</span><span class='Keyword'>static void 
</span><a name="LN558"></a><span class='Declare_Function'>avlMergeValue</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tree</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sort_value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN560"></a>    <a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Declare_Local'>field</span><span class='Delimiter'>; 
</span> 
    <a href="crosstabview.c.html#LN560"><span class='Ref_To_Local'>field</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN558"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN560"><span class='Ref_To_Local'>field</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN44"><span class='Ref_to_Member'>rank</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN558"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN73"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN560"><span class='Ref_To_Local'>field</span></a><span class='Operator'>.</span><a href="crosstabview.c.html#LN35"><span class='Ref_to_Member'>sort_value</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN558"><span class='Ref_to_Parameter'>sort_value</span></a><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN526"><span class='Ref_to_Func'>avlInsertNode</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN558"><span class='Ref_to_Parameter'>tree</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="crosstabview.c.html#LN558"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN74"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN560"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Recursively extract node values into the names array, in sorted order with a 
 * left-to-right tree traversal. 
 * Return the next candidate offset to write into the names array. 
 * fields[] must be preallocated to hold tree-&GT;count entries 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN575"></a><span class='Declare_Function'>avlCollectFields</span><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN71"><span class='Ref_to_Typedef'>avl_tree</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tree</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN48"><span class='Ref_to_Typedef'>avl_node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fields</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>idx</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>tree</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN75"><span class='Ref_to_Member'>end</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>idx</span></a><span class='Delimiter'>; 
</span> 
    <a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>idx</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN85"><span class='Ref_to_Proto'>avlCollectFields</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>tree</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>fields</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>fields</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>idx</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN51"><span class='Ref_to_Member'>field</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="crosstabview.c.html#LN85"><span class='Ref_to_Proto'>avlCollectFields</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>tree</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN64"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>fields</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN575"><span class='Ref_to_Parameter'>idx</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN586"></a><span class='Declare_Function'>rankSort</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>num_columns</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>piv_columns</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN588"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>hmap</span><span class='Delimiter'>;</span>           <span class='Comment_Multi_Line'>/* [[offset in piv_columns, rank], ...for 
                                 * every header entry] */ 
</span><a name="LN590"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="crosstabview.c.html#LN588"><span class='Ref_To_Local'>hmap</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="crosstabview.c.html#LN586"><span class='Ref_to_Parameter'>num_columns</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="crosstabview.c.html#LN586"><span class='Ref_to_Parameter'>num_columns</span></a><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN595"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="crosstabview.c.html#LN586"><span class='Ref_to_Parameter'>piv_columns</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="crosstabview.c.html#LN35"><span class='Ref_to_Member'>sort_value</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ranking information is valid if non null and matches /^-?\d+$/ */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN595"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="crosstabview.c.html#LN595"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>&& 
</span>              strspn<span class='Parentheses'>(</span><a href="crosstabview.c.html#LN595"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"0123456789"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>strlen<span class='Parentheses'>(</span><a href="crosstabview.c.html#LN595"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>             strspn<span class='Parentheses'>(</span><a href="crosstabview.c.html#LN595"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='String'>"0123456789"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span>strlen<span class='Parentheses'>(</span><a href="crosstabview.c.html#LN595"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="crosstabview.c.html#LN588"><span class='Ref_To_Local'>hmap</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="crosstabview.c.html#LN595"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="crosstabview.c.html#LN588"><span class='Ref_To_Local'>hmap</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* invalid rank information ignored (equivalent to rank 0) */ 
</span>            <a href="crosstabview.c.html#LN588"><span class='Ref_To_Local'>hmap</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="crosstabview.c.html#LN588"><span class='Ref_To_Local'>hmap</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;num_columns;i++ &raquo; </span> 
 
    <a href="../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN588"><span class='Ref_To_Local'>hmap</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN586"><span class='Ref_to_Parameter'>num_columns</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN91"><span class='Ref_to_Proto'>rankCompare</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="crosstabview.c.html#LN586"><span class='Ref_to_Parameter'>num_columns</span></a><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="crosstabview.c.html#LN586"><span class='Ref_to_Parameter'>piv_columns</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN588"><span class='Ref_To_Local'>hmap</span></a><span class='Delimiter'>[</span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]]</span><span class='Operator'>.</span><a href="crosstabview.c.html#LN44"><span class='Ref_to_Member'>rank</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN590"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN29"><span class='Ref_to_Proto'>pg_free</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN588"><span class='Ref_To_Local'>hmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end rankSort &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Look up a column reference, which can be either: 
 * - a number from 1 to PQnfields(res) 
 * - a column name matching one of PQfname(res,...) 
 * 
 * Returns zero-based column number, or -1 if not found or ambiguous. 
 * 
 * Note: may modify contents of "arg" string. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN634"></a><span class='Declare_Function'>indexOfColumn</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN636"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>idx</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&& </span>strspn<span class='Parentheses'>(</span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><span class='String'>"0123456789"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>strlen<span class='Parentheses'>(</span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* if arg contains only digits, it's a column number */ 
</span>        <a href="crosstabview.c.html#LN636"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN636"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="crosstabview.c.html#LN636"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&GT;= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\crosstabview: column number %d is out of range 1..%d\n"</span><span class='Delimiter'>, 
</span>                       <a href="crosstabview.c.html#LN636"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN651"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Dequote and downcase the column name.  By checking for all-digits 
         * before doing this, we can ensure that a quoted name is treated as a 
         * name even if it's all digits. 
         */ 
</span>        <a href="psqlscanslash.h.html#LN37"><span class='Ref_to_Proto'>dequote_downcase_identifier</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now look for match(es) among res' column names */ 
</span>        <a href="crosstabview.c.html#LN636"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN651"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN651"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="crosstabview.c.html#LN651"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN476"><span class='Ref_to_Proto'>PQfname</span></a><span class='Parentheses'>(</span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN651"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN636"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* another idx was already found for the same name */ 
</span>                    <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\crosstabview: ambiguous column name: \"%s\"\n"</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="crosstabview.c.html#LN636"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="crosstabview.c.html#LN651"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="crosstabview.c.html#LN636"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="common.c.html#LN218"><span class='Ref_to_Func'>psql_error</span></a><span class='Parentheses'>(</span><span class='String'>"\\crosstabview: column name not found: \"%s\"\n"</span><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN634"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="crosstabview.c.html#LN636"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end indexOfColumn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Value comparator for vertical and horizontal headers 
 * used for deduplication only. 
 * - null values are considered equal 
 * - non-null &LT; null 
 * - non-null values are compared with strcmp() 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN693"></a><span class='Declare_Function'>pivotFieldCompare</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN695"></a>    <span class='Keyword'>const </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pa</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="crosstabview.c.html#LN693"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN696"></a>    <span class='Keyword'>const </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pb</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="crosstabview.c.html#LN20"><span class='Ref_to_Typedef'>pivot_field</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="crosstabview.c.html#LN693"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* test null values */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="crosstabview.c.html#LN696"><span class='Ref_To_Local'>pb</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="crosstabview.c.html#LN695"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="crosstabview.c.html#LN695"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* non-null values */ 
</span>    <span class='Control'>return</span> strcmp<span class='Parentheses'>(</span><a href="crosstabview.c.html#LN695"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="crosstabview.c.html#LN696"><span class='Ref_To_Local'>pb</span></a><span class='Operator'>-&GT;</span><a href="crosstabview.c.html#LN27"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN709"></a><span class='Declare_Function'>rankCompare</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Operator'>*</span><span class='Parentheses'>((</span><span class='Keyword'>const int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="crosstabview.c.html#LN709"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span> <span class='Operator'>- *</span><span class='Parentheses'>((</span><span class='Keyword'>const int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="crosstabview.c.html#LN709"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>