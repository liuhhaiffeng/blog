<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\bin\psql\prompt.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\bin\psql\prompt.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:02 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/* 
 * psql - the PostgreSQL interactive terminal 
 * 
 * Copyright (c) 2000-2017, PostgreSQL Global Development Group 
 * 
 * src/bin/psql/prompt.c 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>#include </span><span class='String'>&LT;io.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;win32.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netdb.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"common.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"input.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"prompt.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"settings.h"</span> 
 
 
<span class='Comment_Multi_Line'>/*-------------------------- 
 * get_prompt 
 * 
 * Returns a statically allocated prompt made by interpolating certain 
 * tcsh style escape sequences into pset.vars "PROMPT1|2|3". 
 * (might not be completely multibyte safe) 
 * 
 * Defined interpolations are: 
 * %M - database server "hostname.domainname", "[local]" for AF_UNIX 
 *      sockets, "[local:/dir/name]" if not default 
 * %m - like %M, but hostname only (before first dot), or always "[local]" 
 * %p - backend pid 
 * %&GT; - database server port number 
 * %n - database user name 
 * %/ - current database 
 * %~ - like %/ but "~" when database name equals user name 
 * %# - "#" if superuser, "&GT;" otherwise 
 * %R - in prompt1 normally =, or ^ if single line mode, 
 *          or a ! if session is not connected to a database; 
 *      in prompt2 -, *, ', or "; 
 *      in prompt3 nothing 
 * %x - transaction status: empty, *, !, ? (unknown or no connection) 
 * %l - The line number inside the current statement, starting from 1. 
 * %? - the error code of the last query (not yet implemented) 
 * %% - a percent sign 
 * 
 * %[0-9]          - the character with the given decimal code 
 * %0[0-7]         - the character with the given octal code 
 * %0x[0-9A-Fa-f]  - the character with the given hexadecimal code 
 * 
 * %`command`      - The result of executing command in /bin/sh with trailing 
 *                   newline stripped. 
 * %:name:         - The value of the psql variable 'name' 
 * (those will not be rescanned for more escape sequences!) 
 * 
 * %[ ... %]       - tell readline that the contained text is invisible 
 * 
 * If the application-wide prompts become NULL somehow, the returned string 
 * will be empty (not NULL!). 
 *-------------------------- 
 */ 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN68"></a><span class='Declare_Function'>get_prompt</span><span class='Parentheses'>(</span><a href="../../include/fe_utils/psqlscan.h.html#LN38"><span class='Ref_to_Typedef'>promptStatus_t</span></a> <span class='Declare_Parameter'>status</span><span class='Delimiter'>, </span><a href="conditional.h.html#LN55"><span class='Ref_to_Typedef'>ConditionalStack</span></a> <span class='Declare_Parameter'>cstack</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN70"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_PROMPT_SIZE</span> <span class='Number'>256</span> 
<a name="LN71"></a>    <span class='Keyword'>static char </span><span class='Declare_Local'>destination</span><span class='Delimiter'>[</span><a href="prompt.c.html#LN70"><span class='Ref_to_Const'>MAX_PROMPT_SIZE</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN72"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="prompt.c.html#LN70"><span class='Ref_to_Const'>MAX_PROMPT_SIZE</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN73"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>esc</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN74"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN75"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>prompt_string</span> <span class='Operator'>= </span><span class='String'>"? "</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="prompt.c.html#LN68"><span class='Ref_to_Parameter'>status</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN40"><span class='Ref_to_EnumConst'>PROMPT_READY</span></a><span class='Operator'>: 
</span>            <a href="prompt.c.html#LN75"><span class='Ref_To_Local'>prompt_string</span></a> <span class='Operator'>= </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN135"><span class='Ref_to_Member'>prompt1</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN41"><span class='Ref_to_EnumConst'>PROMPT_CONTINUE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN43"><span class='Ref_to_EnumConst'>PROMPT_SINGLEQUOTE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN44"><span class='Ref_to_EnumConst'>PROMPT_DOUBLEQUOTE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN45"><span class='Ref_to_EnumConst'>PROMPT_DOLLARQUOTE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN42"><span class='Ref_to_EnumConst'>PROMPT_COMMENT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN46"><span class='Ref_to_EnumConst'>PROMPT_PAREN</span></a><span class='Operator'>: 
</span>            <a href="prompt.c.html#LN75"><span class='Ref_To_Local'>prompt_string</span></a> <span class='Operator'>= </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN136"><span class='Ref_to_Member'>prompt2</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN47"><span class='Ref_to_EnumConst'>PROMPT_COPY</span></a><span class='Operator'>: 
</span>            <a href="prompt.c.html#LN75"><span class='Ref_To_Local'>prompt_string</span></a> <span class='Operator'>= </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN137"><span class='Ref_to_Member'>prompt3</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="prompt.c.html#LN71"><span class='Ref_To_Local'>destination</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="prompt.c.html#LN75"><span class='Ref_To_Local'>prompt_string</span></a><span class='Delimiter'>; 
</span>         <span class='Operator'>*</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="prompt.c.html#LN71"><span class='Ref_To_Local'>destination</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN71"><span class='Ref_To_Local'>destination</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>         <a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        memset<span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prompt.c.html#LN73"><span class='Ref_To_Local'>esc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Current database */ 
</span>                <span class='Control'>case</span> <span class='String'>'/'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>) 
</span>                        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN310"><span class='Ref_to_Proto'>PQdb</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'~'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN116"></a>                        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN310"><span class='Ref_to_Proto'>PQdb</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN311"><span class='Ref_to_Proto'>PQuser</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                            <span class='Parentheses'>((</span><a href="prompt.c.html#LN116"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGDATABASE"</span><span class='Parentheses'>))</span> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="prompt.c.html#LN116"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN310"><span class='Ref_to_Proto'>PQdb</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"~"</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN310"><span class='Ref_to_Proto'>PQdb</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* DB server hostname (long/short) */ 
</span>                <span class='Control'>case</span> <span class='String'>'M'</span><span class='Operator'>: 
</span>                <span class='Control'>case</span> <span class='String'>'m'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN131"></a>                        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>host</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN313"><span class='Ref_to_Proto'>PQhost</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* INET socket */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prompt.c.html#LN131"><span class='Ref_To_Local'>host</span></a> <span class='Operator'>&& </span><a href="prompt.c.html#LN131"><span class='Ref_To_Local'>host</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&& !</span><a href="../../include/port.h.html#LN76"><span class='Ref_to_Macro'>is_absolute_path</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN131"><span class='Ref_To_Local'>host</span></a><span class='Parentheses'>))</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="prompt.c.html#LN131"><span class='Ref_To_Local'>host</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'m'</span><span class='Parentheses'>) 
</span>                                <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span>strcspn<span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"."</span><span class='Parentheses'>)</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span><span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
                        <span class='Comment_Multi_Line'>/* UNIX socket */ 
</span>                        <span class='Control'>else</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prompt.c.html#LN131"><span class='Ref_To_Local'>host</span></a> 
                                <span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="prompt.c.html#LN131"><span class='Ref_To_Local'>host</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN183"><span class='Ref_to_Const'>DEFAULT_PGSOCKET_DIR</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> 
                                <span class='Operator'>|| *</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'m'</span><span class='Parentheses'>)</span> 
                                <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"[local]"</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> 
                                <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"[local:%s]"</span><span class='Delimiter'>, </span><a href="prompt.c.html#LN131"><span class='Ref_To_Local'>host</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pset.db &raquo; </span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* DB server port number */ 
</span>                <span class='Control'>case</span> <span class='String'>'&GT;'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a> <span class='Operator'>&& </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN314"><span class='Ref_to_Proto'>PQport</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>))</span> 
                        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN314"><span class='Ref_to_Proto'>PQport</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* DB server user name */ 
</span>                <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>) 
</span>                        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="common.h.html#LN42"><span class='Ref_to_Proto'>session_username</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* backend pid */ 
</span>                <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN168"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>pid</span> <span class='Operator'>= </span><a href="../../interfaces/libpq/libpq-fe.h.html#LN325"><span class='Ref_to_Proto'>PQbackendPID</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prompt.c.html#LN168"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>) 
</span>                            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="prompt.c.html#LN168"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='String'>'0'</span><span class='Operator'>: 
</span>                <span class='Control'>case</span> <span class='String'>'1'</span><span class='Operator'>: 
</span>                <span class='Control'>case</span> <span class='String'>'2'</span><span class='Operator'>: 
</span>                <span class='Control'>case</span> <span class='String'>'3'</span><span class='Operator'>: 
</span>                <span class='Control'>case</span> <span class='String'>'4'</span><span class='Operator'>: 
</span>                <span class='Control'>case</span> <span class='String'>'5'</span><span class='Operator'>: 
</span>                <span class='Control'>case</span> <span class='String'>'6'</span><span class='Operator'>: 
</span>                <span class='Control'>case</span> <span class='String'>'7'</span><span class='Operator'>: 
</span>                    <span class='Operator'>*</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span>strtol<span class='Parentheses'>(</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>--</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'R'</span><span class='Operator'>: 
</span>                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="prompt.c.html#LN68"><span class='Ref_to_Parameter'>status</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN40"><span class='Ref_to_EnumConst'>PROMPT_READY</span></a><span class='Operator'>: 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prompt.c.html#LN68"><span class='Ref_to_Parameter'>cstack</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& !</span><a href="conditional.h.html#LN72"><span class='Ref_to_Proto'>conditional_active</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN68"><span class='Ref_to_Parameter'>cstack</span></a><span class='Parentheses'>))</span> 
                                <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'@'</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>) 
</span>                                <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'!'</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN125"><span class='Ref_to_Member'>singleline</span></a><span class='Parentheses'>) 
</span>                                <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'='</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> 
                                <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'^'</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN41"><span class='Ref_to_EnumConst'>PROMPT_CONTINUE</span></a><span class='Operator'>: 
</span>                            <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN43"><span class='Ref_to_EnumConst'>PROMPT_SINGLEQUOTE</span></a><span class='Operator'>: 
</span>                            <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\''</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN44"><span class='Ref_to_EnumConst'>PROMPT_DOUBLEQUOTE</span></a><span class='Operator'>: 
</span>                            <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN45"><span class='Ref_to_EnumConst'>PROMPT_DOLLARQUOTE</span></a><span class='Operator'>: 
</span>                            <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'$'</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN42"><span class='Ref_to_EnumConst'>PROMPT_COMMENT</span></a><span class='Operator'>: 
</span>                            <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'*'</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../include/fe_utils/psqlscan.h.html#LN46"><span class='Ref_to_EnumConst'>PROMPT_PAREN</span></a><span class='Operator'>: 
</span>                            <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'('</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch status &raquo; </span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='String'>'x'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>) 
</span>                        <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'?'</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../interfaces/libpq/libpq-fe.h.html#LN318"><span class='Ref_to_Proto'>PQtransactionStatus</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN81"><span class='Ref_to_Member'>db</span></a><span class='Parentheses'>))</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN102"><span class='Ref_to_EnumConst'>PQTRANS_IDLE</span></a><span class='Operator'>: 
</span>                                <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN103"><span class='Ref_to_EnumConst'>PQTRANS_ACTIVE</span></a><span class='Operator'>: 
</span>                            <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN104"><span class='Ref_to_EnumConst'>PQTRANS_INTRANS</span></a><span class='Operator'>: 
</span>                                <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'*'</span><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Control'>case</span> <a href="../../interfaces/libpq/libpq-fe.h.html#LN105"><span class='Ref_to_EnumConst'>PQTRANS_INERROR</span></a><span class='Operator'>: 
</span>                                <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'!'</span><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Control'>default</span><span class='Operator'>: 
</span>                                <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'?'</span><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='String'>'l'</span><span class='Operator'>: 
</span>                    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN109"><span class='Ref_to_Member'>stmt_lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='String'>'?'</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* not here yet */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='String'>'#'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="common.h.html#LN40"><span class='Ref_to_Proto'>is_superuser</span></a><span class='Parentheses'>())</span> 
                        <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'#'</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'&GT;'</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* execute command */ 
</span>                <span class='Control'>case</span> <span class='String'>'`'</span><span class='Operator'>: 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN263"></a>                        FILE       <span class='Operator'>*</span><span class='Declare_Local'>fd</span><span class='Delimiter'>; 
</span><a name="LN264"></a>                        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>file</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN265"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>cmdend</span><span class='Delimiter'>; 
</span> 
                        <a href="prompt.c.html#LN265"><span class='Ref_To_Local'>cmdend</span></a> <span class='Operator'>= </span>strcspn<span class='Parentheses'>(</span><a href="prompt.c.html#LN264"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><span class='String'>"`"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="prompt.c.html#LN264"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>[</span><a href="prompt.c.html#LN265"><span class='Ref_To_Local'>cmdend</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                        <a href="prompt.c.html#LN263"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN313"><span class='Ref_to_Macro'>popen</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN264"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prompt.c.html#LN263"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span>fgets<span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="prompt.c.html#LN263"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                                <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                            <a href="../../include/port.h.html#LN314"><span class='Ref_to_Macro'>pclose</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN263"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span>strlen<span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>)</span> 
                            <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span>strlen<span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN264"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="prompt.c.html#LN265"><span class='Ref_To_Local'>cmdend</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* interpolate variable */ 
</span>                <span class='Control'>case</span> <span class='String'>':'</span><span class='Operator'>: 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN286"></a>                        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span><span class='Delimiter'>; 
</span><a name="LN287"></a>                        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN288"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>nameend</span><span class='Delimiter'>; 
</span> 
                        <a href="prompt.c.html#LN286"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="prompt.c.html#LN288"><span class='Ref_To_Local'>nameend</span></a> <span class='Operator'>= </span>strcspn<span class='Parentheses'>(</span><a href="prompt.c.html#LN286"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='String'>":"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="prompt.c.html#LN286"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>[</span><a href="prompt.c.html#LN288"><span class='Ref_To_Local'>nameend</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                        <a href="prompt.c.html#LN287"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="variables.c.html#LN69"><span class='Ref_to_Func'>GetVariable</span></a><span class='Parentheses'>(</span><a href="startup.c.html#LN32"><span class='Ref_to_Global_Var'>pset</span></a><span class='Operator'>.</span><a href="settings.h.html#LN115"><span class='Ref_to_Member'>vars</span></a><span class='Delimiter'>, </span><a href="prompt.c.html#LN286"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="prompt.c.html#LN287"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>                            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="prompt.c.html#LN287"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN286"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="prompt.c.html#LN288"><span class='Ref_To_Local'>nameend</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                <span class='Control'>case</span> <span class='String'>'['</span><span class='Operator'>: 
</span>                <span class='Control'>case</span> <span class='String'>']'</span><span class='Operator'>: 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span><a href="input.h.html#LN17"><span class='Ref_to_Const'>USE_READLINE</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span>RL_PROMPT_START_IGNORE<span class='Parentheses'>) 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * readline &GT;=4.0 undocumented feature: non-printing 
                     * characters in prompt strings must be marked as such, in 
                     * order to properly display the line during editing. 
                     */ 
</span>                    <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'['</span><span class='Parentheses'>) </span><span class='Operator'>? </span>RL_PROMPT_START_IGNORE <span class='Operator'>: </span>RL_PROMPT_END_IGNORE<span class='Delimiter'>; 
</span>                    <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_READLINE */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= *</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>                    <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch *p &raquo; </span> 
            <a href="prompt.c.html#LN73"><span class='Ref_To_Local'>esc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if esc &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'%'</span><span class='Parentheses'>) 
</span>            <a href="prompt.c.html#LN73"><span class='Ref_To_Local'>esc</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= *</span><a href="prompt.c.html#LN74"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>            <a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <a href="prompt.c.html#LN73"><span class='Ref_To_Local'>esc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="prompt.c.html#LN73"><span class='Ref_To_Local'>esc</span></a><span class='Parentheses'>) 
</span>            <a href="../../port/strlcat.c.html#LN31"><span class='Ref_to_Func'>strlcat</span></a><span class='Parentheses'>(</span><a href="prompt.c.html#LN71"><span class='Ref_To_Local'>destination</span></a><span class='Delimiter'>, </span><a href="prompt.c.html#LN72"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="prompt.c.html#LN71"><span class='Ref_To_Local'>destination</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for p=prompt_string;*p&&s... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="prompt.c.html#LN71"><span class='Ref_To_Local'>destination</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_prompt &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>