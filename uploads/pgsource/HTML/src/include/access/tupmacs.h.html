<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\include\access\tupmacs.h</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\include\access\tupmacs.h</b></p></td>
<td align='right'>
Wed Jun 14 08:26:03 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * tupmacs.h 
 *    Tuple macros used by both index tuples and heap tuples. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * src/include/access/tupmacs.h 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Directive'>#ifndef</span> <a href="tupmacs.h.html#LN14"><span class='Ref_to_Const'>TUPMACS_H</span></a> 
<a name="LN14"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TUPMACS_H</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * check to see if the ATT'th bit of an array of 8-bit bytes is set. 
 */ 
</span><a name="LN20"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>att_isnull</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>ATT</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>BITS</span><span class='Parentheses'>) (</span><span class='Operator'>!</span><span class='Parentheses'>((</span><a href="tupmacs.h.html#LN20"><span class='Ref_to_Parameter'>BITS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN20"><span class='Ref_to_Parameter'>ATT</span></a><span class='Parentheses'>)</span> <span class='Operator'>&GT;&GT; </span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>((</span><a href="tupmacs.h.html#LN20"><span class='Ref_to_Parameter'>ATT</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0x07</span><span class='Parentheses'>))))</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a Form_pg_attribute and a pointer into a tuple's data area, 
 * return the correct value or pointer. 
 * 
 * We return a Datum value in all cases.  If the attribute has "byval" false, 
 * we return the same pointer into the tuple data area that we're passed. 
 * Otherwise, we return the correct number of bytes fetched from the data 
 * area and extended to Datum form. 
 * 
 * On machines where Datum is 8 bytes, we support fetching 8-byte byval 
 * attributes; otherwise, only 1, 2, and 4-byte values are supported. 
 * 
 * Note that T must already be properly aligned for this to work correctly. 
 */ 
</span><a name="LN36"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>fetchatt</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>A</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>T</span><span class='Parentheses'>) </span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Macro'>fetch_att</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN36"><span class='Ref_to_Parameter'>T</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN36"><span class='Ref_to_Parameter'>A</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>attbyval<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN36"><span class='Ref_to_Parameter'>A</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Same, but work from byval/len parameters rather than Form_pg_attribute. 
 */ 
</span><span class='Directive'>#if</span> <a href="../postgres.h.html#LN373"><span class='Ref_to_Const'>SIZEOF_DATUM</span></a> <span class='Operator'>== </span><span class='Number'>8</span> 
 
<a name="LN43"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>fetch_att</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>T</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>attbyval</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>attlen</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Parameter'>attbyval</span></a><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>    <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>            <span class='Operator'>*</span><span class='Parentheses'>((</span><a href="../postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>)(</span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>))</span> <span class='Operator'>\ 
</span>        <span class='Operator'>: \ 
</span>      <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>            <a href="../postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>((</span><a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Parentheses'>)(</span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>)))</span> <span class='Operator'>\ 
</span>        <span class='Operator'>: \ 
</span>        <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>                <a href="../postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>((</span><a href="../c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>)(</span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>)))</span> <span class='Operator'>\ 
</span>            <span class='Operator'>: \ 
</span>            <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>                <a href="../c.h.html#LN675"><span class='Ref_to_Macro'>AssertMacro</span></a><span class='Parentheses'>((</span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                <a href="../postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>)(</span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>)))</span> <span class='Operator'>\ 
</span>            <span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>      <span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Operator'>: \ 
</span>    <a href="../postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN43"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>))</span> <span class='Operator'>\ 
</span><span class='Parentheses'>) 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* SIZEOF_DATUM != 8 */ 
</span> 
<a name="LN70"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>fetch_att</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>T</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>attbyval</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>attlen</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN70"><span class='Ref_to_Parameter'>attbyval</span></a><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>    <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN70"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>            <a href="../postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>((</span><a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Parentheses'>)(</span><a href="tupmacs.h.html#LN70"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>)))</span> <span class='Operator'>\ 
</span>        <span class='Operator'>: \ 
</span>        <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN70"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>                <a href="../postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>((</span><a href="../c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>)(</span><a href="tupmacs.h.html#LN70"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>)))</span> <span class='Operator'>\ 
</span>            <span class='Operator'>: \ 
</span>            <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>                <a href="../c.h.html#LN675"><span class='Ref_to_Macro'>AssertMacro</span></a><span class='Parentheses'>((</span><a href="tupmacs.h.html#LN70"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                <a href="../postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>)(</span><a href="tupmacs.h.html#LN70"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>)))</span> <span class='Operator'>\ 
</span>            <span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Operator'>: \ 
</span>    <a href="../postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN70"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>))</span> <span class='Operator'>\ 
</span><span class='Parentheses'>)</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* SIZEOF_DATUM == 8 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * att_align_datum aligns the given offset as needed for a datum of alignment 
 * requirement attalign and typlen attlen.  attdatum is the Datum variable 
 * we intend to pack into a tuple (it's only accessed if we are dealing with 
 * a varlena type).  Note that this assumes the Datum will be stored as-is; 
 * callers that are intending to convert non-short varlena datums to short 
 * format have to account for that themselves. 
 */ 
</span><a name="LN100"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>att_align_datum</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>cur_offset</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attalign</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attlen</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attdatum</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="tupmacs.h.html#LN100"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="../postgres.h.html#LN324"><span class='Ref_to_Macro'>VARATT_IS_SHORT</span></a><span class='Parentheses'>(</span><a href="../postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN100"><span class='Ref_to_Parameter'>attdatum</span></a><span class='Parentheses'>)))</span> <span class='Operator'>? \ 
</span>    <span class='Parentheses'>(</span>uintptr_t<span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN100"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Parentheses'>)</span> <span class='Operator'>: \ 
</span>    <a href="tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN100"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Delimiter'>, </span><a href="tupmacs.h.html#LN100"><span class='Ref_to_Parameter'>attalign</span></a><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * att_align_pointer performs the same calculation as att_align_datum, 
 * but is used when walking a tuple.  attptr is the current actual data 
 * pointer; when accessing a varlena field we have to "peek" to see if we 
 * are looking at a pad byte or the first byte of a 1-byte-header datum. 
 * (A zero byte must be either a pad byte, or the first byte of a correctly 
 * aligned 4-byte length word; in either case we can align safely.  A non-zero 
 * byte must be either a 1-byte length word, or the first byte of a correctly 
 * aligned 4-byte length word; in either case we need not align.) 
 * 
 * Note: some callers pass a "char *" pointer for cur_offset.  This is 
 * a bit of a hack but should work all right as long as uintptr_t is the 
 * correct width. 
 */ 
</span><a name="LN121"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>att_align_pointer</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>cur_offset</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attalign</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attlen</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attptr</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="tupmacs.h.html#LN121"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>) </span><span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="../postgres.h.html#LN214"><span class='Ref_to_Macro'>VARATT_NOT_PAD_BYTE</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN121"><span class='Ref_to_Parameter'>attptr</span></a><span class='Parentheses'>))</span> <span class='Operator'>? \ 
</span>    <span class='Parentheses'>(</span>uintptr_t<span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN121"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Parentheses'>)</span> <span class='Operator'>: \ 
</span>    <a href="tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN121"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Delimiter'>, </span><a href="tupmacs.h.html#LN121"><span class='Ref_to_Parameter'>attalign</span></a><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * att_align_nominal aligns the given offset as needed for a datum of alignment 
 * requirement attalign, ignoring any consideration of packed varlena datums. 
 * There are three main use cases for using this macro directly: 
 *  * we know that the att in question is not varlena (attlen != -1); 
 *    in this case it is cheaper than the above macros and just as good. 
 *  * we need to estimate alignment padding cost abstractly, ie without 
 *    reference to a real tuple.  We must assume the worst case that 
 *    all varlenas are aligned. 
 *  * within arrays, we unconditionally align varlenas (XXX this should be 
 *    revisited, probably). 
 * 
 * The attalign cases are tested in what is hopefully something like their 
 * frequency of occurrence. 
 */ 
</span><a name="LN143"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>att_align_nominal</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>cur_offset</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attalign</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="tupmacs.h.html#LN143"><span class='Ref_to_Parameter'>attalign</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'i'</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><a href="../c.h.html#LN584"><span class='Ref_to_Macro'>INTALIGN</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN143"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Parentheses'>)</span> <span class='Operator'>: \ 
</span>     <span class='Parentheses'>(((</span><a href="tupmacs.h.html#LN143"><span class='Ref_to_Parameter'>attalign</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'c'</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='Parentheses'>(</span>uintptr_t<span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN143"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Parentheses'>)</span> <span class='Operator'>: \ 
</span>      <span class='Parentheses'>(((</span><a href="tupmacs.h.html#LN143"><span class='Ref_to_Parameter'>attalign</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'d'</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><a href="../c.h.html#LN586"><span class='Ref_to_Macro'>DOUBLEALIGN</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN143"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Parentheses'>)</span> <span class='Operator'>: \ 
</span>       <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>            <a href="../c.h.html#LN675"><span class='Ref_to_Macro'>AssertMacro</span></a><span class='Parentheses'>((</span><a href="tupmacs.h.html#LN143"><span class='Ref_to_Parameter'>attalign</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'s'</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>            <a href="../c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN143"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>       <span class='Parentheses'>)))</span> <span class='Operator'>\ 
</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * att_addlength_datum increments the given offset by the space needed for 
 * the given Datum variable.  attdatum is only accessed if we are dealing 
 * with a variable-length attribute. 
 */ 
</span><a name="LN159"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>att_addlength_datum</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>cur_offset</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attlen</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attdatum</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN159"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Delimiter'>, </span><a href="tupmacs.h.html#LN159"><span class='Ref_to_Parameter'>attlen</span></a><span class='Delimiter'>, </span><a href="../postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN159"><span class='Ref_to_Parameter'>attdatum</span></a><span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* 
 * att_addlength_pointer performs the same calculation as att_addlength_datum, 
 * but is used when walking a tuple --- attptr is the pointer to the field 
 * within the tuple. 
 * 
 * Note: some callers pass a "char *" pointer for cur_offset.  This is 
 * actually perfectly OK, but probably should be cleaned up along with 
 * the same practice for att_align_pointer. 
 */ 
</span><a name="LN171"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>att_addlength_pointer</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>cur_offset</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attlen</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>attptr</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="tupmacs.h.html#LN171"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>    <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN171"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN171"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Operator'>: </span><span class='Parentheses'>(((</span><a href="tupmacs.h.html#LN171"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>    <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN171"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="../postgres.h.html#LN333"><span class='Ref_to_Macro'>VARSIZE_ANY</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN171"><span class='Ref_to_Parameter'>attptr</span></a><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Operator'>: \ 
</span>    <span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>        <a href="../c.h.html#LN675"><span class='Ref_to_Macro'>AssertMacro</span></a><span class='Parentheses'>((</span><a href="tupmacs.h.html#LN171"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== -</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN171"><span class='Ref_to_Parameter'>cur_offset</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span>strlen<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN171"><span class='Ref_to_Parameter'>attptr</span></a><span class='Parentheses'>))</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>))</span> <span class='Operator'>\ 
</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * store_att_byval is a partial inverse of fetch_att: store a given Datum 
 * value into a tuple data area at the specified address.  However, it only 
 * handles the byval case, because in typical usage the caller needs to 
 * distinguish by-val and by-ref cases anyway, and so a do-it-all macro 
 * wouldn't be convenient. 
 */ 
</span><span class='Directive'>#if</span> <a href="../postgres.h.html#LN373"><span class='Ref_to_Const'>SIZEOF_DATUM</span></a> <span class='Operator'>== </span><span class='Number'>8</span> 
 
<a name="LN197"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>store_att_byval</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>T</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>newdatum</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>attlen</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN197"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <span class='Control'>case</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>)</span><span class='Operator'>: \ 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN197"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="../postgres.h.html#LN414"><span class='Ref_to_Macro'>DatumGetChar</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN197"><span class='Ref_to_Parameter'>newdatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Control'>case</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>)</span><span class='Operator'>: \ 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="../c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN197"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="../postgres.h.html#LN449"><span class='Ref_to_Macro'>DatumGetInt16</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN197"><span class='Ref_to_Parameter'>newdatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Control'>case</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Operator'>: \ 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN197"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="../postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN197"><span class='Ref_to_Parameter'>newdatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Control'>case</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)</span><span class='Operator'>: \ 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="../postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN197"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN197"><span class='Ref_to_Parameter'>newdatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Control'>default</span><span class='Operator'>: \ 
</span>                <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported byval length: %d"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN197"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end store_att_byval &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* SIZEOF_DATUM != 8 */ 
</span> 
<a name="LN221"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>store_att_byval</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>T</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>newdatum</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>attlen</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tupmacs.h.html#LN221"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <span class='Control'>case</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>)</span><span class='Operator'>: \ 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN221"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="../postgres.h.html#LN414"><span class='Ref_to_Macro'>DatumGetChar</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN221"><span class='Ref_to_Parameter'>newdatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Control'>case</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>)</span><span class='Operator'>: \ 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="../c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN221"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="../postgres.h.html#LN449"><span class='Ref_to_Macro'>DatumGetInt16</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN221"><span class='Ref_to_Parameter'>newdatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Control'>case</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Operator'>: \ 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN221"><span class='Ref_to_Parameter'>T</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="../postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="tupmacs.h.html#LN221"><span class='Ref_to_Parameter'>newdatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Control'>default</span><span class='Operator'>: \ 
</span>                <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported byval length: %d"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="tupmacs.h.html#LN221"><span class='Ref_to_Parameter'>attlen</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* SIZEOF_DATUM == 8 */ 
</span> 
<span class='Directive'>#endif</span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>