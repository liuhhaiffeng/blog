<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\include\port\atomics\generic.h</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\include\port\atomics\generic.h</b></p></td>
<td align='right'>
Wed Jun 14 08:26:07 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * generic.h 
 *    Implement higher level operations based on some lower level atomic 
 *    operations. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * src/include/port/atomics/generic.h 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* intentionally no include guards, should only be included by atomics.h */ 
</span><span class='Directive'>#ifndef</span> <a href="../atomics.h.html#LN44"><span class='Ref_to_Const'>INSIDE_ATOMICS_H</span></a> 
#   <a href="../../../interfaces/ecpg/test/expected/sql-dyntest.c.html#LN145"><span class='Ref_to_Func'>error</span></a> <span class='String'>"should be included via atomics.h"</span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * If read or write barriers are undefined, we upgrade them to full memory 
 * barriers. 
 */ 
</span><span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="arch-ppc.h.html#LN23"><span class='Ref_to_Macro'>pg_read_barrier_impl</span></a><span class='Parentheses'>) 
</span><a name="LN24"></a>#   define <span class='Declare_Constant'>pg_read_barrier_impl</span> <a href="arch-hppa.h.html#LN16"><span class='Ref_to_Macro'>pg_memory_barrier_impl</span></a> 
<span class='Directive'>#endif</span> 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="arch-ppc.h.html#LN24"><span class='Ref_to_Macro'>pg_write_barrier_impl</span></a><span class='Parentheses'>) 
</span><a name="LN27"></a>#   define <span class='Declare_Constant'>pg_write_barrier_impl</span> <a href="arch-hppa.h.html#LN16"><span class='Ref_to_Macro'>pg_memory_barrier_impl</span></a> 
<span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifndef</span> <a href="generic.h.html#LN31"><span class='Ref_to_Const'>PG_HAVE_SPIN_DELAY</span></a> 
<a name="LN31"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_SPIN_DELAY</span> 
<a name="LN32"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>pg_spin_delay_impl</span><span class='Parentheses'>()</span>    <span class='Parentheses'>((</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/* provide fallback */ 
</span><span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN38"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FLAG_SUPPORT</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN20"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_U32_SUPPORT</span></a><span class='Parentheses'>) 
</span><a name="LN38"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_FLAG_SUPPORT</span> 
<a name="LN39"></a><span class='Control'>typedef</span> <a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Declare_Typedef'>pg_atomic_flag</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifndef</span> <a href="generic.h.html#LN43"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_READ_U32</span></a> 
<a name="LN43"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_READ_U32</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN45"></a><span class='Declare_Function'>pg_atomic_read_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="generic.h.html#LN45"><span class='Ref_to_Parameter'>ptr</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifndef</span> <a href="generic.h.html#LN52"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_WRITE_U32</span></a> 
<a name="LN52"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_WRITE_U32</span> 
<span class='Keyword'>static inline void 
</span><a name="LN54"></a><span class='Declare_Function'>pg_atomic_write_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="generic.h.html#LN54"><span class='Ref_to_Parameter'>ptr</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="generic.h.html#LN54"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifndef</span> <a href="generic.h.html#LN61"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_UNLOCKED_WRITE_U32</span></a> 
<a name="LN61"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_UNLOCKED_WRITE_U32</span> 
<span class='Keyword'>static inline void 
</span><a name="LN63"></a><span class='Declare_Function'>pg_atomic_unlocked_write_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="generic.h.html#LN63"><span class='Ref_to_Parameter'>ptr</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="generic.h.html#LN63"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * provide fallback for test_and_set using atomic_exchange if available 
 */ 
</span><span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN81"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_TEST_SET_FLAG</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN167"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_EXCHANGE_U32</span></a><span class='Parentheses'>) 
</span> 
<a name="LN74"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_INIT_FLAG</span> 
<span class='Keyword'>static inline void 
</span><a name="LN76"></a><span class='Declare_Function'>pg_atomic_init_flag_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN56"><span class='Ref_to_Struct'>pg_atomic_flag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="generic.h.html#LN53"><span class='Ref_to_Func'>pg_atomic_write_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN76"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN81"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_TEST_SET_FLAG</span> 
<span class='Keyword'>static inline bool 
</span><a name="LN83"></a><span class='Declare_Function'>pg_atomic_test_set_flag_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN56"><span class='Ref_to_Struct'>pg_atomic_flag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN168"><span class='Ref_to_Func'>pg_atomic_exchange_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN83"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN88"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_UNLOCKED_TEST_FLAG</span> 
<span class='Keyword'>static inline bool 
</span><a name="LN90"></a><span class='Declare_Function'>pg_atomic_unlocked_test_flag_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN56"><span class='Ref_to_Struct'>pg_atomic_flag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN44"><span class='Ref_to_Func'>pg_atomic_read_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN90"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
 
<a name="LN96"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_CLEAR_FLAG</span> 
<span class='Keyword'>static inline void 
</span><a name="LN98"></a><span class='Declare_Function'>pg_atomic_clear_flag_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN56"><span class='Ref_to_Struct'>pg_atomic_flag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* XXX: release semantics suffice? */ 
</span>    <a href="arch-hppa.h.html#LN16"><span class='Ref_to_Macro'>pg_memory_barrier_impl</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="generic.h.html#LN53"><span class='Ref_to_Func'>pg_atomic_write_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN98"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * provide fallback for test_and_set using atomic_compare_exchange if 
 * available. 
 */ 
</span><span class='Directive'>#elif</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN81"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_TEST_SET_FLAG</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN37"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U32</span></a><span class='Parentheses'>) 
</span> 
<a name="LN111"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_INIT_FLAG</span> 
<span class='Keyword'>static inline void 
</span><a name="LN113"></a><span class='Declare_Function'>pg_atomic_init_flag_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN56"><span class='Ref_to_Struct'>pg_atomic_flag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="generic.h.html#LN53"><span class='Ref_to_Func'>pg_atomic_write_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN113"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN118"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_TEST_SET_FLAG</span> 
<span class='Keyword'>static inline bool 
</span><a name="LN120"></a><span class='Declare_Function'>pg_atomic_test_set_flag_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN56"><span class='Ref_to_Struct'>pg_atomic_flag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN122"></a>    <a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Local'>value</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="generic-xlc.h.html#LN38"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN120"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN126"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_UNLOCKED_TEST_FLAG</span> 
<span class='Keyword'>static inline bool 
</span><a name="LN128"></a><span class='Declare_Function'>pg_atomic_unlocked_test_flag_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN56"><span class='Ref_to_Struct'>pg_atomic_flag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN44"><span class='Ref_to_Func'>pg_atomic_read_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN128"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN133"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_CLEAR_FLAG</span> 
<span class='Keyword'>static inline void 
</span><a name="LN135"></a><span class='Declare_Function'>pg_atomic_clear_flag_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN56"><span class='Ref_to_Struct'>pg_atomic_flag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Use a memory barrier + plain write if we have a native memory 
     * barrier. But don't do so if memory barriers use spinlocks - that'd lead 
     * to circularity if flags are used to implement spinlocks. 
     */ 
</span><span class='Directive'>#ifndef</span> <a href="fallback.h.html#LN31"><span class='Ref_to_Const'>PG_HAVE_MEMORY_BARRIER_EMULATION</span></a> 
    <span class='Comment_Multi_Line'>/* XXX: release semantics suffice? */ 
</span>    <a href="arch-hppa.h.html#LN16"><span class='Ref_to_Macro'>pg_memory_barrier_impl</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="generic.h.html#LN53"><span class='Ref_to_Func'>pg_atomic_write_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN135"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN147"></a>    <a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Local'>value</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="generic-xlc.h.html#LN38"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN135"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>} 
</span> 
<span class='Directive'>#elif</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN81"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_TEST_SET_FLAG</span></a><span class='Parentheses'>) 
</span>#   <a href="../../../interfaces/ecpg/test/expected/sql-dyntest.c.html#LN145"><span class='Ref_to_Func'>error</span></a> <span class='String'>"No pg_atomic_test_and_set provided"</span> 
<span class='Directive'>#endif</span> <span class='Comment_Single_Line'>/* !defined(PG_HAVE_ATOMIC_TEST_SET_FLAG) */ 
</span> 
 
<span class='Directive'>#ifndef</span> <a href="fallback.h.html#LN150"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_INIT_U32</span></a> 
<a name="LN158"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_INIT_U32</span> 
<span class='Keyword'>static inline void 
</span><a name="LN160"></a><span class='Declare_Function'>pg_atomic_init_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>val_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="generic.h.html#LN53"><span class='Ref_to_Func'>pg_atomic_write_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN160"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN160"><span class='Ref_to_Parameter'>val_</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN167"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_EXCHANGE_U32</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN37"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U32</span></a><span class='Parentheses'>) 
</span><a name="LN167"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_EXCHANGE_U32</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN169"></a><span class='Declare_Function'>pg_atomic_exchange_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>xchg_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN171"></a>    <a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="generic.h.html#LN171"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="generic.h.html#LN44"><span class='Ref_to_Func'>pg_atomic_read_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN169"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN38"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN169"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="generic.h.html#LN171"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN169"><span class='Ref_to_Parameter'>xchg_</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN171"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN60"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_ADD_U32</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN37"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U32</span></a><span class='Parentheses'>) 
</span><a name="LN183"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_FETCH_ADD_U32</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN185"></a><span class='Declare_Function'>pg_atomic_fetch_add_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>add_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN187"></a>    <a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="generic.h.html#LN187"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="generic.h.html#LN44"><span class='Ref_to_Func'>pg_atomic_read_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN185"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN38"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN185"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="generic.h.html#LN187"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN187"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>+ </span><a href="generic.h.html#LN185"><span class='Ref_to_Parameter'>add_</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN187"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN199"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_SUB_U32</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN37"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U32</span></a><span class='Parentheses'>) 
</span><a name="LN199"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_FETCH_SUB_U32</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN201"></a><span class='Declare_Function'>pg_atomic_fetch_sub_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>sub_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="generic-msvc.h.html#LN61"><span class='Ref_to_Func'>pg_atomic_fetch_add_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN201"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="generic.h.html#LN201"><span class='Ref_to_Parameter'>sub_</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN208"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_AND_U32</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN37"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U32</span></a><span class='Parentheses'>) 
</span><a name="LN208"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_FETCH_AND_U32</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN210"></a><span class='Declare_Function'>pg_atomic_fetch_and_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>and_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN212"></a>    <a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="generic.h.html#LN212"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="generic.h.html#LN44"><span class='Ref_to_Func'>pg_atomic_read_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN210"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN38"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN210"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="generic.h.html#LN212"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN212"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>& </span><a href="generic.h.html#LN210"><span class='Ref_to_Parameter'>and_</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN212"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN224"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_OR_U32</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN37"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U32</span></a><span class='Parentheses'>) 
</span><a name="LN224"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_FETCH_OR_U32</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN226"></a><span class='Declare_Function'>pg_atomic_fetch_or_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>or_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN228"></a>    <a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="generic.h.html#LN228"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="generic.h.html#LN44"><span class='Ref_to_Func'>pg_atomic_read_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN226"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="generic-xlc.h.html#LN38"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN226"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="generic.h.html#LN228"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN228"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>| </span><a href="generic.h.html#LN226"><span class='Ref_to_Parameter'>or_</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN228"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN240"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_ADD_FETCH_U32</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN60"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_ADD_U32</span></a><span class='Parentheses'>) 
</span><a name="LN240"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_ADD_FETCH_U32</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN242"></a><span class='Declare_Function'>pg_atomic_add_fetch_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>add_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="generic-msvc.h.html#LN61"><span class='Ref_to_Func'>pg_atomic_fetch_add_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN242"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN242"><span class='Ref_to_Parameter'>add_</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="generic.h.html#LN242"><span class='Ref_to_Parameter'>add_</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN249"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_SUB_FETCH_U32</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN199"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_SUB_U32</span></a><span class='Parentheses'>) 
</span><a name="LN249"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_SUB_FETCH_U32</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN251"></a><span class='Declare_Function'>pg_atomic_sub_fetch_u32_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>sub_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN200"><span class='Ref_to_Func'>pg_atomic_fetch_sub_u32_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN251"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN251"><span class='Ref_to_Parameter'>sub_</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="generic.h.html#LN251"><span class='Ref_to_Parameter'>sub_</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN258"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_EXCHANGE_U64</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN75"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U64</span></a><span class='Parentheses'>) 
</span><a name="LN258"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_EXCHANGE_U64</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN260"></a><span class='Declare_Function'>pg_atomic_exchange_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>xchg_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN262"></a>    <a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="generic.h.html#LN262"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="generic.h.html#LN260"><span class='Ref_to_Parameter'>ptr</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN76"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN260"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="generic.h.html#LN262"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN260"><span class='Ref_to_Parameter'>xchg_</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN262"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifndef</span> <a href="generic.h.html#LN274"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_WRITE_U64</span></a> 
<a name="LN274"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_WRITE_U64</span> 
 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span><a href="arch-ppc.h.html#LN28"><span class='Ref_to_Const'>PG_HAVE_8BYTE_SINGLE_COPY_ATOMICITY</span></a><span class='Parentheses'>) </span><span class='Operator'>&& \ 
</span>    <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="fallback.h.html#LN106"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_U64_SIMULATION</span></a><span class='Parentheses'>) 
</span> 
<span class='Keyword'>static inline void 
</span><a name="LN280"></a><span class='Declare_Function'>pg_atomic_write_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * On this platform aligned 64bit writes are guaranteed to be atomic, 
     * except if using the fallback implementation, where can't guarantee the 
     * required alignment. 
     */ 
</span>    <a href="../../c.h.html#LN678"><span class='Ref_to_Macro'>AssertPointerAlignment</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN280"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="generic.h.html#LN280"><span class='Ref_to_Parameter'>ptr</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="generic.h.html#LN280"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Directive'>#else</span> 
 
<span class='Keyword'>static inline void 
</span><a name="LN294"></a><span class='Declare_Function'>pg_atomic_write_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * 64 bit writes aren't safe on all platforms. In the generic 
     * implementation implement them as an atomic exchange. 
     */ 
</span>    <a href="generic.h.html#LN259"><span class='Ref_to_Func'>pg_atomic_exchange_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN294"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN294"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Directive'>#endif</span> <span class='Comment_Single_Line'>/* PG_HAVE_8BYTE_SINGLE_COPY_ATOMICITY && !PG_HAVE_ATOMIC_U64_SIMULATION */ 
</span><span class='Directive'>#endif</span> <span class='Comment_Single_Line'>/* PG_HAVE_ATOMIC_WRITE_U64 */ 
</span> 
<span class='Directive'>#ifndef</span> <a href="generic.h.html#LN307"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_READ_U64</span></a> 
<a name="LN307"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_READ_U64</span> 
 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span><a href="arch-ppc.h.html#LN28"><span class='Ref_to_Const'>PG_HAVE_8BYTE_SINGLE_COPY_ATOMICITY</span></a><span class='Parentheses'>) </span><span class='Operator'>&& \ 
</span>    <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="fallback.h.html#LN106"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_U64_SIMULATION</span></a><span class='Parentheses'>) 
</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN313"></a><span class='Declare_Function'>pg_atomic_read_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * On this platform aligned 64bit reads are guaranteed to be atomic, 
     * except if using the fallback implementation, where can't guarantee the 
     * required alignment. 
     */ 
</span>    <a href="../../c.h.html#LN678"><span class='Ref_to_Macro'>AssertPointerAlignment</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN313"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="generic.h.html#LN313"><span class='Ref_to_Parameter'>ptr</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Directive'>#else</span> 
 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN327"></a><span class='Declare_Function'>pg_atomic_read_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN329"></a>    <a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Local'>old</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 64 bit reads aren't safe on all platforms. In the generic 
     * implementation implement them as a compare/exchange with 0. That'll 
     * fail or succeed, but always return the old value. Possible might store 
     * a 0, but only if the prev. value also was a 0 - i.e. harmless. 
     */ 
</span>    <a href="generic-msvc.h.html#LN76"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN327"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="generic.h.html#LN329"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="generic.h.html#LN329"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> <span class='Comment_Single_Line'>/* PG_HAVE_8BYTE_SINGLE_COPY_ATOMICITY && !PG_HAVE_ATOMIC_U64_SIMULATION */ 
</span><span class='Directive'>#endif</span> <span class='Comment_Single_Line'>/* PG_HAVE_ATOMIC_READ_U64 */ 
</span> 
<span class='Directive'>#ifndef</span> <a href="fallback.h.html#LN168"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_INIT_U64</span></a> 
<a name="LN345"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_INIT_U64</span> 
<span class='Keyword'>static inline void 
</span><a name="LN347"></a><span class='Declare_Function'>pg_atomic_init_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>val_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="generic.h.html#LN279"><span class='Ref_to_Func'>pg_atomic_write_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN347"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN347"><span class='Ref_to_Parameter'>val_</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN92"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_ADD_U64</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN75"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U64</span></a><span class='Parentheses'>) 
</span><a name="LN354"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_FETCH_ADD_U64</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN356"></a><span class='Declare_Function'>pg_atomic_fetch_add_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>add_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN358"></a>    <a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="generic.h.html#LN358"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="generic.h.html#LN312"><span class='Ref_to_Func'>pg_atomic_read_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN356"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN76"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN356"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="generic.h.html#LN358"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN358"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>+ </span><a href="generic.h.html#LN356"><span class='Ref_to_Parameter'>add_</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN358"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN370"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_SUB_U64</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN75"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U64</span></a><span class='Parentheses'>) 
</span><a name="LN370"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_FETCH_SUB_U64</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN372"></a><span class='Declare_Function'>pg_atomic_fetch_sub_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>sub_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="generic-msvc.h.html#LN93"><span class='Ref_to_Func'>pg_atomic_fetch_add_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN372"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="generic.h.html#LN372"><span class='Ref_to_Parameter'>sub_</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN379"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_AND_U64</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN75"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U64</span></a><span class='Parentheses'>) 
</span><a name="LN379"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_FETCH_AND_U64</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN381"></a><span class='Declare_Function'>pg_atomic_fetch_and_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>and_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN383"></a>    <a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="generic.h.html#LN383"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="generic.h.html#LN312"><span class='Ref_to_Func'>pg_atomic_read_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN381"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN76"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN381"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="generic.h.html#LN383"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN383"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>& </span><a href="generic.h.html#LN381"><span class='Ref_to_Parameter'>and_</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN383"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN395"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_OR_U64</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN75"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_COMPARE_EXCHANGE_U64</span></a><span class='Parentheses'>) 
</span><a name="LN395"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_FETCH_OR_U64</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN397"></a><span class='Declare_Function'>pg_atomic_fetch_or_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>or_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN399"></a>    <a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="generic.h.html#LN399"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="generic.h.html#LN312"><span class='Ref_to_Func'>pg_atomic_read_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN397"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN76"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN397"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="generic.h.html#LN399"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN399"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>| </span><a href="generic.h.html#LN397"><span class='Ref_to_Parameter'>or_</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN399"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN411"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_ADD_FETCH_U64</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic-msvc.h.html#LN92"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_ADD_U64</span></a><span class='Parentheses'>) 
</span><a name="LN411"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_ADD_FETCH_U64</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN413"></a><span class='Declare_Function'>pg_atomic_add_fetch_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>add_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="generic-msvc.h.html#LN93"><span class='Ref_to_Func'>pg_atomic_fetch_add_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN413"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN413"><span class='Ref_to_Parameter'>add_</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="generic.h.html#LN413"><span class='Ref_to_Parameter'>add_</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN420"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_SUB_FETCH_U64</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="generic.h.html#LN370"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FETCH_SUB_U64</span></a><span class='Parentheses'>) 
</span><a name="LN420"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_HAVE_ATOMIC_SUB_FETCH_U64</span> 
<span class='Keyword'>static inline </span><a href="../../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN422"></a><span class='Declare_Function'>pg_atomic_sub_fetch_u64_impl</span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><a href="../../c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>sub_</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="generic.h.html#LN371"><span class='Ref_to_Func'>pg_atomic_fetch_sub_u64_impl</span></a><span class='Parentheses'>(</span><a href="generic.h.html#LN422"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="generic.h.html#LN422"><span class='Ref_to_Parameter'>sub_</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="generic.h.html#LN422"><span class='Ref_to_Parameter'>sub_</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>