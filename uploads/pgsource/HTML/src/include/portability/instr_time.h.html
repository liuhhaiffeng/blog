<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\include\portability\instr_time.h</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\include\portability\instr_time.h</b></p></td>
<td align='right'>
Wed Jun 14 08:26:07 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
/*------------------------------------------------------------------------- 
 * 
 * instr_time.h 
 *    portable high-precision interval timing 
 * 
 * This file provides an abstraction layer to hide portability issues in 
 * interval timing.  On Unix we use clock_gettime() if available, else 
 * gettimeofday().  On Windows, gettimeofday() gives a low-precision result 
 * so we must use QueryPerformanceCounter() instead.  These macros also give 
 * some breathing room to use other high-precision-timing APIs. 
 * 
 * The basic data type is instr_time, which all callers should treat as an 
 * opaque typedef.  instr_time can store either an absolute time (of 
 * unspecified reference time) or an interval.  The operations provided 
 * for it are: 
 * 
 * INSTR_TIME_IS_ZERO(t)            is t equal to zero? 
 * 
 * INSTR_TIME_SET_ZERO(t)           set t to zero (memset is acceptable too) 
 * 
 * INSTR_TIME_SET_CURRENT(t)        set t to current time 
 * 
 * INSTR_TIME_ADD(x, y)             x += y 
 * 
 * INSTR_TIME_SUBTRACT(x, y)        x -= y 
 * 
 * INSTR_TIME_ACCUM_DIFF(x, y, z)   x += (y - z) 
 * 
 * INSTR_TIME_GET_DOUBLE(t)         convert t to double (in seconds) 
 * 
 * INSTR_TIME_GET_MILLISEC(t)       convert t to double (in milliseconds) 
 * 
 * INSTR_TIME_GET_MICROSEC(t)       convert t to uint64 (in microseconds) 
 * 
 * Note that INSTR_TIME_SUBTRACT and INSTR_TIME_ACCUM_DIFF convert 
 * absolute times to intervals.  The INSTR_TIME_GET_xxx operations are 
 * only useful on intervals. 
 * 
 * When summing multiple measurements, it's recommended to leave the 
 * running sum in instr_time form (ie, use INSTR_TIME_ADD or 
 * INSTR_TIME_ACCUM_DIFF) and convert to a result format only at the end. 
 * 
 * Beware of multiple evaluations of the macro arguments. 
 * 
 * 
 * Copyright (c) 2001-2017, PostgreSQL Global Development Group 
 * 
 * src/include/portability/instr_time.h 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Directive'>#ifndef</span> <a href="instr_time.h.html#LN52"><span class='Ref_to_Const'>INSTR_TIME_H</span></a> 
<a name="LN52"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>INSTR_TIME_H</span> 
 
<span class='Directive'>#ifndef</span> <a href="../c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
<span class='Directive'>#ifdef</span> HAVE_CLOCK_GETTIME 
 
<span class='Comment_Multi_Line'>/* Use clock_gettime() */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;time.h&GT;</span> 
 
<span class='Comment_Multi_Line'>/* 
 * The best clockid to use according to the POSIX spec is CLOCK_MONOTONIC, 
 * since that will give reliable interval timing even in the face of changes 
 * to the system clock.  However, POSIX doesn't require implementations to 
 * provide anything except CLOCK_REALTIME, so fall back to that if we don't 
 * find CLOCK_MONOTONIC. 
 * 
 * Also, some implementations have nonstandard clockids with better properties 
 * than CLOCK_MONOTONIC.  In particular, as of macOS 10.12, Apple provides 
 * CLOCK_MONOTONIC_RAW which is both faster to read and higher resolution than 
 * their version of CLOCK_MONOTONIC. 
 */ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span><a href="../port/darwin.h.html#LN2"><span class='Ref_to_Const'>__darwin__</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span>CLOCK_MONOTONIC_RAW<span class='Parentheses'>) 
</span><a name="LN75"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_INSTR_CLOCK</span>  CLOCK_MONOTONIC_RAW 
<span class='Directive'>#elif</span> defined<span class='Parentheses'>(</span>CLOCK_MONOTONIC<span class='Parentheses'>) 
</span><a name="LN77"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_INSTR_CLOCK</span>  CLOCK_MONOTONIC 
<span class='Directive'>#else</span> 
<a name="LN79"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_INSTR_CLOCK</span>  CLOCK_REALTIME 
<span class='Directive'>#endif</span> 
 
<a name="LN82"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> timespec <span class='Declare_Typedef'>instr_time</span><span class='Delimiter'>; 
</span> 
<a name="LN84"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_IS_ZERO</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span>   <span class='Parentheses'>((</span><a href="instr_time.h.html#LN84"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN84"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN86"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_SET_ZERO</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span>  <span class='Parentheses'>((</span><a href="instr_time.h.html#LN86"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN86"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN88"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_SET_CURRENT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span>   <span class='Parentheses'>((</span><span class='Keyword'>void</span><span class='Parentheses'>)</span> clock_gettime<span class='Parentheses'>(</span><a href="instr_time.h.html#LN75"><span class='Ref_to_Const'>PG_INSTR_CLOCK</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN88"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)))</span> 
 
<a name="LN90"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_ADD</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>y</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN90"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN90"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN90"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN90"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Normalize */ </span><span class='Operator'>\ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="instr_time.h.html#LN90"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>&GT;= </span><span class='Number'>1000000000</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN90"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>-= </span><span class='Number'>1000000000</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN90"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Operator'>++</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN102"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_SUBTRACT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>y</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN102"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>-= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN102"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN102"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>-= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN102"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Normalize */ </span><span class='Operator'>\ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="instr_time.h.html#LN102"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN102"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>+= </span><span class='Number'>1000000000</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN102"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Operator'>--</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN114"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_ACCUM_DIFF</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>y</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>z</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>z</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>z</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Normalize after each add to avoid overflow/underflow of tv_nsec */ </span><span class='Operator'>\ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>+= </span><span class='Number'>1000000000</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Operator'>--</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>&GT;= </span><span class='Number'>1000000000</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>-= </span><span class='Number'>1000000000</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN114"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Operator'>++</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN131"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_GET_DOUBLE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN131"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN131"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec<span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Number'>1000000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN134"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_GET_MILLISEC</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN134"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>* </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN134"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec<span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN137"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_GET_MICROSEC</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><a href="../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN137"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><span class='Number'>1000000</span><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="instr_time.h.html#LN137"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_nsec <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>))</span> 
 
<span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* !HAVE_CLOCK_GETTIME */ 
</span> 
<span class='Comment_Multi_Line'>/* Use gettimeofday() */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/time.h&GT;</span> 
 
<a name="LN146"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> timeval <span class='Declare_Typedef'>instr_time</span><span class='Delimiter'>; 
</span> 
<a name="LN148"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_IS_ZERO</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span>   <span class='Parentheses'>((</span><a href="instr_time.h.html#LN148"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN148"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN150"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_SET_ZERO</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span>  <span class='Parentheses'>((</span><a href="instr_time.h.html#LN150"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN150"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN152"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_SET_CURRENT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span>   <a href="../../port/gettimeofday.c.html#LN103"><span class='Ref_to_Func'>gettimeofday</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN152"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
 
<a name="LN154"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_ADD</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>y</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN154"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN154"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN154"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN154"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Normalize */ </span><span class='Operator'>\ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="instr_time.h.html#LN154"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>&GT;= </span><span class='Number'>1000000</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN154"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>-= </span><span class='Number'>1000000</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN154"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Operator'>++</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN166"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_SUBTRACT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>y</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN166"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>-= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN166"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN166"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>-= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN166"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Normalize */ </span><span class='Operator'>\ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="instr_time.h.html#LN166"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN166"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>+= </span><span class='Number'>1000000</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN166"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Operator'>--</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN178"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_ACCUM_DIFF</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>y</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>z</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>z</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>z</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* Normalize after each add to avoid overflow/underflow of tv_usec */ </span><span class='Operator'>\ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>+= </span><span class='Number'>1000000</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Operator'>--</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>&GT;= </span><span class='Number'>1000000</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec <span class='Operator'>-= </span><span class='Number'>1000000</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="instr_time.h.html#LN178"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Operator'>++</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN195"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_GET_DOUBLE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN195"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec<span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN195"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec<span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN198"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_GET_MILLISEC</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN198"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>* </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN198"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec<span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN201"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_GET_MICROSEC</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><a href="../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN201"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_sec <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><span class='Number'>1000000</span><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="instr_time.h.html#LN201"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tv_usec<span class='Parentheses'>)</span> 
 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_CLOCK_GETTIME */ 
</span> 
<span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
<span class='Comment_Multi_Line'>/* Use QueryPerformanceCounter() */ 
</span> 
<a name="LN210"></a><span class='Control'>typedef</span> LARGE_INTEGER <span class='Declare_Typedef'>instr_time</span><span class='Delimiter'>; 
</span> 
<a name="LN212"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_IS_ZERO</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span>   <span class='Parentheses'>((</span><a href="instr_time.h.html#LN212"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN214"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_SET_ZERO</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span>  <span class='Parentheses'>((</span><a href="instr_time.h.html#LN214"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart <span class='Operator'>= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN216"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_SET_CURRENT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span>   QueryPerformanceCounter<span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN216"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>))</span> 
 
<a name="LN218"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_ADD</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>y</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="instr_time.h.html#LN218"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN218"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart<span class='Parentheses'>)</span> 
 
<a name="LN221"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_SUBTRACT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>y</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="instr_time.h.html#LN221"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart <span class='Operator'>-= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN221"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart<span class='Parentheses'>)</span> 
 
<a name="LN224"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_ACCUM_DIFF</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>y</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>z</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="instr_time.h.html#LN224"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN224"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="instr_time.h.html#LN224"><span class='Ref_to_Parameter'>z</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart<span class='Parentheses'>)</span> 
 
<a name="LN227"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_GET_DOUBLE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN227"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart<span class='Parentheses'>)</span> <span class='Operator'>/ </span><a href="instr_time.h.html#LN236"><span class='Ref_to_Func'>GetTimerFrequency</span></a><span class='Parentheses'>())</span> 
 
<a name="LN230"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_GET_MILLISEC</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN230"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart <span class='Operator'>* </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>/ </span><a href="instr_time.h.html#LN236"><span class='Ref_to_Func'>GetTimerFrequency</span></a><span class='Parentheses'>())</span> 
 
<a name="LN233"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INSTR_TIME_GET_MICROSEC</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="../c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(((</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="instr_time.h.html#LN233"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>QuadPart <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>/ </span><a href="instr_time.h.html#LN236"><span class='Ref_to_Func'>GetTimerFrequency</span></a><span class='Parentheses'>()))</span> 
 
<span class='Keyword'>static inline double 
</span><a name="LN237"></a><span class='Declare_Function'>GetTimerFrequency</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN239"></a>    LARGE_INTEGER <span class='Declare_Local'>f</span><span class='Delimiter'>; 
</span> 
    QueryPerformanceFrequency<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="instr_time.h.html#LN239"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="instr_time.h.html#LN239"><span class='Ref_To_Local'>f</span></a><span class='Operator'>.</span>QuadPart<span class='Delimiter'>; 
} 
</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* INSTR_TIME_H */ 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>