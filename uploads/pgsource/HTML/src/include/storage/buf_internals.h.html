<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\include\storage\buf_internals.h</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\include\storage\buf_internals.h</b></p></td>
<td align='right'>
Wed Jun 14 08:26:08 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * buf_internals.h 
 *    Internal definitions for buffer manager and the buffer replacement 
 *    strategy. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * src/include/storage/buf_internals.h 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Directive'>#ifndef</span> <a href="buf_internals.h.html#LN15"><span class='Ref_to_Const'>BUFMGR_INTERNALS_H</span></a> 
<a name="LN15"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BUFMGR_INTERNALS_H</span> 
 
<span class='Keyword'>#include </span><span class='String'>"storage/buf.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/latch.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lwlock.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/shmem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/smgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"port/atomics.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/spin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/relcache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Buffer state is a single 32-bit variable where following data is combined. 
 * 
 * - 18 bits refcount 
 * - 4 bits usage count 
 * - 10 bits of flags 
 * 
 * Combining these values allows to perform some operations without locking 
 * the buffer header, by modifying them together with a CAS loop. 
 * 
 * The definition of buffer state components is below. 
 */ 
</span><a name="LN40"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BUF_REFCOUNT_ONE</span> <span class='Number'>1</span> 
<a name="LN41"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BUF_REFCOUNT_MASK</span> <span class='Parentheses'>((</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>18</span><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
<a name="LN42"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BUF_USAGECOUNT_MASK</span> <span class='Number'>0x003C0000U</span> 
<a name="LN43"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BUF_USAGECOUNT_ONE</span> <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>18</span><span class='Parentheses'>) 
</span><a name="LN44"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BUF_USAGECOUNT_SHIFT</span> <span class='Number'>18</span> 
<a name="LN45"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BUF_FLAG_MASK</span> <span class='Number'>0xFFC00000U</span> 
 
<span class='Comment_Multi_Line'>/* Get refcount and usagecount from buffer state */ 
</span><a name="LN48"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>BUF_STATE_GET_REFCOUNT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) ((</span><a href="buf_internals.h.html#LN48"><span class='Ref_to_Parameter'>state</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="buf_internals.h.html#LN41"><span class='Ref_to_Const'>BUF_REFCOUNT_MASK</span></a><span class='Parentheses'>)</span> 
<a name="LN49"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>BUF_STATE_GET_USAGECOUNT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) (((</span><a href="buf_internals.h.html#LN49"><span class='Ref_to_Parameter'>state</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="buf_internals.h.html#LN42"><span class='Ref_to_Const'>BUF_USAGECOUNT_MASK</span></a><span class='Parentheses'>)</span> <span class='Operator'>&GT;&GT; </span><a href="buf_internals.h.html#LN44"><span class='Ref_to_Const'>BUF_USAGECOUNT_SHIFT</span></a><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Flags for buffer descriptors 
 * 
 * Note: TAG_VALID essentially means that there is a buffer hashtable 
 * entry associated with the buffer's tag. 
 */ 
</span><a name="LN57"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_LOCKED</span>               <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>22</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* buffer header is locked */ 
</span><a name="LN58"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_DIRTY</span>                <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>23</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* data needs writing */ 
</span><a name="LN59"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_VALID</span>                <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>24</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* data is valid */ 
</span><a name="LN60"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_TAG_VALID</span>            <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>25</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* tag is assigned */ 
</span><a name="LN61"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_IO_IN_PROGRESS</span>       <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>26</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* read or write in progress */ 
</span><a name="LN62"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_IO_ERROR</span>             <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>27</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* previous I/O failed */ 
</span><a name="LN63"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_JUST_DIRTIED</span>         <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>28</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* dirtied since write started */ 
</span><a name="LN64"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_PIN_COUNT_WAITER</span>     <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>29</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* have waiter for sole pin */ 
</span><a name="LN65"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_CHECKPOINT_NEEDED</span>    <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>30</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* must write for checkpoint */ 
</span><a name="LN66"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_PERMANENT</span>            <span class='Parentheses'>(</span><span class='Number'>1U</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>31</span><span class='Parentheses'>)</span>      <span class='Comment_Multi_Line'>/* permanent buffer (not 
                                                 * unlogged, or init fork) */ 
/* 
 * The maximum allowed value of usage_count represents a tradeoff between 
 * accuracy and speed of the clock-sweep buffer management algorithm.  A 
 * large value (comparable to NBuffers) would approximate LRU semantics. 
 * But it can take as many as BM_MAX_USAGE_COUNT+1 complete cycles of 
 * clock sweeps to find a free buffer, so in practice we don't want the 
 * value to be very large. 
 */ 
</span><a name="LN76"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BM_MAX_USAGE_COUNT</span>  <span class='Number'>5</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Buffer tag identifies which disk block the buffer contains. 
 * 
 * Note: the BufferTag data must be sufficient to determine where to write the 
 * block, without reference to pg_class or pg_tablespace entries.  It's 
 * possible that the backend flushing the buffer doesn't even believe the 
 * relation is visible yet (its xact may have started before the xact that 
 * created the rel).  The storage manager must be able to cope anyway. 
 * 
 * Note: if there's any pad bytes in the struct, INIT_BUFFERTAG will have 
 * to be fixed to zero them, since this struct is used as a hash key. 
 */ 
</span><a name="LN90"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>buftag</span> 
<span class='Delimiter'>{ 
</span><a name="LN92"></a>    <a href="relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Member'>rnode</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* physical relation identifier */ 
</span><a name="LN93"></a>    <a href="../common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a>  <span class='Declare_Member'>forkNum</span><span class='Delimiter'>; 
</span><a name="LN94"></a>    <a href="block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Member'>blockNum</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* blknum relative to begin of reln */ 
</span><a name="LN95"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>BufferTag</span><span class='Delimiter'>; 
</span> 
<a name="LN97"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CLEAR_BUFFERTAG</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="buf_internals.h.html#LN97"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>rnode<span class='Operator'>.</span>spcNode <span class='Operator'>= </span><a href="../postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="buf_internals.h.html#LN97"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>rnode<span class='Operator'>.</span>dbNode <span class='Operator'>= </span><a href="../postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="buf_internals.h.html#LN97"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>rnode<span class='Operator'>.</span>relNode <span class='Operator'>= </span><a href="../postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="buf_internals.h.html#LN97"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>forkNum <span class='Operator'>= </span><a href="../common/relpath.h.html#LN25"><span class='Ref_to_EnumConst'>InvalidForkNumber</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="buf_internals.h.html#LN97"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>blockNum <span class='Operator'>= </span><a href="block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a> <span class='Operator'>\ 
</span><span class='Parentheses'>)</span> 
 
<a name="LN106"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>INIT_BUFFERTAG</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>xx_rnode</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>xx_forkNum</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>xx_blockNum</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="buf_internals.h.html#LN106"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>rnode <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN106"><span class='Ref_to_Parameter'>xx_rnode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="buf_internals.h.html#LN106"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>forkNum <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN106"><span class='Ref_to_Parameter'>xx_forkNum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="buf_internals.h.html#LN106"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>blockNum <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN106"><span class='Ref_to_Parameter'>xx_blockNum</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Parentheses'>)</span> 
 
<a name="LN113"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>BUFFERTAGS_EQUAL</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>    <a href="relfilenode.h.html#LN87"><span class='Ref_to_Macro'>RelFileNodeEquals</span></a><span class='Parentheses'>((</span><a href="buf_internals.h.html#LN113"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>rnode<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN113"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>rnode<span class='Parentheses'>)</span> <span class='Operator'>&& \ 
</span>    <span class='Parentheses'>(</span><a href="buf_internals.h.html#LN113"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>blockNum <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN113"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>blockNum <span class='Operator'>&& \ 
</span>    <span class='Parentheses'>(</span><a href="buf_internals.h.html#LN113"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>forkNum <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN113"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>forkNum <span class='Operator'>\ 
</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * The shared buffer mapping table is partitioned to reduce contention. 
 * To determine which partition lock a given tag requires, compute the tag's 
 * hash code with BufTableHashCode(), then apply BufMappingPartitionLock(). 
 * NB: NUM_BUFFER_PARTITIONS must be a power of 2! 
 */ 
</span><a name="LN126"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>BufTableHashPartition</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>hashcode</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="buf_internals.h.html#LN126"><span class='Ref_to_Parameter'>hashcode</span></a><span class='Parentheses'>) </span><span class='Operator'>% </span><a href="lwlock.h.html#LN112"><span class='Ref_to_Const'>NUM_BUFFER_PARTITIONS</span></a><span class='Parentheses'>)</span> 
<a name="LN128"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>BufMappingPartitionLock</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>hashcode</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../backend/storage/lmgr/lwlock.c.html#LN124"><span class='Ref_to_Global_Var'>MainLWLockArray</span></a><span class='Delimiter'>[</span><a href="lwlock.h.html#LN123"><span class='Ref_to_Const'>BUFFER_MAPPING_LWLOCK_OFFSET</span></a> <span class='Operator'>+ \ 
</span>        <a href="buf_internals.h.html#LN126"><span class='Ref_to_Macro'>BufTableHashPartition</span></a><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN128"><span class='Ref_to_Parameter'>hashcode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Operator'>.</span>lock<span class='Parentheses'>)</span> 
<a name="LN131"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>BufMappingPartitionLockByIndex</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>i</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../backend/storage/lmgr/lwlock.c.html#LN124"><span class='Ref_to_Global_Var'>MainLWLockArray</span></a><span class='Delimiter'>[</span><a href="lwlock.h.html#LN123"><span class='Ref_to_Const'>BUFFER_MAPPING_LWLOCK_OFFSET</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN131"><span class='Ref_to_Parameter'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="lwlock.h.html#LN78"><span class='Ref_to_Member'>lock</span></a><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 *  BufferDesc -- shared descriptor/state data for a single shared buffer. 
 * 
 * Note: Buffer header lock (BM_LOCKED flag) must be held to examine or change 
 * the tag, state or wait_backend_pid fields.  In general, buffer header lock 
 * is a spinlock which is combined with flags, refcount and usagecount into 
 * single atomic variable.  This layout allow us to do some operations in a 
 * single atomic operation, without actually acquiring and releasing spinlock; 
 * for instance, increase or decrease refcount.  buf_id field never changes 
 * after initialization, so does not need locking.  freeNext is protected by 
 * the buffer_strategy_lock not buffer header lock.  The LWLock can take care 
 * of itself.  The buffer header lock is *not* used to control access to the 
 * data in the buffer! 
 * 
 * It's assumed that nobody changes the state field while buffer header lock 
 * is held.  Thus buffer header lock holder can do complex updates of the 
 * state variable in single write, simultaneously with lock release (cleaning 
 * BM_LOCKED flag).  On the other hand, updating of state without holding 
 * buffer header lock is restricted to CAS, which insure that BM_LOCKED flag 
 * is not set.  Atomic increment/decrement, OR/AND etc. are not allowed. 
 * 
 * An exception is that if we have the buffer pinned, its tag can't change 
 * underneath us, so we can examine the tag without locking the buffer header. 
 * Also, in places we do one-time reads of the flags without bothering to 
 * lock the buffer header; this is generally for situations where we don't 
 * expect the flag bit being tested to be changing. 
 * 
 * We can't physically remove items from a disk page if another backend has 
 * the buffer pinned.  Hence, a backend may need to wait for all other pins 
 * to go away.  This is signaled by storing its own PID into 
 * wait_backend_pid and setting flag bit BM_PIN_COUNT_WAITER.  At present, 
 * there can be only one such waiter per buffer. 
 * 
 * We use this same struct for local buffer headers, but the locks are not 
 * used and not all of the flag bits are useful either. To avoid unnecessary 
 * overhead, manipulations of the state field should be done without actual 
 * atomic operations (i.e. only pg_atomic_read_u32() and 
 * pg_atomic_unlocked_write_u32()). 
 * 
 * Be careful to avoid increasing the size of the struct when adding or 
 * reordering members.  Keeping it below 64 bytes (the most common CPU 
 * cache line size) is fairly important for performance. 
 */ 
</span><a name="LN177"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>BufferDesc</span> 
<span class='Delimiter'>{ 
</span><a name="LN179"></a>    <a href="buf_internals.h.html#LN90"><span class='Ref_to_Typedef'>BufferTag</span></a>   <span class='Declare_Member'>tag</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* ID of page contained in buffer */ 
</span><a name="LN180"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>buf_id</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* buffer's index number (from 0) */ 
</span> 
    <span class='Comment_Multi_Line'>/* state of the tag, containing flags, refcount and usagecount */ 
</span><a name="LN183"></a>    <a href="../port/atomics/arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Declare_Member'>state</span><span class='Delimiter'>; 
</span> 
<a name="LN185"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>wait_backend_pid</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* backend PID of pin-count waiter */ 
</span><a name="LN186"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>freeNext</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* link in freelist chain */ 
</span> 
<a name="LN188"></a>    <a href="lwlock.h.html#LN31"><span class='Ref_to_Struct'>LWLock</span></a>      <span class='Declare_Member'>content_lock</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* to lock access to buffer contents */ 
</span><a name="LN189"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>BufferDesc</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Concurrent access to buffer headers has proven to be more efficient if 
 * they're cache line aligned. So we force the start of the BufferDescriptors 
 * array to be on a cache line boundary and force the elements to be cache 
 * line sized. 
 * 
 * XXX: As this is primarily matters in highly concurrent workloads which 
 * probably all are 64bit these days, and the space wastage would be a bit 
 * more noticeable on 32bit systems, we don't force the stride to be cache 
 * line sized on those. If somebody does actual performance testing, we can 
 * reevaluate. 
 * 
 * Note that local buffer descriptors aren't forced to be aligned - as there's 
 * no concurrent access to those it's unlikely to be beneficial. 
 * 
 * We use 64bit as the cache line size here, because that's the most common 
 * size. Making it bigger would be a waste of memory. Even if running on a 
 * platform with either 32 or 128 byte line sizes, it's good to align to 
 * boundaries and avoid false sharing. 
 */ 
</span><a name="LN211"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BUFFERDESC_PAD_TO_SIZE</span>  <span class='Parentheses'>(</span>SIZEOF_VOID_P <span class='Operator'>== </span><span class='Number'>8</span> <span class='Operator'>? </span><span class='Number'>64</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Parentheses'>) 
</span> 
<a name="LN213"></a><span class='Control'>typedef</span> <span class='Control'>union</span> <span class='Declare_Union'>BufferDescPadded</span> 
<span class='Delimiter'>{ 
</span><a name="LN215"></a>    <a href="buf_internals.h.html#LN177"><span class='Ref_to_Struct'>BufferDesc</span></a>  <span class='Declare_Member'>bufferdesc</span><span class='Delimiter'>; 
</span><a name="LN216"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>pad</span><span class='Delimiter'>[</span><a href="buf_internals.h.html#LN211"><span class='Ref_to_Const'>BUFFERDESC_PAD_TO_SIZE</span></a><span class='Delimiter'>]; 
</span><a name="LN217"></a>} <span class='Declare_Typedef'>BufferDescPadded</span><span class='Delimiter'>; 
</span> 
<a name="LN219"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>GetBufferDescriptor</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>id</span><span class='Parentheses'>) (</span><span class='Operator'>&</span><a href="../../backend/storage/buffer/buf_init.c.html#LN20"><span class='Ref_to_Global_Var'>BufferDescriptors</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN219"><span class='Ref_to_Parameter'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="buf_internals.h.html#LN215"><span class='Ref_to_Member'>bufferdesc</span></a><span class='Parentheses'>)</span> 
<a name="LN220"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>GetLocalBufferDescriptor</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>id</span><span class='Parentheses'>) (</span><span class='Operator'>&</span><a href="../../backend/storage/buffer/localbuf.c.html#LN42"><span class='Ref_to_Global_Var'>LocalBufferDescriptors</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN220"><span class='Ref_to_Parameter'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
 
<a name="LN222"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>BufferDescriptorGetBuffer</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>bdesc</span><span class='Parentheses'>) ((</span><a href="buf_internals.h.html#LN222"><span class='Ref_to_Parameter'>bdesc</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>buf_id <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
 
<a name="LN224"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>BufferDescriptorGetIOLock</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>bdesc</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="../../backend/storage/buffer/buf_init.c.html#LN22"><span class='Ref_to_Global_Var'>BufferIOLWLockArray</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN224"><span class='Ref_to_Parameter'>bdesc</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>buf_id<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Operator'>.</span><a href="lwlock.h.html#LN85"><span class='Ref_to_Member'>lock</span></a><span class='Parentheses'>)</span> 
<a name="LN226"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>BufferDescriptorGetContentLock</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>bdesc</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lwlock.h.html#LN31"><span class='Ref_to_Struct'>LWLock</span></a><span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN226"><span class='Ref_to_Parameter'>bdesc</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>content_lock<span class='Parentheses'>))</span> 
 
<a name="LN229"></a><span class='Keyword'>extern </span><a href="../../interfaces/ecpg/include/sqlca.h.html#LN5"><span class='Ref_to_Const'>PGDLLIMPORT</span></a> <a href="lwlock.h.html#LN83"><span class='Ref_to_Union'>LWLockMinimallyPadded</span></a> <span class='Operator'>*</span><span class='Declare_Var'>BufferIOLWLockArray</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The freeNext field is either the index of the next freelist entry, 
 * or one of these special values: 
 */ 
</span><a name="LN235"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>FREENEXT_END_OF_LIST</span>    <span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>) 
</span><a name="LN236"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>FREENEXT_NOT_IN_LIST</span>    <span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>2</span><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Functions for acquiring/releasing a shared buffer header's spinlock.  Do 
 * not apply these to local buffers! 
 */ 
</span><a name="LN242"></a><span class='Keyword'>extern </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Prototype'>LockBufHdr</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN177"><span class='Ref_to_Struct'>BufferDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>desc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN243"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>UnlockBufHdr</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>s</span><span class='Parentheses'>)</span>   <span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{</span>    <span class='Operator'>\ 
</span>        <a href="../port/atomics.h.html#LN161"><span class='Ref_to_Macro'>pg_write_barrier</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="../port/atomics.h.html#LN267"><span class='Ref_to_Func'>pg_atomic_write_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN243"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>state<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN243"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Operator'>~</span><a href="buf_internals.h.html#LN57"><span class='Ref_to_Const'>BM_LOCKED</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * The PendingWriteback & WritebackContext structure are used to keep 
 * information about pending flush requests to be issued to the OS. 
 */ 
</span><a name="LN254"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PendingWriteback</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* could store different types of pending flushes here */ 
</span><a name="LN257"></a>    <a href="buf_internals.h.html#LN90"><span class='Ref_to_Typedef'>BufferTag</span></a>   <span class='Declare_Member'>tag</span><span class='Delimiter'>; 
</span><a name="LN258"></a>} <span class='Declare_Typedef'>PendingWriteback</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* struct forward declared in bufmgr.h */ 
</span><a name="LN261"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>WritebackContext</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* pointer to the max number of writeback requests to coalesce */ 
</span><a name="LN264"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>max_pending</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* current number of pending writeback requests */ 
</span><a name="LN267"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nr_pending</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* pending requests */ 
</span><a name="LN270"></a>    <a href="buf_internals.h.html#LN254"><span class='Ref_to_Struct'>PendingWriteback</span></a> <span class='Declare_Member'>pending_writebacks</span><span class='Delimiter'>[</span><a href="../pg_config_manual.h.html#LN164"><span class='Ref_to_Const'>WRITEBACK_MAX_PENDING_FLUSHES</span></a><span class='Delimiter'>]; 
</span><a name="LN271"></a>} <span class='Declare_Typedef'>WritebackContext</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* in buf_init.c */ 
</span><a name="LN274"></a><span class='Keyword'>extern </span><a href="../../interfaces/ecpg/include/sqlca.h.html#LN5"><span class='Ref_to_Const'>PGDLLIMPORT</span></a> <a href="buf_internals.h.html#LN213"><span class='Ref_to_Union'>BufferDescPadded</span></a> <span class='Operator'>*</span><span class='Declare_Var'>BufferDescriptors</span><span class='Delimiter'>; 
</span><a name="LN275"></a><span class='Keyword'>extern </span><a href="../../interfaces/ecpg/include/sqlca.h.html#LN5"><span class='Ref_to_Const'>PGDLLIMPORT</span></a> <a href="buf_internals.h.html#LN261"><span class='Ref_to_Struct'>WritebackContext</span></a> <span class='Declare_Var'>BackendWritebackContext</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* in localbuf.c */ 
</span><a name="LN278"></a><span class='Keyword'>extern </span><a href="buf_internals.h.html#LN177"><span class='Ref_to_Struct'>BufferDesc</span></a> <span class='Operator'>*</span><span class='Declare_Var'>LocalBufferDescriptors</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* in bufmgr.c */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Structure to sort buffers per file on checkpoints. 
 * 
 * This structure is allocated per buffer in shared memory, so it should be 
 * kept as small as possible. 
 */ 
</span><a name="LN288"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>CkptSortItem</span> 
<span class='Delimiter'>{ 
</span><a name="LN290"></a>    <a href="../postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>tsId</span><span class='Delimiter'>; 
</span><a name="LN291"></a>    <a href="../postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>relNode</span><span class='Delimiter'>; 
</span><a name="LN292"></a>    <a href="../common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a>  <span class='Declare_Member'>forkNum</span><span class='Delimiter'>; 
</span><a name="LN293"></a>    <a href="block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Member'>blockNum</span><span class='Delimiter'>; 
</span><a name="LN294"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>buf_id</span><span class='Delimiter'>; 
</span><a name="LN295"></a>} <span class='Declare_Typedef'>CkptSortItem</span><span class='Delimiter'>; 
</span> 
<a name="LN297"></a><span class='Keyword'>extern </span><a href="buf_internals.h.html#LN288"><span class='Ref_to_Struct'>CkptSortItem</span></a> <span class='Operator'>*</span><span class='Declare_Var'>CkptBufferIds</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Internal buffer management routines 
 */ 
/* bufmgr.c */ 
</span><a name="LN303"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>WritebackContextInit</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN261"><span class='Ref_to_Struct'>WritebackContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>max_pending</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN304"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>IssuePendingWritebacks</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN261"><span class='Ref_to_Struct'>WritebackContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN305"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>ScheduleBufferTagForWriteback</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN261"><span class='Ref_to_Struct'>WritebackContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><a href="buf_internals.h.html#LN90"><span class='Ref_to_Typedef'>BufferTag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* freelist.c */ 
</span><a name="LN308"></a><span class='Keyword'>extern </span><a href="buf_internals.h.html#LN177"><span class='Ref_to_Struct'>BufferDesc</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>StrategyGetBuffer</span><span class='Parentheses'>(</span><a href="buf.h.html#LN43"><span class='Ref_to_Typedef'>BufferAccessStrategy</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, 
</span><a name="LN309"></a>                  <a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf_state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN310"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>StrategyFreeBuffer</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN177"><span class='Ref_to_Struct'>BufferDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN311"></a><span class='Keyword'>extern bool </span><span class='Declare_Prototype'>StrategyRejectBuffer</span><span class='Parentheses'>(</span><a href="buf.h.html#LN43"><span class='Ref_to_Typedef'>BufferAccessStrategy</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, 
</span><a name="LN312"></a>                     <a href="buf_internals.h.html#LN177"><span class='Ref_to_Struct'>BufferDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN314"></a><span class='Keyword'>extern int</span>  <span class='Declare_Prototype'>StrategySyncStart</span><span class='Parentheses'>(</span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>complete_passes</span><span class='Delimiter'>, </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>num_buf_alloc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN315"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>StrategyNotifyBgWriter</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>bgwprocno</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN317"></a><span class='Keyword'>extern </span><a href="../c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Prototype'>StrategyShmemSize</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN318"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>StrategyInitialize</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>init</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* buf_table.c */ 
</span><a name="LN321"></a><span class='Keyword'>extern </span><a href="../c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Prototype'>BufTableShmemSize</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>size</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN322"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>InitBufTable</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>size</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN323"></a><span class='Keyword'>extern </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Prototype'>BufTableHashCode</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN90"><span class='Ref_to_Typedef'>BufferTag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tagPtr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN324"></a><span class='Keyword'>extern int</span>  <span class='Declare_Prototype'>BufTableLookup</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN90"><span class='Ref_to_Typedef'>BufferTag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tagPtr</span><span class='Delimiter'>, </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashcode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN325"></a><span class='Keyword'>extern int</span>  <span class='Declare_Prototype'>BufTableInsert</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN90"><span class='Ref_to_Typedef'>BufferTag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tagPtr</span><span class='Delimiter'>, </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashcode</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>buf_id</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN326"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>BufTableDelete</span><span class='Parentheses'>(</span><a href="buf_internals.h.html#LN90"><span class='Ref_to_Typedef'>BufferTag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tagPtr</span><span class='Delimiter'>, </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashcode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* localbuf.c */ 
</span><a name="LN329"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>LocalPrefetchBuffer</span><span class='Parentheses'>(</span><a href="smgr.h.html#LN77"><span class='Ref_to_Typedef'>SMgrRelation</span></a> <span class='Declare_Parameter'>smgr</span><span class='Delimiter'>, </span><a href="../common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a> <span class='Declare_Parameter'>forkNum</span><span class='Delimiter'>, 
</span><a name="LN330"></a>                    <a href="block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>blockNum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN331"></a><span class='Keyword'>extern </span><a href="buf_internals.h.html#LN177"><span class='Ref_to_Struct'>BufferDesc</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>LocalBufferAlloc</span><span class='Parentheses'>(</span><a href="smgr.h.html#LN77"><span class='Ref_to_Typedef'>SMgrRelation</span></a> <span class='Declare_Parameter'>smgr</span><span class='Delimiter'>, </span><a href="../common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a> <span class='Declare_Parameter'>forkNum</span><span class='Delimiter'>, 
</span><a name="LN332"></a>                 <a href="block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>blockNum</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>foundPtr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN333"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>MarkLocalBufferDirty</span><span class='Parentheses'>(</span><a href="buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN334"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>DropRelFileNodeLocalBuffers</span><span class='Parentheses'>(</span><a href="relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Parameter'>rnode</span><span class='Delimiter'>, </span><a href="../common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a> <span class='Declare_Parameter'>forkNum</span><span class='Delimiter'>, 
</span><a name="LN335"></a>                            <a href="block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>firstDelBlock</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN336"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>DropRelFileNodeAllLocalBuffers</span><span class='Parentheses'>(</span><a href="relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Parameter'>rnode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN337"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>AtEOXact_LocalBuffers</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* BUFMGR_INTERNALS_H */ 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>