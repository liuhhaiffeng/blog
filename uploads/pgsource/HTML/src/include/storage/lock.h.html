<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\include\storage\lock.h</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\include\storage\lock.h</b></p></td>
<td align='right'>
Wed Jun 14 08:26:08 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * lock.h 
 *    POSTGRES low-level lock mechanism 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * src/include/storage/lock.h 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Directive'>#ifndef</span> <a href="lock.h.html#LN14"><span class='Ref_to_Const'>LOCK_H_</span></a> 
<a name="LN14"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LOCK_H_</span> 
 
<span class='Directive'>#ifdef</span> <a href="../../bin/pg_waldump/rmgrdesc.c.html#LN7"><span class='Ref_to_Const'>FRONTEND</span></a> 
#error <span class='String'>"lock.h may not be included from frontend code"</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"storage/lockdefs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/backendid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lwlock.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/shmem.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* struct PGPROC is declared in proc.h, but must forward-reference it */ 
</span><a name="LN27"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <a href="proc.h.html#LN93"><span class='Ref_to_Struct'>PGPROC</span></a> <span class='Declare_Typedef'>PGPROC</span><span class='Delimiter'>; 
</span> 
<a name="LN29"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PROC_QUEUE</span> 
<span class='Delimiter'>{ 
</span><a name="LN31"></a>    <a href="shmem.h.html#LN27"><span class='Ref_to_Struct'>SHM_QUEUE</span></a>   <span class='Declare_Member'>links</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* head of list of PGPROC objects */ 
</span><a name="LN32"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>size</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* number of entries in list */ 
</span><a name="LN33"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PROC_QUEUE</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* GUC variables */ 
</span><a name="LN36"></a><span class='Keyword'>extern int</span>  <span class='Declare_Var'>max_locks_per_xact</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> LOCK_DEBUG 
<a name="LN39"></a><span class='Keyword'>extern int</span>  <span class='Declare_Var'>Trace_lock_oidmin</span><span class='Delimiter'>; 
</span><a name="LN40"></a><span class='Keyword'>extern bool </span><span class='Declare_Var'>Trace_locks</span><span class='Delimiter'>; 
</span><a name="LN41"></a><span class='Keyword'>extern bool </span><span class='Declare_Var'>Trace_userlocks</span><span class='Delimiter'>; 
</span><a name="LN42"></a><span class='Keyword'>extern int</span>  <span class='Declare_Var'>Trace_lock_table</span><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Keyword'>extern bool </span><span class='Declare_Var'>Debug_deadlocks</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* LOCK_DEBUG */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Top-level transactions are identified by VirtualTransactionIDs comprising 
 * the BackendId of the backend running the xact, plus a locally-assigned 
 * LocalTransactionId.  These are guaranteed unique over the short term, 
 * but will be reused after a database restart; hence they should never 
 * be stored on disk. 
 * 
 * Note that struct VirtualTransactionId can not be assumed to be atomically 
 * assignable as a whole.  However, type LocalTransactionId is assumed to 
 * be atomically assignable, and the backend ID doesn't change often enough 
 * to be a problem, so we can fetch or assign the two fields separately. 
 * We deliberately refrain from using the struct within PGPROC, to prevent 
 * coding errors from trying to use struct assignment with it; instead use 
 * GET_VXID_FROM_PGPROC(). 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN64"></a>    <a href="backendid.h.html#LN20"><span class='Ref_to_Typedef'>BackendId</span></a>   <span class='Declare_Member'>backendId</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* determined at backend startup */ 
</span><a name="LN65"></a>    <a href="../c.h.html#LN398"><span class='Ref_to_Typedef'>LocalTransactionId</span></a> <span class='Declare_Member'>localTransactionId</span><span class='Delimiter'>;</span>      <span class='Comment_Multi_Line'>/* backend-local transaction 
                                                 * id */ 
</span><a name="LN67"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>VirtualTransactionId</span><span class='Delimiter'>; 
</span> 
<a name="LN69"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>InvalidLocalTransactionId</span>       <span class='Number'>0</span> 
<a name="LN70"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>LocalTransactionIdIsValid</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>lxid</span><span class='Parentheses'>) ((</span><a href="lock.h.html#LN70"><span class='Ref_to_Parameter'>lxid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="lock.h.html#LN69"><span class='Ref_to_Const'>InvalidLocalTransactionId</span></a><span class='Parentheses'>)</span> 
<a name="LN71"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>VirtualTransactionIdIsValid</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>vxid</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><a href="lock.h.html#LN71"><span class='Ref_to_Parameter'>vxid</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>backendId <span class='Operator'>!= </span><a href="backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& \ 
</span>     <a href="lock.h.html#LN70"><span class='Ref_to_Macro'>LocalTransactionIdIsValid</span></a><span class='Parentheses'>((</span><a href="lock.h.html#LN71"><span class='Ref_to_Parameter'>vxid</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>localTransactionId<span class='Parentheses'>))</span> 
<a name="LN74"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>VirtualTransactionIdEquals</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>vxid1</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>vxid2</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN74"><span class='Ref_to_Parameter'>vxid1</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>backendId <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="lock.h.html#LN74"><span class='Ref_to_Parameter'>vxid2</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>backendId <span class='Operator'>&& \ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN74"><span class='Ref_to_Parameter'>vxid1</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>localTransactionId <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="lock.h.html#LN74"><span class='Ref_to_Parameter'>vxid2</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>localTransactionId<span class='Parentheses'>)</span> 
<a name="LN77"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SetInvalidVirtualTransactionId</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>vxid</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN77"><span class='Ref_to_Parameter'>vxid</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>backendId <span class='Operator'>= </span><a href="backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN77"><span class='Ref_to_Parameter'>vxid</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>localTransactionId <span class='Operator'>= </span><a href="lock.h.html#LN69"><span class='Ref_to_Const'>InvalidLocalTransactionId</span></a><span class='Parentheses'>)</span> 
<a name="LN80"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>GET_VXID_FROM_PGPROC</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>vxid</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>proc</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN80"><span class='Ref_to_Parameter'>vxid</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>backendId <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN80"><span class='Ref_to_Parameter'>proc</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>backendId<span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN80"><span class='Ref_to_Parameter'>vxid</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>localTransactionId <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN80"><span class='Ref_to_Parameter'>proc</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>lxid<span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* MAX_LOCKMODES cannot be larger than the # of bits in LOCKMASK */ 
</span><a name="LN85"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_LOCKMODES</span>       <span class='Number'>10</span> 
 
<a name="LN87"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>LOCKBIT_ON</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) (</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><a href="lock.h.html#LN87"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>))</span> 
<a name="LN88"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>LOCKBIT_OFF</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) (</span><span class='Operator'>~</span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><a href="lock.h.html#LN88"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)))</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * This data structure defines the locking semantics associated with a 
 * "lock method".  The semantics specify the meaning of each lock mode 
 * (by defining which lock modes it conflicts with). 
 * All of this data is constant and is kept in const tables. 
 * 
 * numLockModes -- number of lock modes (READ,WRITE,etc) that 
 *      are defined in this lock method.  Must be less than MAX_LOCKMODES. 
 * 
 * conflictTab -- this is an array of bitmasks showing lock 
 *      mode conflicts.  conflictTab[i] is a mask with the j-th bit 
 *      turned on if lock modes i and j conflict.  Lock modes are 
 *      numbered 1..numLockModes; conflictTab[0] is unused. 
 * 
 * lockModeNames -- ID strings for debug printouts. 
 * 
 * trace_flag -- pointer to GUC trace flag for this lock method.  (The 
 * GUC variable is not constant, but we use "const" here to denote that 
 * it can't be changed through this reference.) 
 */ 
</span><a name="LN111"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>LockMethodData</span> 
<span class='Delimiter'>{ 
</span><a name="LN113"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>numLockModes</span><span class='Delimiter'>; 
</span><a name="LN114"></a>    <span class='Keyword'>const </span><a href="lockdefs.h.html#LN24"><span class='Ref_to_Typedef'>LOCKMASK</span></a> <span class='Operator'>*</span><span class='Declare_Member'>conflictTab</span><span class='Delimiter'>; 
</span><a name="LN115"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Member'>lockModeNames</span><span class='Delimiter'>; 
</span><a name="LN116"></a>    <span class='Keyword'>const bool </span><span class='Operator'>*</span><span class='Declare_Member'>trace_flag</span><span class='Delimiter'>; 
</span><a name="LN117"></a>} <span class='Declare_Typedef'>LockMethodData</span><span class='Delimiter'>; 
</span> 
<a name="LN119"></a><span class='Control'>typedef</span> <span class='Keyword'>const </span><a href="lock.h.html#LN111"><span class='Ref_to_Struct'>LockMethodData</span></a> <span class='Operator'>*</span><span class='Declare_Typedef'>LockMethod</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Lock methods are identified by LOCKMETHODID.  (Despite the declaration as 
 * uint16, we are constrained to 256 lockmethods by the layout of LOCKTAG.) 
 */ 
</span><a name="LN125"></a><span class='Control'>typedef</span> <a href="../c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Typedef'>LOCKMETHODID</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* These identify the known lock methods */ 
</span><a name="LN128"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEFAULT_LOCKMETHOD</span>  <span class='Number'>1</span> 
<a name="LN129"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>USER_LOCKMETHOD</span>     <span class='Number'>2</span> 
 
<span class='Comment_Multi_Line'>/* 
 * LOCKTAG is the key information needed to look up a LOCK item in the 
 * lock hashtable.  A LOCKTAG value uniquely identifies a lockable object. 
 * 
 * The LockTagType enum defines the different kinds of objects we can lock. 
 * We can handle up to 256 different LockTagTypes. 
 */ 
</span><a name="LN138"></a><span class='Control'>typedef</span> <span class='Control'>enum</span> <span class='Declare_Enum'>LockTagType</span> 
<span class='Delimiter'>{ 
</span><a name="LN140"></a>    <span class='Declare_Enum_Const'>LOCKTAG_RELATION</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* whole relation */ 
</span>    <span class='Comment_Multi_Line'>/* ID info for a relation is DB OID + REL OID; DB OID = 0 if shared */ 
</span><a name="LN142"></a>    <span class='Declare_Enum_Const'>LOCKTAG_RELATION_EXTEND</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* the right to extend a relation */ 
</span>    <span class='Comment_Multi_Line'>/* same ID info as RELATION */ 
</span><a name="LN144"></a>    <span class='Declare_Enum_Const'>LOCKTAG_PAGE</span><span class='Delimiter'>,</span>               <span class='Comment_Single_Line'>/* one page of a relation */ 
</span>    <span class='Comment_Multi_Line'>/* ID info for a page is RELATION info + BlockNumber */ 
</span><a name="LN146"></a>    <span class='Declare_Enum_Const'>LOCKTAG_TUPLE</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* one physical tuple */ 
</span>    <span class='Comment_Multi_Line'>/* ID info for a tuple is PAGE info + OffsetNumber */ 
</span><a name="LN148"></a>    <span class='Declare_Enum_Const'>LOCKTAG_TRANSACTION</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* transaction (for waiting for xact done) */ 
</span>    <span class='Comment_Multi_Line'>/* ID info for a transaction is its TransactionId */ 
</span><a name="LN150"></a>    <span class='Declare_Enum_Const'>LOCKTAG_VIRTUALTRANSACTION</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* virtual transaction (ditto) */ 
</span>    <span class='Comment_Multi_Line'>/* ID info for a virtual transaction is its VirtualTransactionId */ 
</span><a name="LN152"></a>    <span class='Declare_Enum_Const'>LOCKTAG_SPECULATIVE_TOKEN</span><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* speculative insertion Xid and token */ 
</span>    <span class='Comment_Multi_Line'>/* ID info for a transaction is its TransactionId */ 
</span><a name="LN154"></a>    <span class='Declare_Enum_Const'>LOCKTAG_OBJECT</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* non-relation database object */ 
</span>    <span class='Comment_Multi_Line'>/* ID info for an object is DB OID + CLASS OID + OBJECT OID + SUBID */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: object ID has same representation as in pg_depend and 
     * pg_description, but notice that we are constraining SUBID to 16 bits. 
     * Also, we use DB OID = 0 for shared objects such as tablespaces. 
     */ 
</span><a name="LN162"></a>    <span class='Declare_Enum_Const'>LOCKTAG_USERLOCK</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* reserved for old contrib/userlock code */ 
</span><a name="LN163"></a>    <span class='Declare_Enum_Const'>LOCKTAG_ADVISORY</span>            <span class='Comment_Single_Line'>/* advisory user locks */ 
</span><a name="LN164"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end LockTagType &raquo; </span> <span class='Declare_Typedef'>LockTagType</span><span class='Delimiter'>; 
</span> 
<a name="LN166"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LOCKTAG_LAST_TYPE</span>   <a href="lock.h.html#LN163"><span class='Ref_to_EnumConst'>LOCKTAG_ADVISORY</span></a> 
 
<a name="LN168"></a><span class='Keyword'>extern const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>LockTagTypeNames</span><span class='Delimiter'>[]; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The LOCKTAG struct is defined with malice aforethought to fit into 16 
 * bytes with no padding.  Note that this would need adjustment if we were 
 * to widen Oid, BlockNumber, or TransactionId to more than 32 bits. 
 * 
 * We include lockmethodid in the locktag so that a single hash table in 
 * shared memory can store locks of different lockmethods. 
 */ 
</span><a name="LN178"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>LOCKTAG</span> 
<span class='Delimiter'>{ 
</span><a name="LN180"></a>    <a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>locktag_field1</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* a 32-bit ID field */ 
</span><a name="LN181"></a>    <a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>locktag_field2</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* a 32-bit ID field */ 
</span><a name="LN182"></a>    <a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>locktag_field3</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* a 32-bit ID field */ 
</span><a name="LN183"></a>    <a href="../c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Member'>locktag_field4</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* a 16-bit ID field */ 
</span><a name="LN184"></a>    <a href="../c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Member'>locktag_type</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* see enum LockTagType */ 
</span><a name="LN185"></a>    <a href="../c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Member'>locktag_lockmethodid</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* lockmethod indicator */ 
</span><a name="LN186"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>LOCKTAG</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * These macros define how we map logical IDs of lockable objects into 
 * the physical fields of LOCKTAG.  Use these to set up LOCKTAG values, 
 * rather than accessing the fields directly.  Note multiple eval of target! 
 */ 
</span><a name="LN193"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SET_LOCKTAG_RELATION</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>dboid</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>reloid</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN193"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field1 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN193"><span class='Ref_to_Parameter'>dboid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN193"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field2 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN193"><span class='Ref_to_Parameter'>reloid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN193"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field3 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN193"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field4 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN193"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_type <span class='Operator'>= </span><a href="lock.h.html#LN140"><span class='Ref_to_EnumConst'>LOCKTAG_RELATION</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN193"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_lockmethodid <span class='Operator'>= </span><a href="lock.h.html#LN128"><span class='Ref_to_Const'>DEFAULT_LOCKMETHOD</span></a><span class='Parentheses'>)</span> 
 
<a name="LN201"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SET_LOCKTAG_RELATION_EXTEND</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>dboid</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>reloid</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN201"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field1 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN201"><span class='Ref_to_Parameter'>dboid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN201"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field2 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN201"><span class='Ref_to_Parameter'>reloid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN201"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field3 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN201"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field4 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN201"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_type <span class='Operator'>= </span><a href="lock.h.html#LN142"><span class='Ref_to_EnumConst'>LOCKTAG_RELATION_EXTEND</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN201"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_lockmethodid <span class='Operator'>= </span><a href="lock.h.html#LN128"><span class='Ref_to_Const'>DEFAULT_LOCKMETHOD</span></a><span class='Parentheses'>)</span> 
 
<a name="LN209"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SET_LOCKTAG_PAGE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>dboid</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>reloid</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>blocknum</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN209"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field1 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN209"><span class='Ref_to_Parameter'>dboid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN209"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field2 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN209"><span class='Ref_to_Parameter'>reloid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN209"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field3 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN209"><span class='Ref_to_Parameter'>blocknum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN209"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field4 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN209"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_type <span class='Operator'>= </span><a href="lock.h.html#LN144"><span class='Ref_to_EnumConst'>LOCKTAG_PAGE</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN209"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_lockmethodid <span class='Operator'>= </span><a href="lock.h.html#LN128"><span class='Ref_to_Const'>DEFAULT_LOCKMETHOD</span></a><span class='Parentheses'>)</span> 
 
<a name="LN217"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SET_LOCKTAG_TUPLE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>dboid</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>reloid</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>blocknum</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>offnum</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN217"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field1 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN217"><span class='Ref_to_Parameter'>dboid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN217"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field2 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN217"><span class='Ref_to_Parameter'>reloid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN217"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field3 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN217"><span class='Ref_to_Parameter'>blocknum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN217"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field4 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN217"><span class='Ref_to_Parameter'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN217"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_type <span class='Operator'>= </span><a href="lock.h.html#LN146"><span class='Ref_to_EnumConst'>LOCKTAG_TUPLE</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN217"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_lockmethodid <span class='Operator'>= </span><a href="lock.h.html#LN128"><span class='Ref_to_Const'>DEFAULT_LOCKMETHOD</span></a><span class='Parentheses'>)</span> 
 
<a name="LN225"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SET_LOCKTAG_TRANSACTION</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>xid</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN225"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field1 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN225"><span class='Ref_to_Parameter'>xid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN225"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field2 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN225"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field3 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN225"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field4 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN225"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_type <span class='Operator'>= </span><a href="lock.h.html#LN148"><span class='Ref_to_EnumConst'>LOCKTAG_TRANSACTION</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN225"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_lockmethodid <span class='Operator'>= </span><a href="lock.h.html#LN128"><span class='Ref_to_Const'>DEFAULT_LOCKMETHOD</span></a><span class='Parentheses'>)</span> 
 
<a name="LN233"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SET_LOCKTAG_VIRTUALTRANSACTION</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>vxid</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN233"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field1 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN233"><span class='Ref_to_Parameter'>vxid</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>backendId<span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN233"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field2 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN233"><span class='Ref_to_Parameter'>vxid</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>localTransactionId<span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN233"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field3 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN233"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field4 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN233"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_type <span class='Operator'>= </span><a href="lock.h.html#LN150"><span class='Ref_to_EnumConst'>LOCKTAG_VIRTUALTRANSACTION</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN233"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_lockmethodid <span class='Operator'>= </span><a href="lock.h.html#LN128"><span class='Ref_to_Const'>DEFAULT_LOCKMETHOD</span></a><span class='Parentheses'>)</span> 
 
<a name="LN241"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SET_LOCKTAG_SPECULATIVE_INSERTION</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>xid</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>token</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN241"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field1 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN241"><span class='Ref_to_Parameter'>xid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN241"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field2 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN241"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>,</span>        <span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN241"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field3 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN241"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field4 <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN241"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_type <span class='Operator'>= </span><a href="lock.h.html#LN152"><span class='Ref_to_EnumConst'>LOCKTAG_SPECULATIVE_TOKEN</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN241"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_lockmethodid <span class='Operator'>= </span><a href="lock.h.html#LN128"><span class='Ref_to_Const'>DEFAULT_LOCKMETHOD</span></a><span class='Parentheses'>)</span> 
 
<a name="LN249"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SET_LOCKTAG_OBJECT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>dboid</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>classoid</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>objoid</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>objsubid</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN249"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field1 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN249"><span class='Ref_to_Parameter'>dboid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN249"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field2 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN249"><span class='Ref_to_Parameter'>classoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN249"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field3 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN249"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN249"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field4 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN249"><span class='Ref_to_Parameter'>objsubid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN249"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_type <span class='Operator'>= </span><a href="lock.h.html#LN154"><span class='Ref_to_EnumConst'>LOCKTAG_OBJECT</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN249"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_lockmethodid <span class='Operator'>= </span><a href="lock.h.html#LN128"><span class='Ref_to_Const'>DEFAULT_LOCKMETHOD</span></a><span class='Parentheses'>)</span> 
 
<a name="LN257"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SET_LOCKTAG_ADVISORY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>id1</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>id2</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>id3</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>id4</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN257"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field1 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN257"><span class='Ref_to_Parameter'>id1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN257"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field2 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN257"><span class='Ref_to_Parameter'>id2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN257"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field3 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN257"><span class='Ref_to_Parameter'>id3</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN257"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_field4 <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="lock.h.html#LN257"><span class='Ref_to_Parameter'>id4</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN257"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_type <span class='Operator'>= </span><a href="lock.h.html#LN163"><span class='Ref_to_EnumConst'>LOCKTAG_ADVISORY</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>     <span class='Parentheses'>(</span><a href="lock.h.html#LN257"><span class='Ref_to_Parameter'>locktag</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>locktag_lockmethodid <span class='Operator'>= </span><a href="lock.h.html#LN129"><span class='Ref_to_Const'>USER_LOCKMETHOD</span></a><span class='Parentheses'>)</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Per-locked-object lock information: 
 * 
 * tag -- uniquely identifies the object being locked 
 * grantMask -- bitmask for all lock types currently granted on this object. 
 * waitMask -- bitmask for all lock types currently awaited on this object. 
 * procLocks -- list of PROCLOCK objects for this lock. 
 * waitProcs -- queue of processes waiting for this lock. 
 * requested -- count of each lock type currently requested on the lock 
 *      (includes requests already granted!!). 
 * nRequested -- total requested locks of all types. 
 * granted -- count of each lock type currently granted on the lock. 
 * nGranted -- total granted locks of all types. 
 * 
 * Note: these counts count 1 for each backend.  Internally to a backend, 
 * there may be multiple grabs on a particular lock, but this is not reflected 
 * into shared memory. 
 */ 
</span><a name="LN284"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>LOCK</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* hash key */ 
</span><a name="LN287"></a>    <a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a>     <span class='Declare_Member'>tag</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* unique identifier of lockable object */ 
</span> 
    <span class='Comment_Multi_Line'>/* data */ 
</span><a name="LN290"></a>    <a href="lockdefs.h.html#LN24"><span class='Ref_to_Typedef'>LOCKMASK</span></a>    <span class='Declare_Member'>grantMask</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* bitmask for lock types already granted */ 
</span><a name="LN291"></a>    <a href="lockdefs.h.html#LN24"><span class='Ref_to_Typedef'>LOCKMASK</span></a>    <span class='Declare_Member'>waitMask</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* bitmask for lock types awaited */ 
</span><a name="LN292"></a>    <a href="shmem.h.html#LN27"><span class='Ref_to_Struct'>SHM_QUEUE</span></a>   <span class='Declare_Member'>procLocks</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* list of PROCLOCK objects assoc. with lock */ 
</span><a name="LN293"></a>    <a href="lock.h.html#LN29"><span class='Ref_to_Struct'>PROC_QUEUE</span></a>  <span class='Declare_Member'>waitProcs</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* list of PGPROC objects waiting on lock */ 
</span><a name="LN294"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>requested</span><span class='Delimiter'>[</span><a href="lock.h.html#LN85"><span class='Ref_to_Const'>MAX_LOCKMODES</span></a><span class='Delimiter'>];</span>       <span class='Comment_Single_Line'>/* counts of requested locks */ 
</span><a name="LN295"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nRequested</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* total of requested[] array */ 
</span><a name="LN296"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>granted</span><span class='Delimiter'>[</span><a href="lock.h.html#LN85"><span class='Ref_to_Const'>MAX_LOCKMODES</span></a><span class='Delimiter'>]; </span><span class='Comment_Single_Line'>/* counts of granted locks */ 
</span><a name="LN297"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nGranted</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* total of granted[] array */ 
</span><a name="LN298"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>LOCK</span><span class='Delimiter'>; 
</span> 
<a name="LN300"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>LOCK_LOCKMETHOD</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>lock</span><span class='Parentheses'>) ((</span><a href="lock.h.html#LN125"><span class='Ref_to_Typedef'>LOCKMETHODID</span></a><span class='Parentheses'>) (</span><a href="lock.h.html#LN300"><span class='Ref_to_Parameter'>lock</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tag<span class='Operator'>.</span>locktag_lockmethodid<span class='Parentheses'>)</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * We may have several different backends holding or awaiting locks 
 * on the same lockable object.  We need to store some per-holder/waiter 
 * information for each such holder (or would-be holder).  This is kept in 
 * a PROCLOCK struct. 
 * 
 * PROCLOCKTAG is the key information needed to look up a PROCLOCK item in the 
 * proclock hashtable.  A PROCLOCKTAG value uniquely identifies the combination 
 * of a lockable object and a holder/waiter for that object.  (We can use 
 * pointers here because the PROCLOCKTAG need only be unique for the lifespan 
 * of the PROCLOCK, and it will never outlive the lock or the proc.) 
 * 
 * Internally to a backend, it is possible for the same lock to be held 
 * for different purposes: the backend tracks transaction locks separately 
 * from session locks.  However, this is not reflected in the shared-memory 
 * state: we only track which backend(s) hold the lock.  This is OK since a 
 * backend can never block itself. 
 * 
 * The holdMask field shows the already-granted locks represented by this 
 * proclock.  Note that there will be a proclock object, possibly with 
 * zero holdMask, for any lock that the process is currently waiting on. 
 * Otherwise, proclock objects whose holdMasks are zero are recycled 
 * as soon as convenient. 
 * 
 * releaseMask is workspace for LockReleaseAll(): it shows the locks due 
 * to be released during the current call.  This must only be examined or 
 * set by the backend owning the PROCLOCK. 
 * 
 * Each PROCLOCK object is linked into lists for both the associated LOCK 
 * object and the owning PGPROC object.  Note that the PROCLOCK is entered 
 * into these lists as soon as it is created, even if no lock has yet been 
 * granted.  A PGPROC that is waiting for a lock to be granted will also be 
 * linked into the lock's waitProcs queue. 
 */ 
</span><a name="LN337"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PROCLOCKTAG</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* NB: we assume this struct contains no padding! */ 
</span><a name="LN340"></a>    <a href="lock.h.html#LN284"><span class='Ref_to_Struct'>LOCK</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>myLock</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* link to per-lockable-object information */ 
</span><a name="LN341"></a>    <a href="proc.h.html#LN93"><span class='Ref_to_Struct'>PGPROC</span></a>     <span class='Operator'>*</span><span class='Declare_Member'>myProc</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* link to PGPROC of owning backend */ 
</span><a name="LN342"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PROCLOCKTAG</span><span class='Delimiter'>; 
</span> 
<a name="LN344"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PROCLOCK</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* tag */ 
</span><a name="LN347"></a>    <a href="lock.h.html#LN337"><span class='Ref_to_Struct'>PROCLOCKTAG</span></a> <span class='Declare_Member'>tag</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* unique identifier of proclock object */ 
</span> 
    <span class='Comment_Multi_Line'>/* data */ 
</span><a name="LN350"></a>    <a href="proc.h.html#LN93"><span class='Ref_to_Struct'>PGPROC</span></a>     <span class='Operator'>*</span><span class='Declare_Member'>groupLeader</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* proc's lock group leader, or proc itself */ 
</span><a name="LN351"></a>    <a href="lockdefs.h.html#LN24"><span class='Ref_to_Typedef'>LOCKMASK</span></a>    <span class='Declare_Member'>holdMask</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* bitmask for lock types currently held */ 
</span><a name="LN352"></a>    <a href="lockdefs.h.html#LN24"><span class='Ref_to_Typedef'>LOCKMASK</span></a>    <span class='Declare_Member'>releaseMask</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* bitmask for lock types to be released */ 
</span><a name="LN353"></a>    <a href="shmem.h.html#LN27"><span class='Ref_to_Struct'>SHM_QUEUE</span></a>   <span class='Declare_Member'>lockLink</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* list link in LOCK's list of proclocks */ 
</span><a name="LN354"></a>    <a href="shmem.h.html#LN27"><span class='Ref_to_Struct'>SHM_QUEUE</span></a>   <span class='Declare_Member'>procLink</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* list link in PGPROC's list of proclocks */ 
</span><a name="LN355"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PROCLOCK</span><span class='Delimiter'>; 
</span> 
<a name="LN357"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PROCLOCK_LOCKMETHOD</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>proclock</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="lock.h.html#LN300"><span class='Ref_to_Macro'>LOCK_LOCKMETHOD</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>((</span><a href="lock.h.html#LN357"><span class='Ref_to_Parameter'>proclock</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tag<span class='Operator'>.</span>myLock<span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Each backend also maintains a local hash table with information about each 
 * lock it is currently interested in.  In particular the local table counts 
 * the number of times that lock has been acquired.  This allows multiple 
 * requests for the same lock to be executed without additional accesses to 
 * shared memory.  We also track the number of lock acquisitions per 
 * ResourceOwner, so that we can release just those locks belonging to a 
 * particular ResourceOwner. 
 * 
 * When holding a lock taken "normally", the lock and proclock fields always 
 * point to the associated objects in shared memory.  However, if we acquired 
 * the lock via the fast-path mechanism, the lock and proclock fields are set 
 * to NULL, since there probably aren't any such objects in shared memory. 
 * (If the lock later gets promoted to normal representation, we may eventually 
 * update our locallock's lock/proclock fields after finding the shared 
 * objects.) 
 * 
 * Caution: a locallock object can be left over from a failed lock acquisition 
 * attempt.  In this case its lock/proclock fields are untrustworthy, since 
 * the shared lock object is neither held nor awaited, and hence is available 
 * to be reclaimed.  If nLocks &GT; 0 then these pointers must either be valid or 
 * NULL, but when nLocks == 0 they should be considered garbage. 
 */ 
</span><a name="LN383"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>LOCALLOCKTAG</span> 
<span class='Delimiter'>{ 
</span><a name="LN385"></a>    <a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a>     <span class='Declare_Member'>lock</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* identifies the lockable object */ 
</span><a name="LN386"></a>    <a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a>    <span class='Declare_Member'>mode</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* lock mode for this table entry */ 
</span><a name="LN387"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>LOCALLOCKTAG</span><span class='Delimiter'>; 
</span> 
<a name="LN389"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>LOCALLOCKOWNER</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Note: if owner is NULL then the lock is held on behalf of the session; 
     * otherwise it is held on behalf of my current transaction. 
     * 
     * Must use a forward struct reference to avoid circularity. 
     */ 
</span><a name="LN397"></a>    <span class='Control'>struct</span> <a href="../../backend/utils/resowner/resowner.c.html#LN109"><span class='Ref_to_Struct'>ResourceOwnerData</span></a> <span class='Operator'>*</span><span class='Declare_Member'>owner</span><span class='Delimiter'>; 
</span><a name="LN398"></a>    <a href="../c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>nLocks</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* # of times held by this owner */ 
</span><a name="LN399"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>LOCALLOCKOWNER</span><span class='Delimiter'>; 
</span> 
<a name="LN401"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>LOCALLOCK</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* tag */ 
</span><a name="LN404"></a>    <a href="lock.h.html#LN383"><span class='Ref_to_Struct'>LOCALLOCKTAG</span></a> <span class='Declare_Member'>tag</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* unique identifier of locallock entry */ 
</span> 
    <span class='Comment_Multi_Line'>/* data */ 
</span><a name="LN407"></a>    <a href="lock.h.html#LN284"><span class='Ref_to_Struct'>LOCK</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>lock</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* associated LOCK object, if any */ 
</span><a name="LN408"></a>    <a href="lock.h.html#LN344"><span class='Ref_to_Struct'>PROCLOCK</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>proclock</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* associated PROCLOCK object, if any */ 
</span><a name="LN409"></a>    <a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>hashcode</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* copy of LOCKTAG's hash value */ 
</span><a name="LN410"></a>    <a href="../c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>nLocks</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* total number of times lock is held */ 
</span><a name="LN411"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>numLockOwners</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* # of relevant ResourceOwners */ 
</span><a name="LN412"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>maxLockOwners</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* allocated size of array */ 
</span><a name="LN413"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>holdsStrongLockCount</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* bumped FastPathStrongRelationLocks */ 
</span><a name="LN414"></a>    <a href="lock.h.html#LN389"><span class='Ref_to_Struct'>LOCALLOCKOWNER</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lockOwners</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* dynamically resizable array */ 
</span><a name="LN415"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>LOCALLOCK</span><span class='Delimiter'>; 
</span> 
<a name="LN417"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>LOCALLOCK_LOCKMETHOD</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>llock</span><span class='Parentheses'>) ((</span><a href="lock.h.html#LN417"><span class='Ref_to_Parameter'>llock</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>tag<span class='Operator'>.</span>lock<span class='Operator'>.</span>locktag_lockmethodid<span class='Parentheses'>)</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * These structures hold information passed from lmgr internals to the lock 
 * listing user-level functions (in lockfuncs.c). 
 */ 
</span> 
<a name="LN425"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>LockInstanceData</span> 
<span class='Delimiter'>{ 
</span><a name="LN427"></a>    <a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a>     <span class='Declare_Member'>locktag</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* tag for locked object */ 
</span><a name="LN428"></a>    <a href="lockdefs.h.html#LN24"><span class='Ref_to_Typedef'>LOCKMASK</span></a>    <span class='Declare_Member'>holdMask</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* locks held by this PGPROC */ 
</span><a name="LN429"></a>    <a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a>    <span class='Declare_Member'>waitLockMode</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* lock awaited by this PGPROC, if any */ 
</span><a name="LN430"></a>    <a href="backendid.h.html#LN20"><span class='Ref_to_Typedef'>BackendId</span></a>   <span class='Declare_Member'>backend</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* backend ID of this PGPROC */ 
</span><a name="LN431"></a>    <a href="../c.h.html#LN398"><span class='Ref_to_Typedef'>LocalTransactionId</span></a> <span class='Declare_Member'>lxid</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* local transaction ID of this PGPROC */ 
</span><a name="LN432"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>pid</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* pid of this PGPROC */ 
</span><a name="LN433"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>leaderPid</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* pid of group leader; = pid if no group */ 
</span><a name="LN434"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>fastpath</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* taken via fastpath? */ 
</span><a name="LN435"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>LockInstanceData</span><span class='Delimiter'>; 
</span> 
<a name="LN437"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>LockData</span> 
<span class='Delimiter'>{ 
</span><a name="LN439"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nelements</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* The length of the array */ 
</span><a name="LN440"></a>    <a href="lock.h.html#LN425"><span class='Ref_to_Struct'>LockInstanceData</span></a> <span class='Operator'>*</span><span class='Declare_Member'>locks</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Array of per-PROCLOCK information */ 
</span><a name="LN441"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>LockData</span><span class='Delimiter'>; 
</span> 
<a name="LN443"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>BlockedProcData</span> 
<span class='Delimiter'>{ 
</span><a name="LN445"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>pid</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* pid of a blocked PGPROC */ 
</span>    <span class='Comment_Multi_Line'>/* Per-PROCLOCK information about PROCLOCKs of the lock the pid awaits */ 
</span>    <span class='Comment_Multi_Line'>/* (these fields refer to indexes in BlockedProcsData.locks[]) */ 
</span><a name="LN448"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>first_lock</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* index of first relevant LockInstanceData */ 
</span><a name="LN449"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>num_locks</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* number of relevant LockInstanceDatas */ 
</span>    <span class='Comment_Multi_Line'>/* PIDs of PGPROCs that are ahead of "pid" in the lock's wait queue */ 
</span>    <span class='Comment_Multi_Line'>/* (these fields refer to indexes in BlockedProcsData.waiter_pids[]) */ 
</span><a name="LN452"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>first_waiter</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* index of first preceding waiter */ 
</span><a name="LN453"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>num_waiters</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* number of preceding waiters */ 
</span><a name="LN454"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>BlockedProcData</span><span class='Delimiter'>; 
</span> 
<a name="LN456"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>BlockedProcsData</span> 
<span class='Delimiter'>{ 
</span><a name="LN458"></a>    <a href="lock.h.html#LN443"><span class='Ref_to_Struct'>BlockedProcData</span></a> <span class='Operator'>*</span><span class='Declare_Member'>procs</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Array of per-blocked-proc information */ 
</span><a name="LN459"></a>    <a href="lock.h.html#LN425"><span class='Ref_to_Struct'>LockInstanceData</span></a> <span class='Operator'>*</span><span class='Declare_Member'>locks</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Array of per-PROCLOCK information */ 
</span><a name="LN460"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>waiter_pids</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Array of PIDs of other blocked PGPROCs */ 
</span><a name="LN461"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nprocs</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* # of valid entries in procs[] array */ 
</span><a name="LN462"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>maxprocs</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Allocated length of procs[] array */ 
</span><a name="LN463"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nlocks</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* # of valid entries in locks[] array */ 
</span><a name="LN464"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>maxlocks</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Allocated length of locks[] array */ 
</span><a name="LN465"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>npids</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* # of valid entries in waiter_pids[] array */ 
</span><a name="LN466"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>maxpids</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Allocated length of waiter_pids[] array */ 
</span><a name="LN467"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>BlockedProcsData</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* Result codes for LockAcquire() */ 
</span><span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN473"></a>    <span class='Declare_Enum_Const'>LOCKACQUIRE_NOT_AVAIL</span><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* lock not available, and dontWait=true */ 
</span><a name="LN474"></a>    <span class='Declare_Enum_Const'>LOCKACQUIRE_OK</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* lock successfully acquired */ 
</span><a name="LN475"></a>    <span class='Declare_Enum_Const'>LOCKACQUIRE_ALREADY_HELD</span>    <span class='Comment_Single_Line'>/* incremented count for lock already held */ 
</span><a name="LN476"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>LockAcquireResult</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Deadlock states identified by DeadLockCheck() */ 
</span><span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN481"></a>    <span class='Declare_Enum_Const'>DS_NOT_YET_CHECKED</span><span class='Delimiter'>,</span>         <span class='Comment_Single_Line'>/* no deadlock check has run yet */ 
</span><a name="LN482"></a>    <span class='Declare_Enum_Const'>DS_NO_DEADLOCK</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* no deadlock detected */ 
</span><a name="LN483"></a>    <span class='Declare_Enum_Const'>DS_SOFT_DEADLOCK</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* deadlock avoided by queue rearrangement */ 
</span><a name="LN484"></a>    <span class='Declare_Enum_Const'>DS_HARD_DEADLOCK</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* deadlock, no way out but ERROR */ 
</span><a name="LN485"></a>    <span class='Declare_Enum_Const'>DS_BLOCKED_BY_AUTOVACUUM</span>    <span class='Comment_Multi_Line'>/* no deadlock; queue blocked by autovacuum 
                                 * worker */ 
</span><a name="LN487"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>DeadLockState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The lockmgr's shared hash tables are partitioned to reduce contention. 
 * To determine which partition a given locktag belongs to, compute the tag's 
 * hash code with LockTagHashCode(), then apply one of these macros. 
 * NB: NUM_LOCK_PARTITIONS must be a power of 2! 
 */ 
</span><a name="LN495"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>LockHashPartition</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>hashcode</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="lock.h.html#LN495"><span class='Ref_to_Parameter'>hashcode</span></a><span class='Parentheses'>) </span><span class='Operator'>% </span><a href="lwlock.h.html#LN116"><span class='Ref_to_Const'>NUM_LOCK_PARTITIONS</span></a><span class='Parentheses'>)</span> 
<a name="LN497"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>LockHashPartitionLock</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>hashcode</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../backend/storage/lmgr/lwlock.c.html#LN124"><span class='Ref_to_Global_Var'>MainLWLockArray</span></a><span class='Delimiter'>[</span><a href="lwlock.h.html#LN124"><span class='Ref_to_Const'>LOCK_MANAGER_LWLOCK_OFFSET</span></a> <span class='Operator'>+ \ 
</span>        <a href="lock.h.html#LN495"><span class='Ref_to_Macro'>LockHashPartition</span></a><span class='Parentheses'>(</span><a href="lock.h.html#LN497"><span class='Ref_to_Parameter'>hashcode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Operator'>.</span>lock<span class='Parentheses'>)</span> 
<a name="LN500"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>LockHashPartitionLockByIndex</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>i</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>&</span><a href="../../backend/storage/lmgr/lwlock.c.html#LN124"><span class='Ref_to_Global_Var'>MainLWLockArray</span></a><span class='Delimiter'>[</span><a href="lwlock.h.html#LN124"><span class='Ref_to_Const'>LOCK_MANAGER_LWLOCK_OFFSET</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="lock.h.html#LN500"><span class='Ref_to_Parameter'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="lwlock.h.html#LN78"><span class='Ref_to_Member'>lock</span></a><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * The deadlock detector needs to be able to access lockGroupLeader and 
 * related fields in the PGPROC, so we arrange for those fields to be protected 
 * by one of the lock hash partition locks.  Since the deadlock detector 
 * acquires all such locks anyway, this makes it safe for it to access these 
 * fields without doing anything extra.  To avoid contention as much as 
 * possible, we map different PGPROCs to different partition locks.  The lock 
 * used for a given lock group is determined by the group leader's pgprocno. 
 */ 
</span><a name="LN512"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>LockHashPartitionLockByProc</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>leader_pgproc</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="lock.h.html#LN497"><span class='Ref_to_Macro'>LockHashPartitionLock</span></a><span class='Parentheses'>((</span><a href="lock.h.html#LN512"><span class='Ref_to_Parameter'>leader_pgproc</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>pgprocno<span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * function prototypes 
 */ 
</span><a name="LN518"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>InitLocks</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN519"></a><span class='Keyword'>extern </span><a href="lock.h.html#LN119"><span class='Ref_to_Typedef'>LockMethod</span></a> <span class='Declare_Prototype'>GetLocksMethodTable</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="lock.h.html#LN284"><span class='Ref_to_Struct'>LOCK</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lock</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN520"></a><span class='Keyword'>extern </span><a href="lock.h.html#LN119"><span class='Ref_to_Typedef'>LockMethod</span></a> <span class='Declare_Prototype'>GetLockTagsMethodTable</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>locktag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN521"></a><span class='Keyword'>extern </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Prototype'>LockTagHashCode</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>locktag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN522"></a><span class='Keyword'>extern bool </span><span class='Declare_Prototype'>DoLockModesConflict</span><span class='Parentheses'>(</span><a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>mode1</span><span class='Delimiter'>, </span><a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>mode2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN523"></a><span class='Keyword'>extern </span><a href="lock.h.html#LN471"><span class='Ref_to_Typedef'>LockAcquireResult</span></a> <span class='Declare_Prototype'>LockAcquire</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>, 
</span><a name="LN524"></a>            <a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, 
</span><a name="LN525"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>sessionLock</span><span class='Delimiter'>, 
</span><a name="LN526"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>dontWait</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN527"></a><span class='Keyword'>extern </span><a href="lock.h.html#LN471"><span class='Ref_to_Typedef'>LockAcquireResult</span></a> <span class='Declare_Prototype'>LockAcquireExtended</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>, 
</span><a name="LN528"></a>                    <a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, 
</span><a name="LN529"></a>                    <span class='Keyword'>bool </span><span class='Declare_Parameter'>sessionLock</span><span class='Delimiter'>, 
</span><a name="LN530"></a>                    <span class='Keyword'>bool </span><span class='Declare_Parameter'>dontWait</span><span class='Delimiter'>, 
</span><a name="LN531"></a>                    <span class='Keyword'>bool </span><span class='Declare_Parameter'>report_memory_error</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN532"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>AbortStrongLockAcquire</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN533"></a><span class='Keyword'>extern bool </span><span class='Declare_Prototype'>LockRelease</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>, 
</span><a name="LN534"></a>            <a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>sessionLock</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN535"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>LockReleaseAll</span><span class='Parentheses'>(</span><a href="lock.h.html#LN125"><span class='Ref_to_Typedef'>LOCKMETHODID</span></a> <span class='Declare_Parameter'>lockmethodid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>allLocks</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN536"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>LockReleaseSession</span><span class='Parentheses'>(</span><a href="lock.h.html#LN125"><span class='Ref_to_Typedef'>LOCKMETHODID</span></a> <span class='Declare_Parameter'>lockmethodid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN537"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>LockReleaseCurrentOwner</span><span class='Parentheses'>(</span><a href="lock.h.html#LN401"><span class='Ref_to_Struct'>LOCALLOCK</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>locallocks</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nlocks</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN538"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>LockReassignCurrentOwner</span><span class='Parentheses'>(</span><a href="lock.h.html#LN401"><span class='Ref_to_Struct'>LOCALLOCK</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>locallocks</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nlocks</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN539"></a><span class='Keyword'>extern bool </span><span class='Declare_Prototype'>LockHasWaiters</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>, 
</span><a name="LN540"></a>               <a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>sessionLock</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN541"></a><span class='Keyword'>extern </span><a href="lock.h.html#LN62"><span class='Ref_to_Typedef'>VirtualTransactionId</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>GetLockConflicts</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>locktag</span><span class='Delimiter'>, 
</span><a name="LN542"></a>                 <a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN543"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>AtPrepare_Locks</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN544"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>PostPrepare_Locks</span><span class='Parentheses'>(</span><a href="../c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN545"></a><span class='Keyword'>extern int </span><span class='Declare_Prototype'>LockCheckConflicts</span><span class='Parentheses'>(</span><a href="lock.h.html#LN119"><span class='Ref_to_Typedef'>LockMethod</span></a> <span class='Declare_Parameter'>lockMethodTable</span><span class='Delimiter'>, 
</span><a name="LN546"></a>                   <a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, 
</span><a name="LN547"></a>                   <a href="lock.h.html#LN284"><span class='Ref_to_Struct'>LOCK</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lock</span><span class='Delimiter'>, </span><a href="lock.h.html#LN344"><span class='Ref_to_Struct'>PROCLOCK</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>proclock</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN548"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>GrantLock</span><span class='Parentheses'>(</span><a href="lock.h.html#LN284"><span class='Ref_to_Struct'>LOCK</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lock</span><span class='Delimiter'>, </span><a href="lock.h.html#LN344"><span class='Ref_to_Struct'>PROCLOCK</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>proclock</span><span class='Delimiter'>, </span><a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN549"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>GrantAwaitedLock</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN550"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>RemoveFromWaitQueue</span><span class='Parentheses'>(</span><a href="proc.h.html#LN93"><span class='Ref_to_Struct'>PGPROC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>proc</span><span class='Delimiter'>, </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashcode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN551"></a><span class='Keyword'>extern </span><a href="../c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Prototype'>LockShmemSize</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN552"></a><span class='Keyword'>extern </span><a href="lock.h.html#LN437"><span class='Ref_to_Struct'>LockData</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>GetLockStatusData</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN553"></a><span class='Keyword'>extern </span><a href="lock.h.html#LN456"><span class='Ref_to_Struct'>BlockedProcsData</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>GetBlockerStatusData</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>blocked_pid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN555"></a><span class='Keyword'>extern </span><a href="lockdefs.h.html#LN48"><span class='Ref_to_Struct'>xl_standby_lock</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>GetRunningTransactionLocks</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>nlocks</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN556"></a><span class='Keyword'>extern const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>GetLockmodeName</span><span class='Parentheses'>(</span><a href="lock.h.html#LN125"><span class='Ref_to_Typedef'>LOCKMETHODID</span></a> <span class='Declare_Parameter'>lockmethodid</span><span class='Delimiter'>, </span><a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN558"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>lock_twophase_recover</span><span class='Parentheses'>(</span><a href="../c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Delimiter'>, </span><a href="../c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>info</span><span class='Delimiter'>, 
</span><a name="LN559"></a>                      <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>recdata</span><span class='Delimiter'>, </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN560"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>lock_twophase_postcommit</span><span class='Parentheses'>(</span><a href="../c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Delimiter'>, </span><a href="../c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>info</span><span class='Delimiter'>, 
</span><a name="LN561"></a>                         <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>recdata</span><span class='Delimiter'>, </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN562"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>lock_twophase_postabort</span><span class='Parentheses'>(</span><a href="../c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Delimiter'>, </span><a href="../c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>info</span><span class='Delimiter'>, 
</span><a name="LN563"></a>                        <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>recdata</span><span class='Delimiter'>, </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN564"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>lock_twophase_standby_recover</span><span class='Parentheses'>(</span><a href="../c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>xid</span><span class='Delimiter'>, </span><a href="../c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>info</span><span class='Delimiter'>, 
</span><a name="LN565"></a>                              <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>recdata</span><span class='Delimiter'>, </span><a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN567"></a><span class='Keyword'>extern </span><a href="lock.h.html#LN479"><span class='Ref_to_Typedef'>DeadLockState</span></a> <span class='Declare_Prototype'>DeadLockCheck</span><span class='Parentheses'>(</span><a href="proc.h.html#LN93"><span class='Ref_to_Struct'>PGPROC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>proc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN568"></a><span class='Keyword'>extern </span><a href="proc.h.html#LN93"><span class='Ref_to_Struct'>PGPROC</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>GetBlockingAutoVacuumPgproc</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN569"></a><span class='Keyword'>extern void </span><a href="../../backend/storage/lmgr/deadlock.c.html#LN1075"><span class='Ref_to_Func'>DeadLockReport</span></a><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><span class='Declare_Var'>pg_attribute_noreturn</span><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN570"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>RememberSimpleDeadLock</span><span class='Parentheses'>(</span><a href="proc.h.html#LN93"><span class='Ref_to_Struct'>PGPROC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>proc1</span><span class='Delimiter'>, 
</span><a name="LN571"></a>                       <a href="lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, 
</span><a name="LN572"></a>                       <a href="lock.h.html#LN284"><span class='Ref_to_Struct'>LOCK</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lock</span><span class='Delimiter'>, 
</span><a name="LN573"></a>                       <a href="proc.h.html#LN93"><span class='Ref_to_Struct'>PGPROC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>proc2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN574"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>InitDeadLockChecking</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN576"></a><span class='Keyword'>extern int</span>  <span class='Declare_Prototype'>LockWaiterCount</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="lock.h.html#LN178"><span class='Ref_to_Struct'>LOCKTAG</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>locktag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> LOCK_DEBUG 
<a name="LN579"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>DumpLocks</span><span class='Parentheses'>(</span><a href="proc.h.html#LN93"><span class='Ref_to_Struct'>PGPROC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>proc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN580"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>DumpAllLocks</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* Lock a VXID (used to wait for a transaction to finish) */ 
</span><a name="LN584"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>VirtualXactLockTableInsert</span><span class='Parentheses'>(</span><a href="lock.h.html#LN62"><span class='Ref_to_Typedef'>VirtualTransactionId</span></a> <span class='Declare_Parameter'>vxid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN585"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>VirtualXactLockTableCleanup</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN586"></a><span class='Keyword'>extern bool </span><span class='Declare_Prototype'>VirtualXactLock</span><span class='Parentheses'>(</span><a href="lock.h.html#LN62"><span class='Ref_to_Typedef'>VirtualTransactionId</span></a> <span class='Declare_Parameter'>vxid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>wait</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* LOCK_H */ 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>