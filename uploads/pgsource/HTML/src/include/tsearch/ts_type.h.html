<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\include\tsearch\ts_type.h</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\include\tsearch\ts_type.h</b></p></td>
<td align='right'>
Wed Jun 14 08:26:08 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * ts_type.h 
 *    Definitions for the tsvector and tsquery types 
 * 
 * Copyright (c) 1998-2017, PostgreSQL Global Development Group 
 * 
 * src/include/tsearch/ts_type.h 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Directive'>#ifndef</span> <a href="ts_type.h.html#LN12"><span class='Ref_to_Const'>_PG_TSTYPE_H_</span></a> 
<a name="LN12"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>_PG_TSTYPE_H_</span> 
 
<span class='Keyword'>#include </span><span class='String'>"fmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * TSVector type. 
 * 
 * Structure of tsvector datatype: 
 * 1) standard varlena header 
 * 2) int32     size - number of lexemes (WordEntry array entries) 
 * 3) Array of WordEntry - one per lexeme; must be sorted according to 
 *              tsCompareString() (ie, memcmp of lexeme strings). 
 *              WordEntry-&GT;pos gives the number of bytes from end of WordEntry 
 *              array to start of lexeme's string, which is of length len. 
 * 4) Per-lexeme data storage: 
 *    lexeme string (not null-terminated) 
 *    if haspos is true: 
 *      padding byte if necessary to make the position data 2-byte aligned 
 *      uint16          number of positions that follow 
 *      WordEntryPos[]  positions 
 * 
 * The positions for each lexeme must be sorted. 
 * 
 * Note, tsvectorsend/recv believe that sizeof(WordEntry) == 4 
 */ 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span>    <a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN43"></a>                <span class='Declare_Member'>haspos</span><span class='Operator'>:</span><span class='Number'>1</span><span class='Delimiter'>, 
</span><a name="LN44"></a>                <span class='Declare_Member'>len</span><span class='Operator'>:</span><span class='Number'>11</span><span class='Delimiter'>,</span>         <span class='Comment_Single_Line'>/* MAX 2Kb */ 
</span><a name="LN45"></a>                <span class='Declare_Member'>pos</span><span class='Operator'>:</span><span class='Number'>20</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* MAX 1Mb */ 
</span><a name="LN46"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>WordEntry</span><span class='Delimiter'>; 
</span> 
<a name="LN48"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAXSTRLEN</span> <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>&LT;&LT;</span><span class='Number'>11</span><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
<a name="LN49"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAXSTRPOS</span> <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>&LT;&LT;</span><span class='Number'>20</span><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
 
<a name="LN51"></a><span class='Keyword'>extern int</span>  <span class='Declare_Prototype'>compareWordEntryPos</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Equivalent to 
 * typedef struct { 
 *      uint16 
 *          weight:2, 
 *          pos:14; 
 * } 
 */ 
</span> 
<a name="LN62"></a><span class='Control'>typedef</span> <a href="../c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Typedef'>WordEntryPos</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN66"></a>    <a href="../c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Member'>npos</span><span class='Delimiter'>; 
</span><a name="LN67"></a>    <a href="ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Declare_Member'>pos</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>]; 
</span><a name="LN68"></a>} <span class='Declare_Typedef'>WordEntryPosVector</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* WordEntryPosVector with exactly 1 entry */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN73"></a>    <a href="../c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Member'>npos</span><span class='Delimiter'>; 
</span><a name="LN74"></a>    <a href="ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Declare_Member'>pos</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN75"></a>} <span class='Declare_Typedef'>WordEntryPosVector1</span><span class='Delimiter'>; 
</span> 
 
<a name="LN78"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>WEP_GETWEIGHT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>    <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN78"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>14</span> <span class='Parentheses'>)</span> 
<a name="LN79"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>WEP_GETPOS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>       <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN79"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0x3fff</span> <span class='Parentheses'>)</span> 
 
<a name="LN81"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>WEP_SETWEIGHT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>v</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN81"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span> <span class='Operator'>= </span><span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN81"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;&LT; </span><span class='Number'>14</span> <span class='Parentheses'>)</span> <span class='Operator'>| </span><span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN81"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0x3fff</span> <span class='Parentheses'>)</span> <span class='Parentheses'>)</span> 
<a name="LN82"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>WEP_SETPOS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>v</span><span class='Parentheses'>)</span>     <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN82"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span> <span class='Operator'>= </span><span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN82"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0xc000</span> <span class='Parentheses'>)</span> <span class='Operator'>| </span><span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN82"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0x3fff</span> <span class='Parentheses'>)</span> <span class='Parentheses'>)</span> 
 
<a name="LN84"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAXENTRYPOS</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>&LT;&LT;</span><span class='Number'>14</span><span class='Parentheses'>) 
</span><a name="LN85"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAXNUMPOS</span>   <span class='Parentheses'>(</span><span class='Number'>256</span><span class='Parentheses'>) 
</span><a name="LN86"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>LIMITPOS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>) (</span> <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN86"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="ts_type.h.html#LN84"><span class='Ref_to_Const'>MAXENTRYPOS</span></a> <span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN84"><span class='Ref_to_Const'>MAXENTRYPOS</span></a><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>: </span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN86"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * In case if a TSVector contains several parts and we want to treat them as 
 * separate, it's necessary to add an artificial increment to position of each 
 * lexeme from every next part. It's required to avoid the situation when 
 * tsquery can find a phrase consisting of lexemes from two of such parts. 
 * TS_JUMP defined a value of this increment. 
 */ 
</span><a name="LN95"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TS_JUMP</span> <span class='Number'>1</span> 
 
<span class='Comment_Multi_Line'>/* This struct represents a complete tsvector datum */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN100"></a>    <a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>vl_len_</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* varlena header (do not touch directly!) */ 
</span><a name="LN101"></a>    <a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>size</span><span class='Delimiter'>; 
</span><a name="LN102"></a>    <a href="ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>   <span class='Declare_Member'>entries</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>]; 
</span>    <span class='Comment_Multi_Line'>/* lexemes follow the entries[] array */ 
</span><a name="LN104"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>TSVectorData</span><span class='Delimiter'>; 
</span> 
<a name="LN106"></a><span class='Control'>typedef</span> <a href="ts_type.h.html#LN98"><span class='Ref_to_Typedef'>TSVectorData</span></a> <span class='Operator'>*</span><span class='Declare_Typedef'>TSVector</span><span class='Delimiter'>; 
</span> 
<a name="LN108"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DATAHDRSIZE</span> <span class='Parentheses'>(</span><a href="../c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN98"><span class='Ref_to_Typedef'>TSVectorData</span></a><span class='Delimiter'>, </span>entries<span class='Parentheses'>))</span> 
<a name="LN109"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CALCDATASIZE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>nentries</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>lenstr</span><span class='Parentheses'>) (</span><a href="ts_type.h.html#LN108"><span class='Ref_to_Const'>DATAHDRSIZE</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN109"><span class='Ref_to_Parameter'>nentries</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN109"><span class='Ref_to_Parameter'>lenstr</span></a><span class='Parentheses'>) )</span> 
 
<span class='Comment_Multi_Line'>/* pointer to start of a tsvector's WordEntry array */ 
</span><a name="LN112"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ARRPTR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>   <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN112"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>entries <span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* pointer to start of a tsvector's lexeme storage */ 
</span><a name="LN115"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>STRPTR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>   <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN115"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>entries<span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN115"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>size<span class='Delimiter'>] </span><span class='Parentheses'>)</span> 
 
<a name="LN117"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>_POSVECPTR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>e</span><span class='Parentheses'>)</span>    <span class='Parentheses'>((</span><a href="ts_type.h.html#LN64"><span class='Ref_to_Typedef'>WordEntryPosVector</span></a> <span class='Operator'>*</span><span class='Parentheses'>)(</span><a href="../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN117"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="../c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>((</span><a href="ts_type.h.html#LN117"><span class='Ref_to_Parameter'>e</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>pos <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN117"><span class='Ref_to_Parameter'>e</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>len<span class='Parentheses'>)))</span> 
<a name="LN118"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>POSDATALEN</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>e</span><span class='Parentheses'>) (</span> <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><a href="ts_type.h.html#LN118"><span class='Ref_to_Parameter'>e</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>haspos <span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN117"><span class='Ref_to_Macro'>_POSVECPTR</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN118"><span class='Ref_to_Parameter'>x</span></a><span class='Delimiter'>,</span><a href="ts_type.h.html#LN118"><span class='Ref_to_Parameter'>e</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>npos<span class='Parentheses'>)</span> <span class='Operator'>: </span><span class='Number'>0</span> <span class='Parentheses'>)</span> 
<a name="LN119"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>POSDATAPTR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>e</span><span class='Parentheses'>) (</span><a href="ts_type.h.html#LN117"><span class='Ref_to_Macro'>_POSVECPTR</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN119"><span class='Ref_to_Parameter'>x</span></a><span class='Delimiter'>,</span><a href="ts_type.h.html#LN119"><span class='Ref_to_Parameter'>e</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>pos<span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * fmgr interface macros 
 */ 
</span> 
<a name="LN125"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetTSVector</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>)</span>         <span class='Parentheses'>((</span><a href="ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="../fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN125"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN126"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetTSVectorCopy</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>)</span>     <span class='Parentheses'>((</span><a href="ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="../fmgr.h.html#LN206"><span class='Ref_to_Macro'>PG_DETOAST_DATUM_COPY</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN126"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN127"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>TSVectorGetDatum</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>)</span>         <a href="../postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN127"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>) 
</span><a name="LN128"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_GETARG_TSVECTOR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span>       <a href="ts_type.h.html#LN125"><span class='Ref_to_Macro'>DatumGetTSVector</span></a><span class='Parentheses'>(</span><a href="../fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN128"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span> 
<a name="LN129"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_GETARG_TSVECTOR_COPY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span>  <a href="ts_type.h.html#LN126"><span class='Ref_to_Macro'>DatumGetTSVectorCopy</span></a><span class='Parentheses'>(</span><a href="../fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN129"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span> 
<a name="LN130"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_RETURN_TSVECTOR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>       <span class='Control'>return</span> <a href="ts_type.h.html#LN127"><span class='Ref_to_Macro'>TSVectorGetDatum</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN130"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * TSQuery 
 * 
 * 
 */ 
</span> 
<a name="LN139"></a><span class='Control'>typedef</span> <a href="../c.h.html#LN253"><span class='Ref_to_Typedef'>int8</span></a> <span class='Declare_Typedef'>QueryItemType</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Valid values for QueryItemType: */ 
</span><a name="LN142"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>QI_VAL</span> <span class='Number'>1</span> 
<a name="LN143"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>QI_OPR</span> <span class='Number'>2</span> 
<a name="LN144"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>QI_VALSTOP</span> <span class='Number'>3</span>            <span class='Comment_Multi_Line'>/* This is only used in an intermediate stack 
                                 * representation in parse_tsquery. It's not a 
                                 * legal type elsewhere. */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * QueryItem is one node in tsquery - operator or operand. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN153"></a>    <a href="ts_type.h.html#LN139"><span class='Ref_to_Typedef'>QueryItemType</span></a> <span class='Declare_Member'>type</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* operand or kind of operator (ts_tokentype) */ 
</span><a name="LN154"></a>    <a href="../c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Member'>weight</span><span class='Delimiter'>;</span>         <span class='Comment_Multi_Line'>/* weights of operand to search. It's a 
                                 * bitmask of allowed weights. if it =0 then 
                                 * any weight are allowed. Weights and bit 
                                 * map: A: 1&LT;&LT;3 B: 1&LT;&LT;2 C: 1&LT;&LT;1 D: 1&LT;&LT;0 */ 
</span><a name="LN158"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>prefix</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* true if it's a prefix search */ 
</span><a name="LN159"></a>    <a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>valcrc</span><span class='Delimiter'>;</span>         <span class='Comment_Multi_Line'>/* XXX: pg_crc32 would be a more appropriate 
                                 * data type, but we use comparisons to signed 
                                 * integers in the code. They would need to be 
                                 * changed as well. */ 
</span> 
    <span class='Comment_Multi_Line'>/* pointer to text value of operand, must correlate with WordEntry */ 
</span>    <a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN166"></a>                <span class='Declare_Member'>length</span><span class='Operator'>:</span><span class='Number'>12</span><span class='Delimiter'>, 
</span><a name="LN167"></a>                <span class='Declare_Member'>distance</span><span class='Operator'>:</span><span class='Number'>20</span><span class='Delimiter'>; 
</span><a name="LN168"></a>} <span class='Declare_Typedef'>QueryOperand</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Legal values for QueryOperator.operator. 
 */ 
</span><a name="LN174"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>OP_NOT</span>          <span class='Number'>1</span> 
<a name="LN175"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>OP_AND</span>          <span class='Number'>2</span> 
<a name="LN176"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>OP_OR</span>           <span class='Number'>3</span> 
<a name="LN177"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>OP_PHRASE</span>       <span class='Number'>4</span>       <span class='Comment_Single_Line'>/* highest code, tsquery_cleanup.c */ 
</span><a name="LN178"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>OP_COUNT</span>        <span class='Number'>4</span> 
 
<a name="LN180"></a><span class='Keyword'>extern const int </span><span class='Declare_Var'>tsearch_op_priority</span><span class='Delimiter'>[</span><a href="ts_type.h.html#LN178"><span class='Ref_to_Const'>OP_COUNT</span></a><span class='Delimiter'>]; 
</span> 
<span class='Comment_Multi_Line'>/* get operation priority  by its code*/ 
</span><a name="LN183"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>OP_PRIORITY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span> <a href="../../backend/utils/adt/tsquery.c.html#LN26"><span class='Ref_to_Global_Var'>tsearch_op_priority</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN183"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Parentheses'>)</span> 
<span class='Comment_Multi_Line'>/* get QueryOperator priority */ 
</span><a name="LN185"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>QO_PRIORITY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>  <a href="ts_type.h.html#LN183"><span class='Ref_to_Macro'>OP_PRIORITY</span></a><span class='Parentheses'>(((</span><a href="ts_type.h.html#LN187"><span class='Ref_to_Typedef'>QueryOperator</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="ts_type.h.html#LN185"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>oper<span class='Parentheses'>)</span> 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN189"></a>    <a href="ts_type.h.html#LN139"><span class='Ref_to_Typedef'>QueryItemType</span></a> <span class='Declare_Member'>type</span><span class='Delimiter'>; 
</span><a name="LN190"></a>    <a href="../c.h.html#LN253"><span class='Ref_to_Typedef'>int8</span></a>        <span class='Declare_Member'>oper</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* see above */ 
</span><a name="LN191"></a>    <a href="../c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Member'>distance</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* distance between agrs for OP_PHRASE */ 
</span><a name="LN192"></a>    <a href="../c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>left</span><span class='Delimiter'>;</span>           <span class='Comment_Multi_Line'>/* pointer to left operand. Right operand is 
                                 * item + 1, left operand is placed 
                                 * item+item-&GT;left */ 
</span><a name="LN195"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>QueryOperator</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Note: TSQuery is 4-bytes aligned, so make sure there's no fields 
 * inside QueryItem requiring 8-byte alignment, like int64. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>union</span> 
<span class='Delimiter'>{ 
</span><a name="LN203"></a>    <a href="ts_type.h.html#LN139"><span class='Ref_to_Typedef'>QueryItemType</span></a> <span class='Declare_Member'>type</span><span class='Delimiter'>; 
</span><a name="LN204"></a>    <a href="ts_type.h.html#LN187"><span class='Ref_to_Typedef'>QueryOperator</span></a> <span class='Declare_Member'>qoperator</span><span class='Delimiter'>; 
</span><a name="LN205"></a>    <a href="ts_type.h.html#LN151"><span class='Ref_to_Typedef'>QueryOperand</span></a> <span class='Declare_Member'>qoperand</span><span class='Delimiter'>; 
</span><a name="LN206"></a>} <span class='Declare_Typedef'>QueryItem</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Storage: 
 *  (len)(size)(array of QueryItem)(operands as '\0'-terminated c-strings) 
 */ 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN215"></a>    <a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>vl_len_</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* varlena header (do not touch directly!) */ 
</span><a name="LN216"></a>    <a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>size</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* number of QueryItems */ 
</span><a name="LN217"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>data</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>];</span>    <span class='Comment_Single_Line'>/* data starts here */ 
</span><a name="LN218"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>TSQueryData</span><span class='Delimiter'>; 
</span> 
<a name="LN220"></a><span class='Control'>typedef</span> <a href="ts_type.h.html#LN213"><span class='Ref_to_Typedef'>TSQueryData</span></a> <span class='Operator'>*</span><span class='Declare_Typedef'>TSQuery</span><span class='Delimiter'>; 
</span> 
<a name="LN222"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>HDRSIZETQ</span>   <span class='Parentheses'>(</span> <a href="../c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) )</span> 
 
<span class='Comment_Multi_Line'>/* Computes the size of header and all QueryItems. size is the number of 
 * QueryItems, and lenofoperand is the total length of all operands 
 */ 
</span><a name="LN227"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>COMPUTESIZE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>size</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>lenofoperand</span><span class='Parentheses'>) (</span> <a href="ts_type.h.html#LN222"><span class='Ref_to_Const'>HDRSIZETQ</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN227"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN227"><span class='Ref_to_Parameter'>lenofoperand</span></a><span class='Parentheses'>) )</span> 
<a name="LN228"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>TSQUERY_TOO_BIG</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>size</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>lenofoperand</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="ts_type.h.html#LN228"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a> <span class='Operator'>- </span><a href="ts_type.h.html#LN222"><span class='Ref_to_Const'>HDRSIZETQ</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN228"><span class='Ref_to_Parameter'>lenofoperand</span></a><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a><span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* Returns a pointer to the first QueryItem in a TSQuery */ 
</span><a name="LN232"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>GETQUERY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>  <span class='Parentheses'>((</span><a href="ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a><span class='Operator'>*</span><span class='Parentheses'>)(</span> <span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Operator'>*</span><span class='Parentheses'>)(</span><a href="ts_type.h.html#LN232"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Operator'>+</span><a href="ts_type.h.html#LN222"><span class='Ref_to_Const'>HDRSIZETQ</span></a> <span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* Returns a pointer to the beginning of operands in a TSQuery */ 
</span><a name="LN235"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>GETOPERAND</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>   <span class='Parentheses'>(</span> <span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Operator'>*</span><span class='Parentheses'>)</span><a href="../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN235"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>((</span><a href="ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a><span class='Parentheses'>)(</span><a href="ts_type.h.html#LN235"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>size <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * fmgr interface macros 
 * Note, TSQuery type marked as plain storage, so it can't be toasted 
 * but PG_DETOAST_DATUM_COPY is used for simplicity 
 */ 
</span> 
<a name="LN243"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetTSQuery</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>)</span>          <span class='Parentheses'>((</span><a href="ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a><span class='Parentheses'>) </span><a href="../postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN243"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN244"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetTSQueryCopy</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>)</span>      <span class='Parentheses'>((</span><a href="ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a><span class='Parentheses'>) </span><a href="../fmgr.h.html#LN206"><span class='Ref_to_Macro'>PG_DETOAST_DATUM_COPY</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN244"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN245"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>TSQueryGetDatum</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>)</span>          <a href="../postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN245"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>) 
</span><a name="LN246"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_GETARG_TSQUERY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span>        <a href="ts_type.h.html#LN243"><span class='Ref_to_Macro'>DatumGetTSQuery</span></a><span class='Parentheses'>(</span><a href="../fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN246"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span> 
<a name="LN247"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_GETARG_TSQUERY_COPY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span>   <a href="ts_type.h.html#LN244"><span class='Ref_to_Macro'>DatumGetTSQueryCopy</span></a><span class='Parentheses'>(</span><a href="../fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN247"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span> 
<a name="LN248"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_RETURN_TSQUERY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>        <span class='Control'>return</span> <a href="ts_type.h.html#LN245"><span class='Ref_to_Macro'>TSQueryGetDatum</span></a><span class='Parentheses'>(</span><a href="ts_type.h.html#LN248"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) 
</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* _PG_TSTYPE_H_ */ 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>