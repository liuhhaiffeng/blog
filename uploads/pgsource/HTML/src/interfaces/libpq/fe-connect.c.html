<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\interfaces\libpq\fe-connect.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\interfaces\libpq\fe-connect.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:10 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * fe-connect.c 
 *    functions related to setting up a connection to the backend 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/interfaces/libpq/fe-connect.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;time.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"libpq-fe.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq-int.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"fe-auth.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pg_config_paths.h"</span> 
 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>#include </span><span class='String'>"win32.h"</span> 
<span class='Directive'>#ifdef</span> <a href="../../port/path.c.html#LN27"><span class='Ref_to_Const'>_WIN32_IE</span></a> 
<span class='Keyword'>#undef </span><a href="../../port/path.c.html#LN27"><span class='Ref_to_Const'>_WIN32_IE</span></a> 
<span class='Directive'>#endif</span> 
<a name="LN33"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>_WIN32_IE</span> <span class='Number'>0x0500</span> 
<span class='Directive'>#ifdef</span> <span class='Keyword'>near 
#undef near 
</span><span class='Directive'>#endif</span> 
<a name="LN37"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>near</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;shlobj.h&GT;</span> 
<span class='Directive'>#ifdef</span> _MSC_VER                 <span class='Comment_Single_Line'>/* mstcpip.h is missing on mingw */ 
</span><span class='Keyword'>#include </span><span class='String'>&LT;mstcpip.h&GT;</span> 
<span class='Directive'>#endif</span> 
<span class='Directive'>#else</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/socket.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netdb.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/in.h&GT;</span> 
<span class='Directive'>#ifdef</span> HAVE_NETINET_TCP_H 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/tcp.h&GT;</span> 
<span class='Directive'>#endif</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;arpa/inet.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifdef</span> ENABLE_THREAD_SAFETY 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>#include </span><span class='String'>"pthread-win32.h"</span> 
<span class='Directive'>#else</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;pthread.h&GT;</span> 
<span class='Directive'>#endif</span> 
<span class='Directive'>#endif</span> 
 
<span class='Directive'>#ifdef</span> USE_LDAP 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>#include </span><span class='String'>&LT;winldap.h&GT;</span> 
<span class='Directive'>#else</span> 
<span class='Comment_Multi_Line'>/* OpenLDAP deprecates RFC 1823, but we want standard conformance */ 
</span><a name="LN65"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LDAP_DEPRECATED</span> <span class='Number'>1</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;ldap.h&GT;</span> 
<a name="LN67"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> timeval <span class='Declare_Typedef'>LDAP_TIMEVAL</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN69"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>ldapServiceLookup</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>purl</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN70"></a>                  <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"common/ip.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
 
 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN78"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PGPASSFILE</span> <span class='String'>".pgpass"</span> 
<span class='Directive'>#else</span> 
<a name="LN80"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PGPASSFILE</span> <span class='String'>"pgpass.conf"</span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Pre-9.0 servers will return this SQLSTATE if asked to set 
 * application_name in a startup packet.  We hard-wire the value rather 
 * than looking into errcodes.h since it reflects historical behavior 
 * rather than that of the current code. 
 */ 
</span><a name="LN89"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ERRCODE_APPNAME_UNKNOWN</span> <span class='String'>"42704"</span> 
 
<span class='Comment_Multi_Line'>/* This is part of the protocol so just define it */ 
</span><a name="LN92"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ERRCODE_INVALID_PASSWORD</span> <span class='String'>"28P01"</span> 
<span class='Comment_Multi_Line'>/* This too */ 
</span><a name="LN94"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ERRCODE_CANNOT_CONNECT_NOW</span> <span class='String'>"57P03"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * fall back options if they are not specified by arguments or defined 
 * by environment variables 
 */ 
</span><a name="LN100"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DefaultHost</span>     <span class='String'>"localhost"</span> 
<a name="LN101"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DefaultTty</span>      <span class='String'>""</span> 
<a name="LN102"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DefaultOption</span>   <span class='String'>""</span> 
<a name="LN103"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DefaultAuthtype</span>       <span class='String'>""</span> 
<a name="LN104"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DefaultTargetSessionAttrs</span>   <span class='String'>"any"</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN172"><span class='Ref_to_Const'>USE_SSL</span></a> 
<a name="LN106"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DefaultSSLMode</span> <span class='String'>"prefer"</span> 
<span class='Directive'>#else</span> 
<a name="LN108"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DefaultSSLMode</span>  <span class='String'>"disable"</span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Definition of the conninfo parameters and their fallback resources. 
 * 
 * If Environment-Var and Compiled-in are specified as NULL, no 
 * fallback is available. If after all no value can be determined 
 * for an option, an error is returned. 
 * 
 * The value for the username is treated specially in conninfo_add_defaults. 
 * If the value is not obtained any other way, the username is determined 
 * by pg_fe_getauthname(). 
 * 
 * The Label and Disp-Char entries are provided for applications that 
 * want to use PQconndefaults() to create a generic database connection 
 * dialog. Disp-Char is defined as follows: 
 *      ""      Normal input field 
 *      "*"     Password field - hide value 
 *      "D"     Debug option - don't show by default 
 * 
 * PQconninfoOptions[] is a constant static array that we use to initialize 
 * a dynamically allocated working copy.  All the "val" fields in 
 * PQconninfoOptions[] *must* be NULL.  In a working copy, non-null "val" 
 * fields point to malloc'd strings that should be freed when the working 
 * array is freed (see PQconninfoFree). 
 * 
 * The first part of each struct is identical to the one in libpq-fe.h, 
 * which is required since we memcpy() data between the two! 
 * ---------- 
 */ 
</span><a name="LN139"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>_internalPQconninfoOption</span> 
<span class='Delimiter'>{ 
</span><a name="LN141"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>keyword</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* The keyword of the option            */ 
</span><a name="LN142"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>envvar</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* Fallback environment variable name   */ 
</span><a name="LN143"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>compiled</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Fallback compiled in default value   */ 
</span><a name="LN144"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>val</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* Option's current value, or NULL       */ 
</span><a name="LN145"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>label</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* Label for field in connect dialog    */ 
</span><a name="LN146"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>dispchar</span><span class='Delimiter'>;</span>       <span class='Comment_Multi_Line'>/* Indicates how to display this field in a 
                                 * connect dialog. Values are: "" Display 
                                 * entered value as is "*" Password field - 
                                 * hide value "D"  Debug option - don't show 
                                 * by default */ 
</span><a name="LN151"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>dispsize</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Field size in characters for dialog  */ 
</span>    <span class='Comment_Multi_Line'>/* --- 
     * Anything above this comment must be synchronized with 
     * PQconninfoOption in libpq-fe.h, since we memcpy() data 
     * between them! 
     * --- 
     */ 
</span><a name="LN158"></a>    off_t       <span class='Declare_Member'>connofs</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Offset into PGconn struct, -1 if not there */ 
</span><a name="LN159"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end _internalPQconninfoOption &raquo; </span> <span class='Declare_Typedef'>internalPQconninfoOption</span><span class='Delimiter'>; 
</span> 
<a name="LN161"></a><span class='Keyword'>static const </span><a href="fe-connect.c.html#LN139"><span class='Ref_to_Typedef'>internalPQconninfoOption</span></a> <span class='Declare_Var'>PQconninfoOptions</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * "authtype" is no longer used, so mark it "don't show".  We keep it in 
     * the array so as not to reject conninfo strings from old apps that might 
     * still try to set it. 
     */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"authtype"</span><span class='Delimiter'>, </span><span class='String'>"PGAUTHTYPE"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN103"><span class='Ref_to_Const'>DefaultAuthtype</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>    <span class='String'>"Database-Authtype"</span><span class='Delimiter'>, </span><span class='String'>"D"</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"service"</span><span class='Delimiter'>, </span><span class='String'>"PGSERVICE"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>    <span class='String'>"Database-Service"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"user"</span><span class='Delimiter'>, </span><span class='String'>"PGUSER"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Database-User"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>pguser<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"password"</span><span class='Delimiter'>, </span><span class='String'>"PGPASSWORD"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Database-Password"</span><span class='Delimiter'>, </span><span class='String'>"*"</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>pgpass<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"passfile"</span><span class='Delimiter'>, </span><span class='String'>"PGPASSFILE"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Database-Password-File"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>pgpassfile<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"connect_timeout"</span><span class='Delimiter'>, </span><span class='String'>"PGCONNECT_TIMEOUT"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Connect-timeout"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* strlen(INT32_MAX) == 10 */ 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>connect_timeout<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"dbname"</span><span class='Delimiter'>, </span><span class='String'>"PGDATABASE"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Database-Name"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span><a href="../../bin/pgbench/pgbench.c.html#LN182"><span class='Ref_to_Global_Var'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"host"</span><span class='Delimiter'>, </span><span class='String'>"PGHOST"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Database-Host"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>40</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span><a href="../../bin/pgbench/pgbench.c.html#LN179"><span class='Ref_to_Global_Var'>pghost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"hostaddr"</span><span class='Delimiter'>, </span><span class='String'>"PGHOSTADDR"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Database-Host-IP-Address"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>45</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>pghostaddr<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"port"</span><span class='Delimiter'>, </span><span class='String'>"PGPORT"</span><span class='Delimiter'>, </span>DEF_PGPORT_STR<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Database-Port"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span><a href="../../bin/pgbench/pgbench.c.html#LN180"><span class='Ref_to_Global_Var'>pgport</span></a><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"client_encoding"</span><span class='Delimiter'>, </span><span class='String'>"PGCLIENTENCODING"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Client-Encoding"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>client_encoding_initial<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * "tty" is no longer used either, but keep it present for backwards 
     * compatibility. 
     */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"tty"</span><span class='Delimiter'>, </span><span class='String'>"PGTTY"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN101"><span class='Ref_to_Const'>DefaultTty</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Backend-Debug-TTY"</span><span class='Delimiter'>, </span><span class='String'>"D"</span><span class='Delimiter'>, </span><span class='Number'>40</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>pgtty<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"options"</span><span class='Delimiter'>, </span><span class='String'>"PGOPTIONS"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN102"><span class='Ref_to_Const'>DefaultOption</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Backend-Debug-Options"</span><span class='Delimiter'>, </span><span class='String'>"D"</span><span class='Delimiter'>, </span><span class='Number'>40</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>pgoptions<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"application_name"</span><span class='Delimiter'>, </span><span class='String'>"PGAPPNAME"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Application-Name"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>appname<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"fallback_application_name"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Fallback-Application-Name"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>fbappname<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"keepalives"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"TCP-Keepalives"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* should be just '0' or '1' */ 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>keepalives<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"keepalives_idle"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"TCP-Keepalives-Idle"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* strlen(INT32_MAX) == 10 */ 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>keepalives_idle<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"keepalives_interval"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"TCP-Keepalives-Interval"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* strlen(INT32_MAX) == 10 */ 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>keepalives_interval<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"keepalives_count"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"TCP-Keepalives-Count"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* strlen(INT32_MAX) == 10 */ 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>keepalives_count<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * ssl options are allowed even without client SSL support because the 
     * client can still handle SSL modes "disable" and "allow". Other 
     * parameters have no effect on non-SSL connections, so there is no reason 
     * to exclude them since none of them are mandatory. 
     */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"sslmode"</span><span class='Delimiter'>, </span><span class='String'>"PGSSLMODE"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN106"><span class='Ref_to_Const'>DefaultSSLMode</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"SSL-Mode"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>12</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* sizeof("verify-full") == 12 */ 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>sslmode<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"sslcompression"</span><span class='Delimiter'>, </span><span class='String'>"PGSSLCOMPRESSION"</span><span class='Delimiter'>, </span><span class='String'>"1"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"SSL-Compression"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>sslcompression<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"sslcert"</span><span class='Delimiter'>, </span><span class='String'>"PGSSLCERT"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"SSL-Client-Cert"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>sslcert<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"sslkey"</span><span class='Delimiter'>, </span><span class='String'>"PGSSLKEY"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"SSL-Client-Key"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>sslkey<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"sslrootcert"</span><span class='Delimiter'>, </span><span class='String'>"PGSSLROOTCERT"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"SSL-Root-Certificate"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>sslrootcert<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"sslcrl"</span><span class='Delimiter'>, </span><span class='String'>"PGSSLCRL"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"SSL-Revocation-List"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>sslcrl<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"requirepeer"</span><span class='Delimiter'>, </span><span class='String'>"PGREQUIREPEER"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Require-Peer"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>requirepeer<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>ENABLE_GSS<span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN30"><span class='Ref_to_Const'>ENABLE_SSPI</span></a><span class='Parentheses'>) 
</span>    <span class='Comment_Multi_Line'>/* Kerberos and GSSAPI authentication support specifying the service name */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"krbsrvname"</span><span class='Delimiter'>, </span><span class='String'>"PGKRBSRVNAME"</span><span class='Delimiter'>, </span>PG_KRB_SRVNAM<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Kerberos-service-name"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>krbsrvname<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>ENABLE_GSS<span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN30"><span class='Ref_to_Const'>ENABLE_SSPI</span></a><span class='Parentheses'>) 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * GSSAPI and SSPI both enabled, give a way to override which is used by 
     * default 
     */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"gsslib"</span><span class='Delimiter'>, </span><span class='String'>"PGGSSLIB"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"GSS-library"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* sizeof("gssapi") = 7 */ 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>gsslib<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span><span class='Directive'>#endif</span> 
 
    <span class='Delimiter'>{</span><span class='String'>"replication"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Replication"</span><span class='Delimiter'>, </span><span class='String'>"D"</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>replication<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Delimiter'>{</span><span class='String'>"target_session_attrs"</span><span class='Delimiter'>, </span><span class='String'>"PGTARGETSESSIONATTRS"</span><span class='Delimiter'>, 
</span>        <a href="fe-connect.c.html#LN104"><span class='Ref_to_Const'>DefaultTargetSessionAttrs</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>        <span class='String'>"Target-Session-Attrs"</span><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* sizeof("read-write") = 11 */ 
</span>    <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="libpq-int.h.html#LN320"><span class='Ref_to_Struct'>pg_conn</span></a><span class='Delimiter'>, </span>target_session_attrs<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span> 
    <span class='Comment_Multi_Line'>/* Terminating entry --- MUST BE LAST */ 
</span>    <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>    <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
}; 
</span> 
<a name="LN311"></a><span class='Keyword'>static const </span><a href="libpq-int.h.html#LN248"><span class='Ref_to_Struct'>PQEnvironmentOption</span></a> <span class='Declare_Var'>EnvironmentOptions</span><span class='Delimiter'>[] </span><span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* common user-interface settings */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"PGDATESTYLE"</span><span class='Delimiter'>, </span><span class='String'>"datestyle"</span> 
    <span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"PGTZ"</span><span class='Delimiter'>, </span><span class='String'>"timezone"</span> 
    <span class='Delimiter'>}, 
</span>    <span class='Comment_Multi_Line'>/* internal performance-related settings */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='String'>"PGGEQO"</span><span class='Delimiter'>, </span><span class='String'>"geqo"</span> 
    <span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL 
</span>    <span class='Delimiter'>} 
}; 
</span> 
<span class='Comment_Multi_Line'>/* The connection URI must start with either of the following designators: */ 
</span><a name="LN330"></a><span class='Keyword'>static const char </span><span class='Declare_Var'>uri_designator</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='String'>"postgresql://"</span><span class='Delimiter'>; 
</span><a name="LN331"></a><span class='Keyword'>static const char </span><span class='Declare_Var'>short_uri_designator</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='String'>"postgres://"</span><span class='Delimiter'>; 
</span> 
<a name="LN333"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>connectOptions1</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conninfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN334"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>connectOptions2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN335"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>connectDBStart</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN336"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>connectDBComplete</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN337"></a><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN128"><span class='Ref_to_Typedef'>PGPing</span></a> <span class='Declare_Prototype'>internal_ping</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN338"></a><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>makeEmptyPGconn</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN339"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>fillPGconn</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN340"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>freePGconn</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN341"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>closePGconn</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN342"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>release_all_addrinfo</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN343"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sendTerminateConn</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN344"></a><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>conninfo_init</span><span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN345"></a><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>parse_connection_string</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conninfo</span><span class='Delimiter'>, 
</span><a name="LN346"></a>                        <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>use_defaults</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN347"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>uri_prefix_length</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>connstr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN348"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>recognized_connection_string</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>connstr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN349"></a><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>conninfo_parse</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conninfo</span><span class='Delimiter'>, 
</span><a name="LN350"></a>               <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>use_defaults</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN351"></a><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>conninfo_array_parse</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>keywords</span><span class='Delimiter'>, 
</span><a name="LN352"></a>                     <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, 
</span><a name="LN353"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_defaults</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>expand_dbname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN354"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>conninfo_add_defaults</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN355"></a>                      <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN356"></a><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>conninfo_uri_parse</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>uri</span><span class='Delimiter'>, 
</span><a name="LN357"></a>                   <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>use_defaults</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN358"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>conninfo_uri_parse_options</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN359"></a>                           <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>uri</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN360"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>conninfo_uri_parse_params</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN361"></a>                          <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Delimiter'>, 
</span><a name="LN362"></a>                          <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN363"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>conninfo_uri_decode</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN364"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>get_hexdigit</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>digit</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN365"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>conninfo_getval</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Delimiter'>, 
</span><a name="LN366"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>keyword</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN367"></a><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>conninfo_storeval</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Delimiter'>, 
</span><a name="LN368"></a>                  <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>keyword</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, 
</span><a name="LN369"></a>              <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>ignoreMissing</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>uri_decode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN370"></a><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>conninfo_find</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Delimiter'>, 
</span><a name="LN371"></a>              <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>keyword</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN372"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>defaultNoticeReceiver</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN373"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>defaultNoticeProcessor</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>message</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN374"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>parseServiceInfo</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN375"></a>                 <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN376"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>parseServiceFile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>serviceFile</span><span class='Delimiter'>, 
</span><a name="LN377"></a>                 <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>service</span><span class='Delimiter'>, 
</span><a name="LN378"></a>                 <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN379"></a>                 <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, 
</span><a name="LN380"></a>                 <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>group_found</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN381"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>pwdfMatchesString</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN382"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>passwordFromFile</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>hostname</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>port</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Delimiter'>, 
</span><a name="LN383"></a>                 <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>username</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pgpassfile</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN384"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgpassfileWarning</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN385"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>default_threadlock</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>acquire</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* global variable because fe-auth.c needs to access it */ 
</span><a name="LN389"></a><a href="libpq-fe.h.html#LN373"><span class='Ref_to_Typedef'>pgthreadlock_t</span></a> <span class='Declare_Var'>pg_g_threadlock</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN385"><span class='Ref_to_Proto'>default_threadlock</span></a><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *      pqDropConnection 
 * 
 * Close any physical connection to the server, and reset associated 
 * state inside the connection object.  We don't release state that 
 * would be needed to reconnect, though. 
 * 
 * We can always flush the output buffer, since there's no longer any hope 
 * of sending that data.  However, unprocessed input data might still be 
 * valuable, so the caller must tell us whether to flush that or not. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN404"></a><span class='Declare_Function'>pqDropConnection</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>flushInput</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Drop any SSL state */ 
</span>    <a href="fe-secure.c.html#LN187"><span class='Ref_to_Func'>pqsecure_close</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Close the socket itself */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>!= </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Parentheses'>) 
</span>        <a href="win32.h.html#LN11"><span class='Ref_to_Macro'>closesocket</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Optionally discard any unread data */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>flushInput</span></a><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Always discard any unsent data */ 
</span>    <a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN438"><span class='Ref_to_Member'>outCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Free authentication state */ 
</span><span class='Directive'>#ifdef</span> ENABLE_GSS 
    <span class='Delimiter'>{ 
</span><a name="LN424"></a>        OM_uint32   <span class='Declare_Local'>min_s</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN474"><span class='Ref_to_Member'>gctx</span></a><span class='Parentheses'>) 
</span>            gss_delete_sec_context<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN424"><span class='Ref_To_Local'>min_s</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN474"><span class='Ref_to_Member'>gctx</span></a><span class='Delimiter'>, </span>GSS_C_NO_BUFFER<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN475"><span class='Ref_to_Member'>gtarg_nam</span></a><span class='Parentheses'>) 
</span>            gss_release_name<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN424"><span class='Ref_To_Local'>min_s</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN475"><span class='Ref_to_Member'>gtarg_nam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/port/win32.h.html#LN30"><span class='Ref_to_Const'>ENABLE_SSPI</span></a> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN485"><span class='Ref_to_Member'>sspitarget</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN485"><span class='Ref_to_Member'>sspitarget</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN485"><span class='Ref_to_Member'>sspitarget</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN483"><span class='Ref_to_Member'>sspicred</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        FreeCredentialsHandle<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN483"><span class='Ref_to_Member'>sspicred</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN483"><span class='Ref_to_Member'>sspicred</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN483"><span class='Ref_to_Member'>sspicred</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN484"><span class='Ref_to_Member'>sspictx</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        DeleteSecurityContext<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN484"><span class='Ref_to_Member'>sspictx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN484"><span class='Ref_to_Member'>sspictx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN484"><span class='Ref_to_Member'>sspictx</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN486"><span class='Ref_to_Member'>usesspi</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN454"><span class='Ref_to_Member'>sasl_state</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * XXX: if support for more authentication mechanisms is added, this 
         * needs to call the right 'free' function. 
         */ 
</span>        <a href="fe-auth.h.html#LN26"><span class='Ref_to_Proto'>pg_fe_scram_free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN454"><span class='Ref_to_Member'>sasl_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN404"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN454"><span class='Ref_to_Member'>sasl_state</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end pqDropConnection &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *      Connecting to a Database 
 * 
 * There are now six different ways a user of this API can connect to the 
 * database.  Two are not recommended for use in new code, because of their 
 * lack of extensibility with respect to the passing of options to the 
 * backend.  These are PQsetdb and PQsetdbLogin (the former now being a macro 
 * to the latter). 
 * 
 * If it is desired to connect in a synchronous (blocking) manner, use the 
 * function PQconnectdb or PQconnectdbParams. The former accepts a string of 
 * option = value pairs (or a URI) which must be parsed; the latter takes two 
 * NULL terminated arrays instead. 
 * 
 * To connect in an asynchronous (non-blocking) manner, use the functions 
 * PQconnectStart or PQconnectStartParams (which differ in the same way as 
 * PQconnectdb and PQconnectdbParams) and PQconnectPoll. 
 * 
 * Internally, the static functions connectDBStart, connectDBComplete 
 * are part of the connection procedure. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      PQconnectdbParams 
 * 
 * establishes a connection to a postgres backend through the postmaster 
 * using connection information in two arrays. 
 * 
 * The keywords array is defined as 
 * 
 *     const char *params[] = {"option1", "option2", NULL} 
 * 
 * The values array is defined as 
 * 
 *     const char *values[] = {"value1", "value2", NULL} 
 * 
 * Returns a PGconn* which is needed for all subsequent libpq calls, or NULL 
 * if a memory allocation failed. 
 * If the status field of the connection returned is CONNECTION_BAD, 
 * then some fields may be null'ed out instead of having valid values. 
 * 
 * You should call PQfinish (if conn is not NULL) regardless of whether this 
 * call succeeded. 
 */ 
</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>* 
</span><a name="LN509"></a><span class='Declare_Function'>PQconnectdbParams</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>keywords</span><span class='Delimiter'>, 
</span><a name="LN510"></a>                  <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN511"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>expand_dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN513"></a>    <a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN255"><span class='Ref_to_Proto'>PQconnectStartParams</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN509"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN510"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN511"><span class='Ref_to_Parameter'>expand_dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN513"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN513"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN336"><span class='Ref_to_Proto'>connectDBComplete</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN513"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN513"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span> 
<span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      PQpingParams 
 * 
 * check server status, accepting parameters identical to PQconnectdbParams 
 */ 
</span><a href="libpq-fe.h.html#LN128"><span class='Ref_to_Typedef'>PGPing</span></a> 
<a name="LN528"></a><span class='Declare_Function'>PQpingParams</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>keywords</span><span class='Delimiter'>, 
</span><a name="LN529"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN530"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>expand_dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN532"></a>    <a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN255"><span class='Ref_to_Proto'>PQconnectStartParams</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN528"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN529"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN530"><span class='Ref_to_Parameter'>expand_dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN533"></a>    <a href="libpq-fe.h.html#LN128"><span class='Ref_to_Typedef'>PGPing</span></a>      <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN533"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN337"><span class='Ref_to_Proto'>internal_ping</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN532"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN532"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN533"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      PQconnectdb 
 * 
 * establishes a connection to a postgres backend through the postmaster 
 * using connection information in a string. 
 * 
 * The conninfo string is either a whitespace-separated list of 
 * 
 *     option = value 
 * 
 * definitions or a URI (refer to the documentation for details.) Value 
 * might be a single value containing no whitespaces or a single quoted 
 * string. If a single quote should appear anywhere in the value, it must be 
 * escaped with a backslash like \' 
 * 
 * Returns a PGconn* which is needed for all subsequent libpq calls, or NULL 
 * if a memory allocation failed. 
 * If the status field of the connection returned is CONNECTION_BAD, 
 * then some fields may be null'ed out instead of having valid values. 
 * 
 * You should call PQfinish (if conn is not NULL) regardless of whether this 
 * call succeeded. 
 */ 
</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>* 
</span><a name="LN565"></a><span class='Declare_Function'>PQconnectdb</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conninfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN567"></a>    <a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN254"><span class='Ref_to_Proto'>PQconnectStart</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN565"><span class='Ref_to_Parameter'>conninfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN567"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN567"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN336"><span class='Ref_to_Proto'>connectDBComplete</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN567"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN567"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      PQping 
 * 
 * check server status, accepting parameters identical to PQconnectdb 
 */ 
</span><a href="libpq-fe.h.html#LN128"><span class='Ref_to_Typedef'>PGPing</span></a> 
<a name="LN581"></a><span class='Declare_Function'>PQping</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conninfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN583"></a>    <a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN254"><span class='Ref_to_Proto'>PQconnectStart</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN581"><span class='Ref_to_Parameter'>conninfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN584"></a>    <a href="libpq-fe.h.html#LN128"><span class='Ref_to_Typedef'>PGPing</span></a>      <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN584"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN337"><span class='Ref_to_Proto'>internal_ping</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN583"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="libpq-fe.h.html#LN272"><span class='Ref_to_Proto'>PQfinish</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN583"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN584"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      PQconnectStartParams 
 * 
 * Begins the establishment of a connection to a postgres backend through the 
 * postmaster using connection information in a struct. 
 * 
 * See comment for PQconnectdbParams for the definition of the string format. 
 * 
 * Returns a PGconn*.  If NULL is returned, a malloc error has occurred, and 
 * you should not attempt to proceed with this connection.  If the status 
 * field of the connection returned is CONNECTION_BAD, an error has 
 * occurred. In this case you should call PQfinish on the result, (perhaps 
 * inspecting the error message first).  Other fields of the structure may not 
 * be valid if that occurs.  If the status field is not CONNECTION_BAD, then 
 * this stage has succeeded - call PQconnectPoll, using select(2) to see when 
 * this is necessary. 
 * 
 * See PQconnectPoll for more info. 
 */ 
</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>* 
</span><a name="LN612"></a><span class='Declare_Function'>PQconnectStartParams</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>keywords</span><span class='Delimiter'>, 
</span><a name="LN613"></a>                     <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN614"></a>                     <span class='Keyword'>int </span><span class='Declare_Parameter'>expand_dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN616"></a>    <a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span><a name="LN617"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>connOptions</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate memory for the conn structure 
     */ 
</span>    <a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN338"><span class='Ref_to_Proto'>makeEmptyPGconn</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the conninfo arrays 
     */ 
</span>    <a href="fe-connect.c.html#LN617"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN351"><span class='Ref_to_Proto'>conninfo_array_parse</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN612"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN613"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                       <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN614"><span class='Ref_to_Parameter'>expand_dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN617"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* errorMessage is already set */ 
</span>        <span class='Control'>return</span> <a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Move option values into conn structure 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN339"><span class='Ref_to_Proto'>fillPGconn</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN617"><span class='Ref_To_Local'>connOptions</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN617"><span class='Ref_To_Local'>connOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Free the option info - all is in conn now 
     */ 
</span>    <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN617"><span class='Ref_To_Local'>connOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute derived options 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN334"><span class='Ref_to_Proto'>connectOptions2</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Connect to the database 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN335"><span class='Ref_to_Proto'>connectDBStart</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Just in case we failed to set it in connectDBStart */ 
</span>        <a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN616"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PQconnectStartParams &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      PQconnectStart 
 * 
 * Begins the establishment of a connection to a postgres backend through the 
 * postmaster using connection information in a string. 
 * 
 * See comment for PQconnectdb for the definition of the string format. 
 * 
 * Returns a PGconn*.  If NULL is returned, a malloc error has occurred, and 
 * you should not attempt to proceed with this connection.  If the status 
 * field of the connection returned is CONNECTION_BAD, an error has 
 * occurred. In this case you should call PQfinish on the result, (perhaps 
 * inspecting the error message first).  Other fields of the structure may not 
 * be valid if that occurs.  If the status field is not CONNECTION_BAD, then 
 * this stage has succeeded - call PQconnectPoll, using select(2) to see when 
 * this is necessary. 
 * 
 * See PQconnectPoll for more info. 
 */ 
</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>* 
</span><a name="LN691"></a><span class='Declare_Function'>PQconnectStart</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conninfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN693"></a>    <a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate memory for the conn structure 
     */ 
</span>    <a href="fe-connect.c.html#LN693"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN338"><span class='Ref_to_Proto'>makeEmptyPGconn</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN693"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the conninfo string 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN333"><span class='Ref_to_Proto'>connectOptions1</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN693"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN691"><span class='Ref_to_Parameter'>conninfo</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="fe-connect.c.html#LN693"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute derived options 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN334"><span class='Ref_to_Proto'>connectOptions2</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN693"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="fe-connect.c.html#LN693"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Connect to the database 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN335"><span class='Ref_to_Proto'>connectDBStart</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN693"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Just in case we failed to set it in connectDBStart */ 
</span>        <a href="fe-connect.c.html#LN693"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN693"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PQconnectStart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Move option values into conn structure 
 * 
 * Don't put anything cute here --- intelligence should be in 
 * connectOptions2 ... 
 * 
 * Returns true on success. On failure, returns false and sets error message. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN735"></a><span class='Declare_Function'>fillPGconn</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN737"></a>    <span class='Keyword'>const </span><a href="fe-connect.c.html#LN139"><span class='Ref_to_Typedef'>internalPQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN737"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN161"><span class='Ref_to_Global_Var'>PQconninfoOptions</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN737"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="fe-connect.c.html#LN141"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN737"><span class='Ref_To_Local'>option</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN737"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="fe-connect.c.html#LN158"><span class='Ref_to_Member'>connofs</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN743"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tmp</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN365"><span class='Ref_to_Proto'>conninfo_getval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN735"><span class='Ref_to_Parameter'>connOptions</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN737"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="fe-connect.c.html#LN141"><span class='Ref_to_Member'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN743"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN747"></a>                <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>connmember</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN735"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>+ </span><a href="fe-connect.c.html#LN737"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="fe-connect.c.html#LN158"><span class='Ref_to_Member'>connofs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN747"><span class='Ref_To_Local'>connmember</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN747"><span class='Ref_To_Local'>connmember</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="fe-connect.c.html#LN747"><span class='Ref_To_Local'>connmember</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN743"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN747"><span class='Ref_To_Local'>connmember</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN735"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for option=PQconninfoOpti... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fillPGconn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      connectOptions1 
 * 
 * Internal subroutine to set up connection parameters given an already- 
 * created PGconn and a conninfo string.  Derived settings should be 
 * processed by calling connectOptions2 next.  (We split them because 
 * PQsetdbLogin overrides defaults in between.) 
 * 
 * Returns true if OK, false if trouble (in which case errorMessage is set 
 * and so is conn-&GT;status). 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN777"></a><span class='Declare_Function'>connectOptions1</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conninfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN779"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>connOptions</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the conninfo string 
     */ 
</span>    <a href="fe-connect.c.html#LN779"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN345"><span class='Ref_to_Proto'>parse_connection_string</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN777"><span class='Ref_to_Parameter'>conninfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN777"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN779"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN777"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* errorMessage is already set */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Move option values into conn structure 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN339"><span class='Ref_to_Proto'>fillPGconn</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN777"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN779"><span class='Ref_To_Local'>connOptions</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN777"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>        <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN779"><span class='Ref_To_Local'>connOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Free the option info - all is in conn now 
     */ 
</span>    <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN779"><span class='Ref_To_Local'>connOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end connectOptions1 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      connectOptions2 
 * 
 * Compute derived connection options after absorbing all user-supplied info. 
 * 
 * Returns true if OK, false if trouble (in which case errorMessage is set 
 * and so is conn-&GT;status). 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN819"></a><span class='Declare_Function'>connectOptions2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Allocate memory for details about each host to which we might possibly 
     * try to connect.  If pghostaddr is set, we're only going to try to 
     * connect to that one particular address.  If it's not, we'll use pghost, 
     * which may contain multiple, comma-separated names. 
     */ 
</span>    <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN328"><span class='Ref_to_Member'>pghostaddr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN328"><span class='Ref_to_Member'>pghostaddr</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Operator'>&& </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN832"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN832"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="fe-connect.c.html#LN832"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="fe-connect.c.html#LN832"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN832"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>','</span><span class='Parentheses'>) 
</span>                <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN304"><span class='Ref_to_Struct'>pg_conn_host</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN54"><span class='Ref_to_Macro'>calloc</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN304"><span class='Ref_to_Struct'>pg_conn_host</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1131"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We now have one pg_conn_host structure per possible host.  Fill in the 
     * host details for each one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN328"><span class='Ref_to_Member'>pghostaddr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN328"><span class='Ref_to_Member'>pghostaddr</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN328"><span class='Ref_to_Member'>pghostaddr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1131"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN307"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN295"><span class='Ref_to_EnumConst'>CHT_HOST_ADDRESS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN856"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN857"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN861"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>e</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN857"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Search for the end of the current hostname; a comma or 
             * end-of-string acts as a terminator. 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN861"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN861"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>!= </span><span class='String'>','</span><span class='Parentheses'>) 
</span>                <span class='Operator'>++</span><a href="fe-connect.c.html#LN861"><span class='Ref_To_Local'>e</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Copy the hostname whose bounds we just identified. */ 
</span>            <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN856"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN861"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>- </span><a href="fe-connect.c.html#LN857"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN856"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1131"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN856"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN857"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN861"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>- </span><a href="fe-connect.c.html#LN857"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN856"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN861"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>- </span><a href="fe-connect.c.html#LN857"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Identify the type of host. */ 
</span>            <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN856"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN307"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN294"><span class='Ref_to_EnumConst'>CHT_HOST_NAME</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN76"><span class='Ref_to_Macro'>is_absolute_path</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN856"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Parentheses'>))</span> 
                <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN856"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN307"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN296"><span class='Ref_to_EnumConst'>CHT_UNIX_SOCKET</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
            <span class='Comment_Multi_Line'>/* Prepare to find the next host (if any). */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN861"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN857"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN861"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN856"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while 1 &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;pghost!=NULL&&c... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
        <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="../../include/pg_config_manual.h.html#LN183"><span class='Ref_to_Const'>DEFAULT_PGSOCKET_DIR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN307"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN296"><span class='Ref_to_EnumConst'>CHT_UNIX_SOCKET</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN100"><span class='Ref_to_Const'>DefaultHost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN307"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN294"><span class='Ref_to_EnumConst'>CHT_HOST_NAME</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1131"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Next, work out the port number corresponding to each host name. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN331"><span class='Ref_to_Member'>pgport</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN331"><span class='Ref_to_Member'>pgport</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN910"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN911"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN331"><span class='Ref_to_Member'>pgport</span></a><span class='Delimiter'>; 
</span><a name="LN912"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nports</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN910"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN910"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="fe-connect.c.html#LN910"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN916"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>e</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN911"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Search for the end of the current port number. */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN916"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN916"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>!= </span><span class='String'>','</span><span class='Parentheses'>) 
</span>                <span class='Operator'>++</span><a href="fe-connect.c.html#LN916"><span class='Ref_To_Local'>e</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If we found a port number of non-zero length, copy it. 
             * Otherwise, insert the default port number. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN916"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>&GT; </span><a href="fe-connect.c.html#LN911"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN910"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a> <span class='Operator'>= 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN916"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>- </span><a href="fe-connect.c.html#LN911"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN910"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1131"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>                memcpy<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN910"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN911"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN916"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>- </span><a href="fe-connect.c.html#LN911"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN910"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN916"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>- </span><a href="fe-connect.c.html#LN911"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Move on to the next port number, unless there are no more. (If 
             * only one part number is specified, we reuse it for every host.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN916"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="fe-connect.c.html#LN911"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN916"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Operator'>++</span><a href="fe-connect.c.html#LN912"><span class='Ref_To_Local'>nports</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;conn-&GT;nconnhost... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * If multiple ports were specified, there must be exactly as many 
         * ports as there were hosts.  Otherwise, we do not know how to match 
         * them up. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN912"><span class='Ref_To_Local'>nports</span></a> <span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN912"><span class='Ref_To_Local'>nports</span></a> <span class='Operator'>!= </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not match %d port numbers to %d hosts\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN912"><span class='Ref_To_Local'>nports</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;pgport!=NULL&&c... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If user name was not given, fetch it.  (Most likely, the fetch will 
     * fail, since the only way we get here is if pg_fe_getauthname() failed 
     * during conninfo_add_defaults().  But now we want an error message.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a> <span class='Operator'>= </span><a href="fe-auth.h.html#LN22"><span class='Ref_to_Proto'>pg_fe_getauthname</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If database name was not given, default it to equal user name 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1131"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Supply default password if none given.  Note that the password might be 
     * different for each host/port pair. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN342"><span class='Ref_to_Member'>pgpass</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN342"><span class='Ref_to_Member'>pgpass</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN997"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Identify password file to use; fail if we can't */ 
</span><a name="LN1002"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>homedir</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="libpq-int.h.html#LN546"><span class='Ref_to_Proto'>pqGetHomeDirectory</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1002"><span class='Ref_To_Local'>homedir</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1002"><span class='Ref_To_Local'>homedir</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not get home directory to locate password file\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1131"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1002"><span class='Ref_To_Local'>homedir</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN78"><span class='Ref_to_Const'>PGPASSFILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;pgpassfile==NUL... &raquo; </span> 
 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN997"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN997"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN997"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Try to get a password for this host from pgpassfile. We use 
             * host name rather than host address in the same manner to 
             * PQhost(). 
             */ 
</span><a name="LN1028"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pwhost</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN997"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN997"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN307"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN295"><span class='Ref_to_EnumConst'>CHT_HOST_ADDRESS</span></a> <span class='Operator'>&& 
</span>                <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                <a href="fe-connect.c.html#LN1028"><span class='Ref_To_Local'>pwhost</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>; 
</span> 
            <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN997"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN310"><span class='Ref_to_Member'>password</span></a> <span class='Operator'>= 
</span>                <a href="fe-connect.c.html#LN382"><span class='Ref_to_Proto'>passwordFromFile</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1028"><span class='Ref_To_Local'>pwhost</span></a><span class='Delimiter'>, 
</span>                                 <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN997"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a><span class='Delimiter'>, 
</span>                                 <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Delimiter'>, 
</span>                                 <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Delimiter'>, 
</span>                                 <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* If we got one, set pgpassfile_used */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN997"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN310"><span class='Ref_to_Member'>password</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN408"><span class='Ref_to_Member'>pgpassfile_used</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;conn-&GT;nconnhost... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;pgpass==NULL||c... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * validate sslmode option 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>, </span><span class='String'>"disable"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> 
            <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>, </span><span class='String'>"allow"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> 
            <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>, </span><span class='String'>"prefer"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> 
            <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>, </span><span class='String'>"require"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> 
            <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>, </span><span class='String'>"verify-ca"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> 
            <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>, </span><span class='String'>"verify-full"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                            <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid sslmode value: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/pg_config_manual.h.html#LN172"><span class='Ref_to_Const'>USE_SSL</span></a> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'a'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* "allow" */ 
</span>            <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* "prefer" */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * warn user that an SSL connection will never be negotiated 
                 * since SSL was not compiled in? 
                 */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <span class='String'>'r'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* "require" */ 
</span>            <span class='Control'>case</span> <span class='String'>'v'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* "verify-ca" or "verify-full" */ 
</span>                <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"sslmode value \"%s\" invalid when SSL support is not compiled in\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;sslmode &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN106"><span class='Ref_to_Const'>DefaultSSLMode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1131"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Resolve special "auto" client_encoding from the locale 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a> <span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a><span class='Delimiter'>, </span><span class='String'>"auto"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="../../port/chklocale.c.html#LN309"><span class='Ref_to_Func'>pg_get_encoding_from_locale</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1131"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Validate target_session_attrs option. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN363"><span class='Ref_to_Member'>target_session_attrs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN363"><span class='Ref_to_Member'>target_session_attrs</span></a><span class='Delimiter'>, </span><span class='String'>"any"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> 
            <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN363"><span class='Ref_to_Member'>target_session_attrs</span></a><span class='Delimiter'>, </span><span class='String'>"read-write"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>               <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid target_session_attrs value: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN363"><span class='Ref_to_Member'>target_session_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Only if we get this far is it appropriate to try to connect. (We need a 
     * state flag, rather than just the boolean result of this function, in 
     * case someone tries to PQreset() the PGconn.) 
     */ 
</span>    <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN383"><span class='Ref_to_Member'>options_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<a name="LN1131"></a><span class='Label'>oom_error</span><span class='Operator'>: 
</span>    <a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN819"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end connectOptions2 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      PQconndefaults 
 * 
 * Construct a default connection options array, which identifies all the 
 * available options and shows any default values that are available from the 
 * environment etc.  On error (eg out of memory), NULL is returned. 
 * 
 * Using this function, an application may determine all possible options 
 * and their current default values. 
 * 
 * NOTE: as of PostgreSQL 7.0, the returned array is dynamically allocated 
 * and should be freed when no longer needed via PQconninfoFree().  (In prior 
 * versions, the returned array was static, but that's not thread-safe.) 
 * Pre-7.0 applications that use this function will see a small memory leak 
 * until they are updated to call PQconninfoFree. 
 */ 
</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>* 
</span><a name="LN1155"></a><span class='Declare_Function'>PQconndefaults</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1157"></a>    <a href="pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>errorBuf</span><span class='Delimiter'>; 
</span><a name="LN1158"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>connOptions</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We don't actually report any errors here, but callees want a buffer */ 
</span>    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1157"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN66"><span class='Ref_to_Macro'>PQExpBufferDataBroken</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1157"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* out of memory already :-( */ 
</span> 
    <a href="fe-connect.c.html#LN1158"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN344"><span class='Ref_to_Proto'>conninfo_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1157"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1158"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* pass NULL errorBuf to ignore errors */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN354"><span class='Ref_to_Proto'>conninfo_add_defaults</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1158"><span class='Ref_To_Local'>connOptions</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1158"><span class='Ref_To_Local'>connOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN1158"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1157"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN1158"><span class='Ref_To_Local'>connOptions</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PQconndefaults &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      PQsetdbLogin 
 * 
 * establishes a connection to a postgres backend through the postmaster 
 * at the specified host and port. 
 * 
 * returns a PGconn* which is needed for all subsequent libpq calls 
 * 
 * if the status field of the connection returned is CONNECTION_BAD, 
 * then only the errorMessage is likely to be useful. 
 * ---------------- 
 */ 
</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>* 
</span><a name="LN1193"></a><span class='Declare_Function'>PQsetdbLogin</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pghost</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pgport</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pgoptions</span><span class='Delimiter'>, 
</span><a name="LN1194"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pgtty</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbName</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>login</span><span class='Delimiter'>, 
</span><a name="LN1195"></a>             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pwd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1197"></a>    <a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate memory for the conn structure 
     */ 
</span>    <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN338"><span class='Ref_to_Proto'>makeEmptyPGconn</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the dbName parameter contains what looks like a connection string, 
     * parse it into conn struct using connectOptions1. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>dbName</span></a> <span class='Operator'>&& </span><a href="../../bin/psql/common.h.html#LN46"><span class='Ref_to_Proto'>recognized_connection_string</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>dbName</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN333"><span class='Ref_to_Proto'>connectOptions1</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>dbName</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Old-style path: first, parse an empty conninfo string in order to 
         * set up the same defaults that PQconnectdb() would use. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN333"><span class='Ref_to_Proto'>connectOptions1</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Insert dbName parameter value into struct */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>dbName</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>dbName</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1307"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert remaining parameters into struct, overriding defaults (as well 
     * as any conflicting data from dbName taken as a conninfo). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1193"><span class='Ref_to_Parameter'>pghost</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1193"><span class='Ref_to_Parameter'>pghost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1193"><span class='Ref_to_Parameter'>pghost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1307"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1193"><span class='Ref_to_Parameter'>pgport</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1193"><span class='Ref_to_Parameter'>pgport</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN331"><span class='Ref_to_Member'>pgport</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN331"><span class='Ref_to_Member'>pgport</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN331"><span class='Ref_to_Member'>pgport</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1193"><span class='Ref_to_Parameter'>pgport</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN331"><span class='Ref_to_Member'>pgport</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1307"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1193"><span class='Ref_to_Parameter'>pgoptions</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1193"><span class='Ref_to_Parameter'>pgoptions</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1193"><span class='Ref_to_Parameter'>pgoptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1307"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>pgtty</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>pgtty</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN332"><span class='Ref_to_Member'>pgtty</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN332"><span class='Ref_to_Member'>pgtty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN332"><span class='Ref_to_Member'>pgtty</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>pgtty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN332"><span class='Ref_to_Member'>pgtty</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1307"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>login</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>login</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1194"><span class='Ref_to_Parameter'>login</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1307"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1195"><span class='Ref_to_Parameter'>pwd</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1195"><span class='Ref_to_Parameter'>pwd</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN342"><span class='Ref_to_Member'>pgpass</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN342"><span class='Ref_to_Member'>pgpass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN342"><span class='Ref_to_Member'>pgpass</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1195"><span class='Ref_to_Parameter'>pwd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN342"><span class='Ref_to_Member'>pgpass</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1307"><span class='Ref_to_Label'>oom_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute derived options 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN334"><span class='Ref_to_Proto'>connectOptions2</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Connect to the database 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN335"><span class='Ref_to_Proto'>connectDBStart</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN336"><span class='Ref_to_Proto'>connectDBComplete</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span> 
<a name="LN1307"></a><span class='Label'>oom_error</span><span class='Operator'>: 
</span>    <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN1197"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PQsetdbLogin &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * connectNoDelay - 
 * Sets the TCP_NODELAY socket option. 
 * Returns 1 if successful, 0 if not. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1322"></a><span class='Declare_Function'>connectNoDelay</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span>  TCP_NODELAY 
<a name="LN1325"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>on</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>setsockopt<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1322"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, </span>IPPROTO_TCP<span class='Delimiter'>, </span>TCP_NODELAY<span class='Delimiter'>, 
</span>                   <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1325"><span class='Ref_To_Local'>on</span></a><span class='Delimiter'>, 
</span>                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1325"><span class='Ref_To_Local'>on</span></a><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1331"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>sebuf</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span> 
        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1322"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>            <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not set socket to TCP no delay mode: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1331"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1331"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end connectNoDelay &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * connectFailureMessage - 
 * create a friendly error message on connection failure. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1350"></a><span class='Declare_Function'>connectFailureMessage</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>errorno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1352"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sebuf</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/common/ip.h.html#LN21"><span class='Ref_to_Macro'>IS_AF_UNIX</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN402"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1357"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>service</span><span class='Delimiter'>[</span><a href="../../include/getaddrinfo.h.html#LN87"><span class='Ref_to_Const'>NI_MAXHOST</span></a><span class='Delimiter'>]; 
</span> 
        <a href="../../include/common/ip.h.html#LN31"><span class='Ref_to_Proto'>pg_getnameinfo_all</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN402"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN402"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN64"><span class='Ref_to_Member'>salen</span></a><span class='Delimiter'>, 
</span>                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                           <a href="fe-connect.c.html#LN1357"><span class='Ref_To_Local'>service</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1357"><span class='Ref_To_Local'>service</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../include/getaddrinfo.h.html#LN80"><span class='Ref_to_Const'>NI_NUMERICSERV</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not connect to server: %s\n"</span> 
                            <span class='String'>"\tIs the server running locally and accepting\n"</span> 
                            <span class='String'>"\tconnections on Unix domain socket \"%s\"?\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>errorno</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1352"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1352"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                          <a href="fe-connect.c.html#LN1357"><span class='Ref_To_Local'>service</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_UNIX_SOCKETS */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1373"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>host_addr</span><span class='Delimiter'>[</span><a href="../../include/getaddrinfo.h.html#LN87"><span class='Ref_to_Const'>NI_MAXHOST</span></a><span class='Delimiter'>]; 
</span><a name="LN1374"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>displayed_host</span><span class='Delimiter'>; 
</span><a name="LN1375"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>displayed_port</span><span class='Delimiter'>; 
</span><a name="LN1376"></a>        <span class='Control'>struct</span> <a href="../../include/libpq/pqcomm.h.html#LN43"><span class='Ref_to_Struct'>sockaddr_storage</span></a> <span class='Operator'>*</span><span class='Declare_Local'>addr</span> <span class='Operator'>= &</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN402"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Optionally display the network address with the hostname. This is 
         * useful to distinguish between IPv4 and IPv6 connections. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN328"><span class='Ref_to_Member'>pghostaddr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1373"><span class='Ref_To_Local'>host_addr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN328"><span class='Ref_to_Member'>pghostaddr</span></a><span class='Delimiter'>, </span><a href="../../include/getaddrinfo.h.html#LN87"><span class='Ref_to_Const'>NI_MAXHOST</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1376"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>-&GT;</span>ss_family <span class='Operator'>== </span>AF_INET<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/inet_net_ntop.c.html#LN75"><span class='Ref_to_Func'>inet_net_ntop</span></a><span class='Parentheses'>(</span>AF_INET<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><span class='Parentheses'>((</span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN1376"><span class='Ref_To_Local'>addr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>sin_addr<span class='Operator'>.</span>s_addr<span class='Delimiter'>, 
</span>                              <span class='Number'>32</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN1373"><span class='Ref_To_Local'>host_addr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1373"><span class='Ref_To_Local'>host_addr</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1373"><span class='Ref_To_Local'>host_addr</span></a><span class='Delimiter'>, </span><span class='String'>"???"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#ifdef</span> HAVE_IPV6 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1376"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>-&GT;</span>ss_family <span class='Operator'>== </span>AF_INET6<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/inet_net_ntop.c.html#LN75"><span class='Ref_to_Func'>inet_net_ntop</span></a><span class='Parentheses'>(</span>AF_INET6<span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><span class='Parentheses'>((</span><span class='Control'>struct</span> sockaddr_in6 <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN1376"><span class='Ref_To_Local'>addr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>sin6_addr<span class='Operator'>.</span>s6_addr<span class='Delimiter'>, 
</span>                              <span class='Number'>128</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN1373"><span class='Ref_To_Local'>host_addr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1373"><span class='Ref_To_Local'>host_addr</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1373"><span class='Ref_To_Local'>host_addr</span></a><span class='Delimiter'>, </span><span class='String'>"???"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>else</span> 
            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1373"><span class='Ref_To_Local'>host_addr</span></a><span class='Delimiter'>, </span><span class='String'>"???"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* To which host and port were we actually connecting? */ 
</span>        <a href="fe-connect.c.html#LN1374"><span class='Ref_To_Local'>displayed_host</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN1375"><span class='Ref_To_Local'>displayed_port</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1375"><span class='Ref_To_Local'>displayed_port</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="fe-connect.c.html#LN1375"><span class='Ref_To_Local'>displayed_port</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <a href="fe-connect.c.html#LN1375"><span class='Ref_To_Local'>displayed_port</span></a> <span class='Operator'>= </span>DEF_PGPORT_STR<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the user did not supply an IP address using 'hostaddr', and 
         * 'host' was missing or does not match our lookup, display the 
         * looked-up IP address. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN328"><span class='Ref_to_Member'>pghostaddr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1373"><span class='Ref_To_Local'>host_addr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                            <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not connect to server: %s\n"</span> 
                <span class='String'>"\tIs the server running on host \"%s\" (%s) and accepting\n"</span> 
                                       <span class='String'>"\tTCP/IP connections on port %s?\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>errorno</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1352"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1352"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN1374"><span class='Ref_To_Local'>displayed_host</span></a><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN1373"><span class='Ref_To_Local'>host_addr</span></a><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN1375"><span class='Ref_To_Local'>displayed_port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                            <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not connect to server: %s\n"</span> 
                     <span class='String'>"\tIs the server running on host \"%s\" and accepting\n"</span> 
                                       <span class='String'>"\tTCP/IP connections on port %s?\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1350"><span class='Ref_to_Parameter'>errorno</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1352"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1352"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN1374"><span class='Ref_To_Local'>displayed_host</span></a><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN1375"><span class='Ref_To_Local'>displayed_port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end connectFailureMessage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Should we use keepalives?  Returns 1 if yes, 0 if no, and -1 if 
 * conn-&GT;keepalives is set to a value which is not parseable as an 
 * integer. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1443"></a><span class='Declare_Function'>useKeepalives</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1445"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ep</span><span class='Delimiter'>; 
</span><a name="LN1446"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1443"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN344"><span class='Ref_to_Member'>keepalives</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN1446"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1443"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN344"><span class='Ref_to_Member'>keepalives</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1445"><span class='Ref_To_Local'>ep</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN1445"><span class='Ref_To_Local'>ep</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN1446"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Comment_Multi_Line'>/* 
 * Set the keepalive idle timer. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1461"></a><span class='Declare_Function'>setKeepalivesIdle</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1463"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>idle</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1461"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN345"><span class='Ref_to_Member'>keepalives_idle</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN1463"><span class='Ref_To_Local'>idle</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1461"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN345"><span class='Ref_to_Member'>keepalives_idle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1463"><span class='Ref_To_Local'>idle</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN1463"><span class='Ref_To_Local'>idle</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> TCP_KEEPIDLE 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>setsockopt<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1461"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, </span>IPPROTO_TCP<span class='Delimiter'>, </span>TCP_KEEPIDLE<span class='Delimiter'>, 
</span>                   <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1463"><span class='Ref_To_Local'>idle</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1463"><span class='Ref_To_Local'>idle</span></a><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1476"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>sebuf</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span> 
        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1461"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"setsockopt(TCP_KEEPIDLE) failed: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1476"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1476"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#else</span> 
<span class='Directive'>#ifdef</span> TCP_KEEPALIVE 
    <span class='Comment_Multi_Line'>/* macOS uses TCP_KEEPALIVE rather than TCP_KEEPIDLE */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>setsockopt<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1461"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, </span>IPPROTO_TCP<span class='Delimiter'>, </span>TCP_KEEPALIVE<span class='Delimiter'>, 
</span>                   <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1463"><span class='Ref_To_Local'>idle</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1463"><span class='Ref_To_Local'>idle</span></a><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1489"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>sebuf</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span> 
        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1461"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                     <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"setsockopt(TCP_KEEPALIVE) failed: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1489"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1489"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setKeepalivesIdle &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Set the keepalive interval. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1506"></a><span class='Declare_Function'>setKeepalivesInterval</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1508"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>interval</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1506"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN346"><span class='Ref_to_Member'>keepalives_interval</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN1508"><span class='Ref_To_Local'>interval</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1506"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN346"><span class='Ref_to_Member'>keepalives_interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1508"><span class='Ref_To_Local'>interval</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN1508"><span class='Ref_To_Local'>interval</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> TCP_KEEPINTVL 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>setsockopt<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1506"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, </span>IPPROTO_TCP<span class='Delimiter'>, </span>TCP_KEEPINTVL<span class='Delimiter'>, 
</span>                   <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1508"><span class='Ref_To_Local'>interval</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1508"><span class='Ref_To_Local'>interval</span></a><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1521"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>sebuf</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span> 
        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1506"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                     <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"setsockopt(TCP_KEEPINTVL) failed: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1521"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1521"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setKeepalivesInterval &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Set the count of lost keepalive packets that will trigger a connection 
 * break. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1538"></a><span class='Declare_Function'>setKeepalivesCount</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1540"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1538"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN348"><span class='Ref_to_Member'>keepalives_count</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN1540"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1538"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN348"><span class='Ref_to_Member'>keepalives_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1540"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN1540"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> TCP_KEEPCNT 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>setsockopt<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1538"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, </span>IPPROTO_TCP<span class='Delimiter'>, </span>TCP_KEEPCNT<span class='Delimiter'>, 
</span>                   <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1540"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1540"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1553"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>sebuf</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span> 
        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1538"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                       <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"setsockopt(TCP_KEEPCNT) failed: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1553"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1553"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setKeepalivesCount &raquo; </span> 
<span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* Win32 */ 
</span><span class='Directive'>#ifdef</span> SIO_KEEPALIVE_VALS 
<span class='Comment_Multi_Line'>/* 
 * Enable keepalives and set the keepalive values on Win32, 
 * where they are always set in one batch. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1571"></a><span class='Declare_Function'>setKeepalivesWin32</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1573"></a>    <span class='Control'>struct</span> tcp_keepalive <span class='Declare_Local'>ka</span><span class='Delimiter'>; 
</span><a name="LN1574"></a>    <span class='Keyword'>DWORD</span>       <span class='Declare_Local'>retsize</span><span class='Delimiter'>; 
</span><a name="LN1575"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>idle</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1576"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>interval</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1571"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN345"><span class='Ref_to_Member'>keepalives_idle</span></a><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN1575"><span class='Ref_To_Local'>idle</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1571"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN345"><span class='Ref_to_Member'>keepalives_idle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1575"><span class='Ref_To_Local'>idle</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN1575"><span class='Ref_To_Local'>idle</span></a> <span class='Operator'>= </span><span class='Number'>2</span> <span class='Operator'>* </span><span class='Number'>60</span> <span class='Operator'>* </span><span class='Number'>60</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* 2 hours = default */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1571"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN346"><span class='Ref_to_Member'>keepalives_interval</span></a><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN1576"><span class='Ref_To_Local'>interval</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1571"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN346"><span class='Ref_to_Member'>keepalives_interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1576"><span class='Ref_To_Local'>interval</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN1576"><span class='Ref_To_Local'>interval</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* 1 second = default */ 
</span> 
    <a href="fe-connect.c.html#LN1573"><span class='Ref_To_Local'>ka</span></a><span class='Operator'>.</span>onoff <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN1573"><span class='Ref_To_Local'>ka</span></a><span class='Operator'>.</span>keepalivetime <span class='Operator'>= </span><a href="fe-connect.c.html#LN1575"><span class='Ref_To_Local'>idle</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN1573"><span class='Ref_To_Local'>ka</span></a><span class='Operator'>.</span>keepaliveinterval <span class='Operator'>= </span><a href="fe-connect.c.html#LN1576"><span class='Ref_To_Local'>interval</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>WSAIoctl<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1571"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, 
</span>                 SIO_KEEPALIVE_VALS<span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span>LPVOID<span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1573"><span class='Ref_To_Local'>ka</span></a><span class='Delimiter'>, 
</span>                 <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1573"><span class='Ref_To_Local'>ka</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                 <span class='Number'>0</span><span class='Delimiter'>, 
</span>                 <span class='Operator'>&</span><a href="fe-connect.c.html#LN1574"><span class='Ref_To_Local'>retsize</span></a><span class='Delimiter'>, 
</span>                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                 <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1571"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                 <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"WSAIoctl(SIO_KEEPALIVE_VALS) failed: %ui\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          WSAGetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setKeepalivesWin32 &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* SIO_KEEPALIVE_VALS */ 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * connectDBStart - 
 *      Begin the process of making a connection to the backend. 
 * 
 * Returns 1 if successful, 0 if not. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1621"></a><span class='Declare_Function'>connectDBStart</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1623"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>portstr</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN1624"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN1625"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN383"><span class='Ref_to_Member'>options_valid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1759"><span class='Ref_to_Label'>connect_errReturn</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ensure our buffers are empty */ 
</span>    <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN438"><span class='Ref_to_Member'>outCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up socket addresses for each possible host using 
     * pg_getaddrinfo_all. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1625"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN1625"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="fe-connect.c.html#LN1625"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1643"></a>        <a href="libpq-int.h.html#LN304"><span class='Ref_to_Struct'>pg_conn_host</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ch</span> <span class='Operator'>= &</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN1625"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN1644"></a>        <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Declare_Local'>hint</span><span class='Delimiter'>; 
</span><a name="LN1645"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>thisport</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Initialize hint structure */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1644"><span class='Ref_To_Local'>hint</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1644"><span class='Ref_To_Local'>hint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN1644"><span class='Ref_To_Local'>hint</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN101"><span class='Ref_to_Member'>ai_socktype</span></a> <span class='Operator'>= </span>SOCK_STREAM<span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN1644"><span class='Ref_To_Local'>hint</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a> <span class='Operator'>= </span>AF_UNSPEC<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Figure out the port number we're going to use. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="fe-connect.c.html#LN1645"><span class='Ref_To_Local'>thisport</span></a> <span class='Operator'>= </span>DEF_PGPORT<span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN1645"><span class='Ref_To_Local'>thisport</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1645"><span class='Ref_To_Local'>thisport</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN1645"><span class='Ref_To_Local'>thisport</span></a> <span class='Operator'>&GT; </span><span class='Number'>65535</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid port number: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN383"><span class='Ref_to_Member'>options_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1759"><span class='Ref_to_Label'>connect_errReturn</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1623"><span class='Ref_To_Local'>portstr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1623"><span class='Ref_To_Local'>portstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1645"><span class='Ref_To_Local'>thisport</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Use pg_getaddrinfo_all() to resolve the address */ 
</span>        <a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN307"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="libpq-int.h.html#LN294"><span class='Ref_to_EnumConst'>CHT_HOST_NAME</span></a><span class='Operator'>: 
</span>                <a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/common/ip.h.html#LN26"><span class='Ref_to_Proto'>pg_getaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1623"><span class='Ref_To_Local'>portstr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1644"><span class='Ref_To_Local'>hint</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>|| !</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Parentheses'>) 
</span>                    <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not translate host name \"%s\" to address: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>, </span><a href="../../include/getaddrinfo.h.html#LN155"><span class='Ref_to_Proto'>gai_strerror</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="libpq-int.h.html#LN295"><span class='Ref_to_EnumConst'>CHT_HOST_ADDRESS</span></a><span class='Operator'>: 
</span>                <a href="fe-connect.c.html#LN1644"><span class='Ref_To_Local'>hint</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN99"><span class='Ref_to_Member'>ai_flags</span></a> <span class='Operator'>= </span><a href="../../include/getaddrinfo.h.html#LN70"><span class='Ref_to_Const'>AI_NUMERICHOST</span></a><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/common/ip.h.html#LN26"><span class='Ref_to_Proto'>pg_getaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1623"><span class='Ref_To_Local'>portstr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1644"><span class='Ref_To_Local'>hint</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>|| !</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Parentheses'>) 
</span>                    <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not parse network address \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>, </span><a href="../../include/getaddrinfo.h.html#LN155"><span class='Ref_to_Proto'>gai_strerror</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="libpq-int.h.html#LN296"><span class='Ref_to_EnumConst'>CHT_UNIX_SOCKET</span></a><span class='Operator'>: 
</span><span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
                <a href="fe-connect.c.html#LN1644"><span class='Ref_To_Local'>hint</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a> <span class='Operator'>= </span>AF_UNIX<span class='Delimiter'>; 
</span>                <a href="../../include/libpq/pqcomm.h.html#LN69"><span class='Ref_to_Macro'>UNIXSOCK_PATH</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1623"><span class='Ref_To_Local'>portstr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1645"><span class='Ref_To_Local'>thisport</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1623"><span class='Ref_To_Local'>portstr</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../include/libpq/pqcomm.h.html#LN85"><span class='Ref_to_Const'>UNIXSOCK_PATH_BUFLEN</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"Unix-domain socket path \"%s\" is too long (maximum %d bytes)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN1623"><span class='Ref_To_Local'>portstr</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="../../include/libpq/pqcomm.h.html#LN85"><span class='Ref_to_Const'>UNIXSOCK_PATH_BUFLEN</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN383"><span class='Ref_to_Member'>options_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1759"><span class='Ref_to_Label'>connect_errReturn</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * NULL hostname tells pg_getaddrinfo_all to parse the service 
                 * name as a Unix-domain socket path. 
                 */ 
</span>                <a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/common/ip.h.html#LN26"><span class='Ref_to_Proto'>pg_getaddrinfo_all</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1623"><span class='Ref_To_Local'>portstr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1644"><span class='Ref_To_Local'>hint</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>|| !</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Parentheses'>) 
</span>                    <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not translate Unix-domain socket path \"%s\" to address: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN1623"><span class='Ref_To_Local'>portstr</span></a><span class='Delimiter'>, </span><a href="../../include/getaddrinfo.h.html#LN155"><span class='Ref_to_Proto'>gai_strerror</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN383"><span class='Ref_to_Member'>options_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1759"><span class='Ref_to_Label'>connect_errReturn</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ch-&GT;type &raquo; </span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1624"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>|| !</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/common/ip.h.html#LN29"><span class='Ref_to_Proto'>pg_freeaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1644"><span class='Ref_To_Local'>hint</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN1643"><span class='Ref_To_Local'>ch</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN383"><span class='Ref_to_Member'>options_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN1759"><span class='Ref_to_Label'>connect_errReturn</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;conn-&GT;nconnhost... &raquo; </span> 
 
<span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN172"><span class='Ref_to_Const'>USE_SSL</span></a> 
    <span class='Comment_Multi_Line'>/* setup values based on SSL mode */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'d'</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* "disable" */ 
</span>        <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN457"><span class='Ref_to_Member'>allow_ssl_try</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'a'</span><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* "allow" */ 
</span>        <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN458"><span class='Ref_to_Member'>wait_ssl_try</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set up to try to connect, with protocol 3.0 as the first attempt. 
     */ 
</span>    <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqcomm.h.html#LN105"><span class='Ref_to_Macro'>PG_PROTOCOL</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN416"><span class='Ref_to_Member'>send_appname</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The code for processing CONNECTION_NEEDED state is in PQconnectPoll(), 
     * so that it can easily be re-executed if needed again during the 
     * asynchronous startup process.  However, we must run it once here, 
     * because callers expect a success return from this routine to mean that 
     * we are in PGRES_POLLING_WRITING connection state. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN257"><span class='Ref_to_Proto'>PQconnectPoll</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="libpq-fe.h.html#LN75"><span class='Ref_to_EnumConst'>PGRES_POLLING_WRITING</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
<a name="LN1759"></a><span class='Label'>connect_errReturn</span><span class='Operator'>: 
</span>    <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN1621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end connectDBStart &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *      connectDBComplete 
 * 
 * Block and complete a connection. 
 * 
 * Returns 1 on success, 0 on failure. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1774"></a><span class='Declare_Function'>connectDBComplete</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1776"></a>    <a href="libpq-fe.h.html#LN71"><span class='Ref_to_Typedef'>PostgresPollingStatusType</span></a> <span class='Declare_Local'>flag</span> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN75"><span class='Ref_to_EnumConst'>PGRES_POLLING_WRITING</span></a><span class='Delimiter'>; 
</span><a name="LN1777"></a>    time_t      <span class='Declare_Local'>finish_time</span> <span class='Operator'>= </span><span class='Parentheses'>((</span>time_t<span class='Parentheses'>) </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1778"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>timeout</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up a time limit, if connect_timeout isn't zero. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN334"><span class='Ref_to_Member'>connect_timeout</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN1778"><span class='Ref_To_Local'>timeout</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN334"><span class='Ref_to_Member'>connect_timeout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1778"><span class='Ref_To_Local'>timeout</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Rounding could cause connection to fail; need at least 2 secs 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1778"><span class='Ref_To_Local'>timeout</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>                <a href="fe-connect.c.html#LN1778"><span class='Ref_To_Local'>timeout</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* calculate the finish time based on start + timeout */ 
</span>            <a href="fe-connect.c.html#LN1777"><span class='Ref_To_Local'>finish_time</span></a> <span class='Operator'>= </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="fe-connect.c.html#LN1778"><span class='Ref_To_Local'>timeout</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1803"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Wait, if necessary.  Note that the initial state (just after 
         * PQconnectStart) is to wait for the socket to select for writing. 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1776"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="libpq-fe.h.html#LN76"><span class='Ref_to_EnumConst'>PGRES_POLLING_OK</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Reset stored error messages since we now have a working 
                 * connection 
                 */ 
</span>                <a href="pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* success! */ 
</span> 
            <span class='Control'>case</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Operator'>: 
</span>                <a href="fe-connect.c.html#LN1803"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN639"><span class='Ref_to_Proto'>pqWaitTimed</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1777"><span class='Ref_To_Local'>finish_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1803"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="libpq-fe.h.html#LN75"><span class='Ref_to_EnumConst'>PGRES_POLLING_WRITING</span></a><span class='Operator'>: 
</span>                <a href="fe-connect.c.html#LN1803"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN639"><span class='Ref_to_Proto'>pqWaitTimed</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1777"><span class='Ref_To_Local'>finish_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1803"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Just in case we failed to set it in PQconnectPoll */ 
</span>                <a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch flag &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1803"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span>           <span class='Comment_Single_Line'>/* connect_timeout elapsed */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If there are no more hosts, return (the error message is 
             * already set) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a> <span class='Operator'>&GT;= </span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Attempt connection to the next host, starting the 
             * connect_timeout timer 
             */ 
</span>            <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN334"><span class='Ref_to_Member'>connect_timeout</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="fe-connect.c.html#LN1777"><span class='Ref_To_Local'>finish_time</span></a> <span class='Operator'>= </span>time<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="fe-connect.c.html#LN1778"><span class='Ref_To_Local'>timeout</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ret==1 &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Now try to advance the state machine. 
         */ 
</span>        <a href="fe-connect.c.html#LN1776"><span class='Ref_To_Local'>flag</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN257"><span class='Ref_to_Proto'>PQconnectPoll</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1774"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end connectDBComplete &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This subroutine saves conn-&GT;errorMessage, which will be restored back by 
 * restoreErrorMessage subroutine. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1880"></a><span class='Declare_Function'>saveErrorMessage</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>savedMessage</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1880"><span class='Ref_to_Parameter'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN58"><span class='Ref_to_Macro'>PQExpBufferBroken</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1880"><span class='Ref_to_Parameter'>savedMessage</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1880"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1880"><span class='Ref_to_Parameter'>savedMessage</span></a><span class='Delimiter'>, 
</span>                         <a href="fe-connect.c.html#LN1880"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1880"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Restores saved error messages back to conn-&GT;errorMessage. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1900"></a><span class='Declare_Function'>restoreErrorMessage</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>savedMessage</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1900"><span class='Ref_to_Parameter'>savedMessage</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1900"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1900"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1900"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1900"><span class='Ref_to_Parameter'>savedMessage</span></a><span class='Operator'>-&GT;</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1900"><span class='Ref_to_Parameter'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      PQconnectPoll 
 * 
 * Poll an asynchronous connection. 
 * 
 * Returns a PostgresPollingStatusType. 
 * Before calling this function, use select(2) to determine when data 
 * has arrived.. 
 * 
 * You must call PQfinish whether or not this fails. 
 * 
 * This function and PQconnectStart are intended to allow connections to be 
 * made without blocking the execution of your program on remote I/O. However, 
 * there are a number of caveats: 
 * 
 *   o  If you call PQtrace, ensure that the stream object into which you trace 
 *      will not block. 
 *   o  If you do not supply an IP address for the remote host (i.e. you 
 *      supply a host name instead) then PQconnectStart will block on 
 *      gethostbyname.  You will be fine if using Unix sockets (i.e. by 
 *      supplying neither a host name nor a host address). 
 *   o  If your backend wants to use Kerberos authentication then you must 
 *      supply both a host name and a host address, otherwise this function 
 *      may block on gethostname. 
 * 
 * ---------------- 
 */ 
</span><a href="libpq-fe.h.html#LN71"><span class='Ref_to_Typedef'>PostgresPollingStatusType</span></a> 
<a name="LN1936"></a><span class='Declare_Function'>PQconnectPoll</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1938"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1939"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sebuf</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span><a name="LN1940"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>optval</span><span class='Delimiter'>; 
</span><a name="LN1941"></a>    <a href="pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>savedMessage</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN73"><span class='Ref_to_EnumConst'>PGRES_POLLING_FAILED</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the new data */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We really shouldn't have been polled in these two cases, but we 
             * can handle it. 
             */ 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="libpq-fe.h.html#LN73"><span class='Ref_to_EnumConst'>PGRES_POLLING_FAILED</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="libpq-fe.h.html#LN76"><span class='Ref_to_EnumConst'>PGRES_POLLING_OK</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* These are reading states */ 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN58"><span class='Ref_to_EnumConst'>CONNECTION_AWAITING_RESPONSE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN60"><span class='Ref_to_EnumConst'>CONNECTION_AUTH_OK</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Load waiting data */ 
</span><a name="LN1963"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="fe-misc.c.html#LN629"><span class='Ref_to_Func'>pqReadData</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1963"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1963"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* These are writing states, so we just proceed. */ 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN56"><span class='Ref_to_EnumConst'>CONNECTION_STARTED</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN57"><span class='Ref_to_EnumConst'>CONNECTION_MADE</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* We allow pqSetenvPoll to decide whether to proceed. */ 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN62"><span class='Ref_to_EnumConst'>CONNECTION_SETENV</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Special cases: proceed without waiting. */ 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN63"><span class='Ref_to_EnumConst'>CONNECTION_SSL_STARTUP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN65"><span class='Ref_to_EnumConst'>CONNECTION_CHECK_WRITABLE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN67"><span class='Ref_to_EnumConst'>CONNECTION_CONSUME</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                 <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>                                               <span class='String'>"invalid connection state, "</span> 
                                 <span class='String'>"probably indicative of memory corruption\n"</span> 
                                               <span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch conn-&GT;status &raquo; </span> 
 
 
<a name="LN1999"></a><span class='Label'>keep_going</span><span class='Operator'>:</span>                     <span class='Comment_Multi_Line'>/* We will come back to here until there is 
                                 * nothing left to do. */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Try to initiate a connection to one of the addresses 
                 * returned by pg_getaddrinfo_all().  conn-&GT;addr_cur is the 
                 * next one to try. We fail when we run out of addresses. 
                 */ 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2012"></a>                    <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>addr_cur</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Advance to next possible host, if we've tried all of 
                     * the addresses for the current host. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a> <span class='Operator'>&GT;= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* Remember current address for possible error msg */ 
</span>                    <a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a><span class='Delimiter'>; 
</span>                    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN402"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Delimiter'>, 
</span>                           <a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN103"><span class='Ref_to_Member'>ai_addrlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN402"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN64"><span class='Ref_to_Member'>salen</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN103"><span class='Ref_to_Member'>ai_addrlen</span></a><span class='Delimiter'>; 
</span> 
                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN368"><span class='Ref_to_Macro'>socket</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a><span class='Delimiter'>, </span>SOCK_STREAM<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>== </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * ignore socket() failure if we have more addresses 
                         * to try 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not create socket: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Select socket options: no delay of outgoing data for 
                     * TCP sockets, nonblock mode, close-on-exec. Fail if any 
                     * of this fails. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/common/ip.h.html#LN21"><span class='Ref_to_Macro'>IS_AF_UNIX</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1321"><span class='Ref_to_Func'>connectNoDelay</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../port/noblock.c.html#LN23"><span class='Ref_to_Func'>pg_set_noblock</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not set socket to nonblocking mode: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> F_SETFD 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span>fcntl<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, </span>F_SETFD<span class='Delimiter'>, </span>FD_CLOEXEC<span class='Parentheses'>) </span><span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not set socket to close-on-exec mode: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* F_SETFD */ 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/common/ip.h.html#LN21"><span class='Ref_to_Macro'>IS_AF_UNIX</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN2093"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>on</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN2095"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>usekeepalives</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1442"><span class='Ref_to_Func'>useKeepalives</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2096"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>err</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2095"><span class='Ref_To_Local'>usekeepalives</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                                 <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"keepalives parameter must be an integer\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                            <a href="fe-connect.c.html#LN2096"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2095"><span class='Ref_To_Local'>usekeepalives</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* Do nothing */ 
</span>                        <span class='Delimiter'>} 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>setsockopt<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, 
</span>                                            SOL_SOCKET<span class='Delimiter'>, </span>SO_KEEPALIVE<span class='Delimiter'>, 
</span>                                            <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2093"><span class='Ref_To_Local'>on</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2093"><span class='Ref_To_Local'>on</span></a><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"setsockopt(SO_KEEPALIVE) failed: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                            <a href="fe-connect.c.html#LN2096"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1460"><span class='Ref_to_Func'>setKeepalivesIdle</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>                                 <span class='Operator'>|| !</span><a href="fe-connect.c.html#LN1505"><span class='Ref_to_Func'>setKeepalivesInterval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>                                 <span class='Operator'>|| !</span><a href="fe-connect.c.html#LN1537"><span class='Ref_to_Func'>setKeepalivesCount</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                            <a href="fe-connect.c.html#LN2096"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* WIN32 */ 
</span><span class='Directive'>#ifdef</span> SIO_KEEPALIVE_VALS 
                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1570"><span class='Ref_to_Func'>setKeepalivesWin32</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                            <a href="fe-connect.c.html#LN2096"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* SIO_KEEPALIVE_VALS */ 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2096"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !IS_AF_UNIX(addr_cur-... &raquo; </span> 
 
                    <span class='Comment_Multi_Line'>/*---------- 
                     * We have three methods of blocking SIGPIPE during 
                     * send() calls to this socket: 
                     * 
                     *  - setsockopt(sock, SO_NOSIGPIPE) 
                     *  - send(sock, ..., MSG_NOSIGNAL) 
                     *  - setting the signal mask to SIG_IGN during send() 
                     * 
                     * The third method requires three syscalls per send, 
                     * so we prefer either of the first two, but they are 
                     * less portable.  The state is tracked in the following 
                     * members of PGconn: 
                     * 
                     * conn-&GT;sigpipe_so     - we have set up SO_NOSIGPIPE 
                     * conn-&GT;sigpipe_flag   - we're specifying MSG_NOSIGNAL 
                     * 
                     * If we can use SO_NOSIGPIPE, then set sigpipe_so here 
                     * and we're done.  Otherwise, set sigpipe_flag so that 
                     * we will try MSG_NOSIGNAL on sends.  If we get an error 
                     * with MSG_NOSIGNAL, we'll clear that flag and revert to 
                     * signal masking. 
                     *---------- 
                     */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN409"><span class='Ref_to_Member'>sigpipe_so</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> MSG_NOSIGNAL 
                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN410"><span class='Ref_to_Member'>sigpipe_flag</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN410"><span class='Ref_to_Member'>sigpipe_flag</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* MSG_NOSIGNAL */ 
</span> 
<span class='Directive'>#ifdef</span> SO_NOSIGPIPE 
                    <a href="fe-connect.c.html#LN1940"><span class='Ref_To_Local'>optval</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>setsockopt<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, </span>SOL_SOCKET<span class='Delimiter'>, </span>SO_NOSIGPIPE<span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1940"><span class='Ref_To_Local'>optval</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1940"><span class='Ref_To_Local'>optval</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN409"><span class='Ref_to_Member'>sigpipe_so</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN410"><span class='Ref_to_Member'>sigpipe_flag</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* SO_NOSIGPIPE */ 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Start/make connection.  This should not block, since we 
                     * are in nonblock mode.  If it does, well, too bad. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN372"><span class='Ref_to_Macro'>connect</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Delimiter'>, 
</span>                                <a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN103"><span class='Ref_to_Member'>ai_addrlen</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a> <span class='Operator'>== </span><a href="win32.h.html#LN25"><span class='Ref_to_Const'>EINPROGRESS</span></a> <span class='Operator'>|| 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
                            <a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a> <span class='Operator'>== </span><a href="win32.h.html#LN19"><span class='Ref_to_Const'>EWOULDBLOCK</span></a> <span class='Operator'>|| 
</span><span class='Directive'>#endif</span> 
                            <a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a> <span class='Operator'>== </span><a href="win32.h.html#LN17"><span class='Ref_to_Const'>EINTR</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * This is fine - we're in non-blocking mode, and 
                             * the connection is in progress.  Tell caller to 
                             * wait for write-ready on socket. 
                             */ 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN56"><span class='Ref_to_EnumConst'>CONNECTION_STARTED</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <a href="libpq-fe.h.html#LN75"><span class='Ref_to_EnumConst'>PGRES_POLLING_WRITING</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Comment_Multi_Line'>/* otherwise, trouble */ 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Hm, we're connected already --- seems the "nonblock 
                         * connection" wasn't.  Advance the state machine and 
                         * go do the next stuff. 
                         */ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN56"><span class='Ref_to_EnumConst'>CONNECTION_STARTED</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * This connection failed --- set up error report, then 
                     * close socket (do it this way in case close() affects 
                     * the value of errno...).  We will ignore the connect() 
                     * failure and keep going if there are more addresses. 
                     */ 
</span>                    <a href="fe-connect.c.html#LN1349"><span class='Ref_to_Func'>connectFailureMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Try the next address, if any. 
                     */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN2012"><span class='Ref_To_Local'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span>               <span class='Comment_Single_Line'>/* loop over addresses */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Oops, no more addresses.  An appropriate error message is 
                 * already set up, so just set the right status. 
                 */ 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN56"><span class='Ref_to_EnumConst'>CONNECTION_STARTED</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2235"></a>                ACCEPT_TYPE_ARG3 <span class='Declare_Local'>optlen</span> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1940"><span class='Ref_To_Local'>optval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Write ready, since we've made it here, so the connection 
                 * has been made ... or has failed. 
                 */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Now check (using getsockopt) that there is not an error 
                 * state waiting for us on the socket. 
                 */ 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>getsockopt<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, </span>SOL_SOCKET<span class='Delimiter'>, </span>SO_ERROR<span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1940"><span class='Ref_To_Local'>optval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2235"><span class='Ref_To_Local'>optlen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                    <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not get socket error status: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1940"><span class='Ref_To_Local'>optval</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * When using a nonblocking connect, we will typically see 
                     * connect failures at this point, so provide a friendly 
                     * error message. 
                     */ 
</span>                    <a href="fe-connect.c.html#LN1349"><span class='Ref_to_Func'>connectFailureMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1940"><span class='Ref_To_Local'>optval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If more addresses remain, keep trying, just as in the 
                     * case where connect() returned failure immediately. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if optval!=0 &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* Fill in the client address */ 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN401"><span class='Ref_to_Member'>laddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN64"><span class='Ref_to_Member'>salen</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN401"><span class='Ref_to_Member'>laddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>getsockname<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN401"><span class='Ref_to_Member'>laddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN401"><span class='Ref_to_Member'>laddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN64"><span class='Ref_to_Member'>salen</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not get client address from socket: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Make sure we can write before advancing to next step. 
                 */ 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN57"><span class='Ref_to_EnumConst'>CONNECTION_MADE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="libpq-fe.h.html#LN75"><span class='Ref_to_EnumConst'>PGRES_POLLING_WRITING</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN57"><span class='Ref_to_EnumConst'>CONNECTION_MADE</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2300"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>startpacket</span><span class='Delimiter'>; 
</span><a name="LN2301"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>packetlen</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
 
                <span class='Comment_Multi_Line'>/* 
                 * Implement requirepeer check, if requested and it's a 
                 * Unix-domain socket. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN356"><span class='Ref_to_Member'>requirepeer</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN356"><span class='Ref_to_Member'>requirepeer</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>                    <a href="../../include/common/ip.h.html#LN21"><span class='Ref_to_Macro'>IS_AF_UNIX</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN402"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family<span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span><a name="LN2312"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>pwdbuf</span><span class='Delimiter'>[</span>BUFSIZ<span class='Delimiter'>]; 
</span><a name="LN2313"></a>                    <span class='Control'>struct</span> passwd <span class='Declare_Local'>pass_buf</span><span class='Delimiter'>; 
</span><a name="LN2314"></a>                    <span class='Control'>struct</span> passwd <span class='Operator'>*</span><span class='Declare_Local'>pass</span><span class='Delimiter'>; 
</span><a name="LN2315"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>passerr</span><span class='Delimiter'>; 
</span><a name="LN2316"></a>                    <a href="../../include/port/win32.h.html#LN249"><span class='Ref_to_Typedef'>uid_t</span></a>       <span class='Declare_Local'>uid</span><span class='Delimiter'>; 
</span><a name="LN2317"></a>                    <a href="../../include/port/win32.h.html#LN250"><span class='Ref_to_Typedef'>gid_t</span></a>       <span class='Declare_Local'>gid</span><span class='Delimiter'>; 
</span> 
                    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/getpeereid.c.html#LN33"><span class='Ref_to_Func'>getpeereid</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2316"><span class='Ref_To_Local'>uid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2317"><span class='Ref_To_Local'>gid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Provide special error message if getpeereid is a 
                         * stub 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ENOSYS<span class='Parentheses'>) 
</span>                            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                                 <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"requirepeer parameter is not supported on this platform\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not get peer credentials: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../port/thread.c.html#LN59"><span class='Ref_to_Func'>pqStrerror</span></a><span class='Parentheses'>(</span>errno<span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <a href="fe-connect.c.html#LN2315"><span class='Ref_To_Local'>passerr</span></a> <span class='Operator'>= </span><a href="../../port/thread.c.html#LN93"><span class='Ref_to_Func'>pqGetpwuid</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2316"><span class='Ref_To_Local'>uid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2313"><span class='Ref_To_Local'>pass_buf</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN2312"><span class='Ref_To_Local'>pwdbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2312"><span class='Ref_To_Local'>pwdbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2314"><span class='Ref_To_Local'>pass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2314"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2315"><span class='Ref_To_Local'>passerr</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not look up local user ID %d: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <a href="fe-connect.c.html#LN2316"><span class='Ref_To_Local'>uid</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../port/thread.c.html#LN59"><span class='Ref_to_Func'>pqStrerror</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2315"><span class='Ref_To_Local'>passerr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"local user with ID %d does not exist\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN2316"><span class='Ref_To_Local'>uid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2314"><span class='Ref_To_Local'>pass</span></a><span class='Operator'>-&GT;</span>pw_name<span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN356"><span class='Ref_to_Member'>requirepeer</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"requirepeer specifies \"%s\", but actual peer user name is \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN356"><span class='Ref_to_Member'>requirepeer</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN2314"><span class='Ref_To_Local'>pass</span></a><span class='Operator'>-&GT;</span>pw_name<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;requirepeer&&co... &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_UNIX_SOCKETS */ 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN172"><span class='Ref_to_Const'>USE_SSL</span></a> 
 
                <span class='Comment_Multi_Line'>/* 
                 * If SSL is enabled and we haven't already got it running, 
                 * request it instead of sending the startup message. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/common/ip.h.html#LN21"><span class='Ref_to_Macro'>IS_AF_UNIX</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN402"><span class='Ref_to_Member'>raddr</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family<span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Don't bother requesting SSL over a Unix socket */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN457"><span class='Ref_to_Member'>allow_ssl_try</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN457"><span class='Ref_to_Member'>allow_ssl_try</span></a> <span class='Operator'>&& !</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN458"><span class='Ref_to_Member'>wait_ssl_try</span></a> <span class='Operator'>&& 
</span>                    <span class='Operator'>!</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN460"><span class='Ref_to_Member'>ssl_in_use</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2375"></a>                    <a href="../../include/libpq/pqcomm.h.html#LN112"><span class='Ref_to_Typedef'>ProtocolVersion</span></a> <span class='Declare_Local'>pv</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Send the SSL request packet. 
                     * 
                     * Theoretically, this could block, but it really 
                     * shouldn't since we only got here if the socket is 
                     * write-ready. 
                     */ 
</span>                    <a href="fe-connect.c.html#LN2375"><span class='Ref_To_Local'>pv</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN204"><span class='Ref_to_Const'>NEGOTIATE_SSL_CODE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN544"><span class='Ref_to_Proto'>pqPacketSend</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2375"><span class='Ref_To_Local'>pv</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2375"><span class='Ref_To_Local'>pv</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../include/c.h.html#LN974"><span class='Ref_to_Const'>STATUS_OK</span></a><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not send SSL negotiation packet: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* Ok, wait for response */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN63"><span class='Ref_to_EnumConst'>CONNECTION_SSL_STARTUP</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;allow_ssl_try&&... &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_SSL */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Build the startup packet. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
                    <a href="fe-connect.c.html#LN2300"><span class='Ref_To_Local'>startpacket</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN600"><span class='Ref_to_Proto'>pqBuildStartupPacket3</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2301"><span class='Ref_To_Local'>packetlen</span></a><span class='Delimiter'>, 
</span>                                                        <a href="fe-connect.c.html#LN311"><span class='Ref_to_Global_Var'>EnvironmentOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="fe-connect.c.html#LN2300"><span class='Ref_To_Local'>startpacket</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN586"><span class='Ref_to_Proto'>pqBuildStartupPacket2</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2301"><span class='Ref_To_Local'>packetlen</span></a><span class='Delimiter'>, 
</span>                                                        <a href="fe-connect.c.html#LN311"><span class='Ref_to_Global_Var'>EnvironmentOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN2300"><span class='Ref_To_Local'>startpacket</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * will not appendbuffer here, since it's likely to also 
                     * run out of memory 
                     */ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Send the startup packet. 
                 * 
                 * Theoretically, this could block, but it really shouldn't 
                 * since we only got here if the socket is write-ready. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN544"><span class='Ref_to_Proto'>pqPacketSend</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN2300"><span class='Ref_To_Local'>startpacket</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN2301"><span class='Ref_To_Local'>packetlen</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/c.h.html#LN974"><span class='Ref_to_Const'>STATUS_OK</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                        <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not send startup packet: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1939"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2300"><span class='Ref_To_Local'>startpacket</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2300"><span class='Ref_To_Local'>startpacket</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN58"><span class='Ref_to_EnumConst'>CONNECTION_AWAITING_RESPONSE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Handle SSL negotiation: wait for postmaster messages and 
             * respond as necessary. 
             */ 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN63"><span class='Ref_to_EnumConst'>CONNECTION_SSL_STARTUP</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN172"><span class='Ref_to_Const'>USE_SSL</span></a> 
<a name="LN2446"></a>                <a href="libpq-fe.h.html#LN71"><span class='Ref_to_Typedef'>PostgresPollingStatusType</span></a> <span class='Declare_Local'>pollres</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * On first time through, get the postmaster's response to our 
                 * SSL negotiation packet. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN460"><span class='Ref_to_Member'>ssl_in_use</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * We use pqReadData here since it has the logic to 
                     * distinguish no-data-yet from connection closure. Since 
                     * conn-&GT;ssl isn't set, a plain recv() will occur. 
                     */ 
</span><a name="LN2459"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>SSLok</span><span class='Delimiter'>; 
</span><a name="LN2460"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>rdresult</span><span class='Delimiter'>; 
</span> 
                    <a href="fe-connect.c.html#LN2460"><span class='Ref_To_Local'>rdresult</span></a> <span class='Operator'>= </span><a href="fe-misc.c.html#LN629"><span class='Ref_to_Func'>pqReadData</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2460"><span class='Ref_To_Local'>rdresult</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* errorMessage is already filled in */ 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2460"><span class='Ref_To_Local'>rdresult</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* caller failed to wait for data */ 
</span>                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2459"><span class='Ref_To_Local'>SSLok</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* should not happen really */ 
</span>                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2459"><span class='Ref_To_Local'>SSLok</span></a> <span class='Operator'>== </span><span class='String'>'S'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* mark byte consumed */ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Set up global SSL state if required */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-secure.c.html#LN158"><span class='Ref_to_Func'>pqsecure_initialize</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2459"><span class='Ref_To_Local'>SSLok</span></a> <span class='Operator'>== </span><span class='String'>'N'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* mark byte consumed */ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* OK to do without SSL? */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'r'</span> <span class='Operator'>||</span>  <span class='Comment_Single_Line'>/* "require" */ 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'v'</span><span class='Parentheses'>)</span>    <span class='Comment_Multi_Line'>/* "verify-ca" or 
                                                         * "verify-full" */ 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* Require SSL, but server does not want it */ 
</span>                            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                                 <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"server does not support SSL, but SSL was required\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Comment_Multi_Line'>/* Otherwise, proceed with normal startup */ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN457"><span class='Ref_to_Member'>allow_ssl_try</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN57"><span class='Ref_to_EnumConst'>CONNECTION_MADE</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN75"><span class='Ref_to_EnumConst'>PGRES_POLLING_WRITING</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2459"><span class='Ref_To_Local'>SSLok</span></a> <span class='Operator'>== </span><span class='String'>'E'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Server failure of some sort, such as failure to 
                         * fork a backend process.  We need to process and 
                         * report the error message, which might be formatted 
                         * according to either protocol 2 or protocol 3. 
                         * Rather than duplicate the code for that, we flip 
                         * into AWAITING_RESPONSE state and let the code there 
                         * deal with it.  Note we have *not* consumed the "E" 
                         * byte here. 
                         */ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN58"><span class='Ref_to_EnumConst'>CONNECTION_AWAITING_RESPONSE</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"received invalid response to SSL negotiation: %c\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="fe-connect.c.html#LN2459"><span class='Ref_To_Local'>SSLok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !conn-&GT;ssl_in_use &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * Begin or continue the SSL negotiation process. 
                 */ 
</span>                <a href="fe-connect.c.html#LN2446"><span class='Ref_To_Local'>pollres</span></a> <span class='Operator'>= </span><a href="fe-secure.c.html#LN173"><span class='Ref_to_Func'>pqsecure_open_client</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2446"><span class='Ref_To_Local'>pollres</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN76"><span class='Ref_to_EnumConst'>PGRES_POLLING_OK</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* SSL handshake done, ready to send startup packet */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN57"><span class='Ref_to_EnumConst'>CONNECTION_MADE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN75"><span class='Ref_to_EnumConst'>PGRES_POLLING_WRITING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2446"><span class='Ref_To_Local'>pollres</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN73"><span class='Ref_to_EnumConst'>PGRES_POLLING_FAILED</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Failed ... if sslmode is "prefer" then do a non-SSL 
                     * retry 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'p'</span> <span class='Comment_Single_Line'>/* "prefer" */ 
</span>                        <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN457"><span class='Ref_to_Member'>allow_ssl_try</span></a>  <span class='Comment_Single_Line'>/* redundant? */ 
</span>                        <span class='Operator'>&& !</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN458"><span class='Ref_to_Member'>wait_ssl_try</span></a><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* redundant? */ 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* only retry once */ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN457"><span class='Ref_to_Member'>allow_ssl_try</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Must drop the old connection */ 
</span>                        <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>return</span> <a href="fe-connect.c.html#LN2446"><span class='Ref_To_Local'>pollres</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* !USE_SSL */ 
</span>                <span class='Comment_Multi_Line'>/* can't get here */ 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_SSL */ 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Handle authentication exchange: wait for postmaster messages 
             * and respond as necessary. 
             */ 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN58"><span class='Ref_to_EnumConst'>CONNECTION_AWAITING_RESPONSE</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2570"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>beresp</span><span class='Delimiter'>; 
</span><a name="LN2571"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>msgLength</span><span class='Delimiter'>; 
</span><a name="LN2572"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>avail</span><span class='Delimiter'>; 
</span><a name="LN2573"></a>                <a href="../../include/libpq/pqcomm.h.html#LN178"><span class='Ref_to_Typedef'>AuthRequest</span></a> <span class='Declare_Local'>areq</span><span class='Delimiter'>; 
</span><a name="LN2574"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Scan the message from current point (note that if we find 
                 * the message is incomplete, we will return without advancing 
                 * inStart, and resume here next time). 
                 */ 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Read type byte */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2570"><span class='Ref_To_Local'>beresp</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* We'll come back when there is more data */ 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Validate message type: we expect only an authentication 
                 * request or an error here.  Anything else probably means 
                 * it's not Postgres on the other end at all. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2570"><span class='Ref_To_Local'>beresp</span></a> <span class='Operator'>== </span><span class='String'>'R'</span> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN2570"><span class='Ref_To_Local'>beresp</span></a> <span class='Operator'>== </span><span class='String'>'E'</span><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>                                      <span class='String'>"expected authentication request from "</span> 
                                                <span class='String'>"server, but received %c\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN2570"><span class='Ref_To_Local'>beresp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Read message length word */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* We'll come back when there is more data */ 
</span>                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Set phony message length to disable checks below */ 
</span>                    <a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Try to validate message length before using it. 
                 * Authentication requests can't be very large, although GSS 
                 * auth requests may not be that small.  Errors can be a 
                 * little larger, but not huge.  If we see a large apparent 
                 * length in an error, it means we're really talking to a 
                 * pre-3.0-protocol server; cope. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2570"><span class='Ref_To_Local'>beresp</span></a> <span class='Operator'>== </span><span class='String'>'R'</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&LT; </span><span class='Number'>8</span> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&GT; </span><span class='Number'>2000</span><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>                                      <span class='String'>"expected authentication request from "</span> 
                                                <span class='String'>"server, but received %c\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN2570"><span class='Ref_To_Local'>beresp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2570"><span class='Ref_To_Local'>beresp</span></a> <span class='Operator'>== </span><span class='String'>'E'</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&LT; </span><span class='Number'>8</span> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&GT; </span><span class='Number'>30000</span><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Handle error from a pre-3.0 server */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* reread data */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN169"><span class='Ref_to_Func'>pqGets_append</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* We'll come back when there is more data */ 
</span>                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* OK, we read the message; mark data consumed */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * The postmaster typically won't end its message with a 
                     * newline, so add one to conform to libpq conventions. 
                     */ 
</span>                    <a href="pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If we tried to open the connection in 3.0 protocol, 
                     * fall back to 2.0 protocol. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a> <span class='Operator'>= </span><a href="../../include/libpq/pqcomm.h.html#LN105"><span class='Ref_to_Macro'>PG_PROTOCOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Must drop the old connection */ 
</span>                        <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if beresp=='E'&&(msgLeng... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * Can't process if message body isn't all here yet. 
                 * 
                 * (In protocol 2.0 case, we are assuming messages carry at 
                 * least 4 bytes of data.) 
                 */ 
</span>                <a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>-= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN2572"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a> <span class='Operator'>- </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2572"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Before returning, try to enlarge the input buffer if 
                     * needed to hold the whole message; see notes in 
                     * pqParseInput3. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN408"><span class='Ref_to_Func'>pqCheckInBufferSpace</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span>size_t<span class='Parentheses'>) </span><a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>, 
</span>                                             <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* We'll come back when there is more data */ 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* Handle errors. */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2570"><span class='Ref_To_Local'>beresp</span></a> <span class='Operator'>== </span><span class='String'>'E'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN603"><span class='Ref_to_Proto'>pqGetErrorNotice3</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* We'll come back when there is more data */ 
</span>                            <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN169"><span class='Ref_to_Func'>pqGets_append</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* We'll come back when there is more data */ 
</span>                            <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* OK, we read the message; mark data consumed */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN172"><span class='Ref_to_Const'>USE_SSL</span></a> 
 
                    <span class='Comment_Multi_Line'>/* 
                     * if sslmode is "allow" and we haven't tried an SSL 
                     * connection already, then retry with an SSL connection 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'a'</span> <span class='Comment_Single_Line'>/* "allow" */ 
</span>                        <span class='Operator'>&& !</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN460"><span class='Ref_to_Member'>ssl_in_use</span></a> 
                        <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN457"><span class='Ref_to_Member'>allow_ssl_try</span></a> 
                        <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN458"><span class='Ref_to_Member'>wait_ssl_try</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* only retry once */ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN458"><span class='Ref_to_Member'>wait_ssl_try</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Must drop the old connection */ 
</span>                        <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * if sslmode is "prefer" and we're in an SSL connection, 
                     * then do a non-SSL retry 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'p'</span> <span class='Comment_Single_Line'>/* "prefer" */ 
</span>                        <span class='Operator'>&& </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN457"><span class='Ref_to_Member'>allow_ssl_try</span></a> 
                        <span class='Operator'>&& !</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN458"><span class='Ref_to_Member'>wait_ssl_try</span></a><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* redundant? */ 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* only retry once */ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN457"><span class='Ref_to_Member'>allow_ssl_try</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Must drop the old connection */ 
</span>                        <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if beresp=='E' &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* It is an authentication request. */ 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN405"><span class='Ref_to_Member'>auth_req_received</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Get the type of request. */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>((</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN2573"><span class='Ref_To_Local'>areq</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* We'll come back when there are more data */ 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>-= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Ensure the password salt is in the input buffer, if it's an 
                 * MD5 request.  All the other authentication methods that 
                 * contain extra data in the authentication request are only 
                 * supported in protocol version 3, in which case we already 
                 * read the whole message above. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2573"><span class='Ref_To_Local'>areq</span></a> <span class='Operator'>== </span><a href="../../include/libpq/pqcomm.h.html#LN169"><span class='Ref_to_Const'>AUTH_REQ_MD5</span></a> <span class='Operator'>&& </span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>+= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span> 
                    <a href="fe-connect.c.html#LN2572"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a> <span class='Operator'>- </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2572"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Before returning, try to enlarge the input buffer 
                         * if needed to hold the whole message; see notes in 
                         * pqParseInput3. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN408"><span class='Ref_to_Func'>pqCheckInBufferSpace</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span>size_t<span class='Parentheses'>) </span><span class='Number'>4</span><span class='Delimiter'>, 
</span>                                                 <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* We'll come back when there is more data */ 
</span>                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Process the rest of the authentication request message, and 
                 * respond to it if necessary. 
                 * 
                 * Note that conn-&GT;pghost must be non-NULL if we are going to 
                 * avoid the Kerberos code doing a hostname look-up. 
                 */ 
</span>                <a href="fe-connect.c.html#LN2574"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="fe-auth.h.html#LN21"><span class='Ref_to_Proto'>pg_fe_sendauth</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2573"><span class='Ref_To_Local'>areq</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN2571"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* OK, we have processed the message; mark data consumed */ 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2574"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><a href="../../include/c.h.html#LN974"><span class='Ref_to_Const'>STATUS_OK</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Just make sure that any data sent by pg_fe_sendauth is 
                 * flushed out.  Although this theoretically could block, it 
                 * really shouldn't since we don't send large auth responses. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN637"><span class='Ref_to_Proto'>pqFlush</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2573"><span class='Ref_To_Local'>areq</span></a> <span class='Operator'>== </span><a href="../../include/libpq/pqcomm.h.html#LN164"><span class='Ref_to_Const'>AUTH_REQ_OK</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* We are done with authentication exchange */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN60"><span class='Ref_to_EnumConst'>CONNECTION_AUTH_OK</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Set asyncStatus so that PQgetResult will think that 
                     * what comes back next is the result of a query.  See 
                     * below. 
                     */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN216"><span class='Ref_to_EnumConst'>PGASYNC_BUSY</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* Look to see if we have more data yet. */ 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN60"><span class='Ref_to_EnumConst'>CONNECTION_AUTH_OK</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Now we expect to hear from the backend. A ReadyForQuery 
                 * message indicates that startup is successful, but we might 
                 * also get an Error message indicating failure. (Notice 
                 * messages indicating nonfatal warnings are also allowed by 
                 * the protocol, as are ParameterStatus and BackendKeyData 
                 * messages.) Easiest way to handle this is to let 
                 * PQgetResult() read the messages. We just have to fake it 
                 * out about the state of the connection, by setting 
                 * asyncStatus = PGASYNC_BUSY (done above). 
                 */ 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN424"><span class='Ref_to_Proto'>PQisBusy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span> 
                <a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * NULL return indicating we have gone to IDLE state is 
                 * expected 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN176"><span class='Ref_to_Member'>resultStatus</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a><span class='Parentheses'>) 
</span>                        <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                             <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected message from server during startup\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN416"><span class='Ref_to_Member'>send_appname</span></a> <span class='Operator'>&& 
</span>                             <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN337"><span class='Ref_to_Member'>appname</span></a> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN338"><span class='Ref_to_Member'>fbappname</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * If we tried to send application_name, check to see 
                         * if the error is about that --- pre-9.0 servers will 
                         * reject it at this stage of the process.  If so, 
                         * close the connection and retry without sending 
                         * application_name.  We could possibly get a false 
                         * SQLSTATE match here and retry uselessly, but there 
                         * seems no great harm in that; we'll just get the 
                         * same error again if it's unrelated. 
                         */ 
</span><a name="LN2875"></a>                        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>sqlstate</span><span class='Delimiter'>; 
</span> 
                        <a href="fe-connect.c.html#LN2875"><span class='Ref_To_Local'>sqlstate</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN56"><span class='Ref_to_Const'>PG_DIAG_SQLSTATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2875"><span class='Ref_To_Local'>sqlstate</span></a> <span class='Operator'>&& 
</span>                            strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN2875"><span class='Ref_To_Local'>sqlstate</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN89"><span class='Ref_to_Const'>ERRCODE_APPNAME_UNKNOWN</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN416"><span class='Ref_to_Member'>send_appname</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                            <span class='Comment_Multi_Line'>/* Must drop the old connection */ 
</span>                            <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;send_appname&&(... &raquo; </span> 
 
                    <span class='Comment_Multi_Line'>/* 
                     * if the resultStatus is FATAL, then conn-&GT;errorMessage 
                     * already has a copy of the error; needn't copy it back. 
                     * But add a newline if it's not there already, since 
                     * postmaster error messages may not have one. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>                        <a href="pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if res &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* Fire up post-connection housekeeping if needed */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN62"><span class='Ref_to_EnumConst'>CONNECTION_SETENV</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN236"><span class='Ref_to_EnumConst'>SETENV_STATE_CLIENT_ENCODING_SEND</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN415"><span class='Ref_to_Member'>next_eo</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN311"><span class='Ref_to_Global_Var'>EnvironmentOptions</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN75"><span class='Ref_to_EnumConst'>PGRES_POLLING_WRITING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If a read-write connection is required, see if we have one. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN363"><span class='Ref_to_Member'>target_session_attrs</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                    strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN363"><span class='Ref_to_Member'>target_session_attrs</span></a><span class='Delimiter'>, </span><span class='String'>"read-write"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * We are yet to make a connection. Save all existing 
                     * error messages until we make a successful connection 
                     * state. This is important because PQsendQuery is going 
                     * to reset conn-&GT;errorMessage and we will lose error 
                     * messages related to previous hosts we have tried to 
                     * connect and failed. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1879"><span class='Ref_to_Func'>saveErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span> 
                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="libpq-fe.h.html#LN401"><span class='Ref_to_Proto'>PQsendQuery</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                                     <span class='String'>"SHOW transaction_read_only"</span><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="fe-connect.c.html#LN1899"><span class='Ref_to_Func'>restoreErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN65"><span class='Ref_to_EnumConst'>CONNECTION_CHECK_WRITABLE</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN1899"><span class='Ref_to_Func'>restoreErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;target_session_... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* We can release the address lists now. */ 
</span>                <a href="fe-connect.c.html#LN342"><span class='Ref_to_Proto'>release_all_addrinfo</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* We are open for business! */ 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="libpq-fe.h.html#LN76"><span class='Ref_to_EnumConst'>PGRES_POLLING_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN62"><span class='Ref_to_EnumConst'>CONNECTION_SETENV</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Do post-connection housekeeping (only needed in protocol 2.0). 
             * 
             * We pretend that the connection is OK for the duration of these 
             * queries. 
             */ 
</span>            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN48"><span class='Ref_to_Func'>pqSetenvPoll</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="libpq-fe.h.html#LN76"><span class='Ref_to_EnumConst'>PGRES_POLLING_OK</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* Success */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* Still going */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN62"><span class='Ref_to_EnumConst'>CONNECTION_SETENV</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="libpq-fe.h.html#LN75"><span class='Ref_to_EnumConst'>PGRES_POLLING_WRITING</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* Still going */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN62"><span class='Ref_to_EnumConst'>CONNECTION_SETENV</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN75"><span class='Ref_to_EnumConst'>PGRES_POLLING_WRITING</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If a read-write connection is requested check for same. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN363"><span class='Ref_to_Member'>target_session_attrs</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN363"><span class='Ref_to_Member'>target_session_attrs</span></a><span class='Delimiter'>, </span><span class='String'>"read-write"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1879"><span class='Ref_to_Func'>saveErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span> 
                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="libpq-fe.h.html#LN401"><span class='Ref_to_Proto'>PQsendQuery</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                                 <span class='String'>"SHOW transaction_read_only"</span><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN1899"><span class='Ref_to_Func'>restoreErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN65"><span class='Ref_to_EnumConst'>CONNECTION_CHECK_WRITABLE</span></a><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN1899"><span class='Ref_to_Func'>restoreErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* We can release the address lists now. */ 
</span>            <a href="fe-connect.c.html#LN342"><span class='Ref_to_Proto'>release_all_addrinfo</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* We are open for business! */ 
</span>            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="libpq-fe.h.html#LN76"><span class='Ref_to_EnumConst'>PGRES_POLLING_OK</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN67"><span class='Ref_to_EnumConst'>CONNECTION_CONSUME</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="libpq-fe.h.html#LN425"><span class='Ref_to_Proto'>PQconsumeInput</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN424"><span class='Ref_to_Proto'>PQisBusy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN67"><span class='Ref_to_EnumConst'>CONNECTION_CONSUME</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN1899"><span class='Ref_to_Func'>restoreErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Call PQgetResult() again to consume NULL result. 
                 */ 
</span>                <a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN67"><span class='Ref_to_EnumConst'>CONNECTION_CONSUME</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* We are open for business! */ 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="libpq-fe.h.html#LN76"><span class='Ref_to_EnumConst'>PGRES_POLLING_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>case</span> <a href="libpq-fe.h.html#LN65"><span class='Ref_to_EnumConst'>CONNECTION_CHECK_WRITABLE</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN1879"><span class='Ref_to_Func'>saveErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span> 
                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="libpq-fe.h.html#LN425"><span class='Ref_to_Proto'>PQconsumeInput</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN1899"><span class='Ref_to_Func'>restoreErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN424"><span class='Ref_to_Proto'>PQisBusy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN65"><span class='Ref_to_EnumConst'>CONNECTION_CHECK_WRITABLE</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN1899"><span class='Ref_to_Func'>restoreErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                    <a href="libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span><a name="LN3055"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
                    <a href="fe-connect.c.html#LN3055"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3055"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='String'>"on"</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1899"><span class='Ref_to_Func'>restoreErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* Not writable; close connection. */ 
</span>                        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                   <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not make a writable "</span> 
                                                 <span class='String'>"connection to server "</span> 
                                                 <span class='String'>"\"%s:%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>, 
</span>                                       <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN343"><span class='Ref_to_Proto'>sendTerminateConn</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* Skip any remaining addresses for this host. */ 
</span>                        <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <span class='Comment_Multi_Line'>/* No more addresses to try. So we fail. */ 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strncmp(val,"on",2)==... &raquo; </span> 
                    <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* We can release the address lists now. */ 
</span>                    <a href="fe-connect.c.html#LN342"><span class='Ref_to_Proto'>release_all_addrinfo</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Finish reading any remaining messages before being 
                     * considered as ready. 
                     */ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN67"><span class='Ref_to_EnumConst'>CONNECTION_CONSUME</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if res&&(PQresultStatus(... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * Something went wrong with "SHOW transaction_read_only". We 
                 * should try next addresses. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>                    <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1938"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN1899"><span class='Ref_to_Func'>restoreErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1941"><span class='Ref_To_Local'>savedMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"test \"SHOW transaction_read_only\" failed "</span> 
                                <span class='String'>"on server \"%s:%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN343"><span class='Ref_to_Proto'>sendTerminateConn</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a><span class='Operator'>-&GT;</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN64"><span class='Ref_to_EnumConst'>CONNECTION_NEEDED</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN1999"><span class='Ref_to_Label'>keep_going</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* No more addresses to try. So we fail. */ 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid connection state %d, "</span> 
                               <span class='String'>"probably indicative of memory corruption\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3137"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch conn-&GT;status &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Unreachable */ 
</span> 
<a name="LN3137"></a><span class='Label'>error_return</span><span class='Operator'>: 
</span> 
    <a href="fe-connect.c.html#LN384"><span class='Ref_to_Proto'>pgpassfileWarning</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We used to close the socket at this point, but that makes it awkward 
     * for those above us if they wish to remove this socket from their own 
     * records (an fd_set for example).  We'll just have this socket closed 
     * when PQfinish is called (which is compulsory even after an error, since 
     * the connection structure must be freed). 
     */ 
</span>    <a href="fe-connect.c.html#LN1936"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN73"><span class='Ref_to_EnumConst'>PGRES_POLLING_FAILED</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PQconnectPoll &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * internal_ping 
 *      Determine if a server is running and if we can connect to it. 
 * 
 * The argument is a connection that's been started, but not completed. 
 */ 
</span><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN128"><span class='Ref_to_Typedef'>PGPing</span></a> 
<a name="LN3160"></a><span class='Declare_Function'>internal_ping</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Say "no attempt" if we never got to PQconnectPoll */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3160"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>|| !</span><a href="fe-connect.c.html#LN3160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN383"><span class='Ref_to_Member'>options_valid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN133"><span class='Ref_to_EnumConst'>PQPING_NO_ATTEMPT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Attempt to complete the connection */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN336"><span class='Ref_to_Proto'>connectDBComplete</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3160"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Definitely OK if we succeeded */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN130"><span class='Ref_to_EnumConst'>PQPING_OK</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Here begins the interesting part of "ping": determine the cause of the 
     * failure in sufficient detail to decide what to return.  We do not want 
     * to report that the server is not up just because we didn't have a valid 
     * password, for example.  In fact, any sort of authentication request 
     * implies the server is up.  (We need this check since the libpq side of 
     * things might have pulled the plug on the connection before getting an 
     * error as such from the postmaster.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN405"><span class='Ref_to_Member'>auth_req_received</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN130"><span class='Ref_to_EnumConst'>PQPING_OK</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we failed to get any ERROR response from the postmaster, report 
     * PQPING_NO_RESPONSE.  This result could be somewhat misleading for a 
     * pre-7.4 server, since it won't send back a SQLSTATE, but those are long 
     * out of support.  Another corner case where the server could return a 
     * failure without a SQLSTATE is fork failure, but NO_RESPONSE isn't 
     * totally unreasonable for that anyway.  We expect that every other 
     * failure case in a modern server will produce a report with a SQLSTATE. 
     * 
     * NOTE: whenever we get around to making libpq generate SQLSTATEs for 
     * client-side errors, we should either not store those into 
     * last_sqlstate, or add an extra flag so we can tell client-side errors 
     * apart from server-side ones. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN382"><span class='Ref_to_Member'>last_sqlstate</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>5</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN132"><span class='Ref_to_EnumConst'>PQPING_NO_RESPONSE</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Report PQPING_REJECT if server says it's not accepting connections. (We 
     * distinguish this case mainly for the convenience of pg_ctl.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN382"><span class='Ref_to_Member'>last_sqlstate</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN94"><span class='Ref_to_Const'>ERRCODE_CANNOT_CONNECT_NOW</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN131"><span class='Ref_to_EnumConst'>PQPING_REJECT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Any other SQLSTATE can be taken to indicate that the server is up. 
     * Presumably it didn't like our username, password, or database name; or 
     * perhaps it had some transient failure, but that should not be taken as 
     * meaning "it's down". 
     */ 
</span>    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN130"><span class='Ref_to_EnumConst'>PQPING_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end internal_ping &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * makeEmptyPGconn 
 *   - create a PGconn data structure with (as yet) no interesting data 
 */ 
</span><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>* 
</span><a name="LN3225"></a><span class='Declare_Function'>makeEmptyPGconn</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3227"></a>    <a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
    <span class='Comment_Multi_Line'>/* 
     * Make sure socket support is up and running. 
     */ 
</span><a name="LN3234"></a>    WSADATA     <span class='Declare_Local'>wsaData</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>WSAStartup<span class='Parentheses'>(</span>MAKEWORD<span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3234"><span class='Ref_To_Local'>wsaData</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    WSASetLastError<span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
        WSACleanup<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>return</span> <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Zero all pointers and booleans */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* install default notice hooks */ 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN151"><span class='Ref_to_Member'>noticeRec</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN372"><span class='Ref_to_Proto'>defaultNoticeReceiver</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN153"><span class='Ref_to_Member'>noticeProc</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN373"><span class='Ref_to_Proto'>defaultNoticeProcessor</span></a><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN215"><span class='Ref_to_EnumConst'>PGASYNC_IDLE</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN102"><span class='Ref_to_EnumConst'>PQTRANS_IDLE</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN383"><span class='Ref_to_Member'>options_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN384"><span class='Ref_to_Member'>nonblocking</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN244"><span class='Ref_to_EnumConst'>SETENV_STATE_IDLE</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN422"><span class='Ref_to_Member'>client_encoding</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN237"><span class='Ref_to_EnumConst'>PG_SQL_ASCII</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN423"><span class='Ref_to_Member'>std_strings</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* unless server says differently */ 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN424"><span class='Ref_to_Member'>verbosity</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN112"><span class='Ref_to_EnumConst'>PQERRORS_DEFAULT</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN425"><span class='Ref_to_Member'>show_context</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN119"><span class='Ref_to_EnumConst'>PQSHOW_CONTEXT_ERRORS</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN405"><span class='Ref_to_Member'>auth_req_received</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN407"><span class='Ref_to_Member'>password_needed</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN408"><span class='Ref_to_Member'>pgpassfile_used</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN172"><span class='Ref_to_Const'>USE_SSL</span></a> 
    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN457"><span class='Ref_to_Member'>allow_ssl_try</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN458"><span class='Ref_to_Member'>wait_ssl_try</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN460"><span class='Ref_to_Member'>ssl_in_use</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We try to send at least 8K at a time, which is the usual size of pipe 
     * buffers on Unix systems.  That way, when we are sending a large amount 
     * of data, we avoid incurring extra kernel context swaps for partial 
     * bufferloads.  The output buffer is initially made 16K in size, and we 
     * try to dump it after accumulating 8K. 
     * 
     * With the same goal of minimizing context swaps, the input buffer will 
     * be enlarged anytime it has less than 8K free, so we initially allocate 
     * twice that. 
     */ 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN430"><span class='Ref_to_Member'>inBufSize</span></a> <span class='Operator'>= </span><span class='Number'>16</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN430"><span class='Ref_to_Member'>inBufSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN437"><span class='Ref_to_Member'>outBufSize</span></a> <span class='Operator'>= </span><span class='Number'>16</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN436"><span class='Ref_to_Member'>outBuffer</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN437"><span class='Ref_to_Member'>outBufSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN447"><span class='Ref_to_Member'>rowBufLen</span></a> <span class='Operator'>= </span><span class='Number'>32</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN446"><span class='Ref_to_Member'>rowBuf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN286"><span class='Ref_to_Typedef'>PGdataValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN447"><span class='Ref_to_Member'>rowBufLen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN286"><span class='Ref_to_Typedef'>PGdataValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN436"><span class='Ref_to_Member'>outBuffer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN446"><span class='Ref_to_Member'>rowBuf</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="pqexpbuffer.h.html#LN58"><span class='Ref_to_Macro'>PQExpBufferBroken</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="pqexpbuffer.h.html#LN58"><span class='Ref_to_Macro'>PQExpBufferBroken</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* out of memory already :-( */ 
</span>        <a href="fe-connect.c.html#LN340"><span class='Ref_to_Proto'>freePGconn</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN3227"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeEmptyPGconn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * freePGconn 
 *   - free an idle (closed) PGconn data structure 
 * 
 * NOTE: this should not overlap any functionality with closePGconn(). 
 * Clearing/resetting of transient state belongs there; what we do here is 
 * release data that is to be held for the life of the PGconn structure. 
 * If a value ought to be cleared/freed during PQreset(), do it there not here. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3321"></a><span class='Declare_Function'>freePGconn</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3323"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* let any event procs clean up their state data */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN373"><span class='Ref_to_Member'>nEvents</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3328"></a>        <a href="libpq-events.h.html#LN46"><span class='Ref_to_Typedef'>PGEventConnDestroy</span></a> <span class='Declare_Local'>evt</span><span class='Delimiter'>; 
</span> 
        <a href="fe-connect.c.html#LN3328"><span class='Ref_To_Local'>evt</span></a><span class='Operator'>.</span><a href="libpq-events.h.html#LN48"><span class='Ref_to_Member'>conn</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN159"><span class='Ref_to_Member'>proc</span></a><span class='Parentheses'>(</span><a href="libpq-events.h.html#LN30"><span class='Ref_to_EnumConst'>PGEVT_CONNDESTROY</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3328"><span class='Ref_To_Local'>evt</span></a><span class='Delimiter'>, 
</span>                                    <a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN161"><span class='Ref_to_Member'>passThrough</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN160"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* clean up pg_conn_host structures */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN310"><span class='Ref_to_Member'>password</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3323"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN310"><span class='Ref_to_Member'>password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN328"><span class='Ref_to_Member'>pghostaddr</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN328"><span class='Ref_to_Member'>pghostaddr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN331"><span class='Ref_to_Member'>pgport</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN331"><span class='Ref_to_Member'>pgport</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN332"><span class='Ref_to_Member'>pgtty</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN332"><span class='Ref_to_Member'>pgtty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN334"><span class='Ref_to_Member'>connect_timeout</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN334"><span class='Ref_to_Member'>connect_timeout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN337"><span class='Ref_to_Member'>appname</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN337"><span class='Ref_to_Member'>appname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN338"><span class='Ref_to_Member'>fbappname</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN338"><span class='Ref_to_Member'>fbappname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN340"><span class='Ref_to_Member'>replication</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN340"><span class='Ref_to_Member'>replication</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN342"><span class='Ref_to_Member'>pgpass</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN342"><span class='Ref_to_Member'>pgpass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN344"><span class='Ref_to_Member'>keepalives</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN344"><span class='Ref_to_Member'>keepalives</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN345"><span class='Ref_to_Member'>keepalives_idle</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN345"><span class='Ref_to_Member'>keepalives_idle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN346"><span class='Ref_to_Member'>keepalives_interval</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN346"><span class='Ref_to_Member'>keepalives_interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN348"><span class='Ref_to_Member'>keepalives_count</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN348"><span class='Ref_to_Member'>keepalives_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN350"><span class='Ref_to_Member'>sslmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN353"><span class='Ref_to_Member'>sslcert</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN353"><span class='Ref_to_Member'>sslcert</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN352"><span class='Ref_to_Member'>sslkey</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN352"><span class='Ref_to_Member'>sslkey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN354"><span class='Ref_to_Member'>sslrootcert</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN354"><span class='Ref_to_Member'>sslrootcert</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN355"><span class='Ref_to_Member'>sslcrl</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN355"><span class='Ref_to_Member'>sslcrl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN351"><span class='Ref_to_Member'>sslcompression</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN351"><span class='Ref_to_Member'>sslcompression</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN356"><span class='Ref_to_Member'>requirepeer</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN356"><span class='Ref_to_Member'>requirepeer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>ENABLE_GSS<span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN30"><span class='Ref_to_Const'>ENABLE_SSPI</span></a><span class='Parentheses'>) 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN359"><span class='Ref_to_Member'>krbsrvname</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN359"><span class='Ref_to_Member'>krbsrvname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>ENABLE_GSS<span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN30"><span class='Ref_to_Const'>ENABLE_SSPI</span></a><span class='Parentheses'>) 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN480"><span class='Ref_to_Member'>gsslib</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN480"><span class='Ref_to_Member'>gsslib</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Comment_Multi_Line'>/* Note that conn-&GT;Pfdebug is not ours to close or free */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN381"><span class='Ref_to_Member'>last_query</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN381"><span class='Ref_to_Member'>last_query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN436"><span class='Ref_to_Member'>outBuffer</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN436"><span class='Ref_to_Member'>outBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN446"><span class='Ref_to_Member'>rowBuf</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN446"><span class='Ref_to_Member'>rowBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN363"><span class='Ref_to_Member'>target_session_attrs</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN363"><span class='Ref_to_Member'>target_session_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3321"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    WSACleanup<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end freePGconn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * release_all_addrinfo 
 *   - free addrinfo of all hostconn elements. 
 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3438"></a><span class='Declare_Function'>release_all_addrinfo</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3438"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3442"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3442"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3442"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN3438"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN394"><span class='Ref_to_Member'>nconnhost</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="fe-connect.c.html#LN3442"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3446"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>family</span> <span class='Operator'>= </span>AF_UNSPEC<span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3438"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3442"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN307"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN296"><span class='Ref_to_EnumConst'>CHT_UNIX_SOCKET</span></a><span class='Parentheses'>) 
</span>                <a href="fe-connect.c.html#LN3446"><span class='Ref_To_Local'>family</span></a> <span class='Operator'>= </span>AF_UNIX<span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
            <a href="../../include/common/ip.h.html#LN29"><span class='Ref_to_Proto'>pg_freeaddrinfo_all</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3446"><span class='Ref_To_Local'>family</span></a><span class='Delimiter'>, 
</span>                                <a href="fe-connect.c.html#LN3438"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3442"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN3438"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3442"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN313"><span class='Ref_to_Member'>addrlist</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN3438"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN413"><span class='Ref_to_Member'>addr_cur</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end release_all_addrinfo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * sendTerminateConn 
 *   - Send a terminate message to backend. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3466"></a><span class='Declare_Function'>sendTerminateConn</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Note that the protocol doesn't allow us to send Terminate messages 
     * during the startup phase. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3466"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>!= </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN3466"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Try to send "close connection" message to backend. Ignore any 
         * error. 
         */ 
</span>        <a href="fe-misc.c.html#LN519"><span class='Ref_to_Func'>pqPutMsgStart</span></a><span class='Parentheses'>(</span><span class='String'>'X'</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3466"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-misc.c.html#LN587"><span class='Ref_to_Func'>pqPutMsgEnd</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3466"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="libpq-int.h.html#LN637"><span class='Ref_to_Proto'>pqFlush</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3466"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * closePGconn 
 *   - properly close a connection to the backend 
 * 
 * This should reset or release all transient state, but NOT the connection 
 * parameters.  On exit, the PGconn should be in condition to start a fresh 
 * connection with the same parameters (see PQreset()). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3493"></a><span class='Declare_Function'>closePGconn</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3495"></a>    <a href="libpq-fe.h.html#LN160"><span class='Ref_to_Typedef'>PGnotify</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>notify</span><span class='Delimiter'>; 
</span><a name="LN3496"></a>    <a href="libpq-int.h.html#LN255"><span class='Ref_to_Struct'>pgParameterStatus</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstatus</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN343"><span class='Ref_to_Proto'>sendTerminateConn</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must reset the blocking status so a possible reconnect will work. 
     * 
     * Don't call PQsetnonblocking() because it will fail if it's unable to 
     * flush the connection. 
     */ 
</span>    <a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN384"><span class='Ref_to_Member'>nonblocking</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close the connection, reset all transient state, flush I/O buffers. 
     */ 
</span>    <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>;</span>      <span class='Comment_Multi_Line'>/* Well, not really _bad_ - just 
                                         * absent */ 
</span>    <a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN215"><span class='Ref_to_EnumConst'>PGASYNC_IDLE</span></a><span class='Delimiter'>; 
</span>    <a href="libpq-int.h.html#LN571"><span class='Ref_to_Proto'>pqClearAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* deallocate result */ 
</span>    <a href="pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN342"><span class='Ref_to_Proto'>release_all_addrinfo</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN3495"><span class='Ref_To_Local'>notify</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN390"><span class='Ref_to_Member'>notifyHead</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3495"><span class='Ref_To_Local'>notify</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3522"></a>        <a href="libpq-fe.h.html#LN160"><span class='Ref_to_Typedef'>PGnotify</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>prev</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3495"><span class='Ref_To_Local'>notify</span></a><span class='Delimiter'>; 
</span> 
        <a href="fe-connect.c.html#LN3495"><span class='Ref_To_Local'>notify</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3495"><span class='Ref_To_Local'>notify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN166"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3522"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN390"><span class='Ref_to_Member'>notifyHead</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN391"><span class='Ref_to_Member'>notifyTail</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3496"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN421"><span class='Ref_to_Member'>pstatus</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3496"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3531"></a>        <a href="libpq-int.h.html#LN255"><span class='Ref_to_Struct'>pgParameterStatus</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prev</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3496"><span class='Ref_To_Local'>pstatus</span></a><span class='Delimiter'>; 
</span> 
        <a href="fe-connect.c.html#LN3496"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3496"><span class='Ref_To_Local'>pstatus</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN257"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3531"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN421"><span class='Ref_to_Member'>pstatus</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN426"><span class='Ref_to_Member'>lobjfuncs</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN426"><span class='Ref_to_Member'>lobjfuncs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3493"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN426"><span class='Ref_to_Member'>lobjfuncs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end closePGconn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQfinish: properly close a connection to the backend. Also frees 
 * the PGconn data structure so it shouldn't be re-used after this. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3547"></a><span class='Declare_Function'>PQfinish</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3547"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN341"><span class='Ref_to_Proto'>closePGconn</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3547"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN340"><span class='Ref_to_Proto'>freePGconn</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3547"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * PQreset: resets the connection to the backend by closing the 
 * existing connection and creating a new one. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3561"></a><span class='Declare_Function'>PQreset</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN341"><span class='Ref_to_Proto'>closePGconn</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN335"><span class='Ref_to_Proto'>connectDBStart</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN336"><span class='Ref_to_Proto'>connectDBComplete</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Notify event procs of successful reset.  We treat an event proc 
             * failure as disabling the connection ... good idea? 
             */ 
</span><a name="LN3573"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3573"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3573"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN373"><span class='Ref_to_Member'>nEvents</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3573"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3577"></a>                <a href="libpq-events.h.html#LN41"><span class='Ref_to_Typedef'>PGEventConnReset</span></a> <span class='Declare_Local'>evt</span><span class='Delimiter'>; 
</span> 
                <a href="fe-connect.c.html#LN3577"><span class='Ref_To_Local'>evt</span></a><span class='Operator'>.</span><a href="libpq-events.h.html#LN43"><span class='Ref_to_Member'>conn</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3573"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN159"><span class='Ref_to_Member'>proc</span></a><span class='Parentheses'>(</span><a href="libpq-events.h.html#LN29"><span class='Ref_to_EnumConst'>PGEVT_CONNRESET</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3577"><span class='Ref_To_Local'>evt</span></a><span class='Delimiter'>, 
</span>                                          <a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3573"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN161"><span class='Ref_to_Member'>passThrough</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"PGEventProc \"%s\" failed during PGEVT_CONNRESET event\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN3561"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3573"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN160"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if connectDBStart(conn)&... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end PQreset &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * PQresetStart: 
 * resets the connection to the backend 
 * closes the existing connection and makes a new one 
 * Returns 1 on success, 0 on failure. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3602"></a><span class='Declare_Function'>PQresetStart</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3602"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN341"><span class='Ref_to_Proto'>closePGconn</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3602"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="fe-connect.c.html#LN335"><span class='Ref_to_Proto'>connectDBStart</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3602"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQresetPoll: 
 * resets the connection to the backend 
 * closes the existing connection and makes a new one 
 */ 
</span><a href="libpq-fe.h.html#LN71"><span class='Ref_to_Typedef'>PostgresPollingStatusType</span></a> 
<a name="LN3621"></a><span class='Declare_Function'>PQresetPoll</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3621"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3625"></a>        <a href="libpq-fe.h.html#LN71"><span class='Ref_to_Typedef'>PostgresPollingStatusType</span></a> <span class='Declare_Local'>status</span> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN257"><span class='Ref_to_Proto'>PQconnectPoll</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3621"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3625"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN76"><span class='Ref_to_EnumConst'>PGRES_POLLING_OK</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Notify event procs of successful reset.  We treat an event proc 
             * failure as disabling the connection ... good idea? 
             */ 
</span><a name="LN3633"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3633"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3633"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-connect.c.html#LN3621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN373"><span class='Ref_to_Member'>nEvents</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3633"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3637"></a>                <a href="libpq-events.h.html#LN41"><span class='Ref_to_Typedef'>PGEventConnReset</span></a> <span class='Declare_Local'>evt</span><span class='Delimiter'>; 
</span> 
                <a href="fe-connect.c.html#LN3637"><span class='Ref_To_Local'>evt</span></a><span class='Operator'>.</span><a href="libpq-events.h.html#LN43"><span class='Ref_to_Member'>conn</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3621"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3633"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN159"><span class='Ref_to_Member'>proc</span></a><span class='Parentheses'>(</span><a href="libpq-events.h.html#LN29"><span class='Ref_to_EnumConst'>PGEVT_CONNRESET</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3637"><span class='Ref_To_Local'>evt</span></a><span class='Delimiter'>, 
</span>                                          <a href="fe-connect.c.html#LN3621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3633"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN161"><span class='Ref_to_Member'>passThrough</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN3621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"PGEventProc \"%s\" failed during PGEVT_CONNRESET event\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN3621"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN372"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3633"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN160"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN73"><span class='Ref_to_EnumConst'>PGRES_POLLING_FAILED</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if status==PGRES_POLLING... &raquo; </span> 
 
        <span class='Control'>return</span> <a href="fe-connect.c.html#LN3625"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn &raquo; </span> 
 
    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN73"><span class='Ref_to_EnumConst'>PGRES_POLLING_FAILED</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PQresetPoll &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQgetCancel: get a PGcancel structure corresponding to a connection. 
 * 
 * A copy is needed to be able to cancel a running query from a different 
 * thread. If the same structure is used all structure members would have 
 * to be individually locked (if the entire structure was locked, it would 
 * be impossible to cancel a synchronous query because the structure would 
 * have to stay locked for the duration of the query). 
 */ 
</span><a href="libpq-fe.h.html#LN152"><span class='Ref_to_Typedef'>PGcancel</span></a> <span class='Operator'>* 
</span><a name="LN3668"></a><span class='Declare_Function'>PQgetCancel</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3670"></a>    <a href="libpq-fe.h.html#LN152"><span class='Ref_to_Typedef'>PGcancel</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cancel</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3668"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3668"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>== </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN3670"><span class='Ref_To_Local'>cancel</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN152"><span class='Ref_to_Typedef'>PGcancel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3670"><span class='Ref_To_Local'>cancel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3670"><span class='Ref_To_Local'>cancel</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN503"><span class='Ref_to_Member'>raddr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3668"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN402"><span class='Ref_to_Member'>raddr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN61"><span class='Ref_to_Typedef'>SockAddr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3670"><span class='Ref_To_Local'>cancel</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN504"><span class='Ref_to_Member'>be_pid</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3668"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN419"><span class='Ref_to_Member'>be_pid</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3670"><span class='Ref_To_Local'>cancel</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN505"><span class='Ref_to_Member'>be_key</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3668"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN420"><span class='Ref_to_Member'>be_key</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN3670"><span class='Ref_To_Local'>cancel</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PQgetCancel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* PQfreeCancel: free a cancel structure */ 
</span><span class='Keyword'>void 
</span><a name="LN3691"></a><span class='Declare_Function'>PQfreeCancel</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN152"><span class='Ref_to_Typedef'>PGcancel</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cancel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3691"><span class='Ref_to_Parameter'>cancel</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3691"><span class='Ref_to_Parameter'>cancel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQcancel and PQrequestCancel: attempt to request cancellation of the 
 * current operation. 
 * 
 * The return value is TRUE if the cancel request was successfully 
 * dispatched, FALSE if not (in which case an error message is available). 
 * Note: successful dispatch is no guarantee that there will be any effect at 
 * the backend.  The application must read the operation result as usual. 
 * 
 * CAUTION: we want this routine to be safely callable from a signal handler 
 * (for example, an application might want to call it in a SIGINT handler). 
 * This means we cannot use any C library routine that might be non-reentrant. 
 * malloc/free are often non-reentrant, and anything that might call them is 
 * just as dangerous.  We avoid sprintf here for that reason.  Building up 
 * error messages with strcpy/strcat is tedious but should be quite safe. 
 * We also save/restore errno in case the signal handler support doesn't. 
 * 
 * internal_cancel() is an internal helper function to make code-sharing 
 * between the two versions of the cancel function possible. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3719"></a><span class='Declare_Function'>internal_cancel</span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN61"><span class='Ref_to_Typedef'>SockAddr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>raddr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>be_pid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>be_key</span><span class='Delimiter'>, 
</span><a name="LN3720"></a>                <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>errbuf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>errbufsize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3722"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>; 
</span><a name="LN3723"></a>    <a href="../../include/port.h.html#LN25"><span class='Ref_to_Typedef'>pgsocket</span></a>    <span class='Declare_Local'>tmpsock</span> <span class='Operator'>= </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Delimiter'>; 
</span><a name="LN3724"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sebuf</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span><a name="LN3725"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxlen</span><span class='Delimiter'>; 
</span>    <span class='Control'>struct</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3728"></a>        <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>packetlen</span><span class='Delimiter'>; 
</span><a name="LN3729"></a>        <a href="../../include/libpq/pqcomm.h.html#LN191"><span class='Ref_to_Struct'>CancelRequestPacket</span></a> <span class='Declare_Member'>cp</span><span class='Delimiter'>; 
</span><a name="LN3730"></a>    <span class='Delimiter'>}</span>           <span class='Declare_Local'>crp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need to open a temporary connection to the postmaster. Do this with 
     * only kernel calls. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3723"><span class='Ref_To_Local'>tmpsock</span></a> <span class='Operator'>= </span><a href="../../include/port/win32.h.html#LN368"><span class='Ref_to_Macro'>socket</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3719"><span class='Ref_to_Parameter'>raddr</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Operator'>.</span>ss_family<span class='Delimiter'>, </span>SOCK_STREAM<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3720"><span class='Ref_to_Parameter'>errbuf</span></a><span class='Delimiter'>, </span><span class='String'>"PQcancel() -- socket() failed: "</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3720"><span class='Ref_to_Parameter'>errbufsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3794"><span class='Ref_to_Label'>cancel_errReturn</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><a name="LN3741"></a><span class='Label'>retry3</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN372"><span class='Ref_to_Macro'>connect</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3723"><span class='Ref_To_Local'>tmpsock</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>& </span><a href="fe-connect.c.html#LN3719"><span class='Ref_to_Parameter'>raddr</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/pqcomm.h.html#LN63"><span class='Ref_to_Member'>addr</span></a><span class='Delimiter'>, 
</span>                <a href="fe-connect.c.html#LN3719"><span class='Ref_to_Parameter'>raddr</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/pqcomm.h.html#LN64"><span class='Ref_to_Member'>salen</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a> <span class='Operator'>== </span><a href="win32.h.html#LN17"><span class='Ref_to_Const'>EINTR</span></a><span class='Parentheses'>) 
</span>            <span class='Comment_Multi_Line'>/* Interrupted system call - we'll just try again */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN3741"><span class='Ref_to_Label'>retry3</span></a><span class='Delimiter'>; 
</span>        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3720"><span class='Ref_to_Parameter'>errbuf</span></a><span class='Delimiter'>, </span><span class='String'>"PQcancel() -- connect() failed: "</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3720"><span class='Ref_to_Parameter'>errbufsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3794"><span class='Ref_to_Label'>cancel_errReturn</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We needn't set nonblocking I/O or NODELAY options here. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Create and send the cancel request packet. */ 
</span> 
    <a href="fe-connect.c.html#LN3730"><span class='Ref_To_Local'>crp</span></a><span class='Operator'>.</span><a href="fe-connect.c.html#LN3728"><span class='Ref_to_Member'>packetlen</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>((</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3730"><span class='Ref_To_Local'>crp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3730"><span class='Ref_To_Local'>crp</span></a><span class='Operator'>.</span><a href="fe-connect.c.html#LN3729"><span class='Ref_to_Member'>cp</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN194"><span class='Ref_to_Member'>cancelRequestCode</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN114"><span class='Ref_to_Typedef'>MsgType</span></a><span class='Parentheses'>) </span>htonl<span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN189"><span class='Ref_to_Const'>CANCEL_REQUEST_CODE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3730"><span class='Ref_To_Local'>crp</span></a><span class='Operator'>.</span><a href="fe-connect.c.html#LN3729"><span class='Ref_to_Member'>cp</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN195"><span class='Ref_to_Member'>backendPID</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3719"><span class='Ref_to_Parameter'>be_pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3730"><span class='Ref_To_Local'>crp</span></a><span class='Operator'>.</span><a href="fe-connect.c.html#LN3729"><span class='Ref_to_Member'>cp</span></a><span class='Operator'>.</span><a href="../../include/libpq/pqcomm.h.html#LN196"><span class='Ref_to_Member'>cancelAuthCode</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3719"><span class='Ref_to_Parameter'>be_key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN3763"></a><span class='Label'>retry4</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN375"><span class='Ref_to_Macro'>send</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3723"><span class='Ref_To_Local'>tmpsock</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3730"><span class='Ref_To_Local'>crp</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3730"><span class='Ref_To_Local'>crp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3730"><span class='Ref_To_Local'>crp</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a> <span class='Operator'>== </span><a href="win32.h.html#LN17"><span class='Ref_to_Const'>EINTR</span></a><span class='Parentheses'>) 
</span>            <span class='Comment_Multi_Line'>/* Interrupted system call - we'll just try again */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN3763"><span class='Ref_to_Label'>retry4</span></a><span class='Delimiter'>; 
</span>        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3720"><span class='Ref_to_Parameter'>errbuf</span></a><span class='Delimiter'>, </span><span class='String'>"PQcancel() -- send() failed: "</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3720"><span class='Ref_to_Parameter'>errbufsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN3794"><span class='Ref_to_Label'>cancel_errReturn</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Wait for the postmaster to close the connection, which indicates that 
     * it's processed the request.  Without this delay, we might issue another 
     * command only to find that our cancel zaps that command instead of the 
     * one we thought we were canceling.  Note we don't actually expect this 
     * read to obtain any data, we are just waiting for EOF to be signaled. 
     */ 
</span><a name="LN3780"></a><span class='Label'>retry5</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN374"><span class='Ref_to_Macro'>recv</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3723"><span class='Ref_To_Local'>tmpsock</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3730"><span class='Ref_To_Local'>crp</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a> <span class='Operator'>== </span><a href="win32.h.html#LN17"><span class='Ref_to_Const'>EINTR</span></a><span class='Parentheses'>) 
</span>            <span class='Comment_Multi_Line'>/* Interrupted system call - we'll just try again */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="fe-connect.c.html#LN3780"><span class='Ref_to_Label'>retry5</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* we ignore other error conditions */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* All done */ 
</span>    <a href="win32.h.html#LN11"><span class='Ref_to_Macro'>closesocket</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3723"><span class='Ref_To_Local'>tmpsock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="libpq-int.h.html#LN693"><span class='Ref_to_Macro'>SOCK_ERRNO_SET</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3722"><span class='Ref_To_Local'>save_errno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
<a name="LN3794"></a><span class='Label'>cancel_errReturn</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure we don't overflow the error buffer. Leave space for the \n at 
     * the end, and for the terminating zero. 
     */ 
</span>    <a href="fe-connect.c.html#LN3725"><span class='Ref_To_Local'>maxlen</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3720"><span class='Ref_to_Parameter'>errbufsize</span></a> <span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3720"><span class='Ref_to_Parameter'>errbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3725"><span class='Ref_To_Local'>maxlen</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        strncat<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3720"><span class='Ref_to_Parameter'>errbuf</span></a><span class='Delimiter'>, </span><a href="libpq-int.h.html#LN692"><span class='Ref_to_Const'>SOCK_STRERROR</span></a><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN691"><span class='Ref_to_Const'>SOCK_ERRNO</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3724"><span class='Ref_To_Local'>sebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3724"><span class='Ref_To_Local'>sebuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                <a href="fe-connect.c.html#LN3725"><span class='Ref_To_Local'>maxlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        strcat<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3720"><span class='Ref_to_Parameter'>errbuf</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3723"><span class='Ref_To_Local'>tmpsock</span></a> <span class='Operator'>!= </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Parentheses'>) 
</span>        <a href="win32.h.html#LN11"><span class='Ref_to_Macro'>closesocket</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3723"><span class='Ref_To_Local'>tmpsock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="libpq-int.h.html#LN693"><span class='Ref_to_Macro'>SOCK_ERRNO_SET</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3722"><span class='Ref_To_Local'>save_errno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end internal_cancel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQcancel: request query cancel 
 * 
 * Returns TRUE if able to send the cancel request, FALSE if not. 
 * 
 * On failure, an error message is stored in *errbuf, which must be of size 
 * errbufsize (recommended size is 256 bytes).  *errbuf is not changed on 
 * success return. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3823"></a><span class='Declare_Function'>PQcancel</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN152"><span class='Ref_to_Typedef'>PGcancel</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cancel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>errbuf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>errbufsize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3823"><span class='Ref_to_Parameter'>cancel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3823"><span class='Ref_to_Parameter'>errbuf</span></a><span class='Delimiter'>, </span><span class='String'>"PQcancel() -- no cancel object supplied"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3823"><span class='Ref_to_Parameter'>errbufsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN3718"><span class='Ref_to_Func'>internal_cancel</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3823"><span class='Ref_to_Parameter'>cancel</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN503"><span class='Ref_to_Member'>raddr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3823"><span class='Ref_to_Parameter'>cancel</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN504"><span class='Ref_to_Member'>be_pid</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3823"><span class='Ref_to_Parameter'>cancel</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN505"><span class='Ref_to_Member'>be_key</span></a><span class='Delimiter'>, 
</span>                           <a href="fe-connect.c.html#LN3823"><span class='Ref_to_Parameter'>errbuf</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3823"><span class='Ref_to_Parameter'>errbufsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * PQrequestCancel: old, not thread-safe function for requesting query cancel 
 * 
 * Returns TRUE if able to send the cancel request, FALSE if not. 
 * 
 * On failure, the error message is saved in conn-&GT;errorMessage; this means 
 * that this can't be used when there might be other active operations on 
 * the connection object. 
 * 
 * NOTE: error messages will be cut off at the current size of the 
 * error message buffer, since we dare not try to expand conn-&GT;errorMessage! 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3848"></a><span class='Declare_Function'>PQrequestCancel</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3850"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check we have an open connection */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>== </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                <span class='String'>"PQrequestCancel() -- connection is not open\n"</span><span class='Delimiter'>, 
</span>                <a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN47"><span class='Ref_to_Member'>maxlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="fe-connect.c.html#LN3850"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3718"><span class='Ref_to_Func'>internal_cancel</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN402"><span class='Ref_to_Member'>raddr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN419"><span class='Ref_to_Member'>be_pid</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN420"><span class='Ref_to_Member'>be_key</span></a><span class='Delimiter'>, 
</span>                        <a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN47"><span class='Ref_to_Member'>maxlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3850"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3848"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN3850"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PQrequestCancel &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * pqPacketSend() -- convenience routine to send a message to server. 
 * 
 * pack_type: the single-byte message type code.  (Pass zero for startup 
 * packets, which have no message type code.) 
 * 
 * buf, buf_len: contents of message.  The given length includes only what 
 * is in buf; the message type and message length fields are added here. 
 * 
 * RETURNS: STATUS_ERROR if the write fails, STATUS_OK otherwise. 
 * SIDE_EFFECTS: may block. 
 * 
 * Note: all messages sent with this routine have a length word, whether 
 * it's protocol 2.0 or 3.0. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3892"></a><span class='Declare_Function'>pqPacketSend</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>pack_type</span><span class='Delimiter'>, 
</span><a name="LN3893"></a>             <span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>buf_len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Start the message. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN519"><span class='Ref_to_Func'>pqPutMsgStart</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3892"><span class='Ref_to_Parameter'>pack_type</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3892"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/c.h.html#LN975"><span class='Ref_to_Const'>STATUS_ERROR</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Send the message body. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN246"><span class='Ref_to_Func'>pqPutnchar</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3893"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3893"><span class='Ref_to_Parameter'>buf_len</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3892"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/c.h.html#LN975"><span class='Ref_to_Const'>STATUS_ERROR</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Finish the message. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN587"><span class='Ref_to_Func'>pqPutMsgEnd</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3892"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/c.h.html#LN975"><span class='Ref_to_Const'>STATUS_ERROR</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Flush to ensure backend gets it. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN637"><span class='Ref_to_Proto'>pqFlush</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3892"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/c.h.html#LN975"><span class='Ref_to_Const'>STATUS_ERROR</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/c.h.html#LN974"><span class='Ref_to_Const'>STATUS_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqPacketSend &raquo; </span> 
 
<span class='Directive'>#ifdef</span> USE_LDAP 
 
<a name="LN3916"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LDAP_URL</span>    <span class='String'>"ldap://"</span> 
<a name="LN3917"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LDAP_DEF_PORT</span>   <span class='Number'>389</span> 
<a name="LN3918"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PGLDAP_TIMEOUT</span> <span class='Number'>2</span> 
 
<a name="LN3920"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ld_is_sp_tab</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>) ((</span><a href="fe-connect.c.html#LN3920"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>' '</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3920"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\t'</span><span class='Parentheses'>)</span> 
<a name="LN3921"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ld_is_nl_cr</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>) ((</span><a href="fe-connect.c.html#LN3921"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\r'</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3921"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>)</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *      ldapServiceLookup 
 * 
 * Search the LDAP URL passed as first argument, treat the result as a 
 * string of connection options that are parsed and added to the array of 
 * options passed as second argument. 
 * 
 * LDAP URLs must conform to RFC 1959 without escape sequences. 
 *  ldap://host:port/dn?attributes?scope?filter?extensions 
 * 
 * Returns 
 *  0 if the lookup was successful, 
 *  1 if the connection to the LDAP server could be established but 
 *    the search was unsuccessful, 
 *  2 if a connection could not be established, and 
 *  3 if a fatal error occurred. 
 * 
 * An error message is returned in the third argument for return codes 1 and 3. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3944"></a><span class='Declare_Function'>ldapServiceLookup</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>purl</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN3945"></a>                  <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3947"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>port</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3917"><span class='Ref_to_Const'>LDAP_DEF_PORT</span></a><span class='Delimiter'>, 
</span><a name="LN3948"></a>                <span class='Declare_Local'>scope</span><span class='Delimiter'>, 
</span><a name="LN3949"></a>                <span class='Declare_Local'>rc</span><span class='Delimiter'>, 
</span><a name="LN3950"></a>                <span class='Declare_Local'>size</span><span class='Delimiter'>, 
</span><a name="LN3951"></a>                <span class='Declare_Local'>state</span><span class='Delimiter'>, 
</span><a name="LN3952"></a>                <span class='Declare_Local'>oldstate</span><span class='Delimiter'>, 
</span><a name="LN3953"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN3955"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>msgid</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN3957"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found_keyword</span><span class='Delimiter'>; 
</span><a name="LN3958"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>url</span><span class='Delimiter'>, 
</span><a name="LN3959"></a>               <span class='Operator'>*</span><span class='Declare_Local'>hostname</span><span class='Delimiter'>, 
</span><a name="LN3960"></a>               <span class='Operator'>*</span><span class='Declare_Local'>portstr</span><span class='Delimiter'>, 
</span><a name="LN3961"></a>               <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>, 
</span><a name="LN3962"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dn</span><span class='Delimiter'>, 
</span><a name="LN3963"></a>               <span class='Operator'>*</span><span class='Declare_Local'>scopestr</span><span class='Delimiter'>, 
</span><a name="LN3964"></a>               <span class='Operator'>*</span><span class='Declare_Local'>filter</span><span class='Delimiter'>, 
</span><a name="LN3965"></a>               <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>, 
</span><a name="LN3966"></a>               <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>, 
</span><a name="LN3967"></a>               <span class='Operator'>*</span><span class='Declare_Local'>p1</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN3968"></a>               <span class='Operator'>*</span><span class='Declare_Local'>optname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN3969"></a>               <span class='Operator'>*</span><span class='Declare_Local'>optval</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3970"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attrs</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>}; 
</span><a name="LN3971"></a>    LDAP       <span class='Operator'>*</span><span class='Declare_Local'>ld</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3972"></a>    LDAPMessage <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>, 
</span><a name="LN3973"></a>               <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN3974"></a>    <span class='Control'>struct</span> berval <span class='Operator'>**</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN3975"></a>    <a href="fe-connect.c.html#LN67"><span class='Ref_to_Typedef'>LDAP_TIMEVAL</span></a> <span class='Declare_Local'>time</span> <span class='Operator'>= </span><span class='Delimiter'>{</span><a href="fe-connect.c.html#LN3918"><span class='Ref_to_Const'>PGLDAP_TIMEOUT</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>}; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>purl</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse URL components, check for correctness.  Basically, url has '\0' 
     * placed at component boundaries and variables are pointed at each 
     * component. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN67"><span class='Ref_to_Func'>pg_strncasecmp</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3916"><span class='Ref_to_Const'>LDAP_URL</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3916"><span class='Ref_to_Const'>LDAP_URL</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid LDAP URL \"%s\": scheme must be ldap://\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>purl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* hostname */ 
</span>    <a href="fe-connect.c.html#LN3959"><span class='Ref_To_Local'>hostname</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3916"><span class='Ref_to_Const'>LDAP_URL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3959"><span class='Ref_To_Local'>hostname</span></a> <span class='Operator'>== </span><span class='String'>'/'</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* no hostname? */ 
</span>        <a href="fe-connect.c.html#LN3959"><span class='Ref_To_Local'>hostname</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN100"><span class='Ref_to_Const'>DefaultHost</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* the default */ 
</span> 
    <span class='Comment_Multi_Line'>/* dn, "distinguished name" */ 
</span>    <a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3916"><span class='Ref_to_Const'>LDAP_URL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>'/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| *</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| *</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'?'</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>             <span class='String'>"invalid LDAP URL \"%s\": missing distinguished name\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>purl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>                  <span class='Comment_Single_Line'>/* terminate hostname */ 
</span>    <a href="fe-connect.c.html#LN3962"><span class='Ref_To_Local'>dn</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* attribute */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3962"><span class='Ref_To_Local'>dn</span></a><span class='Delimiter'>, </span><span class='String'>'?'</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| *</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| *</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'?'</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>        <span class='String'>"invalid LDAP URL \"%s\": must have exactly one attribute\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>purl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3970"><span class='Ref_To_Local'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* scope */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3970"><span class='Ref_To_Local'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>'?'</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| *</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| *</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'?'</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid LDAP URL \"%s\": must have search scope (base/one/sub)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>purl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3963"><span class='Ref_To_Local'>scopestr</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* filter */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3963"><span class='Ref_To_Local'>scopestr</span></a><span class='Delimiter'>, </span><span class='String'>'?'</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| *</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| *</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'?'</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid LDAP URL \"%s\": no filter\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>purl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN3964"><span class='Ref_To_Local'>filter</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3964"><span class='Ref_To_Local'>filter</span></a><span class='Delimiter'>, </span><span class='String'>'?'</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* port number? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3967"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3959"><span class='Ref_To_Local'>hostname</span></a><span class='Delimiter'>, </span><span class='String'>':'</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4051"></a>        <span class='Keyword'>long</span>        <span class='Declare_Local'>lport</span><span class='Delimiter'>; 
</span> 
        <span class='Operator'>*</span><a href="fe-connect.c.html#LN3967"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN3960"><span class='Ref_To_Local'>portstr</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3967"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN4051"><span class='Ref_To_Local'>lport</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3960"><span class='Ref_To_Local'>portstr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3961"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3960"><span class='Ref_To_Local'>portstr</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| *</span><a href="fe-connect.c.html#LN3961"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>|| </span>errno <span class='Operator'>|| </span><a href="fe-connect.c.html#LN4051"><span class='Ref_To_Local'>lport</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN4051"><span class='Ref_To_Local'>lport</span></a> <span class='Operator'>&GT; </span><span class='Number'>65535</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>                    <span class='String'>"invalid LDAP URL \"%s\": invalid port number\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>purl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="fe-connect.c.html#LN3947"><span class='Ref_To_Local'>port</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN4051"><span class='Ref_To_Local'>lport</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Allow only one attribute */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3970"><span class='Ref_To_Local'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='String'>','</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>        <span class='String'>"invalid LDAP URL \"%s\": must have exactly one attribute\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>purl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* set scope */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3963"><span class='Ref_To_Local'>scopestr</span></a><span class='Delimiter'>, </span><span class='String'>"base"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="fe-connect.c.html#LN3948"><span class='Ref_To_Local'>scope</span></a> <span class='Operator'>= </span>LDAP_SCOPE_BASE<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3963"><span class='Ref_To_Local'>scopestr</span></a><span class='Delimiter'>, </span><span class='String'>"one"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="fe-connect.c.html#LN3948"><span class='Ref_To_Local'>scope</span></a> <span class='Operator'>= </span>LDAP_SCOPE_ONELEVEL<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3963"><span class='Ref_To_Local'>scopestr</span></a><span class='Delimiter'>, </span><span class='String'>"sub"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="fe-connect.c.html#LN3948"><span class='Ref_To_Local'>scope</span></a> <span class='Operator'>= </span>LDAP_SCOPE_SUBTREE<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid LDAP URL \"%s\": must have search scope (base/one/sub)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>purl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* initialize LDAP structure */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a> <span class='Operator'>= </span>ldap_init<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3959"><span class='Ref_To_Local'>hostname</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3947"><span class='Ref_To_Local'>port</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not create LDAP structure\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Perform an explicit anonymous bind. 
     * 
     * LDAP does not require that an anonymous bind is performed explicitly, 
     * but we want to distinguish between the case where LDAP bind does not 
     * succeed within PGLDAP_TIMEOUT seconds (return 2 to continue parsing the 
     * service control file) and the case where querying the LDAP server fails 
     * (return 1 to end parsing). 
     * 
     * Unfortunately there is no way of setting a timeout that works for both 
     * Windows and OpenLDAP. 
     */ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Comment_Multi_Line'>/* the nonstandard ldap_connect function performs an anonymous bind */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>ldap_connect<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3975"><span class='Ref_To_Local'>time</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span>LDAP_SUCCESS<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* error or timeout in ldap_connect */ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* !WIN32 */ 
</span>    <span class='Comment_Multi_Line'>/* in OpenLDAP, use the LDAP_OPT_NETWORK_TIMEOUT option */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>ldap_set_option<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Delimiter'>, </span>LDAP_OPT_NETWORK_TIMEOUT<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3975"><span class='Ref_To_Local'>time</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span>LDAP_SUCCESS<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* anonymous bind */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3955"><span class='Ref_To_Local'>msgid</span></a> <span class='Operator'>= </span>ldap_simple_bind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* error or network timeout */ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* wait some time for the connection to succeed */ 
</span>    <a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3949"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span>ldap_result<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3955"><span class='Ref_To_Local'>msgid</span></a><span class='Delimiter'>, </span>LDAP_MSG_ALL<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3975"><span class='Ref_To_Local'>time</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span> <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>|| 
</span>        <a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* error or timeout */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            ldap_msgfree<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    ldap_msgfree<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* reset timeout */ 
</span>    <a href="fe-connect.c.html#LN3975"><span class='Ref_To_Local'>time</span></a><span class='Operator'>.</span>tv_sec <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>ldap_set_option<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Delimiter'>, </span>LDAP_OPT_NETWORK_TIMEOUT<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3975"><span class='Ref_To_Local'>time</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span>LDAP_SUCCESS<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
    <span class='Comment_Multi_Line'>/* search */ 
</span>    <a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3949"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span>ldap_search_st<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3962"><span class='Ref_To_Local'>dn</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3948"><span class='Ref_To_Local'>scope</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3964"><span class='Ref_To_Local'>filter</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3970"><span class='Ref_To_Local'>attrs</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3975"><span class='Ref_To_Local'>time</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span> 
        <span class='Operator'>!= </span>LDAP_SUCCESS<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            ldap_msgfree<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"lookup on LDAP server failed: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          ldap_err2string<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3949"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* complain if there was not exactly one result */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3949"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span>ldap_count_entries<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>             <a href="fe-connect.c.html#LN3949"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>? </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"more than one entry found on LDAP lookup\n"</span><span class='Parentheses'>) 
</span>                          <span class='Operator'>: </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"no entry found on LDAP lookup\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        ldap_msgfree<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* get entry */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3973"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span>ldap_first_entry<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* should never happen */ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"no entry found on LDAP lookup\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        ldap_msgfree<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* get values */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span>ldap_get_values_len<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3973"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3970"><span class='Ref_To_Local'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"attribute has no values on LDAP lookup\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        ldap_msgfree<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    ldap_msgfree<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3972"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3958"><span class='Ref_To_Local'>url</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"attribute has no values on LDAP lookup\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        ldap_value_free_len<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* concatenate values into a single string with newline terminators */ 
</span>    <a href="fe-connect.c.html#LN3950"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* for the trailing null */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN3950"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>+= </span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>bv_len <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN3965"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3950"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        ldap_value_free_len<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3965"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        memcpy<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>bv_val<span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>bv_len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>bv_len<span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\n'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    ldap_value_free_len<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3974"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    ldap_unbind<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3971"><span class='Ref_To_Local'>ld</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* parse result string */ 
</span>    <a href="fe-connect.c.html#LN3952"><span class='Ref_To_Local'>oldstate</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3965"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* between entries */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3920"><span class='Ref_to_Macro'>ld_is_sp_tab</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="fe-connect.c.html#LN3921"><span class='Ref_to_Macro'>ld_is_nl_cr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN3968"><span class='Ref_To_Local'>optname</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* in option name */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3920"><span class='Ref_to_Macro'>ld_is_sp_tab</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3921"><span class='Ref_to_Macro'>ld_is_nl_cr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>                    <span class='String'>"missing \"=\" after \"%s\" in connection info string\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN3968"><span class='Ref_To_Local'>optname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3965"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* after option name */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3920"><span class='Ref_to_Macro'>ld_is_sp_tab</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>                    <span class='String'>"missing \"=\" after \"%s\" in connection info string\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN3968"><span class='Ref_To_Local'>optname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3965"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* before option value */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\''</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN3969"><span class='Ref_To_Local'>optval</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN3967"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>5</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3921"><span class='Ref_to_Macro'>ld_is_nl_cr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN3969"><span class='Ref_To_Local'>optval</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3968"><span class='Ref_To_Local'>optname</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3968"><span class='Ref_To_Local'>optname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* empty */ 
</span>                    <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3920"><span class='Ref_to_Macro'>ld_is_sp_tab</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN3969"><span class='Ref_To_Local'>optval</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* in unquoted option value */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3920"><span class='Ref_to_Macro'>ld_is_sp_tab</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="fe-connect.c.html#LN3921"><span class='Ref_to_Macro'>ld_is_nl_cr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>5</span><span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* in quoted option value */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\''</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="fe-connect.c.html#LN3967"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                    <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>6</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3967"><span class='Ref_To_Local'>p1</span></a><span class='Operator'>++</span><span class='Parentheses'>) </span><span class='Operator'>= *</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>6</span><span class='Operator'>:</span>             <span class='Comment_Single_Line'>/* in quoted option value after escape */ 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3967"><span class='Ref_To_Local'>p1</span></a><span class='Operator'>++</span><span class='Parentheses'>) </span><span class='Operator'>= *</span><a href="fe-connect.c.html#LN3966"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Number'>5</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch state &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN3952"><span class='Ref_To_Local'>oldstate</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN3957"><span class='Ref_To_Local'>found_keyword</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN3968"><span class='Ref_To_Local'>optname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3969"><span class='Ref_To_Local'>optval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3944"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN3953"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                           <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3965"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="fe-connect.c.html#LN3957"><span class='Ref_To_Local'>found_keyword</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN3957"><span class='Ref_To_Local'>found_keyword</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                         <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid connection option \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN3968"><span class='Ref_To_Local'>optname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3965"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="fe-connect.c.html#LN3968"><span class='Ref_To_Local'>optname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN3969"><span class='Ref_To_Local'>optval</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if state==0&&oldstate!=0 &raquo; </span> 
        <a href="fe-connect.c.html#LN3952"><span class='Ref_To_Local'>oldstate</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for p=result;*p!='\0';++p &raquo; </span> 
 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3965"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Number'>5</span> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN3951"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Number'>6</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN3945"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>                  <span class='String'>"unterminated quoted string in connection info string\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ldapServiceLookup &raquo; </span> 
 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_LDAP */ 
</span> 
<a name="LN4387"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAXBUFSIZE</span> <span class='Number'>256</span> 
 
<span class='Keyword'>static int 
</span><a name="LN4390"></a><span class='Declare_Function'>parseServiceInfo</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4392"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>service</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN365"><span class='Ref_to_Proto'>conninfo_getval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4390"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><span class='String'>"service"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4393"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>serviceFile</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN4394"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>env</span><span class='Delimiter'>; 
</span><a name="LN4395"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>group_found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4396"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN4397"></a>    <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>stat_buf</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We have to special-case the environment variable PGSERVICE here, since 
     * this is and should be called before inserting environment defaults for 
     * other connection options. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4392"><span class='Ref_To_Local'>service</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN4392"><span class='Ref_To_Local'>service</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGSERVICE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4392"><span class='Ref_To_Local'>service</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN4394"><span class='Ref_To_Local'>env</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGSERVICEFILE"</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4393"><span class='Ref_To_Local'>serviceFile</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4394"><span class='Ref_To_Local'>env</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4393"><span class='Ref_To_Local'>serviceFile</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4414"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>homedir</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="libpq-int.h.html#LN546"><span class='Ref_to_Proto'>pqGetHomeDirectory</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4414"><span class='Ref_To_Local'>homedir</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4414"><span class='Ref_To_Local'>homedir</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4390"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"could not get home directory to locate service definition file"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4393"><span class='Ref_To_Local'>serviceFile</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4414"><span class='Ref_To_Local'>homedir</span></a><span class='Delimiter'>, </span><span class='String'>".pg_service.conf"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4393"><span class='Ref_To_Local'>serviceFile</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN4397"><span class='Ref_To_Local'>stat_buf</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>)</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN4431"><span class='Ref_to_Label'>next_file</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="fe-connect.c.html#LN4396"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN376"><span class='Ref_to_Proto'>parseServiceFile</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4393"><span class='Ref_To_Local'>serviceFile</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4392"><span class='Ref_To_Local'>service</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4390"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4390"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN4395"><span class='Ref_To_Local'>group_found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4395"><span class='Ref_To_Local'>group_found</span></a> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN4396"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="fe-connect.c.html#LN4396"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>; 
</span> 
<a name="LN4431"></a><span class='Label'>next_file</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This could be used by any application so we can't use the binary 
     * location to find our config files. 
     */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4393"><span class='Ref_To_Local'>serviceFile</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/pg_service.conf"</span><span class='Delimiter'>, 
</span>             getenv<span class='Parentheses'>(</span><span class='String'>"PGSYSCONFDIR"</span><span class='Parentheses'>) </span><span class='Operator'>? </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGSYSCONFDIR"</span><span class='Parentheses'>) </span><span class='Operator'>: </span>SYSCONFDIR<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4393"><span class='Ref_To_Local'>serviceFile</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN4397"><span class='Ref_To_Local'>stat_buf</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>)</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN4447"><span class='Ref_to_Label'>last_file</span></a><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN4396"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN376"><span class='Ref_to_Proto'>parseServiceFile</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4393"><span class='Ref_To_Local'>serviceFile</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4392"><span class='Ref_To_Local'>service</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4390"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4390"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN4395"><span class='Ref_To_Local'>group_found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4396"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="fe-connect.c.html#LN4396"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>; 
</span> 
<a name="LN4447"></a><span class='Label'>last_file</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN4395"><span class='Ref_To_Local'>group_found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4390"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>         <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"definition of service \"%s\" not found\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4392"><span class='Ref_To_Local'>service</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parseServiceInfo &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN4459"></a><span class='Declare_Function'>parseServiceFile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>serviceFile</span><span class='Delimiter'>, 
</span><a name="LN4460"></a>                 <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>service</span><span class='Delimiter'>, 
</span><a name="LN4461"></a>                 <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN4462"></a>                 <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, 
</span><a name="LN4463"></a>                 <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>group_found</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4465"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>linenr</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN4466"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4467"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>f</span><span class='Delimiter'>; 
</span><a name="LN4468"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4387"><span class='Ref_to_Const'>MAXBUFSIZE</span></a><span class='Delimiter'>], 
</span><a name="LN4469"></a>               <span class='Operator'>*</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4459"><span class='Ref_to_Parameter'>serviceFile</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4462"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"service file \"%s\" not found\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="fe-connect.c.html#LN4459"><span class='Ref_to_Parameter'>serviceFile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span>fgets<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4468"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4468"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN4465"><span class='Ref_To_Local'>linenr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4468"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4462"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"line %d too long in service file \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN4465"><span class='Ref_To_Local'>linenr</span></a><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN4459"><span class='Ref_to_Parameter'>serviceFile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* ignore EOL at end of line */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>[</span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>)</span> 
            <a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>[</span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ignore leading blanks */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ignore comments and empty lines */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'#'</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check for right groupname */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'['</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4463"><span class='Ref_to_Parameter'>group_found</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* group info already read */ 
</span>                fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4460"><span class='Ref_to_Parameter'>service</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4460"><span class='Ref_to_Parameter'>service</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                <a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>[</span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4460"><span class='Ref_to_Parameter'>service</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>']'</span><span class='Parentheses'>)</span> 
                <span class='Operator'>*</span><a href="fe-connect.c.html#LN4463"><span class='Ref_to_Parameter'>group_found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Operator'>*</span><a href="fe-connect.c.html#LN4463"><span class='Ref_to_Parameter'>group_found</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4463"><span class='Ref_to_Parameter'>group_found</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Finally, we are in the right group and can parse the line 
                 */ 
</span><a name="LN4528"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>, 
</span><a name="LN4529"></a>                           <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN4530"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>found_keyword</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> USE_LDAP 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><span class='String'>"ldap"</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span><a name="LN4535"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN69"><span class='Ref_to_Proto'>ldapServiceLookup</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4461"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4462"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* if rc = 2, go on reading for fallback */ 
</span>                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4535"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>                            fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>                            fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
                <a href="fe-connect.c.html#LN4528"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN4529"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4469"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><span class='String'>'='</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4529"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4462"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"syntax error in service file \"%s\", line %d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN4459"><span class='Ref_to_Parameter'>serviceFile</span></a><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN4465"><span class='Ref_To_Local'>linenr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Operator'>*</span><a href="fe-connect.c.html#LN4529"><span class='Ref_To_Local'>val</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4528"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='String'>"service"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4462"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"nested service specifications not supported in service file \"%s\", line %d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN4459"><span class='Ref_to_Parameter'>serviceFile</span></a><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN4465"><span class='Ref_To_Local'>linenr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Set the parameter --- but don't override any previous 
                 * explicit setting. 
                 */ 
</span>                <a href="fe-connect.c.html#LN4530"><span class='Ref_To_Local'>found_keyword</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4466"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN4461"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN4466"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4461"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4528"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4461"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                            <a href="fe-connect.c.html#LN4461"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4529"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN4461"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4462"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                           <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                            fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <a href="fe-connect.c.html#LN4530"><span class='Ref_To_Local'>found_keyword</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN4530"><span class='Ref_To_Local'>found_keyword</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4462"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"syntax error in service file \"%s\", line %d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN4459"><span class='Ref_to_Parameter'>serviceFile</span></a><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN4465"><span class='Ref_To_Local'>linenr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *group_found &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (line=fgets(buf,sizeo... &raquo; </span> 
 
    fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4467"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parseServiceFile &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *      PQconninfoParse 
 * 
 * Parse a string like PQconnectdb() would do and return the 
 * resulting connection options array.  NULL is returned on failure. 
 * The result contains only options specified directly in the string, 
 * not any possible default values. 
 * 
 * If errmsg isn't NULL, *errmsg is set to NULL on success, or a malloc'd 
 * string on failure (use PQfreemem to free it).  In out-of-memory conditions 
 * both *errmsg and the result could be NULL. 
 * 
 * NOTE: the returned array is dynamically allocated and should 
 * be freed when no longer needed via PQconninfoFree(). 
 */ 
</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>* 
</span><a name="LN4634"></a><span class='Declare_Function'>PQconninfoParse</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conninfo</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>errmsg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4636"></a>    <a href="pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>errorBuf</span><span class='Delimiter'>; 
</span><a name="LN4637"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>connOptions</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4634"><span class='Ref_to_Parameter'>errmsg</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="fe-connect.c.html#LN4634"><span class='Ref_to_Parameter'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* default */ 
</span>    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN4636"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN66"><span class='Ref_to_Macro'>PQExpBufferDataBroken</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4636"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* out of memory already :-( */ 
</span>    <a href="fe-connect.c.html#LN4637"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN345"><span class='Ref_to_Proto'>parse_connection_string</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4634"><span class='Ref_to_Parameter'>conninfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN4636"><span class='Ref_To_Local'>errorBuf</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4637"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN4634"><span class='Ref_to_Parameter'>errmsg</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="fe-connect.c.html#LN4634"><span class='Ref_to_Parameter'>errmsg</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4636"><span class='Ref_To_Local'>errorBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN4636"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN4637"><span class='Ref_To_Local'>connOptions</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Build a working copy of the constant PQconninfoOptions array. 
 */ 
</span><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>* 
</span><a name="LN4656"></a><span class='Declare_Function'>conninfo_init</span><span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4658"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span><a name="LN4659"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>opt_dest</span><span class='Delimiter'>; 
</span><a name="LN4660"></a>    <span class='Keyword'>const </span><a href="fe-connect.c.html#LN139"><span class='Ref_to_Typedef'>internalPQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_opt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get enough memory for all options in PQconninfoOptions, even if some 
     * end up being filtered out. 
     */ 
</span>    <a href="fe-connect.c.html#LN4658"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN161"><span class='Ref_to_Global_Var'>PQconninfoOptions</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN161"><span class='Ref_to_Global_Var'>PQconninfoOptions</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4658"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4656"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN4659"><span class='Ref_To_Local'>opt_dest</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4658"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4660"><span class='Ref_To_Local'>cur_opt</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN161"><span class='Ref_to_Global_Var'>PQconninfoOptions</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN4660"><span class='Ref_To_Local'>cur_opt</span></a><span class='Operator'>-&GT;</span><a href="fe-connect.c.html#LN141"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN4660"><span class='Ref_To_Local'>cur_opt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Only copy the public part of the struct, not the full internal */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4659"><span class='Ref_To_Local'>opt_dest</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4660"><span class='Ref_To_Local'>cur_opt</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN4659"><span class='Ref_To_Local'>opt_dest</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4659"><span class='Ref_To_Local'>opt_dest</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN4658"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end conninfo_init &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Connection string parser 
 * 
 * Returns a malloc'd PQconninfoOption array, if parsing is successful. 
 * Otherwise, NULL is returned and an error message is left in errorMessage. 
 * 
 * If use_defaults is TRUE, default values are filled in (from a service file, 
 * environment variables, etc). 
 */ 
</span><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>* 
</span><a name="LN4696"></a><span class='Declare_Function'>parse_connection_string</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>connstr</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, 
</span><a name="LN4697"></a>                        <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_defaults</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Parse as URI if connection string matches URI prefix */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN347"><span class='Ref_to_Proto'>uri_prefix_length</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4696"><span class='Ref_to_Parameter'>connstr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="fe-connect.c.html#LN356"><span class='Ref_to_Proto'>conninfo_uri_parse</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4696"><span class='Ref_to_Parameter'>connstr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4696"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4697"><span class='Ref_to_Parameter'>use_defaults</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parse as default otherwise */ 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN349"><span class='Ref_to_Proto'>conninfo_parse</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4696"><span class='Ref_to_Parameter'>connstr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4696"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4697"><span class='Ref_to_Parameter'>use_defaults</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Checks if connection string starts with either of the valid URI prefix 
 * designators. 
 * 
 * Returns the URI prefix length, 0 if the string doesn't contain a URI prefix. 
 * 
 * XXX this is duplicated in psql/common.c. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4716"></a><span class='Declare_Function'>uri_prefix_length</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>connstr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4716"><span class='Ref_to_Parameter'>connstr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN330"><span class='Ref_to_Global_Var'>uri_designator</span></a><span class='Delimiter'>, 
</span>                <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN330"><span class='Ref_to_Global_Var'>uri_designator</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN330"><span class='Ref_to_Global_Var'>uri_designator</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4716"><span class='Ref_to_Parameter'>connstr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN331"><span class='Ref_to_Global_Var'>short_uri_designator</span></a><span class='Delimiter'>, 
</span>                <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN331"><span class='Ref_to_Global_Var'>short_uri_designator</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN331"><span class='Ref_to_Global_Var'>short_uri_designator</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Recognized connection string either starts with a valid URI prefix or 
 * contains a "=" in it. 
 * 
 * Must be consistent with parse_connection_string: anything for which this 
 * returns true should at least look like it's parseable by that routine. 
 * 
 * XXX this is duplicated in psql/common.c 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4739"></a><span class='Declare_Function'>recognized_connection_string</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>connstr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN347"><span class='Ref_to_Proto'>uri_prefix_length</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4739"><span class='Ref_to_Parameter'>connstr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span>strchr<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4739"><span class='Ref_to_Parameter'>connstr</span></a><span class='Delimiter'>, </span><span class='String'>'='</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Subroutine for parse_connection_string 
 * 
 * Deal with a string containing key=value pairs. 
 */ 
</span><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>* 
</span><a name="LN4750"></a><span class='Declare_Function'>conninfo_parse</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conninfo</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, 
</span><a name="LN4751"></a>               <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_defaults</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4753"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pname</span><span class='Delimiter'>; 
</span><a name="LN4754"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pval</span><span class='Delimiter'>; 
</span><a name="LN4755"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN4756"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN4757"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp2</span><span class='Delimiter'>; 
</span><a name="LN4758"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a working copy of PQconninfoOptions */ 
</span>    <a href="fe-connect.c.html#LN4758"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN344"><span class='Ref_to_Proto'>conninfo_init</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4750"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4758"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Need a modifiable copy of the input string */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN4755"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4750"><span class='Ref_to_Parameter'>conninfo</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4750"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4758"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4755"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Skip blanks before the parameter name */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Get the parameter name */ 
</span>        <a href="fe-connect.c.html#LN4753"><span class='Ref_To_Local'>pname</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Check that there is a following '=' */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4750"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"missing \"=\" after \"%s\" in connection info string\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN4753"><span class='Ref_To_Local'>pname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4758"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4755"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Skip blanks after the '=' */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Get the parameter value */ 
</span>        <a href="fe-connect.c.html#LN4754"><span class='Ref_To_Local'>pval</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\''</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN4757"><span class='Ref_To_Local'>cp2</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4754"><span class='Ref_To_Local'>pval</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Operator'>*</span><a href="fe-connect.c.html#LN4757"><span class='Ref_To_Local'>cp2</span></a><span class='Operator'>++ = *</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <span class='Operator'>*</span><a href="fe-connect.c.html#LN4757"><span class='Ref_To_Local'>cp2</span></a><span class='Operator'>++ = *</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="fe-connect.c.html#LN4757"><span class='Ref_To_Local'>cp2</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *cp!='\'' &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN4757"><span class='Ref_To_Local'>cp2</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4754"><span class='Ref_To_Local'>pval</span></a><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4750"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"unterminated quoted string in connection info string\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4758"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4755"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Operator'>*</span><a href="fe-connect.c.html#LN4757"><span class='Ref_To_Local'>cp2</span></a><span class='Operator'>++ = *</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'\''</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="fe-connect.c.html#LN4757"><span class='Ref_To_Local'>cp2</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                    <a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Operator'>*</span><a href="fe-connect.c.html#LN4757"><span class='Ref_To_Local'>cp2</span></a><span class='Operator'>++ = *</span><a href="fe-connect.c.html#LN4756"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Now that we have the name and the value, store the record. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN367"><span class='Ref_to_Proto'>conninfo_storeval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4758"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4753"><span class='Ref_To_Local'>pname</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4754"><span class='Ref_To_Local'>pval</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4750"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4758"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4755"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *cp &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Done with the modifiable input string */ 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4755"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add in defaults if the caller wants that. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4751"><span class='Ref_to_Parameter'>use_defaults</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN354"><span class='Ref_to_Proto'>conninfo_add_defaults</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4758"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4750"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4758"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN4758"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end conninfo_parse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Conninfo array parser routine 
 * 
 * If successful, a malloc'd PQconninfoOption array is returned. 
 * If not successful, NULL is returned and an error message is 
 * left in errorMessage. 
 * Defaults are supplied (from a service file, environment variables, etc) 
 * for unspecified options, but only if use_defaults is TRUE. 
 * 
 * If expand_dbname is non-zero, and the value passed for the first occurrence 
 * of "dbname" keyword is a connection string (as indicated by 
 * recognized_connection_string) then parse and process it, overriding any 
 * previously processed conflicting keywords. Subsequent keywords will take 
 * precedence, however. In-tree programs generally specify expand_dbname=true, 
 * so command-line arguments naming a database can use a connection string. 
 * Some code acquires arbitrary database names from known-literal sources like 
 * PQdb(), PQconninfoParse() and pg_database.datname.  When connecting to such 
 * a database, in-tree code first wraps the name in a connection string. 
 */ 
</span><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>* 
</span><a name="LN4928"></a><span class='Declare_Function'>conninfo_array_parse</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>keywords</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>* </span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN4929"></a>                     <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>use_defaults</span><span class='Delimiter'>, 
</span><a name="LN4930"></a>                     <span class='Keyword'>int </span><span class='Declare_Parameter'>expand_dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4932"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span><a name="LN4933"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dbname_options</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4934"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span><a name="LN4935"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If expand_dbname is non-zero, check keyword "dbname" to see if val is 
     * actually a recognized connection string. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4930"><span class='Ref_to_Parameter'>expand_dbname</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN4928"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4935"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4943"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>pname</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4928"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4935"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN4944"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>pvalue</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4928"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4935"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* first find "dbname" if any */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4943"><span class='Ref_To_Local'>pname</span></a><span class='Delimiter'>, </span><span class='String'>"dbname"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN4944"><span class='Ref_To_Local'>pvalue</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If value is a connection string, parse it, but do not use 
             * defaults here -- those get picked up later. We only want to 
             * override for those parameters actually passed. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../bin/psql/common.h.html#LN46"><span class='Ref_to_Proto'>recognized_connection_string</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4944"><span class='Ref_To_Local'>pvalue</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN345"><span class='Ref_to_Proto'>parse_connection_string</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4944"><span class='Ref_To_Local'>pvalue</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4929"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>++</span><a href="fe-connect.c.html#LN4935"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while expand_dbname&&keywor... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Make a working copy of PQconninfoOptions */ 
</span>    <a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN344"><span class='Ref_to_Proto'>conninfo_init</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4929"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Parse the keywords/values arrays */ 
</span>    <a href="fe-connect.c.html#LN4935"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4928"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4935"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4977"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>pname</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4928"><span class='Ref_to_Parameter'>keywords</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4935"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN4978"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>pvalue</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4928"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN4935"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4978"><span class='Ref_To_Local'>pvalue</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN4978"><span class='Ref_To_Local'>pvalue</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Search for the param record */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4934"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN4934"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN4934"><span class='Ref_To_Local'>option</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4934"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4977"><span class='Ref_To_Local'>pname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Check for invalid connection option */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4934"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4929"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                         <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid connection option \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN4977"><span class='Ref_To_Local'>pname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If we are on the first dbname parameter, and we have a parsed 
             * connection string, copy those parameters across, overriding any 
             * existing previous settings. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4977"><span class='Ref_To_Local'>pname</span></a><span class='Delimiter'>, </span><span class='String'>"dbname"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><a name="LN5007"></a>                <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>str_option</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5007"><span class='Ref_To_Local'>str_option</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5007"><span class='Ref_To_Local'>str_option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5007"><span class='Ref_To_Local'>str_option</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5007"><span class='Ref_To_Local'>str_option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN5013"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>k</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5013"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN5013"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5013"><span class='Ref_To_Local'>k</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN5013"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5007"><span class='Ref_To_Local'>str_option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <span class='Delimiter'>{ 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN5013"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) 
</span>                                    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN5013"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN5013"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5007"><span class='Ref_To_Local'>str_option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN5013"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) 
</span>                                <span class='Delimiter'>{ 
</span>                                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4929"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                           <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                                    <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                    <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                                <span class='Delimiter'>} 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if str_option-&GT;val!=NULL &raquo; </span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for str_option=dbname_opt... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * Forget the parsed connection string, so that any subsequent 
                 * dbname parameters will not be expanded. 
                 */ 
</span>                <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(pname,"dbname"... &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Store the value, overriding previous settings 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4934"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4934"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-connect.c.html#LN4934"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4978"><span class='Ref_To_Local'>pvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN4934"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4929"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pvalue!=NULL&&pvalue[... &raquo; </span> 
        <span class='Operator'>++</span><a href="fe-connect.c.html#LN4935"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while keywords[i] &raquo; </span> 
    <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4933"><span class='Ref_To_Local'>dbname_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add in defaults if the caller wants that. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4929"><span class='Ref_to_Parameter'>use_defaults</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN354"><span class='Ref_to_Proto'>conninfo_add_defaults</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN4929"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN4932"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end conninfo_array_parse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add the default values for any unspecified options to the connection 
 * options array. 
 * 
 * Defaults are obtained from a service file, environment variables, etc. 
 * 
 * Returns TRUE if successful, otherwise FALSE; errorMessage, if supplied, 
 * is filled in upon failure.  Note that failure to locate a default value 
 * is not an error condition here --- we just leave the option's value as 
 * NULL. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN5092"></a><span class='Declare_Function'>conninfo_add_defaults</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5094"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span><a name="LN5095"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there's a service spec, use it to obtain any not-explicitly-given 
     * parameters.  Ignore error if no error message buffer is passed because 
     * there is no way to pass back the failure message. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN374"><span class='Ref_to_Proto'>parseServiceInfo</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5092"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5092"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN5092"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the fallback resources for parameters not specified in the conninfo 
     * string nor the service. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5092"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* Value was in conninfo or service */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Try to get the environment variable fallback 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN203"><span class='Ref_to_Member'>envvar</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN5095"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN203"><span class='Ref_to_Member'>envvar</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5095"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5092"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>) 
</span>                        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5092"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Interpret the deprecated PGREQUIRESSL environment variable.  Per 
         * tradition, translate values starting with "1" to sslmode=require, 
         * and ignore other values.  Given both PGREQUIRESSL=1 and PGSSLMODE, 
         * PGSSLMODE takes precedence; the opposite was true before v9.3. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><span class='String'>"sslmode"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN5141"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>requiresslenv</span> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGREQUIRESSL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5141"><span class='Ref_To_Local'>requiresslenv</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN5141"><span class='Ref_To_Local'>requiresslenv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'1'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><span class='String'>"require"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5092"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>) 
</span>                        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5092"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * No environment variable specified or the variable isn't set - try 
         * compiled-in default 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN204"><span class='Ref_to_Member'>compiled</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN204"><span class='Ref_to_Member'>compiled</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5092"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>) 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5092"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Special handling for "user" option.  Note that if pg_fe_getauthname 
         * fails, we just leave the value as NULL; there's no need for this to 
         * be an error condition if the caller provides a user name.  The only 
         * reason we do this now at all is so that callers of PQconndefaults 
         * will see a correct default (barring error, of course). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><span class='String'>"user"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN5094"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="fe-auth.h.html#LN22"><span class='Ref_to_Proto'>pg_fe_getauthname</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for option=options;option... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end conninfo_add_defaults &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Subroutine for parse_connection_string 
 * 
 * Deal with a URI connection string. 
 */ 
</span><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>* 
</span><a name="LN5197"></a><span class='Declare_Function'>conninfo_uri_parse</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>uri</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, 
</span><a name="LN5198"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_defaults</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5200"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a working copy of PQconninfoOptions */ 
</span>    <a href="fe-connect.c.html#LN5200"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN344"><span class='Ref_to_Proto'>conninfo_init</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5197"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5200"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN358"><span class='Ref_to_Proto'>conninfo_uri_parse_options</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5200"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5197"><span class='Ref_to_Parameter'>uri</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5197"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5200"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add in defaults if the caller wants that. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5198"><span class='Ref_to_Parameter'>use_defaults</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN354"><span class='Ref_to_Proto'>conninfo_add_defaults</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5200"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5197"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="libpq-fe.h.html#LN284"><span class='Ref_to_Proto'>PQconninfoFree</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5200"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5200"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end conninfo_uri_parse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * conninfo_uri_parse_options 
 *      Actual URI parser. 
 * 
 * If successful, returns true while the options array is filled with parsed 
 * options from the URI. 
 * If not successful, returns false and fills errorMessage accordingly. 
 * 
 * Parses the connection URI string in 'uri' according to the URI syntax (RFC 
 * 3986): 
 * 
 * postgresql://[user[:password]@][netloc][:port][/dbname][?param1=value1&...] 
 * 
 * where "netloc" is a hostname, an IPv4 address, or an IPv6 address surrounded 
 * by literal square brackets.  As an extension, we also allow multiple 
 * netloc[:port] specifications, separated by commas: 
 * 
 * postgresql://[user[:password]@][netloc][:port][,...][/dbname][?param1=value1&...] 
 * 
 * Any of the URI parts might use percent-encoding (%xy). 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN5250"></a><span class='Declare_Function'>conninfo_uri_parse_options</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>uri</span><span class='Delimiter'>, 
</span><a name="LN5251"></a>                           <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5253"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>prefix_len</span><span class='Delimiter'>; 
</span><a name="LN5254"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN5255"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN5256"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start</span><span class='Delimiter'>; 
</span><a name="LN5257"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>prevchar</span> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span><a name="LN5258"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>user</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN5259"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>host</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN5260"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>retval</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN5261"></a>    <a href="pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>hostbuf</span><span class='Delimiter'>; 
</span><a name="LN5262"></a>    <a href="pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>portbuf</span><span class='Delimiter'>; 
</span> 
    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5261"><span class='Ref_To_Local'>hostbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5262"><span class='Ref_To_Local'>portbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN66"><span class='Ref_to_Macro'>PQExpBufferDataBroken</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5261"><span class='Ref_To_Local'>hostbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="pqexpbuffer.h.html#LN66"><span class='Ref_to_Macro'>PQExpBufferDataBroken</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5262"><span class='Ref_To_Local'>portbuf</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* need a modifiable copy of the input URI */ 
</span>    <a href="fe-connect.c.html#LN5255"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>uri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5255"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN5256"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5255"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip the URI prefix */ 
</span>    <a href="fe-connect.c.html#LN5253"><span class='Ref_To_Local'>prefix_len</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN347"><span class='Ref_to_Proto'>uri_prefix_length</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>uri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5253"><span class='Ref_To_Local'>prefix_len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Should never happen */ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid URI propagated to internal parser routine: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>uri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN5256"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>+= </span><a href="fe-connect.c.html#LN5253"><span class='Ref_To_Local'>prefix_len</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5256"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look ahead for possible user credentials designator */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'@'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'/'</span><span class='Parentheses'>) 
</span>        <span class='Operator'>++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'@'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Found username/password designator, so URI should be of the form 
         * "scheme://user[:password]@[netloc]". 
         */ 
</span>        <a href="fe-connect.c.html#LN5258"><span class='Ref_To_Local'>user</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5256"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>; 
</span> 
        <a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5258"><span class='Ref_To_Local'>user</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>':'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'@'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Save last char and cut off at end of user name */ 
</span>        <a href="fe-connect.c.html#LN5257"><span class='Ref_To_Local'>prevchar</span></a> <span class='Operator'>= *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5258"><span class='Ref_To_Local'>user</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="fe-connect.c.html#LN367"><span class='Ref_to_Proto'>conninfo_storeval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><span class='String'>"user"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5258"><span class='Ref_To_Local'>user</span></a><span class='Delimiter'>, 
</span>                               <a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5257"><span class='Ref_To_Local'>prevchar</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5322"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>password</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'@'</span><span class='Parentheses'>) 
</span>                <span class='Operator'>++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5322"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="fe-connect.c.html#LN367"><span class='Ref_to_Proto'>conninfo_storeval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><span class='String'>"password"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5322"><span class='Ref_To_Local'>password</span></a><span class='Delimiter'>, 
</span>                                   <a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Advance past end of parsed user name or password token */ 
</span>        <span class='Operator'>++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *p=='@' &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * No username/password designator found.  Reset to start of URI. 
         */ 
</span>        <a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5256"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * There may be multiple netloc[:port] pairs, each separated from the next 
     * by a comma.  When we initially enter this loop, "p" has been 
     * incremented past optional URI credential information at this point and 
     * now points at the "netloc" part of the URI.  On subsequent loop 
     * iterations, "p" has been incremented past the comma separator and now 
     * points at the start of the next "netloc". 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Look for IPv6 address. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'['</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN5259"><span class='Ref_To_Local'>host</span></a> <span class='Operator'>= ++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>']'</span><span class='Parentheses'>) 
</span>                <span class='Operator'>++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"end of string reached when looking for matching \"]\" in IPv6 host address in URI: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>uri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><a href="fe-connect.c.html#LN5259"><span class='Ref_To_Local'>host</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"IPv6 host address may not be empty in URI: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>uri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Cut off the bracket and advance */ 
</span>            <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The address may be followed by a port specifier or a slash or a 
             * query or a separator comma. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>':'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'/'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'?'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>','</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected character \"%c\" at position %d in URI (expected \":\" or \"/\"): \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="fe-connect.c.html#LN5255"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>uri</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *p=='[' &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* not an IPv6 address: DNS-named or IPv4 netloc */ 
</span>            <a href="fe-connect.c.html#LN5259"><span class='Ref_To_Local'>host</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Look for port specifier (colon) or end of host specifier 
             * (slash) or query (question mark) or host separator (comma). 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>':'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'/'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'?'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>','</span><span class='Parentheses'>) 
</span>                <span class='Operator'>++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Save the hostname terminator before we null it */ 
</span>        <a href="fe-connect.c.html#LN5257"><span class='Ref_To_Local'>prevchar</span></a> <span class='Operator'>= *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5261"><span class='Ref_To_Local'>hostbuf</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5259"><span class='Ref_To_Local'>host</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5257"><span class='Ref_To_Local'>prevchar</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5414"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>port</span> <span class='Operator'>= ++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* advance past host terminator */ 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'/'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'?'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>','</span><span class='Parentheses'>) 
</span>                <span class='Operator'>++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span> 
            <a href="fe-connect.c.html#LN5257"><span class='Ref_To_Local'>prevchar</span></a> <span class='Operator'>= *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5262"><span class='Ref_To_Local'>portbuf</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5414"><span class='Ref_To_Local'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5257"><span class='Ref_To_Local'>prevchar</span></a> <span class='Operator'>!= </span><span class='String'>','</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Operator'>++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>;</span>                    <span class='Comment_Single_Line'>/* advance past comma separator */ 
</span>        <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5261"><span class='Ref_To_Local'>hostbuf</span></a><span class='Delimiter'>, </span><span class='String'>","</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5262"><span class='Ref_To_Local'>portbuf</span></a><span class='Delimiter'>, </span><span class='String'>","</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Save final values for host and port. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN66"><span class='Ref_to_Macro'>PQExpBufferDataBroken</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5261"><span class='Ref_To_Local'>hostbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="pqexpbuffer.h.html#LN66"><span class='Ref_to_Macro'>PQExpBufferDataBroken</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5262"><span class='Ref_To_Local'>portbuf</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5261"><span class='Ref_To_Local'>hostbuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="fe-connect.c.html#LN367"><span class='Ref_to_Proto'>conninfo_storeval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><span class='String'>"host"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5261"><span class='Ref_To_Local'>hostbuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                           <a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5262"><span class='Ref_To_Local'>portbuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="fe-connect.c.html#LN367"><span class='Ref_to_Proto'>conninfo_storeval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><span class='String'>"port"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5262"><span class='Ref_To_Local'>portbuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                           <a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5257"><span class='Ref_To_Local'>prevchar</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN5257"><span class='Ref_To_Local'>prevchar</span></a> <span class='Operator'>!= </span><span class='String'>'?'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5446"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>dbname</span> <span class='Operator'>= ++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* advance past host terminator */ 
</span> 
        <span class='Comment_Multi_Line'>/* Look for query parameters */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'?'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span> 
        <a href="fe-connect.c.html#LN5257"><span class='Ref_To_Local'>prevchar</span></a> <span class='Operator'>= *</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Avoid setting dbname to an empty string, as it forces the default 
         * value (username) and ignores $PGDATABASE, as opposed to not setting 
         * it at all. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5446"><span class='Ref_To_Local'>dbname</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="fe-connect.c.html#LN367"><span class='Ref_to_Proto'>conninfo_storeval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><span class='String'>"dbname"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5446"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, 
</span>                               <a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if prevchar&&prevchar!='... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5257"><span class='Ref_To_Local'>prevchar</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>++</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>;</span>                    <span class='Comment_Single_Line'>/* advance past terminator */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN360"><span class='Ref_to_Proto'>conninfo_uri_parse_params</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5254"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5250"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5251"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-connect.c.html#LN5477"><span class='Ref_to_Label'>cleanup</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* everything parsed okay */ 
</span>    <a href="fe-connect.c.html#LN5260"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<a name="LN5477"></a><span class='Label'>cleanup</span><span class='Operator'>: 
</span>    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5261"><span class='Ref_To_Local'>hostbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5262"><span class='Ref_To_Local'>portbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5255"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5255"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5260"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end conninfo_uri_parse_options &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Connection URI parameters parser routine 
 * 
 * If successful, returns true while connOptions is filled with parsed 
 * parameters.  Otherwise, returns false and fills errorMessage appropriately. 
 * 
 * Destructively modifies 'params' buffer. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN5494"></a><span class='Declare_Function'>conninfo_uri_parse_params</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN5495"></a>                          <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Delimiter'>, 
</span><a name="LN5496"></a>                          <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5494"><span class='Ref_to_Parameter'>params</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5500"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>keyword</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5494"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>; 
</span><a name="LN5501"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>value</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN5502"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5494"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>; 
</span><a name="LN5503"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>malloced</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Scan the params string for '=' and '&', marking the end of keyword 
         * and value respectively. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5502"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Was there '=' already? */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5496"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"extra key/value separator \"=\" in URI query parameter: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* Cut off keyword, advance to value */ 
</span>                <span class='Operator'>*</span><a href="fe-connect.c.html#LN5502"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Keyword'>value </span><span class='Operator'>= </span><a href="fe-connect.c.html#LN5502"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5502"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'&'</span> <span class='Operator'>|| *</span><a href="fe-connect.c.html#LN5502"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If not at the end, cut off value and advance; leave p 
                 * pointing to start of the next parameter, if any. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5502"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="fe-connect.c.html#LN5502"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Was there '=' at all? */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5496"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"missing key/value separator \"=\" in URI query parameter: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* Got keyword and value, go process them. */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Operator'>++</span><a href="fe-connect.c.html#LN5502"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* Advance over all other bytes. */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
        <a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN363"><span class='Ref_to_Proto'>conninfo_uri_decode</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5496"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* conninfo_uri_decode already set an error message */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="fe-connect.c.html#LN363"><span class='Ref_to_Proto'>conninfo_uri_decode</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5496"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* conninfo_uri_decode already set an error message */ 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="fe-connect.c.html#LN5503"><span class='Ref_To_Local'>malloced</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Special keyword handling for improved JDBC compatibility. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a><span class='Delimiter'>, </span><span class='String'>"ssl"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            strcmp<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN5503"><span class='Ref_To_Local'>malloced</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a> <span class='Operator'>= </span><span class='String'>"sslmode"</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><span class='String'>"require"</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Store the value if the corresponding option exists; ignore 
         * otherwise.  At this point both keyword and value are not 
         * URI-encoded. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN367"><span class='Ref_to_Proto'>conninfo_storeval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5495"><span class='Ref_to_Parameter'>connOptions</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                               <a href="fe-connect.c.html#LN5496"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Insert generic message if conninfo_storeval didn't give one. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5496"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Operator'>-&GT;</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5496"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid URI query parameter: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* And fail. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5503"><span class='Ref_To_Local'>malloced</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5503"><span class='Ref_To_Local'>malloced</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5500"><span class='Ref_To_Local'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Proceed to next key=value pair, if any */ 
</span>        <a href="fe-connect.c.html#LN5494"><span class='Ref_to_Parameter'>params</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5502"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *params &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end conninfo_uri_parse_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Connection URI decoder routine 
 * 
 * If successful, returns the malloc'd decoded string. 
 * If not successful, returns NULL and fills errorMessage accordingly. 
 * 
 * The string is decoded by replacing any percent-encoded tokens with 
 * corresponding characters, while preserving any non-encoded characters.  A 
 * percent-encoded token is a character triplet: a percent sign, followed by a 
 * pair of hexadecimal digits (0-9A-F), where lower- and upper-case letters are 
 * treated identically. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN5625"></a><span class='Declare_Function'>conninfo_uri_decode</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5627"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN5628"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN5629"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>q</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5625"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN5627"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5625"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5627"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5625"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-connect.c.html#LN5628"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5627"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5629"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>!= </span><span class='String'>'%'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* copy and check for NUL terminator */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5628"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) </span><span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5629"><span class='Ref_To_Local'>q</span></a><span class='Operator'>++</span><span class='Parentheses'>)))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN5649"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>hi</span><span class='Delimiter'>; 
</span><a name="LN5650"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>lo</span><span class='Delimiter'>; 
</span><a name="LN5651"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
            <span class='Operator'>++</span><a href="fe-connect.c.html#LN5629"><span class='Ref_To_Local'>q</span></a><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* skip the percent sign itself */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Possible EOL will be caught by the first call to 
             * get_hexdigit(), so we never dereference an invalid q pointer. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN364"><span class='Ref_to_Proto'>get_hexdigit</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5629"><span class='Ref_To_Local'>q</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5649"><span class='Ref_To_Local'>hi</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN364"><span class='Ref_to_Proto'>get_hexdigit</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5629"><span class='Ref_To_Local'>q</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5650"><span class='Ref_To_Local'>lo</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5625"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                    <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid percent-encoded token: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN5625"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5627"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="fe-connect.c.html#LN5651"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5649"><span class='Ref_To_Local'>hi</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="fe-connect.c.html#LN5650"><span class='Ref_To_Local'>lo</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5651"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5625"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"forbidden value %%00 in percent-encoded value: \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-connect.c.html#LN5625"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5627"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5628"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="fe-connect.c.html#LN5651"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5627"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end conninfo_uri_decode &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert hexadecimal digit character to its integer value. 
 * 
 * If successful, returns true and value is filled with digit's base 16 value. 
 * If not successful, returns false. 
 * 
 * Lower- and upper-case letters in the range A-F are treated identically. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN5693"></a><span class='Declare_Function'>get_hexdigit</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>digit</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='String'>'0'</span> <span class='Operator'>&LT;= </span><a href="fe-connect.c.html#LN5693"><span class='Ref_to_Parameter'>digit</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN5693"><span class='Ref_to_Parameter'>digit</span></a> <span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="fe-connect.c.html#LN5693"><span class='Ref_to_Parameter'>digit</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='String'>'A'</span> <span class='Operator'>&LT;= </span><a href="fe-connect.c.html#LN5693"><span class='Ref_to_Parameter'>digit</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN5693"><span class='Ref_to_Parameter'>digit</span></a> <span class='Operator'>&LT;= </span><span class='String'>'F'</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="fe-connect.c.html#LN5693"><span class='Ref_to_Parameter'>digit</span></a> <span class='Operator'>- </span><span class='String'>'A'</span> <span class='Operator'>+ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='String'>'a'</span> <span class='Operator'>&LT;= </span><a href="fe-connect.c.html#LN5693"><span class='Ref_to_Parameter'>digit</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN5693"><span class='Ref_to_Parameter'>digit</span></a> <span class='Operator'>&LT;= </span><span class='String'>'f'</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="fe-connect.c.html#LN5693"><span class='Ref_to_Parameter'>digit</span></a> <span class='Operator'>- </span><span class='String'>'a'</span> <span class='Operator'>+ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Find an option value corresponding to the keyword in the connOptions array. 
 * 
 * If successful, returns a pointer to the corresponding option's value. 
 * If not successful, returns NULL. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN5714"></a><span class='Declare_Function'>conninfo_getval</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Delimiter'>, 
</span><a name="LN5715"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>keyword</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5717"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN5717"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN370"><span class='Ref_to_Proto'>conninfo_find</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5714"><span class='Ref_to_Parameter'>connOptions</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5715"><span class='Ref_to_Parameter'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5717"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>? </span><a href="fe-connect.c.html#LN5717"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Store a (new) value for an option corresponding to the keyword in 
 * connOptions array. 
 * 
 * If uri_decode is true, the value is URI-decoded.  The keyword is always 
 * assumed to be non URI-encoded. 
 * 
 * If successful, returns a pointer to the corresponding PQconninfoOption, 
 * which value is replaced with a strdup'd copy of the passed value string. 
 * The existing value for the option is free'd before replacing, if any. 
 * 
 * If not successful, returns NULL and fills errorMessage accordingly. 
 * However, if the reason of failure is an invalid keyword being passed and 
 * ignoreMissing is TRUE, errorMessage will be left untouched. 
 */ 
</span><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>* 
</span><a name="LN5740"></a><span class='Declare_Function'>conninfo_storeval</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Delimiter'>, 
</span><a name="LN5741"></a>                  <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>keyword</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, 
</span><a name="LN5742"></a>                  <a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>errorMessage</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>ignoreMissing</span><span class='Delimiter'>, 
</span><a name="LN5743"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>uri_decode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5745"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span><a name="LN5746"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>value_copy</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For backwards compatibility, requiressl=1 gets translated to 
     * sslmode=require, and requiressl=0 gets translated to sslmode=prefer 
     * (which is the default for sslmode). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5741"><span class='Ref_to_Parameter'>keyword</span></a><span class='Delimiter'>, </span><span class='String'>"requiressl"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN5741"><span class='Ref_to_Parameter'>keyword</span></a> <span class='Operator'>= </span><span class='String'>"sslmode"</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'1'</span><span class='Parentheses'>) 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><span class='String'>"require"</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Keyword'>value </span><span class='Operator'>= </span><span class='String'>"prefer"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="fe-connect.c.html#LN5745"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN370"><span class='Ref_to_Proto'>conninfo_find</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5740"><span class='Ref_to_Parameter'>connOptions</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5741"><span class='Ref_to_Parameter'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5745"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5742"><span class='Ref_to_Parameter'>ignoreMissing</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5742"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, 
</span>                         <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid connection option \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN5741"><span class='Ref_to_Parameter'>keyword</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5743"><span class='Ref_to_Parameter'>uri_decode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN5746"><span class='Ref_To_Local'>value_copy</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN363"><span class='Ref_to_Proto'>conninfo_uri_decode</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5742"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5746"><span class='Ref_To_Local'>value_copy</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Comment_Multi_Line'>/* conninfo_uri_decode already set an error message */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN5746"><span class='Ref_To_Local'>value_copy</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5746"><span class='Ref_To_Local'>value_copy</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5742"><span class='Ref_to_Parameter'>errorMessage</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5745"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5745"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN5745"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5746"><span class='Ref_To_Local'>value_copy</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5745"><span class='Ref_To_Local'>option</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end conninfo_storeval &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find a PQconninfoOption option corresponding to the keyword in the 
 * connOptions array. 
 * 
 * If successful, returns a pointer to the corresponding PQconninfoOption 
 * structure. 
 * If not successful, returns NULL. 
 */ 
</span><span class='Keyword'>static </span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>* 
</span><a name="LN5805"></a><span class='Declare_Function'>conninfo_find</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>keyword</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5807"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5807"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5805"><span class='Ref_to_Parameter'>connOptions</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5807"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5807"><span class='Ref_To_Local'>option</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5807"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5805"><span class='Ref_to_Parameter'>keyword</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="fe-connect.c.html#LN5807"><span class='Ref_To_Local'>option</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return the connection options used for the connection 
 */ 
</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>* 
</span><a name="LN5823"></a><span class='Declare_Function'>PQconninfo</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5825"></a>    <a href="pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>errorBuf</span><span class='Delimiter'>; 
</span><a name="LN5826"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>connOptions</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5823"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We don't actually report any errors here, but callees want a buffer */ 
</span>    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5825"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN66"><span class='Ref_to_Macro'>PQExpBufferDataBroken</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5825"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* out of memory already :-( */ 
</span> 
    <a href="fe-connect.c.html#LN5826"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN344"><span class='Ref_to_Proto'>conninfo_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5825"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5826"><span class='Ref_To_Local'>connOptions</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5840"></a>        <span class='Keyword'>const </span><a href="fe-connect.c.html#LN139"><span class='Ref_to_Typedef'>internalPQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5840"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN161"><span class='Ref_to_Global_Var'>PQconninfoOptions</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5840"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="fe-connect.c.html#LN141"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5840"><span class='Ref_To_Local'>option</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5844"></a>            <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>connmember</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5840"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="fe-connect.c.html#LN158"><span class='Ref_to_Member'>connofs</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="fe-connect.c.html#LN5844"><span class='Ref_To_Local'>connmember</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN5823"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>+ </span><a href="fe-connect.c.html#LN5840"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="fe-connect.c.html#LN158"><span class='Ref_to_Member'>connofs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5844"><span class='Ref_To_Local'>connmember</span></a><span class='Parentheses'>) 
</span>                <a href="fe-connect.c.html#LN367"><span class='Ref_to_Proto'>conninfo_storeval</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5826"><span class='Ref_To_Local'>connOptions</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5840"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="fe-connect.c.html#LN141"><span class='Ref_to_Member'>keyword</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="fe-connect.c.html#LN5844"><span class='Ref_To_Local'>connmember</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="fe-connect.c.html#LN5825"><span class='Ref_To_Local'>errorBuf</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN5825"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5826"><span class='Ref_To_Local'>connOptions</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PQconninfo &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN5864"></a><span class='Declare_Function'>PQconninfoFree</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>connOptions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5866"></a>    <a href="libpq-fe.h.html#LN200"><span class='Ref_to_Typedef'>PQconninfoOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5864"><span class='Ref_to_Parameter'>connOptions</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5866"><span class='Ref_To_Local'>option</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5864"><span class='Ref_to_Parameter'>connOptions</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5866"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN202"><span class='Ref_to_Member'>keyword</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5866"><span class='Ref_To_Local'>option</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5866"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5866"><span class='Ref_To_Local'>option</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN205"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5864"><span class='Ref_to_Parameter'>connOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* =========== accessor functions for PGconn ========= */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN5882"></a><span class='Declare_Function'>PQdb</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5882"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5882"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN5890"></a><span class='Declare_Function'>PQuser</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5890"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5890"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN5898"></a><span class='Declare_Function'>PQpass</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5900"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>password</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5898"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5898"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN5900"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5898"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN5898"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN310"><span class='Ref_to_Member'>password</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5900"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN5900"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5898"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN342"><span class='Ref_to_Member'>pgpass</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Historically we've returned "" not NULL for no password specified */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5900"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN5900"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5900"><span class='Ref_To_Local'>password</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN5915"></a><span class='Declare_Function'>PQhost</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5915"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5915"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="fe-connect.c.html#LN5915"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN5915"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN307"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN295"><span class='Ref_to_EnumConst'>CHT_HOST_ADDRESS</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="fe-connect.c.html#LN5915"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN5915"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN306"><span class='Ref_to_Member'>host</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5915"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="fe-connect.c.html#LN5915"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="fe-connect.c.html#LN5915"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN323"><span class='Ref_to_Member'>pghost</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
        <span class='Control'>return</span> <a href="../../include/pg_config_manual.h.html#LN183"><span class='Ref_to_Const'>DEFAULT_PGSOCKET_DIR</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <span class='Control'>return</span> <a href="fe-connect.c.html#LN100"><span class='Ref_to_Const'>DefaultHost</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN5935"></a><span class='Declare_Function'>PQport</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5935"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5935"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="fe-connect.c.html#LN5935"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN396"><span class='Ref_to_Member'>connhost</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN5935"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN395"><span class='Ref_to_Member'>whichhost</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN308"><span class='Ref_to_Member'>port</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5935"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN331"><span class='Ref_to_Member'>pgport</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN5945"></a><span class='Declare_Function'>PQtty</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5945"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5945"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN332"><span class='Ref_to_Member'>pgtty</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN5953"></a><span class='Declare_Function'>PQoptions</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5953"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5953"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a><span class='Delimiter'>; 
} 
</span> 
<a href="libpq-fe.h.html#LN46"><span class='Ref_to_Typedef'>ConnStatusType</span></a> 
<a name="LN5961"></a><span class='Declare_Function'>PQstatus</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5961"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5961"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a><span class='Delimiter'>; 
} 
</span> 
<a href="libpq-fe.h.html#LN100"><span class='Ref_to_Typedef'>PGTransactionStatusType</span></a> 
<a name="LN5969"></a><span class='Declare_Function'>PQtransactionStatus</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5969"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN5969"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN106"><span class='Ref_to_EnumConst'>PQTRANS_UNKNOWN</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5969"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN215"><span class='Ref_to_EnumConst'>PGASYNC_IDLE</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN103"><span class='Ref_to_EnumConst'>PQTRANS_ACTIVE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN5969"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN5979"></a><span class='Declare_Function'>PQparameterStatus</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>paramName</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5981"></a>    <span class='Keyword'>const </span><a href="libpq-int.h.html#LN255"><span class='Ref_to_Struct'>pgParameterStatus</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstatus</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5979"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>|| !</span><a href="fe-connect.c.html#LN5979"><span class='Ref_to_Parameter'>paramName</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5981"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5979"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN421"><span class='Ref_to_Member'>pstatus</span></a><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5981"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="fe-connect.c.html#LN5981"><span class='Ref_To_Local'>pstatus</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN5981"><span class='Ref_To_Local'>pstatus</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN257"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5981"><span class='Ref_To_Local'>pstatus</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN258"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN5979"><span class='Ref_to_Parameter'>paramName</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="fe-connect.c.html#LN5981"><span class='Ref_To_Local'>pstatus</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>int 
</span><a name="LN5994"></a><span class='Declare_Function'>PQprotocolVersion</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN5994"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5994"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN5994"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>int 
</span><a name="LN6004"></a><span class='Declare_Function'>PQserverVersion</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6004"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6004"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN6004"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN404"><span class='Ref_to_Member'>sversion</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN6014"></a><span class='Declare_Function'>PQerrorMessage</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6014"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"connection pointer is NULL\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN6014"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * In Windows, socket values are unsigned, and an invalid socket value 
 * (INVALID_SOCKET) is ~0, which equals -1 in comparisons (with no compiler 
 * warning). Ideally we would return an unsigned value for PQsocket() on 
 * Windows, but that would cause the function's return value to differ from 
 * Unix, so we just return -1 for invalid sockets. 
 * http://msdn.microsoft.com/en-us/library/windows/desktop/cc507522%28v=vs.85%29.aspx 
 * http://stackoverflow.com/questions/10817252/why-is-invalid-socket-defined-as-0-in-winsock2-h-c 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN6032"></a><span class='Declare_Function'>PQsocket</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6032"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6032"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>!= </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="fe-connect.c.html#LN6032"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>int 
</span><a name="LN6040"></a><span class='Declare_Function'>PQbackendPID</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6040"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN6040"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN6040"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN419"><span class='Ref_to_Member'>be_pid</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>int 
</span><a name="LN6048"></a><span class='Declare_Function'>PQconnectionNeedsPassword</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6050"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>password</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6048"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN6050"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN312"><span class='Ref_to_Proto'>PQpass</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6048"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6048"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN407"><span class='Ref_to_Member'>password_needed</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6050"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="fe-connect.c.html#LN6050"><span class='Ref_To_Local'>password</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>int 
</span><a name="LN6063"></a><span class='Declare_Function'>PQconnectionUsedPassword</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6063"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6063"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN407"><span class='Ref_to_Member'>password_needed</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>int 
</span><a name="LN6074"></a><span class='Declare_Function'>PQclientEncoding</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6074"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN6074"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN6074"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN422"><span class='Ref_to_Member'>client_encoding</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>int 
</span><a name="LN6082"></a><span class='Declare_Function'>PQsetClientEncoding</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>encoding</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6084"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>qbuf</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span><a name="LN6085"></a>    <span class='Keyword'>static const char </span><span class='Declare_Local'>query</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='String'>"set client_encoding to '%s'"</span><span class='Delimiter'>; 
</span><a name="LN6086"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN6087"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>|| </span><a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN48"><span class='Ref_to_EnumConst'>CONNECTION_OK</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>encoding</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Resolve special "auto" value from the locale */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>encoding</span></a><span class='Delimiter'>, </span><span class='String'>"auto"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>encoding</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="../../port/chklocale.c.html#LN309"><span class='Ref_to_Func'>pg_get_encoding_from_locale</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check query buffer overflow */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6084"><span class='Ref_To_Local'>qbuf</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6085"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>encoding</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ok, now send a query */ 
</span>    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6084"><span class='Ref_To_Local'>qbuf</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6085"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN6086"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN380"><span class='Ref_to_Proto'>PQexec</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6084"><span class='Ref_To_Local'>qbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6086"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6086"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN176"><span class='Ref_to_Member'>resultStatus</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN6087"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * In protocol 2 we have to assume the setting will stick, and adjust 
         * our state immediately.  In protocol 3 and up we can rely on the 
         * backend to report the parameter value, and we'll change state at 
         * that time. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
            <a href="libpq-int.h.html#LN577"><span class='Ref_to_Proto'>pqSaveParameterStatus</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"client_encoding"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6082"><span class='Ref_to_Parameter'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN6087"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* everything is ok */ 
</span>    <span class='Delimiter'>} 
</span>    <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6086"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN6087"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PQsetClientEncoding &raquo; </span> 
 
<a href="libpq-fe.h.html#LN109"><span class='Ref_to_Typedef'>PGVerbosity</span></a> 
<a name="LN6128"></a><span class='Declare_Function'>PQsetErrorVerbosity</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN109"><span class='Ref_to_Typedef'>PGVerbosity</span></a> <span class='Declare_Parameter'>verbosity</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6130"></a>    <a href="libpq-fe.h.html#LN109"><span class='Ref_to_Typedef'>PGVerbosity</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6128"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN112"><span class='Ref_to_EnumConst'>PQERRORS_DEFAULT</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN6130"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6128"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN424"><span class='Ref_to_Member'>verbosity</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN6128"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN424"><span class='Ref_to_Member'>verbosity</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6128"><span class='Ref_to_Parameter'>verbosity</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN6130"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span> 
<a href="libpq-fe.h.html#LN116"><span class='Ref_to_Typedef'>PGContextVisibility</span></a> 
<a name="LN6140"></a><span class='Declare_Function'>PQsetErrorContextVisibility</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN116"><span class='Ref_to_Typedef'>PGContextVisibility</span></a> <span class='Declare_Parameter'>show_context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6142"></a>    <a href="libpq-fe.h.html#LN116"><span class='Ref_to_Typedef'>PGContextVisibility</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6140"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN119"><span class='Ref_to_EnumConst'>PQSHOW_CONTEXT_ERRORS</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN6142"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN425"><span class='Ref_to_Member'>show_context</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN6140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN425"><span class='Ref_to_Member'>show_context</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6140"><span class='Ref_to_Parameter'>show_context</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN6142"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN6152"></a><span class='Declare_Function'>PQtrace</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span>FILE <span class='Operator'>*</span><span class='Declare_Parameter'>debug_port</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6152"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="libpq-fe.h.html#LN356"><span class='Ref_to_Proto'>PQuntrace</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6152"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN6152"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN366"><span class='Ref_to_Member'>Pfdebug</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6152"><span class='Ref_to_Parameter'>debug_port</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN6161"></a><span class='Declare_Function'>PQuntrace</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6161"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6161"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN366"><span class='Ref_to_Member'>Pfdebug</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        fflush<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6161"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN366"><span class='Ref_to_Member'>Pfdebug</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN6161"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN366"><span class='Ref_to_Member'>Pfdebug</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<a href="libpq-fe.h.html#LN170"><span class='Ref_to_Typedef'>PQnoticeReceiver</span></a> 
<a name="LN6173"></a><span class='Declare_Function'>PQsetNoticeReceiver</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN170"><span class='Ref_to_Typedef'>PQnoticeReceiver</span></a> <span class='Declare_Parameter'>proc</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6175"></a>    <a href="libpq-fe.h.html#LN170"><span class='Ref_to_Typedef'>PQnoticeReceiver</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6173"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN6175"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6173"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN151"><span class='Ref_to_Member'>noticeRec</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6173"><span class='Ref_to_Parameter'>proc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN6173"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN151"><span class='Ref_to_Member'>noticeRec</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6173"><span class='Ref_to_Parameter'>proc</span></a><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN6173"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN152"><span class='Ref_to_Member'>noticeRecArg</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6173"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN6175"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span> 
<a href="libpq-fe.h.html#LN171"><span class='Ref_to_Typedef'>PQnoticeProcessor</span></a> 
<a name="LN6190"></a><span class='Declare_Function'>PQsetNoticeProcessor</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN171"><span class='Ref_to_Typedef'>PQnoticeProcessor</span></a> <span class='Declare_Parameter'>proc</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6192"></a>    <a href="libpq-fe.h.html#LN171"><span class='Ref_to_Typedef'>PQnoticeProcessor</span></a> <span class='Declare_Local'>old</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6190"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="fe-connect.c.html#LN6192"><span class='Ref_To_Local'>old</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6190"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN153"><span class='Ref_to_Member'>noticeProc</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6190"><span class='Ref_to_Parameter'>proc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-connect.c.html#LN6190"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN153"><span class='Ref_to_Member'>noticeProc</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6190"><span class='Ref_to_Parameter'>proc</span></a><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN6190"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN154"><span class='Ref_to_Member'>noticeProcArg</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6190"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="fe-connect.c.html#LN6192"><span class='Ref_To_Local'>old</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The default notice message receiver just gets the standard notice text 
 * and sends it to the notice processor.  This two-level setup exists 
 * mostly for backwards compatibility; perhaps we should deprecate use of 
 * PQsetNoticeProcessor? 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6213"></a><span class='Declare_Function'>defaultNoticeReceiver</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN6213"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* not used */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6213"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN185"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN153"><span class='Ref_to_Member'>noticeProc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN6213"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN185"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN153"><span class='Ref_to_Member'>noticeProc</span></a><span class='Parentheses'>) (</span><a href="fe-connect.c.html#LN6213"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN185"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN154"><span class='Ref_to_Member'>noticeProcArg</span></a><span class='Delimiter'>, 
</span>                                        <a href="libpq-fe.h.html#LN468"><span class='Ref_to_Proto'>PQresultErrorMessage</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6213"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The default notice message processor just prints the 
 * message on stderr.  Applications can override this if they 
 * want the messages to go elsewhere (a window, for example). 
 * Note that simply discarding notices is probably a bad idea. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6228"></a><span class='Declare_Function'>defaultNoticeProcessor</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>message</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="fe-connect.c.html#LN6228"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* not used */ 
</span>    <span class='Comment_Multi_Line'>/* Note: we expect the supplied string to end with a newline already. */ 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6228"><span class='Ref_to_Parameter'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * returns a pointer to the next token or NULL if the current 
 * token doesn't match 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN6240"></a><span class='Declare_Function'>pwdfMatchesString</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6242"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tbuf</span><span class='Delimiter'>, 
</span><a name="LN6243"></a>               <span class='Operator'>*</span><span class='Declare_Local'>ttok</span><span class='Delimiter'>; 
</span><a name="LN6244"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>bslash</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6240"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="fe-connect.c.html#LN6240"><span class='Ref_to_Parameter'>token</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6240"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>; 
</span>    <a href="fe-connect.c.html#LN6243"><span class='Ref_To_Local'>ttok</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6240"><span class='Ref_to_Parameter'>token</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'*'</span> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span> <span class='Operator'>&& !</span><a href="fe-connect.c.html#LN6244"><span class='Ref_To_Local'>bslash</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN6244"><span class='Ref_To_Local'>bslash</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a> <span class='Operator'>== </span><span class='String'>':'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN6243"><span class='Ref_To_Local'>ttok</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="fe-connect.c.html#LN6244"><span class='Ref_To_Local'>bslash</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="fe-connect.c.html#LN6244"><span class='Ref_To_Local'>bslash</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN6243"><span class='Ref_To_Local'>ttok</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a> <span class='Operator'>== *</span><a href="fe-connect.c.html#LN6243"><span class='Ref_To_Local'>ttok</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN6242"><span class='Ref_To_Local'>tbuf</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="fe-connect.c.html#LN6243"><span class='Ref_To_Local'>ttok</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *tbuf!=0 &raquo; </span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pwdfMatchesString &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Get a password from the password file. Return value is malloc'd. */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN6277"></a><span class='Declare_Function'>passwordFromFile</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>hostname</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>port</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Delimiter'>, 
</span><a name="LN6278"></a>                 <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>username</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pgpassfile</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6280"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>fp</span><span class='Delimiter'>; 
</span><a name="LN6281"></a>    <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>stat_buf</span><span class='Delimiter'>; 
</span> 
<a name="LN6283"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LINELEN</span> <a href="../ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Operator'>*</span><span class='Number'>5</span> 
<a name="LN6284"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN6283"><span class='Ref_to_Const'>LINELEN</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>dbname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6278"><span class='Ref_to_Parameter'>username</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6278"><span class='Ref_to_Parameter'>username</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 'localhost' matches pghost of '' or the default socket directory */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>hostname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>hostname</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN100"><span class='Ref_to_Const'>DefaultHost</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN76"><span class='Ref_to_Macro'>is_absolute_path</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>hostname</span></a><span class='Parentheses'>))</span> 
 
        <span class='Comment_Multi_Line'>/* 
         * We should probably use canonicalize_path(), but then we have to 
         * bring path.c into libpq, and it doesn't seem worth it. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>hostname</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN183"><span class='Ref_to_Const'>DEFAULT_PGSOCKET_DIR</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>hostname</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN100"><span class='Ref_to_Const'>DefaultHost</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>port</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>port</span></a> <span class='Operator'>= </span>DEF_PGPORT_STR<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If password file cannot be opened, ignore it. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6278"><span class='Ref_to_Parameter'>pgpassfile</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN6281"><span class='Ref_To_Local'>stat_buf</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port/win32.h.html#LN430"><span class='Ref_to_Macro'>S_ISREG</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6281"><span class='Ref_To_Local'>stat_buf</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>        <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"WARNING: password file \"%s\" is not a plain file\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="fe-connect.c.html#LN6278"><span class='Ref_to_Parameter'>pgpassfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If password file is insecure, alert the user and ignore it. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6281"><span class='Ref_To_Local'>stat_buf</span></a><span class='Operator'>.</span>st_mode <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN450"><span class='Ref_to_Const'>S_IRWXG</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN454"><span class='Ref_to_Const'>S_IRWXO</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"WARNING: password file \"%s\" has group or world access; permissions should be u=rw (0600) or less\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="fe-connect.c.html#LN6278"><span class='Ref_to_Parameter'>pgpassfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#else</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * On Win32, the directory is protected, so we don't have to check the 
     * file. 
     */ 
</span><span class='Directive'>#endif</span> 
 
    <a href="fe-connect.c.html#LN6280"><span class='Ref_To_Local'>fp</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6278"><span class='Ref_to_Parameter'>pgpassfile</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6280"><span class='Ref_To_Local'>fp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>feof<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6280"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span>ferror<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6280"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN6342"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>t</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6284"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span><a name="LN6343"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>, 
</span><a name="LN6344"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>p1</span><span class='Delimiter'>, 
</span><a name="LN6345"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>p2</span><span class='Delimiter'>; 
</span><a name="LN6346"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>fgets<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6284"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6284"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6280"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="fe-connect.c.html#LN6346"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6284"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Remove trailing newline */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6346"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN6284"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN6346"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-connect.c.html#LN6284"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="fe-connect.c.html#LN6346"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Handle DOS-style line endings, too, even when not on Windows */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6346"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN6284"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="fe-connect.c.html#LN6346"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\r'</span><span class='Parentheses'>) 
</span>                <a href="fe-connect.c.html#LN6284"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="fe-connect.c.html#LN6346"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6346"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-connect.c.html#LN6342"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN381"><span class='Ref_to_Proto'>pwdfMatchesString</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6342"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>hostname</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6342"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN381"><span class='Ref_to_Proto'>pwdfMatchesString</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6342"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>port</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6342"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN381"><span class='Ref_to_Proto'>pwdfMatchesString</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6342"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6277"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6342"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN381"><span class='Ref_to_Proto'>pwdfMatchesString</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6342"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6278"><span class='Ref_to_Parameter'>username</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Found a match. */ 
</span>        <a href="fe-connect.c.html#LN6343"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6342"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6280"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-connect.c.html#LN6343"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Out of memory. XXX: an error message would be nice. */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* De-escape password. */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6344"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6345"><span class='Ref_To_Local'>p2</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6343"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="fe-connect.c.html#LN6344"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>!= </span><span class='String'>':'</span> <span class='Operator'>&& *</span><a href="fe-connect.c.html#LN6344"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="fe-connect.c.html#LN6344"><span class='Ref_To_Local'>p1</span></a><span class='Delimiter'>, </span><span class='Operator'>++</span><a href="fe-connect.c.html#LN6345"><span class='Ref_To_Local'>p2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-connect.c.html#LN6344"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN6344"><span class='Ref_To_Local'>p1</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                <span class='Operator'>++</span><a href="fe-connect.c.html#LN6344"><span class='Ref_To_Local'>p1</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="fe-connect.c.html#LN6345"><span class='Ref_To_Local'>p2</span></a> <span class='Operator'>= *</span><a href="fe-connect.c.html#LN6344"><span class='Ref_To_Local'>p1</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="fe-connect.c.html#LN6345"><span class='Ref_To_Local'>p2</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="fe-connect.c.html#LN6343"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !feof(fp)&&!ferror(fp... &raquo; </span> 
 
    fclose<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6280"><span class='Ref_To_Local'>fp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>#undef </span><a href="fe-connect.c.html#LN6283"><span class='Ref_to_Const'>LINELEN</span></a> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end passwordFromFile &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  If the connection failed due to bad password, we should mention 
 *  if we got the password from the pgpassfile. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6405"></a><span class='Declare_Function'>pgpassfileWarning</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* If it was 'invalid authorization', add pgpassfile mention */ 
</span>    <span class='Comment_Multi_Line'>/* only works with &GT;= 9.0 servers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6405"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN408"><span class='Ref_to_Member'>pgpassfile_used</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN6405"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN407"><span class='Ref_to_Member'>password_needed</span></a> <span class='Operator'>&& </span><a href="fe-connect.c.html#LN6405"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6411"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>sqlstate</span> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6405"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../include/postgres_ext.h.html#LN56"><span class='Ref_to_Const'>PG_DIAG_SQLSTATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6411"><span class='Ref_To_Local'>sqlstate</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6411"><span class='Ref_To_Local'>sqlstate</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN92"><span class='Ref_to_Const'>ERRCODE_INVALID_PASSWORD</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN6405"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"password retrieved from file \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-connect.c.html#LN6405"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN343"><span class='Ref_to_Member'>pgpassfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Obtain user's home directory, return in given buffer 
 * 
 * On Unix, this actually returns the user's home directory.  On Windows 
 * it returns the PostgreSQL-specific application data folder. 
 * 
 * This is essentially the same as get_home_path(), but we don't use that 
 * because we don't want to pull path.c into libpq (it pollutes application 
 * namespace) 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN6433"></a><span class='Declare_Function'>pqGetHomeDirectory</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>bufsize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN6436"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>pwdbuf</span><span class='Delimiter'>[</span>BUFSIZ<span class='Delimiter'>]; 
</span><a name="LN6437"></a>    <span class='Control'>struct</span> passwd <span class='Declare_Local'>pwdstr</span><span class='Delimiter'>; 
</span><a name="LN6438"></a>    <span class='Control'>struct</span> passwd <span class='Operator'>*</span><span class='Declare_Local'>pwd</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../port/thread.c.html#LN93"><span class='Ref_to_Func'>pqGetpwuid</span></a><span class='Parentheses'>(</span>geteuid<span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN6437"><span class='Ref_To_Local'>pwdstr</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6436"><span class='Ref_To_Local'>pwdbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6436"><span class='Ref_To_Local'>pwdbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-connect.c.html#LN6438"><span class='Ref_To_Local'>pwd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6438"><span class='Ref_To_Local'>pwd</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6433"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6438"><span class='Ref_To_Local'>pwd</span></a><span class='Operator'>-&GT;</span>pw_dir<span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6433"><span class='Ref_to_Parameter'>bufsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN6446"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tmppath</span><span class='Delimiter'>[</span>MAX_PATH<span class='Delimiter'>]; 
</span> 
    ZeroMemory<span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6446"><span class='Ref_To_Local'>tmppath</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6446"><span class='Ref_To_Local'>tmppath</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>SHGetFolderPath<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span>CSIDL_APPDATA<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6446"><span class='Ref_To_Local'>tmppath</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span>S_OK<span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6433"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6433"><span class='Ref_to_Parameter'>bufsize</span></a><span class='Delimiter'>, </span><span class='String'>"%s/postgresql"</span><span class='Delimiter'>, </span><a href="fe-connect.c.html#LN6446"><span class='Ref_To_Local'>tmppath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pqGetHomeDirectory &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * To keep the API consistent, the locking stubs are always provided, even 
 * if they are not required. 
 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN6462"></a><span class='Declare_Function'>default_threadlock</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>acquire</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> ENABLE_THREAD_SAFETY 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN6466"></a>    <span class='Keyword'>static </span><a href="../ecpg/include/ecpg-pthread-win32.h.html#LN14"><span class='Ref_to_Struct'>pthread_mutex_t</span></a> <span class='Declare_Local'>singlethread_lock</span> <span class='Operator'>= </span><a href="../ecpg/include/ecpg-pthread-win32.h.html#LN23"><span class='Ref_to_Const'>PTHREAD_MUTEX_INITIALIZER</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN6468"></a>    <span class='Keyword'>static </span><a href="../ecpg/include/ecpg-pthread-win32.h.html#LN14"><span class='Ref_to_Struct'>pthread_mutex_t</span></a> <span class='Declare_Local'>singlethread_lock</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN6469"></a>    <span class='Keyword'>static long </span><span class='Declare_Local'>mutex_initlock</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6466"><span class='Ref_To_Local'>singlethread_lock</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span>InterlockedExchange<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN6469"><span class='Ref_To_Local'>mutex_initlock</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
             <span class='Comment_Multi_Line'>/* loop, another thread own the lock */ </span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6466"><span class='Ref_To_Local'>singlethread_lock</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pthread-win32.h.html#LN15"><span class='Ref_to_Proto'>pthread_mutex_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN6466"><span class='Ref_To_Local'>singlethread_lock</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
                <a href="libpq-int.h.html#LN551"><span class='Ref_to_Macro'>PGTHREAD_ERROR</span></a><span class='Parentheses'>(</span><span class='String'>"failed to initialize mutex"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        InterlockedExchange<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN6469"><span class='Ref_To_Local'>mutex_initlock</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6462"><span class='Ref_to_Parameter'>acquire</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pthread-win32.h.html#LN16"><span class='Ref_to_Proto'>pthread_mutex_lock</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN6466"><span class='Ref_To_Local'>singlethread_lock</span></a><span class='Parentheses'>))</span> 
            <a href="libpq-int.h.html#LN551"><span class='Ref_to_Macro'>PGTHREAD_ERROR</span></a><span class='Parentheses'>(</span><span class='String'>"failed to lock mutex"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pthread-win32.h.html#LN19"><span class='Ref_to_Proto'>pthread_mutex_unlock</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-connect.c.html#LN6466"><span class='Ref_To_Local'>singlethread_lock</span></a><span class='Parentheses'>))</span> 
            <a href="libpq-int.h.html#LN551"><span class='Ref_to_Macro'>PGTHREAD_ERROR</span></a><span class='Parentheses'>(</span><span class='String'>"failed to unlock mutex"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end default_threadlock &raquo; </span> 
 
<a href="libpq-fe.h.html#LN373"><span class='Ref_to_Typedef'>pgthreadlock_t</span></a> 
<a name="LN6497"></a><span class='Declare_Function'>PQregisterThreadLock</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN373"><span class='Ref_to_Typedef'>pgthreadlock_t</span></a> <span class='Declare_Parameter'>newhandler</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6499"></a>    <a href="libpq-fe.h.html#LN373"><span class='Ref_to_Typedef'>pgthreadlock_t</span></a> <span class='Declare_Local'>prev</span> <span class='Operator'>= </span><a href="fe-connect.c.html#LN389"><span class='Ref_to_Global_Var'>pg_g_threadlock</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-connect.c.html#LN6497"><span class='Ref_to_Parameter'>newhandler</span></a><span class='Parentheses'>) 
</span>        <a href="fe-connect.c.html#LN389"><span class='Ref_to_Global_Var'>pg_g_threadlock</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN6497"><span class='Ref_to_Parameter'>newhandler</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="fe-connect.c.html#LN389"><span class='Ref_to_Global_Var'>pg_g_threadlock</span></a> <span class='Operator'>= </span><a href="fe-connect.c.html#LN385"><span class='Ref_to_Proto'>default_threadlock</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-connect.c.html#LN6499"><span class='Ref_To_Local'>prev</span></a><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>