<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\interfaces\libpq\fe-protocol2.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\interfaces\libpq\fe-protocol2.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:11 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * fe-protocol2.c 
 *    functions that are specific to frontend/backend protocol version 2 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/interfaces/libpq/fe-protocol2.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"libpq-fe.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq-int.h"</span> 
 
 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>#include </span><span class='String'>"win32.h"</span> 
<span class='Directive'>#else</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/in.h&GT;</span> 
<span class='Directive'>#ifdef</span> HAVE_NETINET_TCP_H 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/tcp.h&GT;</span> 
<span class='Directive'>#endif</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;arpa/inet.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
 
<a name="LN35"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>getRowDescriptions</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN36"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>getAnotherTuple</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>binary</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN37"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>pqGetErrorNotice2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isError</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN38"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>checkXactStatus</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cmdTag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN39"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>getNotify</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *      pqSetenvPoll 
 * 
 * Polls the process of passing the values of a standard set of environment 
 * variables to the backend. 
 */ 
</span><a href="libpq-fe.h.html#LN71"><span class='Ref_to_Typedef'>PostgresPollingStatusType</span></a> 
<a name="LN49"></a><span class='Declare_Function'>pqSetenvPoll</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN51"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN73"><span class='Ref_to_EnumConst'>PGRES_POLLING_FAILED</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check whether there are any data for us */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* These are reading states */ 
</span>        <span class='Control'>case</span> <a href="libpq-int.h.html#LN237"><span class='Ref_to_EnumConst'>SETENV_STATE_CLIENT_ENCODING_WAIT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-int.h.html#LN239"><span class='Ref_to_EnumConst'>SETENV_STATE_OPTION_WAIT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-int.h.html#LN241"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY1_WAIT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-int.h.html#LN243"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY2_WAIT</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Load waiting data */ 
</span><a name="LN66"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="fe-misc.c.html#LN629"><span class='Ref_to_Func'>pqReadData</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN66"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN398"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN66"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* These are writing states, so we just proceed. */ 
</span>        <span class='Control'>case</span> <a href="libpq-int.h.html#LN236"><span class='Ref_to_EnumConst'>SETENV_STATE_CLIENT_ENCODING_SEND</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-int.h.html#LN238"><span class='Ref_to_EnumConst'>SETENV_STATE_OPTION_SEND</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-int.h.html#LN240"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY1_SEND</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="libpq-int.h.html#LN242"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY2_SEND</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Should we raise an error if called when not active? */ 
</span>        <span class='Control'>case</span> <a href="libpq-int.h.html#LN244"><span class='Ref_to_EnumConst'>SETENV_STATE_IDLE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="libpq-fe.h.html#LN76"><span class='Ref_to_EnumConst'>PGRES_POLLING_OK</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>                                            <span class='String'>"invalid setenv state %c, "</span> 
                                 <span class='String'>"probably indicative of memory corruption\n"</span> 
                                            <span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN398"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch conn-&GT;setenv_state &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* We will loop here until there is nothing left to do in this call. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * The _CLIENT_ENCODING_SEND code is slightly different from 
                 * _OPTION_SEND below (e.g., no getenv() call), which is why a 
                 * different state is used. 
                 */ 
</span>            <span class='Control'>case</span> <a href="libpq-int.h.html#LN236"><span class='Ref_to_EnumConst'>SETENV_STATE_CLIENT_ENCODING_SEND</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN109"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>setQuery</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>];</span>  <span class='Comment_Multi_Line'>/* note length limit in 
                                                 * sprintf below */ 
</span><a name="LN111"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN111"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN111"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='String'>"default"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN109"><span class='Ref_To_Local'>setQuery</span></a><span class='Delimiter'>, </span><span class='String'>"SET client_encoding = DEFAULT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN109"><span class='Ref_To_Local'>setQuery</span></a><span class='Delimiter'>, </span><span class='String'>"SET client_encoding = '%.60s'"</span><span class='Delimiter'>, 
</span>                                    <a href="fe-protocol2.c.html#LN111"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> CONNECTDEBUG 
                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                                <span class='String'>"Sending client_encoding with %s\n"</span><span class='Delimiter'>, 
</span>                                <a href="fe-protocol2.c.html#LN109"><span class='Ref_To_Local'>setQuery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="libpq-fe.h.html#LN401"><span class='Ref_to_Proto'>PQsendQuery</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN109"><span class='Ref_To_Local'>setQuery</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN398"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span> 
                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN237"><span class='Ref_to_EnumConst'>SETENV_STATE_CLIENT_ENCODING_WAIT</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN238"><span class='Ref_to_EnumConst'>SETENV_STATE_OPTION_SEND</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="libpq-int.h.html#LN238"><span class='Ref_to_EnumConst'>SETENV_STATE_OPTION_SEND</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Send SET commands for stuff directed by Environment 
                     * Options.  Note: we assume that SET commands won't start 
                     * transaction blocks, even in a 7.3 server with 
                     * autocommit off. 
                     */ 
</span><a name="LN143"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>setQuery</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>];</span>  <span class='Comment_Multi_Line'>/* note length limit in 
                                                 * sprintf below */ 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN415"><span class='Ref_to_Member'>next_eo</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN250"><span class='Ref_to_Member'>envName</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN148"></a>                        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-protocol2.c.html#LN148"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN415"><span class='Ref_to_Member'>next_eo</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN250"><span class='Ref_to_Member'>envName</span></a><span class='Parentheses'>)))</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN148"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='String'>"default"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                                <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN143"><span class='Ref_To_Local'>setQuery</span></a><span class='Delimiter'>, </span><span class='String'>"SET %s = DEFAULT"</span><span class='Delimiter'>, 
</span>                                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN415"><span class='Ref_to_Member'>next_eo</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN251"><span class='Ref_to_Member'>pgName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> 
                                <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN143"><span class='Ref_To_Local'>setQuery</span></a><span class='Delimiter'>, </span><span class='String'>"SET %s = '%.60s'"</span><span class='Delimiter'>, 
</span>                                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN415"><span class='Ref_to_Member'>next_eo</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN251"><span class='Ref_to_Member'>pgName</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN148"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> CONNECTDEBUG 
                            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                                  <span class='String'>"Use environment variable %s to send %s\n"</span><span class='Delimiter'>, 
</span>                                    <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN415"><span class='Ref_to_Member'>next_eo</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN250"><span class='Ref_to_Member'>envName</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN143"><span class='Ref_To_Local'>setQuery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="libpq-fe.h.html#LN401"><span class='Ref_to_Proto'>PQsendQuery</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN143"><span class='Ref_To_Local'>setQuery</span></a><span class='Parentheses'>))</span> 
                                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN398"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span> 
                            <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN239"><span class='Ref_to_EnumConst'>SETENV_STATE_OPTION_WAIT</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                            <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN415"><span class='Ref_to_Member'>next_eo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;next_eo-&GT;envNam... &raquo; </span> 
                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* No more options to send, so move on to querying */ 
</span>                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN240"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY1_SEND</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="libpq-int.h.html#LN237"><span class='Ref_to_EnumConst'>SETENV_STATE_CLIENT_ENCODING_WAIT</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN424"><span class='Ref_to_Proto'>PQisBusy</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span> 
                    <a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN398"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Keep reading until PQgetResult returns NULL */ 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Query finished, so send the next option */ 
</span>                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN238"><span class='Ref_to_EnumConst'>SETENV_STATE_OPTION_SEND</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="libpq-int.h.html#LN239"><span class='Ref_to_EnumConst'>SETENV_STATE_OPTION_WAIT</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN424"><span class='Ref_to_Proto'>PQisBusy</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span> 
                    <a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN398"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Keep reading until PQgetResult returns NULL */ 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Query finished, so send the next option */ 
</span>                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN415"><span class='Ref_to_Member'>next_eo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN238"><span class='Ref_to_EnumConst'>SETENV_STATE_OPTION_SEND</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="libpq-int.h.html#LN240"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY1_SEND</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Issue query to get information we need.  Here we must 
                     * use begin/commit in case autocommit is off by default 
                     * in a 7.3 server. 
                     * 
                     * Note: version() exists in all protocol-2.0-supporting 
                     * backends.  In 7.3 it would be safer to write 
                     * pg_catalog.version(), but we can't do that without 
                     * causing problems on older versions. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="libpq-fe.h.html#LN401"><span class='Ref_to_Proto'>PQsendQuery</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"begin; select version(); end"</span><span class='Parentheses'>))</span> 
                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN398"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span> 
                    <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN241"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY1_WAIT</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="libpq-int.h.html#LN241"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY1_WAIT</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN424"><span class='Ref_to_Proto'>PQisBusy</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span> 
                    <a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN258"></a>                        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* ignore begin/commit command results */ 
</span>                            <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a> <span class='Operator'>|| 
</span>                            <a href="libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN398"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * Extract server version and save as if 
                         * ParameterStatus 
                         */ 
</span>                        <a href="fe-protocol2.c.html#LN258"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN258"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&& </span>strncmp<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN258"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='String'>"PostgreSQL "</span><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span><a name="LN281"></a>                            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span> 
                            <span class='Comment_Multi_Line'>/* strip off PostgreSQL part */ 
</span>                            <a href="fe-protocol2.c.html#LN258"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>+= </span><span class='Number'>11</span><span class='Delimiter'>; 
</span> 
                            <span class='Comment_Multi_Line'>/* 
                             * strip off platform part (scribbles on result, 
                             * naughty naughty) 
                             */ 
</span>                            <a href="fe-protocol2.c.html#LN281"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN258"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='String'>' '</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN281"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>) 
</span>                                <span class='Operator'>*</span><a href="fe-protocol2.c.html#LN281"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
                            <a href="libpq-int.h.html#LN577"><span class='Ref_to_Proto'>pqSaveParameterStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"server_version"</span><span class='Delimiter'>, 
</span>                                                  <a href="fe-protocol2.c.html#LN258"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Keep reading until PQgetResult returns NULL */ 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if res &raquo; </span> 
                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Query finished, move to next */ 
</span>                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN242"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY2_SEND</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="libpq-int.h.html#LN242"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY2_SEND</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN311"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * pg_client_encoding does not exist in pre-7.2 servers. 
                     * So we need to be prepared for an error here.  Do *not* 
                     * start a transaction block, except in 7.3 servers where 
                     * we need to prevent autocommit-off from starting a 
                     * transaction anyway. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN404"><span class='Ref_to_Member'>sversion</span></a> <span class='Operator'>&GT;= </span><span class='Number'>70300</span> <span class='Operator'>&& 
</span>                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN404"><span class='Ref_to_Member'>sversion</span></a> <span class='Operator'>&LT; </span><span class='Number'>70400</span><span class='Parentheses'>) 
</span>                        <a href="fe-protocol2.c.html#LN311"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><span class='String'>"begin; select pg_catalog.pg_client_encoding(); end"</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="fe-protocol2.c.html#LN311"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><span class='String'>"select pg_client_encoding()"</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="libpq-fe.h.html#LN401"><span class='Ref_to_Proto'>PQsendQuery</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN311"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN398"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span> 
                    <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN243"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY2_WAIT</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="libpq-int.h.html#LN243"><span class='Ref_to_EnumConst'>SETENV_STATE_QUERY2_WAIT</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN424"><span class='Ref_to_Proto'>PQisBusy</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN74"><span class='Ref_to_EnumConst'>PGRES_POLLING_READING</span></a><span class='Delimiter'>; 
</span> 
                    <a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN341"></a>                        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* ignore begin/commit command results */ 
</span>                            <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a> <span class='Operator'>&& 
</span>                            <a href="libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* Extract client encoding and save it */ 
</span>                            <a href="fe-protocol2.c.html#LN341"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN341"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&& *</span><a href="fe-protocol2.c.html#LN341"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* null should not happen, but */ 
</span>                                <a href="libpq-int.h.html#LN577"><span class='Ref_to_Proto'>pqSaveParameterStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"client_encoding"</span><span class='Delimiter'>, 
</span>                                                      <a href="fe-protocol2.c.html#LN341"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * Error: presumably function not available, so 
                             * use PGCLIENTENCODING or SQL_ASCII as the 
                             * fallback. 
                             */ 
</span>                            <a href="fe-protocol2.c.html#LN341"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGCLIENTENCODING"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN341"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&& *</span><a href="fe-protocol2.c.html#LN341"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>                                <a href="libpq-int.h.html#LN577"><span class='Ref_to_Proto'>pqSaveParameterStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"client_encoding"</span><span class='Delimiter'>, 
</span>                                                      <a href="fe-protocol2.c.html#LN341"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> 
                                <a href="libpq-int.h.html#LN577"><span class='Ref_to_Proto'>pqSaveParameterStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='String'>"client_encoding"</span><span class='Delimiter'>, 
</span>                                                      <span class='String'>"SQL_ASCII"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN51"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Keep reading until PQgetResult returns NULL */ 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if res &raquo; </span> 
                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Query finished, so we're done */ 
</span>                        <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN244"><span class='Ref_to_EnumConst'>SETENV_STATE_IDLE</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span> <a href="libpq-fe.h.html#LN76"><span class='Ref_to_EnumConst'>PGRES_POLLING_OK</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"invalid state %c, "</span> 
                               <span class='String'>"probably indicative of memory corruption\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN398"><span class='Ref_to_Label'>error_return</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch conn-&GT;setenv_state &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Unreachable */ 
</span> 
<a name="LN398"></a><span class='Label'>error_return</span><span class='Operator'>: 
</span>    <a href="fe-protocol2.c.html#LN49"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN414"><span class='Ref_to_Member'>setenv_state</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN244"><span class='Ref_to_EnumConst'>SETENV_STATE_IDLE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="libpq-fe.h.html#LN73"><span class='Ref_to_EnumConst'>PGRES_POLLING_FAILED</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqSetenvPoll &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * parseInput: if appropriate, parse input data from backend 
 * until input is exhausted or a stopping state is reached. 
 * Note that this function will NOT attempt to read more data from the backend. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN410"></a><span class='Declare_Function'>pqParseInput2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN412"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Loop to parse successive complete messages available in the buffer. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Quit if in COPY_OUT state: we expect raw data from the server until 
         * PQendcopy is called.  Don't try to parse it according to the normal 
         * protocol.  (This is bogus.  The data lines ought to be part of the 
         * protocol and have identifying leading characters.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN219"><span class='Ref_to_EnumConst'>PGASYNC_COPY_OUT</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * OK to try to read a message type code. 
         */ 
</span>        <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN412"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * NOTIFY and NOTICE messages can happen in any state besides COPY 
         * OUT; always process them right away. 
         * 
         * Most other messages should only be processed while in BUSY state. 
         * (In particular, in READY state we hold off further parsing until 
         * the application collects the current PGresult.) 
         * 
         * However, if the state is IDLE then we got trouble; we need to deal 
         * with the unexpected message somehow. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN412"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='String'>'A'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN39"><span class='Ref_to_Proto'>getNotify</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN412"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='String'>'N'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN37"><span class='Ref_to_Proto'>pqGetErrorNotice2</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN216"><span class='Ref_to_EnumConst'>PGASYNC_BUSY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* If not IDLE state, just wait ... */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN215"><span class='Ref_to_EnumConst'>PGASYNC_IDLE</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Unexpected message in IDLE state; need to recover somehow. 
             * ERROR messages are displayed using the notice processor; 
             * anything else is just dropped on the floor after displaying a 
             * suitable warning notice.  (An ERROR is very possibly the 
             * backend telling us why it is about to close the connection, so 
             * we don't want to just discard it...) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN412"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='String'>'E'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN37"><span class='Ref_to_Proto'>pqGetErrorNotice2</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false </span><span class='Comment_Multi_Line'>/* treat as notice */ </span><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="fe-exec.c.html#LN799"><span class='Ref_to_Func'>pqInternalNotice</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Delimiter'>, 
</span>                        <span class='String'>"message type 0x%02x arrived from server while idle"</span><span class='Delimiter'>, 
</span>                                 <a href="fe-protocol2.c.html#LN412"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Discard the unexpected message; good idea?? */ 
</span>                <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;asyncStatus!=PG... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * In BUSY state, we can process everything. 
             */ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN412"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* command complete */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                                                           <a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                            <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN177"><span class='Ref_to_Member'>cmdStatus</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                                <a href="libpq-int.h.html#LN85"><span class='Ref_to_Const'>CMDSTATUS_LEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="fe-protocol2.c.html#LN38"><span class='Ref_to_Proto'>checkXactStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* error return */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN37"><span class='Ref_to_Proto'>pqGetErrorNotice2</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'Z'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* backend is ready for new query */ 
</span>                    <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN215"><span class='Ref_to_EnumConst'>PGASYNC_IDLE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'I'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* empty query */ 
</span>                    <span class='Comment_Multi_Line'>/* read and throw away the closing '\0' */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN412"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN412"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <a href="fe-exec.c.html#LN799"><span class='Ref_to_Func'>pqInternalNotice</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Delimiter'>, 
</span>                                         <span class='String'>"unexpected character %c following empty query response (\"I\" message)"</span><span class='Delimiter'>, 
</span>                                         <a href="fe-protocol2.c.html#LN412"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                                                           <a href="libpq-fe.h.html#LN83"><span class='Ref_to_EnumConst'>PGRES_EMPTY_QUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                            <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'K'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* secret key data from the backend */ 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * This is expected only during backend startup, but it's 
                     * just as easy to handle it as part of the main loop. 
                     * Save the data and continue processing. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN419"><span class='Ref_to_Member'>be_pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN420"><span class='Ref_to_Member'>be_key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* synchronous (normal) portal */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* We pretty much ignore this message type... */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'T'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* row descriptions (start of query results) */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* First 'T' in a query sequence */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN35"><span class='Ref_to_Proto'>getRowDescriptions</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>return</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* getRowDescriptions() moves inStart itself */ 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * A new 'T' message is treated as the start of 
                         * another PGresult.  (It is not clear that this is 
                         * really possible with the current backend.) We stop 
                         * parsing until the application accepts the current 
                         * result. 
                         */ 
</span>                        <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* ASCII data tuple */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Read another tuple of a normal query response */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN36"><span class='Ref_to_Proto'>getAnotherTuple</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>))</span> 
                            <span class='Control'>return</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* getAnotherTuple() moves inStart itself */ 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="fe-exec.c.html#LN799"><span class='Ref_to_Func'>pqInternalNotice</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Delimiter'>, 
</span>                                         <span class='String'>"server sent data (\"D\" message) without prior row description (\"T\" message)"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Discard the unexpected message; good idea?? */ 
</span>                        <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'B'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Binary data tuple */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Read another tuple of a normal query response */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN36"><span class='Ref_to_Proto'>getAnotherTuple</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>TRUE</span><span class='Parentheses'>))</span> 
                            <span class='Control'>return</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* getAnotherTuple() moves inStart itself */ 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="fe-exec.c.html#LN799"><span class='Ref_to_Func'>pqInternalNotice</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Delimiter'>, 
</span>                                         <span class='String'>"server sent binary data (\"B\" message) without prior row description (\"T\" message)"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Discard the unexpected message; good idea?? */ 
</span>                        <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'G'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Start Copy In */ 
</span>                    <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN218"><span class='Ref_to_EnumConst'>PGASYNC_COPY_IN</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'H'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Start Copy Out */ 
</span>                    <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN219"><span class='Ref_to_EnumConst'>PGASYNC_COPY_OUT</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Don't need to process CopyBothResponse here because it 
                     * never arrives from the server during protocol 2.0. 
                     */ 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>                                                    <span class='String'>"unexpected response from server; first received character was \"%c\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-protocol2.c.html#LN412"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* build an error result holding the error message */ 
</span>                    <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Discard the unexpected message; good idea?? */ 
</span>                    <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch id &raquo; </span>                   <span class='Comment_Single_Line'>/* switch on protocol character */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Comment_Multi_Line'>/* Successfully consumed this message */ 
</span>        <a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN410"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pqParseInput2 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * parseInput subroutine to read a 'T' (row descriptions) message. 
 * We build a PGresult structure containing the attribute data. 
 * Returns: 0 if completed message, EOF if error or not enough data 
 * received yet. 
 * 
 * Note that if we run out of data, we have to suspend and reprocess 
 * the message after more data is received.  Otherwise, conn-&GT;inStart 
 * must get advanced past the processed data. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN658"></a><span class='Declare_Function'>getRowDescriptions</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN660"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN661"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nfields</span><span class='Delimiter'>; 
</span><a name="LN662"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>errmsg</span><span class='Delimiter'>; 
</span><a name="LN663"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol2.c.html#LN662"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* means "out of memory", see below */ 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN739"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* parseInput already read the 'T' label. */ 
</span>    <span class='Comment_Multi_Line'>/* the next two bytes are the number of fields  */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN169"><span class='Ref_to_Member'>numAttributes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN772"><span class='Ref_to_Label'>EOFexit</span></a><span class='Delimiter'>; 
</span>    <a href="fe-protocol2.c.html#LN661"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN169"><span class='Ref_to_Member'>numAttributes</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* allocate space for the attribute descriptors */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN661"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN234"><span class='Ref_to_Typedef'>PGresAttDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="fe-exec.c.html#LN504"><span class='Ref_to_Func'>pqResultAlloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN661"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN234"><span class='Ref_to_Typedef'>PGresAttDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>TRUE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol2.c.html#LN662"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* means "out of memory", see below */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN739"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN661"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN234"><span class='Ref_to_Typedef'>PGresAttDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* get type info */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol2.c.html#LN661"><span class='Ref_To_Local'>nfields</span></a><span class='Delimiter'>; </span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN694"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>typid</span><span class='Delimiter'>; 
</span><a name="LN695"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN696"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>atttypmod</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN694"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN695"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN696"><span class='Ref_To_Local'>atttypmod</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN772"><span class='Ref_to_Label'>EOFexit</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Since pqGetInt treats 2-byte integers as unsigned, we need to 
         * coerce the result to signed form. 
         */ 
</span>        <a href="fe-protocol2.c.html#LN695"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) ((</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><a href="fe-protocol2.c.html#LN695"><span class='Ref_To_Local'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN236"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN570"><span class='Ref_to_Proto'>pqResultStrdup</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                                  <a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN236"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol2.c.html#LN662"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* means "out of memory", see below */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN739"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN237"><span class='Ref_to_Member'>tableid</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN238"><span class='Ref_to_Member'>columnid</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN239"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN240"><span class='Ref_to_Member'>typid</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN694"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN241"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN695"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN663"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN242"><span class='Ref_to_Member'>atttypmod</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN696"><span class='Ref_To_Local'>atttypmod</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nfields;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Success! */ 
</span>    <a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Advance inStart to show that the "T" message has been processed. */ 
</span>    <a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We could perform additional setup for the new result set here, but for 
     * now there's nothing else to do. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* And we're done. */ 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<a name="LN739"></a><span class='Label'>advance_and_error</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Discard the failed message.  Unfortunately we don't know for sure where 
     * the end is, so just throw away everything in the input buffer. This is 
     * not very desirable but it's the best we can do in protocol v2. 
     */ 
</span>    <a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Replace partially constructed result with an error result. First 
     * discard the old result to try to win back some memory. 
     */ 
</span>    <a href="libpq-int.h.html#LN571"><span class='Ref_to_Proto'>pqClearAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If preceding code didn't provide an error message, assume "out of 
     * memory" was meant.  The advantage of having this special case is that 
     * freeing the old result first greatly improves the odds that gettext() 
     * will succeed in providing a translation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN662"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>) 
</span>        <a href="fe-protocol2.c.html#LN662"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory for query result"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN662"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XXX: if PQmakeEmptyPGresult() fails, there's probably not much we can 
     * do to recover... 
     */ 
</span>    <a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span> 
<a name="LN772"></a><span class='Label'>EOFexit</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&& </span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><a href="fe-protocol2.c.html#LN658"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN660"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> EOF<span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getRowDescriptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * parseInput subroutine to read a 'B' or 'D' (row data) message. 
 * We fill rowbuf with column pointers and then call the row processor. 
 * Returns: 0 if completed message, EOF if error or not enough data 
 * received yet. 
 * 
 * Note that if we run out of data, we have to suspend and reprocess 
 * the message after more data is received.  Otherwise, conn-&GT;inStart 
 * must get advanced past the processed data. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN789"></a><span class='Declare_Function'>getAnotherTuple</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>binary</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN791"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>; 
</span><a name="LN792"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nfields</span> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN791"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN169"><span class='Ref_to_Member'>numAttributes</span></a><span class='Delimiter'>; 
</span><a name="LN793"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>errmsg</span><span class='Delimiter'>; 
</span><a name="LN794"></a>    <a href="libpq-int.h.html#LN286"><span class='Ref_to_Typedef'>PGdataValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rowbuf</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* the backend sends us a bitmap of which attributes are null */ 
</span><a name="LN797"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>std_bitmap</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; </span><span class='Comment_Single_Line'>/* used unless it doesn't fit */ 
</span><a name="LN798"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>bitmap</span> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN797"><span class='Ref_To_Local'>std_bitmap</span></a><span class='Delimiter'>; 
</span><a name="LN799"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN800"></a>    size_t      <span class='Declare_Local'>nbytes</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* the number of bytes in bitmap  */ 
</span><a name="LN801"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>bmap</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* One byte of the bitmap */ 
</span><a name="LN802"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmap_index</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* Its index */ 
</span><a name="LN803"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitcnt</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* number of bits examined in current byte */ 
</span><a name="LN804"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>vlen</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* length of the current field value */ 
</span> 
    <span class='Comment_Multi_Line'>/* Resize row buffer if needed */ 
</span>    <a href="fe-protocol2.c.html#LN794"><span class='Ref_To_Local'>rowbuf</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN446"><span class='Ref_to_Member'>rowBuf</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN792"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>&GT; </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN447"><span class='Ref_to_Member'>rowBufLen</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol2.c.html#LN794"><span class='Ref_To_Local'>rowbuf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN286"><span class='Ref_to_Typedef'>PGdataValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN59"><span class='Ref_to_Macro'>realloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN794"><span class='Ref_To_Local'>rowbuf</span></a><span class='Delimiter'>, 
</span>                                         <a href="fe-protocol2.c.html#LN792"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN286"><span class='Ref_to_Typedef'>PGdataValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN794"><span class='Ref_To_Local'>rowbuf</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol2.c.html#LN793"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* means "out of memory", see below */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN912"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN446"><span class='Ref_to_Member'>rowBuf</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN794"><span class='Ref_To_Local'>rowbuf</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN447"><span class='Ref_to_Member'>rowBufLen</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN792"><span class='Ref_To_Local'>nfields</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Save format specifier */ 
</span>    <a href="fe-protocol2.c.html#LN791"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN178"><span class='Ref_to_Member'>binary</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>binary</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's binary, fix the column format indicators.  We assume the 
     * backend will consistently send either B or D, not a mix. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>binary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN799"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol2.c.html#LN799"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol2.c.html#LN792"><span class='Ref_To_Local'>nfields</span></a><span class='Delimiter'>; </span><a href="fe-protocol2.c.html#LN799"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="fe-protocol2.c.html#LN791"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN799"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN239"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get the null-value bitmap */ 
</span>    <a href="fe-protocol2.c.html#LN800"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN792"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>+ </span><a href="../../include/pg_config_manual.h.html#LN105"><span class='Ref_to_Const'>BITS_PER_BYTE</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="../../include/pg_config_manual.h.html#LN105"><span class='Ref_to_Const'>BITS_PER_BYTE</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* malloc() only for unusually large field counts... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN800"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>&GT; </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN797"><span class='Ref_To_Local'>std_bitmap</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN800"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol2.c.html#LN793"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* means "out of memory", see below */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN912"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN195"><span class='Ref_to_Func'>pqGetnchar</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN800"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN947"><span class='Ref_to_Label'>EOFexit</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan the fields */ 
</span>    <a href="fe-protocol2.c.html#LN802"><span class='Ref_To_Local'>bitmap_index</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol2.c.html#LN801"><span class='Ref_To_Local'>bmap</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN802"><span class='Ref_To_Local'>bitmap_index</span></a><span class='Delimiter'>]; 
</span>    <a href="fe-protocol2.c.html#LN803"><span class='Ref_To_Local'>bitcnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN799"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol2.c.html#LN799"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol2.c.html#LN792"><span class='Ref_To_Local'>nfields</span></a><span class='Delimiter'>; </span><a href="fe-protocol2.c.html#LN799"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* get the value length */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN801"><span class='Ref_To_Local'>bmap</span></a> <span class='Operator'>& </span><span class='Number'>0200</span><span class='Parentheses'>))</span> 
            <a href="fe-protocol2.c.html#LN804"><span class='Ref_To_Local'>vlen</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN132"><span class='Ref_to_Const'>NULL_LEN</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN804"><span class='Ref_To_Local'>vlen</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN947"><span class='Ref_to_Label'>EOFexit</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>binary</span></a><span class='Parentheses'>) 
</span>                <a href="fe-protocol2.c.html#LN804"><span class='Ref_To_Local'>vlen</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN804"><span class='Ref_To_Local'>vlen</span></a> <span class='Operator'>- </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN804"><span class='Ref_To_Local'>vlen</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="fe-protocol2.c.html#LN804"><span class='Ref_To_Local'>vlen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="fe-protocol2.c.html#LN794"><span class='Ref_To_Local'>rowbuf</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN799"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN288"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN804"><span class='Ref_To_Local'>vlen</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * rowbuf[i].value always points to the next address in the data 
         * buffer even if the value is NULL.  This allows row processors to 
         * estimate data sizes more easily. 
         */ 
</span>        <a href="fe-protocol2.c.html#LN794"><span class='Ref_To_Local'>rowbuf</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN799"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a> <span class='Operator'>+ </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Skip over the data value */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN804"><span class='Ref_To_Local'>vlen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN224"><span class='Ref_to_Func'>pqSkipnchar</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN804"><span class='Ref_To_Local'>vlen</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN947"><span class='Ref_to_Label'>EOFexit</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* advance the bitmap stuff */ 
</span>        <a href="fe-protocol2.c.html#LN803"><span class='Ref_To_Local'>bitcnt</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN803"><span class='Ref_To_Local'>bitcnt</span></a> <span class='Operator'>== </span><a href="../../include/pg_config_manual.h.html#LN105"><span class='Ref_to_Const'>BITS_PER_BYTE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol2.c.html#LN802"><span class='Ref_To_Local'>bitmap_index</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="fe-protocol2.c.html#LN801"><span class='Ref_To_Local'>bmap</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN802"><span class='Ref_To_Local'>bitmap_index</span></a><span class='Delimiter'>]; 
</span>            <a href="fe-protocol2.c.html#LN803"><span class='Ref_To_Local'>bitcnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="fe-protocol2.c.html#LN801"><span class='Ref_To_Local'>bmap</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nfields;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Release bitmap now if we allocated it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>!= </span><a href="fe-protocol2.c.html#LN797"><span class='Ref_To_Local'>std_bitmap</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Advance inStart to show that the "D" message has been processed. */ 
</span>    <a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process the collected row */ 
</span>    <a href="fe-protocol2.c.html#LN793"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN579"><span class='Ref_to_Proto'>pqRowProcessor</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN793"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* normal, successful exit */ 
</span> 
    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN921"><span class='Ref_to_Label'>set_error_result</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* pqRowProcessor failed, report it */ 
</span> 
<a name="LN912"></a><span class='Label'>advance_and_error</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Discard the failed message.  Unfortunately we don't know for sure where 
     * the end is, so just throw away everything in the input buffer. This is 
     * not very desirable but it's the best we can do in protocol v2. 
     */ 
</span>    <a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a><span class='Delimiter'>; 
</span> 
<a name="LN921"></a><span class='Label'>set_error_result</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Replace partially constructed result with an error result. First 
     * discard the old result to try to win back some memory. 
     */ 
</span>    <a href="libpq-int.h.html#LN571"><span class='Ref_to_Proto'>pqClearAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If preceding code didn't provide an error message, assume "out of 
     * memory" was meant.  The advantage of having this special case is that 
     * freeing the old result first greatly improves the odds that gettext() 
     * will succeed in providing a translation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN793"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>) 
</span>        <a href="fe-protocol2.c.html#LN793"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory for query result"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN793"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XXX: if PQmakeEmptyPGresult() fails, there's probably not much we can 
     * do to recover... 
     */ 
</span>    <a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol2.c.html#LN789"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span> 
<a name="LN947"></a><span class='Label'>EOFexit</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>!= </span><a href="fe-protocol2.c.html#LN797"><span class='Ref_To_Local'>std_bitmap</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN798"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> EOF<span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getAnotherTuple &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Attempt to read an Error or Notice response message. 
 * This is possible in several places, so we break it out as a subroutine. 
 * Entry: 'E' or 'N' message type has already been consumed. 
 * Exit: returns 0 if successfully consumed message. 
 *       returns EOF if not enough data. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN962"></a><span class='Declare_Function'>pqGetErrorNotice2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isError</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN964"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN965"></a>    <a href="pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>workBuf</span><span class='Delimiter'>; 
</span><a name="LN966"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>startp</span><span class='Delimiter'>; 
</span><a name="LN967"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>splitp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since the message might be pretty long, we create a temporary 
     * PQExpBuffer rather than using conn-&GT;workBuffer.  workBuffer is intended 
     * for stuff that is expected to be short. 
     */ 
</span>    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN1065"><span class='Ref_to_Label'>failure</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make a PGresult to hold the message.  We temporarily lie about the 
     * result status, so that PQmakeEmptyPGresult doesn't uselessly copy 
     * conn-&GT;errorMessage. 
     * 
     * NB: This allocation can fail, if you run out of memory. The rest of the 
     * function handles that gracefully, and we still try to set the error 
     * message as the connection's error message. 
     */ 
</span>    <a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN83"><span class='Ref_to_EnumConst'>PGRES_EMPTY_QUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN176"><span class='Ref_to_Member'>resultStatus</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>isError</span></a> <span class='Operator'>? </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a> <span class='Operator'>: </span><a href="libpq-fe.h.html#LN94"><span class='Ref_to_EnumConst'>PGRES_NONFATAL_ERROR</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN195"><span class='Ref_to_Member'>errMsg</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN570"><span class='Ref_to_Proto'>pqResultStrdup</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Break the message into fields.  We can't do very much here, but we can 
     * split the severity code off, and remove trailing newlines. Also, we use 
     * the heuristic that the primary message extends only to the first 
     * newline --- anything after that is detail message.  (In some cases it'd 
     * be better classed as hint, but we can hardly be expected to guess that 
     * here.) 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a> <span class='Operator'>= </span>strstr<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><span class='String'>":  "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* what comes before the colon is severity */ 
</span>        <span class='Operator'>*</span><a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="libpq-int.h.html#LN575"><span class='Ref_to_Proto'>pqSaveMessageField</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN54"><span class='Ref_to_Const'>PG_DIAG_SEVERITY</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN966"><span class='Ref_To_Local'>startp</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* can't find a colon?  oh well... */ 
</span>        <a href="fe-protocol2.c.html#LN966"><span class='Ref_To_Local'>startp</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN966"><span class='Ref_To_Local'>startp</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* what comes before the newline is primary message */ 
</span>        <span class='Operator'>*</span><a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="libpq-int.h.html#LN575"><span class='Ref_to_Proto'>pqSaveMessageField</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN57"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_PRIMARY</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN966"><span class='Ref_To_Local'>startp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* the rest is detail; strip any leading whitespace */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a><span class='Parentheses'>))</span> 
            <a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="libpq-int.h.html#LN575"><span class='Ref_to_Proto'>pqSaveMessageField</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN58"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_DETAIL</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN967"><span class='Ref_To_Local'>splitp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* single-line message, so all primary */ 
</span>        <a href="libpq-int.h.html#LN575"><span class='Ref_to_Proto'>pqSaveMessageField</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN57"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_PRIMARY</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN966"><span class='Ref_To_Local'>startp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Either save error as current async result, or just emit the notice. 
     * Also, if it's an error and we were in a transaction block, assume the 
     * server has now gone to error-in-transaction state. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>isError</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="libpq-int.h.html#LN571"><span class='Ref_to_Proto'>pqClearAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>        <a href="pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&& !</span><a href="pqexpbuffer.h.html#LN66"><span class='Ref_to_Macro'>PQExpBufferDataBroken</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN195"><span class='Ref_to_Member'>errMsg</span></a><span class='Parentheses'>)</span> 
            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN195"><span class='Ref_to_Member'>errMsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN104"><span class='Ref_to_EnumConst'>PQTRANS_INTRANS</span></a><span class='Parentheses'>) 
</span>            <a href="fe-protocol2.c.html#LN962"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN105"><span class='Ref_to_EnumConst'>PQTRANS_INERROR</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN185"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN151"><span class='Ref_to_Member'>noticeRec</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN185"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN151"><span class='Ref_to_Member'>noticeRec</span></a><span class='Parentheses'>) (</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN185"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN152"><span class='Ref_to_Member'>noticeRecArg</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<a name="LN1065"></a><span class='Label'>failure</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN964"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN965"><span class='Ref_To_Local'>workBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> EOF<span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqGetErrorNotice2 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * checkXactStatus - attempt to track transaction-block status of server 
 * 
 * This is called each time we receive a command-complete message.  By 
 * watching for messages from BEGIN/COMMIT/ROLLBACK commands, we can do 
 * a passable job of tracking the server's xact status.  BUT: this does 
 * not work at all on 7.3 servers with AUTOCOMMIT OFF.  (Man, was that 
 * feature ever a mistake.)  Caveat user. 
 * 
 * The tags known here are all those used as far back as 7.0; is it worth 
 * adding those from even-older servers? 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1085"></a><span class='Declare_Function'>checkXactStatus</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cmdTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1085"><span class='Ref_to_Parameter'>cmdTag</span></a><span class='Delimiter'>, </span><span class='String'>"BEGIN"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="fe-protocol2.c.html#LN1085"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN104"><span class='Ref_to_EnumConst'>PQTRANS_INTRANS</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1085"><span class='Ref_to_Parameter'>cmdTag</span></a><span class='Delimiter'>, </span><span class='String'>"COMMIT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="fe-protocol2.c.html#LN1085"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN102"><span class='Ref_to_EnumConst'>PQTRANS_IDLE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1085"><span class='Ref_to_Parameter'>cmdTag</span></a><span class='Delimiter'>, </span><span class='String'>"ROLLBACK"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="fe-protocol2.c.html#LN1085"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN102"><span class='Ref_to_EnumConst'>PQTRANS_IDLE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1085"><span class='Ref_to_Parameter'>cmdTag</span></a><span class='Delimiter'>, </span><span class='String'>"START TRANSACTION"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* 7.3 only */ 
</span>        <a href="fe-protocol2.c.html#LN1085"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN104"><span class='Ref_to_EnumConst'>PQTRANS_INTRANS</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Normally we get into INERROR state by detecting an Error message. 
     * However, if we see one of these tags then we know for sure the server 
     * is in abort state ... 
     */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1085"><span class='Ref_to_Parameter'>cmdTag</span></a><span class='Delimiter'>, </span><span class='String'>"*ABORT STATE*"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* pre-7.3 only */ 
</span>        <a href="fe-protocol2.c.html#LN1085"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN105"><span class='Ref_to_EnumConst'>PQTRANS_INERROR</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end checkXactStatus &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Attempt to read a Notify response message. 
 * This is possible in several places, so we break it out as a subroutine. 
 * Entry: 'A' message type and length have already been consumed. 
 * Exit: returns 0 if successfully consumed Notify message. 
 *       returns EOF if not enough data. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1113"></a><span class='Declare_Function'>getNotify</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1115"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>be_pid</span><span class='Delimiter'>; 
</span><a name="LN1116"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nmlen</span><span class='Delimiter'>; 
</span><a name="LN1117"></a>    <a href="libpq-fe.h.html#LN160"><span class='Ref_to_Typedef'>PGnotify</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newNotify</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1115"><span class='Ref_To_Local'>be_pid</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1113"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1113"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1113"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Store the relation name right after the PQnotify structure so it can 
     * all be freed at once.  We don't use NAMEDATALEN because we don't want 
     * to tie this interface to a specific server name length. 
     */ 
</span>    <a href="fe-protocol2.c.html#LN1116"><span class='Ref_To_Local'>nmlen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1113"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN160"><span class='Ref_to_Typedef'>PGnotify</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN160"><span class='Ref_to_Typedef'>PGnotify</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="fe-protocol2.c.html#LN1116"><span class='Ref_To_Local'>nmlen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN162"><span class='Ref_to_Member'>relname</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN160"><span class='Ref_to_Typedef'>PGnotify</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN162"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1113"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* fake up an empty-string extra field */ 
</span>        <a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN164"><span class='Ref_to_Member'>extra</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN162"><span class='Ref_to_Member'>relname</span></a> <span class='Operator'>+ </span><a href="fe-protocol2.c.html#LN1116"><span class='Ref_To_Local'>nmlen</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN163"><span class='Ref_to_Member'>be_pid</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1115"><span class='Ref_To_Local'>be_pid</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN166"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1113"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN391"><span class='Ref_to_Member'>notifyTail</span></a><span class='Parentheses'>) 
</span>            <a href="fe-protocol2.c.html#LN1113"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN391"><span class='Ref_to_Member'>notifyTail</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN166"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="fe-protocol2.c.html#LN1113"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN390"><span class='Ref_to_Member'>notifyHead</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN1113"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN391"><span class='Ref_to_Member'>notifyTail</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1117"><span class='Ref_To_Local'>newNotify</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getNotify &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * PQgetCopyData - read a row of data from the backend during COPY OUT 
 * 
 * If successful, sets *buffer to point to a malloc'd row of data, and 
 * returns row length (always &GT; 0) as result. 
 * Returns 0 if no row available yet (only possible if async is true), 
 * -1 if end of copy (consult PQgetResult), or -2 if error (consult 
 * PQerrorMessage). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1160"></a><span class='Declare_Function'>pqGetCopyData2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>async</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1162"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN1163"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>msgLength</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Do we have a complete line of data? 
         */ 
</span>        <a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN1162"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1174"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1174"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="fe-protocol2.c.html#LN1162"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN1162"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol2.c.html#LN1216"><span class='Ref_to_Label'>nodata</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN1163"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>- </span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it's the end-of-data marker, consume it, exit COPY_OUT mode, and 
         * let caller read status with PQgetResult(). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1163"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>== </span><span class='Number'>3</span> <span class='Operator'>&& 
</span>            strncmp<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>], </span><span class='String'>"\\.\n"</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>            <a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN216"><span class='Ref_to_EnumConst'>PGASYNC_BUSY</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Pass the line back to the caller. 
         */ 
</span>        <span class='Operator'>*</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>buffer</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1163"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>buffer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        memcpy<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>], </span><a href="fe-protocol2.c.html#LN1163"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1163"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Add terminating null */ 
</span> 
        <span class='Comment_Multi_Line'>/* Mark message consumed */ 
</span>        <a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="fe-protocol2.c.html#LN1163"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span> 
<a name="LN1216"></a><span class='Label'>nodata</span><span class='Operator'>: 
</span>        <span class='Comment_Multi_Line'>/* Don't block if async read requested */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>async</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Need to load more data */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN638"><span class='Ref_to_Proto'>pqWait</span></a><span class='Parentheses'>(</span><span class='Boolean'>TRUE</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN629"><span class='Ref_to_Func'>pqReadData</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1160"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pqGetCopyData2 &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * PQgetline - gets a newline-terminated string from the backend. 
 * 
 * See fe-exec.c for documentation. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1234"></a><span class='Declare_Function'>pqGetline2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>maxlen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1236"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* return value if buffer overflows */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>== </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a> <span class='Operator'>|| 
</span>        <a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN219"><span class='Ref_to_EnumConst'>PGASYNC_COPY_OUT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since this is a purely synchronous routine, we don't bother to maintain 
     * conn-&GT;inCursor; there is no need to back up. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>maxlen</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1253"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1253"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="fe-protocol2.c.html#LN1236"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* success exit */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++ = </span><a href="fe-protocol2.c.html#LN1253"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>            <a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>maxlen</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* need to load more data */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN638"><span class='Ref_to_Proto'>pqWait</span></a><span class='Parentheses'>(</span><span class='Boolean'>TRUE</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <a href="fe-misc.c.html#LN629"><span class='Ref_to_Func'>pqReadData</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="fe-protocol2.c.html#LN1236"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>EOF<span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while maxlen&GT;1 &raquo; </span> 
    <span class='Operator'>*</span><a href="fe-protocol2.c.html#LN1234"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-protocol2.c.html#LN1236"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqGetline2 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQgetlineAsync - gets a COPY data row without blocking. 
 * 
 * See fe-exec.c for documentation. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1285"></a><span class='Declare_Function'>pqGetlineAsync2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>bufsize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1287"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>avail</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN219"><span class='Ref_to_EnumConst'>PGASYNC_COPY_OUT</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* we are not doing a copy... */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Move data from libpq's buffer to the caller's. We want to accept data 
     * only in units of whole lines, not partial lines.  This ensures that we 
     * can recognize the terminator line "\\.\n".  (Otherwise, if it happened 
     * to cross a packet/buffer boundary, we might hand the first one or two 
     * characters off to the caller, which we shouldn't.) 
     */ 
</span> 
    <a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>; 
</span> 
    <a href="fe-protocol2.c.html#LN1287"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>bufsize</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1287"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1305"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
        <span class='Operator'>*</span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>++ = </span><a href="fe-protocol2.c.html#LN1305"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>--</span><a href="fe-protocol2.c.html#LN1287"><span class='Ref_To_Local'>avail</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1305"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Got a complete line; mark the data removed from libpq */ 
</span>            <a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Is it the endmarker line? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>bufsize</span></a> <span class='Operator'>- </span><a href="fe-protocol2.c.html#LN1287"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>== </span><span class='Number'>3</span> <span class='Operator'>&& </span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>[</span><span class='Operator'>-</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\\'</span> <span class='Operator'>&& </span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>[</span><span class='Operator'>-</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* No, return the data line to the caller */ 
</span>            <span class='Control'>return</span> <a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>bufsize</span></a> <span class='Operator'>- </span><a href="fe-protocol2.c.html#LN1287"><span class='Ref_To_Local'>avail</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't have a complete line. We'd prefer to leave it in libpq's 
     * buffer until the rest arrives, but there is a special case: what if the 
     * line is longer than the buffer the caller is offering us?  In that case 
     * we'd better hand over a partial line, else we'd get into an infinite 
     * loop. Do this in a way that ensures we can't misrecognize a terminator 
     * line later: leave last 3 characters in libpq buffer. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1287"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>bufsize</span></a> <span class='Operator'>&GT; </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>- </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="fe-protocol2.c.html#LN1285"><span class='Ref_to_Parameter'>bufsize</span></a> <span class='Operator'>- </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqGetlineAsync2 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQendcopy 
 * 
 * See fe-exec.c for documentation. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1343"></a><span class='Declare_Function'>pqEndcopy2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1345"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN218"><span class='Ref_to_EnumConst'>PGASYNC_COPY_IN</span></a> <span class='Operator'>&& 
</span>        <a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN219"><span class='Ref_to_EnumConst'>PGASYNC_COPY_OUT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"no COPY in progress\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * make sure no data is waiting to be sent, abort if we are non-blocking 
     * and the flush fails 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN637"><span class='Ref_to_Proto'>pqFlush</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="libpq-int.h.html#LN676"><span class='Ref_to_Macro'>pqIsnonblocking</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* non blocking connections may have to abort at this point. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN676"><span class='Ref_to_Macro'>pqIsnonblocking</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="libpq-fe.h.html#LN424"><span class='Ref_to_Proto'>PQisBusy</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return to active duty */ 
</span>    <a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN216"><span class='Ref_to_EnumConst'>PGASYNC_BUSY</span></a><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Wait for the completion response */ 
</span>    <a href="fe-protocol2.c.html#LN1345"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Expecting a successful result */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1345"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&& </span><a href="fe-protocol2.c.html#LN1345"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN176"><span class='Ref_to_Member'>resultStatus</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1345"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Trouble. For backwards-compatibility reasons, we issue the error 
     * message as if it were a notice (would be nice to get rid of this 
     * silliness, but too many apps probably don't handle errors from 
     * PQendcopy reasonably).  Note that the app can still obtain the error 
     * status from the PGconn object. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We have to strip the trailing newline ... pain in neck... */ 
</span><a name="LN1390"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>svLast</span> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1390"><span class='Ref_To_Local'>svLast</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="fe-exec.c.html#LN799"><span class='Ref_to_Func'>pqInternalNotice</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1390"><span class='Ref_To_Local'>svLast</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1345"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The worst case is that we've lost sync with the backend entirely due to 
     * application screwup of the copy in/out protocol. To recover, reset the 
     * connection (talk about using a sledgehammer...) 
     */ 
</span>    <a href="fe-exec.c.html#LN799"><span class='Ref_to_Func'>pqInternalNotice</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Delimiter'>, 
</span>                   <span class='String'>"lost synchronization with server, resetting connection"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Users doing non-blocking connections need to handle the reset 
     * themselves, they'll need to check the connection status if we return an 
     * error. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN676"><span class='Ref_to_Macro'>pqIsnonblocking</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <a href="libpq-fe.h.html#LN291"><span class='Ref_to_Proto'>PQresetStart</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="libpq-fe.h.html#LN295"><span class='Ref_to_Proto'>PQreset</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1343"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqEndcopy2 &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * PQfn - Send a function call to the POSTGRES backend. 
 * 
 * See fe-exec.c for documentation. 
 */ 
</span><a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>* 
</span><a name="LN1428"></a><span class='Declare_Function'>pqFunctionCall2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>fnid</span><span class='Delimiter'>, 
</span><a name="LN1429"></a>                <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>result_buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>actual_result_len</span><span class='Delimiter'>, 
</span><a name="LN1430"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>result_is_int</span><span class='Delimiter'>, 
</span><a name="LN1431"></a>                <span class='Keyword'>const </span><a href="libpq-fe.h.html#LN219"><span class='Ref_to_Typedef'>PQArgBlock</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nargs</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1433"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>needInput</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1434"></a>    <a href="libpq-fe.h.html#LN81"><span class='Ref_to_Typedef'>ExecStatusType</span></a> <span class='Declare_Local'>status</span> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a><span class='Delimiter'>; 
</span><a name="LN1435"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span><a name="LN1436"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* PQfn already validated connection state */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN519"><span class='Ref_to_Func'>pqPutMsgStart</span></a><span class='Parentheses'>(</span><span class='String'>'F'</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>||</span>  <span class='Comment_Single_Line'>/* function call msg */ 
</span>        <a href="fe-misc.c.html#LN179"><span class='Ref_to_Func'>pqPuts</span></a><span class='Parentheses'>(</span><span class='String'>" "</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>||</span>    <span class='Comment_Single_Line'>/* dummy string */ 
</span>        <a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>fnid</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Comment_Single_Line'>/* function id */ 
</span>        <a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1431"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* # of args */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1436"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol2.c.html#LN1436"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol2.c.html#LN1431"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="fe-protocol2.c.html#LN1436"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* len.int4 + contents     */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1431"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1436"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN221"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1431"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1436"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN222"><span class='Ref_to_Member'>isint</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1431"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1436"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN227"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>integer<span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN246"><span class='Ref_to_Func'>pqPutnchar</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-protocol2.c.html#LN1431"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1436"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN227"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>ptr<span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1431"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol2.c.html#LN1436"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN221"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nargs;++i &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN587"><span class='Ref_to_Func'>pqPutMsgEnd</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="libpq-int.h.html#LN637"><span class='Ref_to_Proto'>pqFlush</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1433"><span class='Ref_To_Local'>needInput</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Wait for some data to arrive (or for the channel to close) */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN638"><span class='Ref_to_Proto'>pqWait</span></a><span class='Parentheses'>(</span><span class='Boolean'>TRUE</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <a href="fe-misc.c.html#LN629"><span class='Ref_to_Func'>pqReadData</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Scan the message. If we run out of data, loop around to try again. 
         */ 
</span>        <a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN1433"><span class='Ref_To_Local'>needInput</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1435"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We should see V or E response to the command, but might get N 
         * and/or A notices first. We also need to swallow the final Z before 
         * returning. 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1435"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'V'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* function result */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1435"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1435"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='String'>'G'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* function returned nonempty value */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1429"><span class='Ref_to_Parameter'>actual_result_len</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1430"><span class='Ref_to_Parameter'>result_is_int</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1429"><span class='Ref_to_Parameter'>result_buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN195"><span class='Ref_to_Func'>pqGetnchar</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-protocol2.c.html#LN1429"><span class='Ref_to_Parameter'>result_buf</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>*</span><a href="fe-protocol2.c.html#LN1429"><span class='Ref_to_Parameter'>actual_result_len</span></a><span class='Delimiter'>, 
</span>                                       <a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1435"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span>      <span class='Comment_Single_Line'>/* get the last '0' */ 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if id=='G' &raquo; </span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1435"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='String'>'0'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* correctly finished function result message */ 
</span>                    <a href="fe-protocol2.c.html#LN1434"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* The backend violates the protocol. */ 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"protocol error: id=0x%x\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-protocol2.c.html#LN1435"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="libpq-int.h.html#LN573"><span class='Ref_to_Proto'>pqPrepareAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* error return */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN37"><span class='Ref_to_Proto'>pqGetErrorNotice2</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <a href="fe-protocol2.c.html#LN1434"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'A'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* notify message */ 
</span>                <span class='Comment_Multi_Line'>/* handle notify and go back to processing return values */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN39"><span class='Ref_to_Proto'>getNotify</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'N'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* notice */ 
</span>                <span class='Comment_Multi_Line'>/* handle notice and go back to processing return values */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN37"><span class='Ref_to_Proto'>pqGetErrorNotice2</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'Z'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* backend is ready for new query */ 
</span>                <span class='Comment_Multi_Line'>/* consume the message and exit */ 
</span>                <a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* if we saved a result object (probably an error), use it */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="libpq-int.h.html#LN573"><span class='Ref_to_Proto'>pqPrepareAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1434"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* The backend violates the protocol. */ 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"protocol error: id=0x%x\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-protocol2.c.html#LN1435"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="libpq-int.h.html#LN573"><span class='Ref_to_Proto'>pqPrepareAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch id &raquo; </span> 
        <span class='Comment_Multi_Line'>/* Completed this message, keep going */ 
</span>        <a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol2.c.html#LN1433"><span class='Ref_To_Local'>needInput</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We fall out of the loop only upon failing to read data. 
     * conn-&GT;errorMessage has been set by pqWait or pqReadData. We want to 
     * append it to any already-received error message. 
     */ 
</span>    <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="libpq-int.h.html#LN573"><span class='Ref_to_Proto'>pqPrepareAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1428"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqFunctionCall2 &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Construct startup packet 
 * 
 * Returns a malloc'd packet buffer, or NULL if out of memory 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN1599"></a><span class='Declare_Function'>pqBuildStartupPacket2</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>packetlen</span><span class='Delimiter'>, 
</span><a name="LN1600"></a>                      <span class='Keyword'>const </span><a href="libpq-int.h.html#LN248"><span class='Ref_to_Struct'>PQEnvironmentOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1602"></a>    <a href="../../include/libpq/pqcomm.h.html#LN140"><span class='Ref_to_Struct'>StartupPacket</span></a> <span class='Operator'>*</span><span class='Declare_Local'>startpacket</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="fe-protocol2.c.html#LN1599"><span class='Ref_to_Parameter'>packetlen</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN140"><span class='Ref_to_Struct'>StartupPacket</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol2.c.html#LN1602"><span class='Ref_To_Local'>startpacket</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN140"><span class='Ref_to_Struct'>StartupPacket</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN140"><span class='Ref_to_Struct'>StartupPacket</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol2.c.html#LN1602"><span class='Ref_To_Local'>startpacket</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1602"><span class='Ref_To_Local'>startpacket</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN140"><span class='Ref_to_Struct'>StartupPacket</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="fe-protocol2.c.html#LN1602"><span class='Ref_To_Local'>startpacket</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/pqcomm.h.html#LN142"><span class='Ref_to_Member'>protoVersion</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1599"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* strncpy is safe here: postmaster will handle full fields correctly */ 
</span>    strncpy<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1602"><span class='Ref_To_Local'>startpacket</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/pqcomm.h.html#LN145"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1599"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Delimiter'>, </span><a href="../../include/libpq/pqcomm.h.html#LN133"><span class='Ref_to_Const'>SM_USER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    strncpy<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1602"><span class='Ref_To_Local'>startpacket</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/pqcomm.h.html#LN143"><span class='Ref_to_Member'>database</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1599"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Delimiter'>, </span><a href="../../include/libpq/pqcomm.h.html#LN132"><span class='Ref_to_Const'>SM_DATABASE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    strncpy<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1602"><span class='Ref_To_Local'>startpacket</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/pqcomm.h.html#LN148"><span class='Ref_to_Member'>tty</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1599"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN332"><span class='Ref_to_Member'>pgtty</span></a><span class='Delimiter'>, </span><a href="../../include/libpq/pqcomm.h.html#LN138"><span class='Ref_to_Const'>SM_TTY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1599"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a><span class='Parentheses'>) 
</span>        strncpy<span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN1602"><span class='Ref_To_Local'>startpacket</span></a><span class='Operator'>-&GT;</span><a href="../../include/libpq/pqcomm.h.html#LN146"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, </span><a href="fe-protocol2.c.html#LN1599"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a><span class='Delimiter'>, </span><a href="../../include/libpq/pqcomm.h.html#LN136"><span class='Ref_to_Const'>SM_OPTIONS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-protocol2.c.html#LN1602"><span class='Ref_To_Local'>startpacket</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqBuildStartupPacket2 &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>